const a21_0x31d697=a21_0x13fd;function a21_0x13fd(_0xa5b119,_0x14e6c8){const _0x1f528f=a21_0x1f52();return a21_0x13fd=function(_0x13fd55,_0x1257bd){_0x13fd55=_0x13fd55-0x19b;let _0x516fbc=_0x1f528f[_0x13fd55];return _0x516fbc;},a21_0x13fd(_0xa5b119,_0x14e6c8);}(function(_0x36e199,_0x253f2c){const _0x35f65d=a21_0x13fd,_0x1900dc=_0x36e199();while(!![]){try{const _0x454685=-parseInt(_0x35f65d(0x1a1))/0x1*(-parseInt(_0x35f65d(0x1a8))/0x2)+parseInt(_0x35f65d(0x1c7))/0x3+parseInt(_0x35f65d(0x1bc))/0x4+parseInt(_0x35f65d(0x1ca))/0x5+-parseInt(_0x35f65d(0x1d8))/0x6*(-parseInt(_0x35f65d(0x1a6))/0x7)+parseInt(_0x35f65d(0x1ee))/0x8+-parseInt(_0x35f65d(0x1a7))/0x9*(parseInt(_0x35f65d(0x1c0))/0xa);if(_0x454685===_0x253f2c)break;else _0x1900dc['push'](_0x1900dc['shift']());}catch(_0x591901){_0x1900dc['push'](_0x1900dc['shift']());}}}(a21_0x1f52,0x70232));const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x31d697(0x1b8)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x31d697(0x1b2)),{logger}=require('../../config/logger'),{getCredentialsPath,getGridDetails}=require(a21_0x31d697(0x1b4)),{scaleDownHubDeployment}=require(a21_0x31d697(0x1a5)),{sendInstrumentationEvent}=require(a21_0x31d697(0x19b)),webSocketUtils=require(a21_0x31d697(0x1f3)),{createK8sClient}=require('../../utils/createk8sClient'),{getCloudProviderObject}=require('../../cloudproviders/utils');exports[a21_0x31d697(0x1b1)]=a21_0x31d697(0x1df),exports[a21_0x31d697(0x1c4)]=a21_0x31d697(0x1d5),exports[a21_0x31d697(0x19d)]=function(_0x750f5d){const _0x479a03=a21_0x31d697,_0x168a88={};_0x168a88[_0x479a03(0x1da)]=_0x479a03(0x1e9),_0x168a88[_0x479a03(0x1d0)]=_0x479a03(0x1b9),_0x168a88[_0x479a03(0x1a3)]=_0x479a03(0x1d6),_0x168a88['ORyOn']='boolean',_0x168a88[_0x479a03(0x1ed)]=_0x479a03(0x1d1);const _0x37745e=_0x168a88,_0x44fc01={};_0x44fc01[_0x479a03(0x1be)]=_0x37745e[_0x479a03(0x1da)],_0x44fc01['type']=_0x37745e[_0x479a03(0x1d0)];const _0x1115c4={};_0x1115c4[_0x479a03(0x1be)]=_0x37745e[_0x479a03(0x1a3)],_0x1115c4[_0x479a03(0x1c6)]=_0x37745e[_0x479a03(0x1db)],_0x1115c4[_0x479a03(0x1f0)]=![];const _0x55329b={};return _0x55329b[_0x479a03(0x1c3)]=_0x44fc01,_0x55329b[_0x479a03(0x1c2)]=_0x1115c4,_0x750f5d[_0x479a03(0x1bb)](HELP_HEADER_MESSAGE[_0x479a03(0x1dd)])[_0x479a03(0x1d9)](HELP_FOOTER_MESSAGE)['options'](_0x55329b)['help'](_0x37745e[_0x479a03(0x1ed)])[_0x479a03(0x1c9)];},exports['handler']=async function(_0x572326){const _0x6527a4=a21_0x31d697,_0x40401d={'flJDR':_0x6527a4(0x1cd),'PtNHU':function(_0x378092){return _0x378092();},'dgsbz':'Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','PFEjM':function(_0x24d3b1,_0x2c51b0,_0xf041c8,_0x33f998,_0x29a222,_0xc0b163,_0x55d279){return _0x24d3b1(_0x2c51b0,_0xf041c8,_0x33f998,_0x29a222,_0xc0b163,_0x55d279);},'czPpT':_0x6527a4(0x1ba),'hDruu':'init-not-called','nbFfn':function(_0x13f0ad,_0x2b6a92,_0x1203a,_0x479460,_0x5284e7,_0x52342f,_0x334e43){return _0x13f0ad(_0x2b6a92,_0x1203a,_0x479460,_0x5284e7,_0x52342f,_0x334e43);},'CxiCS':'<UsernamePlaceholder>','MPQGJ':'<PasswordPlaceholder>','nvwuk':_0x6527a4(0x1ab),'GGJdf':function(_0x2ef15d,_0x490db6,_0x5418c3,_0x16e001){return _0x2ef15d(_0x490db6,_0x5418c3,_0x16e001);},'jAEVH':function(_0x38e8a7,_0x4cf52a,_0x1ebd08,_0x16cec2,_0x54cbca,_0x1a0e1b,_0x4c6093){return _0x38e8a7(_0x4cf52a,_0x1ebd08,_0x16cec2,_0x54cbca,_0x1a0e1b,_0x4c6093);},'NJdYu':function(_0x10920f,_0x274221,_0x4de1d3){return _0x10920f(_0x274221,_0x4de1d3);},'CvwYK':function(_0x41f5c3,_0x3d18c5,_0x599c9c){return _0x41f5c3(_0x3d18c5,_0x599c9c);},'DnRke':_0x6527a4(0x1c1),'dDezF':function(_0x6bddc6,_0x1831b8){return _0x6bddc6===_0x1831b8;},'NKOuO':'Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','XiwxD':function(_0x4a3ce3,_0x44ce12,_0x26149a,_0x5909b4,_0x18f733,_0x4efefc,_0x1c1446){return _0x4a3ce3(_0x44ce12,_0x26149a,_0x5909b4,_0x18f733,_0x4efefc,_0x1c1446);},'IyzEe':_0x6527a4(0x1bd),'cYFvj':function(_0x57b4a2,_0xb975a3){return _0x57b4a2===_0xb975a3;},'lEkNv':function(_0x19beff,_0x5b480a,_0x5648a9,_0x4db4aa,_0x294250,_0x4c55fd,_0x1a52cc){return _0x19beff(_0x5b480a,_0x5648a9,_0x4db4aa,_0x294250,_0x4c55fd,_0x1a52cc);},'MQlIF':_0x6527a4(0x1b7),'pJXmo':function(_0x2d0283,_0x2f2482,_0x4bae9e,_0x5eecdd,_0x490d6c,_0x2db42a,_0x475c9d){return _0x2d0283(_0x2f2482,_0x4bae9e,_0x5eecdd,_0x490d6c,_0x2db42a,_0x475c9d);},'ExaIA':'server-error'};let _0x8a56f6;try{!_0x572326[_0x6527a4(0x1e8)]&&(logger[_0x6527a4(0x1c5)](_0x40401d[_0x6527a4(0x1d2)]),process['exit'](0x1));!fs['existsSync'](_0x40401d[_0x6527a4(0x1d4)](getCredentialsPath))&&(logger[_0x6527a4(0x1c5)](_0x40401d['dgsbz']),await _0x40401d[_0x6527a4(0x1a4)](sendInstrumentationEvent,_0x572326,_0x40401d[_0x6527a4(0x1f1)],messageTypes['ERROR'],_0x40401d[_0x6527a4(0x1d7)],null,_0x572326),process['exit'](0x1));logger[_0x6527a4(0x1bf)]('Stopping\x20grid\x20'+_0x572326[_0x6527a4(0x1e8)]),await _0x40401d['nbFfn'](sendInstrumentationEvent,_0x572326,_0x40401d[_0x6527a4(0x1f1)],messageTypes[_0x6527a4(0x1ce)],null,null,_0x572326);const _0x698446=JSON[_0x6527a4(0x1ac)](fs['readFileSync'](_0x40401d[_0x6527a4(0x1d4)](getCredentialsPath)));global_registry[_0x6527a4(0x1cc)]=_0x698446[_0x6527a4(0x1e4)]['username'],global_registry['bstackAccesskey']=_0x698446[_0x6527a4(0x1e4)][_0x6527a4(0x1e0)];const _0x2d677c=WS_ENDPOINT['replace'](_0x40401d[_0x6527a4(0x1a2)],_0x698446['Browserstack'][_0x6527a4(0x1a9)])['replace'](_0x40401d[_0x6527a4(0x1a0)],_0x698446[_0x6527a4(0x1e4)][_0x6527a4(0x1e0)]),_0x5bbe6a={};_0x5bbe6a['WebSocket']=ws,_0x5bbe6a[_0x6527a4(0x1e1)]=0x36ee80,_0x8a56f6=new ReconnectingWebSocket(_0x2d677c,[],_0x5bbe6a),logger[_0x6527a4(0x1de)](_0x40401d[_0x6527a4(0x1e2)]),webSocketUtils[_0x6527a4(0x19f)](_0x8a56f6,_0x572326[_0x6527a4(0x1e6)],_0x572326[_0x6527a4(0x1e0)]);const [_0x5b0782,_0x2832f3]=await _0x40401d['GGJdf'](getGridDetails,_0x698446[_0x6527a4(0x1e4)][_0x6527a4(0x1a9)],_0x698446[_0x6527a4(0x1e4)][_0x6527a4(0x1e0)],_0x572326['gridId']);if(_0x2832f3){const _0x188bb0=_0x2832f3['info'];global_registry[_0x6527a4(0x1f2)]=_0x188bb0['cloudProvider'],global_registry[_0x6527a4(0x1aa)]=_0x188bb0[_0x6527a4(0x1af)],global_registry[_0x6527a4(0x1e3)]=_0x188bb0[_0x6527a4(0x1e3)];const _0x11a010=await _0x40401d['jAEVH'](getCloudProviderObject,_0x188bb0[_0x6527a4(0x1f2)],_0x188bb0[_0x6527a4(0x1e3)],_0x188bb0['name'],_0x8a56f6,webSocketUtils,_0x572326),[_0x40e76d,_0xc1daf7,_0x19a623,_0x439f1a,_0x1a096e,_0x5cf4ba]=await _0x40401d[_0x6527a4(0x1ea)](createK8sClient,_0x11a010,_0x572326[_0x6527a4(0x1e7)]);await _0x40401d['CvwYK'](scaleDownHubDeployment,_0xc1daf7,_0x188bb0['name']),logger['info'](_0x40401d[_0x6527a4(0x1b3)]),process[_0x6527a4(0x1b5)](0x0);}_0x40401d[_0x6527a4(0x1ec)](_0x5b0782[_0x6527a4(0x1ad)],0x191)&&(logger[_0x6527a4(0x1c5)](_0x40401d[_0x6527a4(0x1d3)]),await _0x40401d[_0x6527a4(0x1e5)](sendInstrumentationEvent,_0x572326,_0x40401d[_0x6527a4(0x1f1)],messageTypes[_0x6527a4(0x1c8)],_0x40401d[_0x6527a4(0x19c)],null,_0x572326),process[_0x6527a4(0x1b5)](0x1)),_0x40401d[_0x6527a4(0x1cb)](_0x5b0782['statusCode'],0x190)&&(logger[_0x6527a4(0x1c5)](JSON[_0x6527a4(0x1ac)](_0x5b0782[_0x6527a4(0x1eb)])[_0x6527a4(0x1dc)]),await _0x40401d[_0x6527a4(0x1cf)](sendInstrumentationEvent,_0x572326,_0x40401d[_0x6527a4(0x1f1)],messageTypes[_0x6527a4(0x1c8)],_0x40401d['MQlIF'],null,_0x572326),process['exit'](0x1)),logger[_0x6527a4(0x1c5)](_0x6527a4(0x1ef)+JSON['stringify'](_0x5b0782)),await _0x40401d['pJXmo'](sendInstrumentationEvent,_0x572326,_0x40401d['czPpT'],messageTypes[_0x6527a4(0x1c8)],_0x40401d[_0x6527a4(0x19e)],_0x5b0782,_0x572326),process[_0x6527a4(0x1b5)](0x1);}catch(_0x5d3c0c){const _0x2de645=_0x6527a4(0x1b0)+_0x5d3c0c+'\x20\x0a'+JSON[_0x6527a4(0x1b6)](_0x5d3c0c[_0x6527a4(0x1ae)])+'\x20';logger[_0x6527a4(0x1c5)](_0x2de645),process[_0x6527a4(0x1b5)](0x1);}};function a21_0x1f52(){const _0x30ba9f=['hDruu','2172EJGoTk','epilogue','frggd','ORyOn','message','stop','debug','grid','password','connectionTimeout','nvwuk','clusterName','Browserstack','XiwxD','user','skipTlsCertVerify','gridId','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','NJdYu','body','dDezF','IUYwQ','4336760EAMtuv','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','default','czPpT','cloudProvider','../../utils/webSocketUtils','../../utils/instrumentationUtils','IyzEe','builder','ExaIA','addListeners','MPQGJ','664854wftxCr','CxiCS','AMIMG','PFEjM','../../utils/gridComponents','16737ZxqUMo','2668356vxkYBf','2wjhJXy','username','clusterRegion','Adding\x20Websocket\x20listeners','parse','statusCode','stack','region','Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20','command','../../config/constants','DnRke','../../utils/utilityMethods','exit','stringify','invalid-grid-id','reconnecting-websocket','string','stop-grid-called','usage','1289524KhdiKo','unauthorised','description','info','80zbxbYO','Grid\x20stoppped.','skip-tls-cert-verify','grid-id','desc','error','type','942879apYnmy','ERROR','argv','610105OEOYiH','cYFvj','bstackUsername','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','INFO','lEkNv','TyXwa','help','flJDR','NKOuO','PtNHU','Stop\x20a\x20running\x20Automation\x20grid.','Skip\x20insecure\x20cert\x20verification.'];a21_0x1f52=function(){return _0x30ba9f;};return a21_0x1f52();}
const a21_0x3b3c33=a21_0x1737;function a21_0x1737(_0x4b731a,_0x59f132){const _0x5b0b26=a21_0x5b0b();return a21_0x1737=function(_0x1737a9,_0x1988ff){_0x1737a9=_0x1737a9-0x17b;let _0x23a511=_0x5b0b26[_0x1737a9];return _0x23a511;},a21_0x1737(_0x4b731a,_0x59f132);}function a21_0x5b0b(){const _0x1a2b9d=['wiWJa','15CuYXxg','user','74569cEshGw','desc','replace','grid','reconnecting-websocket','eZKIm','password','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','options','DjqgN','1490dwphJk','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','BFSFn','ILjlU','2254664ArKPpj','WmBNF','WebSocket','DUFWg','grid-id','4513293cZEqCw','../../utils/instrumentationUtils','OHJjN','../../utils/createk8sClient','gridId','392520NrYRcS','stop','body','Grid\x20stoppped.','existsSync','3576054DbHhVe','addListeners','jjJry','statusCode','command','type','unauthorised','398rpPAqN','../../config/logger','init-not-called','FiGqa','../../utils/webSocketUtils','clusterName','stringify','server-error','help','TKJtg','debug','oSiVe','npVHA','username','Skip\x20insecure\x20cert\x20verification.','Browserstack','569QSVlby','stop-grid-called','ERROR','Stopping\x20grid\x20','Stop\x20a\x20running\x20Automation\x20grid.','error','EEJSs','skip-tls-cert-verify','default','bstackUsername','SxPxQ','../../config/constants','usage','string','14bTTkes','info','name','Kolib','connectionTimeout','builder','120892vzRKMv','bstackAccesskey','cloudProvider','nchGL','xLFsw','WcgPG','INFO','GfDir','description','region','../../utils/gridComponents','boolean','epilogue','message','<UsernamePlaceholder>','clusterRegion','exit','cbsfy'];a21_0x5b0b=function(){return _0x1a2b9d;};return a21_0x5b0b();}(function(_0x8dcca7,_0x4cfceb){const _0x59b2af=a21_0x1737,_0x142baf=_0x8dcca7();while(!![]){try{const _0x5da974=-parseInt(_0x59b2af(0x1d5))/0x1*(-parseInt(_0x59b2af(0x1c5))/0x2)+-parseInt(_0x59b2af(0x19f))/0x3*(parseInt(_0x59b2af(0x18c))/0x4)+-parseInt(_0x59b2af(0x1b9))/0x5+-parseInt(_0x59b2af(0x1be))/0x6+parseInt(_0x59b2af(0x186))/0x7*(parseInt(_0x59b2af(0x1af))/0x8)+-parseInt(_0x59b2af(0x1b4))/0x9+parseInt(_0x59b2af(0x1ab))/0xa*(parseInt(_0x59b2af(0x1a1))/0xb);if(_0x5da974===_0x4cfceb)break;else _0x142baf['push'](_0x142baf['shift']());}catch(_0x14d61f){_0x142baf['push'](_0x142baf['shift']());}}}(a21_0x5b0b,0x57db7));const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x3b3c33(0x1a5)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x3b3c33(0x183)),{logger}=require(a21_0x3b3c33(0x1c6)),{getCredentialsPath,getGridDetails}=require('../../utils/utilityMethods'),{scaleDownHubDeployment}=require(a21_0x3b3c33(0x196)),{sendInstrumentationEvent}=require(a21_0x3b3c33(0x1b5)),webSocketUtils=require(a21_0x3b3c33(0x1c9)),{createK8sClient}=require(a21_0x3b3c33(0x1b7)),{getCloudProviderObject}=require('../../cloudproviders/utils');exports[a21_0x3b3c33(0x1c2)]=a21_0x3b3c33(0x1a4),exports[a21_0x3b3c33(0x1a2)]=a21_0x3b3c33(0x17c),exports[a21_0x3b3c33(0x18b)]=function(_0x236de5){const _0x560c2a=a21_0x3b3c33,_0xab0dbd={};_0xab0dbd['npVHA']='Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.',_0xab0dbd[_0x560c2a(0x193)]=_0x560c2a(0x185),_0xab0dbd[_0x560c2a(0x189)]=_0x560c2a(0x1d3),_0xab0dbd[_0x560c2a(0x1ce)]=_0x560c2a(0x197),_0xab0dbd[_0x560c2a(0x19e)]=_0x560c2a(0x1cd);const _0x742dfa=_0xab0dbd,_0x3b50e6={};_0x3b50e6[_0x560c2a(0x194)]=_0x742dfa[_0x560c2a(0x1d1)],_0x3b50e6[_0x560c2a(0x1c3)]=_0x742dfa[_0x560c2a(0x193)];const _0x42455e={};_0x42455e[_0x560c2a(0x194)]=_0x742dfa[_0x560c2a(0x189)],_0x42455e['type']=_0x742dfa[_0x560c2a(0x1ce)],_0x42455e[_0x560c2a(0x180)]=![];const _0x4b57d9={};return _0x4b57d9[_0x560c2a(0x1b3)]=_0x3b50e6,_0x4b57d9[_0x560c2a(0x17f)]=_0x42455e,_0x236de5[_0x560c2a(0x184)](HELP_HEADER_MESSAGE[_0x560c2a(0x1ba)])[_0x560c2a(0x198)](HELP_FOOTER_MESSAGE)[_0x560c2a(0x1a9)](_0x4b57d9)[_0x560c2a(0x1cd)](_0x742dfa['wiWJa'])['argv'];},exports['handler']=async function(_0x555b3a){const _0x562f38=a21_0x3b3c33,_0x10abfb={'ILjlU':_0x562f38(0x1ac),'xLFsw':function(_0x25a584){return _0x25a584();},'nchGL':'Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','eZKIm':function(_0x367197,_0x40677c,_0x58c716,_0x3db7ba,_0x505f63,_0x2f647e,_0x4ce39a){return _0x367197(_0x40677c,_0x58c716,_0x3db7ba,_0x505f63,_0x2f647e,_0x4ce39a);},'FiGqa':_0x562f38(0x1d6),'xogvU':_0x562f38(0x1c7),'DUFWg':_0x562f38(0x19a),'jWBBb':'<PasswordPlaceholder>','jjJry':'Adding\x20Websocket\x20listeners','udPud':function(_0x5d43e0,_0x5ecb79,_0x164339,_0x3f2da3){return _0x5d43e0(_0x5ecb79,_0x164339,_0x3f2da3);},'DjqgN':function(_0x376ee1,_0x443560,_0x27d205){return _0x376ee1(_0x443560,_0x27d205);},'SxPxQ':function(_0xd0732a,_0x5a67ec,_0x1ceca7){return _0xd0732a(_0x5a67ec,_0x1ceca7);},'WcgPG':_0x562f38(0x1bc),'cbsfy':function(_0x400e77,_0x3a6854){return _0x400e77===_0x3a6854;},'oSiVe':'Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','AgCVl':function(_0x24a263,_0x3bee3f,_0x565935,_0xe38077,_0x2e3c33,_0x2f81df,_0x63f09f){return _0x24a263(_0x3bee3f,_0x565935,_0xe38077,_0x2e3c33,_0x2f81df,_0x63f09f);},'EEJSs':_0x562f38(0x1c4),'OHJjN':'invalid-grid-id','BFSFn':function(_0x2df6fa,_0x6b2df0,_0x39a9e9,_0xd66ebc,_0x1142ca,_0x42577b,_0x4c1cb2){return _0x2df6fa(_0x6b2df0,_0x39a9e9,_0xd66ebc,_0x1142ca,_0x42577b,_0x4c1cb2);},'WmBNF':_0x562f38(0x1cc)};let _0x51c19b;try{!_0x555b3a[_0x562f38(0x1b8)]&&(logger[_0x562f38(0x17d)](_0x10abfb[_0x562f38(0x1ae)]),process['exit'](0x1));!fs[_0x562f38(0x1bd)](_0x10abfb[_0x562f38(0x190)](getCredentialsPath))&&(logger[_0x562f38(0x17d)](_0x10abfb[_0x562f38(0x18f)]),await _0x10abfb[_0x562f38(0x1a6)](sendInstrumentationEvent,_0x555b3a,_0x10abfb['FiGqa'],messageTypes[_0x562f38(0x1d7)],_0x10abfb['xogvU'],null,_0x555b3a),process[_0x562f38(0x19c)](0x1));logger['info'](_0x562f38(0x17b)+_0x555b3a[_0x562f38(0x1b8)]),await _0x10abfb[_0x562f38(0x1a6)](sendInstrumentationEvent,_0x555b3a,_0x10abfb['FiGqa'],messageTypes[_0x562f38(0x192)],null,null,_0x555b3a);const _0x5b0af7=JSON['parse'](fs['readFileSync'](_0x10abfb[_0x562f38(0x190)](getCredentialsPath)));global_registry[_0x562f38(0x181)]=_0x5b0af7['Browserstack'][_0x562f38(0x1d2)],global_registry[_0x562f38(0x18d)]=_0x5b0af7['Browserstack'][_0x562f38(0x1a7)];const _0x5c6ee3=WS_ENDPOINT[_0x562f38(0x1a3)](_0x10abfb[_0x562f38(0x1b2)],_0x5b0af7[_0x562f38(0x1d4)][_0x562f38(0x1d2)])[_0x562f38(0x1a3)](_0x10abfb['jWBBb'],_0x5b0af7['Browserstack'][_0x562f38(0x1a7)]),_0x3fe38f={};_0x3fe38f[_0x562f38(0x1b1)]=ws,_0x3fe38f[_0x562f38(0x18a)]=0x36ee80,_0x51c19b=new ReconnectingWebSocket(_0x5c6ee3,[],_0x3fe38f),logger[_0x562f38(0x1cf)](_0x10abfb[_0x562f38(0x1c0)]),webSocketUtils[_0x562f38(0x1bf)](_0x51c19b,_0x555b3a[_0x562f38(0x1a0)],_0x555b3a[_0x562f38(0x1a7)]);const [_0x407972,_0xbb45b0]=await _0x10abfb['udPud'](getGridDetails,_0x5b0af7[_0x562f38(0x1d4)]['username'],_0x5b0af7[_0x562f38(0x1d4)][_0x562f38(0x1a7)],_0x555b3a['gridId']);if(_0xbb45b0){const _0x2df5f8=_0xbb45b0[_0x562f38(0x187)];global_registry[_0x562f38(0x18e)]=_0x2df5f8['cloudProvider'],global_registry[_0x562f38(0x19b)]=_0x2df5f8[_0x562f38(0x195)],global_registry[_0x562f38(0x1ca)]=_0x2df5f8['clusterName'];const _0x1de09b=await _0x10abfb[_0x562f38(0x1a6)](getCloudProviderObject,_0x2df5f8[_0x562f38(0x18e)],_0x2df5f8[_0x562f38(0x1ca)],_0x2df5f8[_0x562f38(0x188)],_0x51c19b,webSocketUtils,_0x555b3a),[_0x45ea27,_0x432a5a,_0x1c9934,_0x3033e3,_0x4d50d9,_0x551511]=await _0x10abfb[_0x562f38(0x1aa)](createK8sClient,_0x1de09b,_0x555b3a['skipTlsCertVerify']);await _0x10abfb[_0x562f38(0x182)](scaleDownHubDeployment,_0x432a5a,_0x2df5f8[_0x562f38(0x188)]),logger[_0x562f38(0x187)](_0x10abfb[_0x562f38(0x191)]),process[_0x562f38(0x19c)](0x0);}_0x10abfb[_0x562f38(0x19d)](_0x407972[_0x562f38(0x1c1)],0x191)&&(logger[_0x562f38(0x17d)](_0x10abfb[_0x562f38(0x1d0)]),await _0x10abfb['AgCVl'](sendInstrumentationEvent,_0x555b3a,_0x10abfb[_0x562f38(0x1c8)],messageTypes[_0x562f38(0x1d7)],_0x10abfb[_0x562f38(0x17e)],null,_0x555b3a),process[_0x562f38(0x19c)](0x1)),_0x10abfb[_0x562f38(0x19d)](_0x407972[_0x562f38(0x1c1)],0x190)&&(logger[_0x562f38(0x17d)](JSON['parse'](_0x407972[_0x562f38(0x1bb)])[_0x562f38(0x199)]),await _0x10abfb[_0x562f38(0x1a6)](sendInstrumentationEvent,_0x555b3a,_0x10abfb[_0x562f38(0x1c8)],messageTypes[_0x562f38(0x1d7)],_0x10abfb[_0x562f38(0x1b6)],null,_0x555b3a),process[_0x562f38(0x19c)](0x1)),logger[_0x562f38(0x17d)](_0x562f38(0x1a8)+JSON['stringify'](_0x407972)),await _0x10abfb[_0x562f38(0x1ad)](sendInstrumentationEvent,_0x555b3a,_0x10abfb[_0x562f38(0x1c8)],messageTypes[_0x562f38(0x1d7)],_0x10abfb[_0x562f38(0x1b0)],_0x407972,_0x555b3a),process[_0x562f38(0x19c)](0x1);}catch(_0x26103f){const _0x1496ea='Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20'+_0x26103f+'\x20\x0a'+JSON[_0x562f38(0x1cb)](_0x26103f['stack'])+'\x20';logger['error'](_0x1496ea),process[_0x562f38(0x19c)](0x1);}};
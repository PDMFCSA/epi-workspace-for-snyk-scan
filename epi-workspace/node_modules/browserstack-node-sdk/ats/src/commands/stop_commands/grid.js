const a21_0x18767f=a21_0x2c09;(function(_0x152846,_0x19ab51){const _0x3b669f=a21_0x2c09,_0x11a826=_0x152846();while(!![]){try{const _0x357799=-parseInt(_0x3b669f(0xfa))/0x1*(parseInt(_0x3b669f(0xdd))/0x2)+-parseInt(_0x3b669f(0xbc))/0x3*(-parseInt(_0x3b669f(0xf6))/0x4)+parseInt(_0x3b669f(0x10d))/0x5*(parseInt(_0x3b669f(0xc6))/0x6)+-parseInt(_0x3b669f(0x109))/0x7+-parseInt(_0x3b669f(0x106))/0x8+-parseInt(_0x3b669f(0xf7))/0x9*(-parseInt(_0x3b669f(0xd5))/0xa)+parseInt(_0x3b669f(0xb9))/0xb;if(_0x357799===_0x19ab51)break;else _0x11a826['push'](_0x11a826['shift']());}catch(_0x564002){_0x11a826['push'](_0x11a826['shift']());}}}(a21_0x338d,0x816bf));const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x18767f(0xec)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x18767f(0x104)),{logger}=require(a21_0x18767f(0xf9)),{getCredentialsPath,getGridDetails}=require(a21_0x18767f(0xd0)),{scaleDownHubDeployment}=require('../../utils/gridComponents'),{sendInstrumentationEvent}=require('../../utils/instrumentationUtils'),webSocketUtils=require(a21_0x18767f(0xf8)),{createK8sClient}=require('../../utils/createk8sClient'),{getCloudProviderObject}=require('../../cloudproviders/utils');function a21_0x338d(){const _0x376c27=['rZXMR','body','88hVAIHh','18gmpVeF','../../utils/webSocketUtils','../../config/logger','446wgGzso','pUsMI','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','replace','Oacnd','invalid-grid-id','readFileSync','region','stack','parse','../../config/constants','uRZhd','3232888eCukpl','grid','bQGfT','7228879JUBkDS','string','addListeners','stop','5JcJzFp','cloudProvider','Chtpo','type','boolean','message','grid-id','iRmuV','Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','username','statusCode','16459476MbijBE','bpneg','default','100554VxemkI','<UsernamePlaceholder>','skip-tls-cert-verify','oSPix','WebSocket','skipTlsCertVerify','help','<PasswordPlaceholder>','clusterName','debug','1370886nBZEyQ','bwAbb','clusterRegion','hTnZu','Browserstack','bstackAccesskey','password','exit','bkruH','gridId','../../utils/utilityMethods','ZKodL','ERROR','command','INFO','1185290jLohDY','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','Stop\x20a\x20running\x20Automation\x20grid.','connectionTimeout','zLDQa','unauthorised','info','tkhgY','3284OKFjRa','LmEiM','usage','init-not-called','existsSync','xugtY','fekzW','name','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','error','Dvxle','Adding\x20Websocket\x20listeners','dFPsy','Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','reconnecting-websocket','TZCiT','stringify','OUvhX','Skip\x20insecure\x20cert\x20verification.','WpWpd','description','xypRx'];a21_0x338d=function(){return _0x376c27;};return a21_0x338d();}function a21_0x2c09(_0x5c3644,_0x3cc285){const _0x338ddf=a21_0x338d();return a21_0x2c09=function(_0x2c09ae,_0x57274c){_0x2c09ae=_0x2c09ae-0xb3;let _0x28ba23=_0x338ddf[_0x2c09ae];return _0x28ba23;},a21_0x2c09(_0x5c3644,_0x3cc285);}exports[a21_0x18767f(0xd3)]=a21_0x18767f(0x107),exports['desc']=a21_0x18767f(0xd7),exports['builder']=function(_0x16da36){const _0x5c4aa2=a21_0x18767f,_0x44b628={};_0x44b628[_0x5c4aa2(0xc9)]=_0x5c4aa2(0xeb),_0x44b628[_0x5c4aa2(0x10f)]=_0x5c4aa2(0x10a),_0x44b628[_0x5c4aa2(0xe2)]=_0x5c4aa2(0xf0),_0x44b628[_0x5c4aa2(0xd9)]=_0x5c4aa2(0x111),_0x44b628[_0x5c4aa2(0xed)]='help';const _0x739b75=_0x44b628,_0x315dbd={};_0x315dbd['description']=_0x739b75[_0x5c4aa2(0xc9)],_0x315dbd['type']=_0x739b75[_0x5c4aa2(0x10f)];const _0x103886={};_0x103886[_0x5c4aa2(0xf2)]=_0x739b75[_0x5c4aa2(0xe2)],_0x103886[_0x5c4aa2(0x110)]=_0x739b75[_0x5c4aa2(0xd9)],_0x103886[_0x5c4aa2(0xbb)]=![];const _0x47a5f7={};return _0x47a5f7[_0x5c4aa2(0xb4)]=_0x315dbd,_0x47a5f7[_0x5c4aa2(0xbe)]=_0x103886,_0x16da36[_0x5c4aa2(0xdf)](HELP_HEADER_MESSAGE[_0x5c4aa2(0x10c)])['epilogue'](HELP_FOOTER_MESSAGE)['options'](_0x47a5f7)[_0x5c4aa2(0xc2)](_0x739b75[_0x5c4aa2(0xed)])['argv'];},exports['handler']=async function(_0x34feab){const _0x4d5844=a21_0x18767f,_0x49d32b={'oSPix':_0x4d5844(0xd6),'iRmuV':function(_0x5aebcd){return _0x5aebcd();},'LmEiM':_0x4d5844(0xb6),'fekzW':function(_0x1f3f7a,_0x18e984,_0x128081,_0x5c4bf0,_0x46cc91,_0x51ddf1,_0x2b8435){return _0x1f3f7a(_0x18e984,_0x128081,_0x5c4bf0,_0x46cc91,_0x51ddf1,_0x2b8435);},'OUvhX':'stop-grid-called','bwAbb':_0x4d5844(0xe0),'Oacnd':function(_0x1e2e95){return _0x1e2e95();},'bkruH':_0x4d5844(0xbd),'dFPsy':_0x4d5844(0xc3),'IIbsk':_0x4d5844(0xe8),'rZXMR':function(_0x1d7379,_0x2a6fec,_0x1f7ed2,_0x186981){return _0x1d7379(_0x2a6fec,_0x1f7ed2,_0x186981);},'uRZhd':function(_0x52582f,_0x477947,_0x7674fc){return _0x52582f(_0x477947,_0x7674fc);},'igcsA':function(_0x504ff2,_0x552f5c,_0x2c6a90){return _0x504ff2(_0x552f5c,_0x2c6a90);},'bpneg':'Grid\x20stoppped.','WpWpd':function(_0x50905b,_0x3a696e){return _0x50905b===_0x3a696e;},'tkhgY':_0x4d5844(0xe5),'pUsMI':function(_0x44d5f0,_0x3fbadb,_0x2c46a9,_0x1d162a,_0x508e48,_0x5b6902,_0x14d08a){return _0x44d5f0(_0x3fbadb,_0x2c46a9,_0x1d162a,_0x508e48,_0x5b6902,_0x14d08a);},'bQGfT':_0x4d5844(0xda),'qeYfP':function(_0x44b763,_0xd4be22){return _0x44b763===_0xd4be22;},'xypRx':_0x4d5844(0xff),'Dvxle':function(_0x225163,_0xcf690,_0x299733,_0x4892fa,_0xbe1dcd,_0x326fed,_0x17fdcd){return _0x225163(_0xcf690,_0x299733,_0x4892fa,_0xbe1dcd,_0x326fed,_0x17fdcd);},'ZKodL':'server-error'};let _0x2582d8;try{!_0x34feab['gridId']&&(logger[_0x4d5844(0xe6)](_0x49d32b[_0x4d5844(0xbf)]),process['exit'](0x1));!fs[_0x4d5844(0xe1)](_0x49d32b[_0x4d5844(0xb5)](getCredentialsPath))&&(logger['error'](_0x49d32b[_0x4d5844(0xde)]),await _0x49d32b[_0x4d5844(0xe3)](sendInstrumentationEvent,_0x34feab,_0x49d32b[_0x4d5844(0xef)],messageTypes[_0x4d5844(0xd2)],_0x49d32b[_0x4d5844(0xc7)],null,_0x34feab),process['exit'](0x1));logger['info']('Stopping\x20grid\x20'+_0x34feab[_0x4d5844(0xcf)]),await _0x49d32b['fekzW'](sendInstrumentationEvent,_0x34feab,_0x49d32b[_0x4d5844(0xef)],messageTypes[_0x4d5844(0xd4)],null,null,_0x34feab);const _0x93df7a=JSON[_0x4d5844(0x103)](fs[_0x4d5844(0x100)](_0x49d32b[_0x4d5844(0xfe)](getCredentialsPath)));global_registry['bstackUsername']=_0x93df7a[_0x4d5844(0xca)]['username'],global_registry[_0x4d5844(0xcb)]=_0x93df7a[_0x4d5844(0xca)][_0x4d5844(0xcc)];const _0x2b964f=WS_ENDPOINT[_0x4d5844(0xfd)](_0x49d32b[_0x4d5844(0xce)],_0x93df7a[_0x4d5844(0xca)][_0x4d5844(0xb7)])['replace'](_0x49d32b[_0x4d5844(0xe9)],_0x93df7a['Browserstack'][_0x4d5844(0xcc)]),_0x3dfa68={};_0x3dfa68[_0x4d5844(0xc0)]=ws,_0x3dfa68[_0x4d5844(0xd8)]=0x36ee80,_0x2582d8=new ReconnectingWebSocket(_0x2b964f,[],_0x3dfa68),logger[_0x4d5844(0xc5)](_0x49d32b['IIbsk']),webSocketUtils[_0x4d5844(0x10b)](_0x2582d8,_0x34feab['user'],_0x34feab[_0x4d5844(0xcc)]);const [_0x5800c0,_0x5737e3]=await _0x49d32b[_0x4d5844(0xf4)](getGridDetails,_0x93df7a[_0x4d5844(0xca)][_0x4d5844(0xb7)],_0x93df7a['Browserstack'][_0x4d5844(0xcc)],_0x34feab[_0x4d5844(0xcf)]);if(_0x5737e3){const _0x5485fd=_0x5737e3[_0x4d5844(0xdb)];global_registry[_0x4d5844(0x10e)]=_0x5485fd[_0x4d5844(0x10e)],global_registry[_0x4d5844(0xc8)]=_0x5485fd[_0x4d5844(0x101)],global_registry[_0x4d5844(0xc4)]=_0x5485fd[_0x4d5844(0xc4)];const _0xc4d8f2=await _0x49d32b[_0x4d5844(0xe3)](getCloudProviderObject,_0x5485fd['cloudProvider'],_0x5485fd[_0x4d5844(0xc4)],_0x5485fd['name'],_0x2582d8,webSocketUtils,_0x34feab),[_0x4f63ab,_0x5d7d72,_0x59f63a,_0x9dd6c3,_0x2a3f32,_0x29c09f]=await _0x49d32b[_0x4d5844(0x105)](createK8sClient,_0xc4d8f2,_0x34feab[_0x4d5844(0xc1)]);await _0x49d32b['igcsA'](scaleDownHubDeployment,_0x5d7d72,_0x5485fd[_0x4d5844(0xe4)]),logger[_0x4d5844(0xdb)](_0x49d32b[_0x4d5844(0xba)]),process['exit'](0x0);}_0x49d32b[_0x4d5844(0xf1)](_0x5800c0[_0x4d5844(0xb8)],0x191)&&(logger[_0x4d5844(0xe6)](_0x49d32b[_0x4d5844(0xdc)]),await _0x49d32b[_0x4d5844(0xfb)](sendInstrumentationEvent,_0x34feab,_0x49d32b[_0x4d5844(0xef)],messageTypes[_0x4d5844(0xd2)],_0x49d32b[_0x4d5844(0x108)],null,_0x34feab),process[_0x4d5844(0xcd)](0x1)),_0x49d32b['qeYfP'](_0x5800c0[_0x4d5844(0xb8)],0x190)&&(logger['error'](JSON[_0x4d5844(0x103)](_0x5800c0[_0x4d5844(0xf5)])[_0x4d5844(0xb3)]),await _0x49d32b[_0x4d5844(0xe3)](sendInstrumentationEvent,_0x34feab,_0x49d32b['OUvhX'],messageTypes[_0x4d5844(0xd2)],_0x49d32b[_0x4d5844(0xf3)],null,_0x34feab),process[_0x4d5844(0xcd)](0x1)),logger['error'](_0x4d5844(0xfc)+JSON[_0x4d5844(0xee)](_0x5800c0)),await _0x49d32b[_0x4d5844(0xe7)](sendInstrumentationEvent,_0x34feab,_0x49d32b[_0x4d5844(0xef)],messageTypes[_0x4d5844(0xd2)],_0x49d32b[_0x4d5844(0xd1)],_0x5800c0,_0x34feab),process[_0x4d5844(0xcd)](0x1);}catch(_0x4d868e){const _0x1cf1e0=_0x4d5844(0xea)+_0x4d868e+'\x20\x0a'+JSON[_0x4d5844(0xee)](_0x4d868e[_0x4d5844(0x102)])+'\x20';logger[_0x4d5844(0xe6)](_0x1cf1e0),process['exit'](0x1);}};
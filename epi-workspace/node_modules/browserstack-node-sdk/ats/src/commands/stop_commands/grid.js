const a21_0x3acc76=a21_0x14be;(function(_0x4f5a2a,_0x4851d8){const _0x4444c1=a21_0x14be,_0x4af784=_0x4f5a2a();while(!![]){try{const _0x1af491=-parseInt(_0x4444c1(0x1d6))/0x1+parseInt(_0x4444c1(0x1c3))/0x2+-parseInt(_0x4444c1(0x1f0))/0x3+parseInt(_0x4444c1(0x1f9))/0x4+parseInt(_0x4444c1(0x1d5))/0x5*(-parseInt(_0x4444c1(0x1bb))/0x6)+-parseInt(_0x4444c1(0x1cf))/0x7+parseInt(_0x4444c1(0x1d1))/0x8;if(_0x1af491===_0x4851d8)break;else _0x4af784['push'](_0x4af784['shift']());}catch(_0x5e0ed1){_0x4af784['push'](_0x4af784['shift']());}}}(a21_0x5ebe,0x52651));const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x3acc76(0x1cd)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x3acc76(0x1e3)),{logger}=require(a21_0x3acc76(0x1f3)),{getCredentialsPath,getGridDetails}=require(a21_0x3acc76(0x1d9)),{scaleDownHubDeployment}=require(a21_0x3acc76(0x1b1)),{sendInstrumentationEvent}=require('../../utils/instrumentationUtils'),webSocketUtils=require(a21_0x3acc76(0x1e2)),{createK8sClient}=require(a21_0x3acc76(0x1bc)),{getCloudProviderObject}=require(a21_0x3acc76(0x1ad));function a21_0x5ebe(){const _0x277b4a=['Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','debug','skip-tls-cert-verify','reconnecting-websocket','BECLL','4417462weCNwO','MGklQ','10727424DqSrun','clusterRegion','info','password','204635phrWlo','397342sSbvXM','statusCode','readFileSync','../../utils/utilityMethods','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','server-error','<PasswordPlaceholder>','options','user','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','venTb','Browserstack','../../utils/webSocketUtils','../../config/constants','unauthorised','pcCkU','replace','EuQoT','string','exit','FJjck','Stop\x20a\x20running\x20Automation\x20grid.','help','EGlIJ','skrhg','cloudProvider','1394652uYqwev','mOnYR','JNVTh','../../config/logger','stop-grid-called','argv','XLaJF','error','command','624956oFwmUo','body','../../cloudproviders/utils','connectionTimeout','<UsernamePlaceholder>','region','../../utils/gridComponents','clusterName','name','skipTlsCertVerify','QUPEk','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','Adding\x20Websocket\x20listeners','ERROR','existsSync','bstackUsername','18YWQaUh','../../utils/createk8sClient','addListeners','NRASg','stringify','Wlbrq','description','wlLTl','912790irdGBd','grid-id','AlvmM','parse','builder','type','kbsvE'];a21_0x5ebe=function(){return _0x277b4a;};return a21_0x5ebe();}function a21_0x14be(_0x2a729a,_0x5412ec){const _0x5ebe96=a21_0x5ebe();return a21_0x14be=function(_0x14beed,_0x1488a3){_0x14beed=_0x14beed-0x1ad;let _0x36b4ce=_0x5ebe96[_0x14beed];return _0x36b4ce;},a21_0x14be(_0x2a729a,_0x5412ec);}exports[a21_0x3acc76(0x1f8)]='grid',exports['desc']=a21_0x3acc76(0x1eb),exports[a21_0x3acc76(0x1c7)]=function(_0x394719){const _0x57ffb0=a21_0x3acc76,_0x4c94e4={};_0x4c94e4[_0x57ffb0(0x1c0)]=_0x57ffb0(0x1b6),_0x4c94e4['ZOkdz']=_0x57ffb0(0x1e8),_0x4c94e4[_0x57ffb0(0x1b5)]='Skip\x20insecure\x20cert\x20verification.',_0x4c94e4[_0x57ffb0(0x1ea)]='boolean',_0x4c94e4[_0x57ffb0(0x1f1)]=_0x57ffb0(0x1ec);const _0xe51ab=_0x4c94e4,_0x27d0f7={};_0x27d0f7[_0x57ffb0(0x1c1)]=_0xe51ab[_0x57ffb0(0x1c0)],_0x27d0f7[_0x57ffb0(0x1c8)]=_0xe51ab['ZOkdz'];const _0x5a8ed0={};_0x5a8ed0['description']=_0xe51ab[_0x57ffb0(0x1b5)],_0x5a8ed0['type']=_0xe51ab[_0x57ffb0(0x1ea)],_0x5a8ed0['default']=![];const _0x3d885d={};return _0x3d885d[_0x57ffb0(0x1c4)]=_0x27d0f7,_0x3d885d[_0x57ffb0(0x1cc)]=_0x5a8ed0,_0x394719['usage'](HELP_HEADER_MESSAGE['stop'])['epilogue'](HELP_FOOTER_MESSAGE)[_0x57ffb0(0x1dd)](_0x3d885d)['help'](_0xe51ab[_0x57ffb0(0x1f1)])[_0x57ffb0(0x1f5)];},exports['handler']=async function(_0x5b034d){const _0x2c2405=a21_0x3acc76,_0x10eab7={'skrhg':_0x2c2405(0x1ca),'wlLTl':function(_0x3bca1d){return _0x3bca1d();},'JNVTh':'Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','MGklQ':function(_0x238eb7,_0x42b8d5,_0x27d3e3,_0x46f7ca,_0x50900a,_0xa5f62a,_0x5caf1d){return _0x238eb7(_0x42b8d5,_0x27d3e3,_0x46f7ca,_0x50900a,_0xa5f62a,_0x5caf1d);},'EuQoT':_0x2c2405(0x1f4),'OZUGu':'init-not-called','qBggV':_0x2c2405(0x1af),'lxxDt':_0x2c2405(0x1dc),'NRASg':_0x2c2405(0x1b7),'BECLL':function(_0x1f0839,_0x459b22,_0x8baa16,_0x4f9a4d){return _0x1f0839(_0x459b22,_0x8baa16,_0x4f9a4d);},'XLaJF':function(_0x17f1e7,_0x412043,_0x419f0a){return _0x17f1e7(_0x412043,_0x419f0a);},'pcCkU':function(_0x2df7ff,_0x5157ef,_0x3073ef){return _0x2df7ff(_0x5157ef,_0x3073ef);},'lKIbG':'Grid\x20stoppped.','EGlIJ':function(_0x28831e,_0x10948f){return _0x28831e===_0x10948f;},'kbsvE':_0x2c2405(0x1df),'AlvmM':_0x2c2405(0x1e4),'venTb':'invalid-grid-id','DKNAO':_0x2c2405(0x1db)};let _0x3b1c91;try{!_0x5b034d['gridId']&&(logger['error'](_0x10eab7[_0x2c2405(0x1ee)]),process[_0x2c2405(0x1e9)](0x1));!fs[_0x2c2405(0x1b9)](_0x10eab7[_0x2c2405(0x1c2)](getCredentialsPath))&&(logger['error'](_0x10eab7[_0x2c2405(0x1f2)]),await _0x10eab7['MGklQ'](sendInstrumentationEvent,_0x5b034d,_0x10eab7[_0x2c2405(0x1e7)],messageTypes[_0x2c2405(0x1b8)],_0x10eab7['OZUGu'],null,_0x5b034d),process['exit'](0x1));logger[_0x2c2405(0x1d3)]('Stopping\x20grid\x20'+_0x5b034d['gridId']),await _0x10eab7[_0x2c2405(0x1d0)](sendInstrumentationEvent,_0x5b034d,_0x10eab7['EuQoT'],messageTypes['INFO'],null,null,_0x5b034d);const _0x2778f7=JSON[_0x2c2405(0x1c6)](fs[_0x2c2405(0x1d8)](_0x10eab7['wlLTl'](getCredentialsPath)));global_registry[_0x2c2405(0x1ba)]=_0x2778f7[_0x2c2405(0x1e1)]['username'],global_registry['bstackAccesskey']=_0x2778f7[_0x2c2405(0x1e1)][_0x2c2405(0x1d4)];const _0x226ced=WS_ENDPOINT[_0x2c2405(0x1e6)](_0x10eab7['qBggV'],_0x2778f7[_0x2c2405(0x1e1)]['username'])['replace'](_0x10eab7['lxxDt'],_0x2778f7[_0x2c2405(0x1e1)][_0x2c2405(0x1d4)]),_0x56ce6b={};_0x56ce6b['WebSocket']=ws,_0x56ce6b[_0x2c2405(0x1ae)]=0x36ee80,_0x3b1c91=new ReconnectingWebSocket(_0x226ced,[],_0x56ce6b),logger[_0x2c2405(0x1cb)](_0x10eab7[_0x2c2405(0x1be)]),webSocketUtils[_0x2c2405(0x1bd)](_0x3b1c91,_0x5b034d[_0x2c2405(0x1de)],_0x5b034d[_0x2c2405(0x1d4)]);const [_0x211ec9,_0x5d1de0]=await _0x10eab7[_0x2c2405(0x1ce)](getGridDetails,_0x2778f7[_0x2c2405(0x1e1)]['username'],_0x2778f7[_0x2c2405(0x1e1)][_0x2c2405(0x1d4)],_0x5b034d['gridId']);if(_0x5d1de0){const _0x130e89=_0x5d1de0['info'];global_registry['cloudProvider']=_0x130e89[_0x2c2405(0x1ef)],global_registry[_0x2c2405(0x1d2)]=_0x130e89[_0x2c2405(0x1b0)],global_registry[_0x2c2405(0x1b2)]=_0x130e89[_0x2c2405(0x1b2)];const _0x3951d4=await _0x10eab7[_0x2c2405(0x1d0)](getCloudProviderObject,_0x130e89[_0x2c2405(0x1ef)],_0x130e89[_0x2c2405(0x1b2)],_0x130e89[_0x2c2405(0x1b3)],_0x3b1c91,webSocketUtils,_0x5b034d),[_0x40f08a,_0x5dfb98,_0x397efb,_0x2d8a82,_0x562575,_0x2d9936]=await _0x10eab7[_0x2c2405(0x1f6)](createK8sClient,_0x3951d4,_0x5b034d[_0x2c2405(0x1b4)]);await _0x10eab7[_0x2c2405(0x1e5)](scaleDownHubDeployment,_0x5dfb98,_0x130e89[_0x2c2405(0x1b3)]),logger['info'](_0x10eab7['lKIbG']),process[_0x2c2405(0x1e9)](0x0);}_0x10eab7[_0x2c2405(0x1ed)](_0x211ec9[_0x2c2405(0x1d7)],0x191)&&(logger[_0x2c2405(0x1f7)](_0x10eab7[_0x2c2405(0x1c9)]),await _0x10eab7[_0x2c2405(0x1d0)](sendInstrumentationEvent,_0x5b034d,_0x10eab7[_0x2c2405(0x1e7)],messageTypes[_0x2c2405(0x1b8)],_0x10eab7[_0x2c2405(0x1c5)],null,_0x5b034d),process['exit'](0x1)),_0x10eab7[_0x2c2405(0x1ed)](_0x211ec9['statusCode'],0x190)&&(logger[_0x2c2405(0x1f7)](JSON[_0x2c2405(0x1c6)](_0x211ec9[_0x2c2405(0x1fa)])['message']),await _0x10eab7[_0x2c2405(0x1d0)](sendInstrumentationEvent,_0x5b034d,_0x10eab7[_0x2c2405(0x1e7)],messageTypes[_0x2c2405(0x1b8)],_0x10eab7[_0x2c2405(0x1e0)],null,_0x5b034d),process['exit'](0x1)),logger['error'](_0x2c2405(0x1da)+JSON[_0x2c2405(0x1bf)](_0x211ec9)),await _0x10eab7[_0x2c2405(0x1d0)](sendInstrumentationEvent,_0x5b034d,_0x10eab7[_0x2c2405(0x1e7)],messageTypes[_0x2c2405(0x1b8)],_0x10eab7['DKNAO'],_0x211ec9,_0x5b034d),process[_0x2c2405(0x1e9)](0x1);}catch(_0x6176b8){const _0x1aa957='Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20'+_0x6176b8+'\x20\x0a'+JSON['stringify'](_0x6176b8['stack'])+'\x20';logger[_0x2c2405(0x1f7)](_0x1aa957),process[_0x2c2405(0x1e9)](0x1);}};
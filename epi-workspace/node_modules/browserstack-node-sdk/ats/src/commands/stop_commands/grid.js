const a21_0x19568c=a21_0x1d14;(function(_0x3c4d9e,_0x33ad12){const _0x1cb60a=a21_0x1d14,_0x5fe235=_0x3c4d9e();while(!![]){try{const _0x3ea5bc=parseInt(_0x1cb60a(0x124))/0x1+parseInt(_0x1cb60a(0x162))/0x2*(parseInt(_0x1cb60a(0x14f))/0x3)+-parseInt(_0x1cb60a(0x10c))/0x4*(-parseInt(_0x1cb60a(0x10a))/0x5)+-parseInt(_0x1cb60a(0x120))/0x6+parseInt(_0x1cb60a(0x134))/0x7*(parseInt(_0x1cb60a(0x133))/0x8)+-parseInt(_0x1cb60a(0x12c))/0x9*(parseInt(_0x1cb60a(0x131))/0xa)+parseInt(_0x1cb60a(0x13f))/0xb*(-parseInt(_0x1cb60a(0x158))/0xc);if(_0x3ea5bc===_0x33ad12)break;else _0x5fe235['push'](_0x5fe235['shift']());}catch(_0x79f233){_0x5fe235['push'](_0x5fe235['shift']());}}}(a21_0x6ccc,0x54d04));function a21_0x1d14(_0x1b6eff,_0x327bec){const _0x6cccca=a21_0x6ccc();return a21_0x1d14=function(_0x1d148f,_0x4e3c55){_0x1d148f=_0x1d148f-0x107;let _0x18c899=_0x6cccca[_0x1d148f];return _0x18c899;},a21_0x1d14(_0x1b6eff,_0x327bec);}function a21_0x6ccc(){const _0xa833da=['desc','exit','3111Udvcum','Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20','connectionTimeout','HjrEK','skip-tls-cert-verify','wzPmj','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','Grid\x20stoppped.','grid-id','36umQjYx','../../cloudproviders/utils','Stop\x20a\x20running\x20Automation\x20grid.','inxvO','reconnecting-websocket','omRuz','argv','existsSync','../../utils/createk8sClient','MhHzR','16EsesyH','clusterRegion','info','PDOUq','string','10ixPkDu','handler','1371452ZOacuM','iXTYd','message','statusCode','readFileSync','JovpA','password','default','Adding\x20Websocket\x20listeners','epilogue','usage','clusterName','INFO','Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','PLgNL','stringify','xdqGR','name','server-error','ElZsF','3552732mWTIQL','WebSocket','debug','gridId','225463SEVduU','<PasswordPlaceholder>','username','ZymgK','OLmri','command','syejG','bUBum','12123dnGSPQ','invalid-grid-id','CqVHJ','stop','help','30rMQdth','UPbnn','2840YtrqPZ','9863HjcHII','gJynX','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','Browserstack','skipTlsCertVerify','body','xYZFM','grid','GmTXk','onBLY','../../config/constants','1745777lBRzFE','parse','ERROR','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','xKaXC','../../utils/webSocketUtils','cloudProvider','../../config/logger','type','../../utils/instrumentationUtils','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','stop-grid-called','bstackAccesskey','error'];a21_0x6ccc=function(){return _0xa833da;};return a21_0x6ccc();}const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x19568c(0x15c)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x19568c(0x13e)),{logger}=require(a21_0x19568c(0x146)),{getCredentialsPath,getGridDetails}=require('../../utils/utilityMethods'),{scaleDownHubDeployment}=require('../../utils/gridComponents'),{sendInstrumentationEvent}=require(a21_0x19568c(0x148)),webSocketUtils=require(a21_0x19568c(0x144)),{createK8sClient}=require(a21_0x19568c(0x160)),{getCloudProviderObject}=require(a21_0x19568c(0x159));exports[a21_0x19568c(0x129)]=a21_0x19568c(0x13b),exports[a21_0x19568c(0x14d)]=a21_0x19568c(0x15a),exports['builder']=function(_0x1ae21b){const _0xc60cfa=a21_0x19568c,_0x307eb2={};_0x307eb2[_0xc60cfa(0x108)]=_0xc60cfa(0x149),_0x307eb2[_0xc60cfa(0x13c)]=_0xc60cfa(0x109),_0x307eb2[_0xc60cfa(0x132)]='Skip\x20insecure\x20cert\x20verification.',_0x307eb2[_0xc60cfa(0x13a)]='boolean',_0x307eb2['PLgNL']='help';const _0xbf952e=_0x307eb2,_0x1233b0={};_0x1233b0['description']=_0xbf952e[_0xc60cfa(0x108)],_0x1233b0[_0xc60cfa(0x147)]=_0xbf952e[_0xc60cfa(0x13c)];const _0x60ae4d={};_0x60ae4d['description']=_0xbf952e[_0xc60cfa(0x132)],_0x60ae4d[_0xc60cfa(0x147)]=_0xbf952e['xYZFM'],_0x60ae4d[_0xc60cfa(0x113)]=![];const _0x3afa03={};return _0x3afa03[_0xc60cfa(0x157)]=_0x1233b0,_0x3afa03[_0xc60cfa(0x153)]=_0x60ae4d,_0x1ae21b[_0xc60cfa(0x116)](HELP_HEADER_MESSAGE[_0xc60cfa(0x12f)])[_0xc60cfa(0x115)](HELP_FOOTER_MESSAGE)['options'](_0x3afa03)[_0xc60cfa(0x130)](_0xbf952e[_0xc60cfa(0x11a)])[_0xc60cfa(0x15e)];},exports[a21_0x19568c(0x10b)]=async function(_0x2fc416){const _0x261830=a21_0x19568c,_0x5b7b8c={'EIfEJ':_0x261830(0x136),'BBAty':function(_0x22c25b){return _0x22c25b();},'onBLY':_0x261830(0x119),'ZymgK':function(_0x4d0b08,_0x4858ef,_0x45e332,_0x5bdb05,_0x59354c,_0x282519,_0x183b1b){return _0x4d0b08(_0x4858ef,_0x45e332,_0x5bdb05,_0x59354c,_0x282519,_0x183b1b);},'ElZsF':_0x261830(0x14a),'JovpA':'init-not-called','xdqGR':function(_0x11444d){return _0x11444d();},'VWSHv':'<UsernamePlaceholder>','DddbT':_0x261830(0x125),'HjrEK':_0x261830(0x114),'MhHzR':function(_0xd7d32a,_0x21ca30,_0x107871,_0x4bf3ac){return _0xd7d32a(_0x21ca30,_0x107871,_0x4bf3ac);},'xKaXC':function(_0x598548,_0x3f3b2c,_0x3960c8){return _0x598548(_0x3f3b2c,_0x3960c8);},'omRuz':function(_0x3016cb,_0x358600,_0x37f56c){return _0x3016cb(_0x358600,_0x37f56c);},'iXTYd':_0x261830(0x156),'gJynX':function(_0x30f275,_0x2f33d2){return _0x30f275===_0x2f33d2;},'OLmri':_0x261830(0x155),'wzPmj':function(_0x5ebfad,_0x339ccb,_0x431d28,_0x3996a9,_0x4d259c,_0x3e2bd4,_0x498321){return _0x5ebfad(_0x339ccb,_0x431d28,_0x3996a9,_0x4d259c,_0x3e2bd4,_0x498321);},'bUBum':'unauthorised','inxvO':function(_0x59b89e,_0x106a96,_0x1f005c,_0x43d356,_0x1a35d5,_0x43821b,_0x46370e){return _0x59b89e(_0x106a96,_0x1f005c,_0x43d356,_0x1a35d5,_0x43821b,_0x46370e);},'syejG':_0x261830(0x12d),'CqVHJ':_0x261830(0x11e)};let _0x3b3967;try{!_0x2fc416['gridId']&&(logger[_0x261830(0x14c)](_0x5b7b8c['EIfEJ']),process[_0x261830(0x14e)](0x1));!fs[_0x261830(0x15f)](_0x5b7b8c['BBAty'](getCredentialsPath))&&(logger[_0x261830(0x14c)](_0x5b7b8c[_0x261830(0x13d)]),await _0x5b7b8c[_0x261830(0x127)](sendInstrumentationEvent,_0x2fc416,_0x5b7b8c[_0x261830(0x11f)],messageTypes['ERROR'],_0x5b7b8c[_0x261830(0x111)],null,_0x2fc416),process[_0x261830(0x14e)](0x1));logger['info']('Stopping\x20grid\x20'+_0x2fc416[_0x261830(0x123)]),await _0x5b7b8c[_0x261830(0x127)](sendInstrumentationEvent,_0x2fc416,_0x5b7b8c[_0x261830(0x11f)],messageTypes[_0x261830(0x118)],null,null,_0x2fc416);const _0x3b8808=JSON[_0x261830(0x140)](fs[_0x261830(0x110)](_0x5b7b8c[_0x261830(0x11c)](getCredentialsPath)));global_registry['bstackUsername']=_0x3b8808[_0x261830(0x137)][_0x261830(0x126)],global_registry[_0x261830(0x14b)]=_0x3b8808['Browserstack']['password'];const _0x1f07e1=WS_ENDPOINT['replace'](_0x5b7b8c['VWSHv'],_0x3b8808[_0x261830(0x137)][_0x261830(0x126)])['replace'](_0x5b7b8c['DddbT'],_0x3b8808['Browserstack']['password']),_0x22fe92={};_0x22fe92[_0x261830(0x121)]=ws,_0x22fe92[_0x261830(0x151)]=0x36ee80,_0x3b3967=new ReconnectingWebSocket(_0x1f07e1,[],_0x22fe92),logger[_0x261830(0x122)](_0x5b7b8c[_0x261830(0x152)]),webSocketUtils['addListeners'](_0x3b3967,_0x2fc416['user'],_0x2fc416[_0x261830(0x112)]);const [_0x15d2b0,_0x1437e2]=await _0x5b7b8c[_0x261830(0x161)](getGridDetails,_0x3b8808[_0x261830(0x137)][_0x261830(0x126)],_0x3b8808[_0x261830(0x137)][_0x261830(0x112)],_0x2fc416[_0x261830(0x123)]);if(_0x1437e2){const _0x3b2c54=_0x1437e2['info'];global_registry[_0x261830(0x145)]=_0x3b2c54[_0x261830(0x145)],global_registry[_0x261830(0x163)]=_0x3b2c54['region'],global_registry[_0x261830(0x117)]=_0x3b2c54[_0x261830(0x117)];const _0x3fca82=await _0x5b7b8c['ZymgK'](getCloudProviderObject,_0x3b2c54[_0x261830(0x145)],_0x3b2c54[_0x261830(0x117)],_0x3b2c54[_0x261830(0x11d)],_0x3b3967,webSocketUtils,_0x2fc416),[_0x1d4332,_0x8efffd,_0x3dbab1,_0x5699c0,_0x4f4c9c,_0x40fa13]=await _0x5b7b8c[_0x261830(0x143)](createK8sClient,_0x3fca82,_0x2fc416[_0x261830(0x138)]);await _0x5b7b8c[_0x261830(0x15d)](scaleDownHubDeployment,_0x8efffd,_0x3b2c54[_0x261830(0x11d)]),logger[_0x261830(0x107)](_0x5b7b8c[_0x261830(0x10d)]),process[_0x261830(0x14e)](0x0);}_0x5b7b8c[_0x261830(0x135)](_0x15d2b0[_0x261830(0x10f)],0x191)&&(logger[_0x261830(0x14c)](_0x5b7b8c[_0x261830(0x128)]),await _0x5b7b8c['wzPmj'](sendInstrumentationEvent,_0x2fc416,_0x5b7b8c[_0x261830(0x11f)],messageTypes[_0x261830(0x141)],_0x5b7b8c[_0x261830(0x12b)],null,_0x2fc416),process[_0x261830(0x14e)](0x1)),_0x5b7b8c['gJynX'](_0x15d2b0['statusCode'],0x190)&&(logger[_0x261830(0x14c)](JSON[_0x261830(0x140)](_0x15d2b0[_0x261830(0x139)])[_0x261830(0x10e)]),await _0x5b7b8c[_0x261830(0x15b)](sendInstrumentationEvent,_0x2fc416,_0x5b7b8c[_0x261830(0x11f)],messageTypes['ERROR'],_0x5b7b8c[_0x261830(0x12a)],null,_0x2fc416),process[_0x261830(0x14e)](0x1)),logger[_0x261830(0x14c)](_0x261830(0x142)+JSON['stringify'](_0x15d2b0)),await _0x5b7b8c[_0x261830(0x154)](sendInstrumentationEvent,_0x2fc416,_0x5b7b8c[_0x261830(0x11f)],messageTypes[_0x261830(0x141)],_0x5b7b8c[_0x261830(0x12e)],_0x15d2b0,_0x2fc416),process[_0x261830(0x14e)](0x1);}catch(_0x4175cc){const _0x36b832=_0x261830(0x150)+_0x4175cc+'\x20\x0a'+JSON[_0x261830(0x11b)](_0x4175cc['stack'])+'\x20';logger[_0x261830(0x14c)](_0x36b832),process[_0x261830(0x14e)](0x1);}};
const a21_0x3ab48a=a21_0x46d2;function a21_0x4b5f(){const _0x59d470=['175zPtrAg','INFO','Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','command','15855708GxIHVy','Browserstack','qtEsS','10bUIWsT','<UsernamePlaceholder>','skipTlsCertVerify','Grid\x20stoppped.','../../utils/webSocketUtils','329127DoejUh','507339vRtknf','stack','username','nYfew','type','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20','../../utils/utilityMethods','ROABU','existsSync','flCGV','error','PSpPD','BgpZN','epilogue','740325SllbAM','dMCjr','../../utils/createk8sClient','gridId','YAcmz','stop','30CVyRot','info','invalid-grid-id','handler','MbRYj','reconnecting-websocket','ERROR','Lyuxp','init-not-called','jvMzZ','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','region','../../utils/gridComponents','<PasswordPlaceholder>','password','description','RVGJf','GnFiK','mhJXI','cloudProvider','parse','clusterRegion','GvVex','builder','skip-tls-cert-verify','SjJkt','clusterName','server-error','10282347nNhFMt','usage','statusCode','jwpyz','connectionTimeout','8TdljJF','WebSocket','string','stringify','Ecfnv','Stop\x20a\x20running\x20Automation\x20grid.','exit','IjVYo','grid-id','IlVsD','../../cloudproviders/utils','body','addListeners','mfpcu','1736676cKiDjv','name','../../config/constants','../../config/logger','help','readFileSync','TVViC','168208knhbwz','message','roDmK','replace','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20'];a21_0x4b5f=function(){return _0x59d470;};return a21_0x4b5f();}function a21_0x46d2(_0x13faa0,_0x3c127a){const _0x4b5fe4=a21_0x4b5f();return a21_0x46d2=function(_0x46d2c5,_0x5d5424){_0x46d2c5=_0x46d2c5-0xd2;let _0x18611a=_0x4b5fe4[_0x46d2c5];return _0x18611a;},a21_0x46d2(_0x13faa0,_0x3c127a);}(function(_0x57cfae,_0x731b){const _0xfdcc7e=a21_0x46d2,_0x529b1c=_0x57cfae();while(!![]){try{const _0x1d34a8=-parseInt(_0xfdcc7e(0xe4))/0x1+parseInt(_0xfdcc7e(0x128))/0x2+parseInt(_0xfdcc7e(0xe3))/0x3*(parseInt(_0xfdcc7e(0x11a))/0x4)+parseInt(_0xfdcc7e(0xf3))/0x5*(-parseInt(_0xfdcc7e(0xf9))/0x6)+-parseInt(_0xfdcc7e(0xd7))/0x7*(-parseInt(_0xfdcc7e(0xd2))/0x8)+parseInt(_0xfdcc7e(0x115))/0x9*(-parseInt(_0xfdcc7e(0xde))/0xa)+parseInt(_0xfdcc7e(0xdb))/0xb;if(_0x1d34a8===_0x731b)break;else _0x529b1c['push'](_0x529b1c['shift']());}catch(_0x378cc1){_0x529b1c['push'](_0x529b1c['shift']());}}}(a21_0x4b5f,0xa246f));const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x3ab48a(0xfe)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x3ab48a(0x12a)),{logger}=require(a21_0x3ab48a(0x12b)),{getCredentialsPath,getGridDetails}=require(a21_0x3ab48a(0xeb)),{scaleDownHubDeployment}=require(a21_0x3ab48a(0x105)),{sendInstrumentationEvent}=require('../../utils/instrumentationUtils'),webSocketUtils=require(a21_0x3ab48a(0xe2)),{createK8sClient}=require(a21_0x3ab48a(0xf5)),{getCloudProviderObject}=require(a21_0x3ab48a(0x124));exports[a21_0x3ab48a(0xda)]='grid',exports['desc']=a21_0x3ab48a(0x11f),exports[a21_0x3ab48a(0x110)]=function(_0x3d7d65){const _0x51a076=a21_0x3ab48a,_0x85156e={};_0x85156e['Lyuxp']=_0x51a076(0x103),_0x85156e[_0x51a076(0x112)]=_0x51a076(0x11c),_0x85156e[_0x51a076(0xf1)]='Skip\x20insecure\x20cert\x20verification.',_0x85156e['PSpPD']='boolean',_0x85156e[_0x51a076(0xe7)]=_0x51a076(0x12c);const _0x2a6315=_0x85156e,_0x942818={};_0x942818[_0x51a076(0x108)]=_0x2a6315[_0x51a076(0x100)],_0x942818[_0x51a076(0xe8)]=_0x2a6315[_0x51a076(0x112)];const _0x1b08f8={};_0x1b08f8['description']=_0x2a6315[_0x51a076(0xf1)],_0x1b08f8[_0x51a076(0xe8)]=_0x2a6315[_0x51a076(0xf0)],_0x1b08f8['default']=![];const _0xffb96e={};return _0xffb96e[_0x51a076(0x122)]=_0x942818,_0xffb96e[_0x51a076(0x111)]=_0x1b08f8,_0x3d7d65[_0x51a076(0x116)](HELP_HEADER_MESSAGE[_0x51a076(0xf8)])[_0x51a076(0xf2)](HELP_FOOTER_MESSAGE)['options'](_0xffb96e)['help'](_0x2a6315[_0x51a076(0xe7)])['argv'];},exports[a21_0x3ab48a(0xfc)]=async function(_0x547333){const _0x5347b9=a21_0x3ab48a,_0x318ef8={'roDmK':_0x5347b9(0xe9),'qdIFu':function(_0x5a90f1){return _0x5a90f1();},'mhJXI':_0x5347b9(0xd9),'IjVYo':function(_0x4e2ba0,_0x478da9,_0x159e5e,_0xe29aec,_0xc68975,_0x5645d8,_0x2e1f1e){return _0x4e2ba0(_0x478da9,_0x159e5e,_0xe29aec,_0xc68975,_0x5645d8,_0x2e1f1e);},'YAcmz':'stop-grid-called','qtEsS':_0x5347b9(0x101),'DMJbv':_0x5347b9(0xdf),'IlVsD':_0x5347b9(0x106),'Xteoc':'Adding\x20Websocket\x20listeners','dMCjr':function(_0x41dc9c,_0x782778,_0x50a0d0,_0x14cdb0){return _0x41dc9c(_0x782778,_0x50a0d0,_0x14cdb0);},'GnFiK':function(_0x541e28,_0x176c7d,_0x58bd15,_0x30783b,_0x46f468,_0x8eb820,_0x30c9b8){return _0x541e28(_0x176c7d,_0x58bd15,_0x30783b,_0x46f468,_0x8eb820,_0x30c9b8);},'flCGV':function(_0x46a5ae,_0x27e204,_0x2b30b8){return _0x46a5ae(_0x27e204,_0x2b30b8);},'Ecfnv':function(_0x5021e6,_0x56dc3a,_0x1290c8){return _0x5021e6(_0x56dc3a,_0x1290c8);},'MbRYj':_0x5347b9(0xe1),'TVViC':function(_0x256ca2,_0x10c5a5){return _0x256ca2===_0x10c5a5;},'GvVex':'Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','jvMzZ':function(_0x20ee0d,_0x4f888f,_0x1f1ee8,_0x1d24df,_0x16dd75,_0x555ba5,_0x4d8525){return _0x20ee0d(_0x4f888f,_0x1f1ee8,_0x1d24df,_0x16dd75,_0x555ba5,_0x4d8525);},'RVGJf':'unauthorised','oGHBN':function(_0x494db6,_0x728c6b,_0x54829f,_0x1ce134,_0x222aa0,_0x1d0d55,_0x3c398d){return _0x494db6(_0x728c6b,_0x54829f,_0x1ce134,_0x222aa0,_0x1d0d55,_0x3c398d);},'jwpyz':_0x5347b9(0xfb),'mfpcu':function(_0x15bf93,_0x54f975,_0xfa3675,_0x5355b6,_0x232101,_0x2db8c5,_0x55ac20){return _0x15bf93(_0x54f975,_0xfa3675,_0x5355b6,_0x232101,_0x2db8c5,_0x55ac20);},'ROABU':_0x5347b9(0x114)};let _0x3daa78;try{!_0x547333[_0x5347b9(0xf6)]&&(logger[_0x5347b9(0xef)](_0x318ef8[_0x5347b9(0xd4)]),process[_0x5347b9(0x120)](0x1));!fs[_0x5347b9(0xed)](_0x318ef8['qdIFu'](getCredentialsPath))&&(logger[_0x5347b9(0xef)](_0x318ef8[_0x5347b9(0x10b)]),await _0x318ef8[_0x5347b9(0x121)](sendInstrumentationEvent,_0x547333,_0x318ef8[_0x5347b9(0xf7)],messageTypes[_0x5347b9(0xff)],_0x318ef8[_0x5347b9(0xdd)],null,_0x547333),process[_0x5347b9(0x120)](0x1));logger['info']('Stopping\x20grid\x20'+_0x547333[_0x5347b9(0xf6)]),await _0x318ef8['IjVYo'](sendInstrumentationEvent,_0x547333,_0x318ef8['YAcmz'],messageTypes[_0x5347b9(0xd8)],null,null,_0x547333);const _0x4dcca7=JSON[_0x5347b9(0x10d)](fs[_0x5347b9(0x12d)](_0x318ef8['qdIFu'](getCredentialsPath)));global_registry['bstackUsername']=_0x4dcca7[_0x5347b9(0xdc)][_0x5347b9(0xe6)],global_registry['bstackAccesskey']=_0x4dcca7['Browserstack'][_0x5347b9(0x107)];const _0x37875e=WS_ENDPOINT['replace'](_0x318ef8['DMJbv'],_0x4dcca7[_0x5347b9(0xdc)][_0x5347b9(0xe6)])[_0x5347b9(0xd5)](_0x318ef8[_0x5347b9(0x123)],_0x4dcca7[_0x5347b9(0xdc)][_0x5347b9(0x107)]),_0x5ae308={};_0x5ae308[_0x5347b9(0x11b)]=ws,_0x5ae308[_0x5347b9(0x119)]=0x36ee80,_0x3daa78=new ReconnectingWebSocket(_0x37875e,[],_0x5ae308),logger['debug'](_0x318ef8['Xteoc']),webSocketUtils[_0x5347b9(0x126)](_0x3daa78,_0x547333['user'],_0x547333[_0x5347b9(0x107)]);const [_0xe4c0aa,_0x46b982]=await _0x318ef8[_0x5347b9(0xf4)](getGridDetails,_0x4dcca7[_0x5347b9(0xdc)][_0x5347b9(0xe6)],_0x4dcca7[_0x5347b9(0xdc)]['password'],_0x547333[_0x5347b9(0xf6)]);if(_0x46b982){const _0x3ac840=_0x46b982[_0x5347b9(0xfa)];global_registry[_0x5347b9(0x10c)]=_0x3ac840[_0x5347b9(0x10c)],global_registry[_0x5347b9(0x10e)]=_0x3ac840[_0x5347b9(0x104)],global_registry[_0x5347b9(0x113)]=_0x3ac840['clusterName'];const _0x1668f9=await _0x318ef8[_0x5347b9(0x10a)](getCloudProviderObject,_0x3ac840['cloudProvider'],_0x3ac840['clusterName'],_0x3ac840['name'],_0x3daa78,webSocketUtils,_0x547333),[_0x228c6b,_0x4a16bf,_0x25d6f6,_0x304dc7,_0x1a1c21,_0x5a94b0]=await _0x318ef8[_0x5347b9(0xee)](createK8sClient,_0x1668f9,_0x547333[_0x5347b9(0xe0)]);await _0x318ef8[_0x5347b9(0x11e)](scaleDownHubDeployment,_0x4a16bf,_0x3ac840[_0x5347b9(0x129)]),logger['info'](_0x318ef8[_0x5347b9(0xfd)]),process[_0x5347b9(0x120)](0x0);}_0x318ef8['TVViC'](_0xe4c0aa[_0x5347b9(0x117)],0x191)&&(logger[_0x5347b9(0xef)](_0x318ef8[_0x5347b9(0x10f)]),await _0x318ef8[_0x5347b9(0x102)](sendInstrumentationEvent,_0x547333,_0x318ef8[_0x5347b9(0xf7)],messageTypes['ERROR'],_0x318ef8[_0x5347b9(0x109)],null,_0x547333),process[_0x5347b9(0x120)](0x1)),_0x318ef8[_0x5347b9(0x12e)](_0xe4c0aa['statusCode'],0x190)&&(logger[_0x5347b9(0xef)](JSON['parse'](_0xe4c0aa[_0x5347b9(0x125)])[_0x5347b9(0xd3)]),await _0x318ef8['oGHBN'](sendInstrumentationEvent,_0x547333,_0x318ef8[_0x5347b9(0xf7)],messageTypes[_0x5347b9(0xff)],_0x318ef8[_0x5347b9(0x118)],null,_0x547333),process[_0x5347b9(0x120)](0x1)),logger['error'](_0x5347b9(0xd6)+JSON[_0x5347b9(0x11d)](_0xe4c0aa)),await _0x318ef8[_0x5347b9(0x127)](sendInstrumentationEvent,_0x547333,_0x318ef8[_0x5347b9(0xf7)],messageTypes['ERROR'],_0x318ef8[_0x5347b9(0xec)],_0xe4c0aa,_0x547333),process[_0x5347b9(0x120)](0x1);}catch(_0x192cea){const _0x3be994=_0x5347b9(0xea)+_0x192cea+'\x20\x0a'+JSON['stringify'](_0x192cea[_0x5347b9(0xe5)])+'\x20';logger[_0x5347b9(0xef)](_0x3be994),process[_0x5347b9(0x120)](0x1);}};
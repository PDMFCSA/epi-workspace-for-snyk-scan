const a21_0x10d2af=a21_0x4d76;(function(_0x1c1570,_0x5b1ee0){const _0x598011=a21_0x4d76,_0x327c8e=_0x1c1570();while(!![]){try{const _0x4b547c=-parseInt(_0x598011(0x17d))/0x1*(parseInt(_0x598011(0x169))/0x2)+parseInt(_0x598011(0x1ad))/0x3+parseInt(_0x598011(0x199))/0x4*(-parseInt(_0x598011(0x167))/0x5)+parseInt(_0x598011(0x1ab))/0x6*(parseInt(_0x598011(0x19c))/0x7)+-parseInt(_0x598011(0x1be))/0x8*(-parseInt(_0x598011(0x18b))/0x9)+-parseInt(_0x598011(0x166))/0xa*(-parseInt(_0x598011(0x171))/0xb)+-parseInt(_0x598011(0x17e))/0xc*(parseInt(_0x598011(0x1b2))/0xd);if(_0x4b547c===_0x5b1ee0)break;else _0x327c8e['push'](_0x327c8e['shift']());}catch(_0x41ffc1){_0x327c8e['push'](_0x327c8e['shift']());}}}(a21_0x4c50,0xe49b7));function a21_0x4d76(_0x15e0af,_0x3cede4){const _0x4c5071=a21_0x4c50();return a21_0x4d76=function(_0x4d7686,_0x418abd){_0x4d7686=_0x4d7686-0x164;let _0x1426bf=_0x4c5071[_0x4d7686];return _0x1426bf;},a21_0x4d76(_0x15e0af,_0x3cede4);}const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x10d2af(0x1b8)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x10d2af(0x1a3)),{logger}=require(a21_0x10d2af(0x16f)),{getCredentialsPath,getGridDetails}=require(a21_0x10d2af(0x1b6)),{scaleDownHubDeployment}=require(a21_0x10d2af(0x1af)),{sendInstrumentationEvent}=require(a21_0x10d2af(0x1c2)),webSocketUtils=require('../../utils/webSocketUtils'),{createK8sClient}=require(a21_0x10d2af(0x194)),{getCloudProviderObject}=require('../../cloudproviders/utils');function a21_0x4c50(){const _0x36e7a9=['statusCode','2247xuEMQe','qFUFN','gridId','Adding\x20Websocket\x20listeners','BQdNq','Grid\x20stoppped.','debug','../../config/constants','message','region','cFIRF','aHrMY','HhOte','jXHHa','<PasswordPlaceholder>','5394vybsdh','handler','2349912upSivK','RPVtW','../../utils/gridComponents','exit','DYWec','979381uwRDOi','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','ERROR','readFileSync','../../utils/utilityMethods','skip-tls-cert-verify','reconnecting-websocket','type','name','username','INFO','GRbFO','56gizgli','boolean','UPoSo','command','../../utils/instrumentationUtils','Skip\x20insecure\x20cert\x20verification.','lunjZ','3404520gAQRvk','30pPJJcv','help','566CZjCeA','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','rVfMi','Stop\x20a\x20running\x20Automation\x20grid.','IhFnN','RrlaW','../../config/logger','stop','11PbDpeZ','replace','skipTlsCertVerify','stop-grid-called','Browserstack','cloudProvider','CLxLm','parse','grid-id','<UsernamePlaceholder>','pfEyB','unauthorised','1445EzNFQi','12eUdJtX','info','usage','dChZQ','WebSocket','stringify','bstackAccesskey','WSasV','error','string','clusterName','pDEHi','init-not-called','2254032euFucT','connectionTimeout','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','existsSync','clusterRegion','user','qDkGb','bstackUsername','description','../../utils/createk8sClient','Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','gbcxI','default','epilogue','1163216KItcAh','password'];a21_0x4c50=function(){return _0x36e7a9;};return a21_0x4c50();}exports[a21_0x10d2af(0x1c1)]='grid',exports['desc']=a21_0x10d2af(0x16c),exports['builder']=function(_0x159768){const _0x13d623=a21_0x10d2af,_0x3944a0={};_0x3944a0[_0x13d623(0x191)]=_0x13d623(0x16a),_0x3944a0[_0x13d623(0x1a9)]=_0x13d623(0x187),_0x3944a0[_0x13d623(0x16d)]=_0x13d623(0x164),_0x3944a0['BQdNq']=_0x13d623(0x1bf),_0x3944a0[_0x13d623(0x1a7)]=_0x13d623(0x168);const _0x7edf74=_0x3944a0,_0x5bab30={};_0x5bab30['description']=_0x7edf74[_0x13d623(0x191)],_0x5bab30[_0x13d623(0x1b9)]=_0x7edf74[_0x13d623(0x1a9)];const _0x298d0d={};_0x298d0d[_0x13d623(0x193)]=_0x7edf74['IhFnN'],_0x298d0d[_0x13d623(0x1b9)]=_0x7edf74[_0x13d623(0x1a0)],_0x298d0d[_0x13d623(0x197)]=![];const _0x2432d9={};return _0x2432d9[_0x13d623(0x179)]=_0x5bab30,_0x2432d9[_0x13d623(0x1b7)]=_0x298d0d,_0x159768[_0x13d623(0x180)](HELP_HEADER_MESSAGE[_0x13d623(0x170)])[_0x13d623(0x198)](HELP_FOOTER_MESSAGE)['options'](_0x2432d9)['help'](_0x7edf74[_0x13d623(0x1a7)])['argv'];},exports[a21_0x10d2af(0x1ac)]=async function(_0x16e827){const _0x15286=a21_0x10d2af,_0x5e46c5={'esVlk':'Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','qFUFN':function(_0x5943ff){return _0x5943ff();},'HhOte':_0x15286(0x195),'dChZQ':function(_0x391ebd,_0x4b1eb7,_0x447769,_0x4bb474,_0x577b80,_0x44e5ec,_0x3e6890){return _0x391ebd(_0x4b1eb7,_0x447769,_0x4bb474,_0x577b80,_0x44e5ec,_0x3e6890);},'RrlaW':_0x15286(0x174),'GRbFO':_0x15286(0x18a),'kYGIH':function(_0x297c8f,_0x55b639,_0xa7fb4b,_0x19463b,_0x30472a,_0xf5e672,_0x57b427){return _0x297c8f(_0x55b639,_0xa7fb4b,_0x19463b,_0x30472a,_0xf5e672,_0x57b427);},'GFMOc':function(_0x5f5278){return _0x5f5278();},'WSasV':_0x15286(0x17a),'GMluy':_0x15286(0x1aa),'pDEHi':_0x15286(0x19f),'UPoSo':function(_0x7df0d8,_0x52e5e8,_0x41de60,_0x500617){return _0x7df0d8(_0x52e5e8,_0x41de60,_0x500617);},'pfEyB':function(_0x38dacd,_0x28966a,_0x1bb0c7){return _0x38dacd(_0x28966a,_0x1bb0c7);},'rVfMi':function(_0x57a32d,_0x3f516f,_0x3e54cf){return _0x57a32d(_0x3f516f,_0x3e54cf);},'CLxLm':_0x15286(0x1a1),'GNUaj':function(_0x5843f8,_0x10bf1e){return _0x5843f8===_0x10bf1e;},'AmGyO':_0x15286(0x1b3),'lunjZ':function(_0x32d0ea,_0xb4ed8c,_0xc62e8c,_0x5cd791,_0x469f5b,_0x56e41e,_0x18db0b){return _0x32d0ea(_0xb4ed8c,_0xc62e8c,_0x5cd791,_0x469f5b,_0x56e41e,_0x18db0b);},'osWoU':_0x15286(0x17c),'gbcxI':function(_0x15704b,_0x33c37a){return _0x15704b===_0x33c37a;},'DYWec':'invalid-grid-id','cFIRF':function(_0x5a1c00,_0x485eed,_0x2ba33c,_0x17ab7b,_0x46518e,_0x81e589,_0x1b9b44){return _0x5a1c00(_0x485eed,_0x2ba33c,_0x17ab7b,_0x46518e,_0x81e589,_0x1b9b44);},'RPVtW':'server-error'};let _0x4435e3;try{!_0x16e827[_0x15286(0x19e)]&&(logger[_0x15286(0x186)](_0x5e46c5['esVlk']),process[_0x15286(0x1b0)](0x1));!fs[_0x15286(0x18e)](_0x5e46c5[_0x15286(0x19d)](getCredentialsPath))&&(logger[_0x15286(0x186)](_0x5e46c5[_0x15286(0x1a8)]),await _0x5e46c5[_0x15286(0x181)](sendInstrumentationEvent,_0x16e827,_0x5e46c5[_0x15286(0x16e)],messageTypes[_0x15286(0x1b4)],_0x5e46c5[_0x15286(0x1bd)],null,_0x16e827),process[_0x15286(0x1b0)](0x1));logger['info']('Stopping\x20grid\x20'+_0x16e827['gridId']),await _0x5e46c5['kYGIH'](sendInstrumentationEvent,_0x16e827,_0x5e46c5[_0x15286(0x16e)],messageTypes[_0x15286(0x1bc)],null,null,_0x16e827);const _0x398d27=JSON[_0x15286(0x178)](fs[_0x15286(0x1b5)](_0x5e46c5['GFMOc'](getCredentialsPath)));global_registry[_0x15286(0x192)]=_0x398d27[_0x15286(0x175)]['username'],global_registry[_0x15286(0x184)]=_0x398d27[_0x15286(0x175)]['password'];const _0x4af253=WS_ENDPOINT[_0x15286(0x172)](_0x5e46c5[_0x15286(0x185)],_0x398d27['Browserstack'][_0x15286(0x1bb)])[_0x15286(0x172)](_0x5e46c5['GMluy'],_0x398d27[_0x15286(0x175)][_0x15286(0x19a)]),_0x56fa6b={};_0x56fa6b[_0x15286(0x182)]=ws,_0x56fa6b[_0x15286(0x18c)]=0x36ee80,_0x4435e3=new ReconnectingWebSocket(_0x4af253,[],_0x56fa6b),logger[_0x15286(0x1a2)](_0x5e46c5[_0x15286(0x189)]),webSocketUtils['addListeners'](_0x4435e3,_0x16e827[_0x15286(0x190)],_0x16e827[_0x15286(0x19a)]);const [_0x22fa8d,_0x58e1ff]=await _0x5e46c5[_0x15286(0x1c0)](getGridDetails,_0x398d27[_0x15286(0x175)]['username'],_0x398d27['Browserstack'][_0x15286(0x19a)],_0x16e827['gridId']);if(_0x58e1ff){const _0x5d98fb=_0x58e1ff[_0x15286(0x17f)];global_registry[_0x15286(0x176)]=_0x5d98fb[_0x15286(0x176)],global_registry[_0x15286(0x18f)]=_0x5d98fb[_0x15286(0x1a5)],global_registry['clusterName']=_0x5d98fb[_0x15286(0x188)];const _0x45dd87=await _0x5e46c5[_0x15286(0x181)](getCloudProviderObject,_0x5d98fb[_0x15286(0x176)],_0x5d98fb[_0x15286(0x188)],_0x5d98fb['name'],_0x4435e3,webSocketUtils,_0x16e827),[_0x1b62fc,_0x36265d,_0x63004c,_0x1d6d92,_0x262b08,_0x10a6f7]=await _0x5e46c5[_0x15286(0x17b)](createK8sClient,_0x45dd87,_0x16e827[_0x15286(0x173)]);await _0x5e46c5[_0x15286(0x16b)](scaleDownHubDeployment,_0x36265d,_0x5d98fb[_0x15286(0x1ba)]),logger[_0x15286(0x17f)](_0x5e46c5[_0x15286(0x177)]),process[_0x15286(0x1b0)](0x0);}_0x5e46c5['GNUaj'](_0x22fa8d[_0x15286(0x19b)],0x191)&&(logger[_0x15286(0x186)](_0x5e46c5['AmGyO']),await _0x5e46c5[_0x15286(0x165)](sendInstrumentationEvent,_0x16e827,_0x5e46c5['RrlaW'],messageTypes['ERROR'],_0x5e46c5['osWoU'],null,_0x16e827),process[_0x15286(0x1b0)](0x1)),_0x5e46c5[_0x15286(0x196)](_0x22fa8d[_0x15286(0x19b)],0x190)&&(logger['error'](JSON[_0x15286(0x178)](_0x22fa8d['body'])[_0x15286(0x1a4)]),await _0x5e46c5[_0x15286(0x165)](sendInstrumentationEvent,_0x16e827,_0x5e46c5[_0x15286(0x16e)],messageTypes['ERROR'],_0x5e46c5[_0x15286(0x1b1)],null,_0x16e827),process['exit'](0x1)),logger['error'](_0x15286(0x18d)+JSON[_0x15286(0x183)](_0x22fa8d)),await _0x5e46c5[_0x15286(0x1a6)](sendInstrumentationEvent,_0x16e827,_0x5e46c5['RrlaW'],messageTypes[_0x15286(0x1b4)],_0x5e46c5[_0x15286(0x1ae)],_0x22fa8d,_0x16e827),process['exit'](0x1);}catch(_0x10c55a){const _0x57923e='Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20'+_0x10c55a+'\x20\x0a'+JSON[_0x15286(0x183)](_0x10c55a['stack'])+'\x20';logger[_0x15286(0x186)](_0x57923e),process['exit'](0x1);}};
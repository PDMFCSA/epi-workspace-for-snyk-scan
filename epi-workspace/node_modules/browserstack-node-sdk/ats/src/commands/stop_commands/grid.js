const a21_0x531523=a21_0x14ce;function a21_0x1e7d(){const _0x36f133=['Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','epilogue','Stop\x20a\x20running\x20Automation\x20grid.','phhlm','command','stringify','stack','default','handler','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','hkumy','statusCode','message','Skip\x20insecure\x20cert\x20verification.','options','readFileSync','connectionTimeout','qGccg','Adding\x20Websocket\x20listeners','gridId','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','cloudProvider','Okjne','parse','help','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','135INoJHX','../../config/logger','name','grid-id','exit','grid','tnGmC','2FxaHRl','replace','lzjIx','eEfUR','ERROR','stop','username','../../cloudproviders/utils','../../utils/webSocketUtils','zpSNc','2062370KmzgCQ','builder','error','BynlA','9099220ZeUBPn','NLizh','1321563iURdFw','9206834eJqyog','<UsernamePlaceholder>','nWxot','MzjDh','password','PyKma','kILuv','mukOn','zYOVq','<PasswordPlaceholder>','type','cMTCl','../../utils/createk8sClient','NgEGu','rUjKA','invalid-grid-id','7070304joXNai','skip-tls-cert-verify','description','reconnecting-websocket','existsSync','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','clusterName','WWBPm','desc','1096426RvkNgb','init-not-called','Grid\x20stoppped.','Idydl','server-error','vFBzD','bstackUsername','argv','body','INFO','403976MHLgvO','Browserstack','info','6PwFrpt','../../utils/utilityMethods','clusterRegion','usage','Xsgee','Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20'];a21_0x1e7d=function(){return _0x36f133;};return a21_0x1e7d();}(function(_0x260a7d,_0x2bb3cb){const _0x54a860=a21_0x14ce,_0x1b22f9=_0x260a7d();while(!![]){try{const _0x73c2cc=-parseInt(_0x54a860(0x1f9))/0x1*(parseInt(_0x54a860(0x22d))/0x2)+-parseInt(_0x54a860(0x1df))/0x3+parseInt(_0x54a860(0x1f0))/0x4+parseInt(_0x54a860(0x1d9))/0x5+-parseInt(_0x54a860(0x206))/0x6*(parseInt(_0x54a860(0x1e0))/0x7)+-parseInt(_0x54a860(0x203))/0x8*(-parseInt(_0x54a860(0x226))/0x9)+parseInt(_0x54a860(0x1dd))/0xa;if(_0x73c2cc===_0x2bb3cb)break;else _0x1b22f9['push'](_0x1b22f9['shift']());}catch(_0x2e3b10){_0x1b22f9['push'](_0x1b22f9['shift']());}}}(a21_0x1e7d,0xf2f92));const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x531523(0x1f3)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require('../../config/constants'),{logger}=require(a21_0x531523(0x227)),{getCredentialsPath,getGridDetails}=require(a21_0x531523(0x207)),{scaleDownHubDeployment}=require('../../utils/gridComponents'),{sendInstrumentationEvent}=require('../../utils/instrumentationUtils'),webSocketUtils=require(a21_0x531523(0x1d7)),{createK8sClient}=require(a21_0x531523(0x1ec)),{getCloudProviderObject}=require(a21_0x531523(0x1d6));function a21_0x14ce(_0xb5e8f5,_0x3aa09b){const _0x1e7dc3=a21_0x1e7d();return a21_0x14ce=function(_0x14cee7,_0x5971d0){_0x14cee7=_0x14cee7-0x1d5;let _0x44a17f=_0x1e7dc3[_0x14cee7];return _0x44a17f;},a21_0x14ce(_0xb5e8f5,_0x3aa09b);}exports[a21_0x531523(0x210)]=a21_0x531523(0x22b),exports[a21_0x531523(0x1f8)]=a21_0x531523(0x20e),exports[a21_0x531523(0x1da)]=function(_0x204f0b){const _0x4abad6=a21_0x531523,_0x226029={};_0x226029['lzjIx']=_0x4abad6(0x220),_0x226029[_0x4abad6(0x1e3)]='string',_0x226029['mukOn']=_0x4abad6(0x219),_0x226029[_0x4abad6(0x230)]='boolean',_0x226029[_0x4abad6(0x1de)]=_0x4abad6(0x224);const _0x555d3d=_0x226029,_0x5f3fe3={};_0x5f3fe3['description']=_0x555d3d[_0x4abad6(0x22f)],_0x5f3fe3['type']=_0x555d3d['MzjDh'];const _0x4eef40={};_0x4eef40[_0x4abad6(0x1f2)]=_0x555d3d[_0x4abad6(0x1e7)],_0x4eef40[_0x4abad6(0x1ea)]=_0x555d3d['eEfUR'],_0x4eef40[_0x4abad6(0x213)]=![];const _0x387236={};return _0x387236[_0x4abad6(0x229)]=_0x5f3fe3,_0x387236[_0x4abad6(0x1f1)]=_0x4eef40,_0x204f0b[_0x4abad6(0x209)](HELP_HEADER_MESSAGE[_0x4abad6(0x232)])[_0x4abad6(0x20d)](HELP_FOOTER_MESSAGE)[_0x4abad6(0x21a)](_0x387236)[_0x4abad6(0x224)](_0x555d3d[_0x4abad6(0x1de)])[_0x4abad6(0x200)];},exports[a21_0x531523(0x214)]=async function(_0xd30302){const _0x1cb2fc=a21_0x531523,_0x21ad44={'zpSNc':_0x1cb2fc(0x225),'phhlm':function(_0x4f5f50){return _0x4f5f50();},'rUjKA':_0x1cb2fc(0x20c),'qGccg':function(_0x5c9d5d,_0x25b2ae,_0x41552b,_0x22ccf1,_0x3f9ed0,_0x291b70,_0x22dfdd){return _0x5c9d5d(_0x25b2ae,_0x41552b,_0x22ccf1,_0x3f9ed0,_0x291b70,_0x22dfdd);},'vFBzD':'stop-grid-called','BynlA':_0x1cb2fc(0x1fa),'DZowA':function(_0x196175,_0x1875de,_0x33f2a5,_0x5c23c9,_0x2bce96,_0x42bc5b,_0x33dccb){return _0x196175(_0x1875de,_0x33f2a5,_0x5c23c9,_0x2bce96,_0x42bc5b,_0x33dccb);},'nWxot':function(_0x34a509){return _0x34a509();},'wYaQT':_0x1cb2fc(0x1e1),'dzReD':_0x1cb2fc(0x1e9),'NgEGu':_0x1cb2fc(0x21e),'PyKma':function(_0x7fad8d,_0x4b8db5,_0x1a0b87,_0x350382){return _0x7fad8d(_0x4b8db5,_0x1a0b87,_0x350382);},'Xsgee':function(_0x11e4a2,_0x2f9b77,_0x39033c,_0x35cc41,_0x540d0e,_0x1ff91c,_0x43208e){return _0x11e4a2(_0x2f9b77,_0x39033c,_0x35cc41,_0x540d0e,_0x1ff91c,_0x43208e);},'WWBPm':function(_0x109e51,_0x113de7,_0x4985c3){return _0x109e51(_0x113de7,_0x4985c3);},'zYOVq':function(_0x229fd1,_0x29d041,_0x2e4e3d){return _0x229fd1(_0x29d041,_0x2e4e3d);},'dYDaD':_0x1cb2fc(0x1fb),'kILuv':function(_0xbf406f,_0x32d740){return _0xbf406f===_0x32d740;},'AnZVf':_0x1cb2fc(0x215),'hkumy':function(_0x533d85,_0x16edb1,_0x5a4bce,_0x197f81,_0x4a1b97,_0x24bca1,_0x45d3ea){return _0x533d85(_0x16edb1,_0x5a4bce,_0x197f81,_0x4a1b97,_0x24bca1,_0x45d3ea);},'cMTCl':'unauthorised','Idydl':function(_0x81582d,_0x38a571){return _0x81582d===_0x38a571;},'tnGmC':function(_0x30d9a0,_0x36c747,_0x1ddb25,_0x189c2e,_0x203670,_0x585035,_0x649180){return _0x30d9a0(_0x36c747,_0x1ddb25,_0x189c2e,_0x203670,_0x585035,_0x649180);},'nQRkD':_0x1cb2fc(0x1ef),'Okjne':_0x1cb2fc(0x1fd)};let _0x2bcadb;try{!_0xd30302[_0x1cb2fc(0x21f)]&&(logger['error'](_0x21ad44[_0x1cb2fc(0x1d8)]),process['exit'](0x1));!fs[_0x1cb2fc(0x1f4)](_0x21ad44[_0x1cb2fc(0x20f)](getCredentialsPath))&&(logger[_0x1cb2fc(0x1db)](_0x21ad44[_0x1cb2fc(0x1ee)]),await _0x21ad44[_0x1cb2fc(0x21d)](sendInstrumentationEvent,_0xd30302,_0x21ad44['vFBzD'],messageTypes[_0x1cb2fc(0x231)],_0x21ad44[_0x1cb2fc(0x1dc)],null,_0xd30302),process[_0x1cb2fc(0x22a)](0x1));logger['info']('Stopping\x20grid\x20'+_0xd30302['gridId']),await _0x21ad44['DZowA'](sendInstrumentationEvent,_0xd30302,_0x21ad44[_0x1cb2fc(0x1fe)],messageTypes[_0x1cb2fc(0x202)],null,null,_0xd30302);const _0x3ead4c=JSON[_0x1cb2fc(0x223)](fs[_0x1cb2fc(0x21b)](_0x21ad44[_0x1cb2fc(0x1e2)](getCredentialsPath)));global_registry[_0x1cb2fc(0x1ff)]=_0x3ead4c[_0x1cb2fc(0x204)][_0x1cb2fc(0x1d5)],global_registry['bstackAccesskey']=_0x3ead4c[_0x1cb2fc(0x204)]['password'];const _0x59d084=WS_ENDPOINT[_0x1cb2fc(0x22e)](_0x21ad44['wYaQT'],_0x3ead4c['Browserstack'][_0x1cb2fc(0x1d5)])[_0x1cb2fc(0x22e)](_0x21ad44['dzReD'],_0x3ead4c[_0x1cb2fc(0x204)]['password']),_0x503fea={};_0x503fea['WebSocket']=ws,_0x503fea[_0x1cb2fc(0x21c)]=0x36ee80,_0x2bcadb=new ReconnectingWebSocket(_0x59d084,[],_0x503fea),logger['debug'](_0x21ad44[_0x1cb2fc(0x1ed)]),webSocketUtils['addListeners'](_0x2bcadb,_0xd30302['user'],_0xd30302[_0x1cb2fc(0x1e4)]);const [_0x4db74d,_0x4d76e8]=await _0x21ad44[_0x1cb2fc(0x1e5)](getGridDetails,_0x3ead4c['Browserstack'][_0x1cb2fc(0x1d5)],_0x3ead4c['Browserstack'][_0x1cb2fc(0x1e4)],_0xd30302[_0x1cb2fc(0x21f)]);if(_0x4d76e8){const _0x286303=_0x4d76e8[_0x1cb2fc(0x205)];global_registry[_0x1cb2fc(0x221)]=_0x286303[_0x1cb2fc(0x221)],global_registry[_0x1cb2fc(0x208)]=_0x286303['region'],global_registry[_0x1cb2fc(0x1f6)]=_0x286303[_0x1cb2fc(0x1f6)];const _0x516460=await _0x21ad44[_0x1cb2fc(0x20a)](getCloudProviderObject,_0x286303[_0x1cb2fc(0x221)],_0x286303['clusterName'],_0x286303[_0x1cb2fc(0x228)],_0x2bcadb,webSocketUtils,_0xd30302),[_0x276a41,_0x4fea74,_0x57dd18,_0x471915,_0x169a8c,_0x236672]=await _0x21ad44[_0x1cb2fc(0x1f7)](createK8sClient,_0x516460,_0xd30302['skipTlsCertVerify']);await _0x21ad44[_0x1cb2fc(0x1e8)](scaleDownHubDeployment,_0x4fea74,_0x286303[_0x1cb2fc(0x228)]),logger[_0x1cb2fc(0x205)](_0x21ad44['dYDaD']),process[_0x1cb2fc(0x22a)](0x0);}_0x21ad44[_0x1cb2fc(0x1e6)](_0x4db74d[_0x1cb2fc(0x217)],0x191)&&(logger['error'](_0x21ad44['AnZVf']),await _0x21ad44[_0x1cb2fc(0x216)](sendInstrumentationEvent,_0xd30302,_0x21ad44['vFBzD'],messageTypes['ERROR'],_0x21ad44[_0x1cb2fc(0x1eb)],null,_0xd30302),process[_0x1cb2fc(0x22a)](0x1)),_0x21ad44[_0x1cb2fc(0x1fc)](_0x4db74d[_0x1cb2fc(0x217)],0x190)&&(logger['error'](JSON[_0x1cb2fc(0x223)](_0x4db74d[_0x1cb2fc(0x201)])[_0x1cb2fc(0x218)]),await _0x21ad44[_0x1cb2fc(0x22c)](sendInstrumentationEvent,_0xd30302,_0x21ad44[_0x1cb2fc(0x1fe)],messageTypes['ERROR'],_0x21ad44['nQRkD'],null,_0xd30302),process[_0x1cb2fc(0x22a)](0x1)),logger[_0x1cb2fc(0x1db)](_0x1cb2fc(0x1f5)+JSON[_0x1cb2fc(0x211)](_0x4db74d)),await _0x21ad44[_0x1cb2fc(0x21d)](sendInstrumentationEvent,_0xd30302,_0x21ad44[_0x1cb2fc(0x1fe)],messageTypes['ERROR'],_0x21ad44[_0x1cb2fc(0x222)],_0x4db74d,_0xd30302),process['exit'](0x1);}catch(_0x5ea6d0){const _0x5b6061=_0x1cb2fc(0x20b)+_0x5ea6d0+'\x20\x0a'+JSON[_0x1cb2fc(0x211)](_0x5ea6d0[_0x1cb2fc(0x212)])+'\x20';logger[_0x1cb2fc(0x1db)](_0x5b6061),process[_0x1cb2fc(0x22a)](0x1);}};
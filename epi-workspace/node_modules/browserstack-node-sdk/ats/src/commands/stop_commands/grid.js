const a21_0x5d30d2=a21_0x48dc;function a21_0x2949(){const _0x258a30=['stack','zwMMO','name','UnMFa','../../utils/webSocketUtils','goZCe','exit','6959228rjsNds','epilogue','PvIvr','gbbSX','bstackAccesskey','XKttA','default','87560hKaeLY','../../utils/instrumentationUtils','LqTgu','CtbOq','nyrAk','../../cloudproviders/utils','8yiOmpX','options','../../utils/createk8sClient','help','reconnecting-websocket','parse','ERROR','1200fLTzFH','crWWe','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','info','debug','Stop\x20a\x20running\x20Automation\x20grid.','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','15558ELkWMl','type','45528cMUHYa','password','Skip\x20insecure\x20cert\x20verification.','MFwXc','gridId','139NRYePQ','replace','gajGR','grid-id','INFO','body','3806SbBXTv','invalid-grid-id','region','7083387xQptIP','Browserstack','2819058SHfJcu','IsKTx','connectionTimeout','statusCode','../../utils/utilityMethods','kYEQf','clusterRegion','GiUkH','eDmNd','existsSync','skipTlsCertVerify','stop','8275730SCOsKJ','bstackUsername','MayQh','KWkvo','../../config/logger','<UsernamePlaceholder>','username','clusterName','usage','<PasswordPlaceholder>','WbRFh','stringify','unauthorised','RluQV','cloudProvider','JCSIZ','stop-grid-called','description','argv','MkDvx','grid','lSQrx','error','handler'];a21_0x2949=function(){return _0x258a30;};return a21_0x2949();}(function(_0x1c7620,_0x3b5d6d){const _0x346c22=a21_0x48dc,_0x420ac4=_0x1c7620();while(!![]){try{const _0x1be921=parseInt(_0x346c22(0x198))/0x1*(parseInt(_0x346c22(0x191))/0x2)+parseInt(_0x346c22(0x1a3))/0x3+-parseInt(_0x346c22(0x176))/0x4+parseInt(_0x346c22(0x1af))/0x5+parseInt(_0x346c22(0x18a))/0x6*(parseInt(_0x346c22(0x193))/0x7)+-parseInt(_0x346c22(0x183))/0x8*(-parseInt(_0x346c22(0x1a1))/0x9)+-parseInt(_0x346c22(0x17d))/0xa*(parseInt(_0x346c22(0x19e))/0xb);if(_0x1be921===_0x3b5d6d)break;else _0x420ac4['push'](_0x420ac4['shift']());}catch(_0x260fea){_0x420ac4['push'](_0x420ac4['shift']());}}}(a21_0x2949,0xf2d0d));const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x5d30d2(0x187)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require('../../config/constants'),{logger}=require(a21_0x5d30d2(0x1b3)),{getCredentialsPath,getGridDetails}=require(a21_0x5d30d2(0x1a7)),{scaleDownHubDeployment}=require('../../utils/gridComponents'),{sendInstrumentationEvent}=require(a21_0x5d30d2(0x17e)),webSocketUtils=require(a21_0x5d30d2(0x173)),{createK8sClient}=require(a21_0x5d30d2(0x185)),{getCloudProviderObject}=require(a21_0x5d30d2(0x182));function a21_0x48dc(_0x5eb7d5,_0x42b787){const _0x2949c5=a21_0x2949();return a21_0x48dc=function(_0x48dcf5,_0x2cfd86){_0x48dcf5=_0x48dcf5-0x160;let _0x53f0be=_0x2949c5[_0x48dcf5];return _0x53f0be;},a21_0x48dc(_0x5eb7d5,_0x42b787);}exports['command']=a21_0x5d30d2(0x16b),exports['desc']=a21_0x5d30d2(0x18f),exports['builder']=function(_0x29f332){const _0x2f94e2=a21_0x5d30d2,_0x1f41f9={};_0x1f41f9['kYEQf']=_0x2f94e2(0x190),_0x1f41f9[_0x2f94e2(0x181)]='string',_0x1f41f9[_0x2f94e2(0x16c)]=_0x2f94e2(0x195),_0x1f41f9[_0x2f94e2(0x16a)]='boolean',_0x1f41f9['dBGZl']=_0x2f94e2(0x186);const _0x8fae79=_0x1f41f9,_0x1748d5={};_0x1748d5[_0x2f94e2(0x168)]=_0x8fae79[_0x2f94e2(0x1a8)],_0x1748d5['type']=_0x8fae79['nyrAk'];const _0x1bea75={};_0x1bea75[_0x2f94e2(0x168)]=_0x8fae79['lSQrx'],_0x1bea75[_0x2f94e2(0x192)]=_0x8fae79[_0x2f94e2(0x16a)],_0x1bea75[_0x2f94e2(0x17c)]=![];const _0x29af2a={};return _0x29af2a[_0x2f94e2(0x19b)]=_0x1748d5,_0x29af2a['skip-tls-cert-verify']=_0x1bea75,_0x29f332[_0x2f94e2(0x1b7)](HELP_HEADER_MESSAGE[_0x2f94e2(0x1ae)])[_0x2f94e2(0x177)](HELP_FOOTER_MESSAGE)[_0x2f94e2(0x184)](_0x29af2a)[_0x2f94e2(0x186)](_0x8fae79['dBGZl'])[_0x2f94e2(0x169)];},exports[a21_0x5d30d2(0x16e)]=async function(_0x2aaf59){const _0x511517=a21_0x5d30d2,_0x34e23e={'goZCe':_0x511517(0x18c),'KWkvo':function(_0x941f6d){return _0x941f6d();},'UnMFa':'Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','CtbOq':function(_0x1d0da3,_0x4fd11b,_0xf31d70,_0x4b1415,_0x274041,_0x5acc5a,_0x38bb26){return _0x1d0da3(_0x4fd11b,_0xf31d70,_0x4b1415,_0x274041,_0x5acc5a,_0x38bb26);},'JCSIZ':_0x511517(0x167),'gajGR':'init-not-called','zwMMO':_0x511517(0x1b4),'crWWe':_0x511517(0x160),'RluQV':'Adding\x20Websocket\x20listeners','MFwXc':function(_0xb7788b,_0x3854f2,_0x15e9db,_0x5a33f8){return _0xb7788b(_0x3854f2,_0x15e9db,_0x5a33f8);},'LqTgu':function(_0x4cbeee,_0x25e4d3,_0x2884b6,_0x253a40,_0xd71e87,_0x4d09d7,_0x145b68){return _0x4cbeee(_0x25e4d3,_0x2884b6,_0x253a40,_0xd71e87,_0x4d09d7,_0x145b68);},'PvIvr':function(_0x30b2ed,_0x2ce927,_0x26c283){return _0x30b2ed(_0x2ce927,_0x26c283);},'IsKTx':function(_0x54872f,_0x4778f4,_0x241ea4){return _0x54872f(_0x4778f4,_0x241ea4);},'gbbSX':'Grid\x20stoppped.','mndmI':function(_0x2ac890,_0x478642){return _0x2ac890===_0x478642;},'XKttA':'Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','WbRFh':function(_0x4290bf,_0x1e7793,_0x18efe2,_0x11b77e,_0x16366f,_0x40ccc1,_0x21d716){return _0x4290bf(_0x1e7793,_0x18efe2,_0x11b77e,_0x16366f,_0x40ccc1,_0x21d716);},'GiUkH':_0x511517(0x163),'eDmNd':function(_0x36db52,_0x1d7f20,_0x38e7a1,_0x23b4a6,_0x291c7e,_0x527706,_0xa3607a){return _0x36db52(_0x1d7f20,_0x38e7a1,_0x23b4a6,_0x291c7e,_0x527706,_0xa3607a);},'unzsK':_0x511517(0x19f),'MayQh':'server-error'};let _0x8ab08c;try{!_0x2aaf59[_0x511517(0x197)]&&(logger[_0x511517(0x16d)](_0x34e23e[_0x511517(0x174)]),process[_0x511517(0x175)](0x1));!fs[_0x511517(0x1ac)](_0x34e23e[_0x511517(0x1b2)](getCredentialsPath))&&(logger[_0x511517(0x16d)](_0x34e23e[_0x511517(0x172)]),await _0x34e23e['CtbOq'](sendInstrumentationEvent,_0x2aaf59,_0x34e23e['JCSIZ'],messageTypes['ERROR'],_0x34e23e[_0x511517(0x19a)],null,_0x2aaf59),process[_0x511517(0x175)](0x1));logger[_0x511517(0x18d)]('Stopping\x20grid\x20'+_0x2aaf59[_0x511517(0x197)]),await _0x34e23e[_0x511517(0x180)](sendInstrumentationEvent,_0x2aaf59,_0x34e23e[_0x511517(0x166)],messageTypes[_0x511517(0x19c)],null,null,_0x2aaf59);const _0x245552=JSON[_0x511517(0x188)](fs['readFileSync'](_0x34e23e['KWkvo'](getCredentialsPath)));global_registry[_0x511517(0x1b0)]=_0x245552[_0x511517(0x1a2)][_0x511517(0x1b5)],global_registry[_0x511517(0x17a)]=_0x245552[_0x511517(0x1a2)]['password'];const _0x3aba5b=WS_ENDPOINT[_0x511517(0x199)](_0x34e23e[_0x511517(0x170)],_0x245552['Browserstack']['username'])[_0x511517(0x199)](_0x34e23e[_0x511517(0x18b)],_0x245552[_0x511517(0x1a2)]['password']),_0x522817={};_0x522817['WebSocket']=ws,_0x522817[_0x511517(0x1a5)]=0x36ee80,_0x8ab08c=new ReconnectingWebSocket(_0x3aba5b,[],_0x522817),logger[_0x511517(0x18e)](_0x34e23e[_0x511517(0x164)]),webSocketUtils['addListeners'](_0x8ab08c,_0x2aaf59['user'],_0x2aaf59[_0x511517(0x194)]);const [_0x4d7f12,_0x24b615]=await _0x34e23e[_0x511517(0x196)](getGridDetails,_0x245552[_0x511517(0x1a2)][_0x511517(0x1b5)],_0x245552[_0x511517(0x1a2)][_0x511517(0x194)],_0x2aaf59[_0x511517(0x197)]);if(_0x24b615){const _0x56beec=_0x24b615[_0x511517(0x18d)];global_registry[_0x511517(0x165)]=_0x56beec[_0x511517(0x165)],global_registry[_0x511517(0x1a9)]=_0x56beec[_0x511517(0x1a0)],global_registry[_0x511517(0x1b6)]=_0x56beec[_0x511517(0x1b6)];const _0x25b972=await _0x34e23e[_0x511517(0x17f)](getCloudProviderObject,_0x56beec[_0x511517(0x165)],_0x56beec[_0x511517(0x1b6)],_0x56beec[_0x511517(0x171)],_0x8ab08c,webSocketUtils,_0x2aaf59),[_0x4fc06a,_0x1bb96e,_0x355741,_0x16614b,_0x21e2c3,_0x5239b4]=await _0x34e23e[_0x511517(0x178)](createK8sClient,_0x25b972,_0x2aaf59[_0x511517(0x1ad)]);await _0x34e23e[_0x511517(0x1a4)](scaleDownHubDeployment,_0x1bb96e,_0x56beec[_0x511517(0x171)]),logger['info'](_0x34e23e[_0x511517(0x179)]),process[_0x511517(0x175)](0x0);}_0x34e23e['mndmI'](_0x4d7f12[_0x511517(0x1a6)],0x191)&&(logger[_0x511517(0x16d)](_0x34e23e[_0x511517(0x17b)]),await _0x34e23e[_0x511517(0x161)](sendInstrumentationEvent,_0x2aaf59,_0x34e23e[_0x511517(0x166)],messageTypes[_0x511517(0x189)],_0x34e23e[_0x511517(0x1aa)],null,_0x2aaf59),process[_0x511517(0x175)](0x1)),_0x34e23e['mndmI'](_0x4d7f12['statusCode'],0x190)&&(logger[_0x511517(0x16d)](JSON[_0x511517(0x188)](_0x4d7f12[_0x511517(0x19d)])['message']),await _0x34e23e[_0x511517(0x1ab)](sendInstrumentationEvent,_0x2aaf59,_0x34e23e[_0x511517(0x166)],messageTypes['ERROR'],_0x34e23e['unzsK'],null,_0x2aaf59),process[_0x511517(0x175)](0x1)),logger['error']('Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20'+JSON[_0x511517(0x162)](_0x4d7f12)),await _0x34e23e['eDmNd'](sendInstrumentationEvent,_0x2aaf59,_0x34e23e[_0x511517(0x166)],messageTypes[_0x511517(0x189)],_0x34e23e[_0x511517(0x1b1)],_0x4d7f12,_0x2aaf59),process['exit'](0x1);}catch(_0x72abf3){const _0x485474='Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20'+_0x72abf3+'\x20\x0a'+JSON[_0x511517(0x162)](_0x72abf3[_0x511517(0x16f)])+'\x20';logger['error'](_0x485474),process[_0x511517(0x175)](0x1);}};
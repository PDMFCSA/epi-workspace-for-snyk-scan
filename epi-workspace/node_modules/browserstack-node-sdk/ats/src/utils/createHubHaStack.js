const a28_0x26de8a=a28_0x69a4;(function(_0x296df1,_0x21b5fe){const _0x31fff5=a28_0x69a4,_0x4075e8=_0x296df1();while(!![]){try{const _0x3abf3f=-parseInt(_0x31fff5(0xd5))/0x1+-parseInt(_0x31fff5(0xc7))/0x2+-parseInt(_0x31fff5(0xd7))/0x3*(-parseInt(_0x31fff5(0xc0))/0x4)+parseInt(_0x31fff5(0xbb))/0x5+-parseInt(_0x31fff5(0xc6))/0x6+parseInt(_0x31fff5(0xbe))/0x7*(parseInt(_0x31fff5(0xca))/0x8)+parseInt(_0x31fff5(0xc2))/0x9;if(_0x3abf3f===_0x21b5fe)break;else _0x4075e8['push'](_0x4075e8['shift']());}catch(_0x1db57d){_0x4075e8['push'](_0x4075e8['shift']());}}}(a28_0x152e,0x7a958));const fs=require('fs'),path=require('path'),Promise=require(a28_0x26de8a(0xba)),yaml=require(a28_0x26de8a(0xce)),{CLOUDFORMATION_SCHEMA}=require(a28_0x26de8a(0xa2)),AWS=require('./AWSUtils')[a28_0x26de8a(0xae)],AWSUtils=require(a28_0x26de8a(0xd1)),{CLUSTER_HUB_HA_STACK_NAME,COMMON_HST_TAGS}=require('../config/constants'),{logger}=require(a28_0x26de8a(0xd6));Promise[a28_0x26de8a(0xc9)](fs);function a28_0x69a4(_0xb20722,_0x1c6336){const _0x152e0b=a28_0x152e();return a28_0x69a4=function(_0x69a4ef,_0x101a3f){_0x69a4ef=_0x69a4ef-0xa0;let _0x7bd300=_0x152e0b[_0x69a4ef];return _0x7bd300;},a28_0x69a4(_0xb20722,_0x1c6336);}function a28_0x152e(){const _0x4ef6f7=['createStack','join','CloudFormation','4946100lAYSAK','492904rBnXcy','Value','promisifyAll','1316424sgjDaT','YlNEV','StackId','CAPABILITY_NAMED_IAM','js-yaml','promise','readFileAsync','./AWSUtils','utf-8','stackCreateComplete','OozqE','752518HQccsG','../config/logger','186999yBySTa','info','-cf','js-yaml-cloudformation-schema','StackName','rwNhs','vyfKz','push','valueOf','Drneb','Waiting\x20for\x20CloudFormation\x20stack\x20to\x20complete','LnNyQ','://','Tags','Parameters','awsObj','Properties','schema','2010-05-15','MrJnv','waitFor','apiVersion','pUtvE','TemplateBody','split','Resources','CFTemplates','bluebird','3329155jUaqVR','lQJTp','BaseResourceName','28hXRtEG','DELETE','64utFqqX','getOidcUrl','36477xWTTOq'];a28_0x152e=function(){return _0x4ef6f7;};return a28_0x152e();}const addTags=async(_0x4a45b3,_0x56215e)=>{const _0x46430f=a28_0x26de8a;for(const _0x52a469 in _0x4a45b3[_0x46430f(0xb8)]){_0x4a45b3['Resources'][_0x52a469]['Properties']&&_0x4a45b3['Resources'][_0x52a469][_0x46430f(0xaf)][_0x46430f(0xac)]&&_0x4a45b3[_0x46430f(0xb8)][_0x52a469][_0x46430f(0xaf)]['Tags']['push'](..._0x56215e);}};exports['createHubHaStack']=async(_0x51558d,_0x9206eb=null)=>{const _0x3d0100=a28_0x26de8a,_0x19b7d5={'OozqE':'browserstack:cluster','LnNyQ':'browserstack:creationDate','pUtvE':_0x3d0100(0xb1),'FUlKy':_0x3d0100(0xb9),'QkjhU':'hub-ha.yaml','vyfKz':_0x3d0100(0xd2),'lQJTp':function(_0xd5fe8e,_0x429291,_0x5654db){return _0xd5fe8e(_0x429291,_0x5654db);},'USjUC':_0x3d0100(0xab),'MrJnv':_0x3d0100(0xbf),'fkmTL':'VpcId','Drneb':_0x3d0100(0xbd),'tGsQZ':'ClusterOIDCURL','rwNhs':_0x3d0100(0xcd),'YlNEV':_0x3d0100(0xa9),'LwpmG':_0x3d0100(0xd3)},_0x13d68b=COMMON_HST_TAGS,_0x18dd30={};_0x18dd30['Key']=_0x19b7d5[_0x3d0100(0xd4)],_0x18dd30[_0x3d0100(0xc8)]=_0x51558d,_0x13d68b[_0x3d0100(0xa6)](_0x18dd30),_0x13d68b[_0x3d0100(0xa6)]({'Key':_0x19b7d5[_0x3d0100(0xaa)],'Value':new Date()[_0x3d0100(0xa7)]()['toString']()});const _0x3fb6e6={};_0x3fb6e6[_0x3d0100(0xb4)]=_0x19b7d5[_0x3d0100(0xb5)];const _0x4f508e=new AWS[(_0x3d0100(0xc5))](_0x3fb6e6),_0x3aa34a=await fs[_0x3d0100(0xd0)](path[_0x3d0100(0xc4)](__dirname,'..',_0x19b7d5['FUlKy'],_0x19b7d5['QkjhU']),_0x19b7d5[_0x3d0100(0xa5)]),_0x4fc67a={};_0x4fc67a[_0x3d0100(0xb0)]=CLOUDFORMATION_SCHEMA;const _0x1f91e0=yaml['load'](_0x3aa34a,_0x4fc67a);await _0x19b7d5[_0x3d0100(0xbc)](addTags,_0x1f91e0,_0x13d68b);const _0x1552ef=JSON['stringify'](_0x1f91e0);let _0x39525b=await AWSUtils[_0x3d0100(0xc1)](_0x51558d);_0x39525b=_0x39525b[_0x3d0100(0xb7)](_0x19b7d5['USjUC'])[0x1];const _0x5538df={};_0x5538df['StackName']=CLUSTER_HUB_HA_STACK_NAME+'-'+_0x51558d+_0x3d0100(0xa1),_0x5538df['OnFailure']=_0x19b7d5[_0x3d0100(0xb2)],_0x5538df[_0x3d0100(0xb6)]=_0x1552ef,_0x5538df[_0x3d0100(0xad)]=[{'ParameterKey':_0x19b7d5['fkmTL'],'ParameterValue':_0x9206eb},{'ParameterKey':_0x19b7d5[_0x3d0100(0xa8)],'ParameterValue':CLUSTER_HUB_HA_STACK_NAME+'-'+_0x51558d},{'ParameterKey':_0x19b7d5['tGsQZ'],'ParameterValue':_0x39525b}],_0x5538df['Capabilities']=[_0x19b7d5[_0x3d0100(0xa4)]],_0x5538df[_0x3d0100(0xac)]=_0x13d68b;const _0x1ce3c8=_0x5538df,_0x392c95=await _0x4f508e[_0x3d0100(0xc3)](_0x1ce3c8)[_0x3d0100(0xcf)]();logger[_0x3d0100(0xa0)](_0x19b7d5[_0x3d0100(0xcb)]);const _0x2c516e={};return _0x2c516e[_0x3d0100(0xa3)]=_0x392c95[_0x3d0100(0xcc)],_0x4f508e[_0x3d0100(0xb3)](_0x19b7d5['LwpmG'],_0x2c516e)['promise']();};
const a28_0x4968d5=a28_0x3fd1;(function(_0x1c56e1,_0x37ad2d){const _0x4974e4=a28_0x3fd1,_0x17e483=_0x1c56e1();while(!![]){try{const _0x1a2b24=-parseInt(_0x4974e4(0xf6))/0x1*(parseInt(_0x4974e4(0x114))/0x2)+parseInt(_0x4974e4(0x103))/0x3+-parseInt(_0x4974e4(0x10f))/0x4*(parseInt(_0x4974e4(0x10b))/0x5)+-parseInt(_0x4974e4(0xfd))/0x6+-parseInt(_0x4974e4(0xfa))/0x7*(parseInt(_0x4974e4(0xf8))/0x8)+parseInt(_0x4974e4(0xe7))/0x9*(-parseInt(_0x4974e4(0xec))/0xa)+parseInt(_0x4974e4(0xf3))/0xb;if(_0x1a2b24===_0x37ad2d)break;else _0x17e483['push'](_0x17e483['shift']());}catch(_0x23648b){_0x17e483['push'](_0x17e483['shift']());}}}(a28_0x5557,0xb6756));const fs=require('fs'),path=require(a28_0x4968d5(0x109)),Promise=require(a28_0x4968d5(0xeb)),yaml=require('js-yaml'),{CLOUDFORMATION_SCHEMA}=require(a28_0x4968d5(0x113)),AWS=require(a28_0x4968d5(0xed))[a28_0x4968d5(0x10d)],AWSUtils=require(a28_0x4968d5(0xed)),{CLUSTER_HUB_HA_STACK_NAME,COMMON_HST_TAGS}=require('../config/constants'),{logger}=require('../config/logger');Promise[a28_0x4968d5(0x117)](fs);const addTags=async(_0x168c4a,_0x2d0bf6)=>{const _0x5693c6=a28_0x4968d5;for(const _0x232aec in _0x168c4a[_0x5693c6(0xfc)]){_0x168c4a[_0x5693c6(0xfc)][_0x232aec][_0x5693c6(0xf9)]&&_0x168c4a[_0x5693c6(0xfc)][_0x232aec]['Properties'][_0x5693c6(0xe4)]&&_0x168c4a['Resources'][_0x232aec][_0x5693c6(0xf9)][_0x5693c6(0xe4)][_0x5693c6(0x108)](..._0x2d0bf6);}};exports['createHubHaStack']=async(_0x50efba,_0x606b41=null)=>{const _0x32e269=a28_0x4968d5,_0x4bf573={'owHqB':'browserstack:cluster','PTXpu':'browserstack:creationDate','EXZmw':_0x32e269(0xf5),'hPOUM':_0x32e269(0xe9),'QtAiq':_0x32e269(0x100),'HdSuf':_0x32e269(0xfe),'pmFAo':function(_0x240a10,_0x154aa0,_0x5ac688){return _0x240a10(_0x154aa0,_0x5ac688);},'CncNW':'://','iDFau':'DELETE','EDRNZ':_0x32e269(0x106),'wvIzs':_0x32e269(0x10a),'rcqUt':'ClusterOIDCURL','ZDXxI':'CAPABILITY_NAMED_IAM','xVDrT':_0x32e269(0xf1),'jQAzY':_0x32e269(0x118)},_0x98eddd=COMMON_HST_TAGS,_0x386433={};_0x386433[_0x32e269(0x105)]=_0x4bf573[_0x32e269(0xe8)],_0x386433[_0x32e269(0x116)]=_0x50efba,_0x98eddd[_0x32e269(0x108)](_0x386433),_0x98eddd['push']({'Key':_0x4bf573['PTXpu'],'Value':new Date()[_0x32e269(0xe1)]()[_0x32e269(0xe0)]()});const _0x5dfeef={};_0x5dfeef['apiVersion']=_0x4bf573[_0x32e269(0xf4)];const _0x70084a=new AWS[(_0x32e269(0xf2))](_0x5dfeef),_0x5898af=await fs['readFileAsync'](path[_0x32e269(0x101)](__dirname,'..',_0x4bf573['hPOUM'],_0x4bf573[_0x32e269(0x107)]),_0x4bf573[_0x32e269(0xef)]),_0x3a6969={};_0x3a6969['schema']=CLOUDFORMATION_SCHEMA;const _0x529541=yaml[_0x32e269(0x115)](_0x5898af,_0x3a6969);await _0x4bf573[_0x32e269(0xe2)](addTags,_0x529541,_0x98eddd);const _0x447a3a=JSON[_0x32e269(0xe5)](_0x529541);let _0x7e547=await AWSUtils[_0x32e269(0x110)](_0x50efba);_0x7e547=_0x7e547[_0x32e269(0xea)](_0x4bf573['CncNW'])[0x1];const _0x1f962c={};_0x1f962c[_0x32e269(0xe3)]=CLUSTER_HUB_HA_STACK_NAME+'-'+_0x50efba+_0x32e269(0x104),_0x1f962c[_0x32e269(0x102)]=_0x4bf573[_0x32e269(0x111)],_0x1f962c[_0x32e269(0xdf)]=_0x447a3a,_0x1f962c['Parameters']=[{'ParameterKey':_0x4bf573['EDRNZ'],'ParameterValue':_0x606b41},{'ParameterKey':_0x4bf573[_0x32e269(0xf7)],'ParameterValue':CLUSTER_HUB_HA_STACK_NAME+'-'+_0x50efba},{'ParameterKey':_0x4bf573[_0x32e269(0x10e)],'ParameterValue':_0x7e547}],_0x1f962c[_0x32e269(0x112)]=[_0x4bf573['ZDXxI']],_0x1f962c[_0x32e269(0xe4)]=_0x98eddd;const _0x3d4703=_0x1f962c,_0x3ea608=await _0x70084a[_0x32e269(0x10c)](_0x3d4703)[_0x32e269(0xfb)]();logger[_0x32e269(0xff)](_0x4bf573[_0x32e269(0xe6)]);const _0x53c6f9={};return _0x53c6f9[_0x32e269(0xe3)]=_0x3ea608[_0x32e269(0xf0)],_0x70084a[_0x32e269(0xee)](_0x4bf573[_0x32e269(0x119)],_0x53c6f9)[_0x32e269(0xfb)]();};function a28_0x3fd1(_0x3feeb2,_0x5b811f){const _0x55577b=a28_0x5557();return a28_0x3fd1=function(_0x3fd183,_0x473946){_0x3fd183=_0x3fd183-0xdf;let _0x28596a=_0x55577b[_0x3fd183];return _0x28596a;},a28_0x3fd1(_0x3feeb2,_0x5b811f);}function a28_0x5557(){const _0x73fde0=['utf-8','info','hub-ha.yaml','join','OnFailure','1561617mvvcin','-cf','Key','VpcId','QtAiq','push','path','BaseResourceName','25490cssWzb','createStack','awsObj','rcqUt','148eEdwzW','getOidcUrl','iDFau','Capabilities','js-yaml-cloudformation-schema','3752VHwbdE','load','Value','promisifyAll','stackCreateComplete','jQAzY','TemplateBody','toString','valueOf','pmFAo','StackName','Tags','stringify','xVDrT','9RZfFjq','owHqB','CFTemplates','split','bluebird','13263700xUtENp','./AWSUtils','waitFor','HdSuf','StackId','Waiting\x20for\x20CloudFormation\x20stack\x20to\x20complete','CloudFormation','48632034jzpfyK','EXZmw','2010-05-15','311EDtYdM','wvIzs','330120wmVugS','Properties','105BeHUpP','promise','Resources','8861256EFmkdm'];a28_0x5557=function(){return _0x73fde0;};return a28_0x5557();}
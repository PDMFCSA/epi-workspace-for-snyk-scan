const a28_0x7d3a61=a28_0x3294;(function(_0x257660,_0x9fbf0f){const _0x55a3b0=a28_0x3294,_0x367187=_0x257660();while(!![]){try{const _0x233322=-parseInt(_0x55a3b0(0xa1))/0x1*(parseInt(_0x55a3b0(0x91))/0x2)+parseInt(_0x55a3b0(0xb0))/0x3+-parseInt(_0x55a3b0(0x9a))/0x4+parseInt(_0x55a3b0(0x7a))/0x5*(parseInt(_0x55a3b0(0xac))/0x6)+parseInt(_0x55a3b0(0x8b))/0x7*(parseInt(_0x55a3b0(0x79))/0x8)+-parseInt(_0x55a3b0(0xae))/0x9*(-parseInt(_0x55a3b0(0x8f))/0xa)+-parseInt(_0x55a3b0(0xa7))/0xb*(parseInt(_0x55a3b0(0x83))/0xc);if(_0x233322===_0x9fbf0f)break;else _0x367187['push'](_0x367187['shift']());}catch(_0x7f6d60){_0x367187['push'](_0x367187['shift']());}}}(a28_0xe6b2,0x338bd));function a28_0x3294(_0x270166,_0x3957cb){const _0xe6b228=a28_0xe6b2();return a28_0x3294=function(_0x3294c3,_0x28eebc){_0x3294c3=_0x3294c3-0x76;let _0x62d148=_0xe6b228[_0x3294c3];return _0x62d148;},a28_0x3294(_0x270166,_0x3957cb);}const fs=require('fs'),path=require('path'),Promise=require(a28_0x7d3a61(0x7b)),yaml=require(a28_0x7d3a61(0x8c)),{CLOUDFORMATION_SCHEMA}=require(a28_0x7d3a61(0xb6)),AWS=require('./AWSUtils')[a28_0x7d3a61(0xa4)],AWSUtils=require('./AWSUtils'),{CLUSTER_HUB_HA_STACK_NAME,COMMON_HST_TAGS}=require('../config/constants'),{logger}=require(a28_0x7d3a61(0x7f));Promise['promisifyAll'](fs);function a28_0xe6b2(){const _0x451fb0=['Tags','CloudFormation','xTbri','mqmQs','readFileAsync','promise','OnFailure','1519GyYAFY','js-yaml','split','load','3590jVbXBc','ClusterOIDCURL','2QEQUTJ','hub-ha.yaml','browserstack:creationDate','schema','Waiting\x20for\x20CloudFormation\x20stack\x20to\x20complete','Resources','join','BjqQs','CAPABILITY_NAMED_IAM','1457504SrUhxP','createStack','://','pluog','ctfjj','Capabilities','DELETE','170755LDhRgk','Value','YUzNU','awsObj','hKuHk','-cf','1396901vlqKXS','waitFor','utf-8','uuxMC','Parameters','9666jlaIDD','toString','10035NmRzmU','info','57234Aqymmy','tJioU','LWgsa','2010-05-15','TemplateBody','rsGYq','js-yaml-cloudformation-schema','createHubHaStack','StackId','stackCreateComplete','10616tcbBBJ','515gtMhCR','bluebird','dciPw','push','BaseResourceName','../config/logger','StackName','browserstack:cluster','Impyh','12gKKWjk'];a28_0xe6b2=function(){return _0x451fb0;};return a28_0xe6b2();}const addTags=async(_0x37de25,_0x3d7bc7)=>{const _0x1d529a=a28_0x7d3a61;for(const _0x5034ef in _0x37de25['Resources']){_0x37de25['Resources'][_0x5034ef]['Properties']&&_0x37de25[_0x1d529a(0x96)][_0x5034ef]['Properties']['Tags']&&_0x37de25[_0x1d529a(0x96)][_0x5034ef]['Properties'][_0x1d529a(0x84)][_0x1d529a(0x7d)](..._0x3d7bc7);}};exports[a28_0x7d3a61(0x76)]=async(_0x1b4712,_0x39b6ff=null)=>{const _0x5c8c23=a28_0x7d3a61,_0x3bddc6={'dciPw':_0x5c8c23(0x81),'pluog':_0x5c8c23(0x93),'Impyh':_0x5c8c23(0xb3),'LWgsa':'CFTemplates','uuxMC':_0x5c8c23(0x92),'hKuHk':_0x5c8c23(0xa9),'xTbri':function(_0x4133e2,_0x1eb85d,_0xda2a5){return _0x4133e2(_0x1eb85d,_0xda2a5);},'mqmQs':_0x5c8c23(0x9c),'tJioU':_0x5c8c23(0xa0),'eKzme':'VpcId','BjqQs':_0x5c8c23(0x7e),'YUzNU':_0x5c8c23(0x90),'jndTE':_0x5c8c23(0x99),'rsGYq':_0x5c8c23(0x95),'ctfjj':_0x5c8c23(0x78)},_0x3047eb=COMMON_HST_TAGS,_0x3ade48={};_0x3ade48['Key']=_0x3bddc6[_0x5c8c23(0x7c)],_0x3ade48[_0x5c8c23(0xa2)]=_0x1b4712,_0x3047eb[_0x5c8c23(0x7d)](_0x3ade48),_0x3047eb[_0x5c8c23(0x7d)]({'Key':_0x3bddc6[_0x5c8c23(0x9d)],'Value':new Date()['valueOf']()[_0x5c8c23(0xad)]()});const _0xf420b7={};_0xf420b7['apiVersion']=_0x3bddc6[_0x5c8c23(0x82)];const _0x507f32=new AWS[(_0x5c8c23(0x85))](_0xf420b7),_0x487159=await fs[_0x5c8c23(0x88)](path[_0x5c8c23(0x97)](__dirname,'..',_0x3bddc6[_0x5c8c23(0xb2)],_0x3bddc6[_0x5c8c23(0xaa)]),_0x3bddc6[_0x5c8c23(0xa5)]),_0x53c513={};_0x53c513[_0x5c8c23(0x94)]=CLOUDFORMATION_SCHEMA;const _0x5a4d02=yaml[_0x5c8c23(0x8e)](_0x487159,_0x53c513);await _0x3bddc6[_0x5c8c23(0x86)](addTags,_0x5a4d02,_0x3047eb);const _0x187a0e=JSON['stringify'](_0x5a4d02);let _0x3ec1a8=await AWSUtils['getOidcUrl'](_0x1b4712);_0x3ec1a8=_0x3ec1a8[_0x5c8c23(0x8d)](_0x3bddc6[_0x5c8c23(0x87)])[0x1];const _0x540467={};_0x540467[_0x5c8c23(0x80)]=CLUSTER_HUB_HA_STACK_NAME+'-'+_0x1b4712+_0x5c8c23(0xa6),_0x540467[_0x5c8c23(0x8a)]=_0x3bddc6[_0x5c8c23(0xb1)],_0x540467[_0x5c8c23(0xb4)]=_0x187a0e,_0x540467[_0x5c8c23(0xab)]=[{'ParameterKey':_0x3bddc6['eKzme'],'ParameterValue':_0x39b6ff},{'ParameterKey':_0x3bddc6[_0x5c8c23(0x98)],'ParameterValue':CLUSTER_HUB_HA_STACK_NAME+'-'+_0x1b4712},{'ParameterKey':_0x3bddc6[_0x5c8c23(0xa3)],'ParameterValue':_0x3ec1a8}],_0x540467[_0x5c8c23(0x9f)]=[_0x3bddc6['jndTE']],_0x540467[_0x5c8c23(0x84)]=_0x3047eb;const _0x46a303=_0x540467,_0x42226a=await _0x507f32[_0x5c8c23(0x9b)](_0x46a303)['promise']();logger[_0x5c8c23(0xaf)](_0x3bddc6[_0x5c8c23(0xb5)]);const _0x2bd526={};return _0x2bd526[_0x5c8c23(0x80)]=_0x42226a[_0x5c8c23(0x77)],_0x507f32[_0x5c8c23(0xa8)](_0x3bddc6[_0x5c8c23(0x9e)],_0x2bd526)[_0x5c8c23(0x89)]();};
const a28_0x28f2fa=a28_0x585f;function a28_0x58e4(){const _0xfb98c6=['CZbNf','createHubHaStack','browserstack:creationDate','Resources','push','34MZNQzZ','Tags','Waiting\x20for\x20CloudFormation\x20stack\x20to\x20complete','StackName','196347dmZKPp','92286BwzuEh','FIQrh','3778860GOipye','GRuiW','js-yaml','MDOTV','join','Parameters','709708rOrECQ','TemplateBody','split','valueOf','rbBBy','createStack','Key','-cf','yWxky','MwNOe','5066810ZdigNb','QYtLY','Properties','2592WXCtwl','hub-ha.yaml','bluebird','CFTemplates','Capabilities','CAPABILITY_NAMED_IAM','schema','js-yaml-cloudformation-schema','GCKOZ','./AWSUtils','ClusterOIDCURL','Value','DELETE','OnFailure','awsObj','CloudFormation','58560yOmlwR','path','promisifyAll','NGjiI','load','VpcId','5YKtOmi','utf-8','waitFor','readFileAsync','../config/constants','promise','hgSAm','2010-05-15'];a28_0x58e4=function(){return _0xfb98c6;};return a28_0x58e4();}(function(_0x49a57c,_0x4996ad){const _0x43c05d=a28_0x585f,_0x3d3689=_0x49a57c();while(!![]){try{const _0x10d643=-parseInt(_0x43c05d(0x19b))/0x1+parseInt(_0x43c05d(0x181))/0x2*(parseInt(_0x43c05d(0x185))/0x3)+-parseInt(_0x43c05d(0x18e))/0x4*(parseInt(_0x43c05d(0x1b1))/0x5)+parseInt(_0x43c05d(0x188))/0x6+-parseInt(_0x43c05d(0x198))/0x7+parseInt(_0x43c05d(0x1ab))/0x8+-parseInt(_0x43c05d(0x186))/0x9;if(_0x10d643===_0x4996ad)break;else _0x3d3689['push'](_0x3d3689['shift']());}catch(_0x298fc6){_0x3d3689['push'](_0x3d3689['shift']());}}}(a28_0x58e4,0xcc04c));const fs=require('fs'),path=require(a28_0x28f2fa(0x1ac)),Promise=require(a28_0x28f2fa(0x19d)),yaml=require(a28_0x28f2fa(0x18a)),{CLOUDFORMATION_SCHEMA}=require(a28_0x28f2fa(0x1a2)),AWS=require(a28_0x28f2fa(0x1a4))[a28_0x28f2fa(0x1a9)],AWSUtils=require(a28_0x28f2fa(0x1a4)),{CLUSTER_HUB_HA_STACK_NAME,COMMON_HST_TAGS}=require(a28_0x28f2fa(0x178)),{logger}=require('../config/logger');Promise[a28_0x28f2fa(0x1ad)](fs);const addTags=async(_0x56f5ba,_0x38fc72)=>{const _0x396b06=a28_0x28f2fa;for(const _0xf2a48 in _0x56f5ba['Resources']){_0x56f5ba['Resources'][_0xf2a48]['Properties']&&_0x56f5ba[_0x396b06(0x17f)][_0xf2a48][_0x396b06(0x19a)][_0x396b06(0x182)]&&_0x56f5ba[_0x396b06(0x17f)][_0xf2a48][_0x396b06(0x19a)][_0x396b06(0x182)][_0x396b06(0x180)](..._0x38fc72);}};function a28_0x585f(_0x4d5167,_0x205b2f){const _0x58e433=a28_0x58e4();return a28_0x585f=function(_0x585f1b,_0x4e0353){_0x585f1b=_0x585f1b-0x177;let _0x17bd68=_0x58e433[_0x585f1b];return _0x17bd68;},a28_0x585f(_0x4d5167,_0x205b2f);}exports[a28_0x28f2fa(0x17d)]=async(_0x138199,_0x19897c=null)=>{const _0x1e2114=a28_0x28f2fa,_0x350f5f={'QYtLY':'browserstack:cluster','rbBBy':_0x1e2114(0x17e),'GCKOZ':_0x1e2114(0x17b),'EVMoM':_0x1e2114(0x19e),'qnKhh':_0x1e2114(0x19c),'GRuiW':_0x1e2114(0x1b2),'yWxky':function(_0x3fad58,_0x257d0a,_0x226242){return _0x3fad58(_0x257d0a,_0x226242);},'FIQrh':'://','ENfna':_0x1e2114(0x1a7),'CZbNf':_0x1e2114(0x1b0),'MwNOe':'BaseResourceName','hgSAm':_0x1e2114(0x1a5),'MDOTV':_0x1e2114(0x1a0),'NGjiI':_0x1e2114(0x183),'myDei':'stackCreateComplete'},_0xefada7=COMMON_HST_TAGS,_0x289742={};_0x289742[_0x1e2114(0x194)]=_0x350f5f[_0x1e2114(0x199)],_0x289742[_0x1e2114(0x1a6)]=_0x138199,_0xefada7[_0x1e2114(0x180)](_0x289742),_0xefada7[_0x1e2114(0x180)]({'Key':_0x350f5f[_0x1e2114(0x192)],'Value':new Date()[_0x1e2114(0x191)]()['toString']()});const _0x3d61ef={};_0x3d61ef['apiVersion']=_0x350f5f[_0x1e2114(0x1a3)];const _0xff7a91=new AWS[(_0x1e2114(0x1aa))](_0x3d61ef),_0x2f6bf0=await fs[_0x1e2114(0x177)](path[_0x1e2114(0x18c)](__dirname,'..',_0x350f5f['EVMoM'],_0x350f5f['qnKhh']),_0x350f5f[_0x1e2114(0x189)]),_0x4b2492={};_0x4b2492[_0x1e2114(0x1a1)]=CLOUDFORMATION_SCHEMA;const _0x3d4844=yaml[_0x1e2114(0x1af)](_0x2f6bf0,_0x4b2492);await _0x350f5f[_0x1e2114(0x196)](addTags,_0x3d4844,_0xefada7);const _0x33bdad=JSON['stringify'](_0x3d4844);let _0x201d8f=await AWSUtils['getOidcUrl'](_0x138199);_0x201d8f=_0x201d8f[_0x1e2114(0x190)](_0x350f5f[_0x1e2114(0x187)])[0x1];const _0x3aae1c={};_0x3aae1c[_0x1e2114(0x184)]=CLUSTER_HUB_HA_STACK_NAME+'-'+_0x138199+_0x1e2114(0x195),_0x3aae1c[_0x1e2114(0x1a8)]=_0x350f5f['ENfna'],_0x3aae1c[_0x1e2114(0x18f)]=_0x33bdad,_0x3aae1c[_0x1e2114(0x18d)]=[{'ParameterKey':_0x350f5f[_0x1e2114(0x17c)],'ParameterValue':_0x19897c},{'ParameterKey':_0x350f5f[_0x1e2114(0x197)],'ParameterValue':CLUSTER_HUB_HA_STACK_NAME+'-'+_0x138199},{'ParameterKey':_0x350f5f[_0x1e2114(0x17a)],'ParameterValue':_0x201d8f}],_0x3aae1c[_0x1e2114(0x19f)]=[_0x350f5f[_0x1e2114(0x18b)]],_0x3aae1c[_0x1e2114(0x182)]=_0xefada7;const _0x2689a6=_0x3aae1c,_0x4d36c9=await _0xff7a91[_0x1e2114(0x193)](_0x2689a6)[_0x1e2114(0x179)]();logger['info'](_0x350f5f[_0x1e2114(0x1ae)]);const _0x260fa2={};return _0x260fa2[_0x1e2114(0x184)]=_0x4d36c9['StackId'],_0xff7a91[_0x1e2114(0x1b3)](_0x350f5f['myDei'],_0x260fa2)[_0x1e2114(0x179)]();};
const a28_0x570192=a28_0x4a37;(function(_0x453e21,_0x337af9){const _0x6de372=a28_0x4a37,_0x3de3a3=_0x453e21();while(!![]){try{const _0x1da6d0=parseInt(_0x6de372(0x90))/0x1+parseInt(_0x6de372(0x6a))/0x2+-parseInt(_0x6de372(0x70))/0x3*(parseInt(_0x6de372(0x97))/0x4)+parseInt(_0x6de372(0x7d))/0x5+-parseInt(_0x6de372(0x93))/0x6*(-parseInt(_0x6de372(0x7e))/0x7)+-parseInt(_0x6de372(0x86))/0x8*(parseInt(_0x6de372(0x75))/0x9)+-parseInt(_0x6de372(0x8b))/0xa;if(_0x1da6d0===_0x337af9)break;else _0x3de3a3['push'](_0x3de3a3['shift']());}catch(_0x223792){_0x3de3a3['push'](_0x3de3a3['shift']());}}}(a28_0x1c9c,0xeafc1));const fs=require('fs'),path=require('path'),Promise=require('bluebird'),yaml=require('js-yaml'),{CLOUDFORMATION_SCHEMA}=require(a28_0x570192(0x99)),AWS=require(a28_0x570192(0x89))[a28_0x570192(0x6c)],AWSUtils=require(a28_0x570192(0x89)),{CLUSTER_HUB_HA_STACK_NAME,COMMON_HST_TAGS}=require(a28_0x570192(0x78)),{logger}=require('../config/logger');function a28_0x1c9c(){const _0x4e5f0b=['browserstack:cluster','./AWSUtils','-cf','31881100MuWuQG','Key','PUWCr','hub-ha.yaml','Capabilities','889194dCmkHW','neIyB','SBTqh','18ayDFit','sqzsI','Parameters','schema','44Pfhuvw','WNbnA','js-yaml-cloudformation-schema','apiVersion','StackName','createStack','readFileAsync','2118960CKYARR','valueOf','awsObj','promise','StackId','getOidcUrl','218301qZsNYF','split','Resources','promisifyAll','Properties','79398MqOoMr','OYyyZ','://','../config/constants','info','2010-05-15','VkfLj','VpcId','5923820vCgjRb','4405758mZjMlw','toString','fwGLj','Tags','CFTemplates','dbvuC','RfnhH','Value','64yiBJbT','OnFailure'];a28_0x1c9c=function(){return _0x4e5f0b;};return a28_0x1c9c();}function a28_0x4a37(_0x47e026,_0x4f476b){const _0x1c9c0d=a28_0x1c9c();return a28_0x4a37=function(_0x4a3706,_0x23eefe){_0x4a3706=_0x4a3706-0x6a;let _0x46f495=_0x1c9c0d[_0x4a3706];return _0x46f495;},a28_0x4a37(_0x47e026,_0x4f476b);}Promise[a28_0x570192(0x73)](fs);const addTags=async(_0x22ce70,_0x44c2e0)=>{const _0x1bd863=a28_0x570192;for(const _0x249161 in _0x22ce70['Resources']){_0x22ce70[_0x1bd863(0x72)][_0x249161]['Properties']&&_0x22ce70[_0x1bd863(0x72)][_0x249161][_0x1bd863(0x74)][_0x1bd863(0x81)]&&_0x22ce70[_0x1bd863(0x72)][_0x249161]['Properties'][_0x1bd863(0x81)]['push'](..._0x44c2e0);}};exports['createHubHaStack']=async(_0x370e05,_0x5cf3b9=null)=>{const _0x3892cd=a28_0x570192,_0x173631={'fwGLj':_0x3892cd(0x88),'WNbnA':'browserstack:creationDate','hoYgz':_0x3892cd(0x7a),'neIyB':_0x3892cd(0x82),'BOCMC':_0x3892cd(0x8e),'ZBPEv':'utf-8','RfnhH':function(_0x51d03c,_0x14ad6b,_0x5504f7){return _0x51d03c(_0x14ad6b,_0x5504f7);},'VkfLj':_0x3892cd(0x77),'SBTqh':'DELETE','dbvuC':_0x3892cd(0x7c),'sqzsI':'BaseResourceName','hkIur':'ClusterOIDCURL','OYyyZ':'CAPABILITY_NAMED_IAM','ppOEM':'Waiting\x20for\x20CloudFormation\x20stack\x20to\x20complete','PUWCr':'stackCreateComplete'},_0x2a70d8=COMMON_HST_TAGS,_0x40a0fe={};_0x40a0fe[_0x3892cd(0x8c)]=_0x173631[_0x3892cd(0x80)],_0x40a0fe[_0x3892cd(0x85)]=_0x370e05,_0x2a70d8['push'](_0x40a0fe),_0x2a70d8['push']({'Key':_0x173631[_0x3892cd(0x98)],'Value':new Date()[_0x3892cd(0x6b)]()[_0x3892cd(0x7f)]()});const _0x6d4e93={};_0x6d4e93[_0x3892cd(0x9a)]=_0x173631['hoYgz'];const _0x45d5e7=new AWS['CloudFormation'](_0x6d4e93),_0x47e687=await fs[_0x3892cd(0x9d)](path['join'](__dirname,'..',_0x173631[_0x3892cd(0x91)],_0x173631['BOCMC']),_0x173631['ZBPEv']),_0x2d9ed8={};_0x2d9ed8[_0x3892cd(0x96)]=CLOUDFORMATION_SCHEMA;const _0x31b95d=yaml['load'](_0x47e687,_0x2d9ed8);await _0x173631[_0x3892cd(0x84)](addTags,_0x31b95d,_0x2a70d8);const _0x2e0ac9=JSON['stringify'](_0x31b95d);let _0x119d5a=await AWSUtils[_0x3892cd(0x6f)](_0x370e05);_0x119d5a=_0x119d5a[_0x3892cd(0x71)](_0x173631[_0x3892cd(0x7b)])[0x1];const _0x1228c9={};_0x1228c9[_0x3892cd(0x9b)]=CLUSTER_HUB_HA_STACK_NAME+'-'+_0x370e05+_0x3892cd(0x8a),_0x1228c9[_0x3892cd(0x87)]=_0x173631[_0x3892cd(0x92)],_0x1228c9['TemplateBody']=_0x2e0ac9,_0x1228c9[_0x3892cd(0x95)]=[{'ParameterKey':_0x173631[_0x3892cd(0x83)],'ParameterValue':_0x5cf3b9},{'ParameterKey':_0x173631[_0x3892cd(0x94)],'ParameterValue':CLUSTER_HUB_HA_STACK_NAME+'-'+_0x370e05},{'ParameterKey':_0x173631['hkIur'],'ParameterValue':_0x119d5a}],_0x1228c9[_0x3892cd(0x8f)]=[_0x173631[_0x3892cd(0x76)]],_0x1228c9[_0x3892cd(0x81)]=_0x2a70d8;const _0x2014bd=_0x1228c9,_0x24f8fb=await _0x45d5e7[_0x3892cd(0x9c)](_0x2014bd)[_0x3892cd(0x6d)]();logger[_0x3892cd(0x79)](_0x173631['ppOEM']);const _0x58cff0={};return _0x58cff0[_0x3892cd(0x9b)]=_0x24f8fb[_0x3892cd(0x6e)],_0x45d5e7['waitFor'](_0x173631[_0x3892cd(0x8d)],_0x58cff0)[_0x3892cd(0x6d)]();};
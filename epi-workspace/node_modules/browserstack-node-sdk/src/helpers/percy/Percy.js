const a113_0x11a6da=a113_0x5788;(function(_0x47a16b,_0x4bd32c){const _0x16175d=a113_0x5788,_0x393c69=_0x47a16b();while(!![]){try{const _0x5b1320=parseInt(_0x16175d(0x196))/0x1+-parseInt(_0x16175d(0x1b8))/0x2+parseInt(_0x16175d(0x1bd))/0x3+parseInt(_0x16175d(0x1c8))/0x4*(parseInt(_0x16175d(0x1c7))/0x5)+parseInt(_0x16175d(0x194))/0x6+parseInt(_0x16175d(0x1c6))/0x7*(-parseInt(_0x16175d(0x1aa))/0x8)+-parseInt(_0x16175d(0x19a))/0x9;if(_0x5b1320===_0x4bd32c)break;else _0x393c69['push'](_0x393c69['shift']());}catch(_0x7572e0){_0x393c69['push'](_0x393c69['shift']());}}}(a113_0x29f4,0x1d970));const fs=require('fs'),path=require(a113_0x11a6da(0x1bc)),os=require('os'),{spawn}=require(a113_0x11a6da(0x1a6)),helper=require('../helper'),logger=require(a113_0x11a6da(0x1d9))[a113_0x11a6da(0x1c9)],{getLogDir}=require(a113_0x11a6da(0x1d9)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a113_0x11a6da(0x1ca)),PercyBinary=require(a113_0x11a6da(0x1ce));class Percy{#logfile=path['join'](getLogDir(),a113_0x11a6da(0x1de));#address=process[a113_0x11a6da(0x1c1)][a113_0x11a6da(0x1ad)]||a113_0x11a6da(0x1bf);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a113_0x11a6da(0x1b4)]=![];constructor(_0x1f1abe){const _0x58f70a=a113_0x11a6da;this.#config=_0x1f1abe,!!_0x1f1abe[_0x58f70a(0x1b3)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x373747=a113_0x11a6da;if(!this.#binaryPath){const _0x3dd3fc=new PercyBinary();PerformanceTester[_0x373747(0x19d)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x3dd3fc[_0x373747(0x199)](this.#config),PerformanceTester[_0x373747(0x19c)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x54387c){return new Promise(_0x4a0cbf=>setTimeout(_0x4a0cbf,_0x54387c));}async[a113_0x11a6da(0x1c2)](){const _0x34eafc=a113_0x11a6da,_0x453a0a={};_0x453a0a['JlGFN']=_0x34eafc(0x1c3),_0x453a0a[_0x34eafc(0x1db)]=_0x34eafc(0x1d7);const _0x3148bf=_0x453a0a;try{const _0x168d41=await helper[_0x34eafc(0x1af)](_0x3148bf[_0x34eafc(0x1bb)],_0x3148bf['vqFDK'],null,null,this.#address);if(_0x168d41)return!![];}catch(_0xa9320e){return![];}}async[a113_0x11a6da(0x19d)](){const _0x1dc6c0=a113_0x11a6da,_0x37f508={'xuBPr':'app:exec','mrwRP':_0x1dc6c0(0x1a2),'jspSC':function(_0x4d457c,_0x222b91,_0x4c781b,_0x27c1b9){return _0x4d457c(_0x222b91,_0x4c781b,_0x27c1b9);},'vgOme':'close','BhFNj':_0x1dc6c0(0x1d0)},_0x2f505a=await this.#getBinaryPath(),_0x1b3e6d={};_0x1b3e6d[_0x1dc6c0(0x1dd)]='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x1b3e6d);const _0x1930b2=await this[_0x1dc6c0(0x19f)](),_0x473463=await this['createPercyConfig']();if(!_0x1930b2)return![];const _0x4f9f3d=[(this.#isApp?_0x37f508['xuBPr']:_0x37f508[_0x1dc6c0(0x1c4)])+_0x1dc6c0(0x1b7)];_0x473463&&_0x4f9f3d[_0x1dc6c0(0x19e)]('-c',_0x473463);this.#proc=_0x37f508[_0x1dc6c0(0x1ab)](spawn,_0x2f505a,_0x4f9f3d,{'env':Object[_0x1dc6c0(0x1d6)](process[_0x1dc6c0(0x1c1)],{'PERCY_TOKEN':_0x1930b2,'TH_BUILD_UUID':process['env'][testHubConstants['ENV_VAR'][_0x1dc6c0(0x1cb)]]})}),this.#proc[_0x1dc6c0(0x197)][_0x1dc6c0(0x1d1)](this.#logStream),this.#proc[_0x1dc6c0(0x19b)][_0x1dc6c0(0x1d1)](this.#logStream),this[_0x1dc6c0(0x1b4)]=!![];var _0xec1796=this;this.#proc['on'](_0x37f508['vgOme'],function(_0x22b0f2){const _0x23ab72=_0x1dc6c0;_0xec1796[_0x23ab72(0x1b4)]=![];});do{const _0x31a67c=await this[_0x1dc6c0(0x1c2)]();if(_0x31a67c)return logger[_0x1dc6c0(0x1d5)](_0x37f508[_0x1dc6c0(0x1ac)]),!![];await this.#sleep(0x3e8);}while(this[_0x1dc6c0(0x1b4)]);return![];}async[a113_0x11a6da(0x1a4)](){const _0x4b839c=a113_0x11a6da,_0x26f684={'MIabU':function(_0x3058a4,_0x58c4b6){return _0x3058a4(_0x58c4b6);},'fHKxi':function(_0x4705ec,_0x295217,_0x10bbc2){return _0x4705ec(_0x295217,_0x10bbc2);},'NzOUe':_0x4b839c(0x1a8),'izUbG':'close'},_0x343d7f=await this.#getBinaryPath();return new Promise((_0x1bd812,_0x3f79af)=>{const _0x12b865=_0x4b839c,_0x6b6863={'JXRKA':function(_0x495f0f,_0x13d342){const _0x525614=a113_0x5788;return _0x26f684[_0x525614(0x1a3)](_0x495f0f,_0x13d342);}},_0x4ccb7d=_0x26f684[_0x12b865(0x1da)](spawn,_0x343d7f,[_0x26f684[_0x12b865(0x1d8)]]);_0x4ccb7d['on'](_0x26f684[_0x12b865(0x1c0)],_0x74bb6f=>{const _0x41e1ff=_0x12b865;this[_0x41e1ff(0x1b4)]=![],this.#logStream&&(this.#logStream['end'](),this.#logStream=null),_0x6b6863['JXRKA'](_0x1bd812,_0x74bb6f);});});}[a113_0x11a6da(0x1b0)](){const _0x91b78d=a113_0x11a6da;return this[_0x91b78d(0x1b4)];}async['fetchPercyToken'](){const _0x3fe671=a113_0x11a6da,_0xbfaa7c={};_0xbfaa7c[_0x3fe671(0x1b2)]=_0x3fe671(0x1b3),_0xbfaa7c['KdYxj']=_0x3fe671(0x1cc),_0xbfaa7c[_0x3fe671(0x1ba)]=_0x3fe671(0x1c3),_0xbfaa7c[_0x3fe671(0x1d3)]=_0x3fe671(0x1ae);const _0x16a7c0=_0xbfaa7c,_0x2f7cad=this.#config[_0x3fe671(0x1cf)];try{const _0x1d7d6d=this.#isApp?_0x16a7c0[_0x3fe671(0x1b2)]:_0x16a7c0[_0x3fe671(0x1a5)],_0x15584d=await helper[_0x3fe671(0x1af)](_0x16a7c0[_0x3fe671(0x1ba)],_0x3fe671(0x1d2)+_0x2f7cad+'&type='+_0x1d7d6d,{},this.#config),_0x5b608f=_0x15584d[_0x3fe671(0x1b6)];return logger[_0x3fe671(0x1d5)](_0x16a7c0[_0x3fe671(0x1d3)]),_0x5b608f[_0x3fe671(0x1be)];}catch(_0x5ba649){return logger[_0x3fe671(0x192)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x5ba649),null;}}async['createPercyConfig'](){const _0x569acc=a113_0x11a6da,_0x120826={'XOaAK':function(_0x2a3ea6,_0x3255a6){return _0x2a3ea6(_0x3255a6);},'wVpLF':function(_0x55a56d,_0xe710d1){return _0x55a56d+_0xe710d1;},'NLzUu':_0x569acc(0x1a9),'AhqIr':'percy.json'};if(!this.#config['percyOptions'])return null;const _0x5a3c40=path[_0x569acc(0x1b1)](os[_0x569acc(0x198)](),_0x120826['AhqIr']),_0x355cf5=this.#config[_0x569acc(0x1b5)];return!_0x355cf5[_0x569acc(0x1a0)]&&(_0x355cf5[_0x569acc(0x1a0)]='2'),new Promise((_0x387195,_0x4da62c)=>{const _0xec4974=_0x569acc,_0x324f44={'axYlq':function(_0x4311a8,_0x44da7e){return _0x120826['XOaAK'](_0x4311a8,_0x44da7e);},'lzCJv':function(_0x5251b1,_0x2a123b){const _0x17569e=a113_0x5788;return _0x120826[_0x17569e(0x1b9)](_0x5251b1,_0x2a123b);},'eSolH':_0x120826[_0xec4974(0x1a1)]};fs[_0xec4974(0x1d4)](_0x5a3c40,JSON[_0xec4974(0x195)](_0x355cf5),_0xb91abc=>{const _0x145c35=_0xec4974;_0xb91abc&&(logger['error'](_0x145c35(0x1a7)+_0xb91abc),_0x324f44['axYlq'](_0x387195,null)),logger[_0x145c35(0x1d5)](_0x324f44[_0x145c35(0x193)](_0x324f44[_0x145c35(0x1c5)],_0x5a3c40)),_0x324f44[_0x145c35(0x1cd)](_0x387195,_0x5a3c40);});});}}module[a113_0x11a6da(0x1dc)]=Percy;function a113_0x5788(_0x24778e,_0x347609){const _0x29f454=a113_0x29f4();return a113_0x5788=function(_0x578859,_0x36a857){_0x578859=_0x578859-0x192;let _0x38e7da=_0x29f454[_0x578859];return _0x38e7da;},a113_0x5788(_0x24778e,_0x347609);}function a113_0x29f4(){const _0x18cae6=['api/app_percy/get_project_token?name=','XcyLj','writeFile','debug','assign','percy/healthcheck','NzOUe','../logger','fHKxi','vqFDK','exports','flags','percy.log','error','lzCJv','574962iRWnsg','stringify','151023LwyONB','stdout','tmpdir','getBinaryPath','1757340QjLIFr','stderr','end','start','push','fetchPercyToken','version','NLzUu','exec','MIabU','stop','KdYxj','child_process','Error\x20creating\x20percy\x20config:\x20','exec:stop','Percy\x20config\x20created\x20at\x20','95192pYSEkx','jspSC','BhFNj','PERCY_SERVER_ADDRESS','Percy\x20fetch\x20token\x20success','nodeRequest','isRunning','join','AUMto','app','isProcessRunning','percyOptions','data',':start','452252cOWHtq','wVpLF','FXELd','JlGFN','path','590097fgNhWR','token','http://localhost:5338','izUbG','env','healthcheck','GET','mrwRP','eSolH','28iTUaDB','1655rPWnZz','1772INTywv','winstonLogger','../../helpers/performance/constants','BROWSERSTACK_TESTHUB_UUID','automate','axYlq','./PercyBinary','projectName','Percy\x20healthcheck\x20successful','pipe'];a113_0x29f4=function(){return _0x18cae6;};return a113_0x29f4();}
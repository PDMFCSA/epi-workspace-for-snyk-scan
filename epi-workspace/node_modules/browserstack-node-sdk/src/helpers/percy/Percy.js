const a72_0x5b3b6a=a72_0x17c5;(function(_0x28ed24,_0xd679b7){const _0x42754a=a72_0x17c5,_0x2f0150=_0x28ed24();while(!![]){try{const _0xf90a7e=-parseInt(_0x42754a(0x186))/0x1*(-parseInt(_0x42754a(0x1bd))/0x2)+parseInt(_0x42754a(0x191))/0x3+-parseInt(_0x42754a(0x18e))/0x4*(parseInt(_0x42754a(0x1aa))/0x5)+parseInt(_0x42754a(0x1d0))/0x6+parseInt(_0x42754a(0x1c1))/0x7+parseInt(_0x42754a(0x1a7))/0x8+-parseInt(_0x42754a(0x1cc))/0x9;if(_0xf90a7e===_0xd679b7)break;else _0x2f0150['push'](_0x2f0150['shift']());}catch(_0x21bd37){_0x2f0150['push'](_0x2f0150['shift']());}}}(a72_0x6975,0x99607));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a72_0x5b3b6a(0x1d4)),helper=require(a72_0x5b3b6a(0x1c2)),logger=require(a72_0x5b3b6a(0x1a5))[a72_0x5b3b6a(0x1b3)],{getLogDir}=require(a72_0x5b3b6a(0x1a5)),testHubConstants=require(a72_0x5b3b6a(0x1b4)),PerformanceTester=require(a72_0x5b3b6a(0x1c6)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x5b3b6a(0x1cd)),PercyBinary=require(a72_0x5b3b6a(0x1c4));function a72_0x6975(){const _0x2237bc=['child_process','QgFpZ','vKnWV','207477lKZBUf','exports','MxEsA','pipe','http://localhost:5338','join','tmpdir','percy.log','160gVHujg','isRunning','grmqi','1126470jKSDZM','rSFEu','percyOptions','percy.json','ENV_VAR','assign','zEmZU','Percy\x20config\x20created\x20at\x20','fetchPercyToken','yzzdw','nodeRequest','app','api/app_percy/get_project_token?name=','iNFOA','wZyYB','PERCY_SERVER_ADDRESS','XPiIO','zLyqD','end','uHzqZ','../logger','tUQZI','3883000rrrpFg','writeFile','aiplq','62830LFwCDy','push','exec','error','CHeXs','token','isProcessRunning','getBinaryPath','env','winstonLogger','../../helpers/testhub/constants','Percy\x20healthcheck\x20successful','ACjiz','stringify','createWriteStream','start','createPercyConfig',':start','onPoD','4zNlIeK','healthcheck','automate','percy/healthcheck','5251239ltEmHs','../helper','BROWSERSTACK_TESTHUB_UUID','./PercyBinary','version','../../helpers/performance/performance-tester','stdout','Percy\x20fetch\x20token\x20success','UHvvX','ZHbqH','flags','9803628bNwVQn','../../helpers/performance/constants','Error\x20creating\x20percy\x20config:\x20','debug','1165002ADhCOm','AeYMi','DOWNLOAD','exec:stop'];a72_0x6975=function(){return _0x2237bc;};return a72_0x6975();}function a72_0x17c5(_0x499cd3,_0x35042f){const _0x6975d9=a72_0x6975();return a72_0x17c5=function(_0x17c59d,_0x4db974){_0x17c59d=_0x17c59d-0x185;let _0x41ec15=_0x6975d9[_0x17c59d];return _0x41ec15;},a72_0x17c5(_0x499cd3,_0x35042f);}class Percy{#logfile=path[a72_0x5b3b6a(0x18b)](getLogDir(),a72_0x5b3b6a(0x18d));#address=process['env'][a72_0x5b3b6a(0x1a0)]||a72_0x5b3b6a(0x18a);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x5b3b6a(0x1b0)]=![];constructor(_0x5a9072){this.#config=_0x5a9072,!!_0x5a9072['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x2859f5=a72_0x5b3b6a;if(!this.#binaryPath){const _0x5939b5=new PercyBinary();PerformanceTester['start'](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x5939b5[_0x2859f5(0x1b1)](this.#config),PerformanceTester[_0x2859f5(0x1a3)](PerformanceEvents[_0x2859f5(0x1d2)]);}return this.#binaryPath;}async #sleep(_0x2ba437){return new Promise(_0x2c4f1f=>setTimeout(_0x2c4f1f,_0x2ba437));}async[a72_0x5b3b6a(0x1be)](){const _0x12dd64=a72_0x5b3b6a,_0x2f03a4={};_0x2f03a4[_0x12dd64(0x1c9)]='GET',_0x2f03a4[_0x12dd64(0x19f)]=_0x12dd64(0x1c0);const _0x2a2bee=_0x2f03a4;try{const _0x1a0308=await helper[_0x12dd64(0x19b)](_0x2a2bee[_0x12dd64(0x1c9)],_0x2a2bee[_0x12dd64(0x19f)],null,null,this.#address);if(_0x1a0308)return!![];}catch(_0x1075c9){return![];}}async[a72_0x5b3b6a(0x1b9)](){const _0x59dbf3=a72_0x5b3b6a,_0x536ed3={'zLyqD':'app:exec','tUQZI':_0x59dbf3(0x1ac),'ciGex':function(_0x103986,_0x439771,_0x3a26c6,_0x4d1921){return _0x103986(_0x439771,_0x3a26c6,_0x4d1921);},'yzzdw':'close','CHeXs':_0x59dbf3(0x1b5)},_0x309255=await this.#getBinaryPath(),_0x9ca23a={};_0x9ca23a[_0x59dbf3(0x1cb)]='a';const _0xa69f94=fs[_0x59dbf3(0x1b8)](this.#logfile,_0x9ca23a),_0x38f2d4=await this[_0x59dbf3(0x199)](),_0x258f94=await this['createPercyConfig']();if(!_0x38f2d4)return![];const _0x1bd735=[(this.#isApp?_0x536ed3[_0x59dbf3(0x1a2)]:_0x536ed3[_0x59dbf3(0x1a6)])+_0x59dbf3(0x1bb)];_0x258f94&&_0x1bd735[_0x59dbf3(0x1ab)]('-c',_0x258f94);this.#proc=_0x536ed3['ciGex'](spawn,_0x309255,_0x1bd735,{'env':Object[_0x59dbf3(0x196)](process['env'],{'PERCY_TOKEN':_0x38f2d4,'TH_BUILD_UUID':process[_0x59dbf3(0x1b2)][testHubConstants[_0x59dbf3(0x195)][_0x59dbf3(0x1c3)]]})}),this.#proc[_0x59dbf3(0x1c7)][_0x59dbf3(0x189)](_0xa69f94),this.#proc['stderr'][_0x59dbf3(0x189)](_0xa69f94),this['isProcessRunning']=!![];var _0x3d5f6a=this;this.#proc['on'](_0x536ed3[_0x59dbf3(0x19a)],function(_0x49c2e9){const _0x2591cc=_0x59dbf3;_0x3d5f6a[_0x2591cc(0x1b0)]=![];});do{const _0xbdbc7b=await this['healthcheck']();if(_0xbdbc7b)return logger[_0x59dbf3(0x1cf)](_0x536ed3[_0x59dbf3(0x1ae)]),!![];await this.#sleep(0x3e8);}while(this[_0x59dbf3(0x1b0)]);return![];}async['stop'](){const _0x2d1d75=a72_0x5b3b6a,_0x44f444={'iNFOA':function(_0x6b76e1,_0x576c41){return _0x6b76e1(_0x576c41);},'ACjiz':function(_0x104205,_0x4bdb4d,_0x35a924){return _0x104205(_0x4bdb4d,_0x35a924);},'rSFEu':_0x2d1d75(0x1d3),'onPoD':'close'},_0x14b8b2=await this.#getBinaryPath();return new Promise((_0x47ea69,_0x5c5256)=>{const _0x500559=_0x2d1d75,_0x19cba6=_0x44f444[_0x500559(0x1b6)](spawn,_0x14b8b2,[_0x44f444[_0x500559(0x192)]]);_0x19cba6['on'](_0x44f444[_0x500559(0x1bc)],_0x3eea45=>{const _0x30cc06=_0x500559;this['isProcessRunning']=![],_0x44f444[_0x30cc06(0x19e)](_0x47ea69,_0x3eea45);});});}[a72_0x5b3b6a(0x18f)](){return this['isProcessRunning'];}async[a72_0x5b3b6a(0x199)](){const _0x3d0812=a72_0x5b3b6a,_0x5c4b1a={};_0x5c4b1a[_0x3d0812(0x1d5)]=_0x3d0812(0x19c),_0x5c4b1a[_0x3d0812(0x185)]=_0x3d0812(0x1bf),_0x5c4b1a[_0x3d0812(0x1ca)]='GET',_0x5c4b1a['zEmZU']=_0x3d0812(0x1c8);const _0xb53a9f=_0x5c4b1a,_0x56b5eb=this.#config['projectName'];try{const _0x2fafd8=this.#isApp?_0xb53a9f[_0x3d0812(0x1d5)]:_0xb53a9f['vKnWV'],_0x3ab62e=await helper[_0x3d0812(0x19b)](_0xb53a9f[_0x3d0812(0x1ca)],_0x3d0812(0x19d)+_0x56b5eb+'&type='+_0x2fafd8,{},this.#config),_0x5137a7=_0x3ab62e['data'];return logger[_0x3d0812(0x1cf)](_0xb53a9f[_0x3d0812(0x197)]),_0x5137a7[_0x3d0812(0x1af)];}catch(_0x2e94f2){return logger[_0x3d0812(0x1ad)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x2e94f2),null;}}async[a72_0x5b3b6a(0x1ba)](){const _0x497c9b=a72_0x5b3b6a,_0x29fed9={'sRfYu':function(_0x407c08,_0x9fcc85){return _0x407c08(_0x9fcc85);},'aiplq':function(_0x16fd25,_0x2af6e2){return _0x16fd25+_0x2af6e2;},'DMsUr':_0x497c9b(0x198),'uHzqZ':function(_0x15a96b,_0x4671a0){return _0x15a96b(_0x4671a0);},'grmqi':_0x497c9b(0x194)};if(!this.#config[_0x497c9b(0x193)])return null;const _0x14a764=path['join'](os[_0x497c9b(0x18c)](),_0x29fed9[_0x497c9b(0x190)]),_0x399fad=this.#config[_0x497c9b(0x193)];return!_0x399fad[_0x497c9b(0x1c5)]&&(_0x399fad['version']='2'),new Promise((_0x1c056b,_0x44aba3)=>{const _0xd8cd85=_0x497c9b,_0x564fa8={'AeYMi':function(_0x4122ed,_0x276ae5){return _0x29fed9['sRfYu'](_0x4122ed,_0x276ae5);},'unzLG':function(_0x3ad17c,_0x474a70){const _0x132cd0=a72_0x17c5;return _0x29fed9[_0x132cd0(0x1a9)](_0x3ad17c,_0x474a70);},'MxEsA':_0x29fed9['DMsUr'],'XPiIO':function(_0x408605,_0x4f5f53){const _0x227abc=a72_0x17c5;return _0x29fed9[_0x227abc(0x1a4)](_0x408605,_0x4f5f53);}};fs[_0xd8cd85(0x1a8)](_0x14a764,JSON[_0xd8cd85(0x1b7)](_0x399fad),_0x1aeb3f=>{const _0x5e0028=_0xd8cd85;_0x1aeb3f&&(logger[_0x5e0028(0x1ad)](_0x5e0028(0x1ce)+_0x1aeb3f),_0x564fa8[_0x5e0028(0x1d1)](_0x1c056b,null)),logger[_0x5e0028(0x1cf)](_0x564fa8['unzLG'](_0x564fa8[_0x5e0028(0x188)],_0x14a764)),_0x564fa8[_0x5e0028(0x1a1)](_0x1c056b,_0x14a764);});});}}module[a72_0x5b3b6a(0x187)]=Percy;
const a72_0x5eafa2=a72_0x298b;(function(_0x675549,_0x33a65d){const _0x5cdfc1=a72_0x298b,_0x1d5d1a=_0x675549();while(!![]){try{const _0x11107c=-parseInt(_0x5cdfc1(0xf2))/0x1+parseInt(_0x5cdfc1(0xe2))/0x2*(parseInt(_0x5cdfc1(0x104))/0x3)+-parseInt(_0x5cdfc1(0x119))/0x4*(parseInt(_0x5cdfc1(0xed))/0x5)+parseInt(_0x5cdfc1(0xe3))/0x6*(-parseInt(_0x5cdfc1(0x108))/0x7)+parseInt(_0x5cdfc1(0x12e))/0x8+-parseInt(_0x5cdfc1(0xf6))/0x9*(parseInt(_0x5cdfc1(0x103))/0xa)+-parseInt(_0x5cdfc1(0x118))/0xb*(-parseInt(_0x5cdfc1(0x10f))/0xc);if(_0x11107c===_0x33a65d)break;else _0x1d5d1a['push'](_0x1d5d1a['shift']());}catch(_0x14a69f){_0x1d5d1a['push'](_0x1d5d1a['shift']());}}}(a72_0x3e58,0xdc1be));function a72_0x298b(_0x4c092e,_0x195a2c){const _0x3e582f=a72_0x3e58();return a72_0x298b=function(_0x298b42,_0x5925fa){_0x298b42=_0x298b42-0xe2;let _0x38f182=_0x3e582f[_0x298b42];return _0x38f182;},a72_0x298b(_0x4c092e,_0x195a2c);}function a72_0x3e58(){const _0x405e3c=['SBsXJ','DOWNLOAD','error','MzboJ','createPercyConfig','ssEKS','GkfEy','api/app_percy/get_project_token?name=','exec','data','stringify','nodeRequest','token','../logger','IPGAn','Error\x20creating\x20percy\x20config:\x20','stdout','app:exec','1013056RYPZKS','YVNKZ','percy.log','automate','createWriteStream','McGQm','./PercyBinary','322450oNQtAQ','1815336kenrgM','join','exec:stop','tmpdir','wPIbd','AtpmF','RjyFp','isProcessRunning','lwqPQ','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','22170tXbDjn','XcwCb','../../helpers/performance/performance-tester','kLWjR','app','1231570aoTOeS','BROWSERSTACK_TESTHUB_UUID','winstonLogger','isRunning','81DXXkFn','CiQrt','jhVDO','close','healthcheck','percyOptions','fetchPercyToken','Percy\x20config\x20created\x20at\x20','debug','dRqRN','http://localhost:5338','path','GET','902420gpKCIV','21oaDbvm','version','Percy\x20healthcheck\x20successful','flags','7zqTZfO','tDxgJ','ndAfu','pipe','AnCDU','env','assign','8460GraLcI','../../helpers/testhub/constants','writeFile','dnSCh','end','TeSkc','Percy\x20fetch\x20token\x20success','stop','../helper','46519jEtzxh','892YqdaBi','ENV_VAR','percy/healthcheck'];a72_0x3e58=function(){return _0x405e3c;};return a72_0x3e58();}const fs=require('fs'),path=require(a72_0x5eafa2(0x101)),os=require('os'),{spawn}=require('child_process'),helper=require(a72_0x5eafa2(0x117)),logger=require('../logger')[a72_0x5eafa2(0xf4)],{getLogDir}=require(a72_0x5eafa2(0x129)),testHubConstants=require(a72_0x5eafa2(0x110)),PerformanceTester=require(a72_0x5eafa2(0xef)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a72_0x5eafa2(0x134));class Percy{#logfile=path[a72_0x5eafa2(0xe4)](getLogDir(),a72_0x5eafa2(0x130));#address=process[a72_0x5eafa2(0x10d)]['PERCY_SERVER_ADDRESS']||a72_0x5eafa2(0x100);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x5eafa2(0xea)]=![];constructor(_0x5ecbf6){const _0x294e43=a72_0x5eafa2;this.#config=_0x5ecbf6,!!_0x5ecbf6[_0x294e43(0xf1)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x6aaf8c=a72_0x5eafa2;if(!this.#binaryPath){const _0x329e0e=new PercyBinary();PerformanceTester['start'](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x329e0e['getBinaryPath'](this.#config),PerformanceTester[_0x6aaf8c(0x113)](PerformanceEvents[_0x6aaf8c(0x11d)]);}return this.#binaryPath;}async #sleep(_0x565196){return new Promise(_0x33eeae=>setTimeout(_0x33eeae,_0x565196));}async[a72_0x5eafa2(0xfa)](){const _0x219c3c=a72_0x5eafa2,_0x5829b6={};_0x5829b6['wPIbd']=_0x219c3c(0x102),_0x5829b6['AnCDU']=_0x219c3c(0x11b);const _0x39a342=_0x5829b6;try{const _0x42fed9=await helper[_0x219c3c(0x127)](_0x39a342[_0x219c3c(0xe7)],_0x39a342[_0x219c3c(0x10c)],null,null,this.#address);if(_0x42fed9)return!![];}catch(_0x39635c){return![];}}async['start'](){const _0x46e207=a72_0x5eafa2,_0x3d56e7={'AtpmF':_0x46e207(0x12d),'YVNKZ':_0x46e207(0x124),'XcwCb':function(_0x20ad88,_0x2d5bb4,_0x2acb7a,_0x4d0e71){return _0x20ad88(_0x2d5bb4,_0x2acb7a,_0x4d0e71);},'lwqPQ':_0x46e207(0xf9),'MzboJ':_0x46e207(0x106)},_0x144560=await this.#getBinaryPath(),_0x21c604={};_0x21c604[_0x46e207(0x107)]='a';const _0x4af2dc=fs[_0x46e207(0x132)](this.#logfile,_0x21c604),_0x343182=await this[_0x46e207(0xfc)](),_0x1b0bc4=await this[_0x46e207(0x120)]();if(!_0x343182)return![];const _0x14acdf=[(this.#isApp?_0x3d56e7[_0x46e207(0xe8)]:_0x3d56e7[_0x46e207(0x12f)])+':start'];_0x1b0bc4&&_0x14acdf['push']('-c',_0x1b0bc4);this.#proc=_0x3d56e7[_0x46e207(0xee)](spawn,_0x144560,_0x14acdf,{'env':Object[_0x46e207(0x10e)](process[_0x46e207(0x10d)],{'PERCY_TOKEN':_0x343182,'TH_BUILD_UUID':process[_0x46e207(0x10d)][testHubConstants[_0x46e207(0x11a)][_0x46e207(0xf3)]]})}),this.#proc[_0x46e207(0x12c)][_0x46e207(0x10b)](_0x4af2dc),this.#proc['stderr']['pipe'](_0x4af2dc),this[_0x46e207(0xea)]=!![];var _0x5e4c3b=this;this.#proc['on'](_0x3d56e7[_0x46e207(0xeb)],function(_0xb27e82){const _0x5c7b2d=_0x46e207;_0x5e4c3b[_0x5c7b2d(0xea)]=![];});do{const _0x4218f7=await this[_0x46e207(0xfa)]();if(_0x4218f7)return logger[_0x46e207(0xfe)](_0x3d56e7[_0x46e207(0x11f)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x5eafa2(0x116)](){const _0x12eb7b=a72_0x5eafa2,_0x2ee536={'GYtNX':function(_0x2e83a5,_0x4ac4d3){return _0x2e83a5(_0x4ac4d3);},'uznrg':function(_0x20325c,_0x392202,_0xaee88c){return _0x20325c(_0x392202,_0xaee88c);},'tDxgJ':_0x12eb7b(0xe5),'RjyFp':_0x12eb7b(0xf9)},_0x496e52=await this.#getBinaryPath();return new Promise((_0x54efb0,_0x32a0c4)=>{const _0x5cf51f=_0x12eb7b,_0xa7deaa=_0x2ee536['uznrg'](spawn,_0x496e52,[_0x2ee536[_0x5cf51f(0x109)]]);_0xa7deaa['on'](_0x2ee536[_0x5cf51f(0xe9)],_0x4c7bdd=>{const _0x2ff2d2=_0x5cf51f;this[_0x2ff2d2(0xea)]=![],_0x2ee536['GYtNX'](_0x54efb0,_0x4c7bdd);});});}[a72_0x5eafa2(0xf5)](){const _0x5f4c24=a72_0x5eafa2;return this[_0x5f4c24(0xea)];}async[a72_0x5eafa2(0xfc)](){const _0x14c9cf=a72_0x5eafa2,_0x59c00c={};_0x59c00c[_0x14c9cf(0x122)]='app',_0x59c00c[_0x14c9cf(0x114)]=_0x14c9cf(0x131),_0x59c00c[_0x14c9cf(0x133)]=_0x14c9cf(0x102),_0x59c00c[_0x14c9cf(0x121)]=_0x14c9cf(0x115);const _0x13b5d3=_0x59c00c,_0x111465=this.#config['projectName'];try{const _0x2bb4ef=this.#isApp?_0x13b5d3[_0x14c9cf(0x122)]:_0x13b5d3[_0x14c9cf(0x114)],_0x5adea9=await helper[_0x14c9cf(0x127)](_0x13b5d3['McGQm'],_0x14c9cf(0x123)+_0x111465+'&type='+_0x2bb4ef,{},this.#config),_0x22cb02=_0x5adea9[_0x14c9cf(0x125)];return logger[_0x14c9cf(0xfe)](_0x13b5d3[_0x14c9cf(0x121)]),_0x22cb02[_0x14c9cf(0x128)];}catch(_0x28ee2d){return logger[_0x14c9cf(0x11e)](_0x14c9cf(0xec)+_0x28ee2d),null;}}async[a72_0x5eafa2(0x120)](){const _0x4e816b=a72_0x5eafa2,_0xcb642f={'SBsXJ':function(_0x551dad,_0xc4a720){return _0x551dad(_0xc4a720);},'dRqRN':function(_0x516a5b,_0x54386d){return _0x516a5b+_0x54386d;},'ndAfu':_0x4e816b(0xfd),'dnSCh':'percy.json'};if(!this.#config[_0x4e816b(0xfb)])return null;const _0x1b7d6a=path[_0x4e816b(0xe4)](os[_0x4e816b(0xe6)](),_0xcb642f[_0x4e816b(0x112)]),_0xa0964d=this.#config[_0x4e816b(0xfb)];return!_0xa0964d[_0x4e816b(0x105)]&&(_0xa0964d[_0x4e816b(0x105)]='2'),new Promise((_0x4b6668,_0x3df6ec)=>{const _0x10d169=_0x4e816b,_0x26e326={'CiQrt':function(_0x1bce3b,_0x3854e5){return _0xcb642f['SBsXJ'](_0x1bce3b,_0x3854e5);},'jhVDO':function(_0x34e481,_0x5c94a7){const _0x243144=a72_0x298b;return _0xcb642f[_0x243144(0xff)](_0x34e481,_0x5c94a7);},'IPGAn':_0xcb642f[_0x10d169(0x10a)],'kLWjR':function(_0x1f6b33,_0x58a702){const _0x2b8c47=_0x10d169;return _0xcb642f[_0x2b8c47(0x11c)](_0x1f6b33,_0x58a702);}};fs[_0x10d169(0x111)](_0x1b7d6a,JSON[_0x10d169(0x126)](_0xa0964d),_0x420aef=>{const _0x26cda0=_0x10d169;_0x420aef&&(logger['error'](_0x26cda0(0x12b)+_0x420aef),_0x26e326[_0x26cda0(0xf7)](_0x4b6668,null)),logger[_0x26cda0(0xfe)](_0x26e326[_0x26cda0(0xf8)](_0x26e326[_0x26cda0(0x12a)],_0x1b7d6a)),_0x26e326[_0x26cda0(0xf0)](_0x4b6668,_0x1b7d6a);});});}}module['exports']=Percy;
const a101_0x2adfe1=a101_0x545f;function a101_0x1c14(){const _0x13d7cc=['&type=','tmpdir','automate','BJvYS','percyOptions','isRunning','1348vnNgDC','child_process','app','writeFile','fQcuT','error','Error\x20creating\x20percy\x20config:\x20','2886CmCODV','etpKi','yqNxb','flags','2534266ypIfsy','4055SpHoJL','2001dFAZpt','percy/healthcheck','exec','2804265HOPiiO','../../helpers/performance/performance-tester','stderr','DOWNLOAD','exec:stop','GET','oYGIm','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','isProcessRunning','PERCY_SERVER_ADDRESS','percy.json',':start','jSnhX','Percy\x20config\x20created\x20at\x20','api/app_percy/get_project_token?name=','../logger','qGsdT','env','cixTu','join','BROWSERSTACK_TESTHUB_UUID','pipe','../../helpers/performance/constants','version','data','Percy\x20healthcheck\x20successful','wgdCV','debug','http://localhost:5338','projectName','rUkgA','500591KykgUG','percy.log','88SpNUpo','stdout','./PercyBinary','yDBzY','createWriteStream','fetchPercyToken','nodeRequest','gWUYJ','assign','start','1925290shsKrH','../helper','close','createPercyConfig','32DCjDhu','375737WXKmgL','../../helpers/testhub/constants','token','xfbrG'];a101_0x1c14=function(){return _0x13d7cc;};return a101_0x1c14();}function a101_0x545f(_0x2e34bf,_0x556f2e){const _0x1c141f=a101_0x1c14();return a101_0x545f=function(_0x545f41,_0x2555e4){_0x545f41=_0x545f41-0xd6;let _0x36a8a8=_0x1c141f[_0x545f41];return _0x36a8a8;},a101_0x545f(_0x2e34bf,_0x556f2e);}(function(_0x186a8e,_0x4d32f6){const _0x561aa6=a101_0x545f,_0x2eddc6=_0x186a8e();while(!![]){try{const _0x3dfd10=-parseInt(_0x561aa6(0xd6))/0x1+-parseInt(_0x561aa6(0xeb))/0x2+-parseInt(_0x561aa6(0xed))/0x3*(parseInt(_0x561aa6(0xe0))/0x4)+-parseInt(_0x561aa6(0xec))/0x5*(-parseInt(_0x561aa6(0xe7))/0x6)+-parseInt(_0x561aa6(0x10f))/0x7*(-parseInt(_0x561aa6(0x11f))/0x8)+parseInt(_0x561aa6(0xf0))/0x9+parseInt(_0x561aa6(0x11b))/0xa*(parseInt(_0x561aa6(0x111))/0xb);if(_0x3dfd10===_0x4d32f6)break;else _0x2eddc6['push'](_0x2eddc6['shift']());}catch(_0x4175db){_0x2eddc6['push'](_0x2eddc6['shift']());}}}(a101_0x1c14,0xa1357));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a101_0x2adfe1(0xe1)),helper=require(a101_0x2adfe1(0x11c)),logger=require(a101_0x2adfe1(0xff))['winstonLogger'],{getLogDir}=require(a101_0x2adfe1(0xff)),testHubConstants=require(a101_0x2adfe1(0xd7)),PerformanceTester=require(a101_0x2adfe1(0xf1)),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x2adfe1(0x106)),PercyBinary=require(a101_0x2adfe1(0x113));class Percy{#logfile=path[a101_0x2adfe1(0x103)](getLogDir(),a101_0x2adfe1(0x110));#address=process[a101_0x2adfe1(0x101)][a101_0x2adfe1(0xf9)]||a101_0x2adfe1(0x10c);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a101_0x2adfe1(0xf8)]=![];constructor(_0x3b08f3){this.#config=_0x3b08f3,!!_0x3b08f3['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x134a48=a101_0x2adfe1;if(!this.#binaryPath){const _0x10b802=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x134a48(0xf3)]),this.#binaryPath=await _0x10b802['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents[_0x134a48(0xf3)]);}return this.#binaryPath;}async #sleep(_0x3273c0){return new Promise(_0x28fbe8=>setTimeout(_0x28fbe8,_0x3273c0));}async['healthcheck'](){const _0x5170e0=a101_0x2adfe1,_0x4127b0={};_0x4127b0[_0x5170e0(0x10e)]=_0x5170e0(0xf5),_0x4127b0['fQcuT']=_0x5170e0(0xee);const _0x314e35=_0x4127b0;try{const _0xe2775f=await helper[_0x5170e0(0x117)](_0x314e35[_0x5170e0(0x10e)],_0x314e35[_0x5170e0(0xe4)],null,null,this.#address);if(_0xe2775f)return!![];}catch(_0x6720e6){return![];}}async[a101_0x2adfe1(0x11a)](){const _0x386216=a101_0x2adfe1,_0x1655d3={'NvXoh':'app:exec','gWUYJ':_0x386216(0xef),'UdfPh':function(_0x41b629,_0x1b6d48,_0x430721,_0x4835bd){return _0x41b629(_0x1b6d48,_0x430721,_0x4835bd);},'LUrmq':_0x386216(0x11d),'oYGIm':_0x386216(0x109)},_0x4b0704=await this.#getBinaryPath(),_0x2fa98d={};_0x2fa98d[_0x386216(0xea)]='a';const _0x1513ec=fs[_0x386216(0x115)](this.#logfile,_0x2fa98d),_0x48e42e=await this[_0x386216(0x116)](),_0x1c06eb=await this[_0x386216(0x11e)]();if(!_0x48e42e)return![];const _0x2de2d9=[(this.#isApp?_0x1655d3['NvXoh']:_0x1655d3[_0x386216(0x118)])+_0x386216(0xfb)];_0x1c06eb&&_0x2de2d9['push']('-c',_0x1c06eb);this.#proc=_0x1655d3['UdfPh'](spawn,_0x4b0704,_0x2de2d9,{'env':Object[_0x386216(0x119)](process[_0x386216(0x101)],{'PERCY_TOKEN':_0x48e42e,'TH_BUILD_UUID':process['env'][testHubConstants['ENV_VAR'][_0x386216(0x104)]]})}),this.#proc[_0x386216(0x112)][_0x386216(0x105)](_0x1513ec),this.#proc[_0x386216(0xf2)][_0x386216(0x105)](_0x1513ec),this[_0x386216(0xf8)]=!![];var _0xab01b9=this;this.#proc['on'](_0x1655d3['LUrmq'],function(_0x29a6cd){_0xab01b9['isProcessRunning']=![];});do{const _0x4d254d=await this['healthcheck']();if(_0x4d254d)return logger[_0x386216(0x10b)](_0x1655d3[_0x386216(0xf6)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async['stop'](){const _0x30e93b=a101_0x2adfe1,_0x3b52f6={'llDJr':function(_0x60439e,_0x5f5666){return _0x60439e(_0x5f5666);},'wgdCV':function(_0x34294c,_0x222420,_0x180831){return _0x34294c(_0x222420,_0x180831);},'Imnor':_0x30e93b(0xf4),'qGsdT':_0x30e93b(0x11d)},_0x2acd03=await this.#getBinaryPath();return new Promise((_0x46db1c,_0x3f579d)=>{const _0x26ab95=_0x30e93b,_0x246a2c={'nwtQF':function(_0x2b8ad0,_0x3d104a){return _0x3b52f6['llDJr'](_0x2b8ad0,_0x3d104a);}},_0x40ddbc=_0x3b52f6[_0x26ab95(0x10a)](spawn,_0x2acd03,[_0x3b52f6['Imnor']]);_0x40ddbc['on'](_0x3b52f6[_0x26ab95(0x100)],_0xeac833=>{const _0x482302=_0x26ab95;this[_0x482302(0xf8)]=![],_0x246a2c['nwtQF'](_0x46db1c,_0xeac833);});});}[a101_0x2adfe1(0xdf)](){const _0x10ca35=a101_0x2adfe1;return this[_0x10ca35(0xf8)];}async[a101_0x2adfe1(0x116)](){const _0x1a9054=a101_0x2adfe1,_0x2422e9={};_0x2422e9[_0x1a9054(0xdd)]=_0x1a9054(0xe2),_0x2422e9['yDBzY']=_0x1a9054(0xdc),_0x2422e9['MVtha']=_0x1a9054(0xf5),_0x2422e9[_0x1a9054(0xfc)]='Percy\x20fetch\x20token\x20success';const _0x41780e=_0x2422e9,_0x174fe2=this.#config[_0x1a9054(0x10d)];try{const _0x28682f=this.#isApp?_0x41780e['BJvYS']:_0x41780e[_0x1a9054(0x114)],_0x118827=await helper[_0x1a9054(0x117)](_0x41780e['MVtha'],_0x1a9054(0xfe)+_0x174fe2+_0x1a9054(0xda)+_0x28682f,{},this.#config),_0x2f096d=_0x118827[_0x1a9054(0x108)];return logger[_0x1a9054(0x10b)](_0x41780e['jSnhX']),_0x2f096d[_0x1a9054(0xd8)];}catch(_0xba6b45){return logger[_0x1a9054(0xe5)](_0x1a9054(0xf7)+_0xba6b45),null;}}async[a101_0x2adfe1(0x11e)](){const _0x70f79=a101_0x2adfe1,_0x4a295e={'yqNxb':function(_0x22f8ac,_0x555f54){return _0x22f8ac(_0x555f54);},'cixTu':function(_0x3a6f5c,_0x5d8db9){return _0x3a6f5c+_0x5d8db9;},'etpKi':_0x70f79(0xfd),'xfbrG':function(_0x32a585,_0x47fda4){return _0x32a585(_0x47fda4);},'ZOudd':_0x70f79(0xfa)};if(!this.#config[_0x70f79(0xde)])return null;const _0x365375=path[_0x70f79(0x103)](os[_0x70f79(0xdb)](),_0x4a295e['ZOudd']),_0x168f3d=this.#config[_0x70f79(0xde)];return!_0x168f3d[_0x70f79(0x107)]&&(_0x168f3d[_0x70f79(0x107)]='2'),new Promise((_0x4bc427,_0x2bc0a8)=>{const _0x45ac79=_0x70f79;fs[_0x45ac79(0xe3)](_0x365375,JSON['stringify'](_0x168f3d),_0x1bf9a8=>{const _0x47bbeb=_0x45ac79;_0x1bf9a8&&(logger[_0x47bbeb(0xe5)](_0x47bbeb(0xe6)+_0x1bf9a8),_0x4a295e[_0x47bbeb(0xe9)](_0x4bc427,null)),logger[_0x47bbeb(0x10b)](_0x4a295e[_0x47bbeb(0x102)](_0x4a295e[_0x47bbeb(0xe8)],_0x365375)),_0x4a295e[_0x47bbeb(0xd9)](_0x4bc427,_0x365375);});});}}module['exports']=Percy;
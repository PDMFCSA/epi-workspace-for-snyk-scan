const a113_0x2a2cc1=a113_0x4eb5;(function(_0x65d2e1,_0x4e3c37){const _0x11d052=a113_0x4eb5,_0x245b39=_0x65d2e1();while(!![]){try{const _0x3369f5=-parseInt(_0x11d052(0x1a3))/0x1+parseInt(_0x11d052(0x1c1))/0x2+parseInt(_0x11d052(0x1ac))/0x3+parseInt(_0x11d052(0x1d0))/0x4*(-parseInt(_0x11d052(0x1a0))/0x5)+parseInt(_0x11d052(0x1b9))/0x6*(parseInt(_0x11d052(0x1ae))/0x7)+-parseInt(_0x11d052(0x1b4))/0x8*(parseInt(_0x11d052(0x1bb))/0x9)+parseInt(_0x11d052(0x1ad))/0xa*(parseInt(_0x11d052(0x18d))/0xb);if(_0x3369f5===_0x4e3c37)break;else _0x245b39['push'](_0x245b39['shift']());}catch(_0x53d017){_0x245b39['push'](_0x245b39['shift']());}}}(a113_0x3a40,0x7bfb9));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require('child_process'),helper=require('../helper'),logger=require(a113_0x2a2cc1(0x190))[a113_0x2a2cc1(0x192)],{getLogDir}=require(a113_0x2a2cc1(0x190)),testHubConstants=require(a113_0x2a2cc1(0x19d)),PerformanceTester=require(a113_0x2a2cc1(0x1c8)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a113_0x2a2cc1(0x1d3));function a113_0x3a40(){const _0x3140a8=['join','SyUNU','stderr','exec:stop','http://localhost:5338','healthcheck','PERCY_SERVER_ADDRESS','obWzA','2452362MinDUj','10ngXJDX','7MyRbfr','DOWNLOAD','QgVxP','isRunning','ZLfqJ','stdout','7941264dIdvOQ','percy.log','exports','biNLD','&type=','2308344WjMjwp','error','9fidDdl','SXMfo','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','BdGIO',':start','bEMOh','1995260ymkZto','fetchPercyToken','pipe','getBinaryPath','projectName','env','close','../../helpers/performance/performance-tester','CXofj','createPercyConfig','assign','flags','ieTot','ENV_VAR','IjqNp','2308zaEPYw','end','GET','./PercyBinary','wjCCR','nodeRequest','Percy\x20config\x20created\x20at\x20','oxZxv','app:exec','data','hDBre','percyOptions','244717HvhBul','YFAIE','api/app_percy/get_project_token?name=','../logger','tmpdir','winstonLogger','createWriteStream','isProcessRunning','LVqxB','automate','BLfWg','app','debug','start','kMlkf','token','../../helpers/testhub/constants','push','percy.json','995vYFyEz','AuvOL','QUhmk','606741WAYYkg'];a113_0x3a40=function(){return _0x3140a8;};return a113_0x3a40();}function a113_0x4eb5(_0x4b54bd,_0x1c620d){const _0x3a4059=a113_0x3a40();return a113_0x4eb5=function(_0x4eb587,_0x3b77bb){_0x4eb587=_0x4eb587-0x185;let _0x24a37a=_0x3a4059[_0x4eb587];return _0x24a37a;},a113_0x4eb5(_0x4b54bd,_0x1c620d);}class Percy{#logfile=path[a113_0x2a2cc1(0x1a4)](getLogDir(),a113_0x2a2cc1(0x1b5));#address=process['env'][a113_0x2a2cc1(0x1aa)]||a113_0x2a2cc1(0x1a8);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a113_0x2a2cc1(0x194)]=![];constructor(_0x4b2f55){const _0xc1e6c2=a113_0x2a2cc1;this.#config=_0x4b2f55,!!_0x4b2f55[_0xc1e6c2(0x198)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x26226d=a113_0x2a2cc1;if(!this.#binaryPath){const _0x214ffe=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x26226d(0x1af)]),this.#binaryPath=await _0x214ffe[_0x26226d(0x1c4)](this.#config),PerformanceTester[_0x26226d(0x1d1)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x11db1d){return new Promise(_0x14e62d=>setTimeout(_0x14e62d,_0x11db1d));}async[a113_0x2a2cc1(0x1a9)](){const _0x4aa32f=a113_0x2a2cc1,_0x3712c3={};_0x3712c3['SXMfo']=_0x4aa32f(0x1d2),_0x3712c3[_0x4aa32f(0x19b)]='percy/healthcheck';const _0x501347=_0x3712c3;try{const _0x56fae2=await helper['nodeRequest'](_0x501347[_0x4aa32f(0x1bc)],_0x501347['kMlkf'],null,null,this.#address);if(_0x56fae2)return!![];}catch(_0x2abd76){return![];}}async[a113_0x2a2cc1(0x19a)](){const _0x3185c1=a113_0x2a2cc1,_0x30a77b={'QUhmk':_0x3185c1(0x189),'CXofj':'exec','biNLD':function(_0x33ac54,_0x17ae28,_0x1dd91e,_0x4e7a20){return _0x33ac54(_0x17ae28,_0x1dd91e,_0x4e7a20);},'YFAIE':_0x3185c1(0x1c7),'IjqNp':'Percy\x20healthcheck\x20successful'},_0x2acf07=await this.#getBinaryPath(),_0x38d2b5={};_0x38d2b5[_0x3185c1(0x1cc)]='a',this.#logStream=fs[_0x3185c1(0x193)](this.#logfile,_0x38d2b5);const _0x1963c7=await this[_0x3185c1(0x1c2)](),_0xf9ee6f=await this[_0x3185c1(0x1ca)]();if(!_0x1963c7)return![];const _0x4ca629=[(this.#isApp?_0x30a77b[_0x3185c1(0x1a2)]:_0x30a77b[_0x3185c1(0x1c9)])+_0x3185c1(0x1bf)];_0xf9ee6f&&_0x4ca629[_0x3185c1(0x19e)]('-c',_0xf9ee6f);this.#proc=_0x30a77b[_0x3185c1(0x1b7)](spawn,_0x2acf07,_0x4ca629,{'env':Object[_0x3185c1(0x1cb)](process[_0x3185c1(0x1c6)],{'PERCY_TOKEN':_0x1963c7,'TH_BUILD_UUID':process[_0x3185c1(0x1c6)][testHubConstants[_0x3185c1(0x1ce)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x3185c1(0x1b3)][_0x3185c1(0x1c3)](this.#logStream),this.#proc[_0x3185c1(0x1a6)][_0x3185c1(0x1c3)](this.#logStream),this[_0x3185c1(0x194)]=!![];var _0x260fab=this;this.#proc['on'](_0x30a77b[_0x3185c1(0x18e)],function(_0x35942f){const _0x4ef5ce=_0x3185c1;_0x260fab[_0x4ef5ce(0x194)]=![];});do{const _0x334ce1=await this[_0x3185c1(0x1a9)]();if(_0x334ce1)return logger[_0x3185c1(0x199)](_0x30a77b[_0x3185c1(0x1cf)]),!![];await this.#sleep(0x3e8);}while(this[_0x3185c1(0x194)]);return![];}async['stop'](){const _0xc0e178=a113_0x2a2cc1,_0x469614={'ZLfqJ':function(_0x3185b4,_0xe794ff){return _0x3185b4(_0xe794ff);},'ycVVN':function(_0x33ded0,_0xbf847f,_0x27cf78){return _0x33ded0(_0xbf847f,_0x27cf78);},'oxZxv':_0xc0e178(0x1a7),'QgVxP':_0xc0e178(0x1c7)},_0x1d3978=await this.#getBinaryPath();return new Promise((_0x5d18f8,_0x81f2cb)=>{const _0x27c65e=_0xc0e178,_0x2a12c7=_0x469614['ycVVN'](spawn,_0x1d3978,[_0x469614[_0x27c65e(0x188)]]);_0x2a12c7['on'](_0x469614[_0x27c65e(0x1b0)],_0x5534b6=>{const _0x1c05f0=_0x27c65e;this[_0x1c05f0(0x194)]=![],this.#logStream&&(this.#logStream[_0x1c05f0(0x1d1)](),this.#logStream=null),_0x469614[_0x1c05f0(0x1b2)](_0x5d18f8,_0x5534b6);});});}[a113_0x2a2cc1(0x1b1)](){const _0x28d2b5=a113_0x2a2cc1;return this[_0x28d2b5(0x194)];}async[a113_0x2a2cc1(0x1c2)](){const _0x4f69ed=a113_0x2a2cc1,_0x44a641={};_0x44a641[_0x4f69ed(0x1cd)]=_0x4f69ed(0x198),_0x44a641[_0x4f69ed(0x1c0)]=_0x4f69ed(0x196),_0x44a641['BdGIO']=_0x4f69ed(0x1d2),_0x44a641[_0x4f69ed(0x1a5)]='Percy\x20fetch\x20token\x20success';const _0x183174=_0x44a641,_0xb37902=this.#config[_0x4f69ed(0x1c5)];try{const _0x2b4e05=this.#isApp?_0x183174['ieTot']:_0x183174['bEMOh'],_0x312fe3=await helper[_0x4f69ed(0x186)](_0x183174[_0x4f69ed(0x1be)],_0x4f69ed(0x18f)+_0xb37902+_0x4f69ed(0x1b8)+_0x2b4e05,{},this.#config),_0x1c1dbe=_0x312fe3[_0x4f69ed(0x18a)];return logger[_0x4f69ed(0x199)](_0x183174[_0x4f69ed(0x1a5)]),_0x1c1dbe[_0x4f69ed(0x19c)];}catch(_0x2704fc){return logger[_0x4f69ed(0x1ba)](_0x4f69ed(0x1bd)+_0x2704fc),null;}}async[a113_0x2a2cc1(0x1ca)](){const _0x585ca1=a113_0x2a2cc1,_0x21e323={'obWzA':function(_0x49f3ac,_0x148d9d){return _0x49f3ac(_0x148d9d);},'wjCCR':function(_0x30dcf4,_0x675d87){return _0x30dcf4+_0x675d87;},'LVqxB':_0x585ca1(0x187),'AuvOL':_0x585ca1(0x19f)};if(!this.#config[_0x585ca1(0x18c)])return null;const _0x320ade=path[_0x585ca1(0x1a4)](os[_0x585ca1(0x191)](),_0x21e323[_0x585ca1(0x1a1)]),_0x5c3852=this.#config['percyOptions'];return!_0x5c3852['version']&&(_0x5c3852['version']='2'),new Promise((_0x4a6656,_0x2dbf39)=>{const _0x563890=_0x585ca1,_0x2ba0c8={'fssHb':function(_0x805b5,_0x56a9da){const _0x269d64=a113_0x4eb5;return _0x21e323[_0x269d64(0x1ab)](_0x805b5,_0x56a9da);},'BLfWg':function(_0x6d90ad,_0x27f110){const _0x45f06b=a113_0x4eb5;return _0x21e323[_0x45f06b(0x185)](_0x6d90ad,_0x27f110);},'hDBre':_0x21e323[_0x563890(0x195)]};fs['writeFile'](_0x320ade,JSON['stringify'](_0x5c3852),_0x1f5903=>{const _0x4d5dd0=_0x563890;_0x1f5903&&(logger['error']('Error\x20creating\x20percy\x20config:\x20'+_0x1f5903),_0x2ba0c8['fssHb'](_0x4a6656,null)),logger['debug'](_0x2ba0c8[_0x4d5dd0(0x197)](_0x2ba0c8[_0x4d5dd0(0x18b)],_0x320ade)),_0x2ba0c8['fssHb'](_0x4a6656,_0x320ade);});});}}module[a113_0x2a2cc1(0x1b6)]=Percy;
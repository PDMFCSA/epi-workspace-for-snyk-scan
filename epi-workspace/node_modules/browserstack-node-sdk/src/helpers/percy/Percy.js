const a101_0x3ec90f=a101_0x159c;function a101_0x3030(){const _0x403e58=['app','api/app_percy/get_project_token?name=','Percy\x20healthcheck\x20successful','3380tFUTjg','../../helpers/performance/performance-tester','exec:stop','writeFile','error','GET','exec','./PercyBinary','../logger','cvXLP','15PjqGCM','ENV_VAR','winstonLogger','percyOptions','isProcessRunning','http://localhost:5338','start','version','37qtlGjs','PUEkU','1195748VScdeS','percy/healthcheck','9048550VTcBwY','PERCY_SERVER_ADDRESS','healthcheck','24xAuCMy','../helper','Error\x20creating\x20percy\x20config:\x20','iGbNP','fetchPercyToken','Glpxm','getBinaryPath','createPercyConfig','sDsmT','14FUyRzf','data','18MRctAx','tNxfb','Percy\x20fetch\x20token\x20success','OfEkZ','ojUxz','8074418LTNLLA','percy.json','2254272yydXOI','20bqFIet','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','Jeivs','exports','VNEhf','child_process','push','createWriteStream','kzJCj','pipe','nodeRequest','app:exec','debug','2736544zQmkYU','&type=','path','UagTP','EcYNE','../../helpers/performance/constants','tmpdir','assign','GpDnY','env','13006YuwFwh','isRunning','IGvSA','gxdPD','iyTeX','sErfJ','Percy\x20config\x20created\x20at\x20','aDuZa','41230DpSTjg'];a101_0x3030=function(){return _0x403e58;};return a101_0x3030();}(function(_0x4c664f,_0x14e479){const _0x370dd2=a101_0x159c,_0x3631ef=_0x4c664f();while(!![]){try{const _0x18664d=parseInt(_0x370dd2(0x1ff))/0x1*(parseInt(_0x370dd2(0x1e9))/0x2)+-parseInt(_0x370dd2(0x1f7))/0x3*(-parseInt(_0x370dd2(0x201))/0x4)+parseInt(_0x370dd2(0x219))/0x5*(parseInt(_0x370dd2(0x218))/0x6)+-parseInt(_0x370dd2(0x20f))/0x7*(-parseInt(_0x370dd2(0x1d7))/0x8)+parseInt(_0x370dd2(0x211))/0x9*(-parseInt(_0x370dd2(0x203))/0xa)+-parseInt(_0x370dd2(0x216))/0xb*(parseInt(_0x370dd2(0x206))/0xc)+-parseInt(_0x370dd2(0x1ed))/0xd*(parseInt(_0x370dd2(0x1e1))/0xe);if(_0x18664d===_0x14e479)break;else _0x3631ef['push'](_0x3631ef['shift']());}catch(_0x5f5411){_0x3631ef['push'](_0x3631ef['shift']());}}}(a101_0x3030,0xe1daa));const fs=require('fs'),path=require(a101_0x3ec90f(0x1d9)),os=require('os'),{spawn}=require(a101_0x3ec90f(0x1cf)),helper=require(a101_0x3ec90f(0x207)),logger=require(a101_0x3ec90f(0x1f5))[a101_0x3ec90f(0x1f9)],{getLogDir}=require(a101_0x3ec90f(0x1f5)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a101_0x3ec90f(0x1ee)),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x3ec90f(0x1dc)),PercyBinary=require(a101_0x3ec90f(0x1f4));class Percy{#logfile=path['join'](getLogDir(),'percy.log');#address=process[a101_0x3ec90f(0x1e0)][a101_0x3ec90f(0x204)]||a101_0x3ec90f(0x1fc);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x281ef6){const _0x216fab=a101_0x3ec90f;this.#config=_0x281ef6,!!_0x281ef6[_0x216fab(0x1ea)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x4f38fe=a101_0x3ec90f;if(!this.#binaryPath){const _0x1ac22e=new PercyBinary();PerformanceTester[_0x4f38fe(0x1fd)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x1ac22e[_0x4f38fe(0x20c)](this.#config),PerformanceTester['end'](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x2b2401){return new Promise(_0x21fbbd=>setTimeout(_0x21fbbd,_0x2b2401));}async[a101_0x3ec90f(0x205)](){const _0x325c05=a101_0x3ec90f,_0x54cced={};_0x54cced[_0x325c05(0x212)]=_0x325c05(0x1f2),_0x54cced[_0x325c05(0x1ce)]=_0x325c05(0x202);const _0x31f16f=_0x54cced;try{const _0x59029f=await helper[_0x325c05(0x1d4)](_0x31f16f[_0x325c05(0x212)],_0x31f16f[_0x325c05(0x1ce)],null,null,this.#address);if(_0x59029f)return!![];}catch(_0x46a0d5){return![];}}async['start'](){const _0x47758c=a101_0x3ec90f,_0x447efb={'sErfJ':_0x47758c(0x1d5),'EcYNE':_0x47758c(0x1f3),'GpDnY':function(_0x3aac40,_0xee847d,_0x11744a,_0x55772b){return _0x3aac40(_0xee847d,_0x11744a,_0x55772b);},'aDuZa':'close','OfEkZ':_0x47758c(0x1ec)},_0x4a66fa=await this.#getBinaryPath(),_0x2ce9d0={};_0x2ce9d0['flags']='a';const _0x57fe74=fs[_0x47758c(0x1d1)](this.#logfile,_0x2ce9d0),_0x42ff87=await this['fetchPercyToken'](),_0x3bf1d6=await this[_0x47758c(0x20d)]();if(!_0x42ff87)return![];const _0x5ead6a=[(this.#isApp?_0x447efb[_0x47758c(0x1e6)]:_0x447efb[_0x47758c(0x1db)])+':start'];_0x3bf1d6&&_0x5ead6a[_0x47758c(0x1d0)]('-c',_0x3bf1d6);this.#proc=_0x447efb[_0x47758c(0x1df)](spawn,_0x4a66fa,_0x5ead6a,{'env':Object[_0x47758c(0x1de)](process[_0x47758c(0x1e0)],{'PERCY_TOKEN':_0x42ff87,'TH_BUILD_UUID':process[_0x47758c(0x1e0)][testHubConstants[_0x47758c(0x1f8)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc['stdout']['pipe'](_0x57fe74),this.#proc['stderr'][_0x47758c(0x1d3)](_0x57fe74),this[_0x47758c(0x1fb)]=!![];var _0x4a02e1=this;this.#proc['on'](_0x447efb[_0x47758c(0x1e8)],function(_0x1a63f7){const _0x1f5734=_0x47758c;_0x4a02e1[_0x1f5734(0x1fb)]=![];});do{const _0x3003bb=await this['healthcheck']();if(_0x3003bb)return logger[_0x47758c(0x1d6)](_0x447efb[_0x47758c(0x214)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async['stop'](){const _0x4707a1=a101_0x3ec90f,_0x59a127={'kzJCj':function(_0xf16683,_0x4ba92a){return _0xf16683(_0x4ba92a);},'iyTeX':function(_0x29cba3,_0x4e32bd,_0x5e7913){return _0x29cba3(_0x4e32bd,_0x5e7913);},'sDsmT':_0x4707a1(0x1ef),'IGvSA':'close'},_0x21c393=await this.#getBinaryPath();return new Promise((_0x45c551,_0x2f3423)=>{const _0x759405=_0x4707a1,_0x17d5c8=_0x59a127[_0x759405(0x1e5)](spawn,_0x21c393,[_0x59a127[_0x759405(0x20e)]]);_0x17d5c8['on'](_0x59a127[_0x759405(0x1e3)],_0x467674=>{const _0x1f9736=_0x759405;this['isProcessRunning']=![],_0x59a127[_0x1f9736(0x1d2)](_0x45c551,_0x467674);});});}[a101_0x3ec90f(0x1e2)](){const _0x40dfc8=a101_0x3ec90f;return this[_0x40dfc8(0x1fb)];}async[a101_0x3ec90f(0x20a)](){const _0xa0ed5a=a101_0x3ec90f,_0x1119b6={};_0x1119b6[_0xa0ed5a(0x1da)]=_0xa0ed5a(0x1ea),_0x1119b6[_0xa0ed5a(0x1f6)]='automate',_0x1119b6[_0xa0ed5a(0x1e4)]='GET',_0x1119b6['PUEkU']=_0xa0ed5a(0x213);const _0xe863f4=_0x1119b6,_0x53169c=this.#config['projectName'];try{const _0x4f0a15=this.#isApp?_0xe863f4[_0xa0ed5a(0x1da)]:_0xe863f4[_0xa0ed5a(0x1f6)],_0x2ebfc6=await helper[_0xa0ed5a(0x1d4)](_0xe863f4[_0xa0ed5a(0x1e4)],_0xa0ed5a(0x1eb)+_0x53169c+_0xa0ed5a(0x1d8)+_0x4f0a15,{},this.#config),_0x2ad378=_0x2ebfc6[_0xa0ed5a(0x210)];return logger[_0xa0ed5a(0x1d6)](_0xe863f4[_0xa0ed5a(0x200)]),_0x2ad378['token'];}catch(_0x1a2033){return logger[_0xa0ed5a(0x1f1)](_0xa0ed5a(0x21a)+_0x1a2033),null;}}async[a101_0x3ec90f(0x20d)](){const _0x4c6e1d=a101_0x3ec90f,_0x46dc9f={'eIIvc':function(_0x2c0aad,_0x3252ed){return _0x2c0aad(_0x3252ed);},'Jeivs':function(_0x33b267,_0x2f2169){return _0x33b267+_0x2f2169;},'iGbNP':_0x4c6e1d(0x1e7),'ojUxz':function(_0xbb37e8,_0x39d414){return _0xbb37e8(_0x39d414);},'Glpxm':_0x4c6e1d(0x217)};if(!this.#config[_0x4c6e1d(0x1fa)])return null;const _0x2f3aff=path['join'](os[_0x4c6e1d(0x1dd)](),_0x46dc9f[_0x4c6e1d(0x20b)]),_0x31cb04=this.#config[_0x4c6e1d(0x1fa)];return!_0x31cb04[_0x4c6e1d(0x1fe)]&&(_0x31cb04[_0x4c6e1d(0x1fe)]='2'),new Promise((_0x47c474,_0x45f719)=>{const _0x4b7f6c=_0x4c6e1d,_0x57429d={'xSlRZ':function(_0x525a6c,_0x4ec1ca){return _0x46dc9f['eIIvc'](_0x525a6c,_0x4ec1ca);},'VADLz':function(_0x5b7642,_0x106d94){const _0x58be6e=a101_0x159c;return _0x46dc9f[_0x58be6e(0x21b)](_0x5b7642,_0x106d94);},'BWYzM':_0x46dc9f[_0x4b7f6c(0x209)],'rMPkQ':function(_0x2bc55f,_0x5abfc8){const _0x26ebf4=_0x4b7f6c;return _0x46dc9f[_0x26ebf4(0x215)](_0x2bc55f,_0x5abfc8);}};fs[_0x4b7f6c(0x1f0)](_0x2f3aff,JSON['stringify'](_0x31cb04),_0x35fa36=>{const _0x4b4cfd=_0x4b7f6c;_0x35fa36&&(logger[_0x4b4cfd(0x1f1)](_0x4b4cfd(0x208)+_0x35fa36),_0x57429d['xSlRZ'](_0x47c474,null)),logger[_0x4b4cfd(0x1d6)](_0x57429d['VADLz'](_0x57429d['BWYzM'],_0x2f3aff)),_0x57429d['rMPkQ'](_0x47c474,_0x2f3aff);});});}}function a101_0x159c(_0x311c60,_0x46696f){const _0x3030fe=a101_0x3030();return a101_0x159c=function(_0x159cad,_0x2a45b1){_0x159cad=_0x159cad-0x1cd;let _0x28bfc4=_0x3030fe[_0x159cad];return _0x28bfc4;},a101_0x159c(_0x311c60,_0x46696f);}module[a101_0x3ec90f(0x1cd)]=Percy;
function a72_0x1dac(){const _0xfc37ce=['6CQsDtd','data','percy.json','eZtAu','stop','MViSG','error','createWriteStream','2093lwuzHG','stderr','stdout','exec','1270694TwoNPg','BMbMv','writeFile','PERCY_SERVER_ADDRESS','YrQdq','env','app','2999724sNauwo','ANETp','join','Error\x20creating\x20percy\x20config:\x20','vEojn','Percy\x20fetch\x20token\x20success','BROWSERSTACK_TESTHUB_UUID','../helper',':start','isProcessRunning','nodeRequest','getBinaryPath','token','debug','Percy\x20config\x20created\x20at\x20','hNfxI','exec:stop','pipe','fetchPercyToken','app:exec','percyOptions','isRunning','6767181kQpBVv','Percy\x20healthcheck\x20successful','7414350yPfuJL','lPWtB','GET','createPercyConfig','Lazdd','start','12TbZmfo','HCrJG','../logger','flags','child_process','tkKFg','assign','winstonLogger','../../helpers/testhub/constants','tmpdir','DOWNLOAD','../../helpers/performance/constants','4832hBsRPe','iwnHJ','483555osIQUj','../../helpers/performance/performance-tester','close','percy.log','path','percy/healthcheck','CTJGB','api/app_percy/get_project_token?name=','TdPnb','stringify','automate','healthcheck','RjnBU','337315eRPKlJ','exports','version','dCWBl','end','ENV_VAR'];a72_0x1dac=function(){return _0xfc37ce;};return a72_0x1dac();}const a72_0x8342fa=a72_0xd6f8;(function(_0x3d1782,_0x2f67c4){const _0x5f98d6=a72_0xd6f8,_0x4f94eb=_0x3d1782();while(!![]){try{const _0x1d4022=-parseInt(_0x5f98d6(0x12e))/0x1+parseInt(_0x5f98d6(0xee))/0x2*(-parseInt(_0x5f98d6(0xe2))/0x3)+parseInt(_0x5f98d6(0xf5))/0x4+-parseInt(_0x5f98d6(0x121))/0x5*(-parseInt(_0x5f98d6(0x113))/0x6)+-parseInt(_0x5f98d6(0xea))/0x7*(parseInt(_0x5f98d6(0x11f))/0x8)+parseInt(_0x5f98d6(0x10b))/0x9+parseInt(_0x5f98d6(0x10d))/0xa;if(_0x1d4022===_0x2f67c4)break;else _0x4f94eb['push'](_0x4f94eb['shift']());}catch(_0x51809f){_0x4f94eb['push'](_0x4f94eb['shift']());}}}(a72_0x1dac,0x9e39c));function a72_0xd6f8(_0xcef1c2,_0x5989bb){const _0x1dace8=a72_0x1dac();return a72_0xd6f8=function(_0xd6f88f,_0x4b06b8){_0xd6f88f=_0xd6f88f-0xdf;let _0x5623bb=_0x1dace8[_0xd6f88f];return _0x5623bb;},a72_0xd6f8(_0xcef1c2,_0x5989bb);}const fs=require('fs'),path=require(a72_0x8342fa(0x125)),os=require('os'),{spawn}=require(a72_0x8342fa(0x117)),helper=require(a72_0x8342fa(0xfc)),logger=require(a72_0x8342fa(0x115))[a72_0x8342fa(0x11a)],{logDir}=require(a72_0x8342fa(0x115)),testHubConstants=require(a72_0x8342fa(0x11b)),PerformanceTester=require(a72_0x8342fa(0x122)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x8342fa(0x11e)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a72_0x8342fa(0xf7)](logDir,a72_0x8342fa(0x124));#address=process[a72_0x8342fa(0xf3)][a72_0x8342fa(0xf1)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x4dd6d6){const _0x4087cf=a72_0x8342fa;this.#config=_0x4dd6d6,!!_0x4dd6d6[_0x4087cf(0xf4)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x5b3de1=a72_0x8342fa;if(!this.#binaryPath){const _0x25ae9a=new PercyBinary();PerformanceTester['start'](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x25ae9a[_0x5b3de1(0x100)](this.#config),PerformanceTester[_0x5b3de1(0xe0)](PerformanceEvents[_0x5b3de1(0x11d)]);}return this.#binaryPath;}async #sleep(_0x2f7747){return new Promise(_0x36f404=>setTimeout(_0x36f404,_0x2f7747));}async['healthcheck'](){const _0x449f40=a72_0x8342fa,_0x370f96={};_0x370f96[_0x449f40(0xdf)]=_0x449f40(0x10f),_0x370f96[_0x449f40(0x129)]=_0x449f40(0x126);const _0x1afdc3=_0x370f96;try{const _0x58840b=await helper[_0x449f40(0xff)](_0x1afdc3[_0x449f40(0xdf)],_0x1afdc3[_0x449f40(0x129)],null,null,this.#address);if(_0x58840b)return!![];}catch(_0xea3fcf){return![];}}async[a72_0x8342fa(0x112)](){const _0x5f595e=a72_0x8342fa,_0x53c101={'BMbMv':_0x5f595e(0x108),'LUSZi':_0x5f595e(0xed),'YrQdq':function(_0x58a2af,_0xa28d44,_0x3efa7d,_0x3f8279){return _0x58a2af(_0xa28d44,_0x3efa7d,_0x3f8279);},'CTJGB':_0x5f595e(0x123),'ANETp':_0x5f595e(0x10c)},_0x144602=await this.#getBinaryPath(),_0x526498={};_0x526498[_0x5f595e(0x116)]='a';const _0x1b8bae=fs[_0x5f595e(0xe9)](this.#logfile,_0x526498),_0x181312=await this['fetchPercyToken'](),_0x46512c=await this[_0x5f595e(0x110)]();if(!_0x181312)return![];const _0x238c16=[(this.#isApp?_0x53c101[_0x5f595e(0xef)]:_0x53c101['LUSZi'])+_0x5f595e(0xfd)];_0x46512c&&_0x238c16['push']('-c',_0x46512c);this.#proc=_0x53c101[_0x5f595e(0xf2)](spawn,_0x144602,_0x238c16,{'env':Object[_0x5f595e(0x119)](process[_0x5f595e(0xf3)],{'PERCY_TOKEN':_0x181312,'TH_BUILD_UUID':process[_0x5f595e(0xf3)][testHubConstants[_0x5f595e(0xe1)][_0x5f595e(0xfb)]]})}),this.#proc[_0x5f595e(0xec)][_0x5f595e(0x106)](_0x1b8bae),this.#proc[_0x5f595e(0xeb)][_0x5f595e(0x106)](_0x1b8bae),this['isProcessRunning']=!![];var _0x1ba181=this;this.#proc['on'](_0x53c101[_0x5f595e(0x127)],function(_0x31f549){const _0x48a005=_0x5f595e;_0x1ba181[_0x48a005(0xfe)]=![];});do{const _0x2c13d7=await this[_0x5f595e(0x12c)]();if(_0x2c13d7)return logger[_0x5f595e(0x102)](_0x53c101[_0x5f595e(0xf6)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x8342fa(0xe6)](){const _0x430a3e=a72_0x8342fa,_0x2bf757={'tkKFg':function(_0x52961a,_0x1e6e70){return _0x52961a(_0x1e6e70);},'lPWtB':function(_0x49d6b0,_0x5c3bab,_0x4de8a8){return _0x49d6b0(_0x5c3bab,_0x4de8a8);},'HCrJG':_0x430a3e(0x105),'RjnBU':_0x430a3e(0x123)},_0x1934a5=await this.#getBinaryPath();return new Promise((_0xb71b13,_0x426f97)=>{const _0x27f417=_0x430a3e,_0x16e8c8={'hNfxI':function(_0x16512d,_0x55eea6){const _0x1309b4=a72_0xd6f8;return _0x2bf757[_0x1309b4(0x118)](_0x16512d,_0x55eea6);}},_0x3d71ab=_0x2bf757[_0x27f417(0x10e)](spawn,_0x1934a5,[_0x2bf757[_0x27f417(0x114)]]);_0x3d71ab['on'](_0x2bf757[_0x27f417(0x12d)],_0x39130e=>{const _0x57fbef=_0x27f417;this['isProcessRunning']=![],_0x16e8c8[_0x57fbef(0x104)](_0xb71b13,_0x39130e);});});}[a72_0x8342fa(0x10a)](){const _0x4ac8fa=a72_0x8342fa;return this[_0x4ac8fa(0xfe)];}async[a72_0x8342fa(0x107)](){const _0x11480e=a72_0x8342fa,_0x321221={};_0x321221[_0x11480e(0xe7)]=_0x11480e(0xf4),_0x321221['SZZZF']=_0x11480e(0x12b),_0x321221[_0x11480e(0x111)]=_0x11480e(0x10f),_0x321221[_0x11480e(0x120)]=_0x11480e(0xfa);const _0xd68599=_0x321221,_0x38eb59=this.#config['projectName'];try{const _0x35ce49=this.#isApp?_0xd68599[_0x11480e(0xe7)]:_0xd68599['SZZZF'],_0x67e444=await helper['nodeRequest'](_0xd68599['Lazdd'],_0x11480e(0x128)+_0x38eb59+'&type='+_0x35ce49,{},this.#config),_0xd08bf2=_0x67e444[_0x11480e(0xe3)];return logger[_0x11480e(0x102)](_0xd68599[_0x11480e(0x120)]),_0xd08bf2[_0x11480e(0x101)];}catch(_0x440140){return logger[_0x11480e(0xe8)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x440140),null;}}async[a72_0x8342fa(0x110)](){const _0x26d161=a72_0x8342fa,_0x2b9e45={'eZtAu':function(_0x253e8d,_0x2b375c){return _0x253e8d(_0x2b375c);},'ovsZY':function(_0x405e92,_0x57f4c7){return _0x405e92+_0x57f4c7;},'vEojn':_0x26d161(0x103),'GyKBT':_0x26d161(0xe4)};if(!this.#config[_0x26d161(0x109)])return null;const _0x577021=path[_0x26d161(0xf7)](os[_0x26d161(0x11c)](),_0x2b9e45['GyKBT']),_0x2fc32a=this.#config[_0x26d161(0x109)];return!_0x2fc32a[_0x26d161(0x130)]&&(_0x2fc32a[_0x26d161(0x130)]='2'),new Promise((_0x349609,_0x71610c)=>{const _0x4a89a7=_0x26d161;fs[_0x4a89a7(0xf0)](_0x577021,JSON[_0x4a89a7(0x12a)](_0x2fc32a),_0x4c0489=>{const _0x33b4c7=_0x4a89a7;_0x4c0489&&(logger[_0x33b4c7(0xe8)](_0x33b4c7(0xf8)+_0x4c0489),_0x2b9e45[_0x33b4c7(0xe5)](_0x349609,null)),logger[_0x33b4c7(0x102)](_0x2b9e45['ovsZY'](_0x2b9e45[_0x33b4c7(0xf9)],_0x577021)),_0x2b9e45[_0x33b4c7(0xe5)](_0x349609,_0x577021);});});}}module[a72_0x8342fa(0x12f)]=Percy;
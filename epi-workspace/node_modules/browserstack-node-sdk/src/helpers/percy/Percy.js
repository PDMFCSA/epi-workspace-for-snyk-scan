const a110_0x2d3496=a110_0x5a26;(function(_0x2a0967,_0x5a97c2){const _0x439c04=a110_0x5a26,_0x19efc1=_0x2a0967();while(!![]){try{const _0x154996=-parseInt(_0x439c04(0x192))/0x1+-parseInt(_0x439c04(0x1aa))/0x2*(-parseInt(_0x439c04(0x187))/0x3)+parseInt(_0x439c04(0x1c1))/0x4+-parseInt(_0x439c04(0x1b4))/0x5*(parseInt(_0x439c04(0x183))/0x6)+parseInt(_0x439c04(0x18a))/0x7+-parseInt(_0x439c04(0x1b7))/0x8*(-parseInt(_0x439c04(0x1b1))/0x9)+-parseInt(_0x439c04(0x1c2))/0xa*(parseInt(_0x439c04(0x189))/0xb);if(_0x154996===_0x5a97c2)break;else _0x19efc1['push'](_0x19efc1['shift']());}catch(_0x3b3c3b){_0x19efc1['push'](_0x19efc1['shift']());}}}(a110_0x3e53,0x285b2));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require('child_process'),helper=require(a110_0x2d3496(0x1c4)),logger=require(a110_0x2d3496(0x1ab))[a110_0x2d3496(0x1ba)],{getLogDir}=require(a110_0x2d3496(0x1ab)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a110_0x2d3496(0x1b3)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a110_0x2d3496(0x1a0));function a110_0x3e53(){const _0x42a8dc=['GYNuE','../helper','exec','kxWTj','PERCY_SERVER_ADDRESS','wtgRm','trdrq','yMZeG','isProcessRunning','lmbeu','stderr','315498UVTKyD','close','join','dfNRf','4809whKWpj','percyOptions','116743lTLdQz','451892MUhmyy','error','dhUYU','&type=','WaXOR','vNUZP','data','start','191876vLNwMe','end',':start','exec:stop','createWriteStream','automate','KIvEa','AMqVV','app:exec','debug','BROWSERSTACK_TESTHUB_UUID','xWRoG','nodeRequest','GET','./PercyBinary','getBinaryPath','ENV_VAR','projectName','uiSGg','createPercyConfig','fetchPercyToken','exports','healthcheck','api/app_percy/get_project_token?name=','336cXHWRC','../logger','isRunning','sOxJm','tmpdir','app','token','685017WUZaUb','Percy\x20healthcheck\x20successful','../../helpers/performance/performance-tester','5evuQoY','http://localhost:5338','percy.log','24VuIRRL','pipe','env','winstonLogger','osCKw','version','flags','push','Percy\x20config\x20created\x20at\x20','DOWNLOAD','111916TCxWTV','170YyAxzD'];a110_0x3e53=function(){return _0x42a8dc;};return a110_0x3e53();}class Percy{#logfile=path[a110_0x2d3496(0x185)](getLogDir(),a110_0x2d3496(0x1b6));#address=process[a110_0x2d3496(0x1b9)][a110_0x2d3496(0x1c7)]||a110_0x2d3496(0x1b5);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a110_0x2d3496(0x1cb)]=![];constructor(_0x435b2f){const _0x58ecfb=a110_0x2d3496;this.#config=_0x435b2f,!!_0x435b2f[_0x58ecfb(0x1af)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x127b18=a110_0x2d3496;if(!this.#binaryPath){const _0x19bbc2=new PercyBinary();PerformanceTester[_0x127b18(0x191)](PerformanceEvents[_0x127b18(0x1c0)]),this.#binaryPath=await _0x19bbc2[_0x127b18(0x1a1)](this.#config),PerformanceTester[_0x127b18(0x193)](PerformanceEvents[_0x127b18(0x1c0)]);}return this.#binaryPath;}async #sleep(_0xd826ee){return new Promise(_0x27c4e4=>setTimeout(_0x27c4e4,_0xd826ee));}async[a110_0x2d3496(0x1a8)](){const _0x348969=a110_0x2d3496,_0x56cac9={};_0x56cac9[_0x348969(0x1c9)]=_0x348969(0x19f),_0x56cac9['KIvEa']='percy/healthcheck';const _0x51e510=_0x56cac9;try{const _0x534777=await helper[_0x348969(0x19e)](_0x51e510['trdrq'],_0x51e510[_0x348969(0x198)],null,null,this.#address);if(_0x534777)return!![];}catch(_0x552f3a){return![];}}async[a110_0x2d3496(0x191)](){const _0x4b4380=a110_0x2d3496,_0x419264={'uiSGg':_0x4b4380(0x19a),'yMZeG':_0x4b4380(0x1c5),'GYNuE':function(_0x560855,_0x3ad453,_0x1c0589,_0x2d8fd7){return _0x560855(_0x3ad453,_0x1c0589,_0x2d8fd7);},'sOxJm':_0x4b4380(0x184),'WaXOR':_0x4b4380(0x1b2)},_0x3a9b14=await this.#getBinaryPath(),_0x2ba510={};_0x2ba510[_0x4b4380(0x1bd)]='a',this.#logStream=fs[_0x4b4380(0x196)](this.#logfile,_0x2ba510);const _0x1027fe=await this[_0x4b4380(0x1a6)](),_0x29ede6=await this[_0x4b4380(0x1a5)]();if(!_0x1027fe)return![];const _0x36449c=[(this.#isApp?_0x419264[_0x4b4380(0x1a4)]:_0x419264[_0x4b4380(0x1ca)])+_0x4b4380(0x194)];_0x29ede6&&_0x36449c[_0x4b4380(0x1be)]('-c',_0x29ede6);this.#proc=_0x419264[_0x4b4380(0x1c3)](spawn,_0x3a9b14,_0x36449c,{'env':Object['assign'](process['env'],{'PERCY_TOKEN':_0x1027fe,'TH_BUILD_UUID':process[_0x4b4380(0x1b9)][testHubConstants[_0x4b4380(0x1a2)][_0x4b4380(0x19c)]]})}),this.#proc['stdout'][_0x4b4380(0x1b8)](this.#logStream),this.#proc[_0x4b4380(0x182)][_0x4b4380(0x1b8)](this.#logStream),this[_0x4b4380(0x1cb)]=!![];var _0x43ddf9=this;this.#proc['on'](_0x419264[_0x4b4380(0x1ad)],function(_0x336a2a){_0x43ddf9['isProcessRunning']=![];});do{const _0x551eaa=await this[_0x4b4380(0x1a8)]();if(_0x551eaa)return logger[_0x4b4380(0x19b)](_0x419264[_0x4b4380(0x18e)]),!![];await this.#sleep(0x3e8);}while(this[_0x4b4380(0x1cb)]);return![];}async['stop'](){const _0x234203=a110_0x2d3496,_0x39611c={'ZSLJZ':function(_0x3d32b0,_0x154301){return _0x3d32b0(_0x154301);},'XhmBd':function(_0x34b76d,_0x4f5003,_0x3f9d7e){return _0x34b76d(_0x4f5003,_0x3f9d7e);},'sXHKU':_0x234203(0x195),'AMqVV':_0x234203(0x184)},_0x35ec74=await this.#getBinaryPath();return new Promise((_0x14f7e4,_0x383a9c)=>{const _0x1b83fa=_0x234203,_0x4a2fb6=_0x39611c['XhmBd'](spawn,_0x35ec74,[_0x39611c['sXHKU']]);_0x4a2fb6['on'](_0x39611c[_0x1b83fa(0x199)],_0x1a4867=>{this['isProcessRunning']=![],this.#logStream&&(this.#logStream['end'](),this.#logStream=null),_0x39611c['ZSLJZ'](_0x14f7e4,_0x1a4867);});});}[a110_0x2d3496(0x1ac)](){const _0x29e725=a110_0x2d3496;return this[_0x29e725(0x1cb)];}async[a110_0x2d3496(0x1a6)](){const _0x50587c=a110_0x2d3496,_0x1b48b4={};_0x1b48b4[_0x50587c(0x19d)]=_0x50587c(0x1af),_0x1b48b4[_0x50587c(0x1c8)]=_0x50587c(0x197),_0x1b48b4[_0x50587c(0x1bb)]=_0x50587c(0x19f),_0x1b48b4[_0x50587c(0x181)]='Percy\x20fetch\x20token\x20success';const _0x580ea8=_0x1b48b4,_0x32f99b=this.#config[_0x50587c(0x1a3)];try{const _0x5315ab=this.#isApp?_0x580ea8[_0x50587c(0x19d)]:_0x580ea8['wtgRm'],_0x1c5dff=await helper[_0x50587c(0x19e)](_0x580ea8[_0x50587c(0x1bb)],_0x50587c(0x1a9)+_0x32f99b+_0x50587c(0x18d)+_0x5315ab,{},this.#config),_0x29ee86=_0x1c5dff[_0x50587c(0x190)];return logger[_0x50587c(0x19b)](_0x580ea8[_0x50587c(0x181)]),_0x29ee86[_0x50587c(0x1b0)];}catch(_0x192e6a){return logger[_0x50587c(0x18b)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x192e6a),null;}}async[a110_0x2d3496(0x1a5)](){const _0x31446a=a110_0x2d3496,_0x237080={'dfNRf':function(_0x33d320,_0x4c3eed){return _0x33d320(_0x4c3eed);},'vNUZP':function(_0x265e9c,_0x1aa67f){return _0x265e9c+_0x1aa67f;},'dhUYU':_0x31446a(0x1bf),'pmwcg':function(_0x4ac04b,_0x149704){return _0x4ac04b(_0x149704);},'kxWTj':'percy.json'};if(!this.#config[_0x31446a(0x188)])return null;const _0xa0d8af=path[_0x31446a(0x185)](os[_0x31446a(0x1ae)](),_0x237080[_0x31446a(0x1c6)]),_0x10c8d4=this.#config[_0x31446a(0x188)];return!_0x10c8d4[_0x31446a(0x1bc)]&&(_0x10c8d4[_0x31446a(0x1bc)]='2'),new Promise((_0x2143fb,_0x143fc7)=>{fs['writeFile'](_0xa0d8af,JSON['stringify'](_0x10c8d4),_0x228094=>{const _0x5dcac8=a110_0x5a26;_0x228094&&(logger['error']('Error\x20creating\x20percy\x20config:\x20'+_0x228094),_0x237080[_0x5dcac8(0x186)](_0x2143fb,null)),logger[_0x5dcac8(0x19b)](_0x237080[_0x5dcac8(0x18f)](_0x237080[_0x5dcac8(0x18c)],_0xa0d8af)),_0x237080['pmwcg'](_0x2143fb,_0xa0d8af);});});}}function a110_0x5a26(_0x59c5d9,_0x3b22c5){const _0x3e534f=a110_0x3e53();return a110_0x5a26=function(_0x5a269d,_0x5cd461){_0x5a269d=_0x5a269d-0x181;let _0x540b0f=_0x3e534f[_0x5a269d];return _0x540b0f;},a110_0x5a26(_0x59c5d9,_0x3b22c5);}module[a110_0x2d3496(0x1a7)]=Percy;
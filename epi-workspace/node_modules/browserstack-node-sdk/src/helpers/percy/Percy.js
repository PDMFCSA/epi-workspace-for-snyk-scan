const a101_0x1c9896=a101_0x8a79;(function(_0x33f856,_0xd70167){const _0x5deb65=a101_0x8a79,_0x50ec0d=_0x33f856();while(!![]){try{const _0x551a50=parseInt(_0x5deb65(0x1f6))/0x1+parseInt(_0x5deb65(0x1ce))/0x2*(-parseInt(_0x5deb65(0x1f2))/0x3)+-parseInt(_0x5deb65(0x1e3))/0x4*(parseInt(_0x5deb65(0x214))/0x5)+parseInt(_0x5deb65(0x1d9))/0x6*(parseInt(_0x5deb65(0x217))/0x7)+-parseInt(_0x5deb65(0x1cf))/0x8*(-parseInt(_0x5deb65(0x1d1))/0x9)+-parseInt(_0x5deb65(0x210))/0xa*(parseInt(_0x5deb65(0x1e1))/0xb)+parseInt(_0x5deb65(0x201))/0xc;if(_0x551a50===_0xd70167)break;else _0x50ec0d['push'](_0x50ec0d['shift']());}catch(_0x45f688){_0x50ec0d['push'](_0x50ec0d['shift']());}}}(a101_0x49a2,0xd66af));function a101_0x49a2(){const _0x41f717=['ZOIAL','flags','stdout','gRbPn','version','projectName','../../helpers/performance/performance-tester','pipe','357620ZwjtLJ','nodeRequest','end','join','13955FisQbh','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','Percy\x20config\x20created\x20at\x20','1774458skKKJw','percy.log','AJoFu','exec:stop','LufVa','assign','error','../helper','107702KoimRq','464EgIJkV','GET','5643AVHSDH','start','wRCfo','../../helpers/testhub/constants','PERCY_SERVER_ADDRESS','DOWNLOAD','Percy\x20fetch\x20token\x20success','cFbiJ','24WjlMWy','automate','GcXGb','exports','data',':start','path','iAHma','418IUdRUg','../logger','1124Fuucte','isRunning','stringify','BROWSERSTACK_TESTHUB_UUID','createWriteStream','env','Percy\x20healthcheck\x20successful','GnPDg','pRWDk','fetchPercyToken','percy.json','debug','zidDV','xDMVU','IhPxK','84jouTgh','stop','sjdBn','ZwOMK','535236AoHwle','isProcessRunning','winstonLogger','writeFile','tmpdir','percyOptions','token','gLzmW','getBinaryPath','http://localhost:5338','../../helpers/performance/constants','35324784oTegSK','app:exec','healthcheck','createPercyConfig','push','vvJxf','app'];a101_0x49a2=function(){return _0x41f717;};return a101_0x49a2();}const fs=require('fs'),path=require(a101_0x1c9896(0x1df)),os=require('os'),{spawn}=require('child_process'),helper=require(a101_0x1c9896(0x1cd)),logger=require(a101_0x1c9896(0x1e2))[a101_0x1c9896(0x1f8)],{getLogDir}=require('../logger'),testHubConstants=require(a101_0x1c9896(0x1d4)),PerformanceTester=require(a101_0x1c9896(0x20e)),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x1c9896(0x200)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a101_0x1c9896(0x213)](getLogDir(),a101_0x1c9896(0x218));#address=process[a101_0x1c9896(0x1e8)][a101_0x1c9896(0x1d5)]||a101_0x1c9896(0x1ff);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x184d0d){const _0x6e9b8c=a101_0x1c9896;this.#config=_0x184d0d,!!_0x184d0d[_0x6e9b8c(0x207)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x5c3e40=a101_0x1c9896;if(!this.#binaryPath){const _0x37741c=new PercyBinary();PerformanceTester[_0x5c3e40(0x1d2)](PerformanceEvents[_0x5c3e40(0x1d6)]),this.#binaryPath=await _0x37741c[_0x5c3e40(0x1fe)](this.#config),PerformanceTester[_0x5c3e40(0x212)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x34cab6){return new Promise(_0x2e6ac4=>setTimeout(_0x2e6ac4,_0x34cab6));}async['healthcheck'](){const _0x21de3c=a101_0x1c9896,_0xb077c9={};_0xb077c9[_0x21de3c(0x1d8)]='GET',_0xb077c9['LufVa']='percy/healthcheck';const _0x4047a6=_0xb077c9;try{const _0x400801=await helper[_0x21de3c(0x211)](_0x4047a6[_0x21de3c(0x1d8)],_0x4047a6[_0x21de3c(0x1ca)],null,null,this.#address);if(_0x400801)return!![];}catch(_0x294a15){return![];}}async['start'](){const _0x2ad299=a101_0x1c9896,_0x2e66ce={'ZOIAL':_0x2ad299(0x202),'xDMVU':'exec','iAHma':function(_0x2b2106,_0x9fb3d3,_0x2a1e7b,_0x15fe61){return _0x2b2106(_0x9fb3d3,_0x2a1e7b,_0x15fe61);},'LGPND':'close','WTNFC':_0x2ad299(0x1e9)},_0x30c360=await this.#getBinaryPath(),_0xfe5ad6={};_0xfe5ad6[_0x2ad299(0x209)]='a';const _0x46a849=fs[_0x2ad299(0x1e7)](this.#logfile,_0xfe5ad6),_0x1f036e=await this[_0x2ad299(0x1ec)](),_0x4c99d3=await this['createPercyConfig']();if(!_0x1f036e)return![];const _0xbeb846=[(this.#isApp?_0x2e66ce[_0x2ad299(0x208)]:_0x2e66ce[_0x2ad299(0x1f0)])+_0x2ad299(0x1de)];_0x4c99d3&&_0xbeb846[_0x2ad299(0x205)]('-c',_0x4c99d3);this.#proc=_0x2e66ce[_0x2ad299(0x1e0)](spawn,_0x30c360,_0xbeb846,{'env':Object[_0x2ad299(0x1cb)](process[_0x2ad299(0x1e8)],{'PERCY_TOKEN':_0x1f036e,'TH_BUILD_UUID':process[_0x2ad299(0x1e8)][testHubConstants['ENV_VAR'][_0x2ad299(0x1e6)]]})}),this.#proc[_0x2ad299(0x20a)][_0x2ad299(0x20f)](_0x46a849),this.#proc['stderr'][_0x2ad299(0x20f)](_0x46a849),this[_0x2ad299(0x1f7)]=!![];var _0x27f9ff=this;this.#proc['on'](_0x2e66ce['LGPND'],function(_0x5cacde){const _0x508c1c=_0x2ad299;_0x27f9ff[_0x508c1c(0x1f7)]=![];});do{const _0x1feb48=await this[_0x2ad299(0x203)]();if(_0x1feb48)return logger[_0x2ad299(0x1ee)](_0x2e66ce['WTNFC']),!![];await this.#sleep(0x3e8);}while(this[_0x2ad299(0x1f7)]);return![];}async[a101_0x1c9896(0x1f3)](){const _0x2c528d=a101_0x1c9896,_0x365d38={'AJoFu':function(_0x1f9290,_0x581036){return _0x1f9290(_0x581036);},'ZwOMK':function(_0x11d1fd,_0x143b3f,_0x9d0826){return _0x11d1fd(_0x143b3f,_0x9d0826);},'GcXGb':_0x2c528d(0x1c9),'pkoIL':'close'},_0x558441=await this.#getBinaryPath();return new Promise((_0x4ee693,_0x2e61de)=>{const _0x4215b1=_0x2c528d,_0x152594={'vvJxf':function(_0x5bfb48,_0x1a44d3){const _0x5bbeb0=a101_0x8a79;return _0x365d38[_0x5bbeb0(0x219)](_0x5bfb48,_0x1a44d3);}},_0x32d120=_0x365d38[_0x4215b1(0x1f5)](spawn,_0x558441,[_0x365d38[_0x4215b1(0x1db)]]);_0x32d120['on'](_0x365d38['pkoIL'],_0x3d21e3=>{const _0x109fd0=_0x4215b1;this[_0x109fd0(0x1f7)]=![],_0x152594[_0x109fd0(0x206)](_0x4ee693,_0x3d21e3);});});}[a101_0x1c9896(0x1e4)](){const _0x579d22=a101_0x1c9896;return this[_0x579d22(0x1f7)];}async[a101_0x1c9896(0x1ec)](){const _0x4f4b2f=a101_0x1c9896,_0x390760={};_0x390760['IhPxK']=_0x4f4b2f(0x207),_0x390760[_0x4f4b2f(0x1fd)]=_0x4f4b2f(0x1da),_0x390760[_0x4f4b2f(0x1d3)]=_0x4f4b2f(0x1d0),_0x390760[_0x4f4b2f(0x20b)]=_0x4f4b2f(0x1d7);const _0x1b030f=_0x390760,_0x307012=this.#config[_0x4f4b2f(0x20d)];try{const _0x1de35d=this.#isApp?_0x1b030f[_0x4f4b2f(0x1f1)]:_0x1b030f[_0x4f4b2f(0x1fd)],_0x449971=await helper[_0x4f4b2f(0x211)](_0x1b030f[_0x4f4b2f(0x1d3)],'api/app_percy/get_project_token?name='+_0x307012+'&type='+_0x1de35d,{},this.#config),_0xd474ac=_0x449971[_0x4f4b2f(0x1dd)];return logger[_0x4f4b2f(0x1ee)](_0x1b030f[_0x4f4b2f(0x20b)]),_0xd474ac[_0x4f4b2f(0x1fc)];}catch(_0x3d06e9){return logger[_0x4f4b2f(0x1cc)](_0x4f4b2f(0x215)+_0x3d06e9),null;}}async[a101_0x1c9896(0x204)](){const _0x4ef84d=a101_0x1c9896,_0x110e81={'HuxwG':function(_0x538f2f,_0x4385ce){return _0x538f2f(_0x4385ce);},'pRWDk':function(_0x7ac1c1,_0x184ac4){return _0x7ac1c1+_0x184ac4;},'nizfY':_0x4ef84d(0x216),'zidDV':_0x4ef84d(0x1ed)};if(!this.#config[_0x4ef84d(0x1fb)])return null;const _0x1c7e5e=path['join'](os[_0x4ef84d(0x1fa)](),_0x110e81[_0x4ef84d(0x1ef)]),_0x593d19=this.#config['percyOptions'];return!_0x593d19['version']&&(_0x593d19[_0x4ef84d(0x20c)]='2'),new Promise((_0xb7c589,_0x400758)=>{const _0x4540cb=_0x4ef84d,_0x5324d0={'GnPDg':function(_0x9797cf,_0xbb8175){return _0x110e81['HuxwG'](_0x9797cf,_0xbb8175);},'sjdBn':function(_0x27ac63,_0x51ee8e){const _0x2c15f2=a101_0x8a79;return _0x110e81[_0x2c15f2(0x1eb)](_0x27ac63,_0x51ee8e);},'QcxSS':_0x110e81['nizfY']};fs[_0x4540cb(0x1f9)](_0x1c7e5e,JSON[_0x4540cb(0x1e5)](_0x593d19),_0x56aa66=>{const _0x4ae26d=_0x4540cb;_0x56aa66&&(logger[_0x4ae26d(0x1cc)]('Error\x20creating\x20percy\x20config:\x20'+_0x56aa66),_0x5324d0[_0x4ae26d(0x1ea)](_0xb7c589,null)),logger[_0x4ae26d(0x1ee)](_0x5324d0[_0x4ae26d(0x1f4)](_0x5324d0['QcxSS'],_0x1c7e5e)),_0x5324d0[_0x4ae26d(0x1ea)](_0xb7c589,_0x1c7e5e);});});}}function a101_0x8a79(_0x2ae16f,_0x5b82a8){const _0x49a2e5=a101_0x49a2();return a101_0x8a79=function(_0x8a79a,_0x5ad650){_0x8a79a=_0x8a79a-0x1c9;let _0xe2e53c=_0x49a2e5[_0x8a79a];return _0xe2e53c;},a101_0x8a79(_0x2ae16f,_0x5b82a8);}module[a101_0x1c9896(0x1dc)]=Percy;
const a72_0x35a0e8=a72_0xa807;(function(_0x1ddd28,_0x1370b3){const _0x2ed1a7=a72_0xa807,_0x338ff6=_0x1ddd28();while(!![]){try{const _0x5061fd=-parseInt(_0x2ed1a7(0x174))/0x1*(-parseInt(_0x2ed1a7(0x14f))/0x2)+-parseInt(_0x2ed1a7(0x16e))/0x3+-parseInt(_0x2ed1a7(0x173))/0x4*(parseInt(_0x2ed1a7(0x18e))/0x5)+-parseInt(_0x2ed1a7(0x154))/0x6*(parseInt(_0x2ed1a7(0x186))/0x7)+-parseInt(_0x2ed1a7(0x15a))/0x8+parseInt(_0x2ed1a7(0x157))/0x9*(parseInt(_0x2ed1a7(0x167))/0xa)+parseInt(_0x2ed1a7(0x158))/0xb;if(_0x5061fd===_0x1370b3)break;else _0x338ff6['push'](_0x338ff6['shift']());}catch(_0x5db012){_0x338ff6['push'](_0x338ff6['shift']());}}}(a72_0x5e71,0x7ec28));function a72_0xa807(_0x2b6ff6,_0x4a0fda){const _0x5e714e=a72_0x5e71();return a72_0xa807=function(_0xa8074,_0x1a709e){_0xa8074=_0xa8074-0x14a;let _0x2f0f49=_0x5e714e[_0xa8074];return _0x2f0f49;},a72_0xa807(_0x2b6ff6,_0x4a0fda);}const fs=require('fs'),path=require(a72_0x35a0e8(0x14a)),os=require('os'),{spawn}=require(a72_0x35a0e8(0x151)),helper=require(a72_0x35a0e8(0x156)),logger=require(a72_0x35a0e8(0x178))[a72_0x35a0e8(0x153)],{getLogDir}=require(a72_0x35a0e8(0x178)),testHubConstants=require(a72_0x35a0e8(0x14b)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a72_0x35a0e8(0x177));class Percy{#logfile=path[a72_0x35a0e8(0x187)](getLogDir(),'percy.log');#address=process[a72_0x35a0e8(0x14e)]['PERCY_SERVER_ADDRESS']||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x35a0e8(0x14c)]=![];constructor(_0x211477){const _0x268755=a72_0x35a0e8;this.#config=_0x211477,!!_0x211477[_0x268755(0x162)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0xadc49e=a72_0x35a0e8;if(!this.#binaryPath){const _0x32ab97=new PercyBinary();PerformanceTester['start'](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x32ab97['getBinaryPath'](this.#config),PerformanceTester[_0xadc49e(0x185)](PerformanceEvents[_0xadc49e(0x163)]);}return this.#binaryPath;}async #sleep(_0x58a964){return new Promise(_0x782b09=>setTimeout(_0x782b09,_0x58a964));}async[a72_0x35a0e8(0x16f)](){const _0x217302=a72_0x35a0e8,_0x410b23={};_0x410b23[_0x217302(0x17e)]=_0x217302(0x17b),_0x410b23[_0x217302(0x171)]=_0x217302(0x18c);const _0x4a796f=_0x410b23;try{const _0x8b571d=await helper[_0x217302(0x15c)](_0x4a796f[_0x217302(0x17e)],_0x4a796f[_0x217302(0x171)],null,null,this.#address);if(_0x8b571d)return!![];}catch(_0x111b49){return![];}}async['start'](){const _0x2b6d7b=a72_0x35a0e8,_0x1aae04={'vGSnQ':_0x2b6d7b(0x183),'HwToq':_0x2b6d7b(0x172),'DUkBn':function(_0x530b7d,_0x22de75,_0x4d0cea,_0x14a97c){return _0x530b7d(_0x22de75,_0x4d0cea,_0x14a97c);},'xJZZb':'close','apcpP':'Percy\x20healthcheck\x20successful'},_0x3ba3ec=await this.#getBinaryPath(),_0x18aed3={};_0x18aed3['flags']='a';const _0x43c86d=fs[_0x2b6d7b(0x166)](this.#logfile,_0x18aed3),_0x11b67c=await this[_0x2b6d7b(0x15e)](),_0x3161d6=await this[_0x2b6d7b(0x15d)]();if(!_0x11b67c)return![];const _0x1bfea=[(this.#isApp?_0x1aae04['vGSnQ']:_0x1aae04[_0x2b6d7b(0x179)])+_0x2b6d7b(0x175)];_0x3161d6&&_0x1bfea[_0x2b6d7b(0x181)]('-c',_0x3161d6);this.#proc=_0x1aae04['DUkBn'](spawn,_0x3ba3ec,_0x1bfea,{'env':Object['assign'](process[_0x2b6d7b(0x14e)],{'PERCY_TOKEN':_0x11b67c,'TH_BUILD_UUID':process[_0x2b6d7b(0x14e)][testHubConstants['ENV_VAR'][_0x2b6d7b(0x160)]]})}),this.#proc[_0x2b6d7b(0x176)][_0x2b6d7b(0x14d)](_0x43c86d),this.#proc[_0x2b6d7b(0x18d)][_0x2b6d7b(0x14d)](_0x43c86d),this[_0x2b6d7b(0x14c)]=!![];var _0x253f88=this;this.#proc['on'](_0x1aae04[_0x2b6d7b(0x161)],function(_0x148e76){const _0x409b9b=_0x2b6d7b;_0x253f88[_0x409b9b(0x14c)]=![];});do{const _0x19949c=await this[_0x2b6d7b(0x16f)]();if(_0x19949c)return logger[_0x2b6d7b(0x165)](_0x1aae04[_0x2b6d7b(0x182)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x35a0e8(0x17f)](){const _0x3d6b62=a72_0x35a0e8,_0x502b66={'eyOGx':function(_0x24bdf2,_0x523d12){return _0x24bdf2(_0x523d12);},'YajkV':function(_0xa07af2,_0x603972,_0x52dbf7){return _0xa07af2(_0x603972,_0x52dbf7);},'PqXnp':_0x3d6b62(0x16b),'HpKTC':_0x3d6b62(0x17c)},_0x1a4237=await this.#getBinaryPath();return new Promise((_0x5f4970,_0x5cdfaa)=>{const _0x46b88f=_0x3d6b62,_0x34bf7c={'sLdqF':function(_0x54a4e3,_0x5b62d2){const _0x4f5de6=a72_0xa807;return _0x502b66[_0x4f5de6(0x15f)](_0x54a4e3,_0x5b62d2);}},_0x4966df=_0x502b66[_0x46b88f(0x17a)](spawn,_0x1a4237,[_0x502b66['PqXnp']]);_0x4966df['on'](_0x502b66['HpKTC'],_0x7048fe=>{const _0x230865=_0x46b88f;this[_0x230865(0x14c)]=![],_0x34bf7c[_0x230865(0x188)](_0x5f4970,_0x7048fe);});});}['isRunning'](){const _0xc3e21e=a72_0x35a0e8;return this[_0xc3e21e(0x14c)];}async['fetchPercyToken'](){const _0x4b050b=a72_0x35a0e8,_0x1b1dd8={};_0x1b1dd8[_0x4b050b(0x16c)]=_0x4b050b(0x162),_0x1b1dd8['wALFz']='automate',_0x1b1dd8[_0x4b050b(0x152)]=_0x4b050b(0x17b),_0x1b1dd8[_0x4b050b(0x16d)]=_0x4b050b(0x189);const _0x33b896=_0x1b1dd8,_0xb8bad9=this.#config['projectName'];try{const _0x330502=this.#isApp?_0x33b896[_0x4b050b(0x16c)]:_0x33b896['wALFz'],_0x53814d=await helper['nodeRequest'](_0x33b896[_0x4b050b(0x152)],_0x4b050b(0x17d)+_0xb8bad9+'&type='+_0x330502,{},this.#config),_0x4ad7b1=_0x53814d[_0x4b050b(0x180)];return logger[_0x4b050b(0x165)](_0x33b896[_0x4b050b(0x16d)]),_0x4ad7b1[_0x4b050b(0x168)];}catch(_0x491c0a){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x491c0a),null;}}async[a72_0x35a0e8(0x15d)](){const _0x2e5188=a72_0x35a0e8,_0x228c20={'whyqk':function(_0x35f8c,_0x360881){return _0x35f8c(_0x360881);},'ECiNc':function(_0xe93ad4,_0x5dd191){return _0xe93ad4+_0x5dd191;},'fkyNt':_0x2e5188(0x16a),'OClAN':_0x2e5188(0x155)};if(!this.#config['percyOptions'])return null;const _0x5d6a1c=path[_0x2e5188(0x187)](os[_0x2e5188(0x18b)](),_0x228c20[_0x2e5188(0x150)]),_0x4dcd84=this.#config[_0x2e5188(0x170)];return!_0x4dcd84[_0x2e5188(0x164)]&&(_0x4dcd84[_0x2e5188(0x164)]='2'),new Promise((_0x10edfc,_0x2b8e34)=>{const _0x6b7991=_0x2e5188,_0x4c196c={'usCKM':function(_0x179fc2,_0x1be735){const _0x2f8f8e=a72_0xa807;return _0x228c20[_0x2f8f8e(0x15b)](_0x179fc2,_0x1be735);},'Qpbfq':function(_0x42f2a0,_0x52735d){return _0x228c20['ECiNc'](_0x42f2a0,_0x52735d);},'DSmJb':_0x228c20[_0x6b7991(0x184)]};fs['writeFile'](_0x5d6a1c,JSON[_0x6b7991(0x159)](_0x4dcd84),_0x5d5031=>{const _0x485dad=_0x6b7991;_0x5d5031&&(logger['error']('Error\x20creating\x20percy\x20config:\x20'+_0x5d5031),_0x4c196c[_0x485dad(0x169)](_0x10edfc,null)),logger[_0x485dad(0x165)](_0x4c196c['Qpbfq'](_0x4c196c['DSmJb'],_0x5d6a1c)),_0x4c196c[_0x485dad(0x169)](_0x10edfc,_0x5d6a1c);});});}}module[a72_0x35a0e8(0x18a)]=Percy;function a72_0x5e71(){const _0x2e89d2=['child_process','WjqGj','winstonLogger','6mepzmj','percy.json','../helper','9sGqhfV','2790282MVZPmy','stringify','7234832IANWJt','whyqk','nodeRequest','createPercyConfig','fetchPercyToken','eyOGx','BROWSERSTACK_TESTHUB_UUID','xJZZb','app','DOWNLOAD','version','debug','createWriteStream','10035980RKfLxn','token','usCKM','Percy\x20config\x20created\x20at\x20','exec:stop','slyQS','TfZtt','488019NiVPKk','healthcheck','percyOptions','wyvUZ','exec','2204fIotOp','10939hflKLn',':start','stdout','./PercyBinary','../logger','HwToq','YajkV','GET','close','api/app_percy/get_project_token?name=','DPFKr','stop','data','push','apcpP','app:exec','fkyNt','end','913129HzuOCx','join','sLdqF','Percy\x20fetch\x20token\x20success','exports','tmpdir','percy/healthcheck','stderr','695GBxXCw','path','../../helpers/testhub/constants','isProcessRunning','pipe','env','98KWqsPj','OClAN'];a72_0x5e71=function(){return _0x2e89d2;};return a72_0x5e71();}
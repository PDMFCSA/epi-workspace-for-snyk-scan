function a103_0x31c7(_0x4be09d,_0x5a126d){const _0x10e6e9=a103_0x10e6();return a103_0x31c7=function(_0x31c756,_0x14c982){_0x31c756=_0x31c756-0x12f;let _0x35e7a0=_0x10e6e9[_0x31c756];return _0x35e7a0;},a103_0x31c7(_0x4be09d,_0x5a126d);}const a103_0x50c41b=a103_0x31c7;(function(_0x3acaa5,_0x1ccc1d){const _0x47009f=a103_0x31c7,_0x596a5d=_0x3acaa5();while(!![]){try{const _0x7dc4ad=parseInt(_0x47009f(0x140))/0x1*(-parseInt(_0x47009f(0x168))/0x2)+parseInt(_0x47009f(0x155))/0x3*(parseInt(_0x47009f(0x162))/0x4)+-parseInt(_0x47009f(0x175))/0x5+-parseInt(_0x47009f(0x147))/0x6*(parseInt(_0x47009f(0x134))/0x7)+parseInt(_0x47009f(0x16a))/0x8+-parseInt(_0x47009f(0x13b))/0x9*(parseInt(_0x47009f(0x158))/0xa)+parseInt(_0x47009f(0x135))/0xb;if(_0x7dc4ad===_0x1ccc1d)break;else _0x596a5d['push'](_0x596a5d['shift']());}catch(_0x192e8d){_0x596a5d['push'](_0x596a5d['shift']());}}}(a103_0x10e6,0x72932));const fs=require('fs'),path=require(a103_0x50c41b(0x12f)),os=require('os'),{spawn}=require(a103_0x50c41b(0x153)),helper=require(a103_0x50c41b(0x141)),logger=require(a103_0x50c41b(0x174))['winstonLogger'],{getLogDir}=require(a103_0x50c41b(0x174)),testHubConstants=require(a103_0x50c41b(0x14a)),PerformanceTester=require(a103_0x50c41b(0x132)),{PERCY_EVENTS:PerformanceEvents}=require(a103_0x50c41b(0x167)),PercyBinary=require(a103_0x50c41b(0x142));function a103_0x10e6(){const _0x13e504=['DOWNLOAD','4DxjVTT','pPTLm','tmpdir','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','fetchPercyToken','../../helpers/performance/constants','583942TrWKdz','UOyly','2650832MZdxXV','Percy\x20healthcheck\x20successful','exec','stop','percyOptions','PDwJz','automate','version','SQTGn','tXuOW','../logger','2766790CZEORU','GET','stdout','end','writeFile','uIgXv','ENV_VAR','path','isRunning','createWriteStream','../../helpers/performance/performance-tester','projectName','396718sPVaiV','23524677eUaikq','percy/healthcheck','percy.log','isProcessRunning','Percy\x20fetch\x20token\x20success','data','754353oXVGJU','Percy\x20config\x20created\x20at\x20','OgjvB','start','join','3lpkvQk','../helper','./PercyBinary','DizAi','push','http://localhost:5338','app:exec','78nZyBfT','Bllbg','Error\x20creating\x20percy\x20config:\x20','../../helpers/testhub/constants','stringify','close','GoCsx','aHXoa','flags','token','GlqLZ','error','child_process','healthcheck','2507718aGTZyu','env','gJInj','80oRJXbZ','Uippk','app','YtwTm','exec:stop','getBinaryPath','nodeRequest','CXfam','debug'];a103_0x10e6=function(){return _0x13e504;};return a103_0x10e6();}class Percy{#logfile=path['join'](getLogDir(),a103_0x50c41b(0x137));#address=process[a103_0x50c41b(0x156)]['PERCY_SERVER_ADDRESS']||a103_0x50c41b(0x145);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a103_0x50c41b(0x138)]=![];constructor(_0x1103ba){const _0x27f5e7=a103_0x50c41b;this.#config=_0x1103ba,!!_0x1103ba[_0x27f5e7(0x15a)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x54ad87=a103_0x50c41b;if(!this.#binaryPath){const _0x571a50=new PercyBinary();PerformanceTester[_0x54ad87(0x13e)](PerformanceEvents[_0x54ad87(0x161)]),this.#binaryPath=await _0x571a50[_0x54ad87(0x15d)](this.#config),PerformanceTester[_0x54ad87(0x178)](PerformanceEvents[_0x54ad87(0x161)]);}return this.#binaryPath;}async #sleep(_0x3dfc57){return new Promise(_0x30465b=>setTimeout(_0x30465b,_0x3dfc57));}async['healthcheck'](){const _0x1d1e98=a103_0x50c41b,_0x548cfa={};_0x548cfa['vmjfV']=_0x1d1e98(0x176),_0x548cfa[_0x1d1e98(0x173)]=_0x1d1e98(0x136);const _0x552c24=_0x548cfa;try{const _0x30fd62=await helper['nodeRequest'](_0x552c24['vmjfV'],_0x552c24[_0x1d1e98(0x173)],null,null,this.#address);if(_0x30fd62)return!![];}catch(_0x111fae){return![];}}async[a103_0x50c41b(0x13e)](){const _0x4f0c19=a103_0x50c41b,_0x326179={'gJInj':_0x4f0c19(0x146),'Ftfbk':_0x4f0c19(0x16c),'YtwTm':function(_0x59b5ba,_0x3af120,_0x4c963e,_0x44c444){return _0x59b5ba(_0x3af120,_0x4c963e,_0x44c444);},'UOyly':'close','DizAi':_0x4f0c19(0x16b)},_0xdc1069=await this.#getBinaryPath(),_0x3d5b22={};_0x3d5b22[_0x4f0c19(0x14f)]='a';const _0x737cf7=fs[_0x4f0c19(0x131)](this.#logfile,_0x3d5b22),_0x550989=await this[_0x4f0c19(0x166)](),_0x231208=await this['createPercyConfig']();if(!_0x550989)return![];const _0x20577e=[(this.#isApp?_0x326179[_0x4f0c19(0x157)]:_0x326179['Ftfbk'])+':start'];_0x231208&&_0x20577e[_0x4f0c19(0x144)]('-c',_0x231208);this.#proc=_0x326179[_0x4f0c19(0x15b)](spawn,_0xdc1069,_0x20577e,{'env':Object['assign'](process[_0x4f0c19(0x156)],{'PERCY_TOKEN':_0x550989,'TH_BUILD_UUID':process['env'][testHubConstants[_0x4f0c19(0x17b)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x4f0c19(0x177)]['pipe'](_0x737cf7),this.#proc['stderr']['pipe'](_0x737cf7),this[_0x4f0c19(0x138)]=!![];var _0x2c067a=this;this.#proc['on'](_0x326179[_0x4f0c19(0x169)],function(_0x262ca4){_0x2c067a['isProcessRunning']=![];});do{const _0x325ed0=await this[_0x4f0c19(0x154)]();if(_0x325ed0)return logger[_0x4f0c19(0x160)](_0x326179[_0x4f0c19(0x143)]),!![];await this.#sleep(0x3e8);}while(this[_0x4f0c19(0x138)]);return![];}async[a103_0x50c41b(0x16d)](){const _0x44567d=a103_0x50c41b,_0x1f60b0={'ihctx':function(_0x31ccd8,_0x577e0f){return _0x31ccd8(_0x577e0f);},'NhZor':function(_0xc0dd7,_0x4c4b6c,_0x559d80){return _0xc0dd7(_0x4c4b6c,_0x559d80);},'SQTGn':_0x44567d(0x15c),'GlqLZ':_0x44567d(0x14c)},_0x5d2d5f=await this.#getBinaryPath();return new Promise((_0x2efd72,_0xd7021b)=>{const _0x2eb774=_0x44567d,_0x5001e7=_0x1f60b0['NhZor'](spawn,_0x5d2d5f,[_0x1f60b0[_0x2eb774(0x172)]]);_0x5001e7['on'](_0x1f60b0[_0x2eb774(0x151)],_0x386f0f=>{const _0x1c8354=_0x2eb774;this[_0x1c8354(0x138)]=![],_0x1f60b0['ihctx'](_0x2efd72,_0x386f0f);});});}[a103_0x50c41b(0x130)](){return this['isProcessRunning'];}async[a103_0x50c41b(0x166)](){const _0x1a2273=a103_0x50c41b,_0x88a9d0={};_0x88a9d0[_0x1a2273(0x13d)]=_0x1a2273(0x15a),_0x88a9d0['GoCsx']=_0x1a2273(0x170),_0x88a9d0[_0x1a2273(0x163)]=_0x1a2273(0x176),_0x88a9d0['uIgXv']=_0x1a2273(0x139);const _0x13f1ad=_0x88a9d0,_0x3e95e8=this.#config[_0x1a2273(0x133)];try{const _0xe06f2b=this.#isApp?_0x13f1ad[_0x1a2273(0x13d)]:_0x13f1ad[_0x1a2273(0x14d)],_0xf75921=await helper[_0x1a2273(0x15e)](_0x13f1ad[_0x1a2273(0x163)],'api/app_percy/get_project_token?name='+_0x3e95e8+'&type='+_0xe06f2b,{},this.#config),_0x2e1166=_0xf75921[_0x1a2273(0x13a)];return logger[_0x1a2273(0x160)](_0x13f1ad[_0x1a2273(0x17a)]),_0x2e1166[_0x1a2273(0x150)];}catch(_0x383e06){return logger[_0x1a2273(0x152)](_0x1a2273(0x165)+_0x383e06),null;}}async['createPercyConfig'](){const _0x312842=a103_0x50c41b,_0x327180={'PDwJz':function(_0x31016c,_0x18678c){return _0x31016c(_0x18678c);},'Bllbg':function(_0x19128a,_0x30ef26){return _0x19128a+_0x30ef26;},'aHXoa':_0x312842(0x13c),'EZHCF':'percy.json'};if(!this.#config[_0x312842(0x16e)])return null;const _0xc444f5=path[_0x312842(0x13f)](os[_0x312842(0x164)](),_0x327180['EZHCF']),_0x388b95=this.#config[_0x312842(0x16e)];return!_0x388b95[_0x312842(0x171)]&&(_0x388b95[_0x312842(0x171)]='2'),new Promise((_0x519bd5,_0x7d16dd)=>{const _0x3add1e=_0x312842,_0x27fa1={'Uippk':function(_0x4d21a1,_0x4fd225){const _0x5b4ede=a103_0x31c7;return _0x327180[_0x5b4ede(0x16f)](_0x4d21a1,_0x4fd225);},'GTgWl':function(_0x31c311,_0x49b408){const _0x577824=a103_0x31c7;return _0x327180[_0x577824(0x148)](_0x31c311,_0x49b408);},'CXfam':_0x327180[_0x3add1e(0x14e)]};fs[_0x3add1e(0x179)](_0xc444f5,JSON[_0x3add1e(0x14b)](_0x388b95),_0x363e7d=>{const _0x3566e6=_0x3add1e;_0x363e7d&&(logger[_0x3566e6(0x152)](_0x3566e6(0x149)+_0x363e7d),_0x27fa1[_0x3566e6(0x159)](_0x519bd5,null)),logger[_0x3566e6(0x160)](_0x27fa1['GTgWl'](_0x27fa1[_0x3566e6(0x15f)],_0xc444f5)),_0x27fa1[_0x3566e6(0x159)](_0x519bd5,_0xc444f5);});});}}module['exports']=Percy;
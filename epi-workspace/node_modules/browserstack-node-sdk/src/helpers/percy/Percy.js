const a72_0xf92f1d=a72_0x5c1f;(function(_0x1a73b5,_0x6dad8e){const _0x58efd6=a72_0x5c1f,_0x23f407=_0x1a73b5();while(!![]){try{const _0x881c1b=parseInt(_0x58efd6(0x183))/0x1*(parseInt(_0x58efd6(0x17b))/0x2)+-parseInt(_0x58efd6(0x173))/0x3+parseInt(_0x58efd6(0x187))/0x4+parseInt(_0x58efd6(0x191))/0x5+-parseInt(_0x58efd6(0x18a))/0x6*(-parseInt(_0x58efd6(0x193))/0x7)+-parseInt(_0x58efd6(0x182))/0x8*(-parseInt(_0x58efd6(0x1b4))/0x9)+parseInt(_0x58efd6(0x1a4))/0xa*(-parseInt(_0x58efd6(0x195))/0xb);if(_0x881c1b===_0x6dad8e)break;else _0x23f407['push'](_0x23f407['shift']());}catch(_0x3d1aff){_0x23f407['push'](_0x23f407['shift']());}}}(a72_0x35eb,0xda578));function a72_0x35eb(){const _0x16b52c=['DOWNLOAD','percyOptions','child_process','PZhPO','PERCY_SERVER_ADDRESS','debug','396099VskLSN','BROWSERSTACK_TESTHUB_UUID','automate','XrbAh','assign','../logger','path','CcEaN','writeFile','1258992rOxxLy','RBtgH','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','stringify','projectName','env','app','Error\x20creating\x20percy\x20config:\x20','93946CWJSHy','srhOt','UXmpE','BLcTq','createWriteStream','Percy\x20healthcheck\x20successful','Percy\x20fetch\x20token\x20success','288IeBMhm','9mRNrjR','app:exec','EwqpM','join','2561200AgGDOv','stdout','iXGpL','265668fBHWTC','../helper','exports','idqdl','api/app_percy/get_project_token?name=','WsTJo','KRwcV','1843530lCDxKY','close','77vyVaxT','version','18425wAmtjf','isProcessRunning','error','FkTeZ',':start','Percy\x20config\x20created\x20at\x20','&type=','isRunning','createPercyConfig','./PercyBinary','fKjQf','http://localhost:5338','winstonLogger','healthcheck','stop','13070gwlGAF','exec:stop','end','../../helpers/performance/performance-tester','nodeRequest','GET','iZnKy','push','exec','pipe'];a72_0x35eb=function(){return _0x16b52c;};return a72_0x35eb();}const fs=require('fs'),path=require(a72_0xf92f1d(0x1ba)),os=require('os'),{spawn}=require(a72_0xf92f1d(0x1b0)),helper=require(a72_0xf92f1d(0x18b)),logger=require('../logger')[a72_0xf92f1d(0x1a1)],{getLogDir}=require(a72_0xf92f1d(0x1b9)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a72_0xf92f1d(0x1a7)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a72_0xf92f1d(0x19e));function a72_0x5c1f(_0x4e5b5f,_0x34bc64){const _0x35eb33=a72_0x35eb();return a72_0x5c1f=function(_0x5c1fe1,_0x702332){_0x5c1fe1=_0x5c1fe1-0x173;let _0x4f31c1=_0x35eb33[_0x5c1fe1];return _0x4f31c1;},a72_0x5c1f(_0x4e5b5f,_0x34bc64);}class Percy{#logfile=path[a72_0xf92f1d(0x186)](getLogDir(),'percy.log');#address=process[a72_0xf92f1d(0x178)][a72_0xf92f1d(0x1b2)]||a72_0xf92f1d(0x1a0);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0xf92f1d(0x196)]=![];constructor(_0x527cae){const _0xe9fb25=a72_0xf92f1d;this.#config=_0x527cae,!!_0x527cae[_0xe9fb25(0x179)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x2bf2ce=a72_0xf92f1d;if(!this.#binaryPath){const _0x5a40b8=new PercyBinary();PerformanceTester['start'](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x5a40b8['getBinaryPath'](this.#config),PerformanceTester[_0x2bf2ce(0x1a6)](PerformanceEvents[_0x2bf2ce(0x1ae)]);}return this.#binaryPath;}async #sleep(_0x33e7ba){return new Promise(_0x4320ba=>setTimeout(_0x4320ba,_0x33e7ba));}async[a72_0xf92f1d(0x1a2)](){const _0x51163f=a72_0xf92f1d,_0x5961a8={};_0x5961a8[_0x51163f(0x189)]=_0x51163f(0x1a9),_0x5961a8['WdBlS']='percy/healthcheck';const _0x9f8f6e=_0x5961a8;try{const _0x2006fa=await helper[_0x51163f(0x1a8)](_0x9f8f6e[_0x51163f(0x189)],_0x9f8f6e['WdBlS'],null,null,this.#address);if(_0x2006fa)return!![];}catch(_0x84bcf7){return![];}}async['start'](){const _0x33b617=a72_0xf92f1d,_0x26659c={'CcEaN':_0x33b617(0x184),'UPECB':_0x33b617(0x1ac),'nWUxB':function(_0x156ab5,_0x35c42b,_0x166525,_0x301c70){return _0x156ab5(_0x35c42b,_0x166525,_0x301c70);},'EwqpM':_0x33b617(0x192),'BLcTq':_0x33b617(0x180)},_0x17dd27=await this.#getBinaryPath(),_0x111b1a={};_0x111b1a['flags']='a';const _0x3aedca=fs[_0x33b617(0x17f)](this.#logfile,_0x111b1a),_0x371996=await this['fetchPercyToken'](),_0x44e967=await this[_0x33b617(0x19d)]();if(!_0x371996)return![];const _0x447e7b=[(this.#isApp?_0x26659c[_0x33b617(0x1bb)]:_0x26659c['UPECB'])+_0x33b617(0x199)];_0x44e967&&_0x447e7b[_0x33b617(0x1ab)]('-c',_0x44e967);this.#proc=_0x26659c['nWUxB'](spawn,_0x17dd27,_0x447e7b,{'env':Object[_0x33b617(0x1b8)](process[_0x33b617(0x178)],{'PERCY_TOKEN':_0x371996,'TH_BUILD_UUID':process[_0x33b617(0x178)][testHubConstants['ENV_VAR'][_0x33b617(0x1b5)]]})}),this.#proc[_0x33b617(0x188)]['pipe'](_0x3aedca),this.#proc['stderr'][_0x33b617(0x1ad)](_0x3aedca),this[_0x33b617(0x196)]=!![];var _0x5e149a=this;this.#proc['on'](_0x26659c[_0x33b617(0x185)],function(_0x48d562){const _0x22fc3e=_0x33b617;_0x5e149a[_0x22fc3e(0x196)]=![];});do{const _0x539660=await this[_0x33b617(0x1a2)]();if(_0x539660)return logger['debug'](_0x26659c[_0x33b617(0x17e)]),!![];await this.#sleep(0x3e8);}while(this[_0x33b617(0x196)]);return![];}async[a72_0xf92f1d(0x1a3)](){const _0x27ef5f=a72_0xf92f1d,_0x15560b={'XrbAh':function(_0x50bd43,_0x1f15c1){return _0x50bd43(_0x1f15c1);},'idqdl':function(_0x226861,_0x16ffae,_0x233206){return _0x226861(_0x16ffae,_0x233206);},'RBtgH':_0x27ef5f(0x1a5),'srhOt':_0x27ef5f(0x192)},_0x3a589f=await this.#getBinaryPath();return new Promise((_0x4747d6,_0x328bab)=>{const _0x37bb6=_0x27ef5f,_0x1c85b9={'WsTJo':function(_0x421546,_0x16bdc8){const _0x23fab0=a72_0x5c1f;return _0x15560b[_0x23fab0(0x1b7)](_0x421546,_0x16bdc8);}},_0x599127=_0x15560b[_0x37bb6(0x18d)](spawn,_0x3a589f,[_0x15560b[_0x37bb6(0x174)]]);_0x599127['on'](_0x15560b[_0x37bb6(0x17c)],_0x5476bf=>{const _0x68a7f6=_0x37bb6;this[_0x68a7f6(0x196)]=![],_0x1c85b9[_0x68a7f6(0x18f)](_0x4747d6,_0x5476bf);});});}[a72_0xf92f1d(0x19c)](){const _0x3cc908=a72_0xf92f1d;return this[_0x3cc908(0x196)];}async['fetchPercyToken'](){const _0x1406f7=a72_0xf92f1d,_0x1bbdf0={};_0x1bbdf0[_0x1406f7(0x1aa)]=_0x1406f7(0x179),_0x1bbdf0['YCOrz']=_0x1406f7(0x1b6),_0x1bbdf0[_0x1406f7(0x19f)]='GET',_0x1bbdf0['UXmpE']=_0x1406f7(0x181);const _0x3269ff=_0x1bbdf0,_0x5294c5=this.#config[_0x1406f7(0x177)];try{const _0x2ffd46=this.#isApp?_0x3269ff['iZnKy']:_0x3269ff['YCOrz'],_0x456437=await helper[_0x1406f7(0x1a8)](_0x3269ff['fKjQf'],_0x1406f7(0x18e)+_0x5294c5+_0x1406f7(0x19b)+_0x2ffd46,{},this.#config),_0x2f044e=_0x456437['data'];return logger[_0x1406f7(0x1b3)](_0x3269ff[_0x1406f7(0x17d)]),_0x2f044e['token'];}catch(_0x30dfcb){return logger[_0x1406f7(0x197)](_0x1406f7(0x175)+_0x30dfcb),null;}}async[a72_0xf92f1d(0x19d)](){const _0x4f8bb0=a72_0xf92f1d,_0x3b3185={'FkTeZ':function(_0x114ecd,_0x2c1bbc){return _0x114ecd(_0x2c1bbc);},'KRwcV':function(_0x45ae46,_0x538f46){return _0x45ae46+_0x538f46;},'PZhPO':_0x4f8bb0(0x19a),'QMzvW':'percy.json'};if(!this.#config[_0x4f8bb0(0x1af)])return null;const _0x19553e=path[_0x4f8bb0(0x186)](os['tmpdir'](),_0x3b3185['QMzvW']),_0x159804=this.#config[_0x4f8bb0(0x1af)];return!_0x159804[_0x4f8bb0(0x194)]&&(_0x159804[_0x4f8bb0(0x194)]='2'),new Promise((_0x2351d3,_0xbeacaa)=>{const _0x4f8875=_0x4f8bb0;fs[_0x4f8875(0x1bc)](_0x19553e,JSON[_0x4f8875(0x176)](_0x159804),_0x1b50af=>{const _0x350a7f=_0x4f8875;_0x1b50af&&(logger[_0x350a7f(0x197)](_0x350a7f(0x17a)+_0x1b50af),_0x3b3185[_0x350a7f(0x198)](_0x2351d3,null)),logger[_0x350a7f(0x1b3)](_0x3b3185[_0x350a7f(0x190)](_0x3b3185[_0x350a7f(0x1b1)],_0x19553e)),_0x3b3185[_0x350a7f(0x198)](_0x2351d3,_0x19553e);});});}}module[a72_0xf92f1d(0x18c)]=Percy;
const a108_0x2235b3=a108_0x1118;(function(_0x5f33d7,_0xfab02a){const _0x1af2d5=a108_0x1118,_0x3aa3bd=_0x5f33d7();while(!![]){try{const _0x126c40=-parseInt(_0x1af2d5(0x184))/0x1+-parseInt(_0x1af2d5(0x160))/0x2+-parseInt(_0x1af2d5(0x163))/0x3+parseInt(_0x1af2d5(0x18d))/0x4*(-parseInt(_0x1af2d5(0x156))/0x5)+parseInt(_0x1af2d5(0x169))/0x6*(parseInt(_0x1af2d5(0x158))/0x7)+-parseInt(_0x1af2d5(0x182))/0x8*(parseInt(_0x1af2d5(0x171))/0x9)+parseInt(_0x1af2d5(0x16d))/0xa*(parseInt(_0x1af2d5(0x15a))/0xb);if(_0x126c40===_0xfab02a)break;else _0x3aa3bd['push'](_0x3aa3bd['shift']());}catch(_0x3f6fda){_0x3aa3bd['push'](_0x3aa3bd['shift']());}}}(a108_0x1917,0x68e8e));function a108_0x1917(){const _0x1fb6c6=['zQGKn','flags','percyOptions','stdout','12swwMev','DOWNLOAD','JVPQD','BROWSERSTACK_TESTHUB_UUID','&type=','owYCQ','env','createWriteStream','exports','isProcessRunning','path','nodeRequest','higfx','error','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','Percy\x20healthcheck\x20successful','EePJM','ENUkJ','percy/healthcheck','join','1069595PVvOxr','../logger','2397710eRHJQu','pipe','36102187bDMpBi','app','LOKHD','fetchPercyToken','stringify','winstonLogger','1013878yZORqz','debug','yySrd','2348175RbleDk','http://localhost:5338','../helper','GET','version','Error\x20creating\x20percy\x20config:\x20','12RXJIrC','percy.log','assign','mXRjY','10IOJQhG','child_process','USEuM','QazFS','683865OLsIXU','push','createPercyConfig','Cewkm','pNMQV','HakVI','exec','close','JKtuk','percy.json','writeFile','healthcheck','./PercyBinary','automate','Percy\x20fetch\x20token\x20success','HSjOU','ENV_VAR','80YyifxS','../../helpers/performance/constants','846096dZHWyy','stderr','start','AbxtE','token'];a108_0x1917=function(){return _0x1fb6c6;};return a108_0x1917();}function a108_0x1118(_0x56f451,_0x553430){const _0x1917d0=a108_0x1917();return a108_0x1118=function(_0x1118a5,_0x2ce9ce){_0x1118a5=_0x1118a5-0x156;let _0x2e0e69=_0x1917d0[_0x1118a5];return _0x2e0e69;},a108_0x1118(_0x56f451,_0x553430);}const fs=require('fs'),path=require(a108_0x2235b3(0x197)),os=require('os'),{spawn}=require(a108_0x2235b3(0x16e)),helper=require(a108_0x2235b3(0x165)),logger=require(a108_0x2235b3(0x157))[a108_0x2235b3(0x15f)],{getLogDir}=require('../logger'),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a108_0x2235b3(0x183)),PercyBinary=require(a108_0x2235b3(0x17d));class Percy{#logfile=path[a108_0x2235b3(0x1a0)](getLogDir(),a108_0x2235b3(0x16a));#address=process[a108_0x2235b3(0x193)]['PERCY_SERVER_ADDRESS']||a108_0x2235b3(0x164);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a108_0x2235b3(0x196)]=![];constructor(_0x23ae92){const _0xb015d8=a108_0x2235b3;this.#config=_0x23ae92,!!_0x23ae92[_0xb015d8(0x15b)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x1dedf3=a108_0x2235b3;if(!this.#binaryPath){const _0xdcceaa=new PercyBinary();PerformanceTester[_0x1dedf3(0x186)](PerformanceEvents[_0x1dedf3(0x18e)]),this.#binaryPath=await _0xdcceaa['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x2fcfe6){return new Promise(_0x2553de=>setTimeout(_0x2553de,_0x2fcfe6));}async[a108_0x2235b3(0x17c)](){const _0x2194d2=a108_0x2235b3,_0x32159b={};_0x32159b[_0x2194d2(0x15c)]=_0x2194d2(0x166),_0x32159b['HakVI']=_0x2194d2(0x19f);const _0x573d7f=_0x32159b;try{const _0x759d3f=await helper[_0x2194d2(0x198)](_0x573d7f[_0x2194d2(0x15c)],_0x573d7f[_0x2194d2(0x176)],null,null,this.#address);if(_0x759d3f)return!![];}catch(_0x311a97){return![];}}async[a108_0x2235b3(0x186)](){const _0x5e3fe7=a108_0x2235b3,_0x4778be={'mXRjY':'app:exec','Cewkm':_0x5e3fe7(0x177),'USEuM':function(_0x2fed3d,_0x266dd3,_0x74f152,_0x251f7e){return _0x2fed3d(_0x266dd3,_0x74f152,_0x251f7e);},'EePJM':'close','AbxtE':_0x5e3fe7(0x19c)},_0x39cc86=await this.#getBinaryPath(),_0x2651b7={};_0x2651b7[_0x5e3fe7(0x18a)]='a';const _0x262256=fs[_0x5e3fe7(0x194)](this.#logfile,_0x2651b7),_0xac09d6=await this[_0x5e3fe7(0x15d)](),_0x1cc6dd=await this[_0x5e3fe7(0x173)]();if(!_0xac09d6)return![];const _0x280b8e=[(this.#isApp?_0x4778be[_0x5e3fe7(0x16c)]:_0x4778be[_0x5e3fe7(0x174)])+':start'];_0x1cc6dd&&_0x280b8e[_0x5e3fe7(0x172)]('-c',_0x1cc6dd);this.#proc=_0x4778be[_0x5e3fe7(0x16f)](spawn,_0x39cc86,_0x280b8e,{'env':Object[_0x5e3fe7(0x16b)](process['env'],{'PERCY_TOKEN':_0xac09d6,'TH_BUILD_UUID':process[_0x5e3fe7(0x193)][testHubConstants[_0x5e3fe7(0x181)][_0x5e3fe7(0x190)]]})}),this.#proc[_0x5e3fe7(0x18c)][_0x5e3fe7(0x159)](_0x262256),this.#proc[_0x5e3fe7(0x185)][_0x5e3fe7(0x159)](_0x262256),this['isProcessRunning']=!![];var _0x16307a=this;this.#proc['on'](_0x4778be[_0x5e3fe7(0x19d)],function(_0x152554){const _0x11a7f0=_0x5e3fe7;_0x16307a[_0x11a7f0(0x196)]=![];});do{const _0x2b3a36=await this[_0x5e3fe7(0x17c)]();if(_0x2b3a36)return logger['debug'](_0x4778be[_0x5e3fe7(0x187)]),!![];await this.#sleep(0x3e8);}while(this[_0x5e3fe7(0x196)]);return![];}async['stop'](){const _0x3eb7a4=a108_0x2235b3,_0x2f0cb1={'wvPAt':function(_0x57c710,_0x5484f1){return _0x57c710(_0x5484f1);},'higfx':function(_0x2d352,_0x5402cf,_0x13073b){return _0x2d352(_0x5402cf,_0x13073b);},'QazFS':'exec:stop','HSjOU':_0x3eb7a4(0x178)},_0x5cfe8f=await this.#getBinaryPath();return new Promise((_0x128575,_0xbea042)=>{const _0xf09fa2=_0x3eb7a4,_0x124cbe=_0x2f0cb1[_0xf09fa2(0x199)](spawn,_0x5cfe8f,[_0x2f0cb1[_0xf09fa2(0x170)]]);_0x124cbe['on'](_0x2f0cb1[_0xf09fa2(0x180)],_0x4c2ee1=>{const _0x4887c3=_0xf09fa2;this[_0x4887c3(0x196)]=![],_0x2f0cb1['wvPAt'](_0x128575,_0x4c2ee1);});});}['isRunning'](){const _0x38271a=a108_0x2235b3;return this[_0x38271a(0x196)];}async[a108_0x2235b3(0x15d)](){const _0x157c41=a108_0x2235b3,_0x3e02a8={};_0x3e02a8[_0x157c41(0x179)]=_0x157c41(0x15b),_0x3e02a8['nvnsM']=_0x157c41(0x17e),_0x3e02a8[_0x157c41(0x189)]='GET',_0x3e02a8['owYCQ']=_0x157c41(0x17f);const _0x31a9d4=_0x3e02a8,_0x1310fa=this.#config['projectName'];try{const _0x33d0ed=this.#isApp?_0x31a9d4[_0x157c41(0x179)]:_0x31a9d4['nvnsM'],_0x283610=await helper[_0x157c41(0x198)](_0x31a9d4['zQGKn'],'api/app_percy/get_project_token?name='+_0x1310fa+_0x157c41(0x191)+_0x33d0ed,{},this.#config),_0xc07047=_0x283610['data'];return logger[_0x157c41(0x161)](_0x31a9d4[_0x157c41(0x192)]),_0xc07047[_0x157c41(0x188)];}catch(_0x5ca78d){return logger[_0x157c41(0x19a)](_0x157c41(0x19b)+_0x5ca78d),null;}}async['createPercyConfig'](){const _0x446b48=a108_0x2235b3,_0x2157e9={'JVPQD':function(_0x59e198,_0x36ba45){return _0x59e198(_0x36ba45);},'ENUkJ':function(_0x17c43b,_0x41da15){return _0x17c43b+_0x41da15;},'pNMQV':'Percy\x20config\x20created\x20at\x20','yySrd':_0x446b48(0x17a)};if(!this.#config[_0x446b48(0x18b)])return null;const _0x432414=path[_0x446b48(0x1a0)](os['tmpdir'](),_0x2157e9[_0x446b48(0x162)]),_0x352d1a=this.#config[_0x446b48(0x18b)];return!_0x352d1a['version']&&(_0x352d1a[_0x446b48(0x167)]='2'),new Promise((_0xbe9e07,_0xf28284)=>{const _0x59ab81=_0x446b48;fs[_0x59ab81(0x17b)](_0x432414,JSON[_0x59ab81(0x15e)](_0x352d1a),_0x47277c=>{const _0x4d5343=_0x59ab81;_0x47277c&&(logger[_0x4d5343(0x19a)](_0x4d5343(0x168)+_0x47277c),_0x2157e9[_0x4d5343(0x18f)](_0xbe9e07,null)),logger[_0x4d5343(0x161)](_0x2157e9[_0x4d5343(0x19e)](_0x2157e9[_0x4d5343(0x175)],_0x432414)),_0x2157e9[_0x4d5343(0x18f)](_0xbe9e07,_0x432414);});});}}module[a108_0x2235b3(0x195)]=Percy;
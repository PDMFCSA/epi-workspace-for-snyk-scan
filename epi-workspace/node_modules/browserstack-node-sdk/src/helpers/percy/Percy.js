function a72_0x10e5(_0x4a5aa2,_0x129b3a){const _0x56bbae=a72_0x56bb();return a72_0x10e5=function(_0x10e52f,_0x13164b){_0x10e52f=_0x10e52f-0x1e5;let _0x5a223e=_0x56bbae[_0x10e52f];return _0x5a223e;},a72_0x10e5(_0x4a5aa2,_0x129b3a);}const a72_0x5488ca=a72_0x10e5;(function(_0x799a6,_0x4f2e65){const _0x186950=a72_0x10e5,_0x52ec48=_0x799a6();while(!![]){try{const _0x56ff33=-parseInt(_0x186950(0x1fe))/0x1*(-parseInt(_0x186950(0x20f))/0x2)+parseInt(_0x186950(0x1ea))/0x3+-parseInt(_0x186950(0x226))/0x4+parseInt(_0x186950(0x1ff))/0x5+-parseInt(_0x186950(0x209))/0x6+-parseInt(_0x186950(0x1ed))/0x7+parseInt(_0x186950(0x1eb))/0x8;if(_0x56ff33===_0x4f2e65)break;else _0x52ec48['push'](_0x52ec48['shift']());}catch(_0x1c251a){_0x52ec48['push'](_0x52ec48['shift']());}}}(a72_0x56bb,0x9e678));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require('child_process'),helper=require(a72_0x5488ca(0x22a)),logger=require(a72_0x5488ca(0x21d))['winstonLogger'],{getLogDir}=require('../logger'),testHubConstants=require(a72_0x5488ca(0x216)),PerformanceTester=require(a72_0x5488ca(0x1f5)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x5488ca(0x206)),PercyBinary=require(a72_0x5488ca(0x1f6));function a72_0x56bb(){const _0x4b903b=['percy/healthcheck','GET','automate','stderr','1500042VlIUvU','8694728lRVNQQ','error','5463374nzVmdA','Cghoc','Percy\x20config\x20created\x20at\x20','EXdnE','join','end','pipe','RdyMW','../../helpers/performance/performance-tester','./PercyBinary','DkxRm','nodeRequest','debug','QYOVm','&type=','csQod','createWriteStream','313381plOJBi','3544350zCfLVp','healthcheck','token','version','Tcysr','app:exec','exports','../../helpers/performance/constants','AFJNd','pVNnd','1628232bUiHuS','projectName','close','tmpdir','RCHke','qxQOs','4Domhfk','isProcessRunning','DOWNLOAD','percy.log','UkrcF','ordKv','sQUBk','../../helpers/testhub/constants','writeFile',':start','stdout','exec','ENV_VAR','percyOptions','../logger','Percy\x20fetch\x20token\x20success','env','iFDiq','flags','stringify','XrUWv','createPercyConfig','getBinaryPath','4887236WellsV','fetchPercyToken','percy.json','RRHqF','../helper','assign'];a72_0x56bb=function(){return _0x4b903b;};return a72_0x56bb();}class Percy{#logfile=path['join'](getLogDir(),a72_0x5488ca(0x212));#address=process['env']['PERCY_SERVER_ADDRESS']||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x5488ca(0x210)]=![];constructor(_0x14146d){this.#config=_0x14146d,!!_0x14146d['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x29a56e=a72_0x5488ca;if(!this.#binaryPath){const _0x5ae5bb=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x29a56e(0x211)]),this.#binaryPath=await _0x5ae5bb[_0x29a56e(0x225)](this.#config),PerformanceTester[_0x29a56e(0x1f2)](PerformanceEvents[_0x29a56e(0x211)]);}return this.#binaryPath;}async #sleep(_0x5f234a){return new Promise(_0x19b518=>setTimeout(_0x19b518,_0x5f234a));}async[a72_0x5488ca(0x200)](){const _0x3294e6=a72_0x5488ca,_0x39e86b={};_0x39e86b['Cghoc']='GET',_0x39e86b[_0x3294e6(0x207)]=_0x3294e6(0x1e6);const _0x549f83=_0x39e86b;try{const _0x430ae1=await helper['nodeRequest'](_0x549f83[_0x3294e6(0x1ee)],_0x549f83[_0x3294e6(0x207)],null,null,this.#address);if(_0x430ae1)return!![];}catch(_0x35b8d6){return![];}}async['start'](){const _0x3c5db4=a72_0x5488ca,_0x2e69e4={'XrUWv':_0x3c5db4(0x204),'cRKIQ':_0x3c5db4(0x21a),'RCHke':function(_0x5be0d3,_0xdc3bda,_0x413a8,_0x16cbfb){return _0x5be0d3(_0xdc3bda,_0x413a8,_0x16cbfb);},'EXdnE':_0x3c5db4(0x20b),'sQUBk':'Percy\x20healthcheck\x20successful'},_0x12af6a=await this.#getBinaryPath(),_0x543b31={};_0x543b31[_0x3c5db4(0x221)]='a';const _0x1d6f53=fs[_0x3c5db4(0x1fd)](this.#logfile,_0x543b31),_0xd9d108=await this[_0x3c5db4(0x227)](),_0x2226db=await this['createPercyConfig']();if(!_0xd9d108)return![];const _0x9b7eed=[(this.#isApp?_0x2e69e4[_0x3c5db4(0x223)]:_0x2e69e4['cRKIQ'])+_0x3c5db4(0x218)];_0x2226db&&_0x9b7eed['push']('-c',_0x2226db);this.#proc=_0x2e69e4[_0x3c5db4(0x20d)](spawn,_0x12af6a,_0x9b7eed,{'env':Object[_0x3c5db4(0x1e5)](process['env'],{'PERCY_TOKEN':_0xd9d108,'TH_BUILD_UUID':process[_0x3c5db4(0x21f)][testHubConstants[_0x3c5db4(0x21b)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x3c5db4(0x219)][_0x3c5db4(0x1f3)](_0x1d6f53),this.#proc[_0x3c5db4(0x1e9)][_0x3c5db4(0x1f3)](_0x1d6f53),this[_0x3c5db4(0x210)]=!![];var _0x2bb153=this;this.#proc['on'](_0x2e69e4[_0x3c5db4(0x1f0)],function(_0x5f79db){const _0xb0c207=_0x3c5db4;_0x2bb153[_0xb0c207(0x210)]=![];});do{const _0xfd7d11=await this[_0x3c5db4(0x200)]();if(_0xfd7d11)return logger[_0x3c5db4(0x1f9)](_0x2e69e4[_0x3c5db4(0x215)]),!![];await this.#sleep(0x3e8);}while(this[_0x3c5db4(0x210)]);return![];}async['stop'](){const _0x11b1b7=a72_0x5488ca,_0x1587bb={'iFDiq':function(_0x443132,_0x418cb7){return _0x443132(_0x418cb7);},'ordKv':function(_0xd6e270,_0x129db9,_0x4dac70){return _0xd6e270(_0x129db9,_0x4dac70);},'csQod':'exec:stop','Syzkx':_0x11b1b7(0x20b)},_0x1f3fb7=await this.#getBinaryPath();return new Promise((_0x53f227,_0x2cb961)=>{const _0x455be6=_0x11b1b7,_0x201a08={'ogdtv':function(_0x3b2e53,_0x1f7f4c){const _0x24e61f=a72_0x10e5;return _0x1587bb[_0x24e61f(0x220)](_0x3b2e53,_0x1f7f4c);}},_0x48fc5d=_0x1587bb[_0x455be6(0x214)](spawn,_0x1f3fb7,[_0x1587bb[_0x455be6(0x1fc)]]);_0x48fc5d['on'](_0x1587bb['Syzkx'],_0x18afe9=>{const _0x476af6=_0x455be6;this[_0x476af6(0x210)]=![],_0x201a08['ogdtv'](_0x53f227,_0x18afe9);});});}['isRunning'](){const _0x5e4284=a72_0x5488ca;return this[_0x5e4284(0x210)];}async[a72_0x5488ca(0x227)](){const _0x1c93b9=a72_0x5488ca,_0xae558={};_0xae558[_0x1c93b9(0x20e)]='app',_0xae558[_0x1c93b9(0x1fa)]=_0x1c93b9(0x1e8),_0xae558[_0x1c93b9(0x213)]=_0x1c93b9(0x1e7),_0xae558[_0x1c93b9(0x229)]=_0x1c93b9(0x21e);const _0x374da5=_0xae558,_0x441ddc=this.#config[_0x1c93b9(0x20a)];try{const _0xe3aef0=this.#isApp?_0x374da5['qxQOs']:_0x374da5[_0x1c93b9(0x1fa)],_0x35dc41=await helper[_0x1c93b9(0x1f8)](_0x374da5['UkrcF'],'api/app_percy/get_project_token?name='+_0x441ddc+_0x1c93b9(0x1fb)+_0xe3aef0,{},this.#config),_0x453a4c=_0x35dc41['data'];return logger[_0x1c93b9(0x1f9)](_0x374da5[_0x1c93b9(0x229)]),_0x453a4c[_0x1c93b9(0x201)];}catch(_0x1ea528){return logger[_0x1c93b9(0x1ec)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x1ea528),null;}}async[a72_0x5488ca(0x224)](){const _0x15c34e=a72_0x5488ca,_0xcdd93a={'RdyMW':function(_0x3fa0f8,_0x11577b){return _0x3fa0f8(_0x11577b);},'eKuyZ':function(_0x45ca08,_0x54d8d2){return _0x45ca08+_0x54d8d2;},'Tcysr':_0x15c34e(0x1ef),'DkxRm':function(_0x2d0945,_0x3ba244){return _0x2d0945(_0x3ba244);},'pVNnd':_0x15c34e(0x228)};if(!this.#config[_0x15c34e(0x21c)])return null;const _0x15cc75=path[_0x15c34e(0x1f1)](os[_0x15c34e(0x20c)](),_0xcdd93a[_0x15c34e(0x208)]),_0x31ca05=this.#config[_0x15c34e(0x21c)];return!_0x31ca05[_0x15c34e(0x202)]&&(_0x31ca05[_0x15c34e(0x202)]='2'),new Promise((_0xca37e,_0x3ad12b)=>{const _0x75fae1=_0x15c34e;fs[_0x75fae1(0x217)](_0x15cc75,JSON[_0x75fae1(0x222)](_0x31ca05),_0x402d08=>{const _0x26859d=_0x75fae1;_0x402d08&&(logger[_0x26859d(0x1ec)]('Error\x20creating\x20percy\x20config:\x20'+_0x402d08),_0xcdd93a[_0x26859d(0x1f4)](_0xca37e,null)),logger[_0x26859d(0x1f9)](_0xcdd93a['eKuyZ'](_0xcdd93a[_0x26859d(0x203)],_0x15cc75)),_0xcdd93a[_0x26859d(0x1f7)](_0xca37e,_0x15cc75);});});}}module[a72_0x5488ca(0x205)]=Percy;
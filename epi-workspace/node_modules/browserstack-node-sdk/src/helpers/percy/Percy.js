const a101_0x63409e=a101_0x4646;function a101_0x32fc(){const _0x93452=['7764417CIRCov','stringify','../logger','isProcessRunning','flags','start','wMWFP','error','1197712vFtTDZ','createPercyConfig','42PUvhCQ','percy.json','data','token','app','Percy\x20config\x20created\x20at\x20','pipe','stderr','DOWNLOAD','./PercyBinary','PkzHB','join','version','app:exec','Error\x20creating\x20percy\x20config:\x20','QsBst','path','QLJOe','fetchPercyToken','nodeRequest','wcVYK','606024pccnHQ','isRunning','exec','GkaAA','writeFile','maAYI','ENV_VAR','child_process','percy/healthcheck','1013592ksguNE','debug','env','GET','stop','evHtz','Binvg','vqqdp','DVRSA','createWriteStream','close','kHZlh','2380970nGTKnu','stdout','&type=','4aTWyHZ','winstonLogger','536402HxCUyz','xtRoI','BROWSERSTACK_TESTHUB_UUID','Percy\x20fetch\x20token\x20success','healthcheck','2471148DIocvY','eudGz','hiHkt','api/app_percy/get_project_token?name=','exec:stop','percy.log','PERCY_SERVER_ADDRESS','../helper','getBinaryPath','end','../../helpers/testhub/constants','../../helpers/performance/constants'];a101_0x32fc=function(){return _0x93452;};return a101_0x32fc();}(function(_0x2f54dd,_0x39e5f1){const _0x2edde2=a101_0x4646,_0x22adbf=_0x2f54dd();while(!![]){try{const _0x488f78=-parseInt(_0x2edde2(0xfe))/0x1+-parseInt(_0x2edde2(0x117))/0x2+parseInt(_0x2edde2(0xed))/0x3+-parseInt(_0x2edde2(0xfc))/0x4*(-parseInt(_0x2edde2(0xf9))/0x5)+parseInt(_0x2edde2(0x103))/0x6+parseInt(_0x2edde2(0xcf))/0x7*(-parseInt(_0x2edde2(0xe4))/0x8)+parseInt(_0x2edde2(0x10f))/0x9;if(_0x488f78===_0x39e5f1)break;else _0x22adbf['push'](_0x22adbf['shift']());}catch(_0x5bcf98){_0x22adbf['push'](_0x22adbf['shift']());}}}(a101_0x32fc,0x79ca5));const fs=require('fs'),path=require(a101_0x63409e(0xdf)),os=require('os'),{spawn}=require(a101_0x63409e(0xeb)),helper=require(a101_0x63409e(0x10a)),logger=require(a101_0x63409e(0x111))[a101_0x63409e(0xfd)],{getLogDir}=require(a101_0x63409e(0x111)),testHubConstants=require(a101_0x63409e(0x10d)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x63409e(0x10e)),PercyBinary=require(a101_0x63409e(0xd8));class Percy{#logfile=path[a101_0x63409e(0xda)](getLogDir(),a101_0x63409e(0x108));#address=process['env'][a101_0x63409e(0x109)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a101_0x63409e(0x112)]=![];constructor(_0xdc29fd){const _0x4760ca=a101_0x63409e;this.#config=_0xdc29fd,!!_0xdc29fd[_0x4760ca(0xd3)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x480c46=a101_0x63409e;if(!this.#binaryPath){const _0x551a21=new PercyBinary();PerformanceTester[_0x480c46(0x114)](PerformanceEvents[_0x480c46(0xd7)]),this.#binaryPath=await _0x551a21[_0x480c46(0x10b)](this.#config),PerformanceTester[_0x480c46(0x10c)](PerformanceEvents[_0x480c46(0xd7)]);}return this.#binaryPath;}async #sleep(_0x1766c4){return new Promise(_0x5219ea=>setTimeout(_0x5219ea,_0x1766c4));}async['healthcheck'](){const _0x4830a7=a101_0x63409e,_0x5dcba8={};_0x5dcba8[_0x4830a7(0xf5)]=_0x4830a7(0xf0),_0x5dcba8[_0x4830a7(0xd9)]=_0x4830a7(0xec);const _0x15bfad=_0x5dcba8;try{const _0x522241=await helper['nodeRequest'](_0x15bfad[_0x4830a7(0xf5)],_0x15bfad[_0x4830a7(0xd9)],null,null,this.#address);if(_0x522241)return!![];}catch(_0x5561de){return![];}}async[a101_0x63409e(0x114)](){const _0x1c6f0a=a101_0x63409e,_0xad7676={'dkbYd':_0x1c6f0a(0xdc),'QLJOe':_0x1c6f0a(0xe6),'cmCUy':function(_0x760e5,_0x5f2a35,_0x3eadb1,_0x21698d){return _0x760e5(_0x5f2a35,_0x3eadb1,_0x21698d);},'GkaAA':_0x1c6f0a(0xf7),'vqqdp':'Percy\x20healthcheck\x20successful'},_0x4d3afb=await this.#getBinaryPath(),_0x451e74={};_0x451e74[_0x1c6f0a(0x113)]='a';const _0x5a2b0c=fs[_0x1c6f0a(0xf6)](this.#logfile,_0x451e74),_0x5dc03f=await this['fetchPercyToken'](),_0x5f30ac=await this[_0x1c6f0a(0x118)]();if(!_0x5dc03f)return![];const _0x155c60=[(this.#isApp?_0xad7676['dkbYd']:_0xad7676[_0x1c6f0a(0xe0)])+':start'];_0x5f30ac&&_0x155c60['push']('-c',_0x5f30ac);this.#proc=_0xad7676['cmCUy'](spawn,_0x4d3afb,_0x155c60,{'env':Object['assign'](process[_0x1c6f0a(0xef)],{'PERCY_TOKEN':_0x5dc03f,'TH_BUILD_UUID':process[_0x1c6f0a(0xef)][testHubConstants[_0x1c6f0a(0xea)][_0x1c6f0a(0x100)]]})}),this.#proc[_0x1c6f0a(0xfa)][_0x1c6f0a(0xd5)](_0x5a2b0c),this.#proc[_0x1c6f0a(0xd6)][_0x1c6f0a(0xd5)](_0x5a2b0c),this['isProcessRunning']=!![];var _0x4900a1=this;this.#proc['on'](_0xad7676[_0x1c6f0a(0xe7)],function(_0x50d67b){const _0x312847=_0x1c6f0a;_0x4900a1[_0x312847(0x112)]=![];});do{const _0x11ffa2=await this[_0x1c6f0a(0x102)]();if(_0x11ffa2)return logger[_0x1c6f0a(0xee)](_0xad7676[_0x1c6f0a(0xf4)]),!![];await this.#sleep(0x3e8);}while(this[_0x1c6f0a(0x112)]);return![];}async[a101_0x63409e(0xf1)](){const _0x3a5bc1=a101_0x63409e,_0xe0fd6d={'evHtz':function(_0x537dd1,_0x4f7881){return _0x537dd1(_0x4f7881);},'maAYI':function(_0x1f5b01,_0x3b46d7,_0x4e0bf6){return _0x1f5b01(_0x3b46d7,_0x4e0bf6);},'wcVYK':_0x3a5bc1(0x107),'QsBst':_0x3a5bc1(0xf7)},_0x5ac8bb=await this.#getBinaryPath();return new Promise((_0x5eddff,_0xe55f4a)=>{const _0x54ce3f=_0x3a5bc1,_0x2b9263={'IzaED':function(_0x2626c8,_0x98fbc0){const _0x1b1426=a101_0x4646;return _0xe0fd6d[_0x1b1426(0xf2)](_0x2626c8,_0x98fbc0);}},_0x2e689e=_0xe0fd6d[_0x54ce3f(0xe9)](spawn,_0x5ac8bb,[_0xe0fd6d[_0x54ce3f(0xe3)]]);_0x2e689e['on'](_0xe0fd6d[_0x54ce3f(0xde)],_0x463d28=>{const _0x50b862=_0x54ce3f;this[_0x50b862(0x112)]=![],_0x2b9263['IzaED'](_0x5eddff,_0x463d28);});});}[a101_0x63409e(0xe5)](){const _0x3c27b8=a101_0x63409e;return this[_0x3c27b8(0x112)];}async[a101_0x63409e(0xe1)](){const _0x1b5f7f=a101_0x63409e,_0xb69598={};_0xb69598[_0x1b5f7f(0xff)]=_0x1b5f7f(0xd3),_0xb69598[_0x1b5f7f(0xf3)]='automate',_0xb69598[_0x1b5f7f(0x104)]='GET',_0xb69598[_0x1b5f7f(0x115)]=_0x1b5f7f(0x101);const _0x2dd8f9=_0xb69598,_0x25c3ec=this.#config['projectName'];try{const _0x154425=this.#isApp?_0x2dd8f9[_0x1b5f7f(0xff)]:_0x2dd8f9[_0x1b5f7f(0xf3)],_0x7e9a87=await helper[_0x1b5f7f(0xe2)](_0x2dd8f9[_0x1b5f7f(0x104)],_0x1b5f7f(0x106)+_0x25c3ec+_0x1b5f7f(0xfb)+_0x154425,{},this.#config),_0x253fa9=_0x7e9a87[_0x1b5f7f(0xd1)];return logger['debug'](_0x2dd8f9[_0x1b5f7f(0x115)]),_0x253fa9[_0x1b5f7f(0xd2)];}catch(_0x5e9591){return logger[_0x1b5f7f(0x116)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x5e9591),null;}}async[a101_0x63409e(0x118)](){const _0xdba5ba=a101_0x63409e,_0x5722f8={'mLGrO':function(_0x363712,_0xf7609a){return _0x363712(_0xf7609a);},'hiHkt':function(_0x1d3516,_0x6bfd25){return _0x1d3516+_0x6bfd25;},'gGUiw':_0xdba5ba(0xd4),'kHZlh':function(_0x220a66,_0xc88f3a){return _0x220a66(_0xc88f3a);},'MdUJw':_0xdba5ba(0xd0)};if(!this.#config['percyOptions'])return null;const _0x59974b=path[_0xdba5ba(0xda)](os['tmpdir'](),_0x5722f8['MdUJw']),_0x1c6a6a=this.#config['percyOptions'];return!_0x1c6a6a[_0xdba5ba(0xdb)]&&(_0x1c6a6a[_0xdba5ba(0xdb)]='2'),new Promise((_0x1dc4a8,_0x1b93df)=>{const _0x22b38e=_0xdba5ba;fs[_0x22b38e(0xe8)](_0x59974b,JSON[_0x22b38e(0x110)](_0x1c6a6a),_0x4393b1=>{const _0x9985c4=_0x22b38e;_0x4393b1&&(logger[_0x9985c4(0x116)](_0x9985c4(0xdd)+_0x4393b1),_0x5722f8['mLGrO'](_0x1dc4a8,null)),logger[_0x9985c4(0xee)](_0x5722f8[_0x9985c4(0x105)](_0x5722f8['gGUiw'],_0x59974b)),_0x5722f8[_0x9985c4(0xf8)](_0x1dc4a8,_0x59974b);});});}}function a101_0x4646(_0x4f8db6,_0x230cc1){const _0x32fceb=a101_0x32fc();return a101_0x4646=function(_0x464696,_0x51e69d){_0x464696=_0x464696-0xcf;let _0xc7bf7b=_0x32fceb[_0x464696];return _0xc7bf7b;},a101_0x4646(_0x4f8db6,_0x230cc1);}module['exports']=Percy;
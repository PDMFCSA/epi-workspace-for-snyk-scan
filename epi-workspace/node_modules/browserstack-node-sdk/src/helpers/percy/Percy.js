const a113_0x5de73f=a113_0x40de;(function(_0x56464f,_0x3c345e){const _0x59a6b0=a113_0x40de,_0x4001a8=_0x56464f();while(!![]){try{const _0xe87964=-parseInt(_0x59a6b0(0x1ae))/0x1*(-parseInt(_0x59a6b0(0x1aa))/0x2)+-parseInt(_0x59a6b0(0x1c0))/0x3+-parseInt(_0x59a6b0(0x191))/0x4*(-parseInt(_0x59a6b0(0x188))/0x5)+parseInt(_0x59a6b0(0x193))/0x6*(-parseInt(_0x59a6b0(0x1c7))/0x7)+-parseInt(_0x59a6b0(0x18b))/0x8+-parseInt(_0x59a6b0(0x1b4))/0x9*(-parseInt(_0x59a6b0(0x194))/0xa)+parseInt(_0x59a6b0(0x1b5))/0xb;if(_0xe87964===_0x3c345e)break;else _0x4001a8['push'](_0x4001a8['shift']());}catch(_0x1a7a5c){_0x4001a8['push'](_0x4001a8['shift']());}}}(a113_0x2504,0xb8733));function a113_0x2504(){const _0x5d0d2e=['1165251dSdKMS','MCuWH','percy/healthcheck','OTqRL','getBinaryPath','start','MmNnK','878654hrxEWh','stderr','Error\x20creating\x20percy\x20config:\x20','../logger','data','path','flags','healthcheck','hCYQB','createWriteStream','exec','qGAye','exec:stop','end','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','createPercyConfig','app','QIGQy','env','153060hWoKdK','error','mvujQ','2839784BAXMRn','stop','percyOptions','EcawU','XDqXi','GowAn','4wwOxej','BROWSERSTACK_TESTHUB_UUID','60DLTuII','10qIbuoE','../../helpers/performance/performance-tester','join','isRunning','winstonLogger','ClyqC','Percy\x20fetch\x20token\x20success','app:exec','mVoHt','../../helpers/testhub/constants','assign','version','fetchPercyToken','http://localhost:5338','PERCY_SERVER_ADDRESS','stringify','GET','Tpisx','DOWNLOAD','projectName','../../helpers/performance/constants','tFkPj','542044SHHTyQ','debug','writeFile','ifCue','4EUQLPM','Percy\x20config\x20created\x20at\x20','isProcessRunning','lTVUD','AyZYu','../helper','11618091PCDEza','3833698WLEpnJ','xIWkD','nkkmJ','close','ENV_VAR','uRgMu','Percy\x20healthcheck\x20successful','stdout',':start','./PercyBinary','push'];a113_0x2504=function(){return _0x5d0d2e;};return a113_0x2504();}const fs=require('fs'),path=require(a113_0x5de73f(0x1cc)),os=require('os'),{spawn}=require('child_process'),helper=require(a113_0x5de73f(0x1b3)),logger=require(a113_0x5de73f(0x1ca))[a113_0x5de73f(0x198)],{getLogDir}=require(a113_0x5de73f(0x1ca)),testHubConstants=require(a113_0x5de73f(0x19d)),PerformanceTester=require(a113_0x5de73f(0x195)),{PERCY_EVENTS:PerformanceEvents}=require(a113_0x5de73f(0x1a8)),PercyBinary=require(a113_0x5de73f(0x1be));class Percy{#logfile=path[a113_0x5de73f(0x196)](getLogDir(),'percy.log');#address=process[a113_0x5de73f(0x187)][a113_0x5de73f(0x1a2)]||a113_0x5de73f(0x1a1);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];['isProcessRunning']=![];constructor(_0x201a74){this.#config=_0x201a74,!!_0x201a74['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x16fc25=a113_0x5de73f;if(!this.#binaryPath){const _0x1cc6ba=new PercyBinary();PerformanceTester[_0x16fc25(0x1c5)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x1cc6ba[_0x16fc25(0x1c4)](this.#config),PerformanceTester[_0x16fc25(0x1d4)](PerformanceEvents[_0x16fc25(0x1a6)]);}return this.#binaryPath;}async #sleep(_0x5a3118){return new Promise(_0x360f77=>setTimeout(_0x360f77,_0x5a3118));}async[a113_0x5de73f(0x1ce)](){const _0x5e35d8=a113_0x5de73f,_0x324cef={};_0x324cef[_0x5e35d8(0x18e)]=_0x5e35d8(0x1a4),_0x324cef['ifCue']=_0x5e35d8(0x1c2);const _0x4664fb=_0x324cef;try{const _0x4c2822=await helper['nodeRequest'](_0x4664fb[_0x5e35d8(0x18e)],_0x4664fb[_0x5e35d8(0x1ad)],null,null,this.#address);if(_0x4c2822)return!![];}catch(_0x63a21){return![];}}async[a113_0x5de73f(0x1c5)](){const _0x3c08fa=a113_0x5de73f,_0x1b9a74={'rDNzN':_0x3c08fa(0x19b),'mVoHt':_0x3c08fa(0x1d1),'OTqRL':function(_0x2e5dd6,_0x1c4647,_0x4d62dd,_0x41fe25){return _0x2e5dd6(_0x1c4647,_0x4d62dd,_0x41fe25);},'lTVUD':_0x3c08fa(0x1b8),'MCuWH':_0x3c08fa(0x1bb)},_0xff0433=await this.#getBinaryPath(),_0x57d1de={};_0x57d1de[_0x3c08fa(0x1cd)]='a',this.#logStream=fs[_0x3c08fa(0x1d0)](this.#logfile,_0x57d1de);const _0x44d8b9=await this[_0x3c08fa(0x1a0)](),_0x56b2a0=await this['createPercyConfig']();if(!_0x44d8b9)return![];const _0x2183d2=[(this.#isApp?_0x1b9a74['rDNzN']:_0x1b9a74[_0x3c08fa(0x19c)])+_0x3c08fa(0x1bd)];_0x56b2a0&&_0x2183d2[_0x3c08fa(0x1bf)]('-c',_0x56b2a0);this.#proc=_0x1b9a74[_0x3c08fa(0x1c3)](spawn,_0xff0433,_0x2183d2,{'env':Object[_0x3c08fa(0x19e)](process[_0x3c08fa(0x187)],{'PERCY_TOKEN':_0x44d8b9,'TH_BUILD_UUID':process[_0x3c08fa(0x187)][testHubConstants[_0x3c08fa(0x1b9)][_0x3c08fa(0x192)]]})}),this.#proc[_0x3c08fa(0x1bc)]['pipe'](this.#logStream),this.#proc[_0x3c08fa(0x1c8)]['pipe'](this.#logStream),this[_0x3c08fa(0x1b0)]=!![];var _0x48b829=this;this.#proc['on'](_0x1b9a74[_0x3c08fa(0x1b1)],function(_0x3df7fa){const _0x1fc752=_0x3c08fa;_0x48b829[_0x1fc752(0x1b0)]=![];});do{const _0x121461=await this[_0x3c08fa(0x1ce)]();if(_0x121461)return logger['debug'](_0x1b9a74[_0x3c08fa(0x1c1)]),!![];await this.#sleep(0x3e8);}while(this[_0x3c08fa(0x1b0)]);return![];}async[a113_0x5de73f(0x18c)](){const _0x4c2bf9=a113_0x5de73f,_0x3e4e37={'kCuUi':function(_0x41b3bf,_0x22e906){return _0x41b3bf(_0x22e906);},'mvujQ':function(_0x354fdd,_0x16bb4d,_0x504585){return _0x354fdd(_0x16bb4d,_0x504585);},'QIGQy':_0x4c2bf9(0x1d3),'ClyqC':'close'},_0x2ce7f5=await this.#getBinaryPath();return new Promise((_0x7b4b43,_0x3cb1a8)=>{const _0x1abd41=_0x4c2bf9,_0x48406d=_0x3e4e37[_0x1abd41(0x18a)](spawn,_0x2ce7f5,[_0x3e4e37[_0x1abd41(0x186)]]);_0x48406d['on'](_0x3e4e37[_0x1abd41(0x199)],_0x152b81=>{const _0x3b77d0=_0x1abd41;this[_0x3b77d0(0x1b0)]=![],this.#logStream&&(this.#logStream['end'](),this.#logStream=null),_0x3e4e37['kCuUi'](_0x7b4b43,_0x152b81);});});}[a113_0x5de73f(0x197)](){return this['isProcessRunning'];}async[a113_0x5de73f(0x1a0)](){const _0x414ac3=a113_0x5de73f,_0x2bd3ca={};_0x2bd3ca[_0x414ac3(0x1b2)]=_0x414ac3(0x185),_0x2bd3ca[_0x414ac3(0x1c6)]='automate',_0x2bd3ca[_0x414ac3(0x1ba)]=_0x414ac3(0x1a4),_0x2bd3ca[_0x414ac3(0x190)]=_0x414ac3(0x19a);const _0x4efffd=_0x2bd3ca,_0x4d0fde=this.#config[_0x414ac3(0x1a7)];try{const _0x13d2ba=this.#isApp?_0x4efffd[_0x414ac3(0x1b2)]:_0x4efffd['MmNnK'],_0x419806=await helper['nodeRequest'](_0x4efffd[_0x414ac3(0x1ba)],'api/app_percy/get_project_token?name='+_0x4d0fde+'&type='+_0x13d2ba,{},this.#config),_0x3bae96=_0x419806[_0x414ac3(0x1cb)];return logger[_0x414ac3(0x1ab)](_0x4efffd[_0x414ac3(0x190)]),_0x3bae96['token'];}catch(_0x15e25f){return logger[_0x414ac3(0x189)](_0x414ac3(0x1d5)+_0x15e25f),null;}}async[a113_0x5de73f(0x1d6)](){const _0x5c993b=a113_0x5de73f,_0x3c4133={'qGAye':function(_0x2c56b8,_0x1474d1){return _0x2c56b8(_0x1474d1);},'xIWkD':function(_0x42f4bd,_0x40c8ca){return _0x42f4bd+_0x40c8ca;},'XDqXi':_0x5c993b(0x1af),'nkkmJ':'percy.json'};if(!this.#config['percyOptions'])return null;const _0x20b3e3=path[_0x5c993b(0x196)](os['tmpdir'](),_0x3c4133[_0x5c993b(0x1b7)]),_0x5d1f1c=this.#config[_0x5c993b(0x18d)];return!_0x5d1f1c[_0x5c993b(0x19f)]&&(_0x5d1f1c['version']='2'),new Promise((_0x50adf7,_0x490cc7)=>{const _0x3bfec4=_0x5c993b,_0x178164={'tFkPj':function(_0x315612,_0x5ef8ff){const _0x32b0d8=a113_0x40de;return _0x3c4133[_0x32b0d8(0x1d2)](_0x315612,_0x5ef8ff);},'Tpisx':function(_0x12cfe7,_0x5e4b66){const _0x222b05=a113_0x40de;return _0x3c4133[_0x222b05(0x1b6)](_0x12cfe7,_0x5e4b66);},'hCYQB':_0x3c4133[_0x3bfec4(0x18f)],'LVUBd':function(_0x941f86,_0xfed6e7){const _0x1887ac=_0x3bfec4;return _0x3c4133[_0x1887ac(0x1d2)](_0x941f86,_0xfed6e7);}};fs[_0x3bfec4(0x1ac)](_0x20b3e3,JSON[_0x3bfec4(0x1a3)](_0x5d1f1c),_0x333da5=>{const _0x3ee703=_0x3bfec4;_0x333da5&&(logger[_0x3ee703(0x189)](_0x3ee703(0x1c9)+_0x333da5),_0x178164[_0x3ee703(0x1a9)](_0x50adf7,null)),logger[_0x3ee703(0x1ab)](_0x178164[_0x3ee703(0x1a5)](_0x178164[_0x3ee703(0x1cf)],_0x20b3e3)),_0x178164['LVUBd'](_0x50adf7,_0x20b3e3);});});}}function a113_0x40de(_0x2781bd,_0x3200bb){const _0x250455=a113_0x2504();return a113_0x40de=function(_0x40de3f,_0x44da31){_0x40de3f=_0x40de3f-0x185;let _0x168aed=_0x250455[_0x40de3f];return _0x168aed;},a113_0x40de(_0x2781bd,_0x3200bb);}module['exports']=Percy;
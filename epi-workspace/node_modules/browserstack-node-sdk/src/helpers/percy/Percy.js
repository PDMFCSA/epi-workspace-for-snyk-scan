function a72_0x4aa6(_0x3a1c7f,_0x5e8a27){const _0x4aa13a=a72_0x4aa1();return a72_0x4aa6=function(_0x4aa6fd,_0x116ae4){_0x4aa6fd=_0x4aa6fd-0x169;let _0x163d63=_0x4aa13a[_0x4aa6fd];return _0x163d63;},a72_0x4aa6(_0x3a1c7f,_0x5e8a27);}const a72_0x1468bb=a72_0x4aa6;function a72_0x4aa1(){const _0x5cbeee=['app','error','kEwEH','winstonLogger','isRunning','ENV_VAR','../logger','gByTz','isProcessRunning','iUbUr','7uVJQCn','lQlKY','version','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','ZgONC','end','Percy\x20fetch\x20token\x20success','data','percy/healthcheck','./PercyBinary','kNZsN','Juyef','../../helpers/testhub/constants','automate','percy.json','stderr','2682675XXNpzz','3299612YMXlLW','exec:stop','6134872dGeRBT','path','RBMbr','exports','bRNbx','khmFs','exec','rXwtt','BROWSERSTACK_TESTHUB_UUID','705350qvKimQ','3dihavj','qbFMz','5758422rHKsEe','child_process','fetchPercyToken','tmpdir','app:exec','DOWNLOAD','push','GET','token','percyOptions','stop','../helper','quMGU','createWriteStream','QgxUS','assign','OhmyP','Error\x20creating\x20percy\x20config:\x20','env','createPercyConfig','952900wmYbIP','../../helpers/performance/constants','close','PERCY_SERVER_ADDRESS','debug','api/app_percy/get_project_token?name=','tWcQj','Percy\x20config\x20created\x20at\x20','nodeRequest','join','stringify','percy.log','HDmKh','start','263102gKnEoH','pipe'];a72_0x4aa1=function(){return _0x5cbeee;};return a72_0x4aa1();}(function(_0x589a61,_0xa63afd){const _0x3571ff=a72_0x4aa6,_0x52391d=_0x589a61();while(!![]){try{const _0x409020=parseInt(_0x3571ff(0x18f))/0x1+-parseInt(_0x3571ff(0x16a))/0x2*(parseInt(_0x3571ff(0x16b))/0x3)+parseInt(_0x3571ff(0x1ac))/0x4+-parseInt(_0x3571ff(0x181))/0x5+parseInt(_0x3571ff(0x16d))/0x6*(-parseInt(_0x3571ff(0x19b))/0x7)+parseInt(_0x3571ff(0x1ae))/0x8+parseInt(_0x3571ff(0x1ab))/0x9;if(_0x409020===_0xa63afd)break;else _0x52391d['push'](_0x52391d['shift']());}catch(_0x3e4be4){_0x52391d['push'](_0x52391d['shift']());}}}(a72_0x4aa1,0x9eadb));const fs=require('fs'),path=require(a72_0x1468bb(0x1af)),os=require('os'),{spawn}=require(a72_0x1468bb(0x16e)),helper=require(a72_0x1468bb(0x178)),logger=require('../logger')[a72_0x1468bb(0x194)],{getLogDir}=require(a72_0x1468bb(0x197)),testHubConstants=require(a72_0x1468bb(0x1a7)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x1468bb(0x182)),PercyBinary=require(a72_0x1468bb(0x1a4));class Percy{#logfile=path[a72_0x1468bb(0x18a)](getLogDir(),a72_0x1468bb(0x18c));#address=process[a72_0x1468bb(0x17f)][a72_0x1468bb(0x184)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x1468bb(0x199)]=![];constructor(_0x5201dc){const _0x637368=a72_0x1468bb;this.#config=_0x5201dc,!!_0x5201dc[_0x637368(0x191)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x22dacb=a72_0x1468bb;if(!this.#binaryPath){const _0x2ae5e1=new PercyBinary();PerformanceTester[_0x22dacb(0x18e)](PerformanceEvents[_0x22dacb(0x172)]),this.#binaryPath=await _0x2ae5e1['getBinaryPath'](this.#config),PerformanceTester[_0x22dacb(0x1a0)](PerformanceEvents[_0x22dacb(0x172)]);}return this.#binaryPath;}async #sleep(_0x17b90e){return new Promise(_0x37a643=>setTimeout(_0x37a643,_0x17b90e));}async['healthcheck'](){const _0x2e98ca=a72_0x1468bb,_0x36a91b={};_0x36a91b[_0x2e98ca(0x17b)]=_0x2e98ca(0x174),_0x36a91b[_0x2e98ca(0x1a6)]=_0x2e98ca(0x1a3);const _0x46530f=_0x36a91b;try{const _0x2a05a4=await helper['nodeRequest'](_0x46530f['QgxUS'],_0x46530f['Juyef'],null,null,this.#address);if(_0x2a05a4)return!![];}catch(_0x294710){return![];}}async[a72_0x1468bb(0x18e)](){const _0x4c8350=a72_0x1468bb,_0x240fbb={'iUbUr':_0x4c8350(0x171),'tWcQj':_0x4c8350(0x1b4),'rQHQQ':function(_0x229cc6,_0x1ff36a,_0x5a16e4,_0x59276f){return _0x229cc6(_0x1ff36a,_0x5a16e4,_0x59276f);},'OhmyP':_0x4c8350(0x183),'HqbiN':'Percy\x20healthcheck\x20successful'},_0x49782a=await this.#getBinaryPath(),_0xea6f8f={};_0xea6f8f['flags']='a';const _0x5485d3=fs[_0x4c8350(0x17a)](this.#logfile,_0xea6f8f),_0x4c38e3=await this[_0x4c8350(0x16f)](),_0x4ab409=await this[_0x4c8350(0x180)]();if(!_0x4c38e3)return![];const _0x33a644=[(this.#isApp?_0x240fbb[_0x4c8350(0x19a)]:_0x240fbb[_0x4c8350(0x187)])+':start'];_0x4ab409&&_0x33a644[_0x4c8350(0x173)]('-c',_0x4ab409);this.#proc=_0x240fbb['rQHQQ'](spawn,_0x49782a,_0x33a644,{'env':Object[_0x4c8350(0x17c)](process['env'],{'PERCY_TOKEN':_0x4c38e3,'TH_BUILD_UUID':process['env'][testHubConstants[_0x4c8350(0x196)][_0x4c8350(0x169)]]})}),this.#proc['stdout']['pipe'](_0x5485d3),this.#proc[_0x4c8350(0x1aa)][_0x4c8350(0x190)](_0x5485d3),this[_0x4c8350(0x199)]=!![];var _0x478b15=this;this.#proc['on'](_0x240fbb[_0x4c8350(0x17d)],function(_0x48787e){const _0x32dfd5=_0x4c8350;_0x478b15[_0x32dfd5(0x199)]=![];});do{const _0x2e05e3=await this['healthcheck']();if(_0x2e05e3)return logger[_0x4c8350(0x185)](_0x240fbb['HqbiN']),!![];await this.#sleep(0x3e8);}while(this[_0x4c8350(0x199)]);return![];}async[a72_0x1468bb(0x177)](){const _0x27d591=a72_0x1468bb,_0x559bf6={'quMGU':function(_0x32bc83,_0x276174){return _0x32bc83(_0x276174);},'ZgONC':function(_0x3c64e6,_0x3aea84,_0x12e35d){return _0x3c64e6(_0x3aea84,_0x12e35d);},'Ighrr':_0x27d591(0x1ad),'tgyfv':_0x27d591(0x183)},_0x1f7be7=await this.#getBinaryPath();return new Promise((_0x15a79c,_0x2c9206)=>{const _0x212497=_0x27d591,_0x5bce86=_0x559bf6[_0x212497(0x19f)](spawn,_0x1f7be7,[_0x559bf6['Ighrr']]);_0x5bce86['on'](_0x559bf6['tgyfv'],_0x471814=>{const _0x19c6bb=_0x212497;this[_0x19c6bb(0x199)]=![],_0x559bf6[_0x19c6bb(0x179)](_0x15a79c,_0x471814);});});}[a72_0x1468bb(0x195)](){const _0x3bb61e=a72_0x1468bb;return this[_0x3bb61e(0x199)];}async['fetchPercyToken'](){const _0x2a75c1=a72_0x1468bb,_0x25e44f={};_0x25e44f[_0x2a75c1(0x198)]=_0x2a75c1(0x191),_0x25e44f[_0x2a75c1(0x1b5)]=_0x2a75c1(0x1a8),_0x25e44f['bRNbx']=_0x2a75c1(0x174),_0x25e44f['qbFMz']=_0x2a75c1(0x1a1);const _0x4c09e0=_0x25e44f,_0x5ed00e=this.#config['projectName'];try{const _0x1ca68c=this.#isApp?_0x4c09e0['gByTz']:_0x4c09e0[_0x2a75c1(0x1b5)],_0x319e3f=await helper[_0x2a75c1(0x189)](_0x4c09e0[_0x2a75c1(0x1b2)],_0x2a75c1(0x186)+_0x5ed00e+'&type='+_0x1ca68c,{},this.#config),_0x364f53=_0x319e3f[_0x2a75c1(0x1a2)];return logger['debug'](_0x4c09e0[_0x2a75c1(0x16c)]),_0x364f53[_0x2a75c1(0x175)];}catch(_0x22420c){return logger[_0x2a75c1(0x192)](_0x2a75c1(0x19e)+_0x22420c),null;}}async['createPercyConfig'](){const _0x3717a4=a72_0x1468bb,_0x47feb2={'lLhGi':function(_0x23e8e8,_0x2ef192){return _0x23e8e8(_0x2ef192);},'kNZsN':function(_0x2b84f8,_0x1de115){return _0x2b84f8+_0x1de115;},'khmFs':_0x3717a4(0x188),'lQlKY':_0x3717a4(0x1a9)};if(!this.#config[_0x3717a4(0x176)])return null;const _0x19312d=path[_0x3717a4(0x18a)](os[_0x3717a4(0x170)](),_0x47feb2[_0x3717a4(0x19c)]),_0x3af587=this.#config['percyOptions'];return!_0x3af587[_0x3717a4(0x19d)]&&(_0x3af587['version']='2'),new Promise((_0x2abf53,_0x5bcd98)=>{const _0x3776f2=_0x3717a4,_0x2e2910={'HDmKh':function(_0x1b3c72,_0x1f29b4){return _0x47feb2['lLhGi'](_0x1b3c72,_0x1f29b4);},'kEwEH':function(_0x538061,_0x12138c){const _0x58f6c=a72_0x4aa6;return _0x47feb2[_0x58f6c(0x1a5)](_0x538061,_0x12138c);},'RBMbr':_0x47feb2[_0x3776f2(0x1b3)]};fs['writeFile'](_0x19312d,JSON[_0x3776f2(0x18b)](_0x3af587),_0x17be9f=>{const _0x2fb638=_0x3776f2;_0x17be9f&&(logger[_0x2fb638(0x192)](_0x2fb638(0x17e)+_0x17be9f),_0x2e2910[_0x2fb638(0x18d)](_0x2abf53,null)),logger['debug'](_0x2e2910[_0x2fb638(0x193)](_0x2e2910[_0x2fb638(0x1b0)],_0x19312d)),_0x2e2910[_0x2fb638(0x18d)](_0x2abf53,_0x19312d);});});}}module[a72_0x1468bb(0x1b1)]=Percy;
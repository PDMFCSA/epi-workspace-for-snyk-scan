function a72_0x2d12(){const _0x57e90d=['automate','createPercyConfig','768ktWloJ','EEUDU','api/app_percy/get_project_token?name=','Error\x20creating\x20percy\x20config:\x20','MdFfl','138916qGewav','healthcheck','app','kvvFs','http://localhost:5338','stringify','DOWNLOAD','38058wZyYHN','exec:stop','isProcessRunning','tFOjA','nodeRequest','10NmqYuw','../../helpers/performance/constants','../logger','../../helpers/testhub/constants','qjQey','tBjYC','tmpdir','IhtOn','join','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','GET','child_process','BROWSERSTACK_TESTHUB_UUID','XbQDl','301mjXjwx','Percy\x20config\x20created\x20at\x20','&type=','percy.log','893092LPCJKN','path','start','ENV_VAR','token','data','10vDHNUT','stop','JkJla','4320800ecWnBu','writeFile','pipe','MRvAO',':start','projectName','exec','../../helpers/performance/performance-tester','442725fzxEyN','fetchPercyToken','Percy\x20fetch\x20token\x20success','tynOb','mociQ','env','NqRwC','../helper','flags','ZWnyQ','HnCoc','130530LcLVaP','push','1557BmXJJC','assign','percyOptions','debug','close','app:exec','LsSue','getBinaryPath','xmtPP'];a72_0x2d12=function(){return _0x57e90d;};return a72_0x2d12();}function a72_0x35d8(_0x36070b,_0x3ab02f){const _0x2d12d5=a72_0x2d12();return a72_0x35d8=function(_0x35d8e1,_0xa7d1eb){_0x35d8e1=_0x35d8e1-0xc1;let _0x39e940=_0x2d12d5[_0x35d8e1];return _0x39e940;},a72_0x35d8(_0x36070b,_0x3ab02f);}const a72_0x31ce3f=a72_0x35d8;(function(_0x417db1,_0x594d67){const _0x7587aa=a72_0x35d8,_0x5eb614=_0x417db1();while(!![]){try{const _0xa2967d=-parseInt(_0x7587aa(0xd9))/0x1+-parseInt(_0x7587aa(0xe5))/0x2*(parseInt(_0x7587aa(0xc7))/0x3)+-parseInt(_0x7587aa(0xf7))/0x4+parseInt(_0x7587aa(0x108))/0x5+-parseInt(_0x7587aa(0xe0))/0x6*(-parseInt(_0x7587aa(0xf3))/0x7)+parseInt(_0x7587aa(0xd4))/0x8*(-parseInt(_0x7587aa(0xc9))/0x9)+parseInt(_0x7587aa(0xfd))/0xa*(parseInt(_0x7587aa(0x100))/0xb);if(_0xa2967d===_0x594d67)break;else _0x5eb614['push'](_0x5eb614['shift']());}catch(_0x4bb371){_0x5eb614['push'](_0x5eb614['shift']());}}}(a72_0x2d12,0x26833));const fs=require('fs'),path=require(a72_0x31ce3f(0xf8)),os=require('os'),{spawn}=require(a72_0x31ce3f(0xf0)),helper=require(a72_0x31ce3f(0xc3)),logger=require(a72_0x31ce3f(0xe7))['winstonLogger'],{logDir}=require(a72_0x31ce3f(0xe7)),testHubConstants=require(a72_0x31ce3f(0xe8)),PerformanceTester=require(a72_0x31ce3f(0x107)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x31ce3f(0xe6)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a72_0x31ce3f(0xed)](logDir,a72_0x31ce3f(0xf6));#address=process[a72_0x31ce3f(0xc1)]['PERCY_SERVER_ADDRESS']||a72_0x31ce3f(0xdd);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x31ce3f(0xe2)]=![];constructor(_0x507450){const _0x4bb2e6=a72_0x31ce3f;this.#config=_0x507450,!!_0x507450[_0x4bb2e6(0xdb)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x2409a4=a72_0x31ce3f;if(!this.#binaryPath){const _0x1faa62=new PercyBinary();PerformanceTester[_0x2409a4(0xf9)](PerformanceEvents[_0x2409a4(0xdf)]),this.#binaryPath=await _0x1faa62[_0x2409a4(0xd0)](this.#config),PerformanceTester['end'](PerformanceEvents[_0x2409a4(0xdf)]);}return this.#binaryPath;}async #sleep(_0x1dd4be){return new Promise(_0x26b869=>setTimeout(_0x26b869,_0x1dd4be));}async[a72_0x31ce3f(0xda)](){const _0x2c9b6e=a72_0x31ce3f,_0x53fbf5={};_0x53fbf5[_0x2c9b6e(0xea)]=_0x2c9b6e(0xef),_0x53fbf5[_0x2c9b6e(0xc6)]='percy/healthcheck';const _0x248cb3=_0x53fbf5;try{const _0xbc77af=await helper[_0x2c9b6e(0xe4)](_0x248cb3[_0x2c9b6e(0xea)],_0x248cb3[_0x2c9b6e(0xc6)],null,null,this.#address);if(_0xbc77af)return!![];}catch(_0x3adf25){return![];}}async[a72_0x31ce3f(0xf9)](){const _0x389978=a72_0x31ce3f,_0x2cfaa5={'rSpuP':_0x389978(0xce),'tFOjA':_0x389978(0x106),'tynOb':function(_0x1cc404,_0x16dc67,_0x6b5cce,_0x345c03){return _0x1cc404(_0x16dc67,_0x6b5cce,_0x345c03);},'LsSue':_0x389978(0xcd),'ZWnyQ':'Percy\x20healthcheck\x20successful'},_0x59ccba=await this.#getBinaryPath(),_0x90946f={};_0x90946f[_0x389978(0xc4)]='a';const _0x28a796=fs['createWriteStream'](this.#logfile,_0x90946f),_0x54bba5=await this[_0x389978(0x109)](),_0x2ceb84=await this[_0x389978(0xd3)]();if(!_0x54bba5)return![];const _0x231e8a=[(this.#isApp?_0x2cfaa5['rSpuP']:_0x2cfaa5[_0x389978(0xe3)])+_0x389978(0x104)];_0x2ceb84&&_0x231e8a[_0x389978(0xc8)]('-c',_0x2ceb84);this.#proc=_0x2cfaa5[_0x389978(0x10b)](spawn,_0x59ccba,_0x231e8a,{'env':Object[_0x389978(0xca)](process[_0x389978(0xc1)],{'PERCY_TOKEN':_0x54bba5,'TH_BUILD_UUID':process['env'][testHubConstants[_0x389978(0xfa)][_0x389978(0xf1)]]})}),this.#proc['stdout']['pipe'](_0x28a796),this.#proc['stderr'][_0x389978(0x102)](_0x28a796),this['isProcessRunning']=!![];var _0x436abe=this;this.#proc['on'](_0x2cfaa5[_0x389978(0xcf)],function(_0xf34900){const _0x4323b3=_0x389978;_0x436abe[_0x4323b3(0xe2)]=![];});do{const _0x26d131=await this[_0x389978(0xda)]();if(_0x26d131)return logger['debug'](_0x2cfaa5[_0x389978(0xc5)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x31ce3f(0xfe)](){const _0x346365=a72_0x31ce3f,_0x1f1820={'LtGOX':function(_0x4b1388,_0x4696e1){return _0x4b1388(_0x4696e1);},'kvvFs':function(_0x1cdf3e,_0x5c3e3f,_0x480d0d){return _0x1cdf3e(_0x5c3e3f,_0x480d0d);},'XbQDl':_0x346365(0xe1),'xmtPP':_0x346365(0xcd)},_0x1bca2c=await this.#getBinaryPath();return new Promise((_0x229cee,_0x31ced3)=>{const _0x2ebe90=_0x346365,_0x4a3629={'vdUlY':function(_0x4a2c6b,_0x147ea0){return _0x1f1820['LtGOX'](_0x4a2c6b,_0x147ea0);}},_0x481c45=_0x1f1820[_0x2ebe90(0xdc)](spawn,_0x1bca2c,[_0x1f1820[_0x2ebe90(0xf2)]]);_0x481c45['on'](_0x1f1820[_0x2ebe90(0xd1)],_0x593c42=>{const _0x2fb3bf=_0x2ebe90;this[_0x2fb3bf(0xe2)]=![],_0x4a3629['vdUlY'](_0x229cee,_0x593c42);});});}['isRunning'](){const _0x432128=a72_0x31ce3f;return this[_0x432128(0xe2)];}async['fetchPercyToken'](){const _0x47bff2=a72_0x31ce3f,_0x24e3f4={};_0x24e3f4[_0x47bff2(0x10c)]=_0x47bff2(0xdb),_0x24e3f4[_0x47bff2(0xd8)]=_0x47bff2(0xd2),_0x24e3f4['IhtOn']=_0x47bff2(0xef),_0x24e3f4[_0x47bff2(0x103)]=_0x47bff2(0x10a);const _0x15fc57=_0x24e3f4,_0x2961fc=this.#config[_0x47bff2(0x105)];try{const _0x3bb51f=this.#isApp?_0x15fc57[_0x47bff2(0x10c)]:_0x15fc57['MdFfl'],_0x567a9d=await helper[_0x47bff2(0xe4)](_0x15fc57[_0x47bff2(0xec)],_0x47bff2(0xd6)+_0x2961fc+_0x47bff2(0xf5)+_0x3bb51f,{},this.#config),_0x457c6e=_0x567a9d[_0x47bff2(0xfc)];return logger['debug'](_0x15fc57[_0x47bff2(0x103)]),_0x457c6e[_0x47bff2(0xfb)];}catch(_0xc1cb4d){return logger['error'](_0x47bff2(0xee)+_0xc1cb4d),null;}}async[a72_0x31ce3f(0xd3)](){const _0x4c1cbf=a72_0x31ce3f,_0x424566={'NqRwC':function(_0x1e3985,_0x53dfa9){return _0x1e3985(_0x53dfa9);},'JkJla':function(_0x234254,_0x110151){return _0x234254+_0x110151;},'AhWnZ':_0x4c1cbf(0xf4),'EEUDU':function(_0x1280e5,_0x2c5cb3){return _0x1280e5(_0x2c5cb3);},'qjQey':'percy.json'};if(!this.#config[_0x4c1cbf(0xcb)])return null;const _0x4c36ed=path['join'](os[_0x4c1cbf(0xeb)](),_0x424566[_0x4c1cbf(0xe9)]),_0x59f1d8=this.#config[_0x4c1cbf(0xcb)];return!_0x59f1d8['version']&&(_0x59f1d8['version']='2'),new Promise((_0x32d7fc,_0x27fa29)=>{const _0x503c7d=_0x4c1cbf;fs[_0x503c7d(0x101)](_0x4c36ed,JSON[_0x503c7d(0xde)](_0x59f1d8),_0x3e64df=>{const _0x917891=_0x503c7d;_0x3e64df&&(logger['error'](_0x917891(0xd7)+_0x3e64df),_0x424566[_0x917891(0xc2)](_0x32d7fc,null)),logger[_0x917891(0xcc)](_0x424566[_0x917891(0xff)](_0x424566['AhWnZ'],_0x4c36ed)),_0x424566[_0x917891(0xd5)](_0x32d7fc,_0x4c36ed);});});}}module['exports']=Percy;
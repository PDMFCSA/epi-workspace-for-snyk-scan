const a98_0x214af0=a98_0x5592;(function(_0xe934d3,_0x337b00){const _0x312776=a98_0x5592,_0x202b9b=_0xe934d3();while(!![]){try{const _0x4d3121=-parseInt(_0x312776(0xf6))/0x1*(-parseInt(_0x312776(0xd7))/0x2)+-parseInt(_0x312776(0xb5))/0x3*(parseInt(_0x312776(0xcc))/0x4)+-parseInt(_0x312776(0xf0))/0x5+parseInt(_0x312776(0xe8))/0x6+-parseInt(_0x312776(0xc7))/0x7*(parseInt(_0x312776(0xee))/0x8)+parseInt(_0x312776(0xc0))/0x9+parseInt(_0x312776(0xd1))/0xa;if(_0x4d3121===_0x337b00)break;else _0x202b9b['push'](_0x202b9b['shift']());}catch(_0x14f4a9){_0x202b9b['push'](_0x202b9b['shift']());}}}(a98_0x5164,0x6e2ce));function a98_0x5164(){const _0x28d3b9=['debug','DKUzy','DhUbk','kYflN','fetchPercyToken','isRunning','Error\x20creating\x20percy\x20config:\x20','stringify','5407668IxQAWg','vscwV','GET','percyOptions','MbVWv','api/app_percy/get_project_token?name=','8NtFqbj','app:exec','2389730xGiEHW','KwKun','env','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','join','ZvxTO','1700qlpVuW','DOWNLOAD','ZPPRl','XsbDP','percy.log','stdout','stderr','stop','zTDNz','end','projectName','winstonLogger','1905993kZBbLI','token','app','isProcessRunning','start','data','QcYaZ','dZCtd','../../helpers/testhub/constants','PERCY_SERVER_ADDRESS','YvKBX','2080584HYQNbz','BROWSERSTACK_TESTHUB_UUID','writeFile','healthcheck','./PercyBinary','../../helpers/performance/constants','pipe','39851doNpHu','EOEcs','nodeRequest','jKhsA','push','4nDAlqu','close','assign','sGlEN','getBinaryPath','2082940WGBHbT','../helper',':start','ENV_VAR','percy.json','../logger','270iArhay','createWriteStream','exports','path','version','exec','percy/healthcheck','createPercyConfig','error'];a98_0x5164=function(){return _0x28d3b9;};return a98_0x5164();}const fs=require('fs'),path=require(a98_0x214af0(0xda)),os=require('os'),{spawn}=require('child_process'),helper=require(a98_0x214af0(0xd2)),logger=require(a98_0x214af0(0xd6))[a98_0x214af0(0xb4)],{getLogDir}=require(a98_0x214af0(0xd6)),testHubConstants=require(a98_0x214af0(0xbd)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a98_0x214af0(0xc5)),PercyBinary=require(a98_0x214af0(0xc4));class Percy{#logfile=path[a98_0x214af0(0xf4)](getLogDir(),a98_0x214af0(0xad));#address=process['env'][a98_0x214af0(0xbe)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a98_0x214af0(0xb8)]=![];constructor(_0x4f3b38){this.#config=_0x4f3b38,!!_0x4f3b38['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x3a7b51=a98_0x214af0;if(!this.#binaryPath){const _0x81a75c=new PercyBinary();PerformanceTester[_0x3a7b51(0xb9)](PerformanceEvents[_0x3a7b51(0xaa)]),this.#binaryPath=await _0x81a75c[_0x3a7b51(0xd0)](this.#config),PerformanceTester[_0x3a7b51(0xb2)](PerformanceEvents[_0x3a7b51(0xaa)]);}return this.#binaryPath;}async #sleep(_0x402738){return new Promise(_0x226b0c=>setTimeout(_0x226b0c,_0x402738));}async['healthcheck'](){const _0x268ec8=a98_0x214af0,_0x3e571c={};_0x3e571c[_0x268ec8(0xe1)]=_0x268ec8(0xea),_0x3e571c['XsbDP']=_0x268ec8(0xdd);const _0x31797b=_0x3e571c;try{const _0x375ed9=await helper[_0x268ec8(0xc9)](_0x31797b[_0x268ec8(0xe1)],_0x31797b[_0x268ec8(0xac)],null,null,this.#address);if(_0x375ed9)return!![];}catch(_0x5e7a7d){return![];}}async[a98_0x214af0(0xb9)](){const _0xa890ec=a98_0x214af0,_0x97742a={'ZPPRl':_0xa890ec(0xef),'EOEcs':_0xa890ec(0xdc),'kYflN':function(_0x4a7b80,_0x1e8102,_0x2ce722,_0x50ed01){return _0x4a7b80(_0x1e8102,_0x2ce722,_0x50ed01);},'kdKep':_0xa890ec(0xcd),'jKhsA':'Percy\x20healthcheck\x20successful'},_0x396cf9=await this.#getBinaryPath(),_0x1c34a3={};_0x1c34a3['flags']='a';const _0x501f09=fs[_0xa890ec(0xd8)](this.#logfile,_0x1c34a3),_0x1bfe1c=await this[_0xa890ec(0xe4)](),_0x3e5f0e=await this[_0xa890ec(0xde)]();if(!_0x1bfe1c)return![];const _0x1884f9=[(this.#isApp?_0x97742a[_0xa890ec(0xab)]:_0x97742a[_0xa890ec(0xc8)])+_0xa890ec(0xd3)];_0x3e5f0e&&_0x1884f9[_0xa890ec(0xcb)]('-c',_0x3e5f0e);this.#proc=_0x97742a[_0xa890ec(0xe3)](spawn,_0x396cf9,_0x1884f9,{'env':Object[_0xa890ec(0xce)](process[_0xa890ec(0xf2)],{'PERCY_TOKEN':_0x1bfe1c,'TH_BUILD_UUID':process['env'][testHubConstants[_0xa890ec(0xd4)][_0xa890ec(0xc1)]]})}),this.#proc[_0xa890ec(0xae)][_0xa890ec(0xc6)](_0x501f09),this.#proc[_0xa890ec(0xaf)][_0xa890ec(0xc6)](_0x501f09),this[_0xa890ec(0xb8)]=!![];var _0xd8bda1=this;this.#proc['on'](_0x97742a['kdKep'],function(_0x1766f6){const _0x41ba6b=_0xa890ec;_0xd8bda1[_0x41ba6b(0xb8)]=![];});do{const _0x3586c3=await this[_0xa890ec(0xc3)]();if(_0x3586c3)return logger[_0xa890ec(0xe0)](_0x97742a[_0xa890ec(0xca)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a98_0x214af0(0xb0)](){const _0x27070a=a98_0x214af0,_0x261033={'YvKBX':function(_0x4674fc,_0x46190d){return _0x4674fc(_0x46190d);},'ZvxTO':function(_0x2b63ff,_0xc49e73,_0x34dfdd){return _0x2b63ff(_0xc49e73,_0x34dfdd);},'QcYaZ':'exec:stop','yTrYM':_0x27070a(0xcd)},_0x3eae90=await this.#getBinaryPath();return new Promise((_0x55582a,_0x35caaa)=>{const _0x2e96ac=_0x27070a,_0x53db14={'zTDNz':function(_0x2dae05,_0x4d1bab){const _0x30cf97=a98_0x5592;return _0x261033[_0x30cf97(0xbf)](_0x2dae05,_0x4d1bab);}},_0x3fc934=_0x261033[_0x2e96ac(0xf5)](spawn,_0x3eae90,[_0x261033[_0x2e96ac(0xbb)]]);_0x3fc934['on'](_0x261033['yTrYM'],_0x2a910c=>{const _0x4933cf=_0x2e96ac;this[_0x4933cf(0xb8)]=![],_0x53db14[_0x4933cf(0xb1)](_0x55582a,_0x2a910c);});});}[a98_0x214af0(0xe5)](){const _0x5501ba=a98_0x214af0;return this[_0x5501ba(0xb8)];}async['fetchPercyToken'](){const _0x1e3464=a98_0x214af0,_0x5dedab={};_0x5dedab[_0x1e3464(0xe9)]=_0x1e3464(0xb7),_0x5dedab[_0x1e3464(0xf1)]='automate',_0x5dedab['FySYe']='GET',_0x5dedab['dZCtd']='Percy\x20fetch\x20token\x20success';const _0x4cec7e=_0x5dedab,_0x55cf34=this.#config[_0x1e3464(0xb3)];try{const _0x8abac3=this.#isApp?_0x4cec7e['vscwV']:_0x4cec7e[_0x1e3464(0xf1)],_0x30b6bc=await helper['nodeRequest'](_0x4cec7e['FySYe'],_0x1e3464(0xed)+_0x55cf34+'&type='+_0x8abac3,{},this.#config),_0x3e8954=_0x30b6bc[_0x1e3464(0xba)];return logger[_0x1e3464(0xe0)](_0x4cec7e[_0x1e3464(0xbc)]),_0x3e8954[_0x1e3464(0xb6)];}catch(_0x4b856c){return logger[_0x1e3464(0xdf)](_0x1e3464(0xf3)+_0x4b856c),null;}}async[a98_0x214af0(0xde)](){const _0x126f50=a98_0x214af0,_0x377db8={'DhUbk':function(_0x35961f,_0x2b14a9){return _0x35961f(_0x2b14a9);},'sGlEN':function(_0x34d97c,_0x2b1539){return _0x34d97c+_0x2b1539;},'xVQGR':'Percy\x20config\x20created\x20at\x20','BuqkR':function(_0x28c4cd,_0x16d12b){return _0x28c4cd(_0x16d12b);},'MbVWv':_0x126f50(0xd5)};if(!this.#config[_0x126f50(0xeb)])return null;const _0x4212c8=path['join'](os['tmpdir'](),_0x377db8[_0x126f50(0xec)]),_0x561c55=this.#config[_0x126f50(0xeb)];return!_0x561c55[_0x126f50(0xdb)]&&(_0x561c55[_0x126f50(0xdb)]='2'),new Promise((_0x5b2a38,_0x4a878a)=>{const _0x7a837e=_0x126f50;fs[_0x7a837e(0xc2)](_0x4212c8,JSON[_0x7a837e(0xe7)](_0x561c55),_0x1d38f7=>{const _0x494fc2=_0x7a837e;_0x1d38f7&&(logger[_0x494fc2(0xdf)](_0x494fc2(0xe6)+_0x1d38f7),_0x377db8[_0x494fc2(0xe2)](_0x5b2a38,null)),logger['debug'](_0x377db8[_0x494fc2(0xcf)](_0x377db8['xVQGR'],_0x4212c8)),_0x377db8['BuqkR'](_0x5b2a38,_0x4212c8);});});}}function a98_0x5592(_0x35e5d3,_0x38b3eb){const _0x516483=a98_0x5164();return a98_0x5592=function(_0x559284,_0x2801f1){_0x559284=_0x559284-0xaa;let _0x3bd306=_0x516483[_0x559284];return _0x3bd306;},a98_0x5592(_0x35e5d3,_0x38b3eb);}module[a98_0x214af0(0xd9)]=Percy;
const a72_0x2052de=a72_0x3d67;(function(_0x246a79,_0x3358d7){const _0x20d3ab=a72_0x3d67,_0x4340a9=_0x246a79();while(!![]){try{const _0x13c419=-parseInt(_0x20d3ab(0x96))/0x1*(parseInt(_0x20d3ab(0xd0))/0x2)+-parseInt(_0x20d3ab(0xaa))/0x3+-parseInt(_0x20d3ab(0xb2))/0x4+-parseInt(_0x20d3ab(0xcf))/0x5+parseInt(_0x20d3ab(0xb3))/0x6*(parseInt(_0x20d3ab(0xae))/0x7)+parseInt(_0x20d3ab(0xbd))/0x8+-parseInt(_0x20d3ab(0xbb))/0x9*(-parseInt(_0x20d3ab(0xc4))/0xa);if(_0x13c419===_0x3358d7)break;else _0x4340a9['push'](_0x4340a9['shift']());}catch(_0x543a64){_0x4340a9['push'](_0x4340a9['shift']());}}}(a72_0x4f3b,0x461af));const fs=require('fs'),path=require(a72_0x2052de(0xd6)),os=require('os'),{spawn}=require(a72_0x2052de(0xd2)),helper=require('../helper'),logger=require(a72_0x2052de(0x9b))[a72_0x2052de(0xb0)],{logDir}=require(a72_0x2052de(0x9b)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a72_0x2052de(0x8e)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x2052de(0xd7)),PercyBinary=require(a72_0x2052de(0xc1));class Percy{#logfile=path['join'](logDir,a72_0x2052de(0xbf));#address=process[a72_0x2052de(0xa6)][a72_0x2052de(0xce)]||a72_0x2052de(0x91);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x2052de(0xd3)]=![];constructor(_0x12463a){const _0x178681=a72_0x2052de;this.#config=_0x12463a,!!_0x12463a[_0x178681(0x9a)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x5af6ba=a72_0x2052de;if(!this.#binaryPath){const _0xbf7a6c=new PercyBinary();PerformanceTester[_0x5af6ba(0xa1)](PerformanceEvents[_0x5af6ba(0xb7)]),this.#binaryPath=await _0xbf7a6c[_0x5af6ba(0xba)](this.#config),PerformanceTester['end'](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x353a7e){return new Promise(_0x370567=>setTimeout(_0x370567,_0x353a7e));}async[a72_0x2052de(0xc2)](){const _0x2f8501=a72_0x2052de,_0x2f7e7b={};_0x2f7e7b[_0x2f8501(0xb1)]='GET',_0x2f7e7b['eYvuQ']=_0x2f8501(0xcc);const _0x587cbc=_0x2f7e7b;try{const _0x30eb55=await helper[_0x2f8501(0xc6)](_0x587cbc['YrxdD'],_0x587cbc['eYvuQ'],null,null,this.#address);if(_0x30eb55)return!![];}catch(_0x10e765){return![];}}async[a72_0x2052de(0xa1)](){const _0xa1133f=a72_0x2052de,_0x1d0a37={'xFRBu':_0xa1133f(0xb9),'mXKdl':'exec','KygEZ':function(_0x527e67,_0x42ebeb,_0x1d8eb4,_0x1bdbc7){return _0x527e67(_0x42ebeb,_0x1d8eb4,_0x1bdbc7);},'UvNHK':_0xa1133f(0xb6),'MZlEi':_0xa1133f(0x9e)},_0x3473d9=await this.#getBinaryPath(),_0x266263={};_0x266263[_0xa1133f(0xa0)]='a';const _0x171b08=fs[_0xa1133f(0x98)](this.#logfile,_0x266263),_0x29644a=await this['fetchPercyToken'](),_0x4a5fa6=await this[_0xa1133f(0xa8)]();if(!_0x29644a)return![];const _0x53618e=[(this.#isApp?_0x1d0a37[_0xa1133f(0x8f)]:_0x1d0a37[_0xa1133f(0xbe)])+_0xa1133f(0xc0)];_0x4a5fa6&&_0x53618e['push']('-c',_0x4a5fa6);this.#proc=_0x1d0a37[_0xa1133f(0x93)](spawn,_0x3473d9,_0x53618e,{'env':Object['assign'](process['env'],{'PERCY_TOKEN':_0x29644a,'TH_BUILD_UUID':process[_0xa1133f(0xa6)][testHubConstants[_0xa1133f(0xc8)][_0xa1133f(0xc7)]]})}),this.#proc[_0xa1133f(0xa2)][_0xa1133f(0xcd)](_0x171b08),this.#proc[_0xa1133f(0x9d)][_0xa1133f(0xcd)](_0x171b08),this[_0xa1133f(0xd3)]=!![];var _0x32ea03=this;this.#proc['on'](_0x1d0a37[_0xa1133f(0x9f)],function(_0x75edc3){const _0x187911=_0xa1133f;_0x32ea03[_0x187911(0xd3)]=![];});do{const _0x4dc10f=await this[_0xa1133f(0xc2)]();if(_0x4dc10f)return logger[_0xa1133f(0xa5)](_0x1d0a37['MZlEi']),!![];await this.#sleep(0x3e8);}while(this[_0xa1133f(0xd3)]);return![];}async[a72_0x2052de(0x94)](){const _0x8f4a7e=a72_0x2052de,_0x29416b={'tqIYC':function(_0xa6c857,_0x3c1585){return _0xa6c857(_0x3c1585);},'nybrH':function(_0x4f4a41,_0x3b02fd,_0x18dd4e){return _0x4f4a41(_0x3b02fd,_0x18dd4e);},'TgxQr':_0x8f4a7e(0xb5),'nHXYP':_0x8f4a7e(0xb6)},_0x2ee376=await this.#getBinaryPath();return new Promise((_0x7ff4fb,_0x1f2076)=>{const _0x32dd99=_0x8f4a7e,_0x5b502d=_0x29416b[_0x32dd99(0xc3)](spawn,_0x2ee376,[_0x29416b['TgxQr']]);_0x5b502d['on'](_0x29416b[_0x32dd99(0xab)],_0x24b351=>{const _0x4c37de=_0x32dd99;this['isProcessRunning']=![],_0x29416b[_0x4c37de(0xca)](_0x7ff4fb,_0x24b351);});});}[a72_0x2052de(0xa4)](){return this['isProcessRunning'];}async[a72_0x2052de(0xb8)](){const _0x2302d5=a72_0x2052de,_0x16354b={};_0x16354b[_0x2302d5(0xcb)]=_0x2302d5(0x9a),_0x16354b['rtPQH']=_0x2302d5(0x99),_0x16354b[_0x2302d5(0xaf)]=_0x2302d5(0x92),_0x16354b[_0x2302d5(0xd5)]=_0x2302d5(0xd8);const _0x4ebdd6=_0x16354b,_0x1b49ba=this.#config[_0x2302d5(0xa3)];try{const _0x234632=this.#isApp?_0x4ebdd6[_0x2302d5(0xcb)]:_0x4ebdd6['rtPQH'],_0x44dd15=await helper[_0x2302d5(0xc6)](_0x4ebdd6[_0x2302d5(0xaf)],_0x2302d5(0x8d)+_0x1b49ba+_0x2302d5(0xb4)+_0x234632,{},this.#config),_0x15714c=_0x44dd15['data'];return logger[_0x2302d5(0xa5)](_0x4ebdd6[_0x2302d5(0xd5)]),_0x15714c[_0x2302d5(0xa9)];}catch(_0x5836eb){return logger[_0x2302d5(0xc9)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x5836eb),null;}}async[a72_0x2052de(0xa8)](){const _0x335c59=a72_0x2052de,_0x4d3daa={'ZKdnq':function(_0x493ba6,_0x104f7e){return _0x493ba6(_0x104f7e);},'SBsKP':function(_0x235237,_0x274825){return _0x235237+_0x274825;},'yhuWN':_0x335c59(0x95),'FJueM':_0x335c59(0xa7)};if(!this.#config[_0x335c59(0xd4)])return null;const _0x3b4f16=path[_0x335c59(0xd1)](os['tmpdir'](),_0x4d3daa['FJueM']),_0x11073a=this.#config[_0x335c59(0xd4)];return!_0x11073a[_0x335c59(0x90)]&&(_0x11073a[_0x335c59(0x90)]='2'),new Promise((_0x5bae1c,_0x18f79c)=>{const _0x347cd5=_0x335c59;fs[_0x347cd5(0xbc)](_0x3b4f16,JSON['stringify'](_0x11073a),_0x148bc8=>{const _0x1b8cb3=_0x347cd5;_0x148bc8&&(logger['error'](_0x1b8cb3(0xc5)+_0x148bc8),_0x4d3daa['ZKdnq'](_0x5bae1c,null)),logger['debug'](_0x4d3daa[_0x1b8cb3(0x9c)](_0x4d3daa[_0x1b8cb3(0xad)],_0x3b4f16)),_0x4d3daa[_0x1b8cb3(0xac)](_0x5bae1c,_0x3b4f16);});});}}function a72_0x3d67(_0x5380ea,_0x1d8bf0){const _0x4f3b1c=a72_0x4f3b();return a72_0x3d67=function(_0x3d67cb,_0x2b4608){_0x3d67cb=_0x3d67cb-0x8d;let _0x4e1795=_0x4f3b1c[_0x3d67cb];return _0x4e1795;},a72_0x3d67(_0x5380ea,_0x1d8bf0);}function a72_0x4f3b(){const _0x1738fc=['Error\x20creating\x20percy\x20config:\x20','nodeRequest','BROWSERSTACK_TESTHUB_UUID','ENV_VAR','error','tqIYC','pfdbw','percy/healthcheck','pipe','PERCY_SERVER_ADDRESS','394840FolqaK','7646TVucjX','join','child_process','isProcessRunning','percyOptions','VHdMd','path','../../helpers/performance/constants','Percy\x20fetch\x20token\x20success','api/app_percy/get_project_token?name=','../../helpers/performance/performance-tester','xFRBu','version','http://localhost:5338','GET','KygEZ','stop','Percy\x20config\x20created\x20at\x20','41AKYNvv','exports','createWriteStream','automate','app','../logger','SBsKP','stderr','Percy\x20healthcheck\x20successful','UvNHK','flags','start','stdout','projectName','isRunning','debug','env','percy.json','createPercyConfig','token','481782ARIIAU','nHXYP','ZKdnq','yhuWN','23317xODKRy','mXTbd','winstonLogger','YrxdD','1171100NydFLs','216IJRrXe','&type=','exec:stop','close','DOWNLOAD','fetchPercyToken','app:exec','getBinaryPath','7103835CFWBuN','writeFile','536000ocRLkn','mXKdl','percy.log',':start','./PercyBinary','healthcheck','nybrH','10PohcwY'];a72_0x4f3b=function(){return _0x1738fc;};return a72_0x4f3b();}module[a72_0x2052de(0x97)]=Percy;
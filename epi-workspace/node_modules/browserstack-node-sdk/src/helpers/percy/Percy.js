const a99_0xb705d0=a99_0x5e91;function a99_0xa2a0(){const _0x1578da=['http://localhost:5338','Error\x20creating\x20percy\x20config:\x20','stop','gHkSu','CVJzV','388215WnxZrn','nodeRequest','data','../../helpers/performance/performance-tester','healthcheck','flags','9378FfbRgA','percyOptions','join','token','close','GET','error','NQFQl','9124uhFVVW','102BEZord','QPMll','writeFile','stderr','child_process','&type=','automate','../../helpers/performance/constants','866990aMbWbT','Percy\x20config\x20created\x20at\x20','projectName','1531984eYCCfS','exports','percy/healthcheck','./PercyBinary','pipe','../../helpers/testhub/constants','2560dHAGUN','WPzVi','MMSHj','owiJo','BROWSERSTACK_TESTHUB_UUID','createPercyConfig','exec','QMXbF','../logger','debug','veXmP','201zNeBNs','5539gyzvOk','version','fetchPercyToken','PERCY_SERVER_ADDRESS','eZVUc','lHhgG',':start','isProcessRunning','pONFK','../helper','createWriteStream','percy.log','start','app:exec','push','env','vjesZ','tmpdir','4361BpVKPr','DOWNLOAD','api/app_percy/get_project_token?name=','VvRGQ'];a99_0xa2a0=function(){return _0x1578da;};return a99_0xa2a0();}(function(_0x482a4c,_0x2dbf52){const _0x17b4ed=a99_0x5e91,_0x2e060b=_0x482a4c();while(!![]){try{const _0x5cdaac=-parseInt(_0x17b4ed(0x114))/0x1+parseInt(_0x17b4ed(0xff))/0x2+-parseInt(_0x17b4ed(0x113))/0x3*(parseInt(_0x17b4ed(0xf6))/0x4)+-parseInt(_0x17b4ed(0xe8))/0x5+parseInt(_0x17b4ed(0xf7))/0x6*(-parseInt(_0x17b4ed(0x126))/0x7)+-parseInt(_0x17b4ed(0x102))/0x8+parseInt(_0x17b4ed(0xee))/0x9*(parseInt(_0x17b4ed(0x108))/0xa);if(_0x5cdaac===_0x2dbf52)break;else _0x2e060b['push'](_0x2e060b['shift']());}catch(_0x10fb82){_0x2e060b['push'](_0x2e060b['shift']());}}}(a99_0xa2a0,0x40005));function a99_0x5e91(_0x241627,_0x4cfd86){const _0xa2a0f9=a99_0xa2a0();return a99_0x5e91=function(_0x5e91ed,_0x4bce13){_0x5e91ed=_0x5e91ed-0xe0;let _0x3641b2=_0xa2a0f9[_0x5e91ed];return _0x3641b2;},a99_0x5e91(_0x241627,_0x4cfd86);}const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a99_0xb705d0(0xfb)),helper=require(a99_0xb705d0(0x11d)),logger=require(a99_0xb705d0(0x110))['winstonLogger'],{getLogDir}=require(a99_0xb705d0(0x110)),testHubConstants=require(a99_0xb705d0(0x107)),PerformanceTester=require(a99_0xb705d0(0xeb)),{PERCY_EVENTS:PerformanceEvents}=require(a99_0xb705d0(0xfe)),PercyBinary=require(a99_0xb705d0(0x105));class Percy{#logfile=path['join'](getLogDir(),a99_0xb705d0(0x11f));#address=process['env'][a99_0xb705d0(0x117)]||a99_0xb705d0(0xe3);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a99_0xb705d0(0x11b)]=![];constructor(_0x245214){this.#config=_0x245214,!!_0x245214['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x444267=a99_0xb705d0;if(!this.#binaryPath){const _0x45af4f=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x444267(0xe0)]),this.#binaryPath=await _0x45af4f['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents[_0x444267(0xe0)]);}return this.#binaryPath;}async #sleep(_0x5677ca){return new Promise(_0x1ebff3=>setTimeout(_0x1ebff3,_0x5677ca));}async['healthcheck'](){const _0x105d75=a99_0xb705d0,_0x34381a={};_0x34381a[_0x105d75(0xf5)]=_0x105d75(0xf3),_0x34381a['DyNIO']=_0x105d75(0x104);const _0x59a9ac=_0x34381a;try{const _0x5a1df7=await helper[_0x105d75(0xe9)](_0x59a9ac[_0x105d75(0xf5)],_0x59a9ac['DyNIO'],null,null,this.#address);if(_0x5a1df7)return!![];}catch(_0x10a8f5){return![];}}async[a99_0xb705d0(0x120)](){const _0x553651=a99_0xb705d0,_0x488843={'XxCDT':_0x553651(0x121),'WPzVi':_0x553651(0x10e),'qLSdD':function(_0x53503d,_0x15a99d,_0x5b46a5,_0x4833c1){return _0x53503d(_0x15a99d,_0x5b46a5,_0x4833c1);},'pUVZN':_0x553651(0xf2),'lHhgG':'Percy\x20healthcheck\x20successful'},_0x69f3da=await this.#getBinaryPath(),_0x468a17={};_0x468a17[_0x553651(0xed)]='a';const _0x1bbe12=fs[_0x553651(0x11e)](this.#logfile,_0x468a17),_0x25414d=await this[_0x553651(0x116)](),_0x4797c3=await this[_0x553651(0x10d)]();if(!_0x25414d)return![];const _0x310eb5=[(this.#isApp?_0x488843['XxCDT']:_0x488843[_0x553651(0x109)])+_0x553651(0x11a)];_0x4797c3&&_0x310eb5[_0x553651(0x122)]('-c',_0x4797c3);this.#proc=_0x488843['qLSdD'](spawn,_0x69f3da,_0x310eb5,{'env':Object['assign'](process[_0x553651(0x123)],{'PERCY_TOKEN':_0x25414d,'TH_BUILD_UUID':process[_0x553651(0x123)][testHubConstants['ENV_VAR'][_0x553651(0x10c)]]})}),this.#proc['stdout'][_0x553651(0x106)](_0x1bbe12),this.#proc[_0x553651(0xfa)]['pipe'](_0x1bbe12),this[_0x553651(0x11b)]=!![];var _0x6d9753=this;this.#proc['on'](_0x488843['pUVZN'],function(_0xc57fb6){_0x6d9753['isProcessRunning']=![];});do{const _0x28bcc1=await this[_0x553651(0xec)]();if(_0x28bcc1)return logger['debug'](_0x488843[_0x553651(0x119)]),!![];await this.#sleep(0x3e8);}while(this[_0x553651(0x11b)]);return![];}async[a99_0xb705d0(0xe5)](){const _0x52ca56=a99_0xb705d0,_0xb7f498={'CVJzV':function(_0x3533ee,_0x1b1774){return _0x3533ee(_0x1b1774);},'pONFK':function(_0x1984c1,_0x18b56f,_0x3409ce){return _0x1984c1(_0x18b56f,_0x3409ce);},'owiJo':'exec:stop','veXmP':_0x52ca56(0xf2)},_0x330347=await this.#getBinaryPath();return new Promise((_0x53f4f5,_0x51a5be)=>{const _0x38b83b=_0x52ca56,_0x5864ef=_0xb7f498[_0x38b83b(0x11c)](spawn,_0x330347,[_0xb7f498[_0x38b83b(0x10b)]]);_0x5864ef['on'](_0xb7f498[_0x38b83b(0x112)],_0x28cb16=>{const _0x58efcb=_0x38b83b;this[_0x58efcb(0x11b)]=![],_0xb7f498[_0x58efcb(0xe7)](_0x53f4f5,_0x28cb16);});});}['isRunning'](){const _0x2d1927=a99_0xb705d0;return this[_0x2d1927(0x11b)];}async['fetchPercyToken'](){const _0x3e587e=a99_0xb705d0,_0xdddd53={};_0xdddd53[_0x3e587e(0x118)]='app',_0xdddd53[_0x3e587e(0x10a)]=_0x3e587e(0xfd),_0xdddd53[_0x3e587e(0x10f)]=_0x3e587e(0xf3),_0xdddd53[_0x3e587e(0xf8)]='Percy\x20fetch\x20token\x20success';const _0x38869b=_0xdddd53,_0x578c90=this.#config[_0x3e587e(0x101)];try{const _0x3d9a2f=this.#isApp?_0x38869b[_0x3e587e(0x118)]:_0x38869b[_0x3e587e(0x10a)],_0x4470d8=await helper[_0x3e587e(0xe9)](_0x38869b['QMXbF'],_0x3e587e(0xe1)+_0x578c90+_0x3e587e(0xfc)+_0x3d9a2f,{},this.#config),_0x316f2e=_0x4470d8[_0x3e587e(0xea)];return logger[_0x3e587e(0x111)](_0x38869b[_0x3e587e(0xf8)]),_0x316f2e[_0x3e587e(0xf1)];}catch(_0x33420f){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x33420f),null;}}async['createPercyConfig'](){const _0x58ade8=a99_0xb705d0,_0x417e0a={'gHkSu':function(_0x252b31,_0x5ca605){return _0x252b31(_0x5ca605);},'sIZEf':function(_0x525436,_0x4540c4){return _0x525436+_0x4540c4;},'VvRGQ':_0x58ade8(0x100),'vjesZ':'percy.json'};if(!this.#config['percyOptions'])return null;const _0x2073ba=path[_0x58ade8(0xf0)](os[_0x58ade8(0x125)](),_0x417e0a[_0x58ade8(0x124)]),_0x31b555=this.#config[_0x58ade8(0xef)];return!_0x31b555[_0x58ade8(0x115)]&&(_0x31b555[_0x58ade8(0x115)]='2'),new Promise((_0xafab8b,_0x2e6270)=>{const _0x2d1c29=_0x58ade8;fs[_0x2d1c29(0xf9)](_0x2073ba,JSON['stringify'](_0x31b555),_0x2dddb5=>{const _0x163055=_0x2d1c29;_0x2dddb5&&(logger[_0x163055(0xf4)](_0x163055(0xe4)+_0x2dddb5),_0x417e0a['gHkSu'](_0xafab8b,null)),logger[_0x163055(0x111)](_0x417e0a['sIZEf'](_0x417e0a[_0x163055(0xe2)],_0x2073ba)),_0x417e0a[_0x163055(0xe6)](_0xafab8b,_0x2073ba);});});}}module[a99_0xb705d0(0x103)]=Percy;
const a101_0x92d345=a101_0x35c9;(function(_0x1da521,_0x58d961){const _0x16eb94=a101_0x35c9,_0x169386=_0x1da521();while(!![]){try{const _0x53351e=-parseInt(_0x16eb94(0x1cd))/0x1+-parseInt(_0x16eb94(0x1fb))/0x2+parseInt(_0x16eb94(0x1ef))/0x3*(parseInt(_0x16eb94(0x1f7))/0x4)+parseInt(_0x16eb94(0x1e8))/0x5*(-parseInt(_0x16eb94(0x1c3))/0x6)+parseInt(_0x16eb94(0x1c6))/0x7*(parseInt(_0x16eb94(0x1f1))/0x8)+-parseInt(_0x16eb94(0x1dc))/0x9+parseInt(_0x16eb94(0x1e7))/0xa*(parseInt(_0x16eb94(0x1bf))/0xb);if(_0x53351e===_0x58d961)break;else _0x169386['push'](_0x169386['shift']());}catch(_0x1083ed){_0x169386['push'](_0x169386['shift']());}}}(a101_0x7ce0,0xcb13d));function a101_0x35c9(_0x26a980,_0x58a694){const _0x7ce0ad=a101_0x7ce0();return a101_0x35c9=function(_0x35c979,_0x20c956){_0x35c979=_0x35c979-0x1bc;let _0x3e0a29=_0x7ce0ad[_0x35c979];return _0x3e0a29;},a101_0x35c9(_0x26a980,_0x58a694);}function a101_0x7ce0(){const _0x3d6a51=['stringify','sleGz','HfJJr','12fgDjli','FWAMV','MCpsT','7NTWuOa','percy/healthcheck','GET','child_process','DOWNLOAD','UaPIW','ENV_VAR','671522FxBvdA','RFRxr','debug','version','api/app_percy/get_project_token?name=','createWriteStream','createPercyConfig','stdout','app:exec','tmpdir','../../helpers/performance/constants','token','exports','pipe','flags','4203027qaZhkO','isRunning','BcWSI','app','../../helpers/performance/performance-tester','GXGIp','stop','OUtkF','PERCY_SERVER_ADDRESS','../../helpers/testhub/constants','eHTrT','170UwZErs','1773575nwaJaB','fetchPercyToken','exec:stop','BROWSERSTACK_TESTHUB_UUID','ToXYu','assign','Percy\x20healthcheck\x20successful','569091DFNayN','yzMtj','12941192BgwrhA','push','close','JitbC','ViDdB','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','24nxGfeO','stderr','lfaLM','percy.log','391196ydqGwx','path','join','start','rGXGP','hiLDj','nodeRequest','isProcessRunning','writeFile','env','./PercyBinary','error',':start','arDiI','projectName','percy.json','JxCyx','77341sCcLUs'];a101_0x7ce0=function(){return _0x3d6a51;};return a101_0x7ce0();}const fs=require('fs'),path=require(a101_0x92d345(0x1fc)),os=require('os'),{spawn}=require(a101_0x92d345(0x1c9)),helper=require('../helper'),logger=require('../logger')['winstonLogger'],{getLogDir}=require('../logger'),testHubConstants=require(a101_0x92d345(0x1e5)),PerformanceTester=require(a101_0x92d345(0x1e0)),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x92d345(0x1d7)),PercyBinary=require(a101_0x92d345(0x205));class Percy{#logfile=path[a101_0x92d345(0x1fd)](getLogDir(),a101_0x92d345(0x1fa));#address=process['env'][a101_0x92d345(0x1e4)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a101_0x92d345(0x202)]=![];constructor(_0x1c5fa2){const _0x206689=a101_0x92d345;this.#config=_0x1c5fa2,!!_0x1c5fa2[_0x206689(0x1df)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x4fcab9=a101_0x92d345;if(!this.#binaryPath){const _0x35ad6c=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x4fcab9(0x1ca)]),this.#binaryPath=await _0x35ad6c['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents[_0x4fcab9(0x1ca)]);}return this.#binaryPath;}async #sleep(_0x2400f7){return new Promise(_0x4a499e=>setTimeout(_0x4a499e,_0x2400f7));}async['healthcheck'](){const _0x335a4d=a101_0x92d345,_0x2f012c={};_0x2f012c[_0x335a4d(0x208)]=_0x335a4d(0x1c8),_0x2f012c[_0x335a4d(0x1f0)]=_0x335a4d(0x1c7);const _0x31b351=_0x2f012c;try{const _0x22bcff=await helper[_0x335a4d(0x201)](_0x31b351[_0x335a4d(0x208)],_0x31b351[_0x335a4d(0x1f0)],null,null,this.#address);if(_0x22bcff)return!![];}catch(_0x3e5bd0){return![];}}async[a101_0x92d345(0x1fe)](){const _0x285405=a101_0x92d345,_0x55c350={'WEojb':_0x285405(0x1d5),'FWAMV':'exec','MCpsT':function(_0x2fdf10,_0x14d064,_0x238180,_0x5662c4){return _0x2fdf10(_0x14d064,_0x238180,_0x5662c4);},'sleGz':'close','WBiwe':_0x285405(0x1ee)},_0x37209b=await this.#getBinaryPath(),_0x5c8fe7={};_0x5c8fe7[_0x285405(0x1db)]='a';const _0x238333=fs[_0x285405(0x1d2)](this.#logfile,_0x5c8fe7),_0x18f46f=await this[_0x285405(0x1e9)](),_0x24f6c7=await this[_0x285405(0x1d3)]();if(!_0x18f46f)return![];const _0x3b6b59=[(this.#isApp?_0x55c350['WEojb']:_0x55c350[_0x285405(0x1c4)])+_0x285405(0x207)];_0x24f6c7&&_0x3b6b59[_0x285405(0x1f2)]('-c',_0x24f6c7);this.#proc=_0x55c350[_0x285405(0x1c5)](spawn,_0x37209b,_0x3b6b59,{'env':Object[_0x285405(0x1ed)](process[_0x285405(0x204)],{'PERCY_TOKEN':_0x18f46f,'TH_BUILD_UUID':process[_0x285405(0x204)][testHubConstants[_0x285405(0x1cc)][_0x285405(0x1eb)]]})}),this.#proc[_0x285405(0x1d4)][_0x285405(0x1da)](_0x238333),this.#proc[_0x285405(0x1f8)]['pipe'](_0x238333),this[_0x285405(0x202)]=!![];var _0x2bbc18=this;this.#proc['on'](_0x55c350[_0x285405(0x1c1)],function(_0x467c69){const _0x519847=_0x285405;_0x2bbc18[_0x519847(0x202)]=![];});do{const _0x25df89=await this['healthcheck']();if(_0x25df89)return logger[_0x285405(0x1cf)](_0x55c350['WBiwe']),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a101_0x92d345(0x1e2)](){const _0x19a3f9=a101_0x92d345,_0x5a9cad={'GXGIp':function(_0x49b78f,_0x40793f){return _0x49b78f(_0x40793f);},'hiLDj':function(_0x188eb6,_0x1d76f9,_0x2383d2){return _0x188eb6(_0x1d76f9,_0x2383d2);},'OUtkF':_0x19a3f9(0x1ea),'rGXGP':_0x19a3f9(0x1f3)},_0xb63139=await this.#getBinaryPath();return new Promise((_0x1deddf,_0x555fd5)=>{const _0x36d5f6=_0x19a3f9,_0x563440=_0x5a9cad[_0x36d5f6(0x200)](spawn,_0xb63139,[_0x5a9cad[_0x36d5f6(0x1e3)]]);_0x563440['on'](_0x5a9cad[_0x36d5f6(0x1ff)],_0x318d8b=>{const _0x5e1463=_0x36d5f6;this[_0x5e1463(0x202)]=![],_0x5a9cad[_0x5e1463(0x1e1)](_0x1deddf,_0x318d8b);});});}[a101_0x92d345(0x1dd)](){const _0x4cb7ee=a101_0x92d345;return this[_0x4cb7ee(0x202)];}async['fetchPercyToken'](){const _0x20a909=a101_0x92d345,_0x16ce88={};_0x16ce88['HfJJr']=_0x20a909(0x1df),_0x16ce88[_0x20a909(0x1ce)]='automate',_0x16ce88['lfaLM']=_0x20a909(0x1c8),_0x16ce88[_0x20a909(0x1e6)]='Percy\x20fetch\x20token\x20success';const _0x5cda00=_0x16ce88,_0x1d9a55=this.#config[_0x20a909(0x1bc)];try{const _0x398c50=this.#isApp?_0x5cda00[_0x20a909(0x1c2)]:_0x5cda00[_0x20a909(0x1ce)],_0x4fbbb3=await helper[_0x20a909(0x201)](_0x5cda00[_0x20a909(0x1f9)],_0x20a909(0x1d1)+_0x1d9a55+'&type='+_0x398c50,{},this.#config),_0x2c0202=_0x4fbbb3['data'];return logger[_0x20a909(0x1cf)](_0x5cda00[_0x20a909(0x1e6)]),_0x2c0202[_0x20a909(0x1d8)];}catch(_0x358121){return logger[_0x20a909(0x206)](_0x20a909(0x1f6)+_0x358121),null;}}async[a101_0x92d345(0x1d3)](){const _0x3d5197=a101_0x92d345,_0x3e24d4={'wBTgi':function(_0x15cce5,_0x4d8745){return _0x15cce5(_0x4d8745);},'JitbC':function(_0x363ba1,_0x57924d){return _0x363ba1+_0x57924d;},'ToXYu':'Percy\x20config\x20created\x20at\x20','ViDdB':_0x3d5197(0x1bd)};if(!this.#config['percyOptions'])return null;const _0x47652d=path[_0x3d5197(0x1fd)](os[_0x3d5197(0x1d6)](),_0x3e24d4[_0x3d5197(0x1f5)]),_0x51c307=this.#config['percyOptions'];return!_0x51c307[_0x3d5197(0x1d0)]&&(_0x51c307[_0x3d5197(0x1d0)]='2'),new Promise((_0x1a2fa5,_0xe5e4e2)=>{const _0x49a591=_0x3d5197,_0x6f2961={'JxCyx':function(_0x21273d,_0x5652f9){return _0x3e24d4['wBTgi'](_0x21273d,_0x5652f9);},'UaPIW':function(_0x4fbe13,_0x1cf706){const _0x5939f7=a101_0x35c9;return _0x3e24d4[_0x5939f7(0x1f4)](_0x4fbe13,_0x1cf706);},'BcWSI':_0x3e24d4[_0x49a591(0x1ec)]};fs[_0x49a591(0x203)](_0x47652d,JSON[_0x49a591(0x1c0)](_0x51c307),_0x5d8837=>{const _0x124ac0=_0x49a591;_0x5d8837&&(logger[_0x124ac0(0x206)]('Error\x20creating\x20percy\x20config:\x20'+_0x5d8837),_0x6f2961['JxCyx'](_0x1a2fa5,null)),logger['debug'](_0x6f2961[_0x124ac0(0x1cb)](_0x6f2961[_0x124ac0(0x1de)],_0x47652d)),_0x6f2961[_0x124ac0(0x1be)](_0x1a2fa5,_0x47652d);});});}}module[a101_0x92d345(0x1d9)]=Percy;
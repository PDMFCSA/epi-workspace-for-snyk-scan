const a72_0x5778dd=a72_0x254a;function a72_0x5917(){const _0x50e011=['5950Dvpudx','./PercyBinary','stop','nodeRequest','../../helpers/testhub/constants','percy.json','app','6952NWxTuX','50SKeZYT','env','knWNV','healthcheck','percy/healthcheck','3519108HYjOKm','app:exec','PERCY_SERVER_ADDRESS','exec:stop','../../helpers/performance/performance-tester','close','version','nAcJg','http://localhost:5338','Rejfr','iNoVm','assign','path','isProcessRunning','UnsRf','tmpdir','IfGvR','GET','OKyqQ','ehFxQ','1383zwPyOx','push','flags','../helper','exec','start','DOWNLOAD','projectName','btxpc','2150155QCdzae','stringify','rnAFY','ocLSV','GxySr','../../helpers/performance/constants','getBinaryPath','BROWSERSTACK_TESTHUB_UUID','Percy\x20fetch\x20token\x20success','../logger','token','join','zkkIm','344633Iafhqr','automate','api/app_percy/get_project_token?name=','DetYm','fetchPercyToken','writeFile','pipe','createPercyConfig','16316498TvBmYB','2uzAREg','ZkBVN','createWriteStream','QATFw','RPuCn','isRunning','error','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','debug','percy.log','Percy\x20config\x20created\x20at\x20','284DHCzvS','stderr','percyOptions','181251BNDVlM','udikz'];a72_0x5917=function(){return _0x50e011;};return a72_0x5917();}(function(_0x205ccd,_0x1a5379){const _0x2badea=a72_0x254a,_0x2cd35f=_0x205ccd();while(!![]){try{const _0x2ad504=-parseInt(_0x2badea(0xd4))/0x1*(parseInt(_0x2badea(0xdd))/0x2)+-parseInt(_0x2badea(0x10e))/0x3*(-parseInt(_0x2badea(0xe8))/0x4)+-parseInt(_0x2badea(0x117))/0x5+parseInt(_0x2badea(0xfa))/0x6+parseInt(_0x2badea(0xed))/0x7*(-parseInt(_0x2badea(0xf4))/0x8)+parseInt(_0x2badea(0xeb))/0x9*(-parseInt(_0x2badea(0xf5))/0xa)+parseInt(_0x2badea(0xdc))/0xb;if(_0x2ad504===_0x1a5379)break;else _0x2cd35f['push'](_0x2cd35f['shift']());}catch(_0x1a5537){_0x2cd35f['push'](_0x2cd35f['shift']());}}}(a72_0x5917,0x7746e));const fs=require('fs'),path=require(a72_0x5778dd(0x106)),os=require('os'),{spawn}=require('child_process'),helper=require(a72_0x5778dd(0x111)),logger=require(a72_0x5778dd(0x120))['winstonLogger'],{logDir}=require('../logger'),testHubConstants=require(a72_0x5778dd(0xf1)),PerformanceTester=require(a72_0x5778dd(0xfe)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x5778dd(0x11c)),PercyBinary=require(a72_0x5778dd(0xee));function a72_0x254a(_0x1892ff,_0x2f9b4d){const _0x591794=a72_0x5917();return a72_0x254a=function(_0x254ad7,_0x4111bf){_0x254ad7=_0x254ad7-0xd4;let _0x4428e3=_0x591794[_0x254ad7];return _0x4428e3;},a72_0x254a(_0x1892ff,_0x2f9b4d);}class Percy{#logfile=path[a72_0x5778dd(0x122)](logDir,a72_0x5778dd(0xe6));#address=process[a72_0x5778dd(0xf6)][a72_0x5778dd(0xfc)]||a72_0x5778dd(0x102);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x5778dd(0x107)]=![];constructor(_0x54fa8a){const _0xe86be7=a72_0x5778dd;this.#config=_0x54fa8a,!!_0x54fa8a[_0xe86be7(0xf3)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x40e038=a72_0x5778dd;if(!this.#binaryPath){const _0x5c6f25=new PercyBinary();PerformanceTester[_0x40e038(0x113)](PerformanceEvents[_0x40e038(0x114)]),this.#binaryPath=await _0x5c6f25[_0x40e038(0x11d)](this.#config),PerformanceTester['end'](PerformanceEvents[_0x40e038(0x114)]);}return this.#binaryPath;}async #sleep(_0x35cf8d){return new Promise(_0x3d5eef=>setTimeout(_0x3d5eef,_0x35cf8d));}async[a72_0x5778dd(0xf8)](){const _0x503f48=a72_0x5778dd,_0x5b2e33={};_0x5b2e33[_0x503f48(0xe0)]=_0x503f48(0x10b),_0x5b2e33[_0x503f48(0xd7)]=_0x503f48(0xf9);const _0x173f12=_0x5b2e33;try{const _0x4053c0=await helper[_0x503f48(0xf0)](_0x173f12[_0x503f48(0xe0)],_0x173f12['DetYm'],null,null,this.#address);if(_0x4053c0)return!![];}catch(_0x42f0a9){return![];}}async[a72_0x5778dd(0x113)](){const _0x24ecfc=a72_0x5778dd,_0x207e60={'HvqGw':_0x24ecfc(0xfb),'nAcJg':_0x24ecfc(0x112),'knWNV':function(_0x57a91c,_0x143470,_0x3baae7,_0x5e60a9){return _0x57a91c(_0x143470,_0x3baae7,_0x5e60a9);},'btxpc':_0x24ecfc(0xff),'zkkIm':'Percy\x20healthcheck\x20successful'},_0x15e5d0=await this.#getBinaryPath(),_0x71cf19={};_0x71cf19[_0x24ecfc(0x110)]='a';const _0x52575d=fs[_0x24ecfc(0xdf)](this.#logfile,_0x71cf19),_0x223881=await this[_0x24ecfc(0xd8)](),_0x24d87e=await this[_0x24ecfc(0xdb)]();if(!_0x223881)return![];const _0xecaa0=[(this.#isApp?_0x207e60['HvqGw']:_0x207e60[_0x24ecfc(0x101)])+':start'];_0x24d87e&&_0xecaa0[_0x24ecfc(0x10f)]('-c',_0x24d87e);this.#proc=_0x207e60[_0x24ecfc(0xf7)](spawn,_0x15e5d0,_0xecaa0,{'env':Object[_0x24ecfc(0x105)](process[_0x24ecfc(0xf6)],{'PERCY_TOKEN':_0x223881,'TH_BUILD_UUID':process[_0x24ecfc(0xf6)][testHubConstants['ENV_VAR'][_0x24ecfc(0x11e)]]})}),this.#proc['stdout'][_0x24ecfc(0xda)](_0x52575d),this.#proc[_0x24ecfc(0xe9)][_0x24ecfc(0xda)](_0x52575d),this[_0x24ecfc(0x107)]=!![];var _0x23a630=this;this.#proc['on'](_0x207e60[_0x24ecfc(0x116)],function(_0x35a75c){const _0xccdd24=_0x24ecfc;_0x23a630[_0xccdd24(0x107)]=![];});do{const _0x35ac9a=await this['healthcheck']();if(_0x35ac9a)return logger[_0x24ecfc(0xe5)](_0x207e60[_0x24ecfc(0x123)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x5778dd(0xef)](){const _0x43c8c7=a72_0x5778dd,_0x3ef8af={'RPuCn':function(_0x55d135,_0x57376b){return _0x55d135(_0x57376b);},'TxQpH':function(_0x467e58,_0x347722,_0x47199d){return _0x467e58(_0x347722,_0x47199d);},'UnsRf':_0x43c8c7(0xfd),'rnAFY':'close'},_0x440f3d=await this.#getBinaryPath();return new Promise((_0x525ee7,_0x4e9568)=>{const _0x422256=_0x43c8c7,_0x3875a1=_0x3ef8af['TxQpH'](spawn,_0x440f3d,[_0x3ef8af[_0x422256(0x108)]]);_0x3875a1['on'](_0x3ef8af[_0x422256(0x119)],_0x375ee1=>{const _0x37b704=_0x422256;this[_0x37b704(0x107)]=![],_0x3ef8af[_0x37b704(0xe1)](_0x525ee7,_0x375ee1);});});}[a72_0x5778dd(0xe2)](){const _0x104dad=a72_0x5778dd;return this[_0x104dad(0x107)];}async[a72_0x5778dd(0xd8)](){const _0x235c98=a72_0x5778dd,_0x2209cb={};_0x2209cb['ZkBVN']=_0x235c98(0xf3),_0x2209cb['OKyqQ']=_0x235c98(0xd5),_0x2209cb['xCnTv']=_0x235c98(0x10b),_0x2209cb[_0x235c98(0x104)]=_0x235c98(0x11f);const _0x46fec3=_0x2209cb,_0x4dd3a3=this.#config[_0x235c98(0x115)];try{const _0x8c8104=this.#isApp?_0x46fec3[_0x235c98(0xde)]:_0x46fec3[_0x235c98(0x10c)],_0x139210=await helper['nodeRequest'](_0x46fec3['xCnTv'],_0x235c98(0xd6)+_0x4dd3a3+'&type='+_0x8c8104,{},this.#config),_0x270b98=_0x139210['data'];return logger[_0x235c98(0xe5)](_0x46fec3[_0x235c98(0x104)]),_0x270b98[_0x235c98(0x121)];}catch(_0xcfbd03){return logger[_0x235c98(0xe3)](_0x235c98(0xe4)+_0xcfbd03),null;}}async[a72_0x5778dd(0xdb)](){const _0x34b8d3=a72_0x5778dd,_0x2f8091={'GxySr':function(_0x4bcc54,_0x3c98ed){return _0x4bcc54(_0x3c98ed);},'kYtJk':function(_0xfbb0c9,_0x2eb756){return _0xfbb0c9+_0x2eb756;},'RaDzy':_0x34b8d3(0xe7),'udikz':_0x34b8d3(0xf2)};if(!this.#config[_0x34b8d3(0xea)])return null;const _0x286e85=path[_0x34b8d3(0x122)](os[_0x34b8d3(0x109)](),_0x2f8091[_0x34b8d3(0xec)]),_0xa32a9d=this.#config[_0x34b8d3(0xea)];return!_0xa32a9d[_0x34b8d3(0x100)]&&(_0xa32a9d['version']='2'),new Promise((_0x51e393,_0x171350)=>{const _0x35c1fc=_0x34b8d3,_0x20ce85={'ehFxQ':function(_0x5c6737,_0x31db5e){const _0x48a9e6=a72_0x254a;return _0x2f8091[_0x48a9e6(0x11b)](_0x5c6737,_0x31db5e);},'IfGvR':function(_0x43a181,_0x51ef01){return _0x2f8091['kYtJk'](_0x43a181,_0x51ef01);},'Rejfr':_0x2f8091['RaDzy'],'ocLSV':function(_0x51ae7d,_0x4bce02){const _0x44ebea=a72_0x254a;return _0x2f8091[_0x44ebea(0x11b)](_0x51ae7d,_0x4bce02);}};fs[_0x35c1fc(0xd9)](_0x286e85,JSON[_0x35c1fc(0x118)](_0xa32a9d),_0x1eeb10=>{const _0x2865ac=_0x35c1fc;_0x1eeb10&&(logger[_0x2865ac(0xe3)]('Error\x20creating\x20percy\x20config:\x20'+_0x1eeb10),_0x20ce85[_0x2865ac(0x10d)](_0x51e393,null)),logger[_0x2865ac(0xe5)](_0x20ce85[_0x2865ac(0x10a)](_0x20ce85[_0x2865ac(0x103)],_0x286e85)),_0x20ce85[_0x2865ac(0x11a)](_0x51e393,_0x286e85);});});}}module['exports']=Percy;
function a101_0x38cc(){const _0xd9f1f=['percy/healthcheck','percy.log','CQRMR','Percy\x20config\x20created\x20at\x20','56BYnfhI','Percy\x20healthcheck\x20successful','1026474KwMJlR','Percy\x20fetch\x20token\x20success','AMXbi','byiVh','debug','IvAWe','app','DOWNLOAD','writeFile','stderr','app:exec','dHPyH','jkKfH','version','error','1908650ZNilSf','end','assign','235047PiJWAX','stop','BROWSERSTACK_TESTHUB_UUID','percyOptions','PERCY_SERVER_ADDRESS','Zfqwv','eZwvv','percy.json','tmpdir','srdjN','rRPdT','join','../helper','isRunning','QghdJ','cTsTX','../logger','getBinaryPath','exec','8813970scTVKH','./PercyBinary','healthcheck','data','isProcessRunning','createWriteStream',':start','../../helpers/performance/constants','BxWxh','Error\x20creating\x20percy\x20config:\x20','Sdqpt','19896rEDLfp','TSCKO','mBHgP','push','653362BBnAoX','pipe','stringify','uTwAT','exec:stop','RFBVv','createPercyConfig','api/app_percy/get_project_token?name=','projectName','start','../../helpers/testhub/constants','NQOWi','GET','6072230ZxRxgy','3017yhqHfi','close','fetchPercyToken'];a101_0x38cc=function(){return _0xd9f1f;};return a101_0x38cc();}const a101_0x55a0e5=a101_0x7e9b;(function(_0x21b62f,_0x584fb9){const _0x4474a3=a101_0x7e9b,_0x52518=_0x21b62f();while(!![]){try{const _0x5e361e=-parseInt(_0x4474a3(0x212))/0x1+-parseInt(_0x4474a3(0x1ed))/0x2+parseInt(_0x4474a3(0x1f0))/0x3*(parseInt(_0x4474a3(0x1dc))/0x4)+parseInt(_0x4474a3(0x21f))/0x5+-parseInt(_0x4474a3(0x1de))/0x6+parseInt(_0x4474a3(0x220))/0x7*(parseInt(_0x4474a3(0x20e))/0x8)+-parseInt(_0x4474a3(0x203))/0x9;if(_0x5e361e===_0x584fb9)break;else _0x52518['push'](_0x52518['shift']());}catch(_0x468f3e){_0x52518['push'](_0x52518['shift']());}}}(a101_0x38cc,0x989ed));function a101_0x7e9b(_0x9c7944,_0x1758d8){const _0x38cc77=a101_0x38cc();return a101_0x7e9b=function(_0x7e9b2e,_0x2979f9){_0x7e9b2e=_0x7e9b2e-0x1dc;let _0x291db9=_0x38cc77[_0x7e9b2e];return _0x291db9;},a101_0x7e9b(_0x9c7944,_0x1758d8);}const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require('child_process'),helper=require(a101_0x55a0e5(0x1fc)),logger=require(a101_0x55a0e5(0x200))['winstonLogger'],{getLogDir}=require(a101_0x55a0e5(0x200)),testHubConstants=require(a101_0x55a0e5(0x21c)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x55a0e5(0x20a)),PercyBinary=require(a101_0x55a0e5(0x204));class Percy{#logfile=path[a101_0x55a0e5(0x1fb)](getLogDir(),a101_0x55a0e5(0x224));#address=process['env'][a101_0x55a0e5(0x1f4)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a101_0x55a0e5(0x207)]=![];constructor(_0x656b31){const _0x49d02a=a101_0x55a0e5;this.#config=_0x656b31,!!_0x656b31[_0x49d02a(0x1e4)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x53fac0=a101_0x55a0e5;if(!this.#binaryPath){const _0x353742=new PercyBinary();PerformanceTester[_0x53fac0(0x21b)](PerformanceEvents[_0x53fac0(0x1e5)]),this.#binaryPath=await _0x353742[_0x53fac0(0x201)](this.#config),PerformanceTester[_0x53fac0(0x1ee)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x52aa8c){return new Promise(_0x4bc44f=>setTimeout(_0x4bc44f,_0x52aa8c));}async['healthcheck'](){const _0x11ae5a=a101_0x55a0e5,_0x2667d3={};_0x2667d3[_0x11ae5a(0x217)]=_0x11ae5a(0x21e),_0x2667d3[_0x11ae5a(0x1e0)]=_0x11ae5a(0x223);const _0x4512f7=_0x2667d3;try{const _0xb20fa4=await helper['nodeRequest'](_0x4512f7[_0x11ae5a(0x217)],_0x4512f7[_0x11ae5a(0x1e0)],null,null,this.#address);if(_0xb20fa4)return!![];}catch(_0x32fc3a){return![];}}async[a101_0x55a0e5(0x21b)](){const _0x363340=a101_0x55a0e5,_0x41c7fd={'SAhev':_0x363340(0x1e8),'uTwAT':_0x363340(0x202),'mBHgP':function(_0x24b359,_0x4c8c5f,_0x11f24f,_0x14c593){return _0x24b359(_0x4c8c5f,_0x11f24f,_0x14c593);},'Sdqpt':'close','srdjN':_0x363340(0x1dd)},_0x4df648=await this.#getBinaryPath(),_0x42f399={};_0x42f399['flags']='a';const _0x3a5426=fs[_0x363340(0x208)](this.#logfile,_0x42f399),_0xd8cfbe=await this['fetchPercyToken'](),_0x39e373=await this['createPercyConfig']();if(!_0xd8cfbe)return![];const _0x430242=[(this.#isApp?_0x41c7fd['SAhev']:_0x41c7fd[_0x363340(0x215)])+_0x363340(0x209)];_0x39e373&&_0x430242[_0x363340(0x211)]('-c',_0x39e373);this.#proc=_0x41c7fd[_0x363340(0x210)](spawn,_0x4df648,_0x430242,{'env':Object[_0x363340(0x1ef)](process['env'],{'PERCY_TOKEN':_0xd8cfbe,'TH_BUILD_UUID':process['env'][testHubConstants['ENV_VAR'][_0x363340(0x1f2)]]})}),this.#proc['stdout'][_0x363340(0x213)](_0x3a5426),this.#proc[_0x363340(0x1e7)][_0x363340(0x213)](_0x3a5426),this[_0x363340(0x207)]=!![];var _0xfe3e76=this;this.#proc['on'](_0x41c7fd[_0x363340(0x20d)],function(_0x569418){const _0x704417=_0x363340;_0xfe3e76[_0x704417(0x207)]=![];});do{const _0x1511e5=await this[_0x363340(0x205)]();if(_0x1511e5)return logger[_0x363340(0x1e2)](_0x41c7fd[_0x363340(0x1f9)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a101_0x55a0e5(0x1f1)](){const _0x42d0b3=a101_0x55a0e5,_0x523419={'CQRMR':function(_0x1f08b9,_0x3ab663){return _0x1f08b9(_0x3ab663);},'Zfqwv':function(_0x363e7a,_0x7ea7dd,_0x2699c7){return _0x363e7a(_0x7ea7dd,_0x2699c7);},'jkKfH':_0x42d0b3(0x216),'ZmunS':_0x42d0b3(0x221)},_0x47020d=await this.#getBinaryPath();return new Promise((_0x1f08dd,_0x4f3a4a)=>{const _0x3bb963=_0x42d0b3,_0x4204d7={'TSCKO':function(_0x24364d,_0x1ea009){const _0x5265c7=a101_0x7e9b;return _0x523419[_0x5265c7(0x225)](_0x24364d,_0x1ea009);}},_0x21c3de=_0x523419[_0x3bb963(0x1f5)](spawn,_0x47020d,[_0x523419[_0x3bb963(0x1ea)]]);_0x21c3de['on'](_0x523419['ZmunS'],_0x151e72=>{const _0x53d387=_0x3bb963;this['isProcessRunning']=![],_0x4204d7[_0x53d387(0x20f)](_0x1f08dd,_0x151e72);});});}[a101_0x55a0e5(0x1fd)](){const _0x5d4669=a101_0x55a0e5;return this[_0x5d4669(0x207)];}async[a101_0x55a0e5(0x222)](){const _0x13f281=a101_0x55a0e5,_0x518705={};_0x518705[_0x13f281(0x1e3)]='app',_0x518705[_0x13f281(0x1f6)]='automate',_0x518705[_0x13f281(0x1fa)]='GET',_0x518705[_0x13f281(0x1e1)]=_0x13f281(0x1df);const _0x43c0df=_0x518705,_0x491b6e=this.#config[_0x13f281(0x21a)];try{const _0x467aef=this.#isApp?_0x43c0df[_0x13f281(0x1e3)]:_0x43c0df[_0x13f281(0x1f6)],_0x5cbef1=await helper['nodeRequest'](_0x43c0df['rRPdT'],_0x13f281(0x219)+_0x491b6e+'&type='+_0x467aef,{},this.#config),_0x15063c=_0x5cbef1[_0x13f281(0x206)];return logger[_0x13f281(0x1e2)](_0x43c0df[_0x13f281(0x1e1)]),_0x15063c['token'];}catch(_0x59b1ba){return logger[_0x13f281(0x1ec)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x59b1ba),null;}}async[a101_0x55a0e5(0x218)](){const _0x35df47=a101_0x55a0e5,_0xa777e={'NQOWi':function(_0x21fa6b,_0x455bfe){return _0x21fa6b(_0x455bfe);},'qqZvr':function(_0x37a23d,_0x4065b4){return _0x37a23d+_0x4065b4;},'yhwNZ':_0x35df47(0x226),'BxWxh':_0x35df47(0x1f7)};if(!this.#config[_0x35df47(0x1f3)])return null;const _0xb782de=path[_0x35df47(0x1fb)](os[_0x35df47(0x1f8)](),_0xa777e[_0x35df47(0x20b)]),_0x4e7f2e=this.#config['percyOptions'];return!_0x4e7f2e[_0x35df47(0x1eb)]&&(_0x4e7f2e[_0x35df47(0x1eb)]='2'),new Promise((_0x1cc99c,_0x2b3a4b)=>{const _0x929c25=_0x35df47,_0x168feb={'cTsTX':function(_0xa21d5c,_0x4dd7ad){const _0x267504=a101_0x7e9b;return _0xa777e[_0x267504(0x21d)](_0xa21d5c,_0x4dd7ad);},'dHPyH':function(_0x4893e9,_0xc0bcb){return _0xa777e['qqZvr'](_0x4893e9,_0xc0bcb);},'QghdJ':_0xa777e['yhwNZ']};fs[_0x929c25(0x1e6)](_0xb782de,JSON[_0x929c25(0x214)](_0x4e7f2e),_0x107178=>{const _0x3a7607=_0x929c25;_0x107178&&(logger[_0x3a7607(0x1ec)](_0x3a7607(0x20c)+_0x107178),_0x168feb[_0x3a7607(0x1ff)](_0x1cc99c,null)),logger['debug'](_0x168feb[_0x3a7607(0x1e9)](_0x168feb[_0x3a7607(0x1fe)],_0xb782de)),_0x168feb[_0x3a7607(0x1ff)](_0x1cc99c,_0xb782de);});});}}module['exports']=Percy;
const a72_0x2193f8=a72_0x1607;function a72_0x1607(_0x197b9b,_0x13fcc6){const _0x29ba35=a72_0x29ba();return a72_0x1607=function(_0x1607b9,_0x2ed8d0){_0x1607b9=_0x1607b9-0xf6;let _0x1e64ae=_0x29ba35[_0x1607b9];return _0x1e64ae;},a72_0x1607(_0x197b9b,_0x13fcc6);}(function(_0x9501c2,_0x18657a){const _0x2e9f78=a72_0x1607,_0x247915=_0x9501c2();while(!![]){try{const _0x58ddf6=-parseInt(_0x2e9f78(0x142))/0x1*(-parseInt(_0x2e9f78(0x124))/0x2)+-parseInt(_0x2e9f78(0x137))/0x3*(-parseInt(_0x2e9f78(0x118))/0x4)+-parseInt(_0x2e9f78(0xfc))/0x5+-parseInt(_0x2e9f78(0x104))/0x6+parseInt(_0x2e9f78(0x122))/0x7+-parseInt(_0x2e9f78(0x12c))/0x8+-parseInt(_0x2e9f78(0x132))/0x9*(-parseInt(_0x2e9f78(0xfd))/0xa);if(_0x58ddf6===_0x18657a)break;else _0x247915['push'](_0x247915['shift']());}catch(_0x448a3e){_0x247915['push'](_0x247915['shift']());}}}(a72_0x29ba,0xabe00));function a72_0x29ba(){const _0x1f1b90=['DOWNLOAD','466QkHueN','stdout','createPercyConfig','ENV_VAR','Ecfgn','token','percy.log','4468905LdANCN','4170pjHIDA','PERCY_SERVER_ADDRESS','Percy\x20fetch\x20token\x20success','healthcheck','env','percy/healthcheck','qffKc','5975064SoWQWl','YIuMD','JQKFe','FuQDN','error','../../helpers/performance/constants','Bcuwd','automate','../../helpers/testhub/constants','zuleN','stderr','push','data','JUOtC','http://localhost:5338','SOWwv','fPBwh','nNJkW','join','isProcessRunning','4FDOPud','../logger','app','../../helpers/performance/performance-tester','debug',':start','exports','percy.json','FWjon','OkXHh','9529317OwnkOE','writeFile','5438SuZDTe','version','vTsay','stop','pipe','XsbGW','exec:stop','close','9621368uCzbpf','Percy\x20config\x20created\x20at\x20','sUmTB','path','start','iCaOM','1926AJMmeg','percyOptions','Mdabm','isRunning','fetchPercyToken','3236019lxGvVe','BROWSERSTACK_TESTHUB_UUID','stringify','SgJCf','app:exec','end','exec','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','ZenbS','getBinaryPath'];a72_0x29ba=function(){return _0x1f1b90;};return a72_0x29ba();}const fs=require('fs'),path=require(a72_0x2193f8(0x12f)),os=require('os'),{spawn}=require('child_process'),helper=require('../helper'),logger=require(a72_0x2193f8(0x119))['winstonLogger'],{logDir}=require('../logger'),testHubConstants=require(a72_0x2193f8(0x10c)),PerformanceTester=require(a72_0x2193f8(0x11b)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x2193f8(0x109)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a72_0x2193f8(0x116)](logDir,a72_0x2193f8(0xfb));#address=process[a72_0x2193f8(0x101)][a72_0x2193f8(0xfe)]||a72_0x2193f8(0x112);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0xeccf09){const _0x592169=a72_0x2193f8;this.#config=_0xeccf09,!!_0xeccf09[_0x592169(0x11a)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x34a593=a72_0x2193f8;if(!this.#binaryPath){const _0x5c4f22=new PercyBinary();PerformanceTester[_0x34a593(0x130)](PerformanceEvents[_0x34a593(0x141)]),this.#binaryPath=await _0x5c4f22[_0x34a593(0x140)](this.#config),PerformanceTester[_0x34a593(0x13c)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x1aa3b3){return new Promise(_0x17a168=>setTimeout(_0x17a168,_0x1aa3b3));}async[a72_0x2193f8(0x100)](){const _0x1e8219=a72_0x2193f8,_0x500e63={};_0x500e63[_0x1e8219(0xf9)]='GET',_0x500e63[_0x1e8219(0x131)]=_0x1e8219(0x102);const _0x4120c9=_0x500e63;try{const _0x5330e2=await helper['nodeRequest'](_0x4120c9[_0x1e8219(0xf9)],_0x4120c9[_0x1e8219(0x131)],null,null,this.#address);if(_0x5330e2)return!![];}catch(_0x1f4642){return![];}}async[a72_0x2193f8(0x130)](){const _0x2c6a0c=a72_0x2193f8,_0x480c93={'gaEWa':_0x2c6a0c(0x13b),'ZenbS':_0x2c6a0c(0x13d),'nNJkW':function(_0x2205a6,_0x3fad70,_0x5a0153,_0x3d5dd6){return _0x2205a6(_0x3fad70,_0x5a0153,_0x3d5dd6);},'OkXHh':'close','SOWwv':'Percy\x20healthcheck\x20successful'},_0x288622=await this.#getBinaryPath(),_0x4e1954={};_0x4e1954['flags']='a';const _0x48ed87=fs['createWriteStream'](this.#logfile,_0x4e1954),_0x3963a9=await this[_0x2c6a0c(0x136)](),_0x7d5316=await this['createPercyConfig']();if(!_0x3963a9)return![];const _0x455444=[(this.#isApp?_0x480c93['gaEWa']:_0x480c93[_0x2c6a0c(0x13f)])+_0x2c6a0c(0x11d)];_0x7d5316&&_0x455444[_0x2c6a0c(0x10f)]('-c',_0x7d5316);this.#proc=_0x480c93[_0x2c6a0c(0x115)](spawn,_0x288622,_0x455444,{'env':Object['assign'](process[_0x2c6a0c(0x101)],{'PERCY_TOKEN':_0x3963a9,'TH_BUILD_UUID':process[_0x2c6a0c(0x101)][testHubConstants[_0x2c6a0c(0xf8)][_0x2c6a0c(0x138)]]})}),this.#proc[_0x2c6a0c(0xf6)][_0x2c6a0c(0x128)](_0x48ed87),this.#proc[_0x2c6a0c(0x10e)][_0x2c6a0c(0x128)](_0x48ed87),this[_0x2c6a0c(0x117)]=!![];var _0x50fd4d=this;this.#proc['on'](_0x480c93[_0x2c6a0c(0x121)],function(_0x5eccd2){_0x50fd4d['isProcessRunning']=![];});do{const _0x2450ae=await this[_0x2c6a0c(0x100)]();if(_0x2450ae)return logger['debug'](_0x480c93[_0x2c6a0c(0x113)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x2193f8(0x127)](){const _0xea380f=a72_0x2193f8,_0x49ac05={'TRSJw':function(_0x4d4d51,_0x31881b){return _0x4d4d51(_0x31881b);},'FWjon':function(_0x415e69,_0x64ff73,_0x440693){return _0x415e69(_0x64ff73,_0x440693);},'JQKFe':_0xea380f(0x12a),'VgsRp':_0xea380f(0x12b)},_0x570632=await this.#getBinaryPath();return new Promise((_0x250cfb,_0x113356)=>{const _0x15b85c=_0xea380f,_0x9d529f={'vTsay':function(_0x37cd1b,_0x31cf63){return _0x49ac05['TRSJw'](_0x37cd1b,_0x31cf63);}},_0x3f6830=_0x49ac05[_0x15b85c(0x120)](spawn,_0x570632,[_0x49ac05[_0x15b85c(0x106)]]);_0x3f6830['on'](_0x49ac05['VgsRp'],_0x213ae5=>{const _0x4ac8b9=_0x15b85c;this[_0x4ac8b9(0x117)]=![],_0x9d529f[_0x4ac8b9(0x126)](_0x250cfb,_0x213ae5);});});}[a72_0x2193f8(0x135)](){return this['isProcessRunning'];}async[a72_0x2193f8(0x136)](){const _0x4e3b29=a72_0x2193f8,_0x535470={};_0x535470[_0x4e3b29(0x12e)]=_0x4e3b29(0x11a),_0x535470['OgbxG']=_0x4e3b29(0x10b),_0x535470[_0x4e3b29(0x105)]='GET',_0x535470['FuQDN']=_0x4e3b29(0xff);const _0x2fc4da=_0x535470,_0x3d89fe=this.#config['projectName'];try{const _0x5e9316=this.#isApp?_0x2fc4da[_0x4e3b29(0x12e)]:_0x2fc4da['OgbxG'],_0x2aeff9=await helper['nodeRequest'](_0x2fc4da['YIuMD'],'api/app_percy/get_project_token?name='+_0x3d89fe+'&type='+_0x5e9316,{},this.#config),_0x1fea8b=_0x2aeff9[_0x4e3b29(0x110)];return logger[_0x4e3b29(0x11c)](_0x2fc4da[_0x4e3b29(0x107)]),_0x1fea8b[_0x4e3b29(0xfa)];}catch(_0x1c797b){return logger[_0x4e3b29(0x108)](_0x4e3b29(0x13e)+_0x1c797b),null;}}async[a72_0x2193f8(0xf7)](){const _0x5285a9=a72_0x2193f8,_0x235215={'Mdabm':function(_0x3d9a15,_0x32061e){return _0x3d9a15(_0x32061e);},'JUOtC':function(_0x4e0869,_0x3b75c0){return _0x4e0869+_0x3b75c0;},'fPBwh':_0x5285a9(0x12d),'qffKc':_0x5285a9(0x11f)};if(!this.#config['percyOptions'])return null;const _0x49c638=path['join'](os['tmpdir'](),_0x235215[_0x5285a9(0x103)]),_0x835eac=this.#config[_0x5285a9(0x133)];return!_0x835eac[_0x5285a9(0x125)]&&(_0x835eac[_0x5285a9(0x125)]='2'),new Promise((_0x534936,_0x237380)=>{const _0x5e1b23=_0x5285a9,_0x2bf65b={'SgJCf':function(_0x1c139d,_0x3b99a5){const _0x1c9d09=a72_0x1607;return _0x235215[_0x1c9d09(0x134)](_0x1c139d,_0x3b99a5);},'zuleN':function(_0x57f7a2,_0x30c81e){const _0x353808=a72_0x1607;return _0x235215[_0x353808(0x111)](_0x57f7a2,_0x30c81e);},'XsbGW':_0x235215[_0x5e1b23(0x114)],'Bcuwd':function(_0x276768,_0x1901dd){return _0x235215['Mdabm'](_0x276768,_0x1901dd);}};fs[_0x5e1b23(0x123)](_0x49c638,JSON[_0x5e1b23(0x139)](_0x835eac),_0x130212=>{const _0x3649b3=_0x5e1b23;_0x130212&&(logger[_0x3649b3(0x108)]('Error\x20creating\x20percy\x20config:\x20'+_0x130212),_0x2bf65b[_0x3649b3(0x13a)](_0x534936,null)),logger[_0x3649b3(0x11c)](_0x2bf65b[_0x3649b3(0x10d)](_0x2bf65b[_0x3649b3(0x129)],_0x49c638)),_0x2bf65b[_0x3649b3(0x10a)](_0x534936,_0x49c638);});});}}module[a72_0x2193f8(0x11e)]=Percy;
function a113_0x2524(){const _0x1f6354=['&type=','zAsKN','error','PKxTu','createPercyConfig','671204yyRbAf','qwzUk','getBinaryPath','Percy\x20config\x20created\x20at\x20','start','ENV_VAR','debug','2308491XfzPMT','XRYmA','../../helpers/testhub/constants','vsgdO','isRunning',':start','exec:stop','percy.json','BROWSERSTACK_TESTHUB_UUID','COmbQ','child_process','end','healthcheck','Error\x20creating\x20percy\x20config:\x20','304217fiqhJP','nodeRequest','join','percy/healthcheck','DVBAL','stop','data','writeFile','8iNmAAq','662389BkXqLg','../logger','push','api/app_percy/get_project_token?name=','exports','close','yZNnJ','stringify','fetchPercyToken','pipe','DazZv','winstonLogger','PERCY_SERVER_ADDRESS','1714685tqHgeQ','stderr','app:exec','../helper','2ioYGYR','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','kTTYH','gvreK','6sZjgdc','percyOptions','env','4622000hcHhZI','MieMu','automate','tmpdir','http://localhost:5338','GET','../../helpers/performance/constants','xdUEh','zHODc','app','isProcessRunning','flags','version','LvjDI','rAvAB','path','DOWNLOAD','976647pGIziI','gjgEL','assign'];a113_0x2524=function(){return _0x1f6354;};return a113_0x2524();}const a113_0x532162=a113_0x10cc;(function(_0x386971,_0x1f5085){const _0x5f234d=a113_0x10cc,_0x1b1b3a=_0x386971();while(!![]){try{const _0x34246a=-parseInt(_0x5f234d(0x76))/0x1*(parseInt(_0x5f234d(0x90))/0x2)+parseInt(_0x5f234d(0xa8))/0x3+parseInt(_0x5f234d(0xb0))/0x4+-parseInt(_0x5f234d(0x8c))/0x5*(-parseInt(_0x5f234d(0x94))/0x6)+-parseInt(_0x5f234d(0x7f))/0x7+-parseInt(_0x5f234d(0x7e))/0x8*(-parseInt(_0x5f234d(0xb7))/0x9)+-parseInt(_0x5f234d(0x97))/0xa;if(_0x34246a===_0x1f5085)break;else _0x1b1b3a['push'](_0x1b1b3a['shift']());}catch(_0x41b365){_0x1b1b3a['push'](_0x1b1b3a['shift']());}}}(a113_0x2524,0x3893e));const fs=require('fs'),path=require(a113_0x532162(0xa6)),os=require('os'),{spawn}=require(a113_0x532162(0x72)),helper=require(a113_0x532162(0x8f)),logger=require(a113_0x532162(0x80))[a113_0x532162(0x8a)],{getLogDir}=require(a113_0x532162(0x80)),testHubConstants=require(a113_0x532162(0xb9)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a113_0x532162(0x9d)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a113_0x532162(0x78)](getLogDir(),'percy.log');#address=process[a113_0x532162(0x96)][a113_0x532162(0x8b)]||a113_0x532162(0x9b);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a113_0x532162(0xa1)]=![];constructor(_0x3642e0){const _0x2b3978=a113_0x532162;this.#config=_0x3642e0,!!_0x3642e0[_0x2b3978(0xa0)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x18d214=a113_0x532162;if(!this.#binaryPath){const _0x1ddae4=new PercyBinary();PerformanceTester[_0x18d214(0xb4)](PerformanceEvents[_0x18d214(0xa7)]),this.#binaryPath=await _0x1ddae4[_0x18d214(0xb2)](this.#config),PerformanceTester[_0x18d214(0x73)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x565d8e){return new Promise(_0x24e655=>setTimeout(_0x24e655,_0x565d8e));}async[a113_0x532162(0x74)](){const _0x2293dd=a113_0x532162,_0x53f7bd={};_0x53f7bd[_0x2293dd(0x71)]=_0x2293dd(0x9c),_0x53f7bd[_0x2293dd(0x93)]=_0x2293dd(0x79);const _0x2d1a58=_0x53f7bd;try{const _0x726ee3=await helper[_0x2293dd(0x77)](_0x2d1a58[_0x2293dd(0x71)],_0x2d1a58[_0x2293dd(0x93)],null,null,this.#address);if(_0x726ee3)return!![];}catch(_0x2d3bce){return![];}}async[a113_0x532162(0xb4)](){const _0x359b50=a113_0x532162,_0x56c079={'qwzUk':_0x359b50(0x8e),'ubMeV':'exec','XUYxD':function(_0x10afbb,_0x4db657,_0x4f1f35,_0x558dc0){return _0x10afbb(_0x4db657,_0x4f1f35,_0x558dc0);},'GBxwM':_0x359b50(0x84),'PKxTu':'Percy\x20healthcheck\x20successful'},_0x28ebc6=await this.#getBinaryPath(),_0x23cf75={};_0x23cf75[_0x359b50(0xa2)]='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x23cf75);const _0xc81696=await this[_0x359b50(0x87)](),_0x3bafd5=await this[_0x359b50(0xaf)]();if(!_0xc81696)return![];const _0x17fd6e=[(this.#isApp?_0x56c079[_0x359b50(0xb1)]:_0x56c079['ubMeV'])+_0x359b50(0x6d)];_0x3bafd5&&_0x17fd6e[_0x359b50(0x81)]('-c',_0x3bafd5);this.#proc=_0x56c079['XUYxD'](spawn,_0x28ebc6,_0x17fd6e,{'env':Object[_0x359b50(0xaa)](process[_0x359b50(0x96)],{'PERCY_TOKEN':_0xc81696,'TH_BUILD_UUID':process[_0x359b50(0x96)][testHubConstants[_0x359b50(0xb5)][_0x359b50(0x70)]]})}),this.#proc['stdout'][_0x359b50(0x88)](this.#logStream),this.#proc[_0x359b50(0x8d)][_0x359b50(0x88)](this.#logStream),this[_0x359b50(0xa1)]=!![];var _0x3f934a=this;this.#proc['on'](_0x56c079['GBxwM'],function(_0x223fa8){const _0x5e4f3b=_0x359b50;_0x3f934a[_0x5e4f3b(0xa1)]=![];});do{const _0x574e93=await this['healthcheck']();if(_0x574e93)return logger[_0x359b50(0xb6)](_0x56c079[_0x359b50(0xae)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a113_0x532162(0x7b)](){const _0x12c2b3=a113_0x532162,_0x211d12={'kTTYH':function(_0x398edf,_0xbb3de5){return _0x398edf(_0xbb3de5);},'XRYmA':function(_0x18bb0f,_0xd63892,_0x2b9013){return _0x18bb0f(_0xd63892,_0x2b9013);},'DVBAL':_0x12c2b3(0x6e),'xdUEh':_0x12c2b3(0x84)},_0x37ba18=await this.#getBinaryPath();return new Promise((_0x2a2d21,_0x8c7318)=>{const _0x49f09c=_0x12c2b3,_0x1e08da=_0x211d12[_0x49f09c(0xb8)](spawn,_0x37ba18,[_0x211d12[_0x49f09c(0x7a)]]);_0x1e08da['on'](_0x211d12[_0x49f09c(0x9e)],_0x542883=>{const _0x28cf49=_0x49f09c;this[_0x28cf49(0xa1)]=![],this.#logStream&&(this.#logStream[_0x28cf49(0x73)](),this.#logStream=null),_0x211d12[_0x28cf49(0x92)](_0x2a2d21,_0x542883);});});}[a113_0x532162(0xbb)](){return this['isProcessRunning'];}async[a113_0x532162(0x87)](){const _0x577dbe=a113_0x532162,_0x33142d={};_0x33142d[_0x577dbe(0xac)]=_0x577dbe(0xa0),_0x33142d[_0x577dbe(0xa5)]=_0x577dbe(0x99),_0x33142d[_0x577dbe(0x89)]=_0x577dbe(0x9c),_0x33142d[_0x577dbe(0xa9)]='Percy\x20fetch\x20token\x20success';const _0x2391bb=_0x33142d,_0x8d2e31=this.#config['projectName'];try{const _0x21b77a=this.#isApp?_0x2391bb['zAsKN']:_0x2391bb['rAvAB'],_0x45e9f1=await helper[_0x577dbe(0x77)](_0x2391bb[_0x577dbe(0x89)],_0x577dbe(0x82)+_0x8d2e31+_0x577dbe(0xab)+_0x21b77a,{},this.#config),_0x253bb9=_0x45e9f1[_0x577dbe(0x7c)];return logger[_0x577dbe(0xb6)](_0x2391bb['gjgEL']),_0x253bb9['token'];}catch(_0x24aa95){return logger[_0x577dbe(0xad)](_0x577dbe(0x91)+_0x24aa95),null;}}async['createPercyConfig'](){const _0x24ac29=a113_0x532162,_0xca03e9={'MieMu':function(_0x24ed54,_0x2698c2){return _0x24ed54(_0x2698c2);},'zHODc':function(_0x1028d8,_0x3d01fe){return _0x1028d8+_0x3d01fe;},'LvjDI':_0x24ac29(0xb3),'vsgdO':function(_0xfcdd66,_0x2eb172){return _0xfcdd66(_0x2eb172);},'yZNnJ':_0x24ac29(0x6f)};if(!this.#config[_0x24ac29(0x95)])return null;const _0xb1f7cb=path['join'](os[_0x24ac29(0x9a)](),_0xca03e9[_0x24ac29(0x85)]),_0x49cc57=this.#config[_0x24ac29(0x95)];return!_0x49cc57['version']&&(_0x49cc57[_0x24ac29(0xa3)]='2'),new Promise((_0x21b093,_0x80e711)=>{const _0x241e81=_0x24ac29;fs[_0x241e81(0x7d)](_0xb1f7cb,JSON[_0x241e81(0x86)](_0x49cc57),_0x5e512b=>{const _0x108b13=_0x241e81;_0x5e512b&&(logger[_0x108b13(0xad)](_0x108b13(0x75)+_0x5e512b),_0xca03e9[_0x108b13(0x98)](_0x21b093,null)),logger[_0x108b13(0xb6)](_0xca03e9[_0x108b13(0x9f)](_0xca03e9[_0x108b13(0xa4)],_0xb1f7cb)),_0xca03e9[_0x108b13(0xba)](_0x21b093,_0xb1f7cb);});});}}function a113_0x10cc(_0xf1875f,_0x567002){const _0x25240c=a113_0x2524();return a113_0x10cc=function(_0x10cc6b,_0x1dbddd){_0x10cc6b=_0x10cc6b-0x6d;let _0x46b244=_0x25240c[_0x10cc6b];return _0x46b244;},a113_0x10cc(_0xf1875f,_0x567002);}module[a113_0x532162(0x83)]=Percy;
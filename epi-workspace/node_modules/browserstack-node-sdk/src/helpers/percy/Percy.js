const a72_0x529151=a72_0x5e8c;(function(_0x2655d6,_0x4efbb6){const _0x4e12fb=a72_0x5e8c,_0x49a2f1=_0x2655d6();while(!![]){try{const _0x5e1940=parseInt(_0x4e12fb(0x136))/0x1*(parseInt(_0x4e12fb(0x13e))/0x2)+-parseInt(_0x4e12fb(0x129))/0x3+parseInt(_0x4e12fb(0x109))/0x4+-parseInt(_0x4e12fb(0x10c))/0x5*(-parseInt(_0x4e12fb(0x111))/0x6)+-parseInt(_0x4e12fb(0x126))/0x7+-parseInt(_0x4e12fb(0x105))/0x8+parseInt(_0x4e12fb(0xff))/0x9*(parseInt(_0x4e12fb(0x137))/0xa);if(_0x5e1940===_0x4efbb6)break;else _0x49a2f1['push'](_0x49a2f1['shift']());}catch(_0x585a90){_0x49a2f1['push'](_0x49a2f1['shift']());}}}(a72_0x2cdd,0x6492a));const fs=require('fs'),path=require(a72_0x529151(0x11b)),os=require('os'),{spawn}=require(a72_0x529151(0x148)),helper=require(a72_0x529151(0xfe)),logger=require(a72_0x529151(0x132))[a72_0x529151(0x10b)],{logDir}=require('../logger'),testHubConstants=require(a72_0x529151(0x101)),PerformanceTester=require(a72_0x529151(0x108)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x529151(0x120)),PercyBinary=require(a72_0x529151(0x141));class Percy{#logfile=path[a72_0x529151(0xfc)](logDir,'percy.log');#address=process[a72_0x529151(0xf8)][a72_0x529151(0x10d)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x529151(0x140)]=![];constructor(_0x596267){const _0x53698a=a72_0x529151;this.#config=_0x596267,!!_0x596267[_0x53698a(0x13f)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x41f4b3=a72_0x529151;if(!this.#binaryPath){const _0x3541c2=new PercyBinary();PerformanceTester[_0x41f4b3(0x106)](PerformanceEvents[_0x41f4b3(0x124)]),this.#binaryPath=await _0x3541c2[_0x41f4b3(0x113)](this.#config),PerformanceTester[_0x41f4b3(0x11f)](PerformanceEvents[_0x41f4b3(0x124)]);}return this.#binaryPath;}async #sleep(_0x141177){return new Promise(_0x4b9676=>setTimeout(_0x4b9676,_0x141177));}async[a72_0x529151(0xfa)](){const _0x5608ac=a72_0x529151,_0x25e3c6={};_0x25e3c6[_0x5608ac(0x11d)]=_0x5608ac(0x11a),_0x25e3c6[_0x5608ac(0x100)]=_0x5608ac(0x104);const _0x14a554=_0x25e3c6;try{const _0x5c8176=await helper[_0x5608ac(0x133)](_0x14a554[_0x5608ac(0x11d)],_0x14a554[_0x5608ac(0x100)],null,null,this.#address);if(_0x5c8176)return!![];}catch(_0x3e78b8){return![];}}async['start'](){const _0x257538=a72_0x529151,_0xca83cf={'whaYV':_0x257538(0x117),'TzxqJ':_0x257538(0x107),'isdgQ':function(_0xd8cebe,_0x18ff8b,_0x4f2f10,_0x545c1f){return _0xd8cebe(_0x18ff8b,_0x4f2f10,_0x545c1f);},'MfDMM':_0x257538(0x146),'TtHIv':'Percy\x20healthcheck\x20successful'},_0x63da37=await this.#getBinaryPath(),_0x50a7e0={};_0x50a7e0[_0x257538(0x144)]='a';const _0x3572bf=fs[_0x257538(0x103)](this.#logfile,_0x50a7e0),_0x4d4951=await this[_0x257538(0x128)](),_0x3354cb=await this[_0x257538(0x13b)]();if(!_0x4d4951)return![];const _0x9b49b5=[(this.#isApp?_0xca83cf[_0x257538(0x110)]:_0xca83cf[_0x257538(0x13d)])+_0x257538(0x119)];_0x3354cb&&_0x9b49b5[_0x257538(0x121)]('-c',_0x3354cb);this.#proc=_0xca83cf['isdgQ'](spawn,_0x63da37,_0x9b49b5,{'env':Object[_0x257538(0x13a)](process[_0x257538(0xf8)],{'PERCY_TOKEN':_0x4d4951,'TH_BUILD_UUID':process[_0x257538(0xf8)][testHubConstants[_0x257538(0x11c)][_0x257538(0x115)]]})}),this.#proc['stdout'][_0x257538(0x13c)](_0x3572bf),this.#proc[_0x257538(0xfb)]['pipe'](_0x3572bf),this[_0x257538(0x140)]=!![];var _0x4c041a=this;this.#proc['on'](_0xca83cf[_0x257538(0x12c)],function(_0x3d66dc){const _0x2b367a=_0x257538;_0x4c041a[_0x2b367a(0x140)]=![];});do{const _0xc13582=await this[_0x257538(0xfa)]();if(_0xc13582)return logger[_0x257538(0x122)](_0xca83cf[_0x257538(0x143)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async['stop'](){const _0x5a1406=a72_0x529151,_0x2530e6={'eUGTY':function(_0x1f8b12,_0x315de2){return _0x1f8b12(_0x315de2);},'Fjscr':function(_0x4d1197,_0x175a27,_0x311e9c){return _0x4d1197(_0x175a27,_0x311e9c);},'PrDPv':_0x5a1406(0x102),'GFNAl':_0x5a1406(0x146)},_0x3133fb=await this.#getBinaryPath();return new Promise((_0x35ede4,_0x1c51d9)=>{const _0x2f0bab=_0x5a1406,_0x10c52e=_0x2530e6[_0x2f0bab(0x116)](spawn,_0x3133fb,[_0x2530e6[_0x2f0bab(0x114)]]);_0x10c52e['on'](_0x2530e6[_0x2f0bab(0x130)],_0xd46a73=>{const _0x3b7ca1=_0x2f0bab;this['isProcessRunning']=![],_0x2530e6[_0x3b7ca1(0x147)](_0x35ede4,_0xd46a73);});});}[a72_0x529151(0x12b)](){const _0xfd65b=a72_0x529151;return this[_0xfd65b(0x140)];}async[a72_0x529151(0x128)](){const _0x226fa9=a72_0x529151,_0x122855={};_0x122855[_0x226fa9(0x135)]=_0x226fa9(0x13f),_0x122855[_0x226fa9(0x134)]='automate',_0x122855[_0x226fa9(0xf9)]=_0x226fa9(0x11a),_0x122855[_0x226fa9(0x131)]=_0x226fa9(0x125);const _0x4e8e2b=_0x122855,_0x2cc241=this.#config[_0x226fa9(0x11e)];try{const _0x18c1d0=this.#isApp?_0x4e8e2b[_0x226fa9(0x135)]:_0x4e8e2b[_0x226fa9(0x134)],_0x56c00e=await helper[_0x226fa9(0x133)](_0x4e8e2b[_0x226fa9(0xf9)],_0x226fa9(0x139)+_0x2cc241+_0x226fa9(0x118)+_0x18c1d0,{},this.#config),_0x4acf04=_0x56c00e[_0x226fa9(0x12e)];return logger[_0x226fa9(0x122)](_0x4e8e2b[_0x226fa9(0x131)]),_0x4acf04[_0x226fa9(0x10a)];}catch(_0x3fa4d1){return logger[_0x226fa9(0x12f)](_0x226fa9(0x10e)+_0x3fa4d1),null;}}async['createPercyConfig'](){const _0x3d71c9=a72_0x529151,_0x4abed2={'npmZo':function(_0x15e135,_0x367927){return _0x15e135(_0x367927);},'TMNiu':function(_0xd1caff,_0x412673){return _0xd1caff+_0x412673;},'OMVUm':'Percy\x20config\x20created\x20at\x20','SXPQD':function(_0x15c4ad,_0xba1458){return _0x15c4ad(_0xba1458);},'IKoPl':_0x3d71c9(0x123)};if(!this.#config[_0x3d71c9(0xfd)])return null;const _0x1e3836=path[_0x3d71c9(0xfc)](os[_0x3d71c9(0x12d)](),_0x4abed2[_0x3d71c9(0x127)]),_0x30364=this.#config[_0x3d71c9(0xfd)];return!_0x30364[_0x3d71c9(0x10f)]&&(_0x30364[_0x3d71c9(0x10f)]='2'),new Promise((_0x29a94f,_0x1ba2ae)=>{const _0x781d39=_0x3d71c9;fs[_0x781d39(0x138)](_0x1e3836,JSON[_0x781d39(0x112)](_0x30364),_0x391bab=>{const _0x290a19=_0x781d39;_0x391bab&&(logger[_0x290a19(0x12f)]('Error\x20creating\x20percy\x20config:\x20'+_0x391bab),_0x4abed2[_0x290a19(0x142)](_0x29a94f,null)),logger[_0x290a19(0x122)](_0x4abed2[_0x290a19(0x145)](_0x4abed2['OMVUm'],_0x1e3836)),_0x4abed2['SXPQD'](_0x29a94f,_0x1e3836);});});}}function a72_0x5e8c(_0x1892a8,_0x219041){const _0x2cddce=a72_0x2cdd();return a72_0x5e8c=function(_0x5e8cf4,_0x45ad58){_0x5e8cf4=_0x5e8cf4-0xf8;let _0x4774cc=_0x2cddce[_0x5e8cf4];return _0x4774cc;},a72_0x5e8c(_0x1892a8,_0x219041);}function a72_0x2cdd(){const _0x36a6bb=['../../helpers/testhub/constants','exec:stop','createWriteStream','percy/healthcheck','104104ZkIQYb','start','exec','../../helpers/performance/performance-tester','2536788jSejXk','token','winstonLogger','115KuzzfJ','PERCY_SERVER_ADDRESS','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','version','whaYV','83778dRcuWZ','stringify','getBinaryPath','PrDPv','BROWSERSTACK_TESTHUB_UUID','Fjscr','app:exec','&type=',':start','GET','path','ENV_VAR','NtkbL','projectName','end','../../helpers/performance/constants','push','debug','percy.json','DOWNLOAD','Percy\x20fetch\x20token\x20success','5348105SHwPAL','IKoPl','fetchPercyToken','1922469ESUFDd','exports','isRunning','MfDMM','tmpdir','data','error','GFNAl','RZCMZ','../logger','nodeRequest','KztzB','VMLfg','1ljFOfb','80LhBSsE','writeFile','api/app_percy/get_project_token?name=','assign','createPercyConfig','pipe','TzxqJ','1006358BhHLSw','app','isProcessRunning','./PercyBinary','npmZo','TtHIv','flags','TMNiu','close','eUGTY','child_process','env','BaIRj','healthcheck','stderr','join','percyOptions','../helper','417681ATbPeI','neOpi'];a72_0x2cdd=function(){return _0x36a6bb;};return a72_0x2cdd();}module[a72_0x529151(0x12a)]=Percy;
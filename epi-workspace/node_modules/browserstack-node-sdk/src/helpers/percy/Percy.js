const a103_0x4de140=a103_0x2836;(function(_0x383fb4,_0x4a2630){const _0x27ee7a=a103_0x2836,_0x558214=_0x383fb4();while(!![]){try{const _0x52c157=parseInt(_0x27ee7a(0x225))/0x1+parseInt(_0x27ee7a(0x21b))/0x2*(parseInt(_0x27ee7a(0x1de))/0x3)+-parseInt(_0x27ee7a(0x204))/0x4*(-parseInt(_0x27ee7a(0x21d))/0x5)+-parseInt(_0x27ee7a(0x1e9))/0x6+-parseInt(_0x27ee7a(0x1eb))/0x7+parseInt(_0x27ee7a(0x1e2))/0x8*(parseInt(_0x27ee7a(0x1df))/0x9)+parseInt(_0x27ee7a(0x202))/0xa*(parseInt(_0x27ee7a(0x221))/0xb);if(_0x52c157===_0x4a2630)break;else _0x558214['push'](_0x558214['shift']());}catch(_0xd541a3){_0x558214['push'](_0x558214['shift']());}}}(a103_0x3e34,0x4c26c));const fs=require('fs'),path=require(a103_0x4de140(0x1ea)),os=require('os'),{spawn}=require(a103_0x4de140(0x212)),helper=require('../helper'),logger=require(a103_0x4de140(0x1ee))[a103_0x4de140(0x1ed)],{getLogDir}=require('../logger'),testHubConstants=require(a103_0x4de140(0x1f1)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a103_0x4de140(0x217)),PercyBinary=require(a103_0x4de140(0x214));class Percy{#logfile=path['join'](getLogDir(),a103_0x4de140(0x209));#address=process[a103_0x4de140(0x1ef)][a103_0x4de140(0x1f8)]||a103_0x4de140(0x21e);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a103_0x4de140(0x22a)]=![];constructor(_0x1705a3){const _0x1c42c0=a103_0x4de140;this.#config=_0x1705a3,!!_0x1705a3[_0x1c42c0(0x1e1)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x464d29=a103_0x4de140;if(!this.#binaryPath){const _0x5e3c63=new PercyBinary();PerformanceTester['start'](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x5e3c63[_0x464d29(0x1f6)](this.#config),PerformanceTester[_0x464d29(0x20f)](PerformanceEvents[_0x464d29(0x1e5)]);}return this.#binaryPath;}async #sleep(_0x4a61eb){return new Promise(_0x1d1886=>setTimeout(_0x1d1886,_0x4a61eb));}async['healthcheck'](){const _0x99a6e5=a103_0x4de140,_0x167f90={};_0x167f90[_0x99a6e5(0x1f0)]=_0x99a6e5(0x219),_0x167f90['fYCPp']=_0x99a6e5(0x1f2);const _0x40b2d9=_0x167f90;try{const _0x1d07c5=await helper['nodeRequest'](_0x40b2d9[_0x99a6e5(0x1f0)],_0x40b2d9[_0x99a6e5(0x21a)],null,null,this.#address);if(_0x1d07c5)return!![];}catch(_0x39dc38){return![];}}async[a103_0x4de140(0x21f)](){const _0x3fe506=a103_0x4de140,_0x157f88={'dfEwz':_0x3fe506(0x1ff),'zWiqM':_0x3fe506(0x226),'NmIpw':function(_0x5e15a0,_0x421c9a,_0x29baa8,_0x2deefc){return _0x5e15a0(_0x421c9a,_0x29baa8,_0x2deefc);},'YJBnm':_0x3fe506(0x208),'xDdJw':_0x3fe506(0x211)},_0x4f1205=await this.#getBinaryPath(),_0x170f01={};_0x170f01[_0x3fe506(0x227)]='a';const _0x5d97f7=fs[_0x3fe506(0x20a)](this.#logfile,_0x170f01),_0x1088da=await this['fetchPercyToken'](),_0x1345d4=await this[_0x3fe506(0x210)]();if(!_0x1088da)return![];const _0x1fc9fc=[(this.#isApp?_0x157f88[_0x3fe506(0x218)]:_0x157f88[_0x3fe506(0x1e3)])+_0x3fe506(0x1f7)];_0x1345d4&&_0x1fc9fc['push']('-c',_0x1345d4);this.#proc=_0x157f88[_0x3fe506(0x20e)](spawn,_0x4f1205,_0x1fc9fc,{'env':Object[_0x3fe506(0x220)](process[_0x3fe506(0x1ef)],{'PERCY_TOKEN':_0x1088da,'TH_BUILD_UUID':process['env'][testHubConstants[_0x3fe506(0x200)][_0x3fe506(0x1e8)]]})}),this.#proc['stdout'][_0x3fe506(0x22b)](_0x5d97f7),this.#proc[_0x3fe506(0x215)][_0x3fe506(0x22b)](_0x5d97f7),this[_0x3fe506(0x22a)]=!![];var _0x1d8f74=this;this.#proc['on'](_0x157f88[_0x3fe506(0x207)],function(_0x42b45f){_0x1d8f74['isProcessRunning']=![];});do{const _0x585ea0=await this['healthcheck']();if(_0x585ea0)return logger[_0x3fe506(0x20c)](_0x157f88[_0x3fe506(0x224)]),!![];await this.#sleep(0x3e8);}while(this[_0x3fe506(0x22a)]);return![];}async[a103_0x4de140(0x222)](){const _0x744446=a103_0x4de140,_0xa2357={'atpkf':function(_0x4c5497,_0x53f6b6){return _0x4c5497(_0x53f6b6);},'bUnPb':function(_0x1a8835,_0x124bb6,_0x50422c){return _0x1a8835(_0x124bb6,_0x50422c);},'qDXKX':_0x744446(0x1f4),'vDlrH':_0x744446(0x208)},_0x223957=await this.#getBinaryPath();return new Promise((_0x330945,_0x51f3a0)=>{const _0x5b45e7=_0x744446,_0x322563=_0xa2357[_0x5b45e7(0x1fc)](spawn,_0x223957,[_0xa2357[_0x5b45e7(0x1fa)]]);_0x322563['on'](_0xa2357[_0x5b45e7(0x1fb)],_0x19e264=>{this['isProcessRunning']=![],_0xa2357['atpkf'](_0x330945,_0x19e264);});});}[a103_0x4de140(0x1f3)](){const _0x15717e=a103_0x4de140;return this[_0x15717e(0x22a)];}async[a103_0x4de140(0x1e6)](){const _0x49d4fe=a103_0x4de140,_0x1f9ff8={};_0x1f9ff8[_0x49d4fe(0x229)]=_0x49d4fe(0x1e1),_0x1f9ff8[_0x49d4fe(0x20d)]=_0x49d4fe(0x206),_0x1f9ff8[_0x49d4fe(0x1dd)]=_0x49d4fe(0x219),_0x1f9ff8[_0x49d4fe(0x1f9)]=_0x49d4fe(0x203);const _0x54cca6=_0x1f9ff8,_0x548b09=this.#config[_0x49d4fe(0x1ec)];try{const _0x4a89a7=this.#isApp?_0x54cca6['eYpot']:_0x54cca6['biJac'],_0x4bc689=await helper['nodeRequest'](_0x54cca6[_0x49d4fe(0x1dd)],_0x49d4fe(0x1e7)+_0x548b09+_0x49d4fe(0x1e0)+_0x4a89a7,{},this.#config),_0x3485e3=_0x4bc689[_0x49d4fe(0x22c)];return logger[_0x49d4fe(0x20c)](_0x54cca6[_0x49d4fe(0x1f9)]),_0x3485e3['token'];}catch(_0x400ff4){return logger['error'](_0x49d4fe(0x228)+_0x400ff4),null;}}async[a103_0x4de140(0x210)](){const _0x593b8e=a103_0x4de140,_0x8bde6e={'bljFP':function(_0x452686,_0x5d98b1){return _0x452686(_0x5d98b1);},'HgowI':function(_0x2ec172,_0x359105){return _0x2ec172+_0x359105;},'VzySE':'Percy\x20config\x20created\x20at\x20','ThQvj':'percy.json'};if(!this.#config[_0x593b8e(0x1fd)])return null;const _0x40d26e=path[_0x593b8e(0x1fe)](os[_0x593b8e(0x21c)](),_0x8bde6e[_0x593b8e(0x1f5)]),_0x14eb1f=this.#config[_0x593b8e(0x1fd)];return!_0x14eb1f['version']&&(_0x14eb1f[_0x593b8e(0x20b)]='2'),new Promise((_0x280f24,_0x36c1e0)=>{const _0x2e99d4=_0x593b8e;fs[_0x2e99d4(0x223)](_0x40d26e,JSON['stringify'](_0x14eb1f),_0x3ef0bf=>{const _0x592728=_0x2e99d4;_0x3ef0bf&&(logger[_0x592728(0x1e4)](_0x592728(0x201)+_0x3ef0bf),_0x8bde6e[_0x592728(0x216)](_0x280f24,null)),logger[_0x592728(0x20c)](_0x8bde6e[_0x592728(0x213)](_0x8bde6e[_0x592728(0x205)],_0x40d26e)),_0x8bde6e[_0x592728(0x216)](_0x280f24,_0x40d26e);});});}}function a103_0x2836(_0x45b6bb,_0xbdeb45){const _0x3e3480=a103_0x3e34();return a103_0x2836=function(_0x283678,_0x5a2cad){_0x283678=_0x283678-0x1dd;let _0x32eb5f=_0x3e3480[_0x283678];return _0x32eb5f;},a103_0x2836(_0x45b6bb,_0xbdeb45);}module['exports']=Percy;function a103_0x3e34(){const _0x2c16f6=['exec:stop','ThQvj','getBinaryPath',':start','PERCY_SERVER_ADDRESS','BdJHW','qDXKX','vDlrH','bUnPb','percyOptions','join','app:exec','ENV_VAR','Error\x20creating\x20percy\x20config:\x20','10JyPPRo','Percy\x20fetch\x20token\x20success','191128OwFnSx','VzySE','automate','YJBnm','close','percy.log','createWriteStream','version','debug','biJac','NmIpw','end','createPercyConfig','Percy\x20healthcheck\x20successful','child_process','HgowI','./PercyBinary','stderr','bljFP','../../helpers/performance/constants','dfEwz','GET','fYCPp','4638VQdnHN','tmpdir','5qXXHXz','http://localhost:5338','start','assign','5337409HILVRv','stop','writeFile','xDdJw','184770oGUKkp','exec','flags','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','eYpot','isProcessRunning','pipe','data','mSFYQ','108NOngMM','18sbBzaR','&type=','app','338456SnnaiB','zWiqM','error','DOWNLOAD','fetchPercyToken','api/app_percy/get_project_token?name=','BROWSERSTACK_TESTHUB_UUID','3373818XmHzCa','path','81550QqHXFk','projectName','winstonLogger','../logger','env','Jxest','../../helpers/testhub/constants','percy/healthcheck','isRunning'];a103_0x3e34=function(){return _0x2c16f6;};return a103_0x3e34();}
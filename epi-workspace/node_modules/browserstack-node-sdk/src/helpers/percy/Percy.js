const a72_0x190fef=a72_0x1efa;(function(_0x309d3a,_0x2f5200){const _0x3a4093=a72_0x1efa,_0x1549b5=_0x309d3a();while(!![]){try{const _0x16b083=-parseInt(_0x3a4093(0x215))/0x1*(parseInt(_0x3a4093(0x1f9))/0x2)+-parseInt(_0x3a4093(0x214))/0x3*(-parseInt(_0x3a4093(0x211))/0x4)+parseInt(_0x3a4093(0x1e0))/0x5+parseInt(_0x3a4093(0x1f1))/0x6*(parseInt(_0x3a4093(0x1f8))/0x7)+-parseInt(_0x3a4093(0x219))/0x8*(-parseInt(_0x3a4093(0x1f5))/0x9)+parseInt(_0x3a4093(0x1ee))/0xa+-parseInt(_0x3a4093(0x1f0))/0xb;if(_0x16b083===_0x2f5200)break;else _0x1549b5['push'](_0x1549b5['shift']());}catch(_0x1a93ff){_0x1549b5['push'](_0x1549b5['shift']());}}}(a72_0x40ee,0x941e4));function a72_0x1efa(_0x49f4c1,_0x55b847){const _0x40ee7b=a72_0x40ee();return a72_0x1efa=function(_0x1efaf2,_0x200920){_0x1efaf2=_0x1efaf2-0x1d5;let _0x219383=_0x40ee7b[_0x1efaf2];return _0x219383;},a72_0x1efa(_0x49f4c1,_0x55b847);}function a72_0x40ee(){const _0x465859=['BaZXW','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','mtHRo','rjlZm','LFkmG','join','DOWNLOAD','exec:stop','end','percyOptions','BROWSERSTACK_TESTHUB_UUID','env','version','Mcfsl','mRdpy','healthcheck','writeFile','exports','3206330LgzzoV','vuXqW','tmpdir','close','percy.log','../../helpers/testhub/constants','stdout','vqzuJ','path','../../helpers/performance/constants','app','isRunning','exec','PERCY_SERVER_ADDRESS','7707730AxZxMj','hKJXb','18989751GXXhKE','89844kJrOUJ','debug','http://localhost:5338','percy.json','45OAgtjQ','fIMsT',':start','77JtABbP','254xUHkpI','stringify','Error\x20creating\x20percy\x20config:\x20','api/app_percy/get_project_token?name=','CDIjw','Percy\x20fetch\x20token\x20success','BHwLz','stop','stderr','createWriteStream','isProcessRunning','../helper','createPercyConfig','assign','automate','start','GET','nodeRequest','app:exec','HLdUA','hXGav','projectName','child_process','../logger','44SvbEsJ','fetchPercyToken','pipe','249663xODXly','6143UlEGmp','PFTPg','ENV_VAR','./PercyBinary','993616LYgsXG'];a72_0x40ee=function(){return _0x465859;};return a72_0x40ee();}const fs=require('fs'),path=require(a72_0x190fef(0x1e8)),os=require('os'),{spawn}=require(a72_0x190fef(0x20f)),helper=require(a72_0x190fef(0x204)),logger=require(a72_0x190fef(0x210))['winstonLogger'],{logDir}=require('../logger'),testHubConstants=require(a72_0x190fef(0x1e5)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x190fef(0x1e9)),PercyBinary=require(a72_0x190fef(0x218));class Percy{#logfile=path[a72_0x190fef(0x21f)](logDir,a72_0x190fef(0x1e4));#address=process['env'][a72_0x190fef(0x1ed)]||a72_0x190fef(0x1f3);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x190fef(0x203)]=![];constructor(_0xcc3ebc){const _0x4e20a5=a72_0x190fef;this.#config=_0xcc3ebc,!!_0xcc3ebc[_0x4e20a5(0x1ea)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x14bd26=a72_0x190fef;if(!this.#binaryPath){const _0x6d19fa=new PercyBinary();PerformanceTester[_0x14bd26(0x208)](PerformanceEvents[_0x14bd26(0x220)]),this.#binaryPath=await _0x6d19fa['getBinaryPath'](this.#config),PerformanceTester[_0x14bd26(0x1d6)](PerformanceEvents[_0x14bd26(0x220)]);}return this.#binaryPath;}async #sleep(_0x8917b5){return new Promise(_0x3a882c=>setTimeout(_0x3a882c,_0x8917b5));}async[a72_0x190fef(0x1dd)](){const _0x445216=a72_0x190fef,_0x3dd1c7={};_0x3dd1c7[_0x445216(0x21c)]=_0x445216(0x209),_0x3dd1c7[_0x445216(0x1fd)]='percy/healthcheck';const _0x5d061b=_0x3dd1c7;try{const _0x56412c=await helper[_0x445216(0x20a)](_0x5d061b[_0x445216(0x21c)],_0x5d061b[_0x445216(0x1fd)],null,null,this.#address);if(_0x56412c)return!![];}catch(_0x5005b2){return![];}}async[a72_0x190fef(0x208)](){const _0x50b49c=a72_0x190fef,_0x81ff47={'palUD':_0x50b49c(0x20b),'HLdUA':_0x50b49c(0x1ec),'vuXqW':function(_0x1df424,_0x34d389,_0x34111a,_0x318e39){return _0x1df424(_0x34d389,_0x34111a,_0x318e39);},'poMJj':_0x50b49c(0x1e3),'SsLRh':'Percy\x20healthcheck\x20successful'},_0x51a824=await this.#getBinaryPath(),_0x2b6039={};_0x2b6039['flags']='a';const _0x7c8a34=fs[_0x50b49c(0x202)](this.#logfile,_0x2b6039),_0x5a9b80=await this[_0x50b49c(0x212)](),_0x413398=await this[_0x50b49c(0x205)]();if(!_0x5a9b80)return![];const _0xf9a3d8=[(this.#isApp?_0x81ff47['palUD']:_0x81ff47[_0x50b49c(0x20c)])+_0x50b49c(0x1f7)];_0x413398&&_0xf9a3d8['push']('-c',_0x413398);this.#proc=_0x81ff47[_0x50b49c(0x1e1)](spawn,_0x51a824,_0xf9a3d8,{'env':Object[_0x50b49c(0x206)](process[_0x50b49c(0x1d9)],{'PERCY_TOKEN':_0x5a9b80,'TH_BUILD_UUID':process[_0x50b49c(0x1d9)][testHubConstants[_0x50b49c(0x217)][_0x50b49c(0x1d8)]]})}),this.#proc[_0x50b49c(0x1e6)][_0x50b49c(0x213)](_0x7c8a34),this.#proc[_0x50b49c(0x201)][_0x50b49c(0x213)](_0x7c8a34),this[_0x50b49c(0x203)]=!![];var _0x3621c5=this;this.#proc['on'](_0x81ff47['poMJj'],function(_0x373f58){const _0x4acd78=_0x50b49c;_0x3621c5[_0x4acd78(0x203)]=![];});do{const _0x2ba5a3=await this['healthcheck']();if(_0x2ba5a3)return logger[_0x50b49c(0x1f2)](_0x81ff47['SsLRh']),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x190fef(0x200)](){const _0x2db5e3=a72_0x190fef,_0x449d7f={'mRdpy':function(_0xc80aaa,_0x325a01){return _0xc80aaa(_0x325a01);},'hKJXb':function(_0x21c759,_0x5959ee,_0x1bd68b){return _0x21c759(_0x5959ee,_0x1bd68b);},'rjlZm':_0x2db5e3(0x1d5),'WzIXI':'close'},_0x6ab7bd=await this.#getBinaryPath();return new Promise((_0x2deb45,_0x57faa6)=>{const _0x5edcfe=_0x2db5e3,_0x3085ad={'TWliD':function(_0x28ee17,_0x419a2a){const _0x44dec0=a72_0x1efa;return _0x449d7f[_0x44dec0(0x1dc)](_0x28ee17,_0x419a2a);}},_0x946994=_0x449d7f[_0x5edcfe(0x1ef)](spawn,_0x6ab7bd,[_0x449d7f[_0x5edcfe(0x21d)]]);_0x946994['on'](_0x449d7f['WzIXI'],_0x96e0dc=>{this['isProcessRunning']=![],_0x3085ad['TWliD'](_0x2deb45,_0x96e0dc);});});}[a72_0x190fef(0x1eb)](){const _0x1eb8f3=a72_0x190fef;return this[_0x1eb8f3(0x203)];}async['fetchPercyToken'](){const _0x69d906=a72_0x190fef,_0x472e1e={};_0x472e1e[_0x69d906(0x21a)]=_0x69d906(0x1ea),_0x472e1e[_0x69d906(0x1ff)]=_0x69d906(0x207),_0x472e1e[_0x69d906(0x1e7)]=_0x69d906(0x209),_0x472e1e[_0x69d906(0x21e)]=_0x69d906(0x1fe);const _0x28cfc2=_0x472e1e,_0x434883=this.#config[_0x69d906(0x20e)];try{const _0xce05f8=this.#isApp?_0x28cfc2[_0x69d906(0x21a)]:_0x28cfc2[_0x69d906(0x1ff)],_0x4d2568=await helper[_0x69d906(0x20a)](_0x28cfc2[_0x69d906(0x1e7)],_0x69d906(0x1fc)+_0x434883+'&type='+_0xce05f8,{},this.#config),_0x2bf90c=_0x4d2568['data'];return logger['debug'](_0x28cfc2[_0x69d906(0x21e)]),_0x2bf90c['token'];}catch(_0x5e3b9d){return logger['error'](_0x69d906(0x21b)+_0x5e3b9d),null;}}async['createPercyConfig'](){const _0x410029=a72_0x190fef,_0x5c4027={'PFTPg':function(_0x502498,_0x1a6461){return _0x502498(_0x1a6461);},'fIMsT':function(_0x160541,_0x31ec64){return _0x160541+_0x31ec64;},'Mcfsl':'Percy\x20config\x20created\x20at\x20','vaBMv':function(_0xe70d0b,_0xf48922){return _0xe70d0b(_0xf48922);},'hXGav':_0x410029(0x1f4)};if(!this.#config[_0x410029(0x1d7)])return null;const _0x24f602=path[_0x410029(0x21f)](os[_0x410029(0x1e2)](),_0x5c4027[_0x410029(0x20d)]),_0x556505=this.#config[_0x410029(0x1d7)];return!_0x556505[_0x410029(0x1da)]&&(_0x556505[_0x410029(0x1da)]='2'),new Promise((_0x22bca3,_0x26e97e)=>{const _0x395521=_0x410029;fs[_0x395521(0x1de)](_0x24f602,JSON[_0x395521(0x1fa)](_0x556505),_0x638126=>{const _0x17ab60=_0x395521;_0x638126&&(logger['error'](_0x17ab60(0x1fb)+_0x638126),_0x5c4027[_0x17ab60(0x216)](_0x22bca3,null)),logger['debug'](_0x5c4027[_0x17ab60(0x1f6)](_0x5c4027[_0x17ab60(0x1db)],_0x24f602)),_0x5c4027['vaBMv'](_0x22bca3,_0x24f602);});});}}module[a72_0x190fef(0x1df)]=Percy;
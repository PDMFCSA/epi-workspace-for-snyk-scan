const a72_0x2479c7=a72_0x2eb3;(function(_0x40bf81,_0x40933b){const _0x3a02df=a72_0x2eb3,_0x4637ea=_0x40bf81();while(!![]){try{const _0x36a7d1=-parseInt(_0x3a02df(0xbd))/0x1+parseInt(_0x3a02df(0xea))/0x2*(parseInt(_0x3a02df(0xb1))/0x3)+parseInt(_0x3a02df(0xe8))/0x4*(parseInt(_0x3a02df(0xd0))/0x5)+parseInt(_0x3a02df(0xd7))/0x6*(-parseInt(_0x3a02df(0xe5))/0x7)+parseInt(_0x3a02df(0xc7))/0x8*(parseInt(_0x3a02df(0xf3))/0x9)+parseInt(_0x3a02df(0xc8))/0xa*(-parseInt(_0x3a02df(0xd4))/0xb)+parseInt(_0x3a02df(0xcd))/0xc;if(_0x36a7d1===_0x40933b)break;else _0x4637ea['push'](_0x4637ea['shift']());}catch(_0x5c6d78){_0x4637ea['push'](_0x4637ea['shift']());}}}(a72_0x5176,0xd80a9));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a72_0x2479c7(0xc6)),helper=require('../helper'),logger=require(a72_0x2479c7(0xfc))[a72_0x2479c7(0xd9)],{getLogDir}=require(a72_0x2479c7(0xfc)),testHubConstants=require(a72_0x2479c7(0xbc)),PerformanceTester=require(a72_0x2479c7(0xd2)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x2479c7(0xe3)),PercyBinary=require(a72_0x2479c7(0xf6));class Percy{#logfile=path['join'](getLogDir(),a72_0x2479c7(0xf2));#address=process[a72_0x2479c7(0xb6)][a72_0x2479c7(0xc3)]||a72_0x2479c7(0xf8);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x2479c7(0xf9)]=![];constructor(_0x519262){const _0x2ce872=a72_0x2479c7;this.#config=_0x519262,!!_0x519262[_0x2ce872(0xb0)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x16829b=a72_0x2479c7;if(!this.#binaryPath){const _0x2b7823=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x16829b(0xe6)]),this.#binaryPath=await _0x2b7823[_0x16829b(0xc0)](this.#config),PerformanceTester['end'](PerformanceEvents[_0x16829b(0xe6)]);}return this.#binaryPath;}async #sleep(_0x542321){return new Promise(_0x31da2b=>setTimeout(_0x31da2b,_0x542321));}async[a72_0x2479c7(0xce)](){const _0xc495a9=a72_0x2479c7,_0x542370={};_0x542370[_0xc495a9(0xbf)]=_0xc495a9(0xdf),_0x542370[_0xc495a9(0xaf)]='percy/healthcheck';const _0x1a8a57=_0x542370;try{const _0x347dd0=await helper[_0xc495a9(0xbb)](_0x1a8a57[_0xc495a9(0xbf)],_0x1a8a57['TJCax'],null,null,this.#address);if(_0x347dd0)return!![];}catch(_0xf7e768){return![];}}async[a72_0x2479c7(0xfa)](){const _0x25ceac=a72_0x2479c7,_0x48054d={'Fyxrw':_0x25ceac(0xb5),'rtMke':_0x25ceac(0xe9),'wTJFh':function(_0x496b9e,_0x538af7,_0xdd883c,_0x817215){return _0x496b9e(_0x538af7,_0xdd883c,_0x817215);},'nNeAJ':_0x25ceac(0xb4),'IvEiD':_0x25ceac(0xb8)},_0x5d1019=await this.#getBinaryPath(),_0x26f254={};_0x26f254[_0x25ceac(0xd5)]='a';const _0x26ed4d=fs[_0x25ceac(0xb7)](this.#logfile,_0x26f254),_0x5be1ba=await this[_0x25ceac(0xf4)](),_0x433f8c=await this['createPercyConfig']();if(!_0x5be1ba)return![];const _0x52c258=[(this.#isApp?_0x48054d[_0x25ceac(0xed)]:_0x48054d[_0x25ceac(0xd8)])+_0x25ceac(0xdb)];_0x433f8c&&_0x52c258[_0x25ceac(0xf0)]('-c',_0x433f8c);this.#proc=_0x48054d[_0x25ceac(0xdc)](spawn,_0x5d1019,_0x52c258,{'env':Object[_0x25ceac(0xec)](process['env'],{'PERCY_TOKEN':_0x5be1ba,'TH_BUILD_UUID':process['env'][testHubConstants[_0x25ceac(0xd1)][_0x25ceac(0xe2)]]})}),this.#proc['stdout']['pipe'](_0x26ed4d),this.#proc[_0x25ceac(0xca)]['pipe'](_0x26ed4d),this[_0x25ceac(0xf9)]=!![];var _0x2020df=this;this.#proc['on'](_0x48054d[_0x25ceac(0xb3)],function(_0x5a2907){const _0x2ab0c7=_0x25ceac;_0x2020df[_0x2ab0c7(0xf9)]=![];});do{const _0x4db276=await this[_0x25ceac(0xce)]();if(_0x4db276)return logger[_0x25ceac(0xda)](_0x48054d['IvEiD']),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x2479c7(0xcc)](){const _0x3297cd=a72_0x2479c7,_0x58a289={'QFLcl':function(_0x55d99c,_0xfddf50){return _0x55d99c(_0xfddf50);},'cMMFg':function(_0x3ce944,_0x3acbd1,_0x54ea1b){return _0x3ce944(_0x3acbd1,_0x54ea1b);},'CjUyb':_0x3297cd(0xde),'EbhbI':'close'},_0x4b7e3e=await this.#getBinaryPath();return new Promise((_0x45734e,_0x136991)=>{const _0x199de3=_0x3297cd,_0x275577=_0x58a289[_0x199de3(0xdd)](spawn,_0x4b7e3e,[_0x58a289[_0x199de3(0xb2)]]);_0x275577['on'](_0x58a289[_0x199de3(0xee)],_0x1bd641=>{const _0x5a833c=_0x199de3;this[_0x5a833c(0xf9)]=![],_0x58a289['QFLcl'](_0x45734e,_0x1bd641);});});}[a72_0x2479c7(0xf5)](){const _0xd15898=a72_0x2479c7;return this[_0xd15898(0xf9)];}async[a72_0x2479c7(0xf4)](){const _0x4ec47c=a72_0x2479c7,_0x5c775a={};_0x5c775a[_0x4ec47c(0xf1)]='app',_0x5c775a['oDRvV']=_0x4ec47c(0xf7),_0x5c775a[_0x4ec47c(0xe1)]=_0x4ec47c(0xdf),_0x5c775a['qzfjx']='Percy\x20fetch\x20token\x20success';const _0xcd9158=_0x5c775a,_0xbd38a5=this.#config[_0x4ec47c(0xe4)];try{const _0x47b751=this.#isApp?_0xcd9158['xSTvF']:_0xcd9158[_0x4ec47c(0xfb)],_0x47d23e=await helper[_0x4ec47c(0xbb)](_0xcd9158[_0x4ec47c(0xe1)],_0x4ec47c(0xbe)+_0xbd38a5+'&type='+_0x47b751,{},this.#config),_0x58c0aa=_0x47d23e[_0x4ec47c(0xba)];return logger[_0x4ec47c(0xda)](_0xcd9158['qzfjx']),_0x58c0aa[_0x4ec47c(0xef)];}catch(_0x11c0e2){return logger[_0x4ec47c(0xcf)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x11c0e2),null;}}async[a72_0x2479c7(0xb9)](){const _0x350447=a72_0x2479c7,_0x4b2b15={'jDubt':function(_0x37eebf,_0x2e49d5){return _0x37eebf(_0x2e49d5);},'csdTZ':function(_0xefcf55,_0x50539e){return _0xefcf55+_0x50539e;},'FNhYo':_0x350447(0xc9),'yohMp':function(_0x2f26a3,_0x57b694){return _0x2f26a3(_0x57b694);},'sqtAS':_0x350447(0xd6)};if(!this.#config[_0x350447(0xc2)])return null;const _0x3a25b5=path[_0x350447(0xe7)](os[_0x350447(0xd3)](),_0x4b2b15[_0x350447(0xeb)]),_0x236e7e=this.#config[_0x350447(0xc2)];return!_0x236e7e[_0x350447(0xc5)]&&(_0x236e7e[_0x350447(0xc5)]='2'),new Promise((_0x2879c9,_0x421c11)=>{const _0x4b74f7=_0x350447;fs[_0x4b74f7(0xe0)](_0x3a25b5,JSON['stringify'](_0x236e7e),_0x13fa0d=>{const _0x4ac837=_0x4b74f7;_0x13fa0d&&(logger['error']('Error\x20creating\x20percy\x20config:\x20'+_0x13fa0d),_0x4b2b15['jDubt'](_0x2879c9,null)),logger[_0x4ac837(0xda)](_0x4b2b15[_0x4ac837(0xc4)](_0x4b2b15['FNhYo'],_0x3a25b5)),_0x4b2b15[_0x4ac837(0xcb)](_0x2879c9,_0x3a25b5);});});}}function a72_0x2eb3(_0x50c850,_0xd7b49e){const _0x517684=a72_0x5176();return a72_0x2eb3=function(_0x2eb334,_0x38caa5){_0x2eb334=_0x2eb334-0xaf;let _0x11f301=_0x517684[_0x2eb334];return _0x11f301;},a72_0x2eb3(_0x50c850,_0xd7b49e);}function a72_0x5176(){const _0x251a72=['yohMp','stop','16610220MtRWDA','healthcheck','error','30tEgDjn','ENV_VAR','../../helpers/performance/performance-tester','tmpdir','33ekAaLK','flags','percy.json','1182peHAaj','rtMke','winstonLogger','debug',':start','wTJFh','cMMFg','exec:stop','GET','writeFile','WoXgW','BROWSERSTACK_TESTHUB_UUID','../../helpers/performance/constants','projectName','41909nNMCkp','DOWNLOAD','join','176132dtpTdq','exec','2uMeSbE','sqtAS','assign','Fyxrw','EbhbI','token','push','xSTvF','percy.log','648vqlEPQ','fetchPercyToken','isRunning','./PercyBinary','automate','http://localhost:5338','isProcessRunning','start','oDRvV','../logger','TJCax','app','167886KImwnv','CjUyb','nNeAJ','close','app:exec','env','createWriteStream','Percy\x20healthcheck\x20successful','createPercyConfig','data','nodeRequest','../../helpers/testhub/constants','902218IJHniG','api/app_percy/get_project_token?name=','mUDEm','getBinaryPath','exports','percyOptions','PERCY_SERVER_ADDRESS','csdTZ','version','child_process','159336dVFQeO','572690Ljtnkc','Percy\x20config\x20created\x20at\x20','stderr'];a72_0x5176=function(){return _0x251a72;};return a72_0x5176();}module[a72_0x2479c7(0xc1)]=Percy;
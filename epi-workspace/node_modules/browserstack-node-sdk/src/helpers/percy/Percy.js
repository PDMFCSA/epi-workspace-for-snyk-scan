const a103_0x38221c=a103_0x104c;(function(_0x2ad363,_0x561ab7){const _0x43ca0c=a103_0x104c,_0x51bc9b=_0x2ad363();while(!![]){try{const _0x3182c5=-parseInt(_0x43ca0c(0xcd))/0x1+parseInt(_0x43ca0c(0xb9))/0x2+-parseInt(_0x43ca0c(0xd1))/0x3+-parseInt(_0x43ca0c(0xb2))/0x4+-parseInt(_0x43ca0c(0xd3))/0x5+-parseInt(_0x43ca0c(0x99))/0x6*(parseInt(_0x43ca0c(0xd2))/0x7)+parseInt(_0x43ca0c(0xad))/0x8;if(_0x3182c5===_0x561ab7)break;else _0x51bc9b['push'](_0x51bc9b['shift']());}catch(_0x5b3ebc){_0x51bc9b['push'](_0x51bc9b['shift']());}}}(a103_0x2210,0xb0c97));function a103_0x2210(){const _0x3f5066=['hOFec','token','debug','QpsBl','stderr','&type=','nodeRequest','env','Percy\x20fetch\x20token\x20success','percy.log','child_process','BROWSERSTACK_TESTHUB_UUID','percy/healthcheck','ENV_VAR','mUnGA','start','../logger','app','475124uAkSsT','automate','createPercyConfig','DOWNLOAD','1630737LJIHZl','2360806YuhbcW','860455eeUMcV','../../helpers/performance/performance-tester','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','percyOptions','jHCBL','exports','join','Percy\x20config\x20created\x20at\x20','exec','Error\x20creating\x20percy\x20config:\x20','NwFJK','12rPEvjn','isProcessRunning','../../helpers/performance/constants','../../helpers/testhub/constants','hccsX','projectName','FabjH','pipe','tmpdir','http://localhost:5338','push','path','healthcheck','fetchPercyToken','getBinaryPath','BxMPx','hrCdh','winstonLogger','app:exec','percy.json','17599888ljZJFQ','stop','GET','data','close','3484036xKJLTu','assign','UmHWE','mwBQl','../helper','iPkJj','api/app_percy/get_project_token?name=','2520904coAeNT','CNbme'];a103_0x2210=function(){return _0x3f5066;};return a103_0x2210();}const fs=require('fs'),path=require(a103_0x38221c(0xa4)),os=require('os'),{spawn}=require(a103_0x38221c(0xc5)),helper=require(a103_0x38221c(0xb6)),logger=require(a103_0x38221c(0xcb))[a103_0x38221c(0xaa)],{getLogDir}=require(a103_0x38221c(0xcb)),testHubConstants=require(a103_0x38221c(0x9c)),PerformanceTester=require(a103_0x38221c(0xd4)),{PERCY_EVENTS:PerformanceEvents}=require(a103_0x38221c(0x9b)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a103_0x38221c(0xd9)](getLogDir(),a103_0x38221c(0xc4));#address=process[a103_0x38221c(0xc2)]['PERCY_SERVER_ADDRESS']||a103_0x38221c(0xa2);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x3f175b){this.#config=_0x3f175b,!!_0x3f175b['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x396deb=a103_0x38221c;if(!this.#binaryPath){const _0xeea16f=new PercyBinary();PerformanceTester[_0x396deb(0xca)](PerformanceEvents[_0x396deb(0xd0)]),this.#binaryPath=await _0xeea16f[_0x396deb(0xa7)](this.#config),PerformanceTester['end'](PerformanceEvents[_0x396deb(0xd0)]);}return this.#binaryPath;}async #sleep(_0x43fd2e){return new Promise(_0x5b4be1=>setTimeout(_0x5b4be1,_0x43fd2e));}async[a103_0x38221c(0xa5)](){const _0xa3c328=a103_0x38221c,_0x31e50f={};_0x31e50f[_0xa3c328(0xd7)]=_0xa3c328(0xaf),_0x31e50f[_0xa3c328(0xbe)]=_0xa3c328(0xc7);const _0x1c4955=_0x31e50f;try{const _0x5f8ab=await helper['nodeRequest'](_0x1c4955[_0xa3c328(0xd7)],_0x1c4955[_0xa3c328(0xbe)],null,null,this.#address);if(_0x5f8ab)return!![];}catch(_0x4eb596){return![];}}async[a103_0x38221c(0xca)](){const _0x2a6245=a103_0x38221c,_0x2533a4={'ZhJpj':_0x2a6245(0xab),'hOFec':_0x2a6245(0x96),'Jyfwx':function(_0x2e66fb,_0x36dab0,_0x17b7e3,_0x117add){return _0x2e66fb(_0x36dab0,_0x17b7e3,_0x117add);},'rYWdM':'close','mUnGA':'Percy\x20healthcheck\x20successful'},_0x5070be=await this.#getBinaryPath(),_0x372369={};_0x372369['flags']='a';const _0x3bbfbe=fs['createWriteStream'](this.#logfile,_0x372369),_0x4f57e5=await this[_0x2a6245(0xa6)](),_0x1e10fb=await this[_0x2a6245(0xcf)]();if(!_0x4f57e5)return![];const _0x524d1d=[(this.#isApp?_0x2533a4['ZhJpj']:_0x2533a4[_0x2a6245(0xbb)])+':start'];_0x1e10fb&&_0x524d1d[_0x2a6245(0xa3)]('-c',_0x1e10fb);this.#proc=_0x2533a4['Jyfwx'](spawn,_0x5070be,_0x524d1d,{'env':Object[_0x2a6245(0xb3)](process[_0x2a6245(0xc2)],{'PERCY_TOKEN':_0x4f57e5,'TH_BUILD_UUID':process[_0x2a6245(0xc2)][testHubConstants[_0x2a6245(0xc8)][_0x2a6245(0xc6)]]})}),this.#proc['stdout'][_0x2a6245(0xa0)](_0x3bbfbe),this.#proc[_0x2a6245(0xbf)]['pipe'](_0x3bbfbe),this[_0x2a6245(0x9a)]=!![];var _0x330301=this;this.#proc['on'](_0x2533a4['rYWdM'],function(_0x2d558a){const _0x25c79f=_0x2a6245;_0x330301[_0x25c79f(0x9a)]=![];});do{const _0x6889a1=await this['healthcheck']();if(_0x6889a1)return logger['debug'](_0x2533a4[_0x2a6245(0xc9)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a103_0x38221c(0xae)](){const _0x5c07c5=a103_0x38221c,_0x4d1ea9={'CNbme':function(_0x23b295,_0x1919a3){return _0x23b295(_0x1919a3);},'NwFJK':function(_0x1c61f6,_0x555dad,_0x2d8346){return _0x1c61f6(_0x555dad,_0x2d8346);},'iPkJj':'exec:stop','UmHWE':_0x5c07c5(0xb1)},_0x4ae536=await this.#getBinaryPath();return new Promise((_0x43df55,_0x3ee119)=>{const _0x12bb17=_0x5c07c5,_0x2b31e4=_0x4d1ea9[_0x12bb17(0x98)](spawn,_0x4ae536,[_0x4d1ea9[_0x12bb17(0xb7)]]);_0x2b31e4['on'](_0x4d1ea9[_0x12bb17(0xb4)],_0x228f62=>{const _0x455112=_0x12bb17;this['isProcessRunning']=![],_0x4d1ea9[_0x455112(0xba)](_0x43df55,_0x228f62);});});}['isRunning'](){const _0x31b04d=a103_0x38221c;return this[_0x31b04d(0x9a)];}async[a103_0x38221c(0xa6)](){const _0xb4bd1c=a103_0x38221c,_0x20c4f5={};_0x20c4f5[_0xb4bd1c(0xb5)]=_0xb4bd1c(0xcc),_0x20c4f5[_0xb4bd1c(0xa9)]=_0xb4bd1c(0xce),_0x20c4f5[_0xb4bd1c(0xa8)]='GET',_0x20c4f5['FabjH']=_0xb4bd1c(0xc3);const _0x2d5c74=_0x20c4f5,_0x37bf92=this.#config[_0xb4bd1c(0x9e)];try{const _0x52e4d7=this.#isApp?_0x2d5c74[_0xb4bd1c(0xb5)]:_0x2d5c74[_0xb4bd1c(0xa9)],_0x5e486a=await helper[_0xb4bd1c(0xc1)](_0x2d5c74['BxMPx'],_0xb4bd1c(0xb8)+_0x37bf92+_0xb4bd1c(0xc0)+_0x52e4d7,{},this.#config),_0x1a3f07=_0x5e486a[_0xb4bd1c(0xb0)];return logger[_0xb4bd1c(0xbd)](_0x2d5c74[_0xb4bd1c(0x9f)]),_0x1a3f07[_0xb4bd1c(0xbc)];}catch(_0x35095d){return logger['error'](_0xb4bd1c(0xd5)+_0x35095d),null;}}async['createPercyConfig'](){const _0x5c263c=a103_0x38221c,_0x5b14e2={'dcYxw':function(_0x190260,_0x2194eb){return _0x190260(_0x2194eb);},'hccsX':function(_0x313a82,_0x1b096c){return _0x313a82+_0x1b096c;},'PrTuw':_0x5c263c(0x95),'lWXSK':function(_0x35a140,_0x38348c){return _0x35a140(_0x38348c);},'EyaxI':_0x5c263c(0xac)};if(!this.#config[_0x5c263c(0xd6)])return null;const _0x13f40d=path[_0x5c263c(0xd9)](os[_0x5c263c(0xa1)](),_0x5b14e2['EyaxI']),_0x21c524=this.#config[_0x5c263c(0xd6)];return!_0x21c524['version']&&(_0x21c524['version']='2'),new Promise((_0x483165,_0x348a6a)=>{fs['writeFile'](_0x13f40d,JSON['stringify'](_0x21c524),_0x30d4e5=>{const _0x369e59=a103_0x104c;_0x30d4e5&&(logger['error'](_0x369e59(0x97)+_0x30d4e5),_0x5b14e2['dcYxw'](_0x483165,null)),logger[_0x369e59(0xbd)](_0x5b14e2[_0x369e59(0x9d)](_0x5b14e2['PrTuw'],_0x13f40d)),_0x5b14e2['lWXSK'](_0x483165,_0x13f40d);});});}}function a103_0x104c(_0xb269f2,_0xd48852){const _0x2210a0=a103_0x2210();return a103_0x104c=function(_0x104cef,_0x4b87ab){_0x104cef=_0x104cef-0x95;let _0x1dec4c=_0x2210a0[_0x104cef];return _0x1dec4c;},a103_0x104c(_0xb269f2,_0xd48852);}module[a103_0x38221c(0xd8)]=Percy;
const a110_0x4d654b=a110_0xa011;(function(_0x4a6634,_0x4a0824){const _0x5a9b73=a110_0xa011,_0x2a0156=_0x4a6634();while(!![]){try{const _0x5e247d=parseInt(_0x5a9b73(0x156))/0x1+-parseInt(_0x5a9b73(0x14b))/0x2+-parseInt(_0x5a9b73(0x136))/0x3+-parseInt(_0x5a9b73(0x14f))/0x4+-parseInt(_0x5a9b73(0x147))/0x5+parseInt(_0x5a9b73(0x144))/0x6*(parseInt(_0x5a9b73(0x127))/0x7)+-parseInt(_0x5a9b73(0x150))/0x8*(-parseInt(_0x5a9b73(0x14e))/0x9);if(_0x5e247d===_0x4a0824)break;else _0x2a0156['push'](_0x2a0156['shift']());}catch(_0x570fa2){_0x2a0156['push'](_0x2a0156['shift']());}}}(a110_0x1cd3,0xb6839));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require('child_process'),helper=require(a110_0x4d654b(0x13e)),logger=require('../logger')[a110_0x4d654b(0x130)],{getLogDir}=require(a110_0x4d654b(0x139)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a110_0x4d654b(0x133)),{PERCY_EVENTS:PerformanceEvents}=require(a110_0x4d654b(0x114)),PercyBinary=require(a110_0x4d654b(0x11c));function a110_0x1cd3(){const _0x45ff3a=['projectName','1548295PqgArJ','automate','api/app_percy/get_project_token?name=','isProcessRunning','BROWSERSTACK_TESTHUB_UUID','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','flags','pipe','fetchPercyToken','winstonLogger','debug','pvxSm','../../helpers/performance/performance-tester','WnDdf','writeFile','680727ImQuzY','env','mMQpJ','../logger','createPercyConfig','close','app','version','../helper','assign','oSiXq','http://localhost:5338','isRunning','start','18xdMFLO','Percy\x20config\x20created\x20at\x20','percy.json','710780OFlFyG','mFbjJ','GET','Percy\x20healthcheck\x20successful','1664594wCQLwn','ADAHk','&type=','122769TdQQdn','1337720LdViRx','304sfRvCx','DOWNLOAD','Error\x20creating\x20percy\x20config:\x20','exec:stop','VwXiy','jQoMT','1101456UlWAfq','YFyuR','stdout','getBinaryPath','end','miUxm','Oxrwi','nodeRequest','join','exec','../../helpers/performance/constants','push','createWriteStream','percy/healthcheck','percyOptions','stderr','healthcheck','exports','./PercyBinary','dMnwm','FSdHk','DsunI','cJNOY','stop','yBRCb','CdTNH','app:exec','rdJMJ'];a110_0x1cd3=function(){return _0x45ff3a;};return a110_0x1cd3();}function a110_0xa011(_0x545c57,_0x56e388){const _0x1cd36e=a110_0x1cd3();return a110_0xa011=function(_0xa01171,_0x3443b0){_0xa01171=_0xa01171-0x114;let _0x3e1baf=_0x1cd36e[_0xa01171];return _0x3e1baf;},a110_0xa011(_0x545c57,_0x56e388);}class Percy{#logfile=path['join'](getLogDir(),'percy.log');#address=process[a110_0x4d654b(0x137)]['PERCY_SERVER_ADDRESS']||a110_0x4d654b(0x141);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];['isProcessRunning']=![];constructor(_0x5b610f){const _0x464e70=a110_0x4d654b;this.#config=_0x5b610f,!!_0x5b610f[_0x464e70(0x13c)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x302e78=a110_0x4d654b;if(!this.#binaryPath){const _0x5d7f32=new PercyBinary();PerformanceTester[_0x302e78(0x143)](PerformanceEvents[_0x302e78(0x151)]),this.#binaryPath=await _0x5d7f32[_0x302e78(0x159)](this.#config),PerformanceTester[_0x302e78(0x15a)](PerformanceEvents[_0x302e78(0x151)]);}return this.#binaryPath;}async #sleep(_0x16b6a6){return new Promise(_0x290f1d=>setTimeout(_0x290f1d,_0x16b6a6));}async[a110_0x4d654b(0x11a)](){const _0x32accc=a110_0x4d654b,_0x24a526={};_0x24a526['VwXiy']=_0x32accc(0x149),_0x24a526[_0x32accc(0x134)]=_0x32accc(0x117);const _0x14cdb7=_0x24a526;try{const _0xe0ce17=await helper[_0x32accc(0x15d)](_0x14cdb7[_0x32accc(0x154)],_0x14cdb7['WnDdf'],null,null,this.#address);if(_0xe0ce17)return!![];}catch(_0x38a978){return![];}}async[a110_0x4d654b(0x143)](){const _0x1d4873=a110_0x4d654b,_0x2fed8e={'FSdHk':_0x1d4873(0x124),'DsunI':_0x1d4873(0x15f),'MPmWw':function(_0x284732,_0x272fc8,_0x878b18,_0x52dadd){return _0x284732(_0x272fc8,_0x878b18,_0x52dadd);},'Oxrwi':_0x1d4873(0x13b),'mFbjJ':_0x1d4873(0x14a)},_0x56725e=await this.#getBinaryPath(),_0xb96d2a={};_0xb96d2a[_0x1d4873(0x12d)]='a',this.#logStream=fs[_0x1d4873(0x116)](this.#logfile,_0xb96d2a);const _0x2e61be=await this[_0x1d4873(0x12f)](),_0x111635=await this[_0x1d4873(0x13a)]();if(!_0x2e61be)return![];const _0x2c67a8=[(this.#isApp?_0x2fed8e[_0x1d4873(0x11e)]:_0x2fed8e[_0x1d4873(0x11f)])+':start'];_0x111635&&_0x2c67a8[_0x1d4873(0x115)]('-c',_0x111635);this.#proc=_0x2fed8e['MPmWw'](spawn,_0x56725e,_0x2c67a8,{'env':Object[_0x1d4873(0x13f)](process[_0x1d4873(0x137)],{'PERCY_TOKEN':_0x2e61be,'TH_BUILD_UUID':process[_0x1d4873(0x137)][testHubConstants['ENV_VAR'][_0x1d4873(0x12b)]]})}),this.#proc[_0x1d4873(0x158)][_0x1d4873(0x12e)](this.#logStream),this.#proc[_0x1d4873(0x119)][_0x1d4873(0x12e)](this.#logStream),this['isProcessRunning']=!![];var _0x24d0bb=this;this.#proc['on'](_0x2fed8e[_0x1d4873(0x15c)],function(_0x65c1ad){_0x24d0bb['isProcessRunning']=![];});do{const _0x35c3ce=await this[_0x1d4873(0x11a)]();if(_0x35c3ce)return logger[_0x1d4873(0x131)](_0x2fed8e[_0x1d4873(0x148)]),!![];await this.#sleep(0x3e8);}while(this[_0x1d4873(0x12a)]);return![];}async[a110_0x4d654b(0x121)](){const _0xcf6a85=a110_0x4d654b,_0x3ba38f={'cJNOY':function(_0x124f90,_0x280b24){return _0x124f90(_0x280b24);},'QSsGO':function(_0x61a137,_0x901e0b,_0x16058e){return _0x61a137(_0x901e0b,_0x16058e);},'rdJMJ':_0xcf6a85(0x153),'miUxm':_0xcf6a85(0x13b)},_0xf3c3dd=await this.#getBinaryPath();return new Promise((_0x2978f5,_0x2c4de9)=>{const _0x8d10b1=_0xcf6a85,_0x342fca={'CyABY':function(_0x33e439,_0x1b9fd6){const _0x493226=a110_0xa011;return _0x3ba38f[_0x493226(0x120)](_0x33e439,_0x1b9fd6);}},_0xcae874=_0x3ba38f['QSsGO'](spawn,_0xf3c3dd,[_0x3ba38f[_0x8d10b1(0x125)]]);_0xcae874['on'](_0x3ba38f[_0x8d10b1(0x15b)],_0x504453=>{const _0x4ee1e3=_0x8d10b1;this[_0x4ee1e3(0x12a)]=![],this.#logStream&&(this.#logStream[_0x4ee1e3(0x15a)](),this.#logStream=null),_0x342fca['CyABY'](_0x2978f5,_0x504453);});});}[a110_0x4d654b(0x142)](){const _0x30634e=a110_0x4d654b;return this[_0x30634e(0x12a)];}async[a110_0x4d654b(0x12f)](){const _0x523fad=a110_0x4d654b,_0x478f02={};_0x478f02[_0x523fad(0x157)]=_0x523fad(0x13c),_0x478f02['dMnwm']=_0x523fad(0x128),_0x478f02['CdTNH']=_0x523fad(0x149),_0x478f02[_0x523fad(0x155)]='Percy\x20fetch\x20token\x20success';const _0x5ce896=_0x478f02,_0x4fecf4=this.#config[_0x523fad(0x126)];try{const _0x43f716=this.#isApp?_0x5ce896[_0x523fad(0x157)]:_0x5ce896[_0x523fad(0x11d)],_0x575f38=await helper['nodeRequest'](_0x5ce896[_0x523fad(0x123)],_0x523fad(0x129)+_0x4fecf4+_0x523fad(0x14d)+_0x43f716,{},this.#config),_0x57cc2d=_0x575f38['data'];return logger['debug'](_0x5ce896[_0x523fad(0x155)]),_0x57cc2d['token'];}catch(_0x505b52){return logger['error'](_0x523fad(0x12c)+_0x505b52),null;}}async['createPercyConfig'](){const _0x5642f1=a110_0x4d654b,_0x5e66f4={'mMQpJ':function(_0x3bd682,_0x454a48){return _0x3bd682(_0x454a48);},'Jbqrh':function(_0x292e61,_0x12d669){return _0x292e61+_0x12d669;},'yBRCb':_0x5642f1(0x145),'oSiXq':function(_0x88b77a,_0x1b95a9){return _0x88b77a(_0x1b95a9);},'YCvGl':_0x5642f1(0x146)};if(!this.#config[_0x5642f1(0x118)])return null;const _0x4195bb=path[_0x5642f1(0x15e)](os['tmpdir'](),_0x5e66f4['YCvGl']),_0x165e0a=this.#config['percyOptions'];return!_0x165e0a[_0x5642f1(0x13d)]&&(_0x165e0a[_0x5642f1(0x13d)]='2'),new Promise((_0xb58e4,_0x355928)=>{const _0x132eaa=_0x5642f1,_0x165f56={'ADAHk':function(_0x515b46,_0x386dd1){const _0x5cefb0=a110_0xa011;return _0x5e66f4[_0x5cefb0(0x138)](_0x515b46,_0x386dd1);},'NujrX':function(_0x23547e,_0x123949){return _0x5e66f4['Jbqrh'](_0x23547e,_0x123949);},'LddkZ':_0x5e66f4[_0x132eaa(0x122)],'pvxSm':function(_0x19ee8a,_0x109b4d){const _0x50272e=_0x132eaa;return _0x5e66f4[_0x50272e(0x140)](_0x19ee8a,_0x109b4d);}};fs[_0x132eaa(0x135)](_0x4195bb,JSON['stringify'](_0x165e0a),_0x3e0131=>{const _0x1348f5=_0x132eaa;_0x3e0131&&(logger['error'](_0x1348f5(0x152)+_0x3e0131),_0x165f56[_0x1348f5(0x14c)](_0xb58e4,null)),logger['debug'](_0x165f56['NujrX'](_0x165f56['LddkZ'],_0x4195bb)),_0x165f56[_0x1348f5(0x132)](_0xb58e4,_0x4195bb);});});}}module[a110_0x4d654b(0x11b)]=Percy;
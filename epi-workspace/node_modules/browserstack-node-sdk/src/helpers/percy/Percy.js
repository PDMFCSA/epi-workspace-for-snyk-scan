const a103_0x6c0e3c=a103_0x5af1;function a103_0x5af1(_0x2adf25,_0x22ea8f){const _0x407807=a103_0x4078();return a103_0x5af1=function(_0x5af1bb,_0x3bb054){_0x5af1bb=_0x5af1bb-0x1b9;let _0x43465b=_0x407807[_0x5af1bb];return _0x43465b;},a103_0x5af1(_0x2adf25,_0x22ea8f);}(function(_0x23c624,_0x2aa173){const _0x200b45=a103_0x5af1,_0xa4db8=_0x23c624();while(!![]){try{const _0x20d1f9=-parseInt(_0x200b45(0x1f9))/0x1+-parseInt(_0x200b45(0x1f5))/0x2+-parseInt(_0x200b45(0x1e7))/0x3*(-parseInt(_0x200b45(0x203))/0x4)+parseInt(_0x200b45(0x1fb))/0x5+-parseInt(_0x200b45(0x1e9))/0x6*(parseInt(_0x200b45(0x1bb))/0x7)+-parseInt(_0x200b45(0x1c8))/0x8+parseInt(_0x200b45(0x1e3))/0x9;if(_0x20d1f9===_0x2aa173)break;else _0xa4db8['push'](_0xa4db8['shift']());}catch(_0x1f4e16){_0xa4db8['push'](_0xa4db8['shift']());}}}(a103_0x4078,0x3c27b));const fs=require('fs'),path=require(a103_0x6c0e3c(0x1f4)),os=require('os'),{spawn}=require('child_process'),helper=require(a103_0x6c0e3c(0x1e4)),logger=require(a103_0x6c0e3c(0x1c4))['winstonLogger'],{getLogDir}=require(a103_0x6c0e3c(0x1c4)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a103_0x6c0e3c(0x1f3)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a103_0x6c0e3c(0x1e1)](getLogDir(),a103_0x6c0e3c(0x1ba));#address=process[a103_0x6c0e3c(0x1d9)][a103_0x6c0e3c(0x1de)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a103_0x6c0e3c(0x1ed)]=![];constructor(_0x52c694){const _0x111042=a103_0x6c0e3c;this.#config=_0x52c694,!!_0x52c694[_0x111042(0x1fa)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x3edd16=a103_0x6c0e3c;if(!this.#binaryPath){const _0x5e5085=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x3edd16(0x1ce)]),this.#binaryPath=await _0x5e5085[_0x3edd16(0x1e2)](this.#config),PerformanceTester[_0x3edd16(0x1da)](PerformanceEvents[_0x3edd16(0x1ce)]);}return this.#binaryPath;}async #sleep(_0x5d4c59){return new Promise(_0x18b525=>setTimeout(_0x18b525,_0x5d4c59));}async[a103_0x6c0e3c(0x1f1)](){const _0xef4000=a103_0x6c0e3c,_0x2269f0={};_0x2269f0[_0xef4000(0x1f6)]=_0xef4000(0x1cc),_0x2269f0[_0xef4000(0x1c7)]='percy/healthcheck';const _0x52ff6f=_0x2269f0;try{const _0x489599=await helper[_0xef4000(0x1d4)](_0x52ff6f['XXvsb'],_0x52ff6f[_0xef4000(0x1c7)],null,null,this.#address);if(_0x489599)return!![];}catch(_0x4672d2){return![];}}async['start'](){const _0x2f2c62=a103_0x6c0e3c,_0x5065b8={'Pldkh':_0x2f2c62(0x1ec),'oNXkK':_0x2f2c62(0x1c1),'uhZHU':function(_0x19efb0,_0x1d3cbd,_0x76664b,_0x341036){return _0x19efb0(_0x1d3cbd,_0x76664b,_0x341036);},'KqAVE':_0x2f2c62(0x1c6),'CPdPZ':_0x2f2c62(0x1f0)},_0x5126ca=await this.#getBinaryPath(),_0x581b63={};_0x581b63[_0x2f2c62(0x1fc)]='a';const _0x3e5c49=fs[_0x2f2c62(0x1db)](this.#logfile,_0x581b63),_0x317006=await this[_0x2f2c62(0x1e6)](),_0x289dc2=await this['createPercyConfig']();if(!_0x317006)return![];const _0x4a3ebd=[(this.#isApp?_0x5065b8[_0x2f2c62(0x202)]:_0x5065b8[_0x2f2c62(0x1f8)])+_0x2f2c62(0x1c2)];_0x289dc2&&_0x4a3ebd[_0x2f2c62(0x1d7)]('-c',_0x289dc2);this.#proc=_0x5065b8[_0x2f2c62(0x1c5)](spawn,_0x5126ca,_0x4a3ebd,{'env':Object[_0x2f2c62(0x1f7)](process[_0x2f2c62(0x1d9)],{'PERCY_TOKEN':_0x317006,'TH_BUILD_UUID':process[_0x2f2c62(0x1d9)][testHubConstants['ENV_VAR'][_0x2f2c62(0x1d1)]]})}),this.#proc[_0x2f2c62(0x1ef)][_0x2f2c62(0x1d3)](_0x3e5c49),this.#proc[_0x2f2c62(0x1f2)][_0x2f2c62(0x1d3)](_0x3e5c49),this[_0x2f2c62(0x1ed)]=!![];var _0x38f760=this;this.#proc['on'](_0x5065b8['KqAVE'],function(_0x51502d){const _0x2b90d0=_0x2f2c62;_0x38f760[_0x2b90d0(0x1ed)]=![];});do{const _0x36aa27=await this[_0x2f2c62(0x1f1)]();if(_0x36aa27)return logger[_0x2f2c62(0x1c0)](_0x5065b8['CPdPZ']),!![];await this.#sleep(0x3e8);}while(this[_0x2f2c62(0x1ed)]);return![];}async['stop'](){const _0x14efd8=a103_0x6c0e3c,_0x4114b4={'cMRVa':function(_0x4776de,_0x5da4b8){return _0x4776de(_0x5da4b8);},'mTwqy':function(_0x95a9ab,_0xf9bc80,_0x23b417){return _0x95a9ab(_0xf9bc80,_0x23b417);},'QPOoD':_0x14efd8(0x1fd),'zVWNu':'close'},_0x516fc3=await this.#getBinaryPath();return new Promise((_0x58c1c0,_0x481f3c)=>{const _0x57fbe7=_0x14efd8,_0x62283d=_0x4114b4[_0x57fbe7(0x200)](spawn,_0x516fc3,[_0x4114b4[_0x57fbe7(0x1c9)]]);_0x62283d['on'](_0x4114b4['zVWNu'],_0x5ee785=>{const _0x515a66=_0x57fbe7;this[_0x515a66(0x1ed)]=![],_0x4114b4[_0x515a66(0x1ca)](_0x58c1c0,_0x5ee785);});});}[a103_0x6c0e3c(0x1e8)](){const _0x173548=a103_0x6c0e3c;return this[_0x173548(0x1ed)];}async[a103_0x6c0e3c(0x1e6)](){const _0xaa9def=a103_0x6c0e3c,_0x79bf1f={};_0x79bf1f[_0xaa9def(0x1bf)]='app',_0x79bf1f['ugsKE']='automate',_0x79bf1f[_0xaa9def(0x1eb)]=_0xaa9def(0x1cc),_0x79bf1f['Xhzjx']=_0xaa9def(0x1be);const _0x672ad2=_0x79bf1f,_0x39cbe7=this.#config['projectName'];try{const _0x59fbd0=this.#isApp?_0x672ad2[_0xaa9def(0x1bf)]:_0x672ad2[_0xaa9def(0x1ea)],_0x5aeb6b=await helper[_0xaa9def(0x1d4)](_0x672ad2[_0xaa9def(0x1eb)],'api/app_percy/get_project_token?name='+_0x39cbe7+_0xaa9def(0x1d0)+_0x59fbd0,{},this.#config),_0x5f541f=_0x5aeb6b['data'];return logger['debug'](_0x672ad2[_0xaa9def(0x1cb)]),_0x5f541f[_0xaa9def(0x1fe)];}catch(_0xe1664c){return logger[_0xaa9def(0x1dd)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0xe1664c),null;}}async[a103_0x6c0e3c(0x1d5)](){const _0x15f8b8=a103_0x6c0e3c,_0x1776f0={'XSYLc':function(_0x2d092c,_0xb329e5){return _0x2d092c(_0xb329e5);},'AeVgI':function(_0x234c97,_0x3e8d39){return _0x234c97+_0x3e8d39;},'QRgMF':_0x15f8b8(0x1df),'wOblN':_0x15f8b8(0x1cf)};if(!this.#config[_0x15f8b8(0x1c3)])return null;const _0xc92503=path[_0x15f8b8(0x1e1)](os[_0x15f8b8(0x1cd)](),_0x1776f0['wOblN']),_0x161708=this.#config[_0x15f8b8(0x1c3)];return!_0x161708[_0x15f8b8(0x1e5)]&&(_0x161708[_0x15f8b8(0x1e5)]='2'),new Promise((_0x1edf75,_0xc4e6c)=>{const _0x5f264e=_0x15f8b8,_0x177c52={'fhzWr':function(_0x25c0f9,_0x45895e){const _0x2972b4=a103_0x5af1;return _0x1776f0[_0x2972b4(0x1dc)](_0x25c0f9,_0x45895e);},'yOtGL':function(_0x102749,_0x4a8f74){const _0xd97afd=a103_0x5af1;return _0x1776f0[_0xd97afd(0x201)](_0x102749,_0x4a8f74);},'JDvme':_0x1776f0[_0x5f264e(0x1d8)],'uqogl':function(_0x1da212,_0x2cf8c9){const _0x3b0f98=_0x5f264e;return _0x1776f0[_0x3b0f98(0x1dc)](_0x1da212,_0x2cf8c9);}};fs[_0x5f264e(0x1e0)](_0xc92503,JSON[_0x5f264e(0x1d2)](_0x161708),_0x3ae370=>{const _0x13e873=_0x5f264e;_0x3ae370&&(logger[_0x13e873(0x1dd)](_0x13e873(0x1bd)+_0x3ae370),_0x177c52[_0x13e873(0x1b9)](_0x1edf75,null)),logger[_0x13e873(0x1c0)](_0x177c52[_0x13e873(0x1ff)](_0x177c52[_0x13e873(0x1d6)],_0xc92503)),_0x177c52[_0x13e873(0x1bc)](_0x1edf75,_0xc92503);});});}}module[a103_0x6c0e3c(0x1ee)]=Percy;function a103_0x4078(){const _0x2b7b15=['ZTaRl','debug','exec',':start','percyOptions','../logger','uhZHU','close','letUB','1579072SEDelB','QPOoD','cMRVa','Xhzjx','GET','tmpdir','DOWNLOAD','percy.json','&type=','BROWSERSTACK_TESTHUB_UUID','stringify','pipe','nodeRequest','createPercyConfig','JDvme','push','QRgMF','env','end','createWriteStream','XSYLc','error','PERCY_SERVER_ADDRESS','Percy\x20config\x20created\x20at\x20','writeFile','join','getBinaryPath','8333352FIyeJB','../helper','version','fetchPercyToken','1167VJjYtt','isRunning','1206irkkOs','ugsKE','MfTNb','app:exec','isProcessRunning','exports','stdout','Percy\x20healthcheck\x20successful','healthcheck','stderr','../../helpers/performance/constants','path','672480XWUvdt','XXvsb','assign','oNXkK','396498ifaajm','app','2394920ofUupd','flags','exec:stop','token','yOtGL','mTwqy','AeVgI','Pldkh','1688KvoEUo','fhzWr','percy.log','13671cWspiF','uqogl','Error\x20creating\x20percy\x20config:\x20','Percy\x20fetch\x20token\x20success'];a103_0x4078=function(){return _0x2b7b15;};return a103_0x4078();}
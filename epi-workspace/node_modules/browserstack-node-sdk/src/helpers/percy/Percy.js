function a72_0xf0f1(_0x3a9aad,_0x23b55c){const _0x34a743=a72_0x34a7();return a72_0xf0f1=function(_0xf0f10,_0xb01a21){_0xf0f10=_0xf0f10-0xd0;let _0x2db3eb=_0x34a743[_0xf0f10];return _0x2db3eb;},a72_0xf0f1(_0x3a9aad,_0x23b55c);}const a72_0x359a83=a72_0xf0f1;(function(_0x11a0c5,_0x572610){const _0x2be31b=a72_0xf0f1,_0x491b69=_0x11a0c5();while(!![]){try{const _0x470263=parseInt(_0x2be31b(0x10f))/0x1+parseInt(_0x2be31b(0x114))/0x2+parseInt(_0x2be31b(0xdf))/0x3+-parseInt(_0x2be31b(0xdd))/0x4*(parseInt(_0x2be31b(0xeb))/0x5)+parseInt(_0x2be31b(0xe8))/0x6+parseInt(_0x2be31b(0xe5))/0x7*(-parseInt(_0x2be31b(0x101))/0x8)+parseInt(_0x2be31b(0xf4))/0x9*(parseInt(_0x2be31b(0xec))/0xa);if(_0x470263===_0x572610)break;else _0x491b69['push'](_0x491b69['shift']());}catch(_0x134765){_0x491b69['push'](_0x491b69['shift']());}}}(a72_0x34a7,0x4b8f7));function a72_0x34a7(){const _0x323736=['BROWSERSTACK_TESTHUB_UUID','Wrquc','pipe','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','148128NmVWkU','RirDG','wfjmE','path','PJlNh','healthcheck','isRunning','stderr','getBinaryPath','createWriteStream','LCErW','nodeRequest','vEpyI','Percy\x20healthcheck\x20successful','459033lYVEIX','Percy\x20fetch\x20token\x20success','TBbKI','PERCY_SERVER_ADDRESS','env','161184XmjWoE','GET','end','fjUgX','../../helpers/testhub/constants','../../helpers/performance/constants','tmpdir','percy.log','CWIzV','close','KiZTE','child_process','DOWNLOAD','automate','../helper','../logger','LbErf','debug','pilmT','exports','GgxlS','percy/healthcheck','JeIxy','token','ZSetn','exec','flags','4pEEDPZ','createPercyConfig','112998Rrjweg','winstonLogger','projectName','&type=','start','vlcai','7pFBhhS','assign','exec:stop','533520XbFajs','Error\x20creating\x20percy\x20config:\x20','vMnBZ','2731825oMOvmf','170TfuCiP','ncDPY','../../helpers/performance/performance-tester','http://localhost:5338','ILkcN','percy.json','join','percyOptions','110205OoGxMX','error','isProcessRunning','fetchPercyToken','data','Percy\x20config\x20created\x20at\x20','app','version','api/app_percy/get_project_token?name='];a72_0x34a7=function(){return _0x323736;};return a72_0x34a7();}const fs=require('fs'),path=require(a72_0x359a83(0x104)),os=require('os'),{spawn}=require(a72_0x359a83(0x11f)),helper=require(a72_0x359a83(0xd0)),logger=require(a72_0x359a83(0xd1))[a72_0x359a83(0xe0)],{logDir}=require('../logger'),testHubConstants=require(a72_0x359a83(0x118)),PerformanceTester=require(a72_0x359a83(0xee)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x359a83(0x119)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a72_0x359a83(0xf2)](logDir,a72_0x359a83(0x11b));#address=process['env'][a72_0x359a83(0x112)]||a72_0x359a83(0xef);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x359a83(0xf6)]=![];constructor(_0x4b8a18){this.#config=_0x4b8a18,!!_0x4b8a18['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x21c73f=a72_0x359a83;if(!this.#binaryPath){const _0x593998=new PercyBinary();PerformanceTester[_0x21c73f(0xe3)](PerformanceEvents[_0x21c73f(0x120)]),this.#binaryPath=await _0x593998[_0x21c73f(0x109)](this.#config),PerformanceTester[_0x21c73f(0x116)](PerformanceEvents[_0x21c73f(0x120)]);}return this.#binaryPath;}async #sleep(_0x4934e1){return new Promise(_0x14b113=>setTimeout(_0x14b113,_0x4934e1));}async[a72_0x359a83(0x106)](){const _0x5a02eb=a72_0x359a83,_0x5419f6={};_0x5419f6[_0x5a02eb(0x11c)]=_0x5a02eb(0x115),_0x5419f6[_0x5a02eb(0xe4)]=_0x5a02eb(0xd7);const _0x57d28c=_0x5419f6;try{const _0x2bd767=await helper['nodeRequest'](_0x57d28c[_0x5a02eb(0x11c)],_0x57d28c[_0x5a02eb(0xe4)],null,null,this.#address);if(_0x2bd767)return!![];}catch(_0x4a8f0e){return![];}}async['start'](){const _0x344893=a72_0x359a83,_0x27cc1a={'pilmT':'app:exec','picti':_0x344893(0xdb),'fjUgX':function(_0x2f85ef,_0x54e4a1,_0x872de8,_0x2dfb88){return _0x2f85ef(_0x54e4a1,_0x872de8,_0x2dfb88);},'ZSetn':_0x344893(0x11d),'Wrquc':_0x344893(0x10e)},_0x5d91ca=await this.#getBinaryPath(),_0x180a5e={};_0x180a5e[_0x344893(0xdc)]='a';const _0x7eb548=fs[_0x344893(0x10a)](this.#logfile,_0x180a5e),_0x3d83e4=await this[_0x344893(0xf7)](),_0x102bc2=await this[_0x344893(0xde)]();if(!_0x3d83e4)return![];const _0x173d35=[(this.#isApp?_0x27cc1a[_0x344893(0xd4)]:_0x27cc1a['picti'])+':start'];_0x102bc2&&_0x173d35['push']('-c',_0x102bc2);this.#proc=_0x27cc1a[_0x344893(0x117)](spawn,_0x5d91ca,_0x173d35,{'env':Object[_0x344893(0xe6)](process['env'],{'PERCY_TOKEN':_0x3d83e4,'TH_BUILD_UUID':process[_0x344893(0x113)][testHubConstants['ENV_VAR'][_0x344893(0xfd)]]})}),this.#proc['stdout'][_0x344893(0xff)](_0x7eb548),this.#proc[_0x344893(0x108)][_0x344893(0xff)](_0x7eb548),this[_0x344893(0xf6)]=!![];var _0x9ccde6=this;this.#proc['on'](_0x27cc1a[_0x344893(0xda)],function(_0xc05925){const _0x1bd9e3=_0x344893;_0x9ccde6[_0x1bd9e3(0xf6)]=![];});do{const _0x4ee9b1=await this[_0x344893(0x106)]();if(_0x4ee9b1)return logger[_0x344893(0xd3)](_0x27cc1a[_0x344893(0xfe)]),!![];await this.#sleep(0x3e8);}while(this[_0x344893(0xf6)]);return![];}async['stop'](){const _0x484048=a72_0x359a83,_0x2d0e67={'KiZTE':function(_0x6775c7,_0x3db4d0){return _0x6775c7(_0x3db4d0);},'JeIxy':function(_0x2b2313,_0x41cf59,_0x28b81f){return _0x2b2313(_0x41cf59,_0x28b81f);},'wfjmE':_0x484048(0xe7),'LCErW':_0x484048(0x11d)},_0x51c155=await this.#getBinaryPath();return new Promise((_0x3fe573,_0x24c585)=>{const _0x4238cd=_0x484048,_0x556fe9=_0x2d0e67[_0x4238cd(0xd8)](spawn,_0x51c155,[_0x2d0e67[_0x4238cd(0x103)]]);_0x556fe9['on'](_0x2d0e67[_0x4238cd(0x10b)],_0x318f4a=>{const _0x2a1713=_0x4238cd;this[_0x2a1713(0xf6)]=![],_0x2d0e67[_0x2a1713(0x11e)](_0x3fe573,_0x318f4a);});});}[a72_0x359a83(0x107)](){const _0x5fbe8=a72_0x359a83;return this[_0x5fbe8(0xf6)];}async[a72_0x359a83(0xf7)](){const _0x4921f4=a72_0x359a83,_0x261757={};_0x261757[_0x4921f4(0x102)]=_0x4921f4(0xfa),_0x261757[_0x4921f4(0x10d)]=_0x4921f4(0x121),_0x261757[_0x4921f4(0xf0)]='GET',_0x261757['irbCP']=_0x4921f4(0x110);const _0x255724=_0x261757,_0x29e67a=this.#config[_0x4921f4(0xe1)];try{const _0x42203f=this.#isApp?_0x255724[_0x4921f4(0x102)]:_0x255724['vEpyI'],_0x3574be=await helper[_0x4921f4(0x10c)](_0x255724[_0x4921f4(0xf0)],_0x4921f4(0xfc)+_0x29e67a+_0x4921f4(0xe2)+_0x42203f,{},this.#config),_0x1e27be=_0x3574be[_0x4921f4(0xf8)];return logger[_0x4921f4(0xd3)](_0x255724['irbCP']),_0x1e27be[_0x4921f4(0xd9)];}catch(_0x343151){return logger[_0x4921f4(0xf5)](_0x4921f4(0x100)+_0x343151),null;}}async[a72_0x359a83(0xde)](){const _0xb9db10=a72_0x359a83,_0x27f69b={'PJlNh':function(_0x1413da,_0x12465c){return _0x1413da(_0x12465c);},'gtjzX':function(_0x138ca6,_0x11107d){return _0x138ca6+_0x11107d;},'DEUWF':_0xb9db10(0xf9),'vMnBZ':_0xb9db10(0xf1)};if(!this.#config[_0xb9db10(0xf3)])return null;const _0x3e47cd=path[_0xb9db10(0xf2)](os[_0xb9db10(0x11a)](),_0x27f69b[_0xb9db10(0xea)]),_0x339fdb=this.#config['percyOptions'];return!_0x339fdb[_0xb9db10(0xfb)]&&(_0x339fdb[_0xb9db10(0xfb)]='2'),new Promise((_0x548c01,_0x5a3822)=>{const _0x185a9e={'TBbKI':function(_0x563257,_0x5b82c8){const _0x19ad9c=a72_0xf0f1;return _0x27f69b[_0x19ad9c(0x105)](_0x563257,_0x5b82c8);},'GgxlS':function(_0x3976db,_0x15ee08){return _0x27f69b['gtjzX'](_0x3976db,_0x15ee08);},'ncDPY':_0x27f69b['DEUWF'],'LbErf':function(_0x35c647,_0x1b717c){const _0x4bd74f=a72_0xf0f1;return _0x27f69b[_0x4bd74f(0x105)](_0x35c647,_0x1b717c);}};fs['writeFile'](_0x3e47cd,JSON['stringify'](_0x339fdb),_0x58310c=>{const _0x57da44=a72_0xf0f1;_0x58310c&&(logger[_0x57da44(0xf5)](_0x57da44(0xe9)+_0x58310c),_0x185a9e[_0x57da44(0x111)](_0x548c01,null)),logger[_0x57da44(0xd3)](_0x185a9e[_0x57da44(0xd6)](_0x185a9e[_0x57da44(0xed)],_0x3e47cd)),_0x185a9e[_0x57da44(0xd2)](_0x548c01,_0x3e47cd);});});}}module[a72_0x359a83(0xd5)]=Percy;
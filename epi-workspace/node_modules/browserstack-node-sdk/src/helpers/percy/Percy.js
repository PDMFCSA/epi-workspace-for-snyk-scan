const a98_0x3ea404=a98_0x8437;(function(_0x2dcbed,_0x5343f6){const _0x7fcd98=a98_0x8437,_0x4fcb24=_0x2dcbed();while(!![]){try{const _0x289e41=-parseInt(_0x7fcd98(0x122))/0x1+parseInt(_0x7fcd98(0x101))/0x2*(parseInt(_0x7fcd98(0x121))/0x3)+-parseInt(_0x7fcd98(0x106))/0x4+parseInt(_0x7fcd98(0xff))/0x5*(-parseInt(_0x7fcd98(0xec))/0x6)+-parseInt(_0x7fcd98(0x124))/0x7+-parseInt(_0x7fcd98(0x103))/0x8+parseInt(_0x7fcd98(0x10f))/0x9;if(_0x289e41===_0x5343f6)break;else _0x4fcb24['push'](_0x4fcb24['shift']());}catch(_0x4c7e3f){_0x4fcb24['push'](_0x4fcb24['shift']());}}}(a98_0x2eb9,0x5e439));const fs=require('fs'),path=require(a98_0x3ea404(0xf9)),os=require('os'),{spawn}=require(a98_0x3ea404(0xf6)),helper=require(a98_0x3ea404(0x102)),logger=require(a98_0x3ea404(0xf0))['winstonLogger'],{getLogDir}=require(a98_0x3ea404(0xf0)),testHubConstants=require(a98_0x3ea404(0xed)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a98_0x3ea404(0x10b)),PercyBinary=require(a98_0x3ea404(0x10d));class Percy{#logfile=path[a98_0x3ea404(0xde)](getLogDir(),a98_0x3ea404(0x10a));#address=process[a98_0x3ea404(0xfd)][a98_0x3ea404(0xe3)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a98_0x3ea404(0x116)]=![];constructor(_0xf64efc){const _0x50cc48=a98_0x3ea404;this.#config=_0xf64efc,!!_0xf64efc[_0x50cc48(0x118)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x21c67e=a98_0x3ea404;if(!this.#binaryPath){const _0xd3d19d=new PercyBinary();PerformanceTester[_0x21c67e(0xe1)](PerformanceEvents[_0x21c67e(0xe2)]),this.#binaryPath=await _0xd3d19d[_0x21c67e(0x11c)](this.#config),PerformanceTester['end'](PerformanceEvents[_0x21c67e(0xe2)]);}return this.#binaryPath;}async #sleep(_0x30b786){return new Promise(_0x57c334=>setTimeout(_0x57c334,_0x30b786));}async[a98_0x3ea404(0xe7)](){const _0x1182c2=a98_0x3ea404,_0x559b35={};_0x559b35['GcrJz']='GET',_0x559b35['pnYUD']='percy/healthcheck';const _0x1b70b0=_0x559b35;try{const _0x4673e1=await helper[_0x1182c2(0xfe)](_0x1b70b0[_0x1182c2(0x108)],_0x1b70b0[_0x1182c2(0x12b)],null,null,this.#address);if(_0x4673e1)return!![];}catch(_0x84d4ff){return![];}}async[a98_0x3ea404(0xe1)](){const _0x232167=a98_0x3ea404,_0x3de427={'ySGWI':_0x232167(0x128),'DkMbW':_0x232167(0x117),'RVYeZ':function(_0x5e3bf0,_0x53fa65,_0x56efa1,_0x543511){return _0x5e3bf0(_0x53fa65,_0x56efa1,_0x543511);},'uPCrD':'close','KGqSZ':_0x232167(0x113)},_0x228794=await this.#getBinaryPath(),_0x2dcfd5={};_0x2dcfd5['flags']='a';const _0x5c7bf4=fs['createWriteStream'](this.#logfile,_0x2dcfd5),_0x4961b8=await this[_0x232167(0xf8)](),_0x49799c=await this[_0x232167(0x126)]();if(!_0x4961b8)return![];const _0x4c128c=[(this.#isApp?_0x3de427['ySGWI']:_0x3de427[_0x232167(0xf4)])+_0x232167(0x107)];_0x49799c&&_0x4c128c[_0x232167(0xea)]('-c',_0x49799c);this.#proc=_0x3de427[_0x232167(0x125)](spawn,_0x228794,_0x4c128c,{'env':Object[_0x232167(0xe4)](process[_0x232167(0xfd)],{'PERCY_TOKEN':_0x4961b8,'TH_BUILD_UUID':process['env'][testHubConstants[_0x232167(0xe6)][_0x232167(0xe8)]]})}),this.#proc[_0x232167(0xee)][_0x232167(0xeb)](_0x5c7bf4),this.#proc[_0x232167(0x129)][_0x232167(0xeb)](_0x5c7bf4),this['isProcessRunning']=!![];var _0x1aaeb7=this;this.#proc['on'](_0x3de427[_0x232167(0x110)],function(_0x410115){const _0x10cb97=_0x232167;_0x1aaeb7[_0x10cb97(0x116)]=![];});do{const _0x5edd73=await this[_0x232167(0xe7)]();if(_0x5edd73)return logger[_0x232167(0x105)](_0x3de427[_0x232167(0x120)]),!![];await this.#sleep(0x3e8);}while(this[_0x232167(0x116)]);return![];}async[a98_0x3ea404(0x11d)](){const _0x4669c2=a98_0x3ea404,_0x2e4fc0={'VEgda':function(_0x13f25e,_0x360e1e){return _0x13f25e(_0x360e1e);},'fYMZG':function(_0x51b9b6,_0x3c210b,_0x295cd4){return _0x51b9b6(_0x3c210b,_0x295cd4);},'wiJvd':_0x4669c2(0x10e),'vqsbF':_0x4669c2(0xf2)},_0x410ed7=await this.#getBinaryPath();return new Promise((_0x26408a,_0x2c0a19)=>{const _0x3324f9=_0x4669c2,_0x38ee39=_0x2e4fc0[_0x3324f9(0xf7)](spawn,_0x410ed7,[_0x2e4fc0[_0x3324f9(0x12a)]]);_0x38ee39['on'](_0x2e4fc0[_0x3324f9(0xf5)],_0x5d7e97=>{const _0x2819bd=_0x3324f9;this[_0x2819bd(0x116)]=![],_0x2e4fc0[_0x2819bd(0x100)](_0x26408a,_0x5d7e97);});});}['isRunning'](){const _0x4be905=a98_0x3ea404;return this[_0x4be905(0x116)];}async[a98_0x3ea404(0xf8)](){const _0x22672e=a98_0x3ea404,_0x305d33={};_0x305d33[_0x22672e(0x11b)]='app',_0x305d33['zBpzj']=_0x22672e(0x11e),_0x305d33[_0x22672e(0x123)]='GET',_0x305d33[_0x22672e(0xe5)]=_0x22672e(0x127);const _0x13a29f=_0x305d33,_0x3532b4=this.#config[_0x22672e(0xe9)];try{const _0x309f62=this.#isApp?_0x13a29f[_0x22672e(0x11b)]:_0x13a29f[_0x22672e(0xf3)],_0x2fa09a=await helper[_0x22672e(0xfe)](_0x13a29f[_0x22672e(0x123)],_0x22672e(0x111)+_0x3532b4+_0x22672e(0xfa)+_0x309f62,{},this.#config),_0x59ac1f=_0x2fa09a[_0x22672e(0xfc)];return logger[_0x22672e(0x105)](_0x13a29f[_0x22672e(0xe5)]),_0x59ac1f[_0x22672e(0x11f)];}catch(_0x2610b6){return logger['error'](_0x22672e(0xfb)+_0x2610b6),null;}}async[a98_0x3ea404(0x126)](){const _0x551907=a98_0x3ea404,_0x45cf16={'kpWMo':function(_0x1c0693,_0x3b4ca){return _0x1c0693(_0x3b4ca);},'oSlxj':function(_0x58f246,_0x1aa35f){return _0x58f246+_0x1aa35f;},'vgVef':_0x551907(0xe0),'txcoE':function(_0x6f2ab7,_0x89a50b){return _0x6f2ab7(_0x89a50b);},'KBjFx':'percy.json'};if(!this.#config['percyOptions'])return null;const _0x5a30c8=path[_0x551907(0xde)](os[_0x551907(0x11a)](),_0x45cf16[_0x551907(0xf1)]),_0x1c2c31=this.#config[_0x551907(0x119)];return!_0x1c2c31[_0x551907(0x104)]&&(_0x1c2c31['version']='2'),new Promise((_0x52acfb,_0x128227)=>{const _0x1b58c9=_0x551907;fs[_0x1b58c9(0x115)](_0x5a30c8,JSON['stringify'](_0x1c2c31),_0x2c1174=>{const _0x1592e3=_0x1b58c9;_0x2c1174&&(logger[_0x1592e3(0x109)](_0x1592e3(0xef)+_0x2c1174),_0x45cf16[_0x1592e3(0x114)](_0x52acfb,null)),logger[_0x1592e3(0x105)](_0x45cf16['oSlxj'](_0x45cf16[_0x1592e3(0x112)],_0x5a30c8)),_0x45cf16[_0x1592e3(0x10c)](_0x52acfb,_0x5a30c8);});});}}function a98_0x2eb9(){const _0x3b6742=['stdout','Error\x20creating\x20percy\x20config:\x20','../logger','KBjFx','close','zBpzj','DkMbW','vqsbF','child_process','fYMZG','fetchPercyToken','path','&type=','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','data','env','nodeRequest','10WnyIzm','VEgda','16792KcFlfv','../helper','3465640DkDfzx','version','debug','2769460FWAuil',':start','GcrJz','error','percy.log','../../helpers/performance/constants','txcoE','./PercyBinary','exec:stop','18632160rodUDS','uPCrD','api/app_percy/get_project_token?name=','vgVef','Percy\x20healthcheck\x20successful','kpWMo','writeFile','isProcessRunning','exec','app','percyOptions','tmpdir','zlvPt','getBinaryPath','stop','automate','token','KGqSZ','123FMABkk','21308PrVDmd','twBrE','4318993EtlDzx','RVYeZ','createPercyConfig','Percy\x20fetch\x20token\x20success','app:exec','stderr','wiJvd','pnYUD','join','exports','Percy\x20config\x20created\x20at\x20','start','DOWNLOAD','PERCY_SERVER_ADDRESS','assign','QAstW','ENV_VAR','healthcheck','BROWSERSTACK_TESTHUB_UUID','projectName','push','pipe','793482cIPdtT','../../helpers/testhub/constants'];a98_0x2eb9=function(){return _0x3b6742;};return a98_0x2eb9();}function a98_0x8437(_0x2a5125,_0x34c793){const _0x2eb90a=a98_0x2eb9();return a98_0x8437=function(_0x8437f0,_0x3402b6){_0x8437f0=_0x8437f0-0xde;let _0x4ded0c=_0x2eb90a[_0x8437f0];return _0x4ded0c;},a98_0x8437(_0x2a5125,_0x34c793);}module[a98_0x3ea404(0xdf)]=Percy;
const a109_0x1d4a49=a109_0x1c28;function a109_0x1c28(_0x3be0b2,_0x4bb862){const _0x638e79=a109_0x638e();return a109_0x1c28=function(_0x1c288a,_0x4adfb5){_0x1c288a=_0x1c288a-0x98;let _0x175c98=_0x638e79[_0x1c288a];return _0x175c98;},a109_0x1c28(_0x3be0b2,_0x4bb862);}(function(_0x5c6cb5,_0x804161){const _0x3732f9=a109_0x1c28,_0x3bde30=_0x5c6cb5();while(!![]){try{const _0x1c0ad0=-parseInt(_0x3732f9(0xad))/0x1*(-parseInt(_0x3732f9(0xc9))/0x2)+-parseInt(_0x3732f9(0xdd))/0x3+parseInt(_0x3732f9(0xe3))/0x4*(-parseInt(_0x3732f9(0xc3))/0x5)+-parseInt(_0x3732f9(0xb0))/0x6*(parseInt(_0x3732f9(0x98))/0x7)+-parseInt(_0x3732f9(0xbd))/0x8*(-parseInt(_0x3732f9(0x9c))/0x9)+-parseInt(_0x3732f9(0xde))/0xa*(-parseInt(_0x3732f9(0xaa))/0xb)+-parseInt(_0x3732f9(0xcb))/0xc;if(_0x1c0ad0===_0x804161)break;else _0x3bde30['push'](_0x3bde30['shift']());}catch(_0xeedfef){_0x3bde30['push'](_0x3bde30['shift']());}}}(a109_0x638e,0xd05bf));const fs=require('fs'),path=require(a109_0x1d4a49(0x9f)),os=require('os'),{spawn}=require(a109_0x1d4a49(0xc4)),helper=require(a109_0x1d4a49(0x9d)),logger=require(a109_0x1d4a49(0xd9))['winstonLogger'],{getLogDir}=require('../logger'),testHubConstants=require(a109_0x1d4a49(0x9a)),PerformanceTester=require(a109_0x1d4a49(0xce)),{PERCY_EVENTS:PerformanceEvents}=require(a109_0x1d4a49(0xc7)),PercyBinary=require(a109_0x1d4a49(0xdb));function a109_0x638e(){const _0x5aa8f7=['hGFDS','10501JFuNdr','app','Error\x20creating\x20percy\x20config:\x20','12TBAGQb','Percy\x20healthcheck\x20successful','&type=','writeFile','version','pHWSH','oPhIk','http://localhost:5338','ENV_VAR','debug','olinM','close','Percy\x20config\x20created\x20at\x20','147240SApVuA','percy/healthcheck','zaZUH','nzQFR','CUkTG','api/app_percy/get_project_token?name=','72755lrPDjO','child_process','isProcessRunning','nodeRequest','../../helpers/performance/constants','KFQAd','324rcSuxk','healthcheck','7323444KsxdUG','inZAM','percy.log','../../helpers/performance/performance-tester','DOWNLOAD','join','exports','PERCY_SERVER_ADDRESS','SQVdA','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','exec:stop','DgAaI',':start','env','../logger','error','./PercyBinary','LxBEa','2595942yVOzFl','7040DyJnQa','flags','YvPqM','percyOptions','createPercyConfig','260nlHLGv','BROWSERSTACK_TESTHUB_UUID','630273bGmcPR','GET','../../helpers/testhub/constants','fetchPercyToken','135sOcHTb','../helper','data','path','tmpdir','app:exec','stringify','Percy\x20fetch\x20token\x20success','token','end','stdout','CNhJQ','start','pipe','23089pxfnbd','assign'];a109_0x638e=function(){return _0x5aa8f7;};return a109_0x638e();}class Percy{#logfile=path[a109_0x1d4a49(0xd0)](getLogDir(),a109_0x1d4a49(0xcd));#address=process['env'][a109_0x1d4a49(0xd2)]||a109_0x1d4a49(0xb7);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a109_0x1d4a49(0xc5)]=![];constructor(_0xf09f44){this.#config=_0xf09f44,!!_0xf09f44['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x8bc629=a109_0x1d4a49;if(!this.#binaryPath){const _0x258419=new PercyBinary();PerformanceTester[_0x8bc629(0xa8)](PerformanceEvents[_0x8bc629(0xcf)]),this.#binaryPath=await _0x258419['getBinaryPath'](this.#config),PerformanceTester[_0x8bc629(0xa5)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x5397db){return new Promise(_0xb54edd=>setTimeout(_0xb54edd,_0x5397db));}async[a109_0x1d4a49(0xca)](){const _0x57f403=a109_0x1d4a49,_0x539195={};_0x539195[_0x57f403(0xd6)]=_0x57f403(0x99),_0x539195[_0x57f403(0xc1)]=_0x57f403(0xbe);const _0x2dfee7=_0x539195;try{const _0x4e6f29=await helper[_0x57f403(0xc6)](_0x2dfee7[_0x57f403(0xd6)],_0x2dfee7['CUkTG'],null,null,this.#address);if(_0x4e6f29)return!![];}catch(_0x4df2a2){return![];}}async['start'](){const _0x4cbe64=a109_0x1d4a49,_0x4793e7={'olinM':_0x4cbe64(0xa1),'ccuqg':'exec','nzQFR':function(_0x5486e3,_0x46f9e4,_0x1742c2,_0x4afa1b){return _0x5486e3(_0x46f9e4,_0x1742c2,_0x4afa1b);},'inZAM':'close','deAMr':_0x4cbe64(0xb1)},_0x2782b3=await this.#getBinaryPath(),_0x4ef67c={};_0x4ef67c[_0x4cbe64(0xdf)]='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x4ef67c);const _0xa8e75c=await this[_0x4cbe64(0x9b)](),_0x17a9a1=await this['createPercyConfig']();if(!_0xa8e75c)return![];const _0x41f977=[(this.#isApp?_0x4793e7[_0x4cbe64(0xba)]:_0x4793e7['ccuqg'])+_0x4cbe64(0xd7)];_0x17a9a1&&_0x41f977['push']('-c',_0x17a9a1);this.#proc=_0x4793e7[_0x4cbe64(0xc0)](spawn,_0x2782b3,_0x41f977,{'env':Object[_0x4cbe64(0xab)](process[_0x4cbe64(0xd8)],{'PERCY_TOKEN':_0xa8e75c,'TH_BUILD_UUID':process[_0x4cbe64(0xd8)][testHubConstants[_0x4cbe64(0xb8)][_0x4cbe64(0xe4)]]})}),this.#proc[_0x4cbe64(0xa6)][_0x4cbe64(0xa9)](this.#logStream),this.#proc['stderr'][_0x4cbe64(0xa9)](this.#logStream),this[_0x4cbe64(0xc5)]=!![];var _0x3f333b=this;this.#proc['on'](_0x4793e7[_0x4cbe64(0xcc)],function(_0x211f2a){const _0x9a7dce=_0x4cbe64;_0x3f333b[_0x9a7dce(0xc5)]=![];});do{const _0x2285ff=await this[_0x4cbe64(0xca)]();if(_0x2285ff)return logger[_0x4cbe64(0xb9)](_0x4793e7['deAMr']),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async['stop'](){const _0xa2e072=a109_0x1d4a49,_0x16be2d={'AyJZb':function(_0x2654f4,_0x915233){return _0x2654f4(_0x915233);},'CAtZJ':function(_0x140643,_0x12373d,_0x6e3911){return _0x140643(_0x12373d,_0x6e3911);},'qgdSk':_0xa2e072(0xd5),'pHWSH':_0xa2e072(0xbb)},_0x1f157d=await this.#getBinaryPath();return new Promise((_0x5331c6,_0x30741b)=>{const _0x190bb4=_0xa2e072,_0x3c1c97={'CNhJQ':function(_0x53d9d9,_0x5be282){return _0x16be2d['AyJZb'](_0x53d9d9,_0x5be282);}},_0x2d0c41=_0x16be2d['CAtZJ'](spawn,_0x1f157d,[_0x16be2d['qgdSk']]);_0x2d0c41['on'](_0x16be2d[_0x190bb4(0xb5)],_0xc83396=>{const _0xf8f2c7=_0x190bb4;this[_0xf8f2c7(0xc5)]=![],this.#logStream&&(this.#logStream[_0xf8f2c7(0xa5)](),this.#logStream=null),_0x3c1c97[_0xf8f2c7(0xa7)](_0x5331c6,_0xc83396);});});}['isRunning'](){const _0x173a5e=a109_0x1d4a49;return this[_0x173a5e(0xc5)];}async['fetchPercyToken'](){const _0x5188bf=a109_0x1d4a49,_0x9a9be2={};_0x9a9be2['hGFDS']=_0x5188bf(0xae),_0x9a9be2[_0x5188bf(0xdc)]='automate',_0x9a9be2['SQVdA']='GET',_0x9a9be2[_0x5188bf(0xb6)]=_0x5188bf(0xa3);const _0x578e4d=_0x9a9be2,_0x3c3454=this.#config['projectName'];try{const _0x45176d=this.#isApp?_0x578e4d[_0x5188bf(0xac)]:_0x578e4d[_0x5188bf(0xdc)],_0x4d8fa8=await helper[_0x5188bf(0xc6)](_0x578e4d[_0x5188bf(0xd3)],_0x5188bf(0xc2)+_0x3c3454+_0x5188bf(0xb2)+_0x45176d,{},this.#config),_0x11e0b7=_0x4d8fa8[_0x5188bf(0x9e)];return logger[_0x5188bf(0xb9)](_0x578e4d['oPhIk']),_0x11e0b7[_0x5188bf(0xa4)];}catch(_0x58d148){return logger[_0x5188bf(0xda)](_0x5188bf(0xd4)+_0x58d148),null;}}async[a109_0x1d4a49(0xe2)](){const _0x5d2bde=a109_0x1d4a49,_0x1016db={'zaZUH':function(_0x387408,_0x16afd8){return _0x387408(_0x16afd8);},'YvPqM':function(_0x156058,_0x51c7f8){return _0x156058+_0x51c7f8;},'ObOOr':_0x5d2bde(0xbc),'KFQAd':'percy.json'};if(!this.#config[_0x5d2bde(0xe1)])return null;const _0x1fc066=path['join'](os[_0x5d2bde(0xa0)](),_0x1016db[_0x5d2bde(0xc8)]),_0x2b9f35=this.#config[_0x5d2bde(0xe1)];return!_0x2b9f35[_0x5d2bde(0xb4)]&&(_0x2b9f35['version']='2'),new Promise((_0x4231a6,_0x2d7871)=>{const _0x2eda62=_0x5d2bde;fs[_0x2eda62(0xb3)](_0x1fc066,JSON[_0x2eda62(0xa2)](_0x2b9f35),_0x42d26c=>{const _0x7968c4=_0x2eda62;_0x42d26c&&(logger['error'](_0x7968c4(0xaf)+_0x42d26c),_0x1016db['zaZUH'](_0x4231a6,null)),logger[_0x7968c4(0xb9)](_0x1016db[_0x7968c4(0xe0)](_0x1016db['ObOOr'],_0x1fc066)),_0x1016db[_0x7968c4(0xbf)](_0x4231a6,_0x1fc066);});});}}module[a109_0x1d4a49(0xd1)]=Percy;
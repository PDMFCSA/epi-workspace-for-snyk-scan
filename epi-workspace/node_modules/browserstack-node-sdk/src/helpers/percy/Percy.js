const a113_0x38c2fe=a113_0x3bee;(function(_0x46a536,_0xc3eca7){const _0x2771f7=a113_0x3bee,_0x3e5672=_0x46a536();while(!![]){try{const _0x3a7171=-parseInt(_0x2771f7(0x16f))/0x1*(parseInt(_0x2771f7(0x15d))/0x2)+parseInt(_0x2771f7(0x165))/0x3+-parseInt(_0x2771f7(0x143))/0x4*(parseInt(_0x2771f7(0x13e))/0x5)+-parseInt(_0x2771f7(0x13b))/0x6+-parseInt(_0x2771f7(0x16b))/0x7*(parseInt(_0x2771f7(0x157))/0x8)+parseInt(_0x2771f7(0x168))/0x9+parseInt(_0x2771f7(0x15b))/0xa;if(_0x3a7171===_0xc3eca7)break;else _0x3e5672['push'](_0x3e5672['shift']());}catch(_0x4753e0){_0x3e5672['push'](_0x3e5672['shift']());}}}(a113_0x4bff,0xc180e));function a113_0x3bee(_0x408403,_0x35e3fa){const _0x4bff7a=a113_0x4bff();return a113_0x3bee=function(_0x3bee08,_0x411133){_0x3bee08=_0x3bee08-0x132;let _0x431577=_0x4bff7a[_0x3bee08];return _0x431577;},a113_0x3bee(_0x408403,_0x35e3fa);}function a113_0x4bff(){const _0xa22ac8=['stop','bhQbB','iQiIz','137716PqHqlb','AEsvI','env','assign','fetchPercyToken','gZycI','QfgZa','error','nodeRequest','GET','pipe','version','push','./PercyBinary','exports','flags','percyOptions','&type=','exec:stop','PERCY_SERVER_ADDRESS','2404856UIBZVD','path','end','debug','16654920FCmByg','automate','4krwWjY','UwsuD','xfatc','JJwSo','fQobg','../../helpers/performance/performance-tester','createWriteStream','winstonLogger','962115bhDLzS','isProcessRunning','close','12497265LxyXmg','AIxSk','healthcheck','14HowOyD','KpbRO','percy.json','etsGZ','173325vbBerW','uPhTY','oqNmk','tmpdir','token','isRunning','Percy\x20fetch\x20token\x20success','ENV_VAR','stdout','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','sevFl','child_process','projectName','app:exec','percy/healthcheck','../../helpers/testhub/constants','http://localhost:5338','NkSbo','join','SfMrA','DOWNLOAD','app','createPercyConfig','../logger','NsUnD','Error\x20creating\x20percy\x20config:\x20','DYfTP','GaNqi','7120506ltrqlN','percy.log','data','65JtoOjE','OOQKW'];a113_0x4bff=function(){return _0xa22ac8;};return a113_0x4bff();}const fs=require('fs'),path=require(a113_0x38c2fe(0x158)),os=require('os'),{spawn}=require(a113_0x38c2fe(0x17a)),helper=require('../helper'),logger=require(a113_0x38c2fe(0x136))[a113_0x38c2fe(0x164)],{getLogDir}=require(a113_0x38c2fe(0x136)),testHubConstants=require(a113_0x38c2fe(0x17e)),PerformanceTester=require(a113_0x38c2fe(0x162)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a113_0x38c2fe(0x150));class Percy{#logfile=path[a113_0x38c2fe(0x181)](getLogDir(),a113_0x38c2fe(0x13c));#address=process[a113_0x38c2fe(0x145)][a113_0x38c2fe(0x156)]||a113_0x38c2fe(0x17f);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a113_0x38c2fe(0x166)]=![];constructor(_0x597194){this.#config=_0x597194,!!_0x597194['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x5dda7d=a113_0x38c2fe;if(!this.#binaryPath){const _0x10e465=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x5dda7d(0x133)]),this.#binaryPath=await _0x10e465['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents[_0x5dda7d(0x133)]);}return this.#binaryPath;}async #sleep(_0x594667){return new Promise(_0x44aa83=>setTimeout(_0x44aa83,_0x594667));}async[a113_0x38c2fe(0x16a)](){const _0xb8d2be=a113_0x38c2fe,_0x2e762d={};_0x2e762d[_0xb8d2be(0x144)]=_0xb8d2be(0x14c),_0x2e762d['DYfTP']=_0xb8d2be(0x17d);const _0x437433=_0x2e762d;try{const _0x4fbb9f=await helper[_0xb8d2be(0x14b)](_0x437433[_0xb8d2be(0x144)],_0x437433[_0xb8d2be(0x139)],null,null,this.#address);if(_0x4fbb9f)return!![];}catch(_0x3d4eab){return![];}}async['start'](){const _0x45c7c3=a113_0x38c2fe,_0x4b9ff1={'AIxSk':_0x45c7c3(0x17c),'sevFl':'exec','gZycI':function(_0x1b1397,_0x3d4035,_0x31e24b,_0xf46a06){return _0x1b1397(_0x3d4035,_0x31e24b,_0xf46a06);},'NsUnD':_0x45c7c3(0x167),'GaNqi':'Percy\x20healthcheck\x20successful'},_0x289c59=await this.#getBinaryPath(),_0x1ff205={};_0x1ff205[_0x45c7c3(0x152)]='a',this.#logStream=fs[_0x45c7c3(0x163)](this.#logfile,_0x1ff205);const _0x35b9f6=await this['fetchPercyToken'](),_0x2a2b87=await this[_0x45c7c3(0x135)]();if(!_0x35b9f6)return![];const _0x2fcbf7=[(this.#isApp?_0x4b9ff1[_0x45c7c3(0x169)]:_0x4b9ff1[_0x45c7c3(0x179)])+':start'];_0x2a2b87&&_0x2fcbf7[_0x45c7c3(0x14f)]('-c',_0x2a2b87);this.#proc=_0x4b9ff1[_0x45c7c3(0x148)](spawn,_0x289c59,_0x2fcbf7,{'env':Object[_0x45c7c3(0x146)](process[_0x45c7c3(0x145)],{'PERCY_TOKEN':_0x35b9f6,'TH_BUILD_UUID':process[_0x45c7c3(0x145)][testHubConstants[_0x45c7c3(0x176)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x45c7c3(0x177)][_0x45c7c3(0x14d)](this.#logStream),this.#proc['stderr'][_0x45c7c3(0x14d)](this.#logStream),this['isProcessRunning']=!![];var _0x35b152=this;this.#proc['on'](_0x4b9ff1[_0x45c7c3(0x137)],function(_0x5af7cc){_0x35b152['isProcessRunning']=![];});do{const _0x22978f=await this[_0x45c7c3(0x16a)]();if(_0x22978f)return logger[_0x45c7c3(0x15a)](_0x4b9ff1[_0x45c7c3(0x13a)]),!![];await this.#sleep(0x3e8);}while(this[_0x45c7c3(0x166)]);return![];}async[a113_0x38c2fe(0x140)](){const _0x329a2d=a113_0x38c2fe,_0xad457c={'rbtRz':function(_0x11b6cf,_0x2be1a){return _0x11b6cf(_0x2be1a);},'xfatc':function(_0x163ab1,_0x47a3e1,_0x5c3a93){return _0x163ab1(_0x47a3e1,_0x5c3a93);},'SfMrA':_0x329a2d(0x155),'hqMCo':'close'},_0x196070=await this.#getBinaryPath();return new Promise((_0x1688dd,_0x9bf064)=>{const _0x97ebd6=_0x329a2d,_0x3340fb={'iQiIz':function(_0xacba38,_0x54788b){return _0xad457c['rbtRz'](_0xacba38,_0x54788b);}},_0x5a6701=_0xad457c[_0x97ebd6(0x15f)](spawn,_0x196070,[_0xad457c[_0x97ebd6(0x132)]]);_0x5a6701['on'](_0xad457c['hqMCo'],_0x4975b5=>{const _0x5692c3=_0x97ebd6;this[_0x5692c3(0x166)]=![],this.#logStream&&(this.#logStream[_0x5692c3(0x159)](),this.#logStream=null),_0x3340fb[_0x5692c3(0x142)](_0x1688dd,_0x4975b5);});});}[a113_0x38c2fe(0x174)](){return this['isProcessRunning'];}async[a113_0x38c2fe(0x147)](){const _0x1bd9fd=a113_0x38c2fe,_0x160b4c={};_0x160b4c[_0x1bd9fd(0x180)]=_0x1bd9fd(0x134),_0x160b4c[_0x1bd9fd(0x149)]=_0x1bd9fd(0x15c),_0x160b4c['mSryc']=_0x1bd9fd(0x14c),_0x160b4c[_0x1bd9fd(0x16e)]=_0x1bd9fd(0x175);const _0x477207=_0x160b4c,_0x38bd70=this.#config[_0x1bd9fd(0x17b)];try{const _0x4ed439=this.#isApp?_0x477207['NkSbo']:_0x477207[_0x1bd9fd(0x149)],_0x1f8383=await helper[_0x1bd9fd(0x14b)](_0x477207['mSryc'],'api/app_percy/get_project_token?name='+_0x38bd70+_0x1bd9fd(0x154)+_0x4ed439,{},this.#config),_0x545328=_0x1f8383[_0x1bd9fd(0x13d)];return logger[_0x1bd9fd(0x15a)](_0x477207[_0x1bd9fd(0x16e)]),_0x545328[_0x1bd9fd(0x173)];}catch(_0x2dae96){return logger[_0x1bd9fd(0x14a)](_0x1bd9fd(0x178)+_0x2dae96),null;}}async[a113_0x38c2fe(0x135)](){const _0x305ff7=a113_0x38c2fe,_0x5483e6={'bhQbB':function(_0x576c64,_0x577439){return _0x576c64(_0x577439);},'fQobg':function(_0xe70724,_0x1e30e1){return _0xe70724+_0x1e30e1;},'KpbRO':'Percy\x20config\x20created\x20at\x20','UwsuD':_0x305ff7(0x16d)};if(!this.#config['percyOptions'])return null;const _0x589d03=path['join'](os[_0x305ff7(0x172)](),_0x5483e6[_0x305ff7(0x15e)]),_0x2e5af5=this.#config[_0x305ff7(0x153)];return!_0x2e5af5[_0x305ff7(0x14e)]&&(_0x2e5af5[_0x305ff7(0x14e)]='2'),new Promise((_0x12d02a,_0x4bb3d9)=>{const _0x21405d=_0x305ff7,_0x30cbbd={'uPhTY':function(_0x5e66e5,_0x145bab){const _0x16949d=a113_0x3bee;return _0x5483e6[_0x16949d(0x141)](_0x5e66e5,_0x145bab);},'oqNmk':function(_0x5bb81c,_0x23d8a4){const _0x148b00=a113_0x3bee;return _0x5483e6[_0x148b00(0x161)](_0x5bb81c,_0x23d8a4);},'OOQKW':_0x5483e6[_0x21405d(0x16c)],'JJwSo':function(_0x2b8832,_0x31e0dc){const _0x3b6aeb=_0x21405d;return _0x5483e6[_0x3b6aeb(0x141)](_0x2b8832,_0x31e0dc);}};fs['writeFile'](_0x589d03,JSON['stringify'](_0x2e5af5),_0x1cbba0=>{const _0x5c73f0=_0x21405d;_0x1cbba0&&(logger[_0x5c73f0(0x14a)](_0x5c73f0(0x138)+_0x1cbba0),_0x30cbbd[_0x5c73f0(0x170)](_0x12d02a,null)),logger['debug'](_0x30cbbd[_0x5c73f0(0x171)](_0x30cbbd[_0x5c73f0(0x13f)],_0x589d03)),_0x30cbbd[_0x5c73f0(0x160)](_0x12d02a,_0x589d03);});});}}module[a113_0x38c2fe(0x151)]=Percy;
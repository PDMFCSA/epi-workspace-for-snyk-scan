function a113_0xe63f(_0x4f174d,_0x1af591){const _0x1db970=a113_0x1db9();return a113_0xe63f=function(_0xe63fb8,_0x130b87){_0xe63fb8=_0xe63fb8-0x1ba;let _0x5b073c=_0x1db970[_0xe63fb8];return _0x5b073c;},a113_0xe63f(_0x4f174d,_0x1af591);}const a113_0x568119=a113_0xe63f;(function(_0x4f3afd,_0x37df60){const _0x133f1c=a113_0xe63f,_0x341bac=_0x4f3afd();while(!![]){try{const _0x28108d=-parseInt(_0x133f1c(0x202))/0x1*(parseInt(_0x133f1c(0x1dc))/0x2)+-parseInt(_0x133f1c(0x20b))/0x3*(-parseInt(_0x133f1c(0x1f1))/0x4)+parseInt(_0x133f1c(0x1db))/0x5*(-parseInt(_0x133f1c(0x208))/0x6)+parseInt(_0x133f1c(0x1d1))/0x7*(parseInt(_0x133f1c(0x1cf))/0x8)+parseInt(_0x133f1c(0x1bd))/0x9*(-parseInt(_0x133f1c(0x1df))/0xa)+-parseInt(_0x133f1c(0x1ca))/0xb*(-parseInt(_0x133f1c(0x1d0))/0xc)+parseInt(_0x133f1c(0x1cc))/0xd;if(_0x28108d===_0x37df60)break;else _0x341bac['push'](_0x341bac['shift']());}catch(_0x89afa9){_0x341bac['push'](_0x341bac['shift']());}}}(a113_0x1db9,0x911ee));function a113_0x1db9(){const _0x3340a0=['1142199UPnYhA','JsIxb','createPercyConfig','join','../../helpers/performance/constants','end','api/app_percy/get_project_token?name=','WKvHS','fetchPercyToken','tzflf','BROWSERSTACK_TESTHUB_UUID','nodeRequest','FQyZU','994180TcBDvg','QIydq','23121657lOOlZN','ZTgtE','close','3165752hIgMKh','60SWrVRT','21rLDSdS','app:exec','iyGNe','eyLpi','isProcessRunning','Percy\x20fetch\x20token\x20success','push','version','../../helpers/testhub/constants','percyOptions','5ymWwEz','8wKicTD','percy.json','isRunning','70aYpIzV','assign','GET','exec:stop','percy.log','DOWNLOAD','Percy\x20healthcheck\x20successful','projectName','pipe','healthcheck','data','epGjk','hBVlO',':start','debug','fOcgs','env','child_process','752620cZSCRR','fRjHE','../logger','zsnGJ','yojsj','ENV_VAR','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','exports','automate','./PercyBinary','../../helpers/performance/performance-tester','Percy\x20config\x20created\x20at\x20','&type=','uCaIO','HxcFr','http://localhost:5338','flags','282027tWhtSl','start','writeFile','WhdNl','app','YcnOU','7098342BnlHAp','percy/healthcheck','stop','6noKGqN','tmpdir','winstonLogger','Error\x20creating\x20percy\x20config:\x20','stringify'];a113_0x1db9=function(){return _0x3340a0;};return a113_0x1db9();}const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a113_0x568119(0x1f0)),helper=require('../helper'),logger=require(a113_0x568119(0x1f3))[a113_0x568119(0x1ba)],{getLogDir}=require('../logger'),testHubConstants=require(a113_0x568119(0x1d9)),PerformanceTester=require(a113_0x568119(0x1fb)),{PERCY_EVENTS:PerformanceEvents}=require(a113_0x568119(0x1c1)),PercyBinary=require(a113_0x568119(0x1fa));class Percy{#logfile=path[a113_0x568119(0x1c0)](getLogDir(),a113_0x568119(0x1e3));#address=process[a113_0x568119(0x1ef)]['PERCY_SERVER_ADDRESS']||a113_0x568119(0x200);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a113_0x568119(0x1d5)]=![];constructor(_0x486cbd){const _0x2ad772=a113_0x568119;this.#config=_0x486cbd,!!_0x486cbd[_0x2ad772(0x206)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x34628f=a113_0x568119;if(!this.#binaryPath){const _0x405b58=new PercyBinary();PerformanceTester[_0x34628f(0x203)](PerformanceEvents[_0x34628f(0x1e4)]),this.#binaryPath=await _0x405b58['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents[_0x34628f(0x1e4)]);}return this.#binaryPath;}async #sleep(_0x35e357){return new Promise(_0x112856=>setTimeout(_0x112856,_0x35e357));}async[a113_0x568119(0x1e8)](){const _0x3049c4=a113_0x568119,_0x224be4={};_0x224be4[_0x3049c4(0x1ea)]=_0x3049c4(0x1e1),_0x224be4[_0x3049c4(0x1c6)]=_0x3049c4(0x209);const _0x47efe8=_0x224be4;try{const _0x44ca66=await helper[_0x3049c4(0x1c8)](_0x47efe8[_0x3049c4(0x1ea)],_0x47efe8[_0x3049c4(0x1c6)],null,null,this.#address);if(_0x44ca66)return!![];}catch(_0x2209a1){return![];}}async[a113_0x568119(0x203)](){const _0x287043=a113_0x568119,_0x385e3f={'fuCbG':_0x287043(0x1d2),'RvLMU':'exec','yojsj':function(_0x3d5310,_0x39568a,_0x3504ac,_0x5ec05e){return _0x3d5310(_0x39568a,_0x3504ac,_0x5ec05e);},'uCaIO':_0x287043(0x1ce),'YcnOU':_0x287043(0x1e5)},_0x5a48fc=await this.#getBinaryPath(),_0x1370ee={};_0x1370ee[_0x287043(0x201)]='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x1370ee);const _0x3fffce=await this[_0x287043(0x1c5)](),_0x28930e=await this[_0x287043(0x1bf)]();if(!_0x3fffce)return![];const _0x2c6df4=[(this.#isApp?_0x385e3f['fuCbG']:_0x385e3f['RvLMU'])+_0x287043(0x1ec)];_0x28930e&&_0x2c6df4[_0x287043(0x1d7)]('-c',_0x28930e);this.#proc=_0x385e3f[_0x287043(0x1f5)](spawn,_0x5a48fc,_0x2c6df4,{'env':Object[_0x287043(0x1e0)](process[_0x287043(0x1ef)],{'PERCY_TOKEN':_0x3fffce,'TH_BUILD_UUID':process[_0x287043(0x1ef)][testHubConstants[_0x287043(0x1f6)][_0x287043(0x1c7)]]})}),this.#proc['stdout'][_0x287043(0x1e7)](this.#logStream),this.#proc['stderr']['pipe'](this.#logStream),this['isProcessRunning']=!![];var _0x4218c4=this;this.#proc['on'](_0x385e3f[_0x287043(0x1fe)],function(_0x63f823){const _0x3304a2=_0x287043;_0x4218c4[_0x3304a2(0x1d5)]=![];});do{const _0x5ef249=await this[_0x287043(0x1e8)]();if(_0x5ef249)return logger['debug'](_0x385e3f[_0x287043(0x207)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a113_0x568119(0x20a)](){const _0x4dc14c=a113_0x568119,_0x3a8f80={'FbIPI':function(_0x193fdc,_0x2601d8){return _0x193fdc(_0x2601d8);},'hBVlO':function(_0x126449,_0x2dbbe2,_0x581a05){return _0x126449(_0x2dbbe2,_0x581a05);},'fRjHE':_0x4dc14c(0x1e2),'ADthM':_0x4dc14c(0x1ce)},_0xa49f19=await this.#getBinaryPath();return new Promise((_0xb70c72,_0x3df372)=>{const _0x493aff=_0x4dc14c,_0x3c2722=_0x3a8f80[_0x493aff(0x1eb)](spawn,_0xa49f19,[_0x3a8f80[_0x493aff(0x1f2)]]);_0x3c2722['on'](_0x3a8f80['ADthM'],_0x4c0945=>{const _0x413ed4=_0x493aff;this[_0x413ed4(0x1d5)]=![],this.#logStream&&(this.#logStream[_0x413ed4(0x1c2)](),this.#logStream=null),_0x3a8f80['FbIPI'](_0xb70c72,_0x4c0945);});});}[a113_0x568119(0x1de)](){const _0x5487a9=a113_0x568119;return this[_0x5487a9(0x1d5)];}async['fetchPercyToken'](){const _0x4a5886=a113_0x568119,_0xe4a1eb={};_0xe4a1eb[_0x4a5886(0x1d4)]=_0x4a5886(0x206),_0xe4a1eb[_0x4a5886(0x1ee)]=_0x4a5886(0x1f9),_0xe4a1eb[_0x4a5886(0x205)]=_0x4a5886(0x1e1),_0xe4a1eb[_0x4a5886(0x1f4)]=_0x4a5886(0x1d6);const _0x4c12ec=_0xe4a1eb,_0x3f8f40=this.#config[_0x4a5886(0x1e6)];try{const _0x1e2dd1=this.#isApp?_0x4c12ec[_0x4a5886(0x1d4)]:_0x4c12ec[_0x4a5886(0x1ee)],_0xe49374=await helper[_0x4a5886(0x1c8)](_0x4c12ec[_0x4a5886(0x205)],_0x4a5886(0x1c3)+_0x3f8f40+_0x4a5886(0x1fd)+_0x1e2dd1,{},this.#config),_0x5b7ad5=_0xe49374[_0x4a5886(0x1e9)];return logger[_0x4a5886(0x1ed)](_0x4c12ec[_0x4a5886(0x1f4)]),_0x5b7ad5['token'];}catch(_0x154dd3){return logger['error'](_0x4a5886(0x1f7)+_0x154dd3),null;}}async[a113_0x568119(0x1bf)](){const _0xf23bce=a113_0x568119,_0x12f84e={'QIydq':function(_0x1d5532,_0x41fefe){return _0x1d5532(_0x41fefe);},'ZTgtE':function(_0x538104,_0x3ab867){return _0x538104+_0x3ab867;},'YmkAY':_0xf23bce(0x1fc),'HxcFr':_0xf23bce(0x1dd)};if(!this.#config[_0xf23bce(0x1da)])return null;const _0x5c9875=path[_0xf23bce(0x1c0)](os[_0xf23bce(0x20c)](),_0x12f84e[_0xf23bce(0x1ff)]),_0x3a770c=this.#config[_0xf23bce(0x1da)];return!_0x3a770c[_0xf23bce(0x1d8)]&&(_0x3a770c[_0xf23bce(0x1d8)]='2'),new Promise((_0x566269,_0x1928de)=>{const _0xfff3=_0xf23bce,_0x2eba39={'WKvHS':function(_0x5f504e,_0x553149){const _0xb56a41=a113_0xe63f;return _0x12f84e[_0xb56a41(0x1cb)](_0x5f504e,_0x553149);},'iyGNe':function(_0x3e2002,_0x340c18){const _0x5e8a26=a113_0xe63f;return _0x12f84e[_0x5e8a26(0x1cd)](_0x3e2002,_0x340c18);},'FQyZU':_0x12f84e['YmkAY'],'JsIxb':function(_0xe00cab,_0x1d72b7){return _0x12f84e['QIydq'](_0xe00cab,_0x1d72b7);}};fs[_0xfff3(0x204)](_0x5c9875,JSON[_0xfff3(0x1bc)](_0x3a770c),_0x43ebaf=>{const _0x25ce0f=_0xfff3;_0x43ebaf&&(logger['error'](_0x25ce0f(0x1bb)+_0x43ebaf),_0x2eba39[_0x25ce0f(0x1c4)](_0x566269,null)),logger[_0x25ce0f(0x1ed)](_0x2eba39[_0x25ce0f(0x1d3)](_0x2eba39[_0x25ce0f(0x1c9)],_0x5c9875)),_0x2eba39[_0x25ce0f(0x1be)](_0x566269,_0x5c9875);});});}}module[a113_0x568119(0x1f8)]=Percy;
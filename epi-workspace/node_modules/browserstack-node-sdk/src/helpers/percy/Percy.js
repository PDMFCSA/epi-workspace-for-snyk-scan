const a103_0x414a45=a103_0x55ec;(function(_0x3842b7,_0x2f7817){const _0x27facd=a103_0x55ec,_0x30af56=_0x3842b7();while(!![]){try{const _0x199f8f=parseInt(_0x27facd(0x84))/0x1+parseInt(_0x27facd(0xae))/0x2+-parseInt(_0x27facd(0xa9))/0x3*(parseInt(_0x27facd(0xaf))/0x4)+parseInt(_0x27facd(0xb6))/0x5*(parseInt(_0x27facd(0xb1))/0x6)+-parseInt(_0x27facd(0x99))/0x7+-parseInt(_0x27facd(0xbc))/0x8*(-parseInt(_0x27facd(0xb0))/0x9)+-parseInt(_0x27facd(0xa7))/0xa*(parseInt(_0x27facd(0xbe))/0xb);if(_0x199f8f===_0x2f7817)break;else _0x30af56['push'](_0x30af56['shift']());}catch(_0x22761a){_0x30af56['push'](_0x30af56['shift']());}}}(a103_0x18fa,0x846a6));function a103_0x18fa(){const _0x4c7512=['ENV_VAR','../helper','healthcheck','QjYMX','percy.log','join','3382799ySblAD','percyOptions','createPercyConfig','gtbsZ','app:exec','VYqKJ','Percy\x20healthcheck\x20successful','clgxD','GET','error','../logger','percy/healthcheck','nodeRequest','child_process','65390gpLGFc','DpIDb','1191ZvxtNx','createWriteStream','stringify',':start','app','1659850NzSPkX','10204XQbCMb','2679363hUjolV','306UHbDrL','exec','percy.json','HiOuJ','path','33040AssNoN','DOWNLOAD','getBinaryPath','isProcessRunning','Jbctu','WSXdC','24fcprXX','push','1001YwXJTT','SXVkx','version','Percy\x20config\x20created\x20at\x20','wwncZ','data','anRuV','winstonLogger','automate','exec:stop','token','tmpdir','Error\x20creating\x20percy\x20config:\x20','qIvOA','NSFxT','yERzI','start','NyZLX','&type=','./PercyBinary','PERCY_SERVER_ADDRESS','573373leWDUV','exports','fetchPercyToken','UtNDI','../../helpers/testhub/constants','BROWSERSTACK_TESTHUB_UUID','http://localhost:5338','projectName','writeFile','debug','ArlXG','env','flags','stdout','../../helpers/performance/constants'];a103_0x18fa=function(){return _0x4c7512;};return a103_0x18fa();}function a103_0x55ec(_0x1674af,_0x1bf900){const _0x18fab0=a103_0x18fa();return a103_0x55ec=function(_0x55ec65,_0x1408e4){_0x55ec65=_0x55ec65-0x75;let _0x45682a=_0x18fab0[_0x55ec65];return _0x45682a;},a103_0x55ec(_0x1674af,_0x1bf900);}const fs=require('fs'),path=require(a103_0x414a45(0xb5)),os=require('os'),{spawn}=require(a103_0x414a45(0xa6)),helper=require(a103_0x414a45(0x94)),logger=require(a103_0x414a45(0xa3))[a103_0x414a45(0x76)],{getLogDir}=require(a103_0x414a45(0xa3)),testHubConstants=require(a103_0x414a45(0x88)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a103_0x414a45(0x92)),PercyBinary=require(a103_0x414a45(0x82));class Percy{#logfile=path[a103_0x414a45(0x98)](getLogDir(),a103_0x414a45(0x97));#address=process['env'][a103_0x414a45(0x83)]||a103_0x414a45(0x8a);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a103_0x414a45(0xb9)]=![];constructor(_0x165e8b){const _0x4b4c7f=a103_0x414a45;this.#config=_0x165e8b,!!_0x165e8b[_0x4b4c7f(0xad)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x27ea3c=a103_0x414a45;if(!this.#binaryPath){const _0x5f341c=new PercyBinary();PerformanceTester[_0x27ea3c(0x7f)](PerformanceEvents[_0x27ea3c(0xb7)]),this.#binaryPath=await _0x5f341c[_0x27ea3c(0xb8)](this.#config),PerformanceTester['end'](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x3ceb1e){return new Promise(_0x170c0f=>setTimeout(_0x170c0f,_0x3ceb1e));}async[a103_0x414a45(0x95)](){const _0x64032d=a103_0x414a45,_0x3c9067={};_0x3c9067[_0x64032d(0x80)]=_0x64032d(0xa1),_0x3c9067['QjYMX']=_0x64032d(0xa4);const _0x7f2c27=_0x3c9067;try{const _0x18d4a4=await helper[_0x64032d(0xa5)](_0x7f2c27[_0x64032d(0x80)],_0x7f2c27[_0x64032d(0x96)],null,null,this.#address);if(_0x18d4a4)return!![];}catch(_0x4060a5){return![];}}async[a103_0x414a45(0x7f)](){const _0x2b0864=a103_0x414a45,_0x43dcc4={'SXVkx':_0x2b0864(0x9d),'UtNDI':_0x2b0864(0xb2),'yERzI':function(_0x4d21ee,_0x19e422,_0x536371,_0x120458){return _0x4d21ee(_0x19e422,_0x536371,_0x120458);},'VYqKJ':'close','Jbctu':_0x2b0864(0x9f)},_0x1c19c5=await this.#getBinaryPath(),_0x4653b1={};_0x4653b1[_0x2b0864(0x90)]='a';const _0x1b86a3=fs[_0x2b0864(0xaa)](this.#logfile,_0x4653b1),_0x4c46a4=await this[_0x2b0864(0x86)](),_0x558ff1=await this[_0x2b0864(0x9b)]();if(!_0x4c46a4)return![];const _0x265cf3=[(this.#isApp?_0x43dcc4[_0x2b0864(0xbf)]:_0x43dcc4[_0x2b0864(0x87)])+_0x2b0864(0xac)];_0x558ff1&&_0x265cf3[_0x2b0864(0xbd)]('-c',_0x558ff1);this.#proc=_0x43dcc4[_0x2b0864(0x7e)](spawn,_0x1c19c5,_0x265cf3,{'env':Object['assign'](process[_0x2b0864(0x8f)],{'PERCY_TOKEN':_0x4c46a4,'TH_BUILD_UUID':process['env'][testHubConstants[_0x2b0864(0x93)][_0x2b0864(0x89)]]})}),this.#proc[_0x2b0864(0x91)]['pipe'](_0x1b86a3),this.#proc['stderr']['pipe'](_0x1b86a3),this[_0x2b0864(0xb9)]=!![];var _0xc7baf1=this;this.#proc['on'](_0x43dcc4[_0x2b0864(0x9e)],function(_0x37c092){const _0x26c20c=_0x2b0864;_0xc7baf1[_0x26c20c(0xb9)]=![];});do{const _0x406da3=await this[_0x2b0864(0x95)]();if(_0x406da3)return logger[_0x2b0864(0x8d)](_0x43dcc4[_0x2b0864(0xba)]),!![];await this.#sleep(0x3e8);}while(this[_0x2b0864(0xb9)]);return![];}async['stop'](){const _0x18966f=a103_0x414a45,_0x2e8e58={'TTfKX':function(_0x14cbf8,_0x278032){return _0x14cbf8(_0x278032);},'ArlXG':function(_0x98f2dc,_0x485089,_0x270087){return _0x98f2dc(_0x485089,_0x270087);},'clgxD':_0x18966f(0x78),'OxHCv':'close'},_0x12641c=await this.#getBinaryPath();return new Promise((_0x358561,_0x214d85)=>{const _0x31ab59=_0x18966f,_0x11ae64=_0x2e8e58[_0x31ab59(0x8e)](spawn,_0x12641c,[_0x2e8e58[_0x31ab59(0xa0)]]);_0x11ae64['on'](_0x2e8e58['OxHCv'],_0x94f998=>{const _0x5f4b6c=_0x31ab59;this[_0x5f4b6c(0xb9)]=![],_0x2e8e58['TTfKX'](_0x358561,_0x94f998);});});}['isRunning'](){const _0x530c71=a103_0x414a45;return this[_0x530c71(0xb9)];}async['fetchPercyToken'](){const _0x1b05e7=a103_0x414a45,_0x101160={};_0x101160['wwncZ']=_0x1b05e7(0xad),_0x101160[_0x1b05e7(0xb4)]=_0x1b05e7(0x77),_0x101160[_0x1b05e7(0x7c)]=_0x1b05e7(0xa1),_0x101160[_0x1b05e7(0xa8)]='Percy\x20fetch\x20token\x20success';const _0x46c7d1=_0x101160,_0x18ec92=this.#config[_0x1b05e7(0x8b)];try{const _0x599cfa=this.#isApp?_0x46c7d1[_0x1b05e7(0xc2)]:_0x46c7d1[_0x1b05e7(0xb4)],_0xe339d1=await helper[_0x1b05e7(0xa5)](_0x46c7d1[_0x1b05e7(0x7c)],'api/app_percy/get_project_token?name='+_0x18ec92+_0x1b05e7(0x81)+_0x599cfa,{},this.#config),_0x540ff2=_0xe339d1[_0x1b05e7(0xc3)];return logger[_0x1b05e7(0x8d)](_0x46c7d1[_0x1b05e7(0xa8)]),_0x540ff2[_0x1b05e7(0x79)];}catch(_0x5f1bd6){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x5f1bd6),null;}}async[a103_0x414a45(0x9b)](){const _0xd4d8e0=a103_0x414a45,_0x5b1722={'WSXdC':function(_0x4c13ad,_0x810135){return _0x4c13ad(_0x810135);},'anRuV':function(_0x799477,_0x18b024){return _0x799477+_0x18b024;},'NSFxT':_0xd4d8e0(0xc1),'gtbsZ':_0xd4d8e0(0xb3)};if(!this.#config['percyOptions'])return null;const _0xdb2f8d=path[_0xd4d8e0(0x98)](os[_0xd4d8e0(0x7a)](),_0x5b1722[_0xd4d8e0(0x9c)]),_0x325746=this.#config[_0xd4d8e0(0x9a)];return!_0x325746[_0xd4d8e0(0xc0)]&&(_0x325746[_0xd4d8e0(0xc0)]='2'),new Promise((_0x62dbfa,_0x41e169)=>{const _0x1cbf8e=_0xd4d8e0;fs[_0x1cbf8e(0x8c)](_0xdb2f8d,JSON[_0x1cbf8e(0xab)](_0x325746),_0x1a5930=>{const _0x435f62=_0x1cbf8e;_0x1a5930&&(logger[_0x435f62(0xa2)](_0x435f62(0x7b)+_0x1a5930),_0x5b1722[_0x435f62(0xbb)](_0x62dbfa,null)),logger[_0x435f62(0x8d)](_0x5b1722[_0x435f62(0x75)](_0x5b1722[_0x435f62(0x7d)],_0xdb2f8d)),_0x5b1722[_0x435f62(0xbb)](_0x62dbfa,_0xdb2f8d);});});}}module[a103_0x414a45(0x85)]=Percy;
const a108_0x3d8a44=a108_0x4258;(function(_0x5352f8,_0x59b9e0){const _0x2de236=a108_0x4258,_0x424e18=_0x5352f8();while(!![]){try{const _0x7b7c9d=parseInt(_0x2de236(0x1a4))/0x1+-parseInt(_0x2de236(0x18a))/0x2+parseInt(_0x2de236(0x1c2))/0x3+-parseInt(_0x2de236(0x1bb))/0x4*(parseInt(_0x2de236(0x191))/0x5)+-parseInt(_0x2de236(0x1b2))/0x6+-parseInt(_0x2de236(0x1a9))/0x7*(parseInt(_0x2de236(0x1a7))/0x8)+parseInt(_0x2de236(0x1c8))/0x9;if(_0x7b7c9d===_0x59b9e0)break;else _0x424e18['push'](_0x424e18['shift']());}catch(_0x2a8771){_0x424e18['push'](_0x424e18['shift']());}}}(a108_0x4c4a,0xb48ec));function a108_0x4c4a(){const _0x924152=['ziGyd','./PercyBinary','projectName','fetchPercyToken','olmUs','2483451LwjrIL','SRWWO','token','EOtOG','app:exec','../logger','25085070lKtjDv','api/app_percy/get_project_token?name=','percy.log','app','exec:stop','eDysA','EqYvT','ENV_VAR','push','healthcheck','automate','BROWSERSTACK_TESTHUB_UUID','Avwva','BhPhu','child_process','isRunning','Percy\x20fetch\x20token\x20success','stdout','2053800bxUyXp','&type=','debug','path','end','percyOptions','Percy\x20healthcheck\x20successful','9660RdjwHO','aqgXd','../helper','percy/healthcheck','start','join','UizSe',':start','LepZv','flags','../../helpers/performance/performance-tester','writeFile','GET','DOWNLOAD','FvNSM','PERCY_SERVER_ADDRESS','fRgQj','XDnXU','data','1327889MPTenn','Error\x20creating\x20percy\x20config:\x20','../../helpers/testhub/constants','633592aTtCBp','piitN','105AuGMAK','stop','stringify','NiwgK','isProcessRunning','KBjJR','stderr','assign','winstonLogger','5300298TYIFSa','env','nSRwI','version','close','getBinaryPath','createPercyConfig','pipe','exec','2288vzsMrR','UnCIh'];a108_0x4c4a=function(){return _0x924152;};return a108_0x4c4a();}const fs=require('fs'),path=require(a108_0x3d8a44(0x18d)),os=require('os'),{spawn}=require(a108_0x3d8a44(0x186)),helper=require(a108_0x3d8a44(0x193)),logger=require(a108_0x3d8a44(0x1c7))[a108_0x3d8a44(0x1b1)],{getLogDir}=require(a108_0x3d8a44(0x1c7)),testHubConstants=require(a108_0x3d8a44(0x1a6)),PerformanceTester=require(a108_0x3d8a44(0x19b)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a108_0x3d8a44(0x1be));function a108_0x4258(_0x4f348f,_0x4aa9bb){const _0x4c4a7e=a108_0x4c4a();return a108_0x4258=function(_0x4258b9,_0x4d0cfb){_0x4258b9=_0x4258b9-0x182;let _0x44619a=_0x4c4a7e[_0x4258b9];return _0x44619a;},a108_0x4258(_0x4f348f,_0x4aa9bb);}class Percy{#logfile=path['join'](getLogDir(),a108_0x3d8a44(0x1ca));#address=process[a108_0x3d8a44(0x1b3)][a108_0x3d8a44(0x1a0)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x367fcc){const _0x2067b1=a108_0x3d8a44;this.#config=_0x367fcc,!!_0x367fcc[_0x2067b1(0x1cb)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x5902cf=a108_0x3d8a44;if(!this.#binaryPath){const _0x1829b0=new PercyBinary();PerformanceTester[_0x5902cf(0x195)](PerformanceEvents[_0x5902cf(0x19e)]),this.#binaryPath=await _0x1829b0[_0x5902cf(0x1b7)](this.#config),PerformanceTester[_0x5902cf(0x18e)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x33e46f){return new Promise(_0x10779d=>setTimeout(_0x10779d,_0x33e46f));}async[a108_0x3d8a44(0x1d1)](){const _0x40c421=a108_0x3d8a44,_0x29b6d0={};_0x29b6d0['piitN']=_0x40c421(0x19d),_0x29b6d0[_0x40c421(0x1a1)]=_0x40c421(0x194);const _0x489212=_0x29b6d0;try{const _0x187e1d=await helper['nodeRequest'](_0x489212[_0x40c421(0x1a8)],_0x489212[_0x40c421(0x1a1)],null,null,this.#address);if(_0x187e1d)return!![];}catch(_0x3f0ae5){return![];}}async[a108_0x3d8a44(0x195)](){const _0x36797d=a108_0x3d8a44,_0x344384={'BhPhu':_0x36797d(0x1c6),'EqYvT':_0x36797d(0x1ba),'ZDjmz':function(_0x5bbf28,_0x19c6b5,_0x308e8d,_0x107186){return _0x5bbf28(_0x19c6b5,_0x308e8d,_0x107186);},'olmUs':_0x36797d(0x1b6),'aqgXd':_0x36797d(0x190)},_0x59e2d9=await this.#getBinaryPath(),_0xd20add={};_0xd20add[_0x36797d(0x19a)]='a';const _0x5daf5e=fs['createWriteStream'](this.#logfile,_0xd20add),_0x1012ab=await this[_0x36797d(0x1c0)](),_0x41a3e2=await this[_0x36797d(0x1b8)]();if(!_0x1012ab)return![];const _0x214366=[(this.#isApp?_0x344384[_0x36797d(0x185)]:_0x344384[_0x36797d(0x1ce)])+_0x36797d(0x198)];_0x41a3e2&&_0x214366[_0x36797d(0x1d0)]('-c',_0x41a3e2);this.#proc=_0x344384['ZDjmz'](spawn,_0x59e2d9,_0x214366,{'env':Object[_0x36797d(0x1b0)](process[_0x36797d(0x1b3)],{'PERCY_TOKEN':_0x1012ab,'TH_BUILD_UUID':process['env'][testHubConstants[_0x36797d(0x1cf)][_0x36797d(0x183)]]})}),this.#proc[_0x36797d(0x189)]['pipe'](_0x5daf5e),this.#proc[_0x36797d(0x1af)][_0x36797d(0x1b9)](_0x5daf5e),this[_0x36797d(0x1ad)]=!![];var _0x6120a1=this;this.#proc['on'](_0x344384[_0x36797d(0x1c1)],function(_0x149434){const _0x2ade5f=_0x36797d;_0x6120a1[_0x2ade5f(0x1ad)]=![];});do{const _0x2f2d7a=await this[_0x36797d(0x1d1)]();if(_0x2f2d7a)return logger['debug'](_0x344384[_0x36797d(0x192)]),!![];await this.#sleep(0x3e8);}while(this[_0x36797d(0x1ad)]);return![];}async[a108_0x3d8a44(0x1aa)](){const _0x4c78fe=a108_0x3d8a44,_0x211a66={'eDysA':function(_0x28e0ed,_0x5be7c3){return _0x28e0ed(_0x5be7c3);},'ziGyd':function(_0x49df95,_0x47b67f,_0x1c59e0){return _0x49df95(_0x47b67f,_0x1c59e0);},'KBjJR':_0x4c78fe(0x1cc),'LepZv':_0x4c78fe(0x1b6)},_0x5b1654=await this.#getBinaryPath();return new Promise((_0x4fd0a5,_0x4a09de)=>{const _0x111071=_0x4c78fe,_0x30d0e5=_0x211a66[_0x111071(0x1bd)](spawn,_0x5b1654,[_0x211a66[_0x111071(0x1ae)]]);_0x30d0e5['on'](_0x211a66[_0x111071(0x199)],_0x221b22=>{const _0x1b8221=_0x111071;this['isProcessRunning']=![],_0x211a66[_0x1b8221(0x1cd)](_0x4fd0a5,_0x221b22);});});}[a108_0x3d8a44(0x187)](){const _0x506e7b=a108_0x3d8a44;return this[_0x506e7b(0x1ad)];}async[a108_0x3d8a44(0x1c0)](){const _0x1fb592=a108_0x3d8a44,_0x46e939={};_0x46e939[_0x1fb592(0x197)]=_0x1fb592(0x1cb),_0x46e939[_0x1fb592(0x1bc)]=_0x1fb592(0x182),_0x46e939[_0x1fb592(0x1a2)]=_0x1fb592(0x19d),_0x46e939['Avwva']=_0x1fb592(0x188);const _0x34d1ac=_0x46e939,_0x485d92=this.#config[_0x1fb592(0x1bf)];try{const _0x1248ab=this.#isApp?_0x34d1ac['UizSe']:_0x34d1ac['UnCIh'],_0x514546=await helper['nodeRequest'](_0x34d1ac[_0x1fb592(0x1a2)],_0x1fb592(0x1c9)+_0x485d92+_0x1fb592(0x18b)+_0x1248ab,{},this.#config),_0xaf9187=_0x514546[_0x1fb592(0x1a3)];return logger[_0x1fb592(0x18c)](_0x34d1ac[_0x1fb592(0x184)]),_0xaf9187[_0x1fb592(0x1c4)];}catch(_0x1c5e8b){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x1c5e8b),null;}}async[a108_0x3d8a44(0x1b8)](){const _0x3fbdfd=a108_0x3d8a44,_0x3b38d3={'QaCbZ':function(_0x465ada,_0xf873c4){return _0x465ada(_0xf873c4);},'NiwgK':function(_0x3afdf4,_0x309bdb){return _0x3afdf4+_0x309bdb;},'cefRa':'Percy\x20config\x20created\x20at\x20','nSRwI':'percy.json'};if(!this.#config[_0x3fbdfd(0x18f)])return null;const _0x45aede=path[_0x3fbdfd(0x196)](os['tmpdir'](),_0x3b38d3[_0x3fbdfd(0x1b4)]),_0x577061=this.#config[_0x3fbdfd(0x18f)];return!_0x577061[_0x3fbdfd(0x1b5)]&&(_0x577061[_0x3fbdfd(0x1b5)]='2'),new Promise((_0xf7442b,_0x5b0119)=>{const _0x243aba=_0x3fbdfd,_0x1baf37={'FvNSM':function(_0x385b78,_0x293779){return _0x3b38d3['QaCbZ'](_0x385b78,_0x293779);},'EOtOG':function(_0x40abf6,_0xa670bd){const _0x12de56=a108_0x4258;return _0x3b38d3[_0x12de56(0x1ac)](_0x40abf6,_0xa670bd);},'SRWWO':_0x3b38d3['cefRa']};fs[_0x243aba(0x19c)](_0x45aede,JSON[_0x243aba(0x1ab)](_0x577061),_0x1b2cbb=>{const _0x283c3d=_0x243aba;_0x1b2cbb&&(logger['error'](_0x283c3d(0x1a5)+_0x1b2cbb),_0x1baf37[_0x283c3d(0x19f)](_0xf7442b,null)),logger['debug'](_0x1baf37[_0x283c3d(0x1c5)](_0x1baf37[_0x283c3d(0x1c3)],_0x45aede)),_0x1baf37[_0x283c3d(0x19f)](_0xf7442b,_0x45aede);});});}}module['exports']=Percy;
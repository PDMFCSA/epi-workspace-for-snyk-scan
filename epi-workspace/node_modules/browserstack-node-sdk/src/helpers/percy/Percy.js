const a101_0x3d74d6=a101_0x14d5;function a101_0x14d5(_0x15393a,_0x2f2bf1){const _0x56ba1f=a101_0x56ba();return a101_0x14d5=function(_0x14d57f,_0x44508d){_0x14d57f=_0x14d57f-0x13a;let _0xc538b5=_0x56ba1f[_0x14d57f];return _0xc538b5;},a101_0x14d5(_0x15393a,_0x2f2bf1);}(function(_0xf49dd6,_0x194e82){const _0x43348e=a101_0x14d5,_0x5cb645=_0xf49dd6();while(!![]){try{const _0x4aaa8b=-parseInt(_0x43348e(0x16f))/0x1*(parseInt(_0x43348e(0x15d))/0x2)+parseInt(_0x43348e(0x144))/0x3*(parseInt(_0x43348e(0x146))/0x4)+-parseInt(_0x43348e(0x172))/0x5*(-parseInt(_0x43348e(0x188))/0x6)+-parseInt(_0x43348e(0x13a))/0x7*(-parseInt(_0x43348e(0x156))/0x8)+-parseInt(_0x43348e(0x13e))/0x9+-parseInt(_0x43348e(0x16c))/0xa*(parseInt(_0x43348e(0x166))/0xb)+parseInt(_0x43348e(0x176))/0xc*(-parseInt(_0x43348e(0x143))/0xd);if(_0x4aaa8b===_0x194e82)break;else _0x5cb645['push'](_0x5cb645['shift']());}catch(_0x489ae6){_0x5cb645['push'](_0x5cb645['shift']());}}}(a101_0x56ba,0xdd733));const fs=require('fs'),path=require(a101_0x3d74d6(0x169)),os=require('os'),{spawn}=require('child_process'),helper=require(a101_0x3d74d6(0x16e)),logger=require('../logger')[a101_0x3d74d6(0x15c)],{getLogDir}=require(a101_0x3d74d6(0x15e)),testHubConstants=require(a101_0x3d74d6(0x154)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a101_0x3d74d6(0x14d)](getLogDir(),'percy.log');#address=process[a101_0x3d74d6(0x173)][a101_0x3d74d6(0x189)]||a101_0x3d74d6(0x162);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x3d595e){const _0x134c77=a101_0x3d74d6;this.#config=_0x3d595e,!!_0x3d595e[_0x134c77(0x183)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x44eb21=a101_0x3d74d6;if(!this.#binaryPath){const _0x233db1=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x44eb21(0x148)]),this.#binaryPath=await _0x233db1[_0x44eb21(0x164)](this.#config),PerformanceTester[_0x44eb21(0x165)](PerformanceEvents[_0x44eb21(0x148)]);}return this.#binaryPath;}async #sleep(_0x1ee7f1){return new Promise(_0x296d5d=>setTimeout(_0x296d5d,_0x1ee7f1));}async['healthcheck'](){const _0x40f546=a101_0x3d74d6,_0x4352b3={};_0x4352b3[_0x40f546(0x170)]=_0x40f546(0x16a),_0x4352b3['laNIu']=_0x40f546(0x168);const _0x5e5c58=_0x4352b3;try{const _0x17489a=await helper['nodeRequest'](_0x5e5c58[_0x40f546(0x170)],_0x5e5c58[_0x40f546(0x14e)],null,null,this.#address);if(_0x17489a)return!![];}catch(_0x333f3c){return![];}}async[a101_0x3d74d6(0x145)](){const _0x5142a7=a101_0x3d74d6,_0x44768e={'ldsCQ':_0x5142a7(0x14b),'UNvwg':_0x5142a7(0x179),'WWRjC':function(_0x3bbce5,_0x978f45,_0x39253f,_0xc5a12b){return _0x3bbce5(_0x978f45,_0x39253f,_0xc5a12b);},'lPwiZ':'close','PCQMJ':_0x5142a7(0x15f)},_0x1744de=await this.#getBinaryPath(),_0x246d07={};_0x246d07[_0x5142a7(0x140)]='a';const _0x6c29f0=fs[_0x5142a7(0x15b)](this.#logfile,_0x246d07),_0x1f2002=await this[_0x5142a7(0x155)](),_0x298815=await this['createPercyConfig']();if(!_0x1f2002)return![];const _0x3ff122=[(this.#isApp?_0x44768e['ldsCQ']:_0x44768e[_0x5142a7(0x186)])+_0x5142a7(0x160)];_0x298815&&_0x3ff122[_0x5142a7(0x185)]('-c',_0x298815);this.#proc=_0x44768e[_0x5142a7(0x174)](spawn,_0x1744de,_0x3ff122,{'env':Object[_0x5142a7(0x141)](process[_0x5142a7(0x173)],{'PERCY_TOKEN':_0x1f2002,'TH_BUILD_UUID':process[_0x5142a7(0x173)][testHubConstants[_0x5142a7(0x13d)][_0x5142a7(0x182)]]})}),this.#proc['stdout'][_0x5142a7(0x17b)](_0x6c29f0),this.#proc['stderr'][_0x5142a7(0x17b)](_0x6c29f0),this[_0x5142a7(0x16b)]=!![];var _0x396fae=this;this.#proc['on'](_0x44768e[_0x5142a7(0x13c)],function(_0x195d90){const _0xc63394=_0x5142a7;_0x396fae[_0xc63394(0x16b)]=![];});do{const _0x25abc8=await this['healthcheck']();if(_0x25abc8)return logger['debug'](_0x44768e[_0x5142a7(0x147)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async['stop'](){const _0x14065d=a101_0x3d74d6,_0xd87e2f={'qCQJL':function(_0x3a757e,_0x584d63){return _0x3a757e(_0x584d63);},'vVeUW':function(_0xaa5521,_0x5d372c,_0x53fd68){return _0xaa5521(_0x5d372c,_0x53fd68);},'szRir':_0x14065d(0x150),'onXjH':'close'},_0x52673b=await this.#getBinaryPath();return new Promise((_0x3d29c6,_0x10a704)=>{const _0x481ee4=_0x14065d,_0x33048c={'gVXdz':function(_0x5d0994,_0x3b783e){const _0x4e3f63=a101_0x14d5;return _0xd87e2f[_0x4e3f63(0x180)](_0x5d0994,_0x3b783e);}},_0x37fb60=_0xd87e2f[_0x481ee4(0x167)](spawn,_0x52673b,[_0xd87e2f[_0x481ee4(0x153)]]);_0x37fb60['on'](_0xd87e2f[_0x481ee4(0x159)],_0x1cc4be=>{const _0x29bc2f=_0x481ee4;this['isProcessRunning']=![],_0x33048c[_0x29bc2f(0x14a)](_0x3d29c6,_0x1cc4be);});});}[a101_0x3d74d6(0x14c)](){const _0x1f6f05=a101_0x3d74d6;return this[_0x1f6f05(0x16b)];}async[a101_0x3d74d6(0x155)](){const _0x1a0db7=a101_0x3d74d6,_0x5a44ec={};_0x5a44ec[_0x1a0db7(0x175)]='app',_0x5a44ec[_0x1a0db7(0x187)]='automate',_0x5a44ec['RNuJr']=_0x1a0db7(0x16a),_0x5a44ec[_0x1a0db7(0x161)]=_0x1a0db7(0x177);const _0x196605=_0x5a44ec,_0x4d1fca=this.#config[_0x1a0db7(0x151)];try{const _0x50140d=this.#isApp?_0x196605['OIFxR']:_0x196605[_0x1a0db7(0x187)],_0x3562c3=await helper[_0x1a0db7(0x178)](_0x196605[_0x1a0db7(0x17d)],_0x1a0db7(0x17c)+_0x4d1fca+_0x1a0db7(0x171)+_0x50140d,{},this.#config),_0x223648=_0x3562c3[_0x1a0db7(0x157)];return logger[_0x1a0db7(0x163)](_0x196605[_0x1a0db7(0x161)]),_0x223648['token'];}catch(_0x53b08c){return logger[_0x1a0db7(0x158)](_0x1a0db7(0x18a)+_0x53b08c),null;}}async['createPercyConfig'](){const _0x3f7fa7=a101_0x3d74d6,_0x26d0c5={'NvSxH':function(_0x501a55,_0x332857){return _0x501a55(_0x332857);},'ExnlU':function(_0x322d69,_0x4af9c9){return _0x322d69+_0x4af9c9;},'ZWMoG':_0x3f7fa7(0x13b),'beFyz':function(_0x3eead5,_0x5d0b8e){return _0x3eead5(_0x5d0b8e);},'buroR':'percy.json'};if(!this.#config[_0x3f7fa7(0x17a)])return null;const _0x2c128f=path['join'](os[_0x3f7fa7(0x15a)](),_0x26d0c5['buroR']),_0xa83350=this.#config[_0x3f7fa7(0x17a)];return!_0xa83350['version']&&(_0xa83350[_0x3f7fa7(0x17e)]='2'),new Promise((_0x61f895,_0x4b9455)=>{const _0x21de52=_0x3f7fa7,_0x457ac3={'afXUv':function(_0x5c1352,_0x1a2b69){const _0x42e377=a101_0x14d5;return _0x26d0c5[_0x42e377(0x16d)](_0x5c1352,_0x1a2b69);},'QzAOe':function(_0x4320a8,_0x4b7616){const _0x53c195=a101_0x14d5;return _0x26d0c5[_0x53c195(0x142)](_0x4320a8,_0x4b7616);},'wtgiu':_0x26d0c5[_0x21de52(0x14f)],'gUDhm':function(_0x3b1992,_0x50ce0e){const _0x4a0069=_0x21de52;return _0x26d0c5[_0x4a0069(0x13f)](_0x3b1992,_0x50ce0e);}};fs['writeFile'](_0x2c128f,JSON[_0x21de52(0x152)](_0xa83350),_0x5afbd0=>{const _0x462f63=_0x21de52;_0x5afbd0&&(logger[_0x462f63(0x158)](_0x462f63(0x184)+_0x5afbd0),_0x457ac3['afXUv'](_0x61f895,null)),logger['debug'](_0x457ac3[_0x462f63(0x149)](_0x457ac3[_0x462f63(0x17f)],_0x2c128f)),_0x457ac3[_0x462f63(0x181)](_0x61f895,_0x2c128f);});});}}function a101_0x56ba(){const _0x57d95e=['tBeHW','http://localhost:5338','debug','getBinaryPath','end','165zFMitC','vVeUW','percy/healthcheck','path','GET','isProcessRunning','661450lWMtOq','NvSxH','../helper','1040YEMTbR','duApi','&type=','6444570tqUqkz','env','WWRjC','OIFxR','408APYIze','Percy\x20fetch\x20token\x20success','nodeRequest','exec','percyOptions','pipe','api/app_percy/get_project_token?name=','RNuJr','version','wtgiu','qCQJL','gUDhm','BROWSERSTACK_TESTHUB_UUID','app','Error\x20creating\x20percy\x20config:\x20','push','UNvwg','zLKwt','6ZaQjSt','PERCY_SERVER_ADDRESS','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','13055jYIyom','Percy\x20config\x20created\x20at\x20','lPwiZ','ENV_VAR','4713534nVdNjm','beFyz','flags','assign','ExnlU','154141guXxKS','6lazwWL','start','2645128Mymenk','PCQMJ','DOWNLOAD','QzAOe','gVXdz','app:exec','isRunning','join','laNIu','ZWMoG','exec:stop','projectName','stringify','szRir','../../helpers/testhub/constants','fetchPercyToken','2656RnjYAq','data','error','onXjH','tmpdir','createWriteStream','winstonLogger','778xWozsg','../logger','Percy\x20healthcheck\x20successful',':start'];a101_0x56ba=function(){return _0x57d95e;};return a101_0x56ba();}module['exports']=Percy;
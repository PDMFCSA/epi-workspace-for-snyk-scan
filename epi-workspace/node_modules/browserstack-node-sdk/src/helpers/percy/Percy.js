const a71_0x4ae3c4=a71_0x5b0a;function a71_0x2cfd(){const _0x52bdb8=['app','createPercyConfig','../../helpers/performance/constants','automate',':start','10ItexfX','eWjpb','debug','JqoqX','9tdTnBt','exports','Percy\x20config\x20created\x20at\x20','close','ENV_VAR','stdout','clMCx','percy/healthcheck','uPjFo','healthcheck','app:exec','msJVt','PxNjt','10974616theFXV','1120459WaxYPa','token','11064020qccJWb','25CGzXHO','data','DOWNLOAD','PERCY_SERVER_ADDRESS','percy.json','end','getBinaryPath','exec','api/app_percy/get_project_token?name=','version','tmpdir','hSklU','658401wfmvbC','child_process','../logger','xSwuy','exec:stop','isRunning','writeFile','aOfRx','join','error','path','6Bgiugs','push','../../helpers/testhub/constants','YSSaP','projectName','wHlTs','stop','flags','&type=','BROWSERSTACK_TESTHUB_UUID','REpbR','assign','nodeRequest','WPIyV','pipe','env','./PercyBinary','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','percy.log','isProcessRunning','Percy\x20healthcheck\x20successful','cWmUx','fetchPercyToken','2cuhoJx','494656FShQdW','59147436BuibdW','13gGtBBp','uRGmH','Gtdqr','752941QHslEr','start','winstonLogger'];a71_0x2cfd=function(){return _0x52bdb8;};return a71_0x2cfd();}(function(_0x315244,_0x4ec360){const _0x201947=a71_0x5b0a,_0x51521b=_0x315244();while(!![]){try{const _0x50e9fe=-parseInt(_0x201947(0x112))/0x1+-parseInt(_0x201947(0x143))/0x2*(-parseInt(_0x201947(0x121))/0x3)+parseInt(_0x201947(0x144))/0x4*(-parseInt(_0x201947(0x115))/0x5)+parseInt(_0x201947(0x12c))/0x6*(-parseInt(_0x201947(0x149))/0x7)+-parseInt(_0x201947(0x111))/0x8*(parseInt(_0x201947(0x155))/0x9)+-parseInt(_0x201947(0x151))/0xa*(parseInt(_0x201947(0x114))/0xb)+parseInt(_0x201947(0x145))/0xc*(parseInt(_0x201947(0x146))/0xd);if(_0x50e9fe===_0x4ec360)break;else _0x51521b['push'](_0x51521b['shift']());}catch(_0x72d7cd){_0x51521b['push'](_0x51521b['shift']());}}}(a71_0x2cfd,0xe1b0f));const fs=require('fs'),path=require(a71_0x4ae3c4(0x12b)),os=require('os'),{spawn}=require(a71_0x4ae3c4(0x122)),helper=require('../helper'),logger=require(a71_0x4ae3c4(0x123))[a71_0x4ae3c4(0x14b)],{logDir}=require('../logger'),testHubConstants=require(a71_0x4ae3c4(0x12e)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a71_0x4ae3c4(0x14e)),PercyBinary=require(a71_0x4ae3c4(0x13c));function a71_0x5b0a(_0x5536d1,_0x61ca9e){const _0x2cfd84=a71_0x2cfd();return a71_0x5b0a=function(_0x5b0aa7,_0x47d73e){_0x5b0aa7=_0x5b0aa7-0x108;let _0x552285=_0x2cfd84[_0x5b0aa7];return _0x552285;},a71_0x5b0a(_0x5536d1,_0x61ca9e);}class Percy{#logfile=path[a71_0x4ae3c4(0x129)](logDir,a71_0x4ae3c4(0x13e));#address=process[a71_0x4ae3c4(0x13b)][a71_0x4ae3c4(0x118)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a71_0x4ae3c4(0x13f)]=![];constructor(_0x436931){const _0x377db0=a71_0x4ae3c4;this.#config=_0x436931,!!_0x436931[_0x377db0(0x14c)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x11c4f6=a71_0x4ae3c4;if(!this.#binaryPath){const _0x4f3f40=new PercyBinary();PerformanceTester[_0x11c4f6(0x14a)](PerformanceEvents[_0x11c4f6(0x117)]),this.#binaryPath=await _0x4f3f40[_0x11c4f6(0x11b)](this.#config),PerformanceTester[_0x11c4f6(0x11a)](PerformanceEvents[_0x11c4f6(0x117)]);}return this.#binaryPath;}async #sleep(_0x2ea17e){return new Promise(_0x7d6f16=>setTimeout(_0x7d6f16,_0x2ea17e));}async[a71_0x4ae3c4(0x10d)](){const _0x5a6bb2=a71_0x4ae3c4,_0x577e56={};_0x577e56[_0x5a6bb2(0x131)]='GET',_0x577e56['REpbR']=_0x5a6bb2(0x10b);const _0x3d1df3=_0x577e56;try{const _0x1f5f6=await helper[_0x5a6bb2(0x138)](_0x3d1df3[_0x5a6bb2(0x131)],_0x3d1df3[_0x5a6bb2(0x136)],null,null,this.#address);if(_0x1f5f6)return!![];}catch(_0xff17c4){return![];}}async[a71_0x4ae3c4(0x14a)](){const _0x1f3898=a71_0x4ae3c4,_0x4b2edd={'msJVt':_0x1f3898(0x10e),'aFFIM':_0x1f3898(0x11c),'QwtPo':function(_0x13ded1,_0x330bd6,_0x5e7974,_0x3af8bd){return _0x13ded1(_0x330bd6,_0x5e7974,_0x3af8bd);},'JqoqX':_0x1f3898(0x158),'aOfRx':_0x1f3898(0x140)},_0x4d35c5=await this.#getBinaryPath(),_0x18af2a={};_0x18af2a[_0x1f3898(0x133)]='a';const _0x2edebd=fs['createWriteStream'](this.#logfile,_0x18af2a),_0xbb9db0=await this['fetchPercyToken'](),_0x53ef5e=await this[_0x1f3898(0x14d)]();if(!_0xbb9db0)return![];const _0x2a0b87=[(this.#isApp?_0x4b2edd[_0x1f3898(0x10f)]:_0x4b2edd['aFFIM'])+_0x1f3898(0x150)];_0x53ef5e&&_0x2a0b87[_0x1f3898(0x12d)]('-c',_0x53ef5e);this.#proc=_0x4b2edd['QwtPo'](spawn,_0x4d35c5,_0x2a0b87,{'env':Object[_0x1f3898(0x137)](process[_0x1f3898(0x13b)],{'PERCY_TOKEN':_0xbb9db0,'TH_BUILD_UUID':process[_0x1f3898(0x13b)][testHubConstants[_0x1f3898(0x108)][_0x1f3898(0x135)]]})}),this.#proc[_0x1f3898(0x109)][_0x1f3898(0x13a)](_0x2edebd),this.#proc['stderr'][_0x1f3898(0x13a)](_0x2edebd),this['isProcessRunning']=!![];var _0x24d0a5=this;this.#proc['on'](_0x4b2edd[_0x1f3898(0x154)],function(_0x411095){const _0x13434f=_0x1f3898;_0x24d0a5[_0x13434f(0x13f)]=![];});do{const _0x5e79eb=await this[_0x1f3898(0x10d)]();if(_0x5e79eb)return logger[_0x1f3898(0x153)](_0x4b2edd[_0x1f3898(0x128)]),!![];await this.#sleep(0x3e8);}while(this[_0x1f3898(0x13f)]);return![];}async[a71_0x4ae3c4(0x132)](){const _0x3cb171=a71_0x4ae3c4,_0x43fb81={'cWmUx':function(_0x2ed550,_0x385f84){return _0x2ed550(_0x385f84);},'YSSaP':function(_0x58af02,_0x1066a4,_0x28d633){return _0x58af02(_0x1066a4,_0x28d633);},'uRGmH':_0x3cb171(0x125),'eWjpb':'close'},_0x4bd385=await this.#getBinaryPath();return new Promise((_0x24cd5e,_0x3f7bbf)=>{const _0x1dec49=_0x3cb171,_0x589ce8=_0x43fb81[_0x1dec49(0x12f)](spawn,_0x4bd385,[_0x43fb81[_0x1dec49(0x147)]]);_0x589ce8['on'](_0x43fb81[_0x1dec49(0x152)],_0xc37ed7=>{const _0x371b03=_0x1dec49;this[_0x371b03(0x13f)]=![],_0x43fb81[_0x371b03(0x141)](_0x24cd5e,_0xc37ed7);});});}[a71_0x4ae3c4(0x126)](){const _0x2c271f=a71_0x4ae3c4;return this[_0x2c271f(0x13f)];}async[a71_0x4ae3c4(0x142)](){const _0x655f2e=a71_0x4ae3c4,_0x501fa3={};_0x501fa3[_0x655f2e(0x120)]='app',_0x501fa3['uPjFo']=_0x655f2e(0x14f),_0x501fa3[_0x655f2e(0x124)]='GET',_0x501fa3[_0x655f2e(0x10a)]='Percy\x20fetch\x20token\x20success';const _0x5711c1=_0x501fa3,_0x565b65=this.#config[_0x655f2e(0x130)];try{const _0x54e77c=this.#isApp?_0x5711c1[_0x655f2e(0x120)]:_0x5711c1[_0x655f2e(0x10c)],_0x24510f=await helper[_0x655f2e(0x138)](_0x5711c1[_0x655f2e(0x124)],_0x655f2e(0x11d)+_0x565b65+_0x655f2e(0x134)+_0x54e77c,{},this.#config),_0x2c7c94=_0x24510f[_0x655f2e(0x116)];return logger[_0x655f2e(0x153)](_0x5711c1['clMCx']),_0x2c7c94[_0x655f2e(0x113)];}catch(_0x8731ca){return logger['error'](_0x655f2e(0x13d)+_0x8731ca),null;}}async['createPercyConfig'](){const _0x18dc6f=a71_0x4ae3c4,_0x4a371d={'WPIyV':function(_0x3b1966,_0x9a9630){return _0x3b1966(_0x9a9630);},'QQwhP':function(_0x1ef78b,_0x2c7fa5){return _0x1ef78b+_0x2c7fa5;},'PxNjt':_0x18dc6f(0x157),'Gtdqr':_0x18dc6f(0x119)};if(!this.#config['percyOptions'])return null;const _0x50c318=path[_0x18dc6f(0x129)](os[_0x18dc6f(0x11f)](),_0x4a371d[_0x18dc6f(0x148)]),_0x49374a=this.#config['percyOptions'];return!_0x49374a[_0x18dc6f(0x11e)]&&(_0x49374a[_0x18dc6f(0x11e)]='2'),new Promise((_0x3cde4b,_0x12efb8)=>{const _0x313461=_0x18dc6f;fs[_0x313461(0x127)](_0x50c318,JSON['stringify'](_0x49374a),_0x2444aa=>{const _0x1ab213=_0x313461;_0x2444aa&&(logger[_0x1ab213(0x12a)]('Error\x20creating\x20percy\x20config:\x20'+_0x2444aa),_0x4a371d[_0x1ab213(0x139)](_0x3cde4b,null)),logger[_0x1ab213(0x153)](_0x4a371d['QQwhP'](_0x4a371d[_0x1ab213(0x110)],_0x50c318)),_0x4a371d[_0x1ab213(0x139)](_0x3cde4b,_0x50c318);});});}}module[a71_0x4ae3c4(0x156)]=Percy;
const a113_0x92b9b5=a113_0x4ec4;function a113_0x4ec4(_0x1015a3,_0x52ce47){const _0x2b2d0e=a113_0x2b2d();return a113_0x4ec4=function(_0x4ec494,_0xcca226){_0x4ec494=_0x4ec494-0x1bf;let _0x52ad59=_0x2b2d0e[_0x4ec494];return _0x52ad59;},a113_0x4ec4(_0x1015a3,_0x52ce47);}(function(_0x465d41,_0x1b7083){const _0x154c56=a113_0x4ec4,_0x42d8c5=_0x465d41();while(!![]){try{const _0x4ecb12=-parseInt(_0x154c56(0x1eb))/0x1*(parseInt(_0x154c56(0x204))/0x2)+-parseInt(_0x154c56(0x1ea))/0x3+parseInt(_0x154c56(0x1f9))/0x4+-parseInt(_0x154c56(0x1ca))/0x5+-parseInt(_0x154c56(0x1e9))/0x6+parseInt(_0x154c56(0x1fa))/0x7*(-parseInt(_0x154c56(0x1cb))/0x8)+parseInt(_0x154c56(0x1dc))/0x9;if(_0x4ecb12===_0x1b7083)break;else _0x42d8c5['push'](_0x42d8c5['shift']());}catch(_0x42d3ea){_0x42d8c5['push'](_0x42d8c5['shift']());}}}(a113_0x2b2d,0x37ca1));function a113_0x2b2d(){const _0xa3f916=['DOWNLOAD','303954RFiVuB','549171SGceOA','80951olDUIT','hESOY','jlGZf','GVAzm','automate','&type=','../helper','token','Percy\x20healthcheck\x20successful','../logger','BROWSERSTACK_TESTHUB_UUID','Error\x20creating\x20percy\x20config:\x20','./PercyBinary','exec','1131896KMFFlZ','113519kBYwcz','winstonLogger','xGfrm','yZkUN','stop','eAJXt','VmyWX','join','hVNbB','qfizD','2rVEuZA','NkcOj','tmpdir','nodeRequest',':start','percy/healthcheck','child_process','version','Percy\x20config\x20created\x20at\x20','env','kUPLy','percyOptions','xQbQK','data','exec:stop','assign','RuWPh','ngQws','healthcheck','pipe','ubgmq','stdout','../../helpers/performance/constants','1507565rSHiBq','80MxjWsl','writeFile','http://localhost:5338','isRunning','../../helpers/performance/performance-tester','end','percy.json','Percy\x20fetch\x20token\x20success','pZhxh','pJKfk','createPercyConfig','lJhUG','start','close','cHPlu','projectName','stringify','6515001VAfNfN','debug','app','oxCjS','app:exec','GET','api/app_percy/get_project_token?name=','isProcessRunning','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','error','../../helpers/testhub/constants','UAFls'];a113_0x2b2d=function(){return _0xa3f916;};return a113_0x2b2d();}const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a113_0x92b9b5(0x20a)),helper=require(a113_0x92b9b5(0x1f1)),logger=require(a113_0x92b9b5(0x1f4))[a113_0x92b9b5(0x1fb)],{getLogDir}=require(a113_0x92b9b5(0x1f4)),testHubConstants=require(a113_0x92b9b5(0x1e6)),PerformanceTester=require(a113_0x92b9b5(0x1cf)),{PERCY_EVENTS:PerformanceEvents}=require(a113_0x92b9b5(0x1c9)),PercyBinary=require(a113_0x92b9b5(0x1f7));class Percy{#logfile=path['join'](getLogDir(),'percy.log');#address=process['env']['PERCY_SERVER_ADDRESS']||a113_0x92b9b5(0x1cd);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a113_0x92b9b5(0x1e3)]=![];constructor(_0xa7244e){const _0x4616dd=a113_0x92b9b5;this.#config=_0xa7244e,!!_0xa7244e[_0x4616dd(0x1de)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x37b422=a113_0x92b9b5;if(!this.#binaryPath){const _0x16de41=new PercyBinary();PerformanceTester[_0x37b422(0x1d7)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x16de41['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents[_0x37b422(0x1e8)]);}return this.#binaryPath;}async #sleep(_0x59d2bb){return new Promise(_0x948ce5=>setTimeout(_0x948ce5,_0x59d2bb));}async[a113_0x92b9b5(0x1c5)](){const _0x2ffde3=a113_0x92b9b5,_0x37d3c9={};_0x37d3c9[_0x2ffde3(0x1ff)]=_0x2ffde3(0x1e1),_0x37d3c9[_0x2ffde3(0x1c4)]=_0x2ffde3(0x209);const _0x36701c=_0x37d3c9;try{const _0xfd3738=await helper['nodeRequest'](_0x36701c[_0x2ffde3(0x1ff)],_0x36701c[_0x2ffde3(0x1c4)],null,null,this.#address);if(_0xfd3738)return!![];}catch(_0x4d8049){return![];}}async[a113_0x92b9b5(0x1d7)](){const _0x1a2448=a113_0x92b9b5,_0x276914={'xGfrm':_0x1a2448(0x1e0),'pZhxh':_0x1a2448(0x1f8),'lJhUG':function(_0xcdee0,_0x3d424b,_0x24b69f,_0x2f1878){return _0xcdee0(_0x3d424b,_0x24b69f,_0x2f1878);},'xQbQK':'close','cHPlu':_0x1a2448(0x1f3)},_0x513c10=await this.#getBinaryPath(),_0x329b0e={};_0x329b0e['flags']='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x329b0e);const _0x57def9=await this['fetchPercyToken'](),_0x33bbd8=await this[_0x1a2448(0x1d5)]();if(!_0x57def9)return![];const _0xb4d33e=[(this.#isApp?_0x276914[_0x1a2448(0x1fc)]:_0x276914[_0x1a2448(0x1d3)])+_0x1a2448(0x208)];_0x33bbd8&&_0xb4d33e['push']('-c',_0x33bbd8);this.#proc=_0x276914[_0x1a2448(0x1d6)](spawn,_0x513c10,_0xb4d33e,{'env':Object[_0x1a2448(0x1c2)](process['env'],{'PERCY_TOKEN':_0x57def9,'TH_BUILD_UUID':process[_0x1a2448(0x20d)][testHubConstants['ENV_VAR'][_0x1a2448(0x1f5)]]})}),this.#proc[_0x1a2448(0x1c8)][_0x1a2448(0x1c6)](this.#logStream),this.#proc['stderr'][_0x1a2448(0x1c6)](this.#logStream),this[_0x1a2448(0x1e3)]=!![];var _0x21e94e=this;this.#proc['on'](_0x276914[_0x1a2448(0x1bf)],function(_0x954135){const _0x18f061=_0x1a2448;_0x21e94e[_0x18f061(0x1e3)]=![];});do{const _0x187ed7=await this[_0x1a2448(0x1c5)]();if(_0x187ed7)return logger[_0x1a2448(0x1dd)](_0x276914[_0x1a2448(0x1d9)]),!![];await this.#sleep(0x3e8);}while(this[_0x1a2448(0x1e3)]);return![];}async[a113_0x92b9b5(0x1fe)](){const _0x48d605=a113_0x92b9b5,_0x3cd607={'GVAzm':function(_0x5ebf21,_0xad3c41){return _0x5ebf21(_0xad3c41);},'yZkUN':function(_0x8d69be,_0x49f26d,_0x5e3bd5){return _0x8d69be(_0x49f26d,_0x5e3bd5);},'pJruP':_0x48d605(0x1c1),'hESOY':_0x48d605(0x1d8)},_0x325960=await this.#getBinaryPath();return new Promise((_0x35e96d,_0x35260e)=>{const _0x47a1d3=_0x48d605,_0x1a2820=_0x3cd607[_0x47a1d3(0x1fd)](spawn,_0x325960,[_0x3cd607['pJruP']]);_0x1a2820['on'](_0x3cd607[_0x47a1d3(0x1ec)],_0x5048b1=>{const _0x1b9fcb=_0x47a1d3;this[_0x1b9fcb(0x1e3)]=![],this.#logStream&&(this.#logStream[_0x1b9fcb(0x1d0)](),this.#logStream=null),_0x3cd607[_0x1b9fcb(0x1ee)](_0x35e96d,_0x5048b1);});});}[a113_0x92b9b5(0x1ce)](){const _0x3c5e5a=a113_0x92b9b5;return this[_0x3c5e5a(0x1e3)];}async['fetchPercyToken'](){const _0x54c5bd=a113_0x92b9b5,_0x4a8b82={};_0x4a8b82['NkcOj']=_0x54c5bd(0x1de),_0x4a8b82[_0x54c5bd(0x1d4)]=_0x54c5bd(0x1ef),_0x4a8b82[_0x54c5bd(0x203)]=_0x54c5bd(0x1e1),_0x4a8b82['VmyWX']=_0x54c5bd(0x1d2);const _0x1148c4=_0x4a8b82,_0x233eea=this.#config[_0x54c5bd(0x1da)];try{const _0x41b3d9=this.#isApp?_0x1148c4[_0x54c5bd(0x205)]:_0x1148c4[_0x54c5bd(0x1d4)],_0x55b74=await helper[_0x54c5bd(0x207)](_0x1148c4[_0x54c5bd(0x203)],_0x54c5bd(0x1e2)+_0x233eea+_0x54c5bd(0x1f0)+_0x41b3d9,{},this.#config),_0x1581f9=_0x55b74[_0x54c5bd(0x1c0)];return logger[_0x54c5bd(0x1dd)](_0x1148c4[_0x54c5bd(0x200)]),_0x1581f9[_0x54c5bd(0x1f2)];}catch(_0x44ff9c){return logger[_0x54c5bd(0x1e5)](_0x54c5bd(0x1e4)+_0x44ff9c),null;}}async[a113_0x92b9b5(0x1d5)](){const _0xbbcba2=a113_0x92b9b5,_0x4740f6={'kUPLy':function(_0x5dc015,_0xd32911){return _0x5dc015(_0xd32911);},'jlGZf':function(_0x240a60,_0x4b58f3){return _0x240a60+_0x4b58f3;},'UAFls':_0xbbcba2(0x20c),'RuWPh':_0xbbcba2(0x1d1)};if(!this.#config['percyOptions'])return null;const _0x194fee=path[_0xbbcba2(0x201)](os[_0xbbcba2(0x206)](),_0x4740f6[_0xbbcba2(0x1c3)]),_0x1911ff=this.#config[_0xbbcba2(0x20f)];return!_0x1911ff['version']&&(_0x1911ff[_0xbbcba2(0x20b)]='2'),new Promise((_0x2d4e20,_0xa7cd46)=>{const _0x3de5c5=_0xbbcba2,_0x53b379={'ubgmq':function(_0x693502,_0x2bae0b){const _0xd547a1=a113_0x4ec4;return _0x4740f6[_0xd547a1(0x20e)](_0x693502,_0x2bae0b);},'oxCjS':function(_0x436028,_0x426df2){const _0x37064e=a113_0x4ec4;return _0x4740f6[_0x37064e(0x1ed)](_0x436028,_0x426df2);},'hVNbB':_0x4740f6[_0x3de5c5(0x1e7)]};fs[_0x3de5c5(0x1cc)](_0x194fee,JSON[_0x3de5c5(0x1db)](_0x1911ff),_0xd2f3cb=>{const _0x286176=_0x3de5c5;_0xd2f3cb&&(logger['error'](_0x286176(0x1f6)+_0xd2f3cb),_0x53b379[_0x286176(0x1c7)](_0x2d4e20,null)),logger[_0x286176(0x1dd)](_0x53b379[_0x286176(0x1df)](_0x53b379[_0x286176(0x202)],_0x194fee)),_0x53b379[_0x286176(0x1c7)](_0x2d4e20,_0x194fee);});});}}module['exports']=Percy;
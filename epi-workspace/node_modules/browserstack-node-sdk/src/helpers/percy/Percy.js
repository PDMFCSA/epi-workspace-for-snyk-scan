const a72_0x59b21f=a72_0x2c61;(function(_0x319cbf,_0x1baac8){const _0xf65faf=a72_0x2c61,_0x1abdba=_0x319cbf();while(!![]){try{const _0x18e051=parseInt(_0xf65faf(0xdf))/0x1*(-parseInt(_0xf65faf(0x114))/0x2)+parseInt(_0xf65faf(0xec))/0x3*(-parseInt(_0xf65faf(0xd4))/0x4)+parseInt(_0xf65faf(0xf9))/0x5+parseInt(_0xf65faf(0xf1))/0x6+-parseInt(_0xf65faf(0xd1))/0x7*(parseInt(_0xf65faf(0xf4))/0x8)+-parseInt(_0xf65faf(0xcf))/0x9+parseInt(_0xf65faf(0xea))/0xa*(parseInt(_0xf65faf(0xfa))/0xb);if(_0x18e051===_0x1baac8)break;else _0x1abdba['push'](_0x1abdba['shift']());}catch(_0x21d8f2){_0x1abdba['push'](_0x1abdba['shift']());}}}(a72_0x1aa3,0xce2ee));const fs=require('fs'),path=require(a72_0x59b21f(0xee)),os=require('os'),{spawn}=require('child_process'),helper=require(a72_0x59b21f(0xe2)),logger=require(a72_0x59b21f(0xe9))[a72_0x59b21f(0xe5)],{getLogDir}=require(a72_0x59b21f(0xe9)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a72_0x59b21f(0xdb)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x59b21f(0xfb)),PercyBinary=require('./PercyBinary');function a72_0x2c61(_0x5b994f,_0x28f9e9){const _0x1aa31a=a72_0x1aa3();return a72_0x2c61=function(_0x2c61da,_0x1cf039){_0x2c61da=_0x2c61da-0xc6;let _0x756079=_0x1aa31a[_0x2c61da];return _0x756079;},a72_0x2c61(_0x5b994f,_0x28f9e9);}class Percy{#logfile=path['join'](getLogDir(),a72_0x59b21f(0xd6));#address=process[a72_0x59b21f(0x106)][a72_0x59b21f(0xd3)]||a72_0x59b21f(0x10e);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x59b21f(0xc6)]=![];constructor(_0x97e968){const _0x445c08=a72_0x59b21f;this.#config=_0x97e968,!!_0x97e968[_0x445c08(0xf8)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x2e35b5=a72_0x59b21f;if(!this.#binaryPath){const _0x3d092b=new PercyBinary();PerformanceTester['start'](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x3d092b['getBinaryPath'](this.#config),PerformanceTester[_0x2e35b5(0x109)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x52d022){return new Promise(_0x4d4a01=>setTimeout(_0x4d4a01,_0x52d022));}async['healthcheck'](){const _0x4f6c44=a72_0x59b21f,_0x1534fb={};_0x1534fb['jGeNz']=_0x4f6c44(0xe8),_0x1534fb[_0x4f6c44(0xed)]=_0x4f6c44(0xe3);const _0x32ab60=_0x1534fb;try{const _0x4cd9af=await helper['nodeRequest'](_0x32ab60[_0x4f6c44(0xdd)],_0x32ab60[_0x4f6c44(0xed)],null,null,this.#address);if(_0x4cd9af)return!![];}catch(_0x226d8e){return![];}}async[a72_0x59b21f(0xd9)](){const _0x5b7e58=a72_0x59b21f,_0x25dd8f={'iZsWd':_0x5b7e58(0xe1),'JqhvT':_0x5b7e58(0xe4),'NdFvg':function(_0x4d2a16,_0x48042a,_0x1524fe,_0x169431){return _0x4d2a16(_0x48042a,_0x1524fe,_0x169431);},'GZdCW':'close','kjkKW':'Percy\x20healthcheck\x20successful'},_0x24faa0=await this.#getBinaryPath(),_0x1167d1={};_0x1167d1[_0x5b7e58(0x107)]='a';const _0x5d9844=fs['createWriteStream'](this.#logfile,_0x1167d1),_0x36cb53=await this[_0x5b7e58(0xde)](),_0x599c20=await this[_0x5b7e58(0x100)]();if(!_0x36cb53)return![];const _0x3e5225=[(this.#isApp?_0x25dd8f[_0x5b7e58(0xf2)]:_0x25dd8f[_0x5b7e58(0xe7)])+_0x5b7e58(0xcd)];_0x599c20&&_0x3e5225[_0x5b7e58(0x110)]('-c',_0x599c20);this.#proc=_0x25dd8f['NdFvg'](spawn,_0x24faa0,_0x3e5225,{'env':Object[_0x5b7e58(0xf3)](process[_0x5b7e58(0x106)],{'PERCY_TOKEN':_0x36cb53,'TH_BUILD_UUID':process[_0x5b7e58(0x106)][testHubConstants[_0x5b7e58(0xd2)][_0x5b7e58(0xca)]]})}),this.#proc[_0x5b7e58(0xfd)][_0x5b7e58(0xc8)](_0x5d9844),this.#proc[_0x5b7e58(0x10c)]['pipe'](_0x5d9844),this[_0x5b7e58(0xc6)]=!![];var _0x150278=this;this.#proc['on'](_0x25dd8f['GZdCW'],function(_0x181adc){const _0x37d403=_0x5b7e58;_0x150278[_0x37d403(0xc6)]=![];});do{const _0x4bc37c=await this[_0x5b7e58(0xd7)]();if(_0x4bc37c)return logger['debug'](_0x25dd8f[_0x5b7e58(0xc9)]),!![];await this.#sleep(0x3e8);}while(this[_0x5b7e58(0xc6)]);return![];}async[a72_0x59b21f(0xd8)](){const _0x32c95f=a72_0x59b21f,_0x3bddd4={'QuinC':function(_0x29bf9d,_0x42490a){return _0x29bf9d(_0x42490a);},'XYBql':function(_0x2837be,_0x17f6f6,_0x589800){return _0x2837be(_0x17f6f6,_0x589800);},'OBtpK':_0x32c95f(0xe6),'xjMCS':_0x32c95f(0x10d)},_0x49f3dd=await this.#getBinaryPath();return new Promise((_0x410330,_0x31eb43)=>{const _0x44b655=_0x32c95f,_0x45d775={'KHhhJ':function(_0x3657f3,_0x5748b4){const _0x32a7c3=a72_0x2c61;return _0x3bddd4[_0x32a7c3(0x104)](_0x3657f3,_0x5748b4);}},_0x5c080f=_0x3bddd4[_0x44b655(0xc7)](spawn,_0x49f3dd,[_0x3bddd4[_0x44b655(0xef)]]);_0x5c080f['on'](_0x3bddd4[_0x44b655(0x10a)],_0xf3f460=>{const _0x332ec2=_0x44b655;this[_0x332ec2(0xc6)]=![],_0x45d775[_0x332ec2(0x111)](_0x410330,_0xf3f460);});});}[a72_0x59b21f(0xf6)](){const _0x1a5353=a72_0x59b21f;return this[_0x1a5353(0xc6)];}async['fetchPercyToken'](){const _0x2fed3e=a72_0x59b21f,_0x1c2ad1={};_0x1c2ad1['MPDkN']=_0x2fed3e(0xf8),_0x1c2ad1[_0x2fed3e(0x10b)]=_0x2fed3e(0xcb),_0x1c2ad1[_0x2fed3e(0xcc)]=_0x2fed3e(0xe8),_0x1c2ad1[_0x2fed3e(0xfc)]='Percy\x20fetch\x20token\x20success';const _0x355a8d=_0x1c2ad1,_0x37bfa3=this.#config[_0x2fed3e(0x101)];try{const _0x5252e3=this.#isApp?_0x355a8d[_0x2fed3e(0x112)]:_0x355a8d[_0x2fed3e(0x10b)],_0x51125c=await helper['nodeRequest'](_0x355a8d[_0x2fed3e(0xcc)],_0x2fed3e(0x10f)+_0x37bfa3+_0x2fed3e(0xff)+_0x5252e3,{},this.#config),_0x311756=_0x51125c[_0x2fed3e(0xf5)];return logger[_0x2fed3e(0xd0)](_0x355a8d[_0x2fed3e(0xfc)]),_0x311756[_0x2fed3e(0x108)];}catch(_0x17a7f7){return logger['error'](_0x2fed3e(0x115)+_0x17a7f7),null;}}async[a72_0x59b21f(0x100)](){const _0x4a9c1f=a72_0x59b21f,_0x25ad27={'dEoRN':function(_0x510e86,_0x225000){return _0x510e86(_0x225000);},'LAxTU':function(_0x1e14bf,_0x2cb821){return _0x1e14bf+_0x2cb821;},'CkwSI':_0x4a9c1f(0x103),'TyXCJ':function(_0x596127,_0x548454){return _0x596127(_0x548454);},'DhjeB':'percy.json'};if(!this.#config[_0x4a9c1f(0xda)])return null;const _0x42fc0f=path['join'](os['tmpdir'](),_0x25ad27['DhjeB']),_0xd62195=this.#config[_0x4a9c1f(0xda)];return!_0xd62195[_0x4a9c1f(0x113)]&&(_0xd62195[_0x4a9c1f(0x113)]='2'),new Promise((_0x4a624e,_0x41129e)=>{const _0x4073d3=_0x4a9c1f,_0x57090b={'QrTWi':function(_0x34b5a5,_0x26f68f){const _0x2632a7=a72_0x2c61;return _0x25ad27[_0x2632a7(0xeb)](_0x34b5a5,_0x26f68f);},'zPuKB':function(_0x3d7aa8,_0x2b61bc){return _0x25ad27['LAxTU'](_0x3d7aa8,_0x2b61bc);},'qxXDg':_0x25ad27[_0x4073d3(0xf7)],'zoJnU':function(_0x53243e,_0xc03dd3){const _0xb9882c=_0x4073d3;return _0x25ad27[_0xb9882c(0xfe)](_0x53243e,_0xc03dd3);}};fs[_0x4073d3(0x105)](_0x42fc0f,JSON[_0x4073d3(0x102)](_0xd62195),_0x242d7d=>{const _0x67f57f=_0x4073d3;_0x242d7d&&(logger['error'](_0x67f57f(0xce)+_0x242d7d),_0x57090b['QrTWi'](_0x4a624e,null)),logger[_0x67f57f(0xd0)](_0x57090b[_0x67f57f(0xe0)](_0x57090b[_0x67f57f(0xd5)],_0x42fc0f)),_0x57090b[_0x67f57f(0xdc)](_0x4a624e,_0x42fc0f);});});}}function a72_0x1aa3(){const _0x46a8cf=['5194392qftRHv','iZsWd','assign','202648EPyvie','data','isRunning','CkwSI','app','5516445cMhVQQ','14135JZBXOv','../../helpers/performance/constants','IYwsR','stdout','TyXCJ','&type=','createPercyConfig','projectName','stringify','Percy\x20config\x20created\x20at\x20','QuinC','writeFile','env','flags','token','end','xjMCS','LlYjC','stderr','close','http://localhost:5338','api/app_percy/get_project_token?name=','push','KHhhJ','MPDkN','version','34802MMWbSl','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','isProcessRunning','XYBql','pipe','kjkKW','BROWSERSTACK_TESTHUB_UUID','automate','Atbka',':start','Error\x20creating\x20percy\x20config:\x20','1401669Dyvuby','debug','259HHoECZ','ENV_VAR','PERCY_SERVER_ADDRESS','4pAYsWE','qxXDg','percy.log','healthcheck','stop','start','percyOptions','../../helpers/performance/performance-tester','zoJnU','jGeNz','fetchPercyToken','29kfSvOr','zPuKB','app:exec','../helper','percy/healthcheck','exec','winstonLogger','exec:stop','JqhvT','GET','../logger','6470WBkgSp','dEoRN','1074819tQIeDn','Omejb','path','OBtpK','exports'];a72_0x1aa3=function(){return _0x46a8cf;};return a72_0x1aa3();}module[a72_0x59b21f(0xf0)]=Percy;
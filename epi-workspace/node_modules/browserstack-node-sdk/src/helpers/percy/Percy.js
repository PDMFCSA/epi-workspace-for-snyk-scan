const a99_0x33bb7e=a99_0x4961;(function(_0x3c0fb5,_0x296b36){const _0x1e173e=a99_0x4961,_0x2d9215=_0x3c0fb5();while(!![]){try{const _0x5c3e4d=parseInt(_0x1e173e(0x143))/0x1+parseInt(_0x1e173e(0x164))/0x2*(parseInt(_0x1e173e(0x17d))/0x3)+-parseInt(_0x1e173e(0x155))/0x4*(-parseInt(_0x1e173e(0x15f))/0x5)+-parseInt(_0x1e173e(0x168))/0x6*(-parseInt(_0x1e173e(0x154))/0x7)+-parseInt(_0x1e173e(0x14b))/0x8+-parseInt(_0x1e173e(0x165))/0x9+parseInt(_0x1e173e(0x178))/0xa;if(_0x5c3e4d===_0x296b36)break;else _0x2d9215['push'](_0x2d9215['shift']());}catch(_0xc37355){_0x2d9215['push'](_0x2d9215['shift']());}}}(a99_0x3450,0x43ba2));function a99_0x4961(_0x498d7b,_0x1ca542){const _0x345079=a99_0x3450();return a99_0x4961=function(_0x4961a3,_0x3d1aeb){_0x4961a3=_0x4961a3-0x139;let _0x1f88af=_0x345079[_0x4961a3];return _0x1f88af;},a99_0x4961(_0x498d7b,_0x1ca542);}const fs=require('fs'),path=require(a99_0x33bb7e(0x14e)),os=require('os'),{spawn}=require('child_process'),helper=require(a99_0x33bb7e(0x15b)),logger=require('../logger')['winstonLogger'],{getLogDir}=require(a99_0x33bb7e(0x17a)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a99_0x33bb7e(0x140)),{PERCY_EVENTS:PerformanceEvents}=require(a99_0x33bb7e(0x146)),PercyBinary=require('./PercyBinary');function a99_0x3450(){const _0x31b5b3=['getBinaryPath','BROWSERSTACK_TESTHUB_UUID','healthcheck','../helper','automate','end','isProcessRunning','155Pqnbuc','SXEnZ','nodeRequest','Error\x20creating\x20percy\x20config:\x20','OOVUw','4rLOAGv','3702690KDOSgG','close','PLWyW','75954sDxlBf','hlpmc','tmpdir','createWriteStream','version','bntXJ','assign','fetchPercyToken','GET','exec:stop','start','data','projectName','mkeCT','exports','DOWNLOAD','259260EBplZZ','ExjYv','../logger','stringify','error','43881IQEPTL','pipe','debug','Percy\x20fetch\x20token\x20success','WhiSW','percyOptions','MEIgK','stdout','Percy\x20config\x20created\x20at\x20','../../helpers/performance/performance-tester','stop','DyYFp','396505WsnLhu','percy.json','stderr','../../helpers/performance/constants','XPMro','push','exec','api/app_percy/get_project_token?name=','2676104FnFeWc','http://localhost:5338','RtRmv','path','join','eIDes','env','createPercyConfig','ZGNNd','301ngNIHl','3524iFAFvH','isRunning','Lrdap'];a99_0x3450=function(){return _0x31b5b3;};return a99_0x3450();}class Percy{#logfile=path[a99_0x33bb7e(0x14f)](getLogDir(),'percy.log');#address=process[a99_0x33bb7e(0x151)]['PERCY_SERVER_ADDRESS']||a99_0x33bb7e(0x14c);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a99_0x33bb7e(0x15e)]=![];constructor(_0x1bd0a8){this.#config=_0x1bd0a8,!!_0x1bd0a8['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x54ecf2=a99_0x33bb7e;if(!this.#binaryPath){const _0x53d1c5=new PercyBinary();PerformanceTester[_0x54ecf2(0x172)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x53d1c5[_0x54ecf2(0x158)](this.#config),PerformanceTester[_0x54ecf2(0x15d)](PerformanceEvents[_0x54ecf2(0x177)]);}return this.#binaryPath;}async #sleep(_0x486af5){return new Promise(_0x4854df=>setTimeout(_0x4854df,_0x486af5));}async[a99_0x33bb7e(0x15a)](){const _0x58c970=a99_0x33bb7e,_0x5d2572={};_0x5d2572['lbHBe']=_0x58c970(0x170),_0x5d2572[_0x58c970(0x147)]='percy/healthcheck';const _0x27d2d7=_0x5d2572;try{const _0x1583f6=await helper[_0x58c970(0x161)](_0x27d2d7['lbHBe'],_0x27d2d7[_0x58c970(0x147)],null,null,this.#address);if(_0x1583f6)return!![];}catch(_0x59a6d2){return![];}}async[a99_0x33bb7e(0x172)](){const _0x5d9521=a99_0x33bb7e,_0x212638={'NaMYb':'app:exec','DyYFp':_0x5d9521(0x149),'WhiSW':function(_0x409ae8,_0x4a5315,_0x3cbee7,_0x25ac4a){return _0x409ae8(_0x4a5315,_0x3cbee7,_0x25ac4a);},'bntXJ':'close','SXEnZ':'Percy\x20healthcheck\x20successful'},_0x32684a=await this.#getBinaryPath(),_0x52b982={};_0x52b982['flags']='a';const _0x92fe8a=fs[_0x5d9521(0x16b)](this.#logfile,_0x52b982),_0x30cfc=await this['fetchPercyToken'](),_0x177f66=await this[_0x5d9521(0x152)]();if(!_0x30cfc)return![];const _0x3fee16=[(this.#isApp?_0x212638['NaMYb']:_0x212638[_0x5d9521(0x142)])+':start'];_0x177f66&&_0x3fee16[_0x5d9521(0x148)]('-c',_0x177f66);this.#proc=_0x212638[_0x5d9521(0x13b)](spawn,_0x32684a,_0x3fee16,{'env':Object[_0x5d9521(0x16e)](process['env'],{'PERCY_TOKEN':_0x30cfc,'TH_BUILD_UUID':process[_0x5d9521(0x151)][testHubConstants['ENV_VAR'][_0x5d9521(0x159)]]})}),this.#proc[_0x5d9521(0x13e)][_0x5d9521(0x17e)](_0x92fe8a),this.#proc[_0x5d9521(0x145)][_0x5d9521(0x17e)](_0x92fe8a),this[_0x5d9521(0x15e)]=!![];var _0x37e9f6=this;this.#proc['on'](_0x212638[_0x5d9521(0x16d)],function(_0x16211b){_0x37e9f6['isProcessRunning']=![];});do{const _0x846f1c=await this['healthcheck']();if(_0x846f1c)return logger[_0x5d9521(0x139)](_0x212638[_0x5d9521(0x160)]),!![];await this.#sleep(0x3e8);}while(this[_0x5d9521(0x15e)]);return![];}async[a99_0x33bb7e(0x141)](){const _0x4a6c05=a99_0x33bb7e,_0x1b0404={'BKUBk':function(_0x43ff71,_0x2742fc){return _0x43ff71(_0x2742fc);},'hlpmc':function(_0x56bdda,_0x3deec5,_0x4ea4b3){return _0x56bdda(_0x3deec5,_0x4ea4b3);},'OOVUw':_0x4a6c05(0x171),'rPkho':_0x4a6c05(0x166)},_0x557d88=await this.#getBinaryPath();return new Promise((_0x35ab40,_0x310f44)=>{const _0x255115=_0x4a6c05,_0x3719fd={'Lrdap':function(_0xa4928f,_0xe18745){return _0x1b0404['BKUBk'](_0xa4928f,_0xe18745);}},_0x3b8454=_0x1b0404[_0x255115(0x169)](spawn,_0x557d88,[_0x1b0404[_0x255115(0x163)]]);_0x3b8454['on'](_0x1b0404['rPkho'],_0x2fddc8=>{const _0x1234f9=_0x255115;this[_0x1234f9(0x15e)]=![],_0x3719fd[_0x1234f9(0x157)](_0x35ab40,_0x2fddc8);});});}[a99_0x33bb7e(0x156)](){const _0x134922=a99_0x33bb7e;return this[_0x134922(0x15e)];}async[a99_0x33bb7e(0x16f)](){const _0x25c655=a99_0x33bb7e,_0x3acbb1={};_0x3acbb1[_0x25c655(0x13d)]='app',_0x3acbb1[_0x25c655(0x14d)]=_0x25c655(0x15c),_0x3acbb1[_0x25c655(0x167)]='GET',_0x3acbb1[_0x25c655(0x153)]=_0x25c655(0x13a);const _0x487f9e=_0x3acbb1,_0xe42517=this.#config[_0x25c655(0x174)];try{const _0x1dd794=this.#isApp?_0x487f9e[_0x25c655(0x13d)]:_0x487f9e[_0x25c655(0x14d)],_0x2a3f9d=await helper['nodeRequest'](_0x487f9e[_0x25c655(0x167)],_0x25c655(0x14a)+_0xe42517+'&type='+_0x1dd794,{},this.#config),_0x4d5dda=_0x2a3f9d[_0x25c655(0x173)];return logger[_0x25c655(0x139)](_0x487f9e['ZGNNd']),_0x4d5dda['token'];}catch(_0x226d79){return logger[_0x25c655(0x17c)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x226d79),null;}}async[a99_0x33bb7e(0x152)](){const _0x2da230=a99_0x33bb7e,_0x2cf1b0={'ExjYv':function(_0x1473be,_0x12a008){return _0x1473be(_0x12a008);},'eIDes':function(_0x1f9672,_0x4d72aa){return _0x1f9672+_0x4d72aa;},'mkeCT':_0x2da230(0x13f),'MxNEf':_0x2da230(0x144)};if(!this.#config[_0x2da230(0x13c)])return null;const _0x245451=path[_0x2da230(0x14f)](os[_0x2da230(0x16a)](),_0x2cf1b0['MxNEf']),_0x45b362=this.#config[_0x2da230(0x13c)];return!_0x45b362[_0x2da230(0x16c)]&&(_0x45b362[_0x2da230(0x16c)]='2'),new Promise((_0x497b5c,_0x52acfc)=>{const _0x3daa07=_0x2da230;fs['writeFile'](_0x245451,JSON[_0x3daa07(0x17b)](_0x45b362),_0x2b9e1b=>{const _0x435f47=_0x3daa07;_0x2b9e1b&&(logger[_0x435f47(0x17c)](_0x435f47(0x162)+_0x2b9e1b),_0x2cf1b0['ExjYv'](_0x497b5c,null)),logger[_0x435f47(0x139)](_0x2cf1b0[_0x435f47(0x150)](_0x2cf1b0[_0x435f47(0x175)],_0x245451)),_0x2cf1b0[_0x435f47(0x179)](_0x497b5c,_0x245451);});});}}module[a99_0x33bb7e(0x176)]=Percy;
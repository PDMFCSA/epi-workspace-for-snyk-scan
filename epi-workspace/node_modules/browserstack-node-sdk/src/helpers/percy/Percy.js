const a112_0x4f585a=a112_0x3bb0;function a112_0x26d6(){const _0x537c92=['../../helpers/testhub/constants','healthcheck','arScj','ldmqu','ENV_VAR','jqGJY','pipe','getBinaryPath','version','app:exec','percyOptions','nPblw','assign','stdout','child_process','error','end','dQepB','&type=','../../helpers/performance/performance-tester','path','ijuwb','start','2734300ILGHKH','tmpdir','isRunning','eBfxv','debug','winstonLogger','29485wXnTXy','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','fetchPercyToken','close','join','16QQJPmc','4sHWeCq','createPercyConfig','Percy\x20fetch\x20token\x20success','percy.json','EIzOl','Waajx','hBFSY','push','ksbGQ','env','512024stPmFg','78YgHmKv','406878SKBaim','automate','createWriteStream','./PercyBinary','app','359775nSCncU','Percy\x20config\x20created\x20at\x20','lQXYe','../logger','GET','626815pJgOUQ','cTJqZ','JYTMm','isProcessRunning','igzyn','1429IEUpjC','exports','api/app_percy/get_project_token?name=','http://localhost:5338','../helper','Error\x20creating\x20percy\x20config:\x20','nodeRequest','stringify','xPThe','exec:stop','PMjJm','DeYjF'];a112_0x26d6=function(){return _0x537c92;};return a112_0x26d6();}(function(_0x28a9f5,_0x329e5f){const _0xe8fa2=a112_0x3bb0,_0x307d02=_0x28a9f5();while(!![]){try{const _0x472ac1=-parseInt(_0xe8fa2(0xce))/0x1*(parseInt(_0xe8fa2(0xb3))/0x2)+parseInt(_0xe8fa2(0xbf))/0x3+-parseInt(_0xe8fa2(0xbd))/0x4+parseInt(_0xe8fa2(0xad))/0x5*(parseInt(_0xe8fa2(0xbe))/0x6)+-parseInt(_0xe8fa2(0xc9))/0x7*(parseInt(_0xe8fa2(0xb2))/0x8)+-parseInt(_0xe8fa2(0xc4))/0x9+parseInt(_0xe8fa2(0xa7))/0xa;if(_0x472ac1===_0x329e5f)break;else _0x307d02['push'](_0x307d02['shift']());}catch(_0x246fae){_0x307d02['push'](_0x307d02['shift']());}}}(a112_0x26d6,0x2126c));const fs=require('fs'),path=require(a112_0x4f585a(0xa4)),os=require('os'),{spawn}=require(a112_0x4f585a(0x9e)),helper=require(a112_0x4f585a(0x88)),logger=require('../logger')[a112_0x4f585a(0xac)],{getLogDir}=require(a112_0x4f585a(0xc7)),testHubConstants=require(a112_0x4f585a(0x90)),PerformanceTester=require(a112_0x4f585a(0xa3)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a112_0x4f585a(0xc2));class Percy{#logfile=path['join'](getLogDir(),'percy.log');#address=process['env']['PERCY_SERVER_ADDRESS']||a112_0x4f585a(0x87);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a112_0x4f585a(0xcc)]=![];constructor(_0x3804ed){const _0x2e41c5=a112_0x4f585a;this.#config=_0x3804ed,!!_0x3804ed[_0x2e41c5(0xc3)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x3cf5c=a112_0x4f585a;if(!this.#binaryPath){const _0x15d759=new PercyBinary();PerformanceTester[_0x3cf5c(0xa6)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x15d759[_0x3cf5c(0x97)](this.#config),PerformanceTester[_0x3cf5c(0xa0)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x5e42ec){return new Promise(_0x5322a2=>setTimeout(_0x5322a2,_0x5e42ec));}async[a112_0x4f585a(0x91)](){const _0x538571=a112_0x4f585a,_0x2887c6={};_0x2887c6[_0x538571(0xcb)]=_0x538571(0xc8),_0x2887c6[_0x538571(0x93)]='percy/healthcheck';const _0x3b1451=_0x2887c6;try{const _0x1f6d7a=await helper[_0x538571(0x8a)](_0x3b1451[_0x538571(0xcb)],_0x3b1451[_0x538571(0x93)],null,null,this.#address);if(_0x1f6d7a)return!![];}catch(_0x3d12d4){return![];}}async[a112_0x4f585a(0xa6)](){const _0x2dc69d=a112_0x4f585a,_0x61d903={'IGCSG':_0x2dc69d(0x99),'cTJqZ':'exec','PMjJm':function(_0x2251e5,_0x4bbf41,_0x16761a,_0x1e6268){return _0x2251e5(_0x4bbf41,_0x16761a,_0x1e6268);},'ijuwb':_0x2dc69d(0xb0),'Waajx':'Percy\x20healthcheck\x20successful'},_0x1f44c7=await this.#getBinaryPath(),_0x15249e={};_0x15249e['flags']='a',this.#logStream=fs[_0x2dc69d(0xc1)](this.#logfile,_0x15249e);const _0x338425=await this[_0x2dc69d(0xaf)](),_0x46c93a=await this[_0x2dc69d(0xb4)]();if(!_0x338425)return![];const _0x2fc789=[(this.#isApp?_0x61d903['IGCSG']:_0x61d903[_0x2dc69d(0xca)])+':start'];_0x46c93a&&_0x2fc789[_0x2dc69d(0xba)]('-c',_0x46c93a);this.#proc=_0x61d903[_0x2dc69d(0x8e)](spawn,_0x1f44c7,_0x2fc789,{'env':Object[_0x2dc69d(0x9c)](process[_0x2dc69d(0xbc)],{'PERCY_TOKEN':_0x338425,'TH_BUILD_UUID':process[_0x2dc69d(0xbc)][testHubConstants[_0x2dc69d(0x94)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x2dc69d(0x9d)][_0x2dc69d(0x96)](this.#logStream),this.#proc['stderr'][_0x2dc69d(0x96)](this.#logStream),this[_0x2dc69d(0xcc)]=!![];var _0x4f3341=this;this.#proc['on'](_0x61d903[_0x2dc69d(0xa5)],function(_0x498b94){const _0x443e3e=_0x2dc69d;_0x4f3341[_0x443e3e(0xcc)]=![];});do{const _0x2e2574=await this[_0x2dc69d(0x91)]();if(_0x2e2574)return logger[_0x2dc69d(0xab)](_0x61d903[_0x2dc69d(0xb8)]),!![];await this.#sleep(0x3e8);}while(this[_0x2dc69d(0xcc)]);return![];}async['stop'](){const _0x29bd62=a112_0x4f585a,_0x371c28={'RsnhN':function(_0x62514,_0x55652d){return _0x62514(_0x55652d);},'okAyE':function(_0x51b431,_0x40d72e,_0x2c7f8f){return _0x51b431(_0x40d72e,_0x2c7f8f);},'nPblw':_0x29bd62(0x8d),'dQepB':'close'},_0x55ed13=await this.#getBinaryPath();return new Promise((_0x55c7de,_0x48e49e)=>{const _0x21a45c=_0x29bd62,_0x56893f={'hBFSY':function(_0x4ba9e7,_0x4ad3a5){return _0x371c28['RsnhN'](_0x4ba9e7,_0x4ad3a5);}},_0x2d6e69=_0x371c28['okAyE'](spawn,_0x55ed13,[_0x371c28[_0x21a45c(0x9b)]]);_0x2d6e69['on'](_0x371c28[_0x21a45c(0xa1)],_0x37ac36=>{const _0x264569=_0x21a45c;this['isProcessRunning']=![],this.#logStream&&(this.#logStream[_0x264569(0xa0)](),this.#logStream=null),_0x56893f[_0x264569(0xb9)](_0x55c7de,_0x37ac36);});});}[a112_0x4f585a(0xa9)](){return this['isProcessRunning'];}async[a112_0x4f585a(0xaf)](){const _0x5f0459=a112_0x4f585a,_0x265625={};_0x265625['igzyn']='app',_0x265625['eBfxv']=_0x5f0459(0xc0),_0x265625[_0x5f0459(0xbb)]=_0x5f0459(0xc8),_0x265625[_0x5f0459(0xb7)]=_0x5f0459(0xb5);const _0x20d05=_0x265625,_0x280c4c=this.#config['projectName'];try{const _0x5449fa=this.#isApp?_0x20d05[_0x5f0459(0xcd)]:_0x20d05[_0x5f0459(0xaa)],_0x4c14da=await helper[_0x5f0459(0x8a)](_0x20d05[_0x5f0459(0xbb)],_0x5f0459(0xd0)+_0x280c4c+_0x5f0459(0xa2)+_0x5449fa,{},this.#config),_0x11f280=_0x4c14da['data'];return logger['debug'](_0x20d05[_0x5f0459(0xb7)]),_0x11f280['token'];}catch(_0x3c7a7b){return logger['error'](_0x5f0459(0xae)+_0x3c7a7b),null;}}async[a112_0x4f585a(0xb4)](){const _0x1f88ea=a112_0x4f585a,_0x4b25b4={'KSoPQ':function(_0x5af52b,_0x1059d2){return _0x5af52b(_0x1059d2);},'arScj':function(_0x355c0c,_0x4f2a76){return _0x355c0c+_0x4f2a76;},'xPThe':_0x1f88ea(0xc5),'DeYjF':_0x1f88ea(0xb6)};if(!this.#config[_0x1f88ea(0x9a)])return null;const _0x4b0c63=path[_0x1f88ea(0xb1)](os[_0x1f88ea(0xa8)](),_0x4b25b4[_0x1f88ea(0x8f)]),_0x14cd2a=this.#config[_0x1f88ea(0x9a)];return!_0x14cd2a[_0x1f88ea(0x98)]&&(_0x14cd2a['version']='2'),new Promise((_0x2c322c,_0xacdbd2)=>{const _0x1b2e1e=_0x1f88ea,_0x5a4bab={'KpBNR':function(_0x563218,_0x344c37){return _0x4b25b4['KSoPQ'](_0x563218,_0x344c37);},'jqGJY':function(_0x1cc339,_0x33abdf){const _0x1b3366=a112_0x3bb0;return _0x4b25b4[_0x1b3366(0x92)](_0x1cc339,_0x33abdf);},'lQXYe':_0x4b25b4[_0x1b2e1e(0x8c)]};fs['writeFile'](_0x4b0c63,JSON[_0x1b2e1e(0x8b)](_0x14cd2a),_0x3985a0=>{const _0x20de04=_0x1b2e1e;_0x3985a0&&(logger[_0x20de04(0x9f)](_0x20de04(0x89)+_0x3985a0),_0x5a4bab['KpBNR'](_0x2c322c,null)),logger[_0x20de04(0xab)](_0x5a4bab[_0x20de04(0x95)](_0x5a4bab[_0x20de04(0xc6)],_0x4b0c63)),_0x5a4bab['KpBNR'](_0x2c322c,_0x4b0c63);});});}}function a112_0x3bb0(_0x100c7d,_0x3c1467){const _0x26d652=a112_0x26d6();return a112_0x3bb0=function(_0x3bb01b,_0x33189f){_0x3bb01b=_0x3bb01b-0x87;let _0x50d5d1=_0x26d652[_0x3bb01b];return _0x50d5d1;},a112_0x3bb0(_0x100c7d,_0x3c1467);}module[a112_0x4f585a(0xcf)]=Percy;
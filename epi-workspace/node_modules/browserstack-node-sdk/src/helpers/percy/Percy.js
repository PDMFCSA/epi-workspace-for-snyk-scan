const a72_0x2f8da0=a72_0x1baf;(function(_0xa31566,_0x120a2d){const _0x5e4e1d=a72_0x1baf,_0xe513b9=_0xa31566();while(!![]){try{const _0x1646a9=-parseInt(_0x5e4e1d(0x11b))/0x1+parseInt(_0x5e4e1d(0x148))/0x2*(-parseInt(_0x5e4e1d(0x13a))/0x3)+-parseInt(_0x5e4e1d(0x154))/0x4*(-parseInt(_0x5e4e1d(0x127))/0x5)+-parseInt(_0x5e4e1d(0x119))/0x6+parseInt(_0x5e4e1d(0x11a))/0x7+-parseInt(_0x5e4e1d(0x15c))/0x8+parseInt(_0x5e4e1d(0x11f))/0x9;if(_0x1646a9===_0x120a2d)break;else _0xe513b9['push'](_0xe513b9['shift']());}catch(_0x37b656){_0xe513b9['push'](_0xe513b9['shift']());}}}(a72_0x4c20,0x573f3));function a72_0x1baf(_0x4722c9,_0x42f4da){const _0x4c2015=a72_0x4c20();return a72_0x1baf=function(_0x1baf15,_0xca5706){_0x1baf15=_0x1baf15-0x112;let _0x1234c2=_0x4c2015[_0x1baf15];return _0x1234c2;},a72_0x1baf(_0x4722c9,_0x42f4da);}const fs=require('fs'),path=require(a72_0x2f8da0(0x112)),os=require('os'),{spawn}=require('child_process'),helper=require(a72_0x2f8da0(0x15b)),logger=require(a72_0x2f8da0(0x157))[a72_0x2f8da0(0x143)],{getLogDir}=require(a72_0x2f8da0(0x157)),testHubConstants=require(a72_0x2f8da0(0x158)),PerformanceTester=require(a72_0x2f8da0(0x121)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x2f8da0(0x150)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path['join'](getLogDir(),a72_0x2f8da0(0x14e));#address=process[a72_0x2f8da0(0x13d)][a72_0x2f8da0(0x11e)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0xadb323){const _0x3192ad=a72_0x2f8da0;this.#config=_0xadb323,!!_0xadb323[_0x3192ad(0x132)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x26ed1e=a72_0x2f8da0;if(!this.#binaryPath){const _0x1fb8db=new PercyBinary();PerformanceTester[_0x26ed1e(0x126)](PerformanceEvents[_0x26ed1e(0x14f)]),this.#binaryPath=await _0x1fb8db['getBinaryPath'](this.#config),PerformanceTester['end'](PerformanceEvents[_0x26ed1e(0x14f)]);}return this.#binaryPath;}async #sleep(_0x5909c7){return new Promise(_0x2e1c18=>setTimeout(_0x2e1c18,_0x5909c7));}async[a72_0x2f8da0(0x129)](){const _0x262c8c=a72_0x2f8da0,_0x1c35dd={};_0x1c35dd[_0x262c8c(0x151)]=_0x262c8c(0x13e),_0x1c35dd[_0x262c8c(0x12c)]='percy/healthcheck';const _0x52dca7=_0x1c35dd;try{const _0x4a3d0d=await helper['nodeRequest'](_0x52dca7[_0x262c8c(0x151)],_0x52dca7[_0x262c8c(0x12c)],null,null,this.#address);if(_0x4a3d0d)return!![];}catch(_0x32db1c){return![];}}async[a72_0x2f8da0(0x126)](){const _0x1c8b54=a72_0x2f8da0,_0x4490dc={'wLCtJ':_0x1c8b54(0x14a),'MwQHz':_0x1c8b54(0x152),'LRZWG':function(_0x2234ca,_0xd6a4f0,_0x1c3a8c,_0x2ed6a9){return _0x2234ca(_0xd6a4f0,_0x1c3a8c,_0x2ed6a9);},'bJzhZ':'close','evcrZ':_0x1c8b54(0x159)},_0x26cac4=await this.#getBinaryPath(),_0x557dd1={};_0x557dd1['flags']='a';const _0x1cf1dd=fs['createWriteStream'](this.#logfile,_0x557dd1),_0x247be3=await this['fetchPercyToken'](),_0x468b84=await this[_0x1c8b54(0x147)]();if(!_0x247be3)return![];const _0x13b96e=[(this.#isApp?_0x4490dc[_0x1c8b54(0x138)]:_0x4490dc['MwQHz'])+':start'];_0x468b84&&_0x13b96e[_0x1c8b54(0x122)]('-c',_0x468b84);this.#proc=_0x4490dc[_0x1c8b54(0x14b)](spawn,_0x26cac4,_0x13b96e,{'env':Object[_0x1c8b54(0x141)](process[_0x1c8b54(0x13d)],{'PERCY_TOKEN':_0x247be3,'TH_BUILD_UUID':process[_0x1c8b54(0x13d)][testHubConstants[_0x1c8b54(0x12d)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc['stdout'][_0x1c8b54(0x136)](_0x1cf1dd),this.#proc[_0x1c8b54(0x153)]['pipe'](_0x1cf1dd),this[_0x1c8b54(0x12e)]=!![];var _0x18386b=this;this.#proc['on'](_0x4490dc['bJzhZ'],function(_0x2a6851){_0x18386b['isProcessRunning']=![];});do{const _0x384e90=await this[_0x1c8b54(0x129)]();if(_0x384e90)return logger[_0x1c8b54(0x140)](_0x4490dc[_0x1c8b54(0x133)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x2f8da0(0x113)](){const _0x1cf978=a72_0x2f8da0,_0x258dc3={'ClymN':function(_0x4d87a0,_0x46010f){return _0x4d87a0(_0x46010f);},'hdZTP':function(_0x51d6aa,_0x17dfc3,_0x23595f){return _0x51d6aa(_0x17dfc3,_0x23595f);},'QriZI':_0x1cf978(0x146),'nMiVl':_0x1cf978(0x131)},_0x282c09=await this.#getBinaryPath();return new Promise((_0xa140c4,_0xfb4158)=>{const _0x49a3b6=_0x1cf978,_0x730bc8={'vDXzC':function(_0x101bd9,_0x5ce9b3){return _0x258dc3['ClymN'](_0x101bd9,_0x5ce9b3);}},_0xb8535c=_0x258dc3[_0x49a3b6(0x123)](spawn,_0x282c09,[_0x258dc3[_0x49a3b6(0x130)]]);_0xb8535c['on'](_0x258dc3[_0x49a3b6(0x117)],_0xfbf7c9=>{const _0x523e64=_0x49a3b6;this[_0x523e64(0x12e)]=![],_0x730bc8[_0x523e64(0x137)](_0xa140c4,_0xfbf7c9);});});}[a72_0x2f8da0(0x14c)](){const _0x35c828=a72_0x2f8da0;return this[_0x35c828(0x12e)];}async[a72_0x2f8da0(0x144)](){const _0x53b10a=a72_0x2f8da0,_0x127cf0={};_0x127cf0[_0x53b10a(0x11c)]=_0x53b10a(0x132),_0x127cf0['UmDaN']=_0x53b10a(0x13f),_0x127cf0[_0x53b10a(0x114)]=_0x53b10a(0x13e),_0x127cf0['tNtvH']=_0x53b10a(0x13c);const _0x15fd17=_0x127cf0,_0x18105e=this.#config[_0x53b10a(0x142)];try{const _0xb86021=this.#isApp?_0x15fd17[_0x53b10a(0x11c)]:_0x15fd17[_0x53b10a(0x115)],_0x4fe9c5=await helper[_0x53b10a(0x155)](_0x15fd17[_0x53b10a(0x114)],_0x53b10a(0x13b)+_0x18105e+_0x53b10a(0x149)+_0xb86021,{},this.#config),_0x166380=_0x4fe9c5[_0x53b10a(0x12a)];return logger['debug'](_0x15fd17[_0x53b10a(0x116)]),_0x166380['token'];}catch(_0xb2f2d9){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0xb2f2d9),null;}}async[a72_0x2f8da0(0x147)](){const _0x1ba4a8=a72_0x2f8da0,_0x58bd6f={'ODwSx':function(_0x42d4a3,_0x7697a6){return _0x42d4a3(_0x7697a6);},'iGhHZ':function(_0x5aeb9c,_0x538594){return _0x5aeb9c+_0x538594;},'kipGl':_0x1ba4a8(0x139),'SnhrF':_0x1ba4a8(0x14d)};if(!this.#config[_0x1ba4a8(0x11d)])return null;const _0x22a134=path[_0x1ba4a8(0x145)](os[_0x1ba4a8(0x12f)](),_0x58bd6f['SnhrF']),_0x254394=this.#config['percyOptions'];return!_0x254394[_0x1ba4a8(0x12b)]&&(_0x254394[_0x1ba4a8(0x12b)]='2'),new Promise((_0x22f351,_0x3d2efc)=>{const _0x155658=_0x1ba4a8,_0x372ad4={'nNzmm':function(_0xe93dfb,_0x2028dc){const _0x5c74a5=a72_0x1baf;return _0x58bd6f[_0x5c74a5(0x118)](_0xe93dfb,_0x2028dc);},'APnpj':function(_0x2e9e86,_0x1f2fee){return _0x58bd6f['iGhHZ'](_0x2e9e86,_0x1f2fee);},'OZrqc':_0x58bd6f[_0x155658(0x15a)]};fs['writeFile'](_0x22a134,JSON[_0x155658(0x124)](_0x254394),_0x2a81dc=>{const _0x542ce9=_0x155658;_0x2a81dc&&(logger[_0x542ce9(0x134)](_0x542ce9(0x120)+_0x2a81dc),_0x372ad4[_0x542ce9(0x125)](_0x22f351,null)),logger[_0x542ce9(0x140)](_0x372ad4[_0x542ce9(0x128)](_0x372ad4[_0x542ce9(0x156)],_0x22a134)),_0x372ad4[_0x542ce9(0x125)](_0x22f351,_0x22a134);});});}}module[a72_0x2f8da0(0x135)]=Percy;function a72_0x4c20(){const _0x229470=['evcrZ','error','exports','pipe','vDXzC','wLCtJ','Percy\x20config\x20created\x20at\x20','55866rfifoZ','api/app_percy/get_project_token?name=','Percy\x20fetch\x20token\x20success','env','GET','automate','debug','assign','projectName','winstonLogger','fetchPercyToken','join','exec:stop','createPercyConfig','4BhHtVh','&type=','app:exec','LRZWG','isRunning','percy.json','percy.log','DOWNLOAD','../../helpers/performance/constants','srLym','exec','stderr','608jrNzqN','nodeRequest','OZrqc','../logger','../../helpers/testhub/constants','Percy\x20healthcheck\x20successful','kipGl','../helper','1209856kKkaiA','path','stop','dftQy','UmDaN','tNtvH','nMiVl','ODwSx','1525956bDswAq','1888383gWpzjo','462516ilHYeq','dqLOq','percyOptions','PERCY_SERVER_ADDRESS','8477928tuwTBn','Error\x20creating\x20percy\x20config:\x20','../../helpers/performance/performance-tester','push','hdZTP','stringify','nNzmm','start','1675KVhkWk','APnpj','healthcheck','data','version','vxaxr','ENV_VAR','isProcessRunning','tmpdir','QriZI','close','app'];a72_0x4c20=function(){return _0x229470;};return a72_0x4c20();}
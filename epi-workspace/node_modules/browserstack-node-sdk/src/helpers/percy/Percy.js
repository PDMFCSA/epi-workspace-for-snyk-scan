const a101_0x3ffb09=a101_0x3d46;(function(_0x29b751,_0x35039f){const _0x2028ed=a101_0x3d46,_0x269d30=_0x29b751();while(!![]){try{const _0x3dd422=parseInt(_0x2028ed(0x213))/0x1*(parseInt(_0x2028ed(0x1fd))/0x2)+parseInt(_0x2028ed(0x222))/0x3*(parseInt(_0x2028ed(0x218))/0x4)+parseInt(_0x2028ed(0x1f8))/0x5+-parseInt(_0x2028ed(0x224))/0x6+parseInt(_0x2028ed(0x221))/0x7*(parseInt(_0x2028ed(0x217))/0x8)+parseInt(_0x2028ed(0x23d))/0x9*(parseInt(_0x2028ed(0x20e))/0xa)+parseInt(_0x2028ed(0x214))/0xb*(-parseInt(_0x2028ed(0x201))/0xc);if(_0x3dd422===_0x35039f)break;else _0x269d30['push'](_0x269d30['shift']());}catch(_0x17a854){_0x269d30['push'](_0x269d30['shift']());}}}(a101_0x35f7,0x41689));const fs=require('fs'),path=require(a101_0x3ffb09(0x232)),os=require('os'),{spawn}=require('child_process'),helper=require('../helper'),logger=require('../logger')[a101_0x3ffb09(0x215)],{getLogDir}=require(a101_0x3ffb09(0x228)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a101_0x3ffb09(0x23c)),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x3ffb09(0x23a)),PercyBinary=require(a101_0x3ffb09(0x22c));class Percy{#logfile=path[a101_0x3ffb09(0x231)](getLogDir(),a101_0x3ffb09(0x225));#address=process[a101_0x3ffb09(0x22f)][a101_0x3ffb09(0x238)]||a101_0x3ffb09(0x21a);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a101_0x3ffb09(0x22a)]=![];constructor(_0x20ff78){this.#config=_0x20ff78,!!_0x20ff78['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x4711d1=a101_0x3ffb09;if(!this.#binaryPath){const _0x5f5296=new PercyBinary();PerformanceTester[_0x4711d1(0x21c)](PerformanceEvents[_0x4711d1(0x235)]),this.#binaryPath=await _0x5f5296[_0x4711d1(0x216)](this.#config),PerformanceTester[_0x4711d1(0x21e)](PerformanceEvents[_0x4711d1(0x235)]);}return this.#binaryPath;}async #sleep(_0x55bb19){return new Promise(_0x4f580e=>setTimeout(_0x4f580e,_0x55bb19));}async['healthcheck'](){const _0x46aacf=a101_0x3ffb09,_0xe66bda={};_0xe66bda['IZFee']='GET',_0xe66bda[_0x46aacf(0x20d)]='percy/healthcheck';const _0xbcc9b3=_0xe66bda;try{const _0x56db8f=await helper['nodeRequest'](_0xbcc9b3[_0x46aacf(0x1f5)],_0xbcc9b3[_0x46aacf(0x20d)],null,null,this.#address);if(_0x56db8f)return!![];}catch(_0x256187){return![];}}async[a101_0x3ffb09(0x21c)](){const _0x3bf814=a101_0x3ffb09,_0x447d0c={'azkoU':_0x3bf814(0x1f6),'pxTfZ':_0x3bf814(0x208),'XmdUN':function(_0xa17d22,_0x1b205c,_0xa3b2a1,_0x3d8d88){return _0xa17d22(_0x1b205c,_0xa3b2a1,_0x3d8d88);},'NrzAi':_0x3bf814(0x219),'KdRZz':'Percy\x20healthcheck\x20successful'},_0x574c39=await this.#getBinaryPath(),_0x547f40={};_0x547f40[_0x3bf814(0x22e)]='a';const _0x3c1dd4=fs[_0x3bf814(0x227)](this.#logfile,_0x547f40),_0x5c6721=await this['fetchPercyToken'](),_0x4e9482=await this[_0x3bf814(0x1fe)]();if(!_0x5c6721)return![];const _0x1b0a4a=[(this.#isApp?_0x447d0c[_0x3bf814(0x1fb)]:_0x447d0c[_0x3bf814(0x20f)])+_0x3bf814(0x206)];_0x4e9482&&_0x1b0a4a['push']('-c',_0x4e9482);this.#proc=_0x447d0c['XmdUN'](spawn,_0x574c39,_0x1b0a4a,{'env':Object[_0x3bf814(0x1fc)](process[_0x3bf814(0x22f)],{'PERCY_TOKEN':_0x5c6721,'TH_BUILD_UUID':process[_0x3bf814(0x22f)][testHubConstants[_0x3bf814(0x229)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x3bf814(0x20c)]['pipe'](_0x3c1dd4),this.#proc['stderr']['pipe'](_0x3c1dd4),this['isProcessRunning']=!![];var _0x105e62=this;this.#proc['on'](_0x447d0c[_0x3bf814(0x1f4)],function(_0x46252c){const _0x2f8d7e=_0x3bf814;_0x105e62[_0x2f8d7e(0x22a)]=![];});do{const _0x11f5ad=await this[_0x3bf814(0x21d)]();if(_0x11f5ad)return logger[_0x3bf814(0x210)](_0x447d0c[_0x3bf814(0x236)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async['stop'](){const _0x5aa62d=a101_0x3ffb09,_0x592c13={'GHxZx':function(_0x339061,_0x38cbbc){return _0x339061(_0x38cbbc);},'yvtMW':function(_0x4f7724,_0x1d28d0,_0x4d459e){return _0x4f7724(_0x1d28d0,_0x4d459e);},'EWVnN':_0x5aa62d(0x209),'elkYc':_0x5aa62d(0x219)},_0x25e09f=await this.#getBinaryPath();return new Promise((_0x53876f,_0x22f588)=>{const _0x1134d8=_0x5aa62d,_0x5197e0=_0x592c13[_0x1134d8(0x220)](spawn,_0x25e09f,[_0x592c13[_0x1134d8(0x22b)]]);_0x5197e0['on'](_0x592c13['elkYc'],_0x20b09b=>{const _0x13fb78=_0x1134d8;this[_0x13fb78(0x22a)]=![],_0x592c13[_0x13fb78(0x23b)](_0x53876f,_0x20b09b);});});}['isRunning'](){const _0xbd7e8=a101_0x3ffb09;return this[_0xbd7e8(0x22a)];}async[a101_0x3ffb09(0x200)](){const _0x48f6d0=a101_0x3ffb09,_0x34fad6={};_0x34fad6[_0x48f6d0(0x234)]=_0x48f6d0(0x211),_0x34fad6['PPqBn']=_0x48f6d0(0x212),_0x34fad6[_0x48f6d0(0x223)]='GET',_0x34fad6['Xjsnj']=_0x48f6d0(0x204);const _0x38ad97=_0x34fad6,_0x75bc4b=this.#config[_0x48f6d0(0x237)];try{const _0x36a1de=this.#isApp?_0x38ad97['nvcjE']:_0x38ad97[_0x48f6d0(0x230)],_0x1bc91b=await helper[_0x48f6d0(0x203)](_0x38ad97[_0x48f6d0(0x223)],_0x48f6d0(0x21b)+_0x75bc4b+_0x48f6d0(0x1ff)+_0x36a1de,{},this.#config),_0x242d2a=_0x1bc91b[_0x48f6d0(0x226)];return logger['debug'](_0x38ad97[_0x48f6d0(0x233)]),_0x242d2a[_0x48f6d0(0x1fa)];}catch(_0x40bc27){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x40bc27),null;}}async[a101_0x3ffb09(0x1fe)](){const _0x571c3b=a101_0x3ffb09,_0x1869f6={'rPQDU':function(_0x2677ac,_0x439108){return _0x2677ac(_0x439108);},'SPror':function(_0xb7039e,_0x393e28){return _0xb7039e+_0x393e28;},'Jpbti':_0x571c3b(0x21f),'wqckb':function(_0x3daa28,_0x33d271){return _0x3daa28(_0x33d271);},'JPgJe':_0x571c3b(0x20b)};if(!this.#config['percyOptions'])return null;const _0x2df273=path[_0x571c3b(0x231)](os[_0x571c3b(0x1f9)](),_0x1869f6[_0x571c3b(0x207)]),_0x58c32a=this.#config['percyOptions'];return!_0x58c32a[_0x571c3b(0x22d)]&&(_0x58c32a[_0x571c3b(0x22d)]='2'),new Promise((_0x464980,_0x242ff6)=>{const _0x387838=_0x571c3b;fs[_0x387838(0x205)](_0x2df273,JSON[_0x387838(0x20a)](_0x58c32a),_0x4631e6=>{const _0x272d51=_0x387838;_0x4631e6&&(logger[_0x272d51(0x1f7)](_0x272d51(0x239)+_0x4631e6),_0x1869f6['rPQDU'](_0x464980,null)),logger[_0x272d51(0x210)](_0x1869f6['SPror'](_0x1869f6['Jpbti'],_0x2df273)),_0x1869f6[_0x272d51(0x202)](_0x464980,_0x2df273);});});}}function a101_0x3d46(_0x49b4fb,_0x445984){const _0x35f7f7=a101_0x35f7();return a101_0x3d46=function(_0x3d466a,_0x3fbd70){_0x3d466a=_0x3d466a-0x1f4;let _0x4db367=_0x35f7f7[_0x3d466a];return _0x4db367;},a101_0x3d46(_0x49b4fb,_0x445984);}function a101_0x35f7(){const _0x135f2d=['http://localhost:5338','api/app_percy/get_project_token?name=','start','healthcheck','end','Percy\x20config\x20created\x20at\x20','yvtMW','21NHQYhf','260499trfIvZ','imdGa','170550SPOKRX','percy.log','data','createWriteStream','../logger','ENV_VAR','isProcessRunning','EWVnN','./PercyBinary','version','flags','env','PPqBn','join','path','Xjsnj','nvcjE','DOWNLOAD','KdRZz','projectName','PERCY_SERVER_ADDRESS','Error\x20creating\x20percy\x20config:\x20','../../helpers/performance/constants','GHxZx','../../helpers/performance/performance-tester','1691469FLVyKp','NrzAi','IZFee','app:exec','error','2534640euENuE','tmpdir','token','azkoU','assign','44762qnPoen','createPercyConfig','&type=','fetchPercyToken','228OgaidP','wqckb','nodeRequest','Percy\x20fetch\x20token\x20success','writeFile',':start','JPgJe','exec','exec:stop','stringify','percy.json','stdout','yuOdR','10hlLKUA','pxTfZ','debug','app','automate','14KnaHQk','904123VQmPAY','winstonLogger','getBinaryPath','1339920fjooCV','16uDFcet','close'];a101_0x35f7=function(){return _0x135f2d;};return a101_0x35f7();}module['exports']=Percy;
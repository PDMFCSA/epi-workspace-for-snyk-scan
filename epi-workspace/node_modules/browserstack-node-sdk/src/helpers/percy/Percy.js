const a103_0x30f317=a103_0x3bfd;function a103_0x3bfd(_0x534534,_0xb339e2){const _0x3aa3ee=a103_0x3aa3();return a103_0x3bfd=function(_0x3bfd30,_0x37c644){_0x3bfd30=_0x3bfd30-0xe8;let _0xbebfb1=_0x3aa3ee[_0x3bfd30];return _0xbebfb1;},a103_0x3bfd(_0x534534,_0xb339e2);}(function(_0x16345c,_0x30f6d0){const _0x11295a=a103_0x3bfd,_0x1c9a0f=_0x16345c();while(!![]){try{const _0x34df34=-parseInt(_0x11295a(0x11b))/0x1+parseInt(_0x11295a(0x127))/0x2+parseInt(_0x11295a(0x12b))/0x3+parseInt(_0x11295a(0x108))/0x4*(parseInt(_0x11295a(0xee))/0x5)+-parseInt(_0x11295a(0x118))/0x6+parseInt(_0x11295a(0x11c))/0x7*(parseInt(_0x11295a(0x136))/0x8)+parseInt(_0x11295a(0x12d))/0x9*(-parseInt(_0x11295a(0x12c))/0xa);if(_0x34df34===_0x30f6d0)break;else _0x1c9a0f['push'](_0x1c9a0f['shift']());}catch(_0x28e16f){_0x1c9a0f['push'](_0x1c9a0f['shift']());}}}(a103_0x3aa3,0x700c8));const fs=require('fs'),path=require(a103_0x30f317(0x123)),os=require('os'),{spawn}=require(a103_0x30f317(0xfb)),helper=require(a103_0x30f317(0x104)),logger=require(a103_0x30f317(0xfe))[a103_0x30f317(0xf0)],{getLogDir}=require('../logger'),testHubConstants=require(a103_0x30f317(0x103)),PerformanceTester=require(a103_0x30f317(0x107)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a103_0x30f317(0x11a));function a103_0x3aa3(){const _0x246a62=['rSGCF','exec:stop','env','1627032cArbXr','32650ljGoxV','1746pmmEiP','Error\x20creating\x20percy\x20config:\x20','jveRQ','RuoKi','percyOptions','stdout','rDvol','BrQDF','version','301064umgRqU','stringify','error','end','Percy\x20healthcheck\x20successful','automate','stop','fGgzR','join','GMvaG','15KQHpHr','start','winstonLogger','ICBzF','nodeRequest','uBskC','JcHrP','XBmmI','flags','exports','GET','percy.log',':start','child_process','healthcheck','BROWSERSTACK_TESTHUB_UUID','../logger','CeqYY','isProcessRunning','close','PERCY_SERVER_ADDRESS','../../helpers/testhub/constants','../helper','writeFile','pipe','../../helpers/performance/performance-tester','369244vNDNTM','fetchPercyToken','PUmdU','qrTJB','HAKuq','mJHxH','Percy\x20fetch\x20token\x20success','stderr','YJJFi','DOWNLOAD','&type=','api/app_percy/get_project_token?name=','app','getBinaryPath','projectName','rHWiy','389586GqeAQh','ZmCqM','./PercyBinary','526460jlZjAA','98byWxTi','ENV_VAR','exec','createPercyConfig','MKKtD','http://localhost:5338','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','path','debug','percy.json','data','675228MVIaln'];a103_0x3aa3=function(){return _0x246a62;};return a103_0x3aa3();}class Percy{#logfile=path[a103_0x30f317(0xec)](getLogDir(),a103_0x30f317(0xf9));#address=process[a103_0x30f317(0x12a)][a103_0x30f317(0x102)]||a103_0x30f317(0x121);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a103_0x30f317(0x100)]=![];constructor(_0x4bc500){const _0x220f1b=a103_0x30f317;this.#config=_0x4bc500,!!_0x4bc500[_0x220f1b(0x114)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x1a3cb7=a103_0x30f317;if(!this.#binaryPath){const _0x5e48af=new PercyBinary();PerformanceTester[_0x1a3cb7(0xef)](PerformanceEvents[_0x1a3cb7(0x111)]),this.#binaryPath=await _0x5e48af[_0x1a3cb7(0x115)](this.#config),PerformanceTester[_0x1a3cb7(0x139)](PerformanceEvents[_0x1a3cb7(0x111)]);}return this.#binaryPath;}async #sleep(_0x1c19e9){return new Promise(_0x5d787c=>setTimeout(_0x5d787c,_0x1c19e9));}async[a103_0x30f317(0xfc)](){const _0x5a3543=a103_0x30f317,_0x2eb14e={};_0x2eb14e['ICBzF']=_0x5a3543(0xf8),_0x2eb14e[_0x5a3543(0x10a)]='percy/healthcheck';const _0x2dd33b=_0x2eb14e;try{const _0x4b9c25=await helper[_0x5a3543(0xf2)](_0x2dd33b[_0x5a3543(0xf1)],_0x2dd33b[_0x5a3543(0x10a)],null,null,this.#address);if(_0x4b9c25)return!![];}catch(_0x38fa90){return![];}}async[a103_0x30f317(0xef)](){const _0x12966c=a103_0x30f317,_0x56785d={'rHWiy':'app:exec','fGgzR':_0x12966c(0x11e),'RuoKi':function(_0x50c07f,_0x4e55e9,_0x5b2dba,_0xf4ad2){return _0x50c07f(_0x4e55e9,_0x5b2dba,_0xf4ad2);},'MKKtD':_0x12966c(0x101),'vtkZH':_0x12966c(0xe8)},_0x41586f=await this.#getBinaryPath(),_0x1df8fb={};_0x1df8fb[_0x12966c(0xf6)]='a';const _0x5868f9=fs['createWriteStream'](this.#logfile,_0x1df8fb),_0x13fdc7=await this[_0x12966c(0x109)](),_0x536114=await this[_0x12966c(0x11f)]();if(!_0x13fdc7)return![];const _0x465751=[(this.#isApp?_0x56785d[_0x12966c(0x117)]:_0x56785d[_0x12966c(0xeb)])+_0x12966c(0xfa)];_0x536114&&_0x465751['push']('-c',_0x536114);this.#proc=_0x56785d[_0x12966c(0x130)](spawn,_0x41586f,_0x465751,{'env':Object['assign'](process['env'],{'PERCY_TOKEN':_0x13fdc7,'TH_BUILD_UUID':process[_0x12966c(0x12a)][testHubConstants[_0x12966c(0x11d)][_0x12966c(0xfd)]]})}),this.#proc[_0x12966c(0x132)][_0x12966c(0x106)](_0x5868f9),this.#proc[_0x12966c(0x10f)][_0x12966c(0x106)](_0x5868f9),this[_0x12966c(0x100)]=!![];var _0xaf591b=this;this.#proc['on'](_0x56785d[_0x12966c(0x120)],function(_0x4a2385){const _0x40da3e=_0x12966c;_0xaf591b[_0x40da3e(0x100)]=![];});do{const _0x5ca42c=await this[_0x12966c(0xfc)]();if(_0x5ca42c)return logger[_0x12966c(0x124)](_0x56785d['vtkZH']),!![];await this.#sleep(0x3e8);}while(this[_0x12966c(0x100)]);return![];}async[a103_0x30f317(0xea)](){const _0x2bed37=a103_0x30f317,_0x24ef52={'uBskC':function(_0x21afcb,_0x5a07a6){return _0x21afcb(_0x5a07a6);},'qrTJB':function(_0x57acdc,_0x9b875f,_0x171732){return _0x57acdc(_0x9b875f,_0x171732);},'XBmmI':_0x2bed37(0x129),'BrQDF':_0x2bed37(0x101)},_0x1ce101=await this.#getBinaryPath();return new Promise((_0x31d64c,_0x3698f0)=>{const _0x28ecd6=_0x2bed37,_0x299a82={'rDvol':function(_0x34aefd,_0x56a81b){const _0x2c5158=a103_0x3bfd;return _0x24ef52[_0x2c5158(0xf3)](_0x34aefd,_0x56a81b);}},_0x3c8894=_0x24ef52[_0x28ecd6(0x10b)](spawn,_0x1ce101,[_0x24ef52[_0x28ecd6(0xf5)]]);_0x3c8894['on'](_0x24ef52[_0x28ecd6(0x134)],_0x9c808e=>{const _0x561de6=_0x28ecd6;this[_0x561de6(0x100)]=![],_0x299a82[_0x561de6(0x133)](_0x31d64c,_0x9c808e);});});}['isRunning'](){const _0x35c062=a103_0x30f317;return this[_0x35c062(0x100)];}async[a103_0x30f317(0x109)](){const _0x4fab4c=a103_0x30f317,_0x47b2dd={};_0x47b2dd[_0x4fab4c(0xf4)]='app',_0x47b2dd[_0x4fab4c(0x128)]=_0x4fab4c(0xe9),_0x47b2dd[_0x4fab4c(0xff)]=_0x4fab4c(0xf8),_0x47b2dd[_0x4fab4c(0x10d)]=_0x4fab4c(0x10e);const _0x328e29=_0x47b2dd,_0x317ef4=this.#config[_0x4fab4c(0x116)];try{const _0x36c8f6=this.#isApp?_0x328e29[_0x4fab4c(0xf4)]:_0x328e29['rSGCF'],_0x32930a=await helper[_0x4fab4c(0xf2)](_0x328e29[_0x4fab4c(0xff)],_0x4fab4c(0x113)+_0x317ef4+_0x4fab4c(0x112)+_0x36c8f6,{},this.#config),_0x2e4bc3=_0x32930a[_0x4fab4c(0x126)];return logger[_0x4fab4c(0x124)](_0x328e29[_0x4fab4c(0x10d)]),_0x2e4bc3['token'];}catch(_0xd536be){return logger['error'](_0x4fab4c(0x122)+_0xd536be),null;}}async['createPercyConfig'](){const _0x33023e=a103_0x30f317,_0x2d54ba={'HAKuq':function(_0x1ae730,_0x1b22bd){return _0x1ae730(_0x1b22bd);},'Efjtt':function(_0x427185,_0x4ed3e9){return _0x427185+_0x4ed3e9;},'ZmCqM':'Percy\x20config\x20created\x20at\x20','GMvaG':_0x33023e(0x125)};if(!this.#config['percyOptions'])return null;const _0x3bcb13=path['join'](os['tmpdir'](),_0x2d54ba[_0x33023e(0xed)]),_0x140313=this.#config[_0x33023e(0x131)];return!_0x140313[_0x33023e(0x135)]&&(_0x140313[_0x33023e(0x135)]='2'),new Promise((_0x36dcbb,_0x440ae5)=>{const _0x1eac38=_0x33023e,_0x436a0f={'jveRQ':function(_0x550af0,_0x3c7e1f){return _0x2d54ba['HAKuq'](_0x550af0,_0x3c7e1f);},'YJJFi':function(_0x4d5b04,_0x4b321e){return _0x2d54ba['Efjtt'](_0x4d5b04,_0x4b321e);},'fXjoW':_0x2d54ba[_0x1eac38(0x119)],'gGrFH':function(_0x339d60,_0x3a61b3){const _0x18a698=_0x1eac38;return _0x2d54ba[_0x18a698(0x10c)](_0x339d60,_0x3a61b3);}};fs[_0x1eac38(0x105)](_0x3bcb13,JSON[_0x1eac38(0x137)](_0x140313),_0x5521e6=>{const _0xb1eac8=_0x1eac38;_0x5521e6&&(logger[_0xb1eac8(0x138)](_0xb1eac8(0x12e)+_0x5521e6),_0x436a0f[_0xb1eac8(0x12f)](_0x36dcbb,null)),logger[_0xb1eac8(0x124)](_0x436a0f[_0xb1eac8(0x110)](_0x436a0f['fXjoW'],_0x3bcb13)),_0x436a0f['gGrFH'](_0x36dcbb,_0x3bcb13);});});}}module[a103_0x30f317(0xf7)]=Percy;
const a72_0x95e8b6=a72_0x242d;function a72_0x26c5(){const _0xde12de=['PERCY_SERVER_ADDRESS','isRunning','Percy\x20healthcheck\x20successful','exec','MdDUt','TkeuD','DOWNLOAD','healthcheck','../logger','30afslKI','467809DpirBU','spihB','percy.json','percy.log','VAMBZ','percy/healthcheck','GET','aogRW','GKduW','isProcessRunning','3019344uGSTaY','token','BROWSERSTACK_TESTHUB_UUID','ENV_VAR','error','getBinaryPath','stop','api/app_percy/get_project_token?name=','pipe','percyOptions','122350BuOeaL','Percy\x20fetch\x20token\x20success','&type=','stdout','app','end','BwgQg','http://localhost:5338','oAIME','automate','743642hwlQOL','60508lXaiwd','createPercyConfig','crVIA','Percy\x20config\x20created\x20at\x20','../../helpers/performance/performance-tester','push','10384920ItJJGz','child_process','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','tmpdir','stderr','../../helpers/performance/constants','exports','app:exec','136RxfGNv','data','close','./PercyBinary','stringify','createWriteStream','fQDsZ','path','winstonLogger','4132566NryDSa','projectName','env','fetchPercyToken','version','start','kCXzO','CIzYd','Error\x20creating\x20percy\x20config:\x20','assign','join','huohy','debug','../helper'];a72_0x26c5=function(){return _0xde12de;};return a72_0x26c5();}(function(_0x1ee45f,_0x5ea635){const _0x19bc76=a72_0x242d,_0x3aa16d=_0x1ee45f();while(!![]){try{const _0x57b647=-parseInt(_0x19bc76(0xad))/0x1+-parseInt(_0x19bc76(0x7d))/0x2+-parseInt(_0x19bc76(0x69))/0x3+-parseInt(_0x19bc76(0x8c))/0x4*(-parseInt(_0x19bc76(0x73))/0x5)+parseInt(_0x19bc76(0xac))/0x6*(-parseInt(_0x19bc76(0x7e))/0x7)+parseInt(_0x19bc76(0x84))/0x8+parseInt(_0x19bc76(0x95))/0x9;if(_0x57b647===_0x5ea635)break;else _0x3aa16d['push'](_0x3aa16d['shift']());}catch(_0xcc2c3a){_0x3aa16d['push'](_0x3aa16d['shift']());}}}(a72_0x26c5,0xaae43));function a72_0x242d(_0x24c06d,_0x8ef57b){const _0x26c57d=a72_0x26c5();return a72_0x242d=function(_0x242de1,_0x125253){_0x242de1=_0x242de1-0x69;let _0x5f45be=_0x26c57d[_0x242de1];return _0x5f45be;},a72_0x242d(_0x24c06d,_0x8ef57b);}const fs=require('fs'),path=require(a72_0x95e8b6(0x93)),os=require('os'),{spawn}=require(a72_0x95e8b6(0x85)),helper=require(a72_0x95e8b6(0xa2)),logger=require(a72_0x95e8b6(0xab))[a72_0x95e8b6(0x94)],{logDir}=require(a72_0x95e8b6(0xab)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a72_0x95e8b6(0x82)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x95e8b6(0x89)),PercyBinary=require(a72_0x95e8b6(0x8f));class Percy{#logfile=path[a72_0x95e8b6(0x9f)](logDir,a72_0x95e8b6(0xb0));#address=process[a72_0x95e8b6(0x97)][a72_0x95e8b6(0xa3)]||a72_0x95e8b6(0x7a);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x95e8b6(0xb6)]=![];constructor(_0x5e305e){const _0x2ce32e=a72_0x95e8b6;this.#config=_0x5e305e,!!_0x5e305e[_0x2ce32e(0x77)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x1f5417=a72_0x95e8b6;if(!this.#binaryPath){const _0x3b032a=new PercyBinary();PerformanceTester[_0x1f5417(0x9a)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x3b032a[_0x1f5417(0x6e)](this.#config),PerformanceTester[_0x1f5417(0x78)](PerformanceEvents[_0x1f5417(0xa9)]);}return this.#binaryPath;}async #sleep(_0x215abe){return new Promise(_0x25d348=>setTimeout(_0x25d348,_0x215abe));}async[a72_0x95e8b6(0xaa)](){const _0x222388=a72_0x95e8b6,_0x55fa61={};_0x55fa61[_0x222388(0x79)]=_0x222388(0xb3),_0x55fa61[_0x222388(0xb5)]=_0x222388(0xb2);const _0x36c3fe=_0x55fa61;try{const _0x2553a3=await helper['nodeRequest'](_0x36c3fe['BwgQg'],_0x36c3fe[_0x222388(0xb5)],null,null,this.#address);if(_0x2553a3)return!![];}catch(_0x24e06a){return![];}}async['start'](){const _0x2d74e0=a72_0x95e8b6,_0x3531b8={'oAIME':_0x2d74e0(0x8b),'SSPGs':_0x2d74e0(0xa6),'MdDUt':function(_0xedd63f,_0x1177be,_0x3806a8,_0x32354b){return _0xedd63f(_0x1177be,_0x3806a8,_0x32354b);},'crVIA':_0x2d74e0(0x8e),'spihB':_0x2d74e0(0xa5)},_0x59e388=await this.#getBinaryPath(),_0x31d3a8={};_0x31d3a8['flags']='a';const _0x1da4bd=fs[_0x2d74e0(0x91)](this.#logfile,_0x31d3a8),_0x3333dd=await this[_0x2d74e0(0x98)](),_0x51ecb3=await this[_0x2d74e0(0x7f)]();if(!_0x3333dd)return![];const _0x883397=[(this.#isApp?_0x3531b8[_0x2d74e0(0x7b)]:_0x3531b8['SSPGs'])+':start'];_0x51ecb3&&_0x883397[_0x2d74e0(0x83)]('-c',_0x51ecb3);this.#proc=_0x3531b8[_0x2d74e0(0xa7)](spawn,_0x59e388,_0x883397,{'env':Object[_0x2d74e0(0x9e)](process['env'],{'PERCY_TOKEN':_0x3333dd,'TH_BUILD_UUID':process[_0x2d74e0(0x97)][testHubConstants[_0x2d74e0(0x6c)][_0x2d74e0(0x6b)]]})}),this.#proc[_0x2d74e0(0x76)][_0x2d74e0(0x71)](_0x1da4bd),this.#proc[_0x2d74e0(0x88)]['pipe'](_0x1da4bd),this[_0x2d74e0(0xb6)]=!![];var _0x4a134e=this;this.#proc['on'](_0x3531b8[_0x2d74e0(0x80)],function(_0x5dec62){_0x4a134e['isProcessRunning']=![];});do{const _0x12420b=await this[_0x2d74e0(0xaa)]();if(_0x12420b)return logger[_0x2d74e0(0xa1)](_0x3531b8[_0x2d74e0(0xae)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a72_0x95e8b6(0x6f)](){const _0x1396b1=a72_0x95e8b6,_0x5759ce={'LGvmc':function(_0x5f2ecd,_0x45fb0c){return _0x5f2ecd(_0x45fb0c);},'CYmrg':function(_0x38aab1,_0x2464ef,_0x339e2b){return _0x38aab1(_0x2464ef,_0x339e2b);},'aogRW':'exec:stop','IqZVD':_0x1396b1(0x8e)},_0x2fb75e=await this.#getBinaryPath();return new Promise((_0x50ad94,_0x32b06e)=>{const _0xa16cc8=_0x1396b1,_0x45a4fd=_0x5759ce['CYmrg'](spawn,_0x2fb75e,[_0x5759ce[_0xa16cc8(0xb4)]]);_0x45a4fd['on'](_0x5759ce['IqZVD'],_0x565dd2=>{const _0x342666=_0xa16cc8;this[_0x342666(0xb6)]=![],_0x5759ce['LGvmc'](_0x50ad94,_0x565dd2);});});}[a72_0x95e8b6(0xa4)](){const _0x3f17af=a72_0x95e8b6;return this[_0x3f17af(0xb6)];}async['fetchPercyToken'](){const _0x3393a9=a72_0x95e8b6,_0x28704f={};_0x28704f[_0x3393a9(0xa0)]='app',_0x28704f[_0x3393a9(0x9c)]=_0x3393a9(0x7c),_0x28704f[_0x3393a9(0x9b)]='GET',_0x28704f[_0x3393a9(0x92)]=_0x3393a9(0x74);const _0x25af6f=_0x28704f,_0x2f73f9=this.#config[_0x3393a9(0x96)];try{const _0x5321e2=this.#isApp?_0x25af6f[_0x3393a9(0xa0)]:_0x25af6f[_0x3393a9(0x9c)],_0x22c68f=await helper['nodeRequest'](_0x25af6f[_0x3393a9(0x9b)],_0x3393a9(0x70)+_0x2f73f9+_0x3393a9(0x75)+_0x5321e2,{},this.#config),_0x3db175=_0x22c68f[_0x3393a9(0x8d)];return logger[_0x3393a9(0xa1)](_0x25af6f[_0x3393a9(0x92)]),_0x3db175[_0x3393a9(0x6a)];}catch(_0x291365){return logger[_0x3393a9(0x6d)](_0x3393a9(0x86)+_0x291365),null;}}async[a72_0x95e8b6(0x7f)](){const _0x31e6a6=a72_0x95e8b6,_0x46479e={'TkeuD':function(_0x49d4f1,_0x2aa277){return _0x49d4f1(_0x2aa277);},'WfBEA':function(_0x43bacc,_0x368a96){return _0x43bacc+_0x368a96;},'uNYlv':_0x31e6a6(0x81),'VAMBZ':_0x31e6a6(0xaf)};if(!this.#config[_0x31e6a6(0x72)])return null;const _0xd96383=path[_0x31e6a6(0x9f)](os[_0x31e6a6(0x87)](),_0x46479e[_0x31e6a6(0xb1)]),_0x2f2c89=this.#config['percyOptions'];return!_0x2f2c89[_0x31e6a6(0x99)]&&(_0x2f2c89[_0x31e6a6(0x99)]='2'),new Promise((_0x2480fc,_0x13abb3)=>{const _0xc88559=_0x31e6a6;fs['writeFile'](_0xd96383,JSON[_0xc88559(0x90)](_0x2f2c89),_0x10b718=>{const _0x43cf40=_0xc88559;_0x10b718&&(logger[_0x43cf40(0x6d)](_0x43cf40(0x9d)+_0x10b718),_0x46479e[_0x43cf40(0xa8)](_0x2480fc,null)),logger[_0x43cf40(0xa1)](_0x46479e['WfBEA'](_0x46479e['uNYlv'],_0xd96383)),_0x46479e[_0x43cf40(0xa8)](_0x2480fc,_0xd96383);});});}}module[a72_0x95e8b6(0x8a)]=Percy;
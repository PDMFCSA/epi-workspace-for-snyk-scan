function a72_0x35f2(_0x518e93,_0x3d7e79){const _0x5d48a9=a72_0x5d48();return a72_0x35f2=function(_0x35f2f8,_0x33db54){_0x35f2f8=_0x35f2f8-0xd9;let _0x112a12=_0x5d48a9[_0x35f2f8];return _0x112a12;},a72_0x35f2(_0x518e93,_0x3d7e79);}const a72_0x471875=a72_0x35f2;function a72_0x5d48(){const _0x28ecc4=['percy.json','14981riCUUG','percyOptions','http://localhost:5338','../logger','nodeRequest','BROWSERSTACK_TESTHUB_UUID','flags','../helper','GET','etaTH','createPercyConfig','../../helpers/testhub/constants','4916664unkCfN',':start','writeFile','7934864niKLov','../../helpers/performance/performance-tester','tmpdir','XTQOg','app','app:exec','start','5631930cqJymL','ryPos','bGeTf','bnCht','10CcZnVr','automate','HpFxa','push','percy/healthcheck','XGxOS','10rcDcgJ','ENV_VAR','2138190CHfkYJ','pipe','isRunning','Percy\x20fetch\x20token\x20success','env','Lzjbv','api/app_percy/get_project_token?name=','getBinaryPath','isProcessRunning','winstonLogger','data','join','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','Percy\x20config\x20created\x20at\x20','XvYHP','fetchPercyToken','2437244ZJDbqF','debug','fwbbZ','9625525njstKi','error','vAIzf','stop','createWriteStream','healthcheck','mADfb','dStEX','tTpVB','path','DOWNLOAD','PERCY_SERVER_ADDRESS','percy.log','stringify','projectName','stdout','BYiqp','close'];a72_0x5d48=function(){return _0x28ecc4;};return a72_0x5d48();}(function(_0x1d8134,_0xd8f44a){const _0x373775=a72_0x35f2,_0x5a89c8=_0x1d8134();while(!![]){try{const _0x582112=-parseInt(_0x373775(0xde))/0x1*(parseInt(_0x373775(0xf8))/0x2)+parseInt(_0x373775(0x100))/0x3+-parseInt(_0x373775(0x110))/0x4*(-parseInt(_0x373775(0xfe))/0x5)+-parseInt(_0x373775(0xea))/0x6+parseInt(_0x373775(0x113))/0x7+-parseInt(_0x373775(0xed))/0x8+-parseInt(_0x373775(0xf4))/0x9;if(_0x582112===_0xd8f44a)break;else _0x5a89c8['push'](_0x5a89c8['shift']());}catch(_0x35e60e){_0x5a89c8['push'](_0x5a89c8['shift']());}}}(a72_0x5d48,0xc1f52));const fs=require('fs'),path=require(a72_0x471875(0x11c)),os=require('os'),{spawn}=require('child_process'),helper=require(a72_0x471875(0xe5)),logger=require(a72_0x471875(0xe1))[a72_0x471875(0x109)],{getLogDir}=require('../logger'),testHubConstants=require(a72_0x471875(0xe9)),PerformanceTester=require(a72_0x471875(0xee)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a72_0x471875(0x10b)](getLogDir(),a72_0x471875(0x11f));#address=process['env'][a72_0x471875(0x11e)]||a72_0x471875(0xe0);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x471875(0x108)]=![];constructor(_0x42d2d1){const _0x2ea304=a72_0x471875;this.#config=_0x42d2d1,!!_0x42d2d1[_0x2ea304(0xf1)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x3e218c=a72_0x471875;if(!this.#binaryPath){const _0x2df0f0=new PercyBinary();PerformanceTester[_0x3e218c(0xf3)](PerformanceEvents[_0x3e218c(0x11d)]),this.#binaryPath=await _0x2df0f0[_0x3e218c(0x107)](this.#config),PerformanceTester['end'](PerformanceEvents[_0x3e218c(0x11d)]);}return this.#binaryPath;}async #sleep(_0x349d7c){return new Promise(_0x1ee2c9=>setTimeout(_0x1ee2c9,_0x349d7c));}async['healthcheck'](){const _0x2e1ccb=a72_0x471875,_0x4634c8={};_0x4634c8[_0x2e1ccb(0x105)]=_0x2e1ccb(0xe6),_0x4634c8['GNqbX']=_0x2e1ccb(0xfc);const _0x3e84b6=_0x4634c8;try{const _0x373827=await helper['nodeRequest'](_0x3e84b6[_0x2e1ccb(0x105)],_0x3e84b6['GNqbX'],null,null,this.#address);if(_0x373827)return!![];}catch(_0x433a7d){return![];}}async[a72_0x471875(0xf3)](){const _0x5781b8=a72_0x471875,_0x458755={'bnCht':_0x5781b8(0xf2),'bGeTf':'exec','vAIzf':function(_0x305969,_0x540867,_0x2b3b81,_0x3b40db){return _0x305969(_0x540867,_0x2b3b81,_0x3b40db);},'PQrxw':_0x5781b8(0xdc),'XGxOS':'Percy\x20healthcheck\x20successful'},_0x28d9fd=await this.#getBinaryPath(),_0x504da6={};_0x504da6[_0x5781b8(0xe4)]='a';const _0x4b30b7=fs[_0x5781b8(0x117)](this.#logfile,_0x504da6),_0x5be64d=await this[_0x5781b8(0x10f)](),_0x51f5f4=await this['createPercyConfig']();if(!_0x5be64d)return![];const _0x43bc1d=[(this.#isApp?_0x458755[_0x5781b8(0xf7)]:_0x458755[_0x5781b8(0xf6)])+_0x5781b8(0xeb)];_0x51f5f4&&_0x43bc1d[_0x5781b8(0xfb)]('-c',_0x51f5f4);this.#proc=_0x458755[_0x5781b8(0x115)](spawn,_0x28d9fd,_0x43bc1d,{'env':Object['assign'](process[_0x5781b8(0x104)],{'PERCY_TOKEN':_0x5be64d,'TH_BUILD_UUID':process[_0x5781b8(0x104)][testHubConstants[_0x5781b8(0xff)][_0x5781b8(0xe3)]]})}),this.#proc[_0x5781b8(0xda)][_0x5781b8(0x101)](_0x4b30b7),this.#proc['stderr'][_0x5781b8(0x101)](_0x4b30b7),this[_0x5781b8(0x108)]=!![];var _0x381d37=this;this.#proc['on'](_0x458755['PQrxw'],function(_0x4a591e){const _0x3efb00=_0x5781b8;_0x381d37[_0x3efb00(0x108)]=![];});do{const _0x4678ff=await this[_0x5781b8(0x118)]();if(_0x4678ff)return logger[_0x5781b8(0x111)](_0x458755[_0x5781b8(0xfd)]),!![];await this.#sleep(0x3e8);}while(this[_0x5781b8(0x108)]);return![];}async[a72_0x471875(0x116)](){const _0x518081=a72_0x471875,_0x182810={'OrUxn':function(_0x52d771,_0x3195ce){return _0x52d771(_0x3195ce);},'lwsBe':function(_0xf6e850,_0x1846a5,_0x179d02){return _0xf6e850(_0x1846a5,_0x179d02);},'mADfb':'exec:stop','etaTH':_0x518081(0xdc)},_0x127be2=await this.#getBinaryPath();return new Promise((_0x1564c1,_0x450fa2)=>{const _0x337a8f=_0x518081,_0xbcd6a={'bksiF':function(_0x10277f,_0x42676e){return _0x182810['OrUxn'](_0x10277f,_0x42676e);}},_0x2f5018=_0x182810['lwsBe'](spawn,_0x127be2,[_0x182810[_0x337a8f(0x119)]]);_0x2f5018['on'](_0x182810[_0x337a8f(0xe7)],_0x587cf3=>{this['isProcessRunning']=![],_0xbcd6a['bksiF'](_0x1564c1,_0x587cf3);});});}[a72_0x471875(0x102)](){const _0x1bda1f=a72_0x471875;return this[_0x1bda1f(0x108)];}async[a72_0x471875(0x10f)](){const _0x5386be=a72_0x471875,_0x3168fa={};_0x3168fa[_0x5386be(0xf5)]=_0x5386be(0xf1),_0x3168fa[_0x5386be(0xdb)]=_0x5386be(0xf9),_0x3168fa[_0x5386be(0xf0)]=_0x5386be(0xe6),_0x3168fa[_0x5386be(0x112)]=_0x5386be(0x103);const _0x51f002=_0x3168fa,_0x4568f1=this.#config[_0x5386be(0xd9)];try{const _0xa8e817=this.#isApp?_0x51f002[_0x5386be(0xf5)]:_0x51f002['BYiqp'],_0xbdb347=await helper[_0x5386be(0xe2)](_0x51f002[_0x5386be(0xf0)],_0x5386be(0x106)+_0x4568f1+'&type='+_0xa8e817,{},this.#config),_0x581df8=_0xbdb347[_0x5386be(0x10a)];return logger[_0x5386be(0x111)](_0x51f002[_0x5386be(0x112)]),_0x581df8['token'];}catch(_0x3c9b05){return logger[_0x5386be(0x114)](_0x5386be(0x10c)+_0x3c9b05),null;}}async[a72_0x471875(0xe8)](){const _0x1a2118=a72_0x471875,_0x248d48={'HpFxa':function(_0x58b6b2,_0x373294){return _0x58b6b2(_0x373294);},'XvYHP':function(_0x2d4ba4,_0x40a6c1){return _0x2d4ba4+_0x40a6c1;},'dStEX':_0x1a2118(0x10d),'tTpVB':_0x1a2118(0xdd)};if(!this.#config[_0x1a2118(0xdf)])return null;const _0xe28395=path[_0x1a2118(0x10b)](os[_0x1a2118(0xef)](),_0x248d48[_0x1a2118(0x11b)]),_0x388f8d=this.#config[_0x1a2118(0xdf)];return!_0x388f8d['version']&&(_0x388f8d['version']='2'),new Promise((_0x522b53,_0x5423ee)=>{const _0x16d68f=_0x1a2118;fs[_0x16d68f(0xec)](_0xe28395,JSON[_0x16d68f(0x120)](_0x388f8d),_0x35cb67=>{const _0x1bd8a4=_0x16d68f;_0x35cb67&&(logger[_0x1bd8a4(0x114)]('Error\x20creating\x20percy\x20config:\x20'+_0x35cb67),_0x248d48[_0x1bd8a4(0xfa)](_0x522b53,null)),logger[_0x1bd8a4(0x111)](_0x248d48[_0x1bd8a4(0x10e)](_0x248d48[_0x1bd8a4(0x11a)],_0xe28395)),_0x248d48[_0x1bd8a4(0xfa)](_0x522b53,_0xe28395);});});}}module['exports']=Percy;
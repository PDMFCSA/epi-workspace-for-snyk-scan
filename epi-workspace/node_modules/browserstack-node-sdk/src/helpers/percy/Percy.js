function a71_0x2b64(){const _0x583e5e=['zEcks','Percy\x20config\x20created\x20at\x20','exec','znDKr','percyOptions','SbPSl','api/app_percy/get_project_token?name=','pipe','waieb','getBinaryPath','version','debug','writeFile','percy/healthcheck','stop','nPcrS','Percy\x20healthcheck\x20successful','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','PERCY_SERVER_ADDRESS','end','stderr','token','join','createWriteStream','../../helpers/performance/performance-tester','child_process','aSrDn','stdout','../../helpers/performance/constants','winstonLogger','start','healthcheck','143538hDxsYu','projectName','app','BKzHB','NJltE','25TfbIid','assign','ENV_VAR','http://localhost:5338','percy.log','fgvCl','fetchPercyToken','path','785015eSxqFS','createPercyConfig','138000XsEztt','164520xpKqoe','error','142302mETgXP','./PercyBinary',':start','close','env','797544zTUIwE','570WktfYl','3UScVgs','stringify','tmpdir','pqnyG','WNtNd','GET','DOWNLOAD','app:exec','nodeRequest','8cfIIDp','isProcessRunning','uPPyl','75713cZPdNc','HrlRh','data','../logger','../../helpers/testhub/constants','RZJjb','BROWSERSTACK_TESTHUB_UUID'];a71_0x2b64=function(){return _0x583e5e;};return a71_0x2b64();}const a71_0x5e1aa2=a71_0x3b9f;(function(_0x21c6a3,_0x31f0d2){const _0x1410fa=a71_0x3b9f,_0x1939e2=_0x21c6a3();while(!![]){try{const _0x1deb5c=-parseInt(_0x1410fa(0xfe))/0x1+parseInt(_0x1410fa(0x101))/0x2*(parseInt(_0x1410fa(0x108))/0x3)+-parseInt(_0x1410fa(0x106))/0x4+-parseInt(_0x1410fa(0xf4))/0x5*(parseInt(_0x1410fa(0xef))/0x6)+-parseInt(_0x1410fa(0xfc))/0x7*(-parseInt(_0x1410fa(0xc5))/0x8)+-parseInt(_0x1410fa(0xff))/0x9+-parseInt(_0x1410fa(0x107))/0xa*(-parseInt(_0x1410fa(0xc8))/0xb);if(_0x1deb5c===_0x31f0d2)break;else _0x1939e2['push'](_0x1939e2['shift']());}catch(_0x14e9b3){_0x1939e2['push'](_0x1939e2['shift']());}}}(a71_0x2b64,0x187fa));const fs=require('fs'),path=require(a71_0x5e1aa2(0xfb)),os=require('os'),{spawn}=require(a71_0x5e1aa2(0xe8)),helper=require('../helper'),logger=require(a71_0x5e1aa2(0xcb))[a71_0x5e1aa2(0xec)],{logDir}=require('../logger'),testHubConstants=require(a71_0x5e1aa2(0xcc)),PerformanceTester=require(a71_0x5e1aa2(0xe7)),{PERCY_EVENTS:PerformanceEvents}=require(a71_0x5e1aa2(0xeb)),PercyBinary=require(a71_0x5e1aa2(0x102));function a71_0x3b9f(_0x46a829,_0x50635a){const _0x2b6465=a71_0x2b64();return a71_0x3b9f=function(_0x3b9fb5,_0x48bf4e){_0x3b9fb5=_0x3b9fb5-0xbd;let _0x45d122=_0x2b6465[_0x3b9fb5];return _0x45d122;},a71_0x3b9f(_0x46a829,_0x50635a);}class Percy{#logfile=path['join'](logDir,a71_0x5e1aa2(0xf8));#address=process[a71_0x5e1aa2(0x105)][a71_0x5e1aa2(0xe1)]||a71_0x5e1aa2(0xf7);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a71_0x5e1aa2(0xc6)]=![];constructor(_0x50fd06){const _0x4606f1=a71_0x5e1aa2;this.#config=_0x50fd06,!!_0x50fd06[_0x4606f1(0xf1)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x13b273=a71_0x5e1aa2;if(!this.#binaryPath){const _0x252064=new PercyBinary();PerformanceTester[_0x13b273(0xed)](PerformanceEvents[_0x13b273(0xc2)]),this.#binaryPath=await _0x252064[_0x13b273(0xd8)](this.#config),PerformanceTester[_0x13b273(0xe2)](PerformanceEvents[_0x13b273(0xc2)]);}return this.#binaryPath;}async #sleep(_0x3eb9b0){return new Promise(_0x4b769e=>setTimeout(_0x4b769e,_0x3eb9b0));}async['healthcheck'](){const _0x2a9e5a=a71_0x5e1aa2,_0x2bdbfd={};_0x2bdbfd[_0x2a9e5a(0xcd)]=_0x2a9e5a(0xc1),_0x2bdbfd[_0x2a9e5a(0xd4)]=_0x2a9e5a(0xdc);const _0x3de96b=_0x2bdbfd;try{const _0x5e59ee=await helper[_0x2a9e5a(0xc4)](_0x3de96b[_0x2a9e5a(0xcd)],_0x3de96b[_0x2a9e5a(0xd4)],null,null,this.#address);if(_0x5e59ee)return!![];}catch(_0x2eaee2){return![];}}async[a71_0x5e1aa2(0xed)](){const _0x13a191=a71_0x5e1aa2,_0x1604ba={'aSrDn':_0x13a191(0xc3),'WNtNd':_0x13a191(0xd1),'jYNFU':function(_0x35b52d,_0x554c56,_0x4f924f,_0x466580){return _0x35b52d(_0x554c56,_0x4f924f,_0x466580);},'znDKr':_0x13a191(0x104),'HrlRh':_0x13a191(0xdf)},_0x538e27=await this.#getBinaryPath(),_0x11d607={};_0x11d607['flags']='a';const _0xfb3a2a=fs[_0x13a191(0xe6)](this.#logfile,_0x11d607),_0x4079ea=await this['fetchPercyToken'](),_0x2dff61=await this[_0x13a191(0xfd)]();if(!_0x4079ea)return![];const _0x34b134=[(this.#isApp?_0x1604ba[_0x13a191(0xe9)]:_0x1604ba[_0x13a191(0xc0)])+_0x13a191(0x103)];_0x2dff61&&_0x34b134['push']('-c',_0x2dff61);this.#proc=_0x1604ba['jYNFU'](spawn,_0x538e27,_0x34b134,{'env':Object[_0x13a191(0xf5)](process[_0x13a191(0x105)],{'PERCY_TOKEN':_0x4079ea,'TH_BUILD_UUID':process[_0x13a191(0x105)][testHubConstants[_0x13a191(0xf6)][_0x13a191(0xce)]]})}),this.#proc[_0x13a191(0xea)][_0x13a191(0xd6)](_0xfb3a2a),this.#proc[_0x13a191(0xe3)]['pipe'](_0xfb3a2a),this[_0x13a191(0xc6)]=!![];var _0x48502f=this;this.#proc['on'](_0x1604ba[_0x13a191(0xd2)],function(_0x35da81){const _0xbf271b=_0x13a191;_0x48502f[_0xbf271b(0xc6)]=![];});do{const _0x59feab=await this[_0x13a191(0xee)]();if(_0x59feab)return logger[_0x13a191(0xda)](_0x1604ba[_0x13a191(0xc9)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a71_0x5e1aa2(0xdd)](){const _0x199224=a71_0x5e1aa2,_0x4106f2={'fgvCl':function(_0x58d56c,_0x3671e8){return _0x58d56c(_0x3671e8);},'nPcrS':function(_0x4aee89,_0x389d04,_0x35aa01){return _0x4aee89(_0x389d04,_0x35aa01);},'zIpbP':'exec:stop','NJltE':_0x199224(0x104)},_0xfa9fb0=await this.#getBinaryPath();return new Promise((_0x48e6e4,_0x367554)=>{const _0x2e02d5=_0x199224,_0x4a7691=_0x4106f2[_0x2e02d5(0xde)](spawn,_0xfa9fb0,[_0x4106f2['zIpbP']]);_0x4a7691['on'](_0x4106f2[_0x2e02d5(0xf3)],_0x3e6772=>{const _0x31a7a6=_0x2e02d5;this[_0x31a7a6(0xc6)]=![],_0x4106f2[_0x31a7a6(0xf9)](_0x48e6e4,_0x3e6772);});});}['isRunning'](){const _0x77866f=a71_0x5e1aa2;return this[_0x77866f(0xc6)];}async[a71_0x5e1aa2(0xfa)](){const _0x1d5776=a71_0x5e1aa2,_0x40e70c={};_0x40e70c[_0x1d5776(0xf2)]=_0x1d5776(0xf1),_0x40e70c[_0x1d5776(0xbf)]='automate',_0x40e70c[_0x1d5776(0xd7)]=_0x1d5776(0xc1),_0x40e70c[_0x1d5776(0xc7)]='Percy\x20fetch\x20token\x20success';const _0x17eb77=_0x40e70c,_0x4b22a9=this.#config[_0x1d5776(0xf0)];try{const _0x5e7f5c=this.#isApp?_0x17eb77[_0x1d5776(0xf2)]:_0x17eb77['pqnyG'],_0x3a29b7=await helper[_0x1d5776(0xc4)](_0x17eb77[_0x1d5776(0xd7)],_0x1d5776(0xd5)+_0x4b22a9+'&type='+_0x5e7f5c,{},this.#config),_0x1703a2=_0x3a29b7[_0x1d5776(0xca)];return logger[_0x1d5776(0xda)](_0x17eb77['uPPyl']),_0x1703a2[_0x1d5776(0xe4)];}catch(_0x41e03d){return logger[_0x1d5776(0x100)](_0x1d5776(0xe0)+_0x41e03d),null;}}async[a71_0x5e1aa2(0xfd)](){const _0x3516ca=a71_0x5e1aa2,_0x34c423={'zEcks':function(_0xd7cfcd,_0x565e76){return _0xd7cfcd(_0x565e76);},'FVfal':function(_0xc23334,_0x5a6e63){return _0xc23334+_0x5a6e63;},'keycq':_0x3516ca(0xd0),'cOOzc':'percy.json'};if(!this.#config[_0x3516ca(0xd3)])return null;const _0x19e9e0=path[_0x3516ca(0xe5)](os[_0x3516ca(0xbe)](),_0x34c423['cOOzc']),_0x2f9e21=this.#config[_0x3516ca(0xd3)];return!_0x2f9e21[_0x3516ca(0xd9)]&&(_0x2f9e21[_0x3516ca(0xd9)]='2'),new Promise((_0x3c6270,_0x1671d7)=>{const _0x5f4f62=_0x3516ca;fs[_0x5f4f62(0xdb)](_0x19e9e0,JSON[_0x5f4f62(0xbd)](_0x2f9e21),_0x5848ab=>{const _0x347d3c=_0x5f4f62;_0x5848ab&&(logger[_0x347d3c(0x100)]('Error\x20creating\x20percy\x20config:\x20'+_0x5848ab),_0x34c423[_0x347d3c(0xcf)](_0x3c6270,null)),logger[_0x347d3c(0xda)](_0x34c423['FVfal'](_0x34c423['keycq'],_0x19e9e0)),_0x34c423[_0x347d3c(0xcf)](_0x3c6270,_0x19e9e0);});});}}module['exports']=Percy;
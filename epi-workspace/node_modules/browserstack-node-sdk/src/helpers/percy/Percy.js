const a101_0x106e71=a101_0x11ed;function a101_0x75cb(){const _0x2635fc=['../helper','../logger','&type=','./PercyBinary','close','percy/healthcheck','dUyWe','push','342505VnoiVZ','gDxXk','../../helpers/testhub/constants','version','ORiMF','flags','join','exec','stdout','fNoyt','Percy\x20config\x20created\x20at\x20','stderr','TzaAm','Odnek','end','http://localhost:5338','PERCY_SERVER_ADDRESS','QAnmm','createWriteStream','BROWSERSTACK_TESTHUB_UUID','27JuufpF','zUUeZ','102SmoVep','exec:stop','start','getBinaryPath','gYiMo','fetchPercyToken','19412316TKOQvy','5471347ViKWpg','error','healthcheck','2656330tFuYlZ','muLra','98TUxKVP','LLLOc','app','debug','xiSDL','633TcmByA','projectName','nodeRequest','2400024UmxfZW','percyOptions','Percy\x20healthcheck\x20successful','GET','writeFile','VHXtn','stop','DOWNLOAD','isProcessRunning','app:exec','../../helpers/performance/performance-tester','EGgtL','19972DNmHuk','percy.json','APyvg','exports','api/app_percy/get_project_token?name=','pipe','tmpdir','child_process','env','25142tDkoPy','token','createPercyConfig','stringify','maFQt','winstonLogger','../../helpers/performance/constants','data'];a101_0x75cb=function(){return _0x2635fc;};return a101_0x75cb();}(function(_0x2a31b9,_0x1e01e0){const _0x1f31a7=a101_0x11ed,_0xa9971=_0x2a31b9();while(!![]){try{const _0x3ee2f9=-parseInt(_0x1f31a7(0xef))/0x1*(parseInt(_0x1f31a7(0x10c))/0x2)+parseInt(_0x1f31a7(0xf4))/0x3*(-parseInt(_0x1f31a7(0x103))/0x4)+-parseInt(_0x1f31a7(0xcd))/0x5*(-parseInt(_0x1f31a7(0xe3))/0x6)+parseInt(_0x1f31a7(0xea))/0x7+parseInt(_0x1f31a7(0xf7))/0x8+-parseInt(_0x1f31a7(0xe1))/0x9*(parseInt(_0x1f31a7(0xed))/0xa)+parseInt(_0x1f31a7(0xe9))/0xb;if(_0x3ee2f9===_0x1e01e0)break;else _0xa9971['push'](_0xa9971['shift']());}catch(_0xaf4155){_0xa9971['push'](_0xa9971['shift']());}}}(a101_0x75cb,0xe2b05));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a101_0x106e71(0x10a)),helper=require(a101_0x106e71(0xc5)),logger=require(a101_0x106e71(0xc6))[a101_0x106e71(0xc2)],{getLogDir}=require(a101_0x106e71(0xc6)),testHubConstants=require(a101_0x106e71(0xcf)),PerformanceTester=require(a101_0x106e71(0x101)),{PERCY_EVENTS:PerformanceEvents}=require(a101_0x106e71(0xc3)),PercyBinary=require(a101_0x106e71(0xc8));function a101_0x11ed(_0xc4174f,_0x4671a2){const _0x75cb43=a101_0x75cb();return a101_0x11ed=function(_0x11edea,_0x5b6cfe){_0x11edea=_0x11edea-0xc1;let _0x5d8057=_0x75cb43[_0x11edea];return _0x5d8057;},a101_0x11ed(_0xc4174f,_0x4671a2);}class Percy{#logfile=path[a101_0x106e71(0xd3)](getLogDir(),'percy.log');#address=process['env'][a101_0x106e71(0xdd)]||a101_0x106e71(0xdc);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a101_0x106e71(0xff)]=![];constructor(_0x1f01c3){this.#config=_0x1f01c3,!!_0x1f01c3['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x4bb10a=a101_0x106e71;if(!this.#binaryPath){const _0x53689f=new PercyBinary();PerformanceTester[_0x4bb10a(0xe5)](PerformanceEvents[_0x4bb10a(0xfe)]),this.#binaryPath=await _0x53689f[_0x4bb10a(0xe6)](this.#config),PerformanceTester[_0x4bb10a(0xdb)](PerformanceEvents[_0x4bb10a(0xfe)]);}return this.#binaryPath;}async #sleep(_0x1be482){return new Promise(_0x465fc2=>setTimeout(_0x465fc2,_0x1be482));}async[a101_0x106e71(0xec)](){const _0x1ce790=a101_0x106e71,_0x41dfb6={};_0x41dfb6[_0x1ce790(0xc1)]=_0x1ce790(0xfa),_0x41dfb6[_0x1ce790(0xe7)]=_0x1ce790(0xca);const _0x10764a=_0x41dfb6;try{const _0xda9e18=await helper['nodeRequest'](_0x10764a['maFQt'],_0x10764a[_0x1ce790(0xe7)],null,null,this.#address);if(_0xda9e18)return!![];}catch(_0x4e10a9){return![];}}async['start'](){const _0x384907=a101_0x106e71,_0x387af4={'zUUeZ':_0x384907(0x100),'TzaAm':_0x384907(0xd4),'gDxXk':function(_0x4c70aa,_0x4b079d,_0x2c4403,_0x4c417b){return _0x4c70aa(_0x4b079d,_0x2c4403,_0x4c417b);},'VHXtn':_0x384907(0xc9),'Odnek':_0x384907(0xf9)},_0x2d475f=await this.#getBinaryPath(),_0x3b2d1a={};_0x3b2d1a[_0x384907(0xd2)]='a';const _0x49f6e2=fs[_0x384907(0xdf)](this.#logfile,_0x3b2d1a),_0x32c4bf=await this['fetchPercyToken'](),_0x500ef3=await this[_0x384907(0x10e)]();if(!_0x32c4bf)return![];const _0x10450a=[(this.#isApp?_0x387af4[_0x384907(0xe2)]:_0x387af4[_0x384907(0xd9)])+':start'];_0x500ef3&&_0x10450a[_0x384907(0xcc)]('-c',_0x500ef3);this.#proc=_0x387af4[_0x384907(0xce)](spawn,_0x2d475f,_0x10450a,{'env':Object['assign'](process[_0x384907(0x10b)],{'PERCY_TOKEN':_0x32c4bf,'TH_BUILD_UUID':process[_0x384907(0x10b)][testHubConstants['ENV_VAR'][_0x384907(0xe0)]]})}),this.#proc[_0x384907(0xd5)][_0x384907(0x108)](_0x49f6e2),this.#proc[_0x384907(0xd8)][_0x384907(0x108)](_0x49f6e2),this[_0x384907(0xff)]=!![];var _0x24d7ba=this;this.#proc['on'](_0x387af4[_0x384907(0xfc)],function(_0x3c75f0){const _0xf5db89=_0x384907;_0x24d7ba[_0xf5db89(0xff)]=![];});do{const _0x4bd877=await this[_0x384907(0xec)]();if(_0x4bd877)return logger[_0x384907(0xf2)](_0x387af4[_0x384907(0xda)]),!![];await this.#sleep(0x3e8);}while(this[_0x384907(0xff)]);return![];}async[a101_0x106e71(0xfd)](){const _0x28b800=a101_0x106e71,_0x28909d={'fNoyt':function(_0x5e01a3,_0x3099c9){return _0x5e01a3(_0x3099c9);},'pcQAx':function(_0x114942,_0x379fe9,_0x3754e6){return _0x114942(_0x379fe9,_0x3754e6);},'xiSDL':_0x28b800(0xe4),'qHGqq':_0x28b800(0xc9)},_0x413fee=await this.#getBinaryPath();return new Promise((_0x2e68b4,_0x32460b)=>{const _0x1a5121=_0x28b800,_0x3225cd={'cyohZ':function(_0x2a81bb,_0x45d077){const _0x630275=a101_0x11ed;return _0x28909d[_0x630275(0xd6)](_0x2a81bb,_0x45d077);}},_0x2e332c=_0x28909d['pcQAx'](spawn,_0x413fee,[_0x28909d[_0x1a5121(0xf3)]]);_0x2e332c['on'](_0x28909d['qHGqq'],_0x225af8=>{const _0x4613f6=_0x1a5121;this[_0x4613f6(0xff)]=![],_0x3225cd['cyohZ'](_0x2e68b4,_0x225af8);});});}['isRunning'](){return this['isProcessRunning'];}async[a101_0x106e71(0xe8)](){const _0x5dcfb7=a101_0x106e71,_0x4ddd34={};_0x4ddd34['RhkUH']=_0x5dcfb7(0xf1),_0x4ddd34[_0x5dcfb7(0xde)]='automate',_0x4ddd34[_0x5dcfb7(0x105)]=_0x5dcfb7(0xfa),_0x4ddd34[_0x5dcfb7(0xd1)]='Percy\x20fetch\x20token\x20success';const _0x4707e3=_0x4ddd34,_0x45a082=this.#config[_0x5dcfb7(0xf5)];try{const _0x627dce=this.#isApp?_0x4707e3['RhkUH']:_0x4707e3[_0x5dcfb7(0xde)],_0x14e654=await helper[_0x5dcfb7(0xf6)](_0x4707e3[_0x5dcfb7(0x105)],_0x5dcfb7(0x107)+_0x45a082+_0x5dcfb7(0xc7)+_0x627dce,{},this.#config),_0x3e10d2=_0x14e654[_0x5dcfb7(0xc4)];return logger[_0x5dcfb7(0xf2)](_0x4707e3[_0x5dcfb7(0xd1)]),_0x3e10d2[_0x5dcfb7(0x10d)];}catch(_0x100587){return logger[_0x5dcfb7(0xeb)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x100587),null;}}async[a101_0x106e71(0x10e)](){const _0x4704a7=a101_0x106e71,_0x28d599={'LmTEI':function(_0x4d0978,_0x17de96){return _0x4d0978(_0x17de96);},'dUyWe':function(_0x8efbf4,_0x51f32b){return _0x8efbf4+_0x51f32b;},'LLLOc':_0x4704a7(0xd7),'EGgtL':function(_0x38d623,_0x7d8c85){return _0x38d623(_0x7d8c85);},'muLra':_0x4704a7(0x104)};if(!this.#config['percyOptions'])return null;const _0x937bf=path[_0x4704a7(0xd3)](os[_0x4704a7(0x109)](),_0x28d599[_0x4704a7(0xee)]),_0x17dd9b=this.#config[_0x4704a7(0xf8)];return!_0x17dd9b[_0x4704a7(0xd0)]&&(_0x17dd9b[_0x4704a7(0xd0)]='2'),new Promise((_0x237c7f,_0x25b13c)=>{const _0x26993d=_0x4704a7;fs[_0x26993d(0xfb)](_0x937bf,JSON[_0x26993d(0x10f)](_0x17dd9b),_0x2815ff=>{const _0x466495=_0x26993d;_0x2815ff&&(logger[_0x466495(0xeb)]('Error\x20creating\x20percy\x20config:\x20'+_0x2815ff),_0x28d599['LmTEI'](_0x237c7f,null)),logger[_0x466495(0xf2)](_0x28d599[_0x466495(0xcb)](_0x28d599[_0x466495(0xf0)],_0x937bf)),_0x28d599[_0x466495(0x102)](_0x237c7f,_0x937bf);});});}}module[a101_0x106e71(0x106)]=Percy;
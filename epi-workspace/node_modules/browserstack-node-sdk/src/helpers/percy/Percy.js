const a110_0x2c5b0f=a110_0x3712;(function(_0xff8cc6,_0x493e8f){const _0x1848ca=a110_0x3712,_0x1ba84e=_0xff8cc6();while(!![]){try{const _0x54a1d3=parseInt(_0x1848ca(0x1ae))/0x1*(-parseInt(_0x1848ca(0x1a3))/0x2)+-parseInt(_0x1848ca(0x1be))/0x3+-parseInt(_0x1848ca(0x1b5))/0x4+-parseInt(_0x1848ca(0x194))/0x5+parseInt(_0x1848ca(0x192))/0x6+-parseInt(_0x1848ca(0x1b0))/0x7*(parseInt(_0x1848ca(0x1c6))/0x8)+parseInt(_0x1848ca(0x19d))/0x9*(parseInt(_0x1848ca(0x1d1))/0xa);if(_0x54a1d3===_0x493e8f)break;else _0x1ba84e['push'](_0x1ba84e['shift']());}catch(_0x52ac57){_0x1ba84e['push'](_0x1ba84e['shift']());}}}(a110_0x3dc7,0x96def));function a110_0x3712(_0x4c91b7,_0x13bd60){const _0x3dc75a=a110_0x3dc7();return a110_0x3712=function(_0x3712bc,_0x4a1fa4){_0x3712bc=_0x3712bc-0x18f;let _0x49b1cc=_0x3dc75a[_0x3712bc];return _0x49b1cc;},a110_0x3712(_0x4c91b7,_0x13bd60);}function a110_0x3dc7(){const _0x452235=['8Htuidt','jhJQJ','DOWNLOAD','IfJGR','Percy\x20healthcheck\x20successful','../logger','getBinaryPath','stringify','start','vlYtr','exec:stop','5359170szEjsN','MHDQb','fetchPercyToken','app','env','join','close','healthcheck','http://localhost:5338','FMGea','IKtqn','api/app_percy/get_project_token?name=','pdYSq','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','token','5629266zrSvhg','pipe','2606010qDhXMR','child_process','version','BauSq','push','jhQrx','Kooso','debug','flags','27HmsBBx','BROWSERSTACK_TESTHUB_UUID','data','winstonLogger','createPercyConfig','percy.log','2dHbesL','./PercyBinary','tmpdir','app:exec','stop','projectName','end','HWbCp','../helper','domJI','stderr','377471vllmwb','&type=','397642kwOlCW','percy/healthcheck','exec','lXXzJ','WXPaV','3394688xhWEqn','GET','error','../../helpers/performance/constants','Error\x20creating\x20percy\x20config:\x20','../../helpers/testhub/constants','Percy\x20config\x20created\x20at\x20','nodeRequest','isProcessRunning','371532uQoTVF','writeFile','KmThD','moQzn','Percy\x20fetch\x20token\x20success','ENV_VAR','percy.json','stdout'];a110_0x3dc7=function(){return _0x452235;};return a110_0x3dc7();}const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a110_0x2c5b0f(0x195)),helper=require(a110_0x2c5b0f(0x1ab)),logger=require(a110_0x2c5b0f(0x1cb))[a110_0x2c5b0f(0x1a0)],{getLogDir}=require(a110_0x2c5b0f(0x1cb)),testHubConstants=require(a110_0x2c5b0f(0x1ba)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a110_0x2c5b0f(0x1b8)),PercyBinary=require(a110_0x2c5b0f(0x1a4));class Percy{#logfile=path[a110_0x2c5b0f(0x1d6)](getLogDir(),a110_0x2c5b0f(0x1a2));#address=process[a110_0x2c5b0f(0x1d5)]['PERCY_SERVER_ADDRESS']||a110_0x2c5b0f(0x1d9);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];['isProcessRunning']=![];constructor(_0x26d714){const _0x5dc93a=a110_0x2c5b0f;this.#config=_0x26d714,!!_0x26d714[_0x5dc93a(0x1d4)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x53c4d8=a110_0x2c5b0f;if(!this.#binaryPath){const _0x271800=new PercyBinary();PerformanceTester[_0x53c4d8(0x1ce)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x271800[_0x53c4d8(0x1cc)](this.#config),PerformanceTester[_0x53c4d8(0x1a9)](PerformanceEvents[_0x53c4d8(0x1c8)]);}return this.#binaryPath;}async #sleep(_0x130847){return new Promise(_0x3cc4c6=>setTimeout(_0x3cc4c6,_0x130847));}async[a110_0x2c5b0f(0x1d8)](){const _0x46faea=a110_0x2c5b0f,_0xbf7119={};_0xbf7119[_0x46faea(0x1da)]='GET',_0xbf7119[_0x46faea(0x1c1)]=_0x46faea(0x1b1);const _0x3caa3f=_0xbf7119;try{const _0x45254c=await helper['nodeRequest'](_0x3caa3f['FMGea'],_0x3caa3f[_0x46faea(0x1c1)],null,null,this.#address);if(_0x45254c)return!![];}catch(_0x52380a){return![];}}async['start'](){const _0x170c11=a110_0x2c5b0f,_0xbf4c57={'tlkcm':_0x170c11(0x1a6),'KmThD':_0x170c11(0x1b2),'HzKMP':function(_0x57ec44,_0x6b00fb,_0xf0bab9,_0x36505e){return _0x57ec44(_0x6b00fb,_0xf0bab9,_0x36505e);},'BauSq':_0x170c11(0x1d7),'vlYtr':_0x170c11(0x1ca)},_0x5ec56b=await this.#getBinaryPath(),_0x14c94d={};_0x14c94d[_0x170c11(0x19c)]='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x14c94d);const _0x265536=await this[_0x170c11(0x1d3)](),_0x600b76=await this['createPercyConfig']();if(!_0x265536)return![];const _0x2d0208=[(this.#isApp?_0xbf4c57['tlkcm']:_0xbf4c57[_0x170c11(0x1c0)])+':start'];_0x600b76&&_0x2d0208[_0x170c11(0x198)]('-c',_0x600b76);this.#proc=_0xbf4c57['HzKMP'](spawn,_0x5ec56b,_0x2d0208,{'env':Object['assign'](process['env'],{'PERCY_TOKEN':_0x265536,'TH_BUILD_UUID':process[_0x170c11(0x1d5)][testHubConstants[_0x170c11(0x1c3)][_0x170c11(0x19e)]]})}),this.#proc[_0x170c11(0x1c5)][_0x170c11(0x193)](this.#logStream),this.#proc[_0x170c11(0x1ad)][_0x170c11(0x193)](this.#logStream),this[_0x170c11(0x1bd)]=!![];var _0x11fd58=this;this.#proc['on'](_0xbf4c57[_0x170c11(0x197)],function(_0x3bbfdf){const _0x25ab9b=_0x170c11;_0x11fd58[_0x25ab9b(0x1bd)]=![];});do{const _0xbf1ec1=await this[_0x170c11(0x1d8)]();if(_0xbf1ec1)return logger[_0x170c11(0x19b)](_0xbf4c57[_0x170c11(0x1cf)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a110_0x2c5b0f(0x1a7)](){const _0x138ffe=a110_0x2c5b0f,_0x38cc38={'Refvs':function(_0x200d27,_0x35ae92){return _0x200d27(_0x35ae92);},'IfJGR':function(_0x21e8db,_0x3d267b,_0x4f6961){return _0x21e8db(_0x3d267b,_0x4f6961);},'WQiCL':_0x138ffe(0x1d0),'HpLNJ':'close'},_0x16b123=await this.#getBinaryPath();return new Promise((_0x6a8901,_0x30f437)=>{const _0x29eba8=_0x138ffe,_0x5faa2d={'HWbCp':function(_0xf9f4b2,_0x4adf52){return _0x38cc38['Refvs'](_0xf9f4b2,_0x4adf52);}},_0x19c015=_0x38cc38[_0x29eba8(0x1c9)](spawn,_0x16b123,[_0x38cc38['WQiCL']]);_0x19c015['on'](_0x38cc38['HpLNJ'],_0x5c97fc=>{const _0x1be413=_0x29eba8;this[_0x1be413(0x1bd)]=![],this.#logStream&&(this.#logStream['end'](),this.#logStream=null),_0x5faa2d[_0x1be413(0x1aa)](_0x6a8901,_0x5c97fc);});});}['isRunning'](){const _0x157dd8=a110_0x2c5b0f;return this[_0x157dd8(0x1bd)];}async['fetchPercyToken'](){const _0x5164b0=a110_0x2c5b0f,_0x300280={};_0x300280[_0x5164b0(0x199)]=_0x5164b0(0x1d4),_0x300280[_0x5164b0(0x1d2)]='automate',_0x300280[_0x5164b0(0x1b3)]=_0x5164b0(0x1b6),_0x300280[_0x5164b0(0x18f)]=_0x5164b0(0x1c2);const _0x2da643=_0x300280,_0x3bf5e7=this.#config[_0x5164b0(0x1a8)];try{const _0x45c439=this.#isApp?_0x2da643['jhQrx']:_0x2da643['MHDQb'],_0x5d7dc7=await helper[_0x5164b0(0x1bc)](_0x2da643[_0x5164b0(0x1b3)],_0x5164b0(0x1dc)+_0x3bf5e7+_0x5164b0(0x1af)+_0x45c439,{},this.#config),_0xb3b75d=_0x5d7dc7[_0x5164b0(0x19f)];return logger[_0x5164b0(0x19b)](_0x2da643[_0x5164b0(0x18f)]),_0xb3b75d[_0x5164b0(0x191)];}catch(_0x33e420){return logger['error'](_0x5164b0(0x190)+_0x33e420),null;}}async[a110_0x2c5b0f(0x1a1)](){const _0x36ab45=a110_0x2c5b0f,_0x464980={'jhJQJ':function(_0x2894f0,_0x3346f2){return _0x2894f0(_0x3346f2);},'VVLNB':function(_0x41781a,_0x143e58){return _0x41781a+_0x143e58;},'agSgu':_0x36ab45(0x1bb),'IKtqn':_0x36ab45(0x1c4)};if(!this.#config['percyOptions'])return null;const _0x2cf445=path[_0x36ab45(0x1d6)](os[_0x36ab45(0x1a5)](),_0x464980[_0x36ab45(0x1db)]),_0x40e991=this.#config['percyOptions'];return!_0x40e991[_0x36ab45(0x196)]&&(_0x40e991[_0x36ab45(0x196)]='2'),new Promise((_0x388d43,_0x150708)=>{const _0x1b2c48=_0x36ab45,_0x232fe8={'XhBlX':function(_0x32be6d,_0x5b7f91){const _0x56fcf2=a110_0x3712;return _0x464980[_0x56fcf2(0x1c7)](_0x32be6d,_0x5b7f91);},'Kooso':function(_0x2cf39e,_0x37cafc){return _0x464980['VVLNB'](_0x2cf39e,_0x37cafc);},'WXPaV':_0x464980['agSgu'],'domJI':function(_0x4f3d73,_0x18e77a){return _0x464980['jhJQJ'](_0x4f3d73,_0x18e77a);}};fs[_0x1b2c48(0x1bf)](_0x2cf445,JSON[_0x1b2c48(0x1cd)](_0x40e991),_0x3799ea=>{const _0x48bab6=_0x1b2c48;_0x3799ea&&(logger[_0x48bab6(0x1b7)](_0x48bab6(0x1b9)+_0x3799ea),_0x232fe8['XhBlX'](_0x388d43,null)),logger[_0x48bab6(0x19b)](_0x232fe8[_0x48bab6(0x19a)](_0x232fe8[_0x48bab6(0x1b4)],_0x2cf445)),_0x232fe8[_0x48bab6(0x1ac)](_0x388d43,_0x2cf445);});});}}module['exports']=Percy;
const a108_0x5b52e1=a108_0x558f;(function(_0x55c347,_0x2ac541){const _0x12584b=a108_0x558f,_0x116301=_0x55c347();while(!![]){try{const _0x298e6e=parseInt(_0x12584b(0xce))/0x1*(parseInt(_0x12584b(0xe0))/0x2)+-parseInt(_0x12584b(0xe5))/0x3+parseInt(_0x12584b(0xf6))/0x4+-parseInt(_0x12584b(0xd3))/0x5+parseInt(_0x12584b(0xc3))/0x6*(-parseInt(_0x12584b(0xc5))/0x7)+parseInt(_0x12584b(0xf9))/0x8+parseInt(_0x12584b(0xee))/0x9;if(_0x298e6e===_0x2ac541)break;else _0x116301['push'](_0x116301['shift']());}catch(_0x35bb65){_0x116301['push'](_0x116301['shift']());}}}(a108_0xdb79,0x6e124));const fs=require('fs'),path=require(a108_0x5b52e1(0xef)),os=require('os'),{spawn}=require(a108_0x5b52e1(0xbd)),helper=require(a108_0x5b52e1(0xd2)),logger=require(a108_0x5b52e1(0xbe))[a108_0x5b52e1(0x103)],{getLogDir}=require('../logger'),testHubConstants=require(a108_0x5b52e1(0xe8)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a108_0x5b52e1(0xed)),PercyBinary=require(a108_0x5b52e1(0xfe));function a108_0xdb79(){const _0xe50085=['2242068ReIVkO','isProcessRunning','TxGmR','../../helpers/testhub/constants','createPercyConfig','createWriteStream','version','ZVbmV','../../helpers/performance/constants','4902849XEuKiy','path','data','app','Izzzp','automate','ByqVA','gZOMM','1819180gxjmli','exports','api/app_percy/get_project_token?name=','3594736RLsxsp','percyOptions','Percy\x20config\x20created\x20at\x20','tmpdir','jFMCz','./PercyBinary','stop','error','DOWNLOAD','fetchPercyToken','winstonLogger','getBinaryPath','OtAXv','exec:stop','Percy\x20healthcheck\x20successful','pipe','debug','QyuSY','child_process','../logger','start','Percy\x20fetch\x20token\x20success','GET','projectName','12QkySqG','close','2349053wOdmrw','percy.json','isRunning','mPxsJ','SlRtP','ENV_VAR','BnGAQ','fTJyj','Error\x20creating\x20percy\x20config:\x20','460806GMUEBr',':start','stringify','healthcheck','../helper','201690aBBhgU','http://localhost:5338','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','cMybR','PypSK','PERCY_SERVER_ADDRESS','zghhl','wAQPt','end','env','HaHhn','stderr','BROWSERSTACK_TESTHUB_UUID','2mhphWQ','assign','nodeRequest','percy/healthcheck','push'];a108_0xdb79=function(){return _0xe50085;};return a108_0xdb79();}class Percy{#logfile=path['join'](getLogDir(),'percy.log');#address=process[a108_0x5b52e1(0xdc)][a108_0x5b52e1(0xd8)]||a108_0x5b52e1(0xd4);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x54a923){this.#config=_0x54a923,!!_0x54a923['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x215ce5=a108_0x5b52e1;if(!this.#binaryPath){const _0x344fed=new PercyBinary();PerformanceTester[_0x215ce5(0xbf)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x344fed[_0x215ce5(0x104)](this.#config),PerformanceTester[_0x215ce5(0xdb)](PerformanceEvents[_0x215ce5(0x101)]);}return this.#binaryPath;}async #sleep(_0x1b1e6d){return new Promise(_0x425445=>setTimeout(_0x425445,_0x1b1e6d));}async['healthcheck'](){const _0x2c0e67=a108_0x5b52e1,_0x143dc4={};_0x143dc4['PypSK']=_0x2c0e67(0xc1),_0x143dc4['cMybR']=_0x2c0e67(0xe3);const _0x11eb41=_0x143dc4;try{const _0x2c1906=await helper[_0x2c0e67(0xe2)](_0x11eb41[_0x2c0e67(0xd7)],_0x11eb41[_0x2c0e67(0xd6)],null,null,this.#address);if(_0x2c1906)return!![];}catch(_0x2ed38e){return![];}}async[a108_0x5b52e1(0xbf)](){const _0x4b8bc8=a108_0x5b52e1,_0x573181={'BnGAQ':'app:exec','ZVbmV':'exec','CugOy':function(_0x491227,_0x49a570,_0x3308e0,_0x3aca58){return _0x491227(_0x49a570,_0x3308e0,_0x3aca58);},'Izzzp':_0x4b8bc8(0xc4),'fTJyj':_0x4b8bc8(0xb9)},_0x9d066d=await this.#getBinaryPath(),_0x352398={};_0x352398['flags']='a';const _0x449344=fs[_0x4b8bc8(0xea)](this.#logfile,_0x352398),_0x4adfa2=await this[_0x4b8bc8(0x102)](),_0x3510ef=await this[_0x4b8bc8(0xe9)]();if(!_0x4adfa2)return![];const _0x4a94c5=[(this.#isApp?_0x573181[_0x4b8bc8(0xcb)]:_0x573181[_0x4b8bc8(0xec)])+_0x4b8bc8(0xcf)];_0x3510ef&&_0x4a94c5[_0x4b8bc8(0xe4)]('-c',_0x3510ef);this.#proc=_0x573181['CugOy'](spawn,_0x9d066d,_0x4a94c5,{'env':Object[_0x4b8bc8(0xe1)](process['env'],{'PERCY_TOKEN':_0x4adfa2,'TH_BUILD_UUID':process[_0x4b8bc8(0xdc)][testHubConstants[_0x4b8bc8(0xca)][_0x4b8bc8(0xdf)]]})}),this.#proc['stdout'][_0x4b8bc8(0xba)](_0x449344),this.#proc[_0x4b8bc8(0xde)][_0x4b8bc8(0xba)](_0x449344),this['isProcessRunning']=!![];var _0x2d7128=this;this.#proc['on'](_0x573181[_0x4b8bc8(0xf2)],function(_0x43ea55){_0x2d7128['isProcessRunning']=![];});do{const _0x2be7fb=await this[_0x4b8bc8(0xd1)]();if(_0x2be7fb)return logger[_0x4b8bc8(0xbb)](_0x573181[_0x4b8bc8(0xcc)]),!![];await this.#sleep(0x3e8);}while(this[_0x4b8bc8(0xe6)]);return![];}async[a108_0x5b52e1(0xff)](){const _0x2f70c6=a108_0x5b52e1,_0x5be524={'HaHhn':function(_0x141198,_0x268326){return _0x141198(_0x268326);},'zghhl':function(_0x3cb1fd,_0x3af089,_0x5c5b60){return _0x3cb1fd(_0x3af089,_0x5c5b60);},'TxGmR':_0x2f70c6(0xb8),'dMffp':_0x2f70c6(0xc4)},_0x440012=await this.#getBinaryPath();return new Promise((_0x9040df,_0x36cf6b)=>{const _0x17ae0e=_0x2f70c6,_0x15229c=_0x5be524[_0x17ae0e(0xd9)](spawn,_0x440012,[_0x5be524[_0x17ae0e(0xe7)]]);_0x15229c['on'](_0x5be524['dMffp'],_0x53b33e=>{const _0x326eee=_0x17ae0e;this['isProcessRunning']=![],_0x5be524[_0x326eee(0xdd)](_0x9040df,_0x53b33e);});});}[a108_0x5b52e1(0xc7)](){const _0x1790ef=a108_0x5b52e1;return this[_0x1790ef(0xe6)];}async[a108_0x5b52e1(0x102)](){const _0x36887a=a108_0x5b52e1,_0x15bbaf={};_0x15bbaf[_0x36887a(0xc8)]=_0x36887a(0xf1),_0x15bbaf['wAQPt']=_0x36887a(0xf3),_0x15bbaf[_0x36887a(0xbc)]=_0x36887a(0xc1),_0x15bbaf['uCAjY']=_0x36887a(0xc0);const _0xe05e97=_0x15bbaf,_0xde486=this.#config[_0x36887a(0xc2)];try{const _0x30e896=this.#isApp?_0xe05e97[_0x36887a(0xc8)]:_0xe05e97[_0x36887a(0xda)],_0x5680b6=await helper[_0x36887a(0xe2)](_0xe05e97['QyuSY'],_0x36887a(0xf8)+_0xde486+'&type='+_0x30e896,{},this.#config),_0x486339=_0x5680b6[_0x36887a(0xf0)];return logger['debug'](_0xe05e97['uCAjY']),_0x486339['token'];}catch(_0x131010){return logger[_0x36887a(0x100)](_0x36887a(0xd5)+_0x131010),null;}}async[a108_0x5b52e1(0xe9)](){const _0x1f0d6e=a108_0x5b52e1,_0x48dd60={'Pczrk':function(_0x417f81,_0x4151e0){return _0x417f81(_0x4151e0);},'OtAXv':function(_0x39e65f,_0x5051a4){return _0x39e65f+_0x5051a4;},'xsepP':_0x1f0d6e(0xfb),'SlRtP':_0x1f0d6e(0xc6)};if(!this.#config['percyOptions'])return null;const _0x5361e6=path['join'](os[_0x1f0d6e(0xfc)](),_0x48dd60[_0x1f0d6e(0xc9)]),_0x1684e7=this.#config[_0x1f0d6e(0xfa)];return!_0x1684e7['version']&&(_0x1684e7[_0x1f0d6e(0xeb)]='2'),new Promise((_0x3f521f,_0x30f76b)=>{const _0xe998a4=_0x1f0d6e,_0x2e83fd={'gZOMM':function(_0x5d8d79,_0x4c8358){return _0x48dd60['Pczrk'](_0x5d8d79,_0x4c8358);},'jFMCz':function(_0x10fa3f,_0x1a3cc0){const _0x238f63=a108_0x558f;return _0x48dd60[_0x238f63(0x105)](_0x10fa3f,_0x1a3cc0);},'ByqVA':_0x48dd60['xsepP']};fs['writeFile'](_0x5361e6,JSON[_0xe998a4(0xd0)](_0x1684e7),_0x13ea2f=>{const _0xb699f4=_0xe998a4;_0x13ea2f&&(logger[_0xb699f4(0x100)](_0xb699f4(0xcd)+_0x13ea2f),_0x2e83fd['gZOMM'](_0x3f521f,null)),logger[_0xb699f4(0xbb)](_0x2e83fd[_0xb699f4(0xfd)](_0x2e83fd[_0xb699f4(0xf4)],_0x5361e6)),_0x2e83fd[_0xb699f4(0xf5)](_0x3f521f,_0x5361e6);});});}}function a108_0x558f(_0x164291,_0x3e4653){const _0xdb799=a108_0xdb79();return a108_0x558f=function(_0x558fe,_0x2ce233){_0x558fe=_0x558fe-0xb8;let _0x42dc4e=_0xdb799[_0x558fe];return _0x42dc4e;},a108_0x558f(_0x164291,_0x3e4653);}module[a108_0x5b52e1(0xf7)]=Percy;
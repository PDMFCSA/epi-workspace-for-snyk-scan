const a103_0x45f2e1=a103_0x2fbe;(function(_0x2d564d,_0x358e8b){const _0x1a068a=a103_0x2fbe,_0x3ff242=_0x2d564d();while(!![]){try{const _0x5f30d8=parseInt(_0x1a068a(0x15c))/0x1*(parseInt(_0x1a068a(0x124))/0x2)+-parseInt(_0x1a068a(0x166))/0x3*(-parseInt(_0x1a068a(0x133))/0x4)+-parseInt(_0x1a068a(0x153))/0x5*(-parseInt(_0x1a068a(0x159))/0x6)+parseInt(_0x1a068a(0x15d))/0x7*(-parseInt(_0x1a068a(0x11d))/0x8)+parseInt(_0x1a068a(0x13a))/0x9*(-parseInt(_0x1a068a(0x13c))/0xa)+parseInt(_0x1a068a(0x12b))/0xb+-parseInt(_0x1a068a(0x165))/0xc*(parseInt(_0x1a068a(0x154))/0xd);if(_0x5f30d8===_0x358e8b)break;else _0x3ff242['push'](_0x3ff242['shift']());}catch(_0x3b78a5){_0x3ff242['push'](_0x3ff242['shift']());}}}(a103_0x3890,0x88d4f));function a103_0x2fbe(_0x207aee,_0x5a0b17){const _0x38906c=a103_0x3890();return a103_0x2fbe=function(_0x2fbef5,_0xf2aa65){_0x2fbef5=_0x2fbef5-0x11c;let _0x3578cb=_0x38906c[_0x2fbef5];return _0x3578cb;},a103_0x2fbe(_0x207aee,_0x5a0b17);}const fs=require('fs'),path=require(a103_0x45f2e1(0x15b)),os=require('os'),{spawn}=require(a103_0x45f2e1(0x152)),helper=require(a103_0x45f2e1(0x134)),logger=require(a103_0x45f2e1(0x14d))[a103_0x45f2e1(0x143)],{getLogDir}=require('../logger'),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require(a103_0x45f2e1(0x129)),{PERCY_EVENTS:PerformanceEvents}=require(a103_0x45f2e1(0x145)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a103_0x45f2e1(0x132)](getLogDir(),'percy.log');#address=process['env']['PERCY_SERVER_ADDRESS']||a103_0x45f2e1(0x156);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a103_0x45f2e1(0x149)]=![];constructor(_0x45c017){const _0x4e92ed=a103_0x45f2e1;this.#config=_0x45c017,!!_0x45c017[_0x4e92ed(0x131)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x2fba82=a103_0x45f2e1;if(!this.#binaryPath){const _0x169465=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x2fba82(0x158)]),this.#binaryPath=await _0x169465[_0x2fba82(0x14f)](this.#config),PerformanceTester[_0x2fba82(0x167)](PerformanceEvents[_0x2fba82(0x158)]);}return this.#binaryPath;}async #sleep(_0x2e6d6c){return new Promise(_0x48a7f8=>setTimeout(_0x48a7f8,_0x2e6d6c));}async[a103_0x45f2e1(0x141)](){const _0x1bc231=a103_0x45f2e1,_0x340c0f={};_0x340c0f[_0x1bc231(0x163)]=_0x1bc231(0x147),_0x340c0f[_0x1bc231(0x160)]=_0x1bc231(0x13b);const _0x359937=_0x340c0f;try{const _0x26ea75=await helper[_0x1bc231(0x136)](_0x359937[_0x1bc231(0x163)],_0x359937[_0x1bc231(0x160)],null,null,this.#address);if(_0x26ea75)return!![];}catch(_0x39a9e0){return![];}}async[a103_0x45f2e1(0x128)](){const _0x527ba3=a103_0x45f2e1,_0x487992={'tCZfA':_0x527ba3(0x142),'IlREb':'exec','ojitJ':function(_0x4a04d4,_0x449c9e,_0x283ace,_0x2b0618){return _0x4a04d4(_0x449c9e,_0x283ace,_0x2b0618);},'TJJGF':_0x527ba3(0x144),'nYqEq':_0x527ba3(0x14a)},_0x25fed2=await this.#getBinaryPath(),_0x40ba38={};_0x40ba38[_0x527ba3(0x13f)]='a';const _0x320b15=fs[_0x527ba3(0x130)](this.#logfile,_0x40ba38),_0x40bf58=await this['fetchPercyToken'](),_0x2493cc=await this[_0x527ba3(0x14e)]();if(!_0x40bf58)return![];const _0xd25321=[(this.#isApp?_0x487992[_0x527ba3(0x148)]:_0x487992['IlREb'])+_0x527ba3(0x162)];_0x2493cc&&_0xd25321[_0x527ba3(0x12d)]('-c',_0x2493cc);this.#proc=_0x487992['ojitJ'](spawn,_0x25fed2,_0xd25321,{'env':Object[_0x527ba3(0x135)](process[_0x527ba3(0x15f)],{'PERCY_TOKEN':_0x40bf58,'TH_BUILD_UUID':process[_0x527ba3(0x15f)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x527ba3(0x14c)]['pipe'](_0x320b15),this.#proc[_0x527ba3(0x139)]['pipe'](_0x320b15),this[_0x527ba3(0x149)]=!![];var _0x5989ca=this;this.#proc['on'](_0x487992[_0x527ba3(0x146)],function(_0x3afa60){const _0x252cb4=_0x527ba3;_0x5989ca[_0x252cb4(0x149)]=![];});do{const _0x1ff77f=await this[_0x527ba3(0x141)]();if(_0x1ff77f)return logger[_0x527ba3(0x11c)](_0x487992[_0x527ba3(0x120)]),!![];await this.#sleep(0x3e8);}while(this[_0x527ba3(0x149)]);return![];}async['stop'](){const _0x1bb279=a103_0x45f2e1,_0x415970={'arqUC':function(_0xd444d3,_0x29c955){return _0xd444d3(_0x29c955);},'SmAUd':function(_0x412aa2,_0x1b8cd2,_0xa2dbc3){return _0x412aa2(_0x1b8cd2,_0xa2dbc3);},'oPFKZ':'exec:stop','kVmrR':_0x1bb279(0x144)},_0x2c3268=await this.#getBinaryPath();return new Promise((_0xd144db,_0x44882b)=>{const _0x3bf0e2=_0x1bb279,_0x212795=_0x415970['SmAUd'](spawn,_0x2c3268,[_0x415970[_0x3bf0e2(0x157)]]);_0x212795['on'](_0x415970[_0x3bf0e2(0x12e)],_0x48313c=>{const _0x3d58db=_0x3bf0e2;this[_0x3d58db(0x149)]=![],_0x415970[_0x3d58db(0x161)](_0xd144db,_0x48313c);});});}[a103_0x45f2e1(0x126)](){const _0xc9fd6b=a103_0x45f2e1;return this[_0xc9fd6b(0x149)];}async['fetchPercyToken'](){const _0x41ac0c=a103_0x45f2e1,_0x4d0396={};_0x4d0396[_0x41ac0c(0x15a)]=_0x41ac0c(0x131),_0x4d0396[_0x41ac0c(0x12a)]='automate',_0x4d0396[_0x41ac0c(0x11f)]=_0x41ac0c(0x147),_0x4d0396['MpoUy']=_0x41ac0c(0x15e);const _0x882731=_0x4d0396,_0x15324e=this.#config[_0x41ac0c(0x151)];try{const _0x4213b8=this.#isApp?_0x882731[_0x41ac0c(0x15a)]:_0x882731['hiDsl'],_0x2125ea=await helper[_0x41ac0c(0x136)](_0x882731[_0x41ac0c(0x11f)],_0x41ac0c(0x169)+_0x15324e+'&type='+_0x4213b8,{},this.#config),_0x4db014=_0x2125ea['data'];return logger[_0x41ac0c(0x11c)](_0x882731[_0x41ac0c(0x13d)]),_0x4db014[_0x41ac0c(0x125)];}catch(_0x1cc422){return logger['error'](_0x41ac0c(0x168)+_0x1cc422),null;}}async[a103_0x45f2e1(0x14e)](){const _0x39b8df=a103_0x45f2e1,_0x26ec90={'bglbQ':function(_0x5a7f5f,_0x4f09d1){return _0x5a7f5f(_0x4f09d1);},'ndvaX':function(_0x84582f,_0x4c8c5f){return _0x84582f+_0x4c8c5f;},'IkXIr':_0x39b8df(0x11e),'WzIjq':_0x39b8df(0x140)};if(!this.#config[_0x39b8df(0x150)])return null;const _0x4dad81=path[_0x39b8df(0x132)](os[_0x39b8df(0x123)](),_0x26ec90['WzIjq']),_0x4ed819=this.#config['percyOptions'];return!_0x4ed819[_0x39b8df(0x127)]&&(_0x4ed819['version']='2'),new Promise((_0x582430,_0x8142d1)=>{const _0x3fc050=_0x39b8df,_0x1cdc7f={'XPTJK':function(_0x8abf65,_0x55497a){const _0x2b6ff8=a103_0x2fbe;return _0x26ec90[_0x2b6ff8(0x137)](_0x8abf65,_0x55497a);},'pxwjy':function(_0x4dc391,_0x424ca4){const _0x26c76a=a103_0x2fbe;return _0x26ec90[_0x26c76a(0x164)](_0x4dc391,_0x424ca4);},'hAYql':_0x26ec90['IkXIr'],'ozIim':function(_0x20dba4,_0xc3d2e9){const _0x395fbf=a103_0x2fbe;return _0x26ec90[_0x395fbf(0x137)](_0x20dba4,_0xc3d2e9);}};fs['writeFile'](_0x4dad81,JSON[_0x3fc050(0x121)](_0x4ed819),_0x58b936=>{const _0x30bc6b=_0x3fc050;_0x58b936&&(logger[_0x30bc6b(0x12c)](_0x30bc6b(0x138)+_0x58b936),_0x1cdc7f[_0x30bc6b(0x13e)](_0x582430,null)),logger[_0x30bc6b(0x11c)](_0x1cdc7f[_0x30bc6b(0x122)](_0x1cdc7f[_0x30bc6b(0x14b)],_0x4dad81)),_0x1cdc7f[_0x30bc6b(0x155)](_0x582430,_0x4dad81);});});}}function a103_0x3890(){const _0x1b319c=['Error\x20creating\x20percy\x20config:\x20','stderr','57789LsyBNh','percy/healthcheck','310pbOWKQ','MpoUy','XPTJK','flags','percy.json','healthcheck','app:exec','winstonLogger','close','../../helpers/performance/constants','TJJGF','GET','tCZfA','isProcessRunning','Percy\x20healthcheck\x20successful','hAYql','stdout','../logger','createPercyConfig','getBinaryPath','percyOptions','projectName','child_process','4058305aabieN','26iZzxWF','ozIim','http://localhost:5338','oPFKZ','DOWNLOAD','6wrLXRc','ibBnK','path','113933OQMGkC','17213yxqHqa','Percy\x20fetch\x20token\x20success','env','afnaB','arqUC',':start','YQscI','ndvaX','10069452VzqIbJ','132nTTBpw','end','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','api/app_percy/get_project_token?name=','debug','400QNUsGW','Percy\x20config\x20created\x20at\x20','cjTmM','nYqEq','stringify','pxwjy','tmpdir','2Yuexjh','token','isRunning','version','start','../../helpers/performance/performance-tester','hiDsl','12261480jNItUO','error','push','kVmrR','exports','createWriteStream','app','join','47312ITNRed','../helper','assign','nodeRequest','bglbQ'];a103_0x3890=function(){return _0x1b319c;};return a103_0x3890();}module[a103_0x45f2e1(0x12f)]=Percy;
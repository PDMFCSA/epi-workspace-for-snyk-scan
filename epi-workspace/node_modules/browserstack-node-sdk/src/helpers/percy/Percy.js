const a113_0x23b0c2=a113_0x4bf0;function a113_0xc26e(){const _0x4a7323=['stop','DOWNLOAD','2897760FVCtsK','eEiiM','../../helpers/testhub/constants','env','token','winstonLogger','GET','flags','OpJLf','../../helpers/performance/constants','7140700AJOryg','Percy\x20fetch\x20token\x20success','join','BROWSERSTACK_TESTHUB_UUID','api/app_percy/get_project_token?name=','gNdlv','assign','start','exports','OGciF','stringify','writeFile','hZLuG','../helper','&type=','3746253SSnGAX','8221ertZja','end','fetchPercyToken','exec:stop','app','exec','NqMrS','projectName','kumWG','451rknJJz','percyOptions','58510yNYHYl','XrUhA','IfStE','gAcRw','error','healthcheck','debug','createPercyConfig','isRunning','push','automate','../../helpers/performance/performance-tester','ENV_VAR','pipe','oiTPs','data','stdout','percy.json','./PercyBinary','child_process','tmpdir','percy.log','jRqpx','8tuqsRk','278lACcjO','2468fhmHLC','getBinaryPath','4708359kyXUgp','path','isProcessRunning','close','qanJr','ebsNM','percy/healthcheck','Percy\x20healthcheck\x20successful','sehCB','hHoXo','app:exec','660XKxtIf','CjKVT','nodeRequest','tuJQA','aoXUg'];a113_0xc26e=function(){return _0x4a7323;};return a113_0xc26e();}function a113_0x4bf0(_0x51efa7,_0x357f6e){const _0xc26e9b=a113_0xc26e();return a113_0x4bf0=function(_0x4bf0fe,_0x320fcb){_0x4bf0fe=_0x4bf0fe-0x17c;let _0x29ee8a=_0xc26e9b[_0x4bf0fe];return _0x29ee8a;},a113_0x4bf0(_0x51efa7,_0x357f6e);}(function(_0xab5289,_0x24d034){const _0x28f0d3=a113_0x4bf0,_0x3fe370=_0xab5289();while(!![]){try{const _0x3cfdeb=-parseInt(_0x28f0d3(0x18c))/0x1*(parseInt(_0x28f0d3(0x1af))/0x2)+-parseInt(_0x28f0d3(0x1bd))/0x3*(parseInt(_0x28f0d3(0x1b0))/0x4)+parseInt(_0x28f0d3(0x17c))/0x5+parseInt(_0x28f0d3(0x1c4))/0x6+parseInt(_0x28f0d3(0x18b))/0x7+-parseInt(_0x28f0d3(0x1ae))/0x8*(parseInt(_0x28f0d3(0x1b2))/0x9)+-parseInt(_0x28f0d3(0x197))/0xa*(-parseInt(_0x28f0d3(0x195))/0xb);if(_0x3cfdeb===_0x24d034)break;else _0x3fe370['push'](_0x3fe370['shift']());}catch(_0x4a57b9){_0x3fe370['push'](_0x3fe370['shift']());}}}(a113_0xc26e,0xd7f50));const fs=require('fs'),path=require(a113_0x23b0c2(0x1b3)),os=require('os'),{spawn}=require(a113_0x23b0c2(0x1aa)),helper=require(a113_0x23b0c2(0x189)),logger=require('../logger')[a113_0x23b0c2(0x1c9)],{getLogDir}=require('../logger'),testHubConstants=require(a113_0x23b0c2(0x1c6)),PerformanceTester=require(a113_0x23b0c2(0x1a2)),{PERCY_EVENTS:PerformanceEvents}=require(a113_0x23b0c2(0x1cd)),PercyBinary=require(a113_0x23b0c2(0x1a9));class Percy{#logfile=path[a113_0x23b0c2(0x17e)](getLogDir(),a113_0x23b0c2(0x1ac));#address=process[a113_0x23b0c2(0x1c7)]['PERCY_SERVER_ADDRESS']||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a113_0x23b0c2(0x1b4)]=![];constructor(_0x1be8c3){const _0x24a0dc=a113_0x23b0c2;this.#config=_0x1be8c3,!!_0x1be8c3[_0x24a0dc(0x190)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x1bb629=a113_0x23b0c2;if(!this.#binaryPath){const _0x229ab6=new PercyBinary();PerformanceTester[_0x1bb629(0x183)](PerformanceEvents[_0x1bb629(0x1c3)]),this.#binaryPath=await _0x229ab6[_0x1bb629(0x1b1)](this.#config),PerformanceTester[_0x1bb629(0x18d)](PerformanceEvents[_0x1bb629(0x1c3)]);}return this.#binaryPath;}async #sleep(_0x223459){return new Promise(_0x32b3fb=>setTimeout(_0x32b3fb,_0x223459));}async[a113_0x23b0c2(0x19c)](){const _0x31dc6f=a113_0x23b0c2,_0x22c06b={};_0x22c06b['sehCB']=_0x31dc6f(0x1ca),_0x22c06b[_0x31dc6f(0x1b6)]=_0x31dc6f(0x1b8);const _0x5da5f7=_0x22c06b;try{const _0x5f3aa1=await helper[_0x31dc6f(0x1bf)](_0x5da5f7[_0x31dc6f(0x1ba)],_0x5da5f7[_0x31dc6f(0x1b6)],null,null,this.#address);if(_0x5f3aa1)return!![];}catch(_0x590f6f){return![];}}async[a113_0x23b0c2(0x183)](){const _0x2b2adc=a113_0x23b0c2,_0x3cbb76={'CjKVT':_0x2b2adc(0x1bc),'aoXUg':_0x2b2adc(0x191),'hZLuG':function(_0x43a09b,_0x1ccbdd,_0x1f9da0,_0x91a23d){return _0x43a09b(_0x1ccbdd,_0x1f9da0,_0x91a23d);},'IfStE':_0x2b2adc(0x1b5),'tuJQA':_0x2b2adc(0x1b9)},_0x33a573=await this.#getBinaryPath(),_0x46ad77={};_0x46ad77[_0x2b2adc(0x1cb)]='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x46ad77);const _0x171e25=await this[_0x2b2adc(0x18e)](),_0x3b47e4=await this['createPercyConfig']();if(!_0x171e25)return![];const _0x1572ad=[(this.#isApp?_0x3cbb76[_0x2b2adc(0x1be)]:_0x3cbb76[_0x2b2adc(0x1c1)])+':start'];_0x3b47e4&&_0x1572ad[_0x2b2adc(0x1a0)]('-c',_0x3b47e4);this.#proc=_0x3cbb76[_0x2b2adc(0x188)](spawn,_0x33a573,_0x1572ad,{'env':Object[_0x2b2adc(0x182)](process[_0x2b2adc(0x1c7)],{'PERCY_TOKEN':_0x171e25,'TH_BUILD_UUID':process['env'][testHubConstants[_0x2b2adc(0x1a3)][_0x2b2adc(0x17f)]]})}),this.#proc[_0x2b2adc(0x1a7)][_0x2b2adc(0x1a4)](this.#logStream),this.#proc['stderr'][_0x2b2adc(0x1a4)](this.#logStream),this[_0x2b2adc(0x1b4)]=!![];var _0x593ba0=this;this.#proc['on'](_0x3cbb76[_0x2b2adc(0x199)],function(_0x45bf90){const _0x422da4=_0x2b2adc;_0x593ba0[_0x422da4(0x1b4)]=![];});do{const _0x14cb9e=await this[_0x2b2adc(0x19c)]();if(_0x14cb9e)return logger[_0x2b2adc(0x19d)](_0x3cbb76[_0x2b2adc(0x1c0)]),!![];await this.#sleep(0x3e8);}while(this[_0x2b2adc(0x1b4)]);return![];}async[a113_0x23b0c2(0x1c2)](){const _0x580e13=a113_0x23b0c2,_0x2cf648={'NqMrS':function(_0x4ba38f,_0x2e2c34){return _0x4ba38f(_0x2e2c34);},'odJNS':function(_0x21e877,_0x447cf0,_0x7fdb35){return _0x21e877(_0x447cf0,_0x7fdb35);},'oiTPs':_0x580e13(0x18f),'ebsNM':_0x580e13(0x1b5)},_0x9001e5=await this.#getBinaryPath();return new Promise((_0x4d94a5,_0xf98353)=>{const _0x3195f4=_0x580e13,_0x33c1fb=_0x2cf648['odJNS'](spawn,_0x9001e5,[_0x2cf648[_0x3195f4(0x1a5)]]);_0x33c1fb['on'](_0x2cf648[_0x3195f4(0x1b7)],_0x2ed1d0=>{const _0x17e2cd=_0x3195f4;this[_0x17e2cd(0x1b4)]=![],this.#logStream&&(this.#logStream[_0x17e2cd(0x18d)](),this.#logStream=null),_0x2cf648[_0x17e2cd(0x192)](_0x4d94a5,_0x2ed1d0);});});}[a113_0x23b0c2(0x19f)](){const _0x1029cf=a113_0x23b0c2;return this[_0x1029cf(0x1b4)];}async[a113_0x23b0c2(0x18e)](){const _0x1ee6a3=a113_0x23b0c2,_0x14ddac={};_0x14ddac[_0x1ee6a3(0x194)]=_0x1ee6a3(0x190),_0x14ddac['gNdlv']=_0x1ee6a3(0x1a1),_0x14ddac[_0x1ee6a3(0x1c5)]=_0x1ee6a3(0x1ca),_0x14ddac[_0x1ee6a3(0x185)]=_0x1ee6a3(0x17d);const _0x429c6f=_0x14ddac,_0x89234=this.#config[_0x1ee6a3(0x193)];try{const _0x1804e4=this.#isApp?_0x429c6f[_0x1ee6a3(0x194)]:_0x429c6f[_0x1ee6a3(0x181)],_0x453577=await helper[_0x1ee6a3(0x1bf)](_0x429c6f[_0x1ee6a3(0x1c5)],_0x1ee6a3(0x180)+_0x89234+_0x1ee6a3(0x18a)+_0x1804e4,{},this.#config),_0xe7c83c=_0x453577[_0x1ee6a3(0x1a6)];return logger[_0x1ee6a3(0x19d)](_0x429c6f[_0x1ee6a3(0x185)]),_0xe7c83c[_0x1ee6a3(0x1c8)];}catch(_0x1cbb8f){return logger[_0x1ee6a3(0x19b)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x1cbb8f),null;}}async[a113_0x23b0c2(0x19e)](){const _0x1e9ec2=a113_0x23b0c2,_0x96cfec={'LhbyH':function(_0x33cb5d,_0x406ac8){return _0x33cb5d(_0x406ac8);},'jRqpx':function(_0x92d5b,_0x58493c){return _0x92d5b+_0x58493c;},'kbgLL':'Percy\x20config\x20created\x20at\x20','hHoXo':_0x1e9ec2(0x1a8)};if(!this.#config[_0x1e9ec2(0x196)])return null;const _0x8e54e9=path[_0x1e9ec2(0x17e)](os[_0x1e9ec2(0x1ab)](),_0x96cfec[_0x1e9ec2(0x1bb)]),_0x189a64=this.#config[_0x1e9ec2(0x196)];return!_0x189a64['version']&&(_0x189a64['version']='2'),new Promise((_0x29d545,_0x5d8f3)=>{const _0x33cb9e=_0x1e9ec2,_0x2d137e={'XrUhA':function(_0x5aaac2,_0x49d4e1){return _0x96cfec['LhbyH'](_0x5aaac2,_0x49d4e1);},'OpJLf':function(_0x67780b,_0x344c0b){const _0x90135c=a113_0x4bf0;return _0x96cfec[_0x90135c(0x1ad)](_0x67780b,_0x344c0b);},'gAcRw':_0x96cfec['kbgLL']};fs[_0x33cb9e(0x187)](_0x8e54e9,JSON[_0x33cb9e(0x186)](_0x189a64),_0x3a07be=>{const _0x268b1c=_0x33cb9e;_0x3a07be&&(logger['error']('Error\x20creating\x20percy\x20config:\x20'+_0x3a07be),_0x2d137e[_0x268b1c(0x198)](_0x29d545,null)),logger[_0x268b1c(0x19d)](_0x2d137e[_0x268b1c(0x1cc)](_0x2d137e[_0x268b1c(0x19a)],_0x8e54e9)),_0x2d137e[_0x268b1c(0x198)](_0x29d545,_0x8e54e9);});});}}module[a113_0x23b0c2(0x184)]=Percy;
const a72_0x550185=a72_0x3cc4;(function(_0x571ce9,_0x5ccdec){const _0x53efd0=a72_0x3cc4,_0x8dc51e=_0x571ce9();while(!![]){try{const _0x3fe1b9=-parseInt(_0x53efd0(0xdf))/0x1*(parseInt(_0x53efd0(0xbf))/0x2)+parseInt(_0x53efd0(0xc7))/0x3+-parseInt(_0x53efd0(0xc8))/0x4+parseInt(_0x53efd0(0x9e))/0x5+parseInt(_0x53efd0(0xce))/0x6*(parseInt(_0x53efd0(0xd3))/0x7)+-parseInt(_0x53efd0(0xd9))/0x8*(-parseInt(_0x53efd0(0xdb))/0x9)+parseInt(_0x53efd0(0xb8))/0xa*(-parseInt(_0x53efd0(0xda))/0xb);if(_0x3fe1b9===_0x5ccdec)break;else _0x8dc51e['push'](_0x8dc51e['shift']());}catch(_0x94fa4d){_0x8dc51e['push'](_0x8dc51e['shift']());}}}(a72_0x39e3,0x555d4));const fs=require('fs'),path=require(a72_0x550185(0xdc)),os=require('os'),{spawn}=require(a72_0x550185(0xc2)),helper=require(a72_0x550185(0xc4)),logger=require(a72_0x550185(0xab))['winstonLogger'],{getLogDir}=require(a72_0x550185(0xab)),testHubConstants=require(a72_0x550185(0xa6)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a72_0x550185(0xa8));class Percy{#logfile=path[a72_0x550185(0xcc)](getLogDir(),a72_0x550185(0xd7));#address=process[a72_0x550185(0xb9)][a72_0x550185(0x9f)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x550185(0xad)]=![];constructor(_0x3aaadc){this.#config=_0x3aaadc,!!_0x3aaadc['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x404275=a72_0x550185;if(!this.#binaryPath){const _0x2e88a9=new PercyBinary();PerformanceTester[_0x404275(0xe5)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x2e88a9[_0x404275(0xc0)](this.#config),PerformanceTester['end'](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x1025bb){return new Promise(_0x15d44c=>setTimeout(_0x15d44c,_0x1025bb));}async[a72_0x550185(0xcb)](){const _0x16410f=a72_0x550185,_0x59404f={};_0x59404f[_0x16410f(0xaf)]=_0x16410f(0xa4),_0x59404f[_0x16410f(0xb7)]=_0x16410f(0xe4);const _0x25d669=_0x59404f;try{const _0x3be13d=await helper[_0x16410f(0xa9)](_0x25d669[_0x16410f(0xaf)],_0x25d669[_0x16410f(0xb7)],null,null,this.#address);if(_0x3be13d)return!![];}catch(_0x16f25b){return![];}}async[a72_0x550185(0xe5)](){const _0xf7074a=a72_0x550185,_0x53c717={'EdvIJ':_0xf7074a(0xca),'SuUhO':_0xf7074a(0xe6),'nNxUB':function(_0x5eda4d,_0x3f0870,_0x45f157,_0x3e5728){return _0x5eda4d(_0x3f0870,_0x45f157,_0x3e5728);},'kKtzg':_0xf7074a(0xb1),'DdrHd':'Percy\x20healthcheck\x20successful'},_0x122483=await this.#getBinaryPath(),_0x5205c0={};_0x5205c0[_0xf7074a(0xd5)]='a';const _0x427af7=fs[_0xf7074a(0xa5)](this.#logfile,_0x5205c0),_0xe6e9fc=await this[_0xf7074a(0xa2)](),_0x35542b=await this[_0xf7074a(0xd1)]();if(!_0xe6e9fc)return![];const _0x6a13d2=[(this.#isApp?_0x53c717[_0xf7074a(0xb0)]:_0x53c717[_0xf7074a(0xc3)])+_0xf7074a(0xa0)];_0x35542b&&_0x6a13d2[_0xf7074a(0xc6)]('-c',_0x35542b);this.#proc=_0x53c717[_0xf7074a(0xbe)](spawn,_0x122483,_0x6a13d2,{'env':Object['assign'](process[_0xf7074a(0xb9)],{'PERCY_TOKEN':_0xe6e9fc,'TH_BUILD_UUID':process['env'][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0xf7074a(0xba)]['pipe'](_0x427af7),this.#proc[_0xf7074a(0xb5)][_0xf7074a(0xb4)](_0x427af7),this[_0xf7074a(0xad)]=!![];var _0x20411a=this;this.#proc['on'](_0x53c717['kKtzg'],function(_0xac4ff4){const _0x19ba4f=_0xf7074a;_0x20411a[_0x19ba4f(0xad)]=![];});do{const _0x4370b8=await this[_0xf7074a(0xcb)]();if(_0x4370b8)return logger[_0xf7074a(0xc1)](_0x53c717['DdrHd']),!![];await this.#sleep(0x3e8);}while(this[_0xf7074a(0xad)]);return![];}async[a72_0x550185(0x9d)](){const _0x538f22=a72_0x550185,_0x905ae3={'LOnBK':function(_0x45aed4,_0x4b0796){return _0x45aed4(_0x4b0796);},'kZQeA':function(_0x30c31b,_0x44fdaa,_0x275cd8){return _0x30c31b(_0x44fdaa,_0x275cd8);},'NQCkM':_0x538f22(0xa1),'Aypli':_0x538f22(0xb1)},_0xdb581e=await this.#getBinaryPath();return new Promise((_0x58a6e0,_0x14d091)=>{const _0x31119a=_0x538f22,_0x57c9f5=_0x905ae3[_0x31119a(0xd2)](spawn,_0xdb581e,[_0x905ae3[_0x31119a(0xbb)]]);_0x57c9f5['on'](_0x905ae3[_0x31119a(0xa3)],_0x50f342=>{const _0x58cfb4=_0x31119a;this['isProcessRunning']=![],_0x905ae3[_0x58cfb4(0xb6)](_0x58a6e0,_0x50f342);});});}[a72_0x550185(0xbc)](){const _0x2599b0=a72_0x550185;return this[_0x2599b0(0xad)];}async[a72_0x550185(0xa2)](){const _0x4eed0f=a72_0x550185,_0xd0519c={};_0xd0519c[_0x4eed0f(0xc9)]=_0x4eed0f(0xc5),_0xd0519c[_0x4eed0f(0xaa)]='automate',_0xd0519c[_0x4eed0f(0xac)]=_0x4eed0f(0xa4),_0xd0519c[_0x4eed0f(0xb3)]=_0x4eed0f(0x9b);const _0x30963d=_0xd0519c,_0x1f34a2=this.#config[_0x4eed0f(0xa7)];try{const _0x246f48=this.#isApp?_0x30963d[_0x4eed0f(0xc9)]:_0x30963d[_0x4eed0f(0xaa)],_0x14b9e4=await helper[_0x4eed0f(0xa9)](_0x30963d['xvrdY'],'api/app_percy/get_project_token?name='+_0x1f34a2+_0x4eed0f(0xcf)+_0x246f48,{},this.#config),_0x1e427f=_0x14b9e4['data'];return logger['debug'](_0x30963d[_0x4eed0f(0xb3)]),_0x1e427f['token'];}catch(_0x10bce7){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x10bce7),null;}}async['createPercyConfig'](){const _0x2203bc=a72_0x550185,_0x39e83b={'hAUEj':function(_0x178627,_0x4fac37){return _0x178627(_0x4fac37);},'GzzIN':function(_0x31b450,_0x59d51a){return _0x31b450+_0x59d51a;},'CVYmB':_0x2203bc(0xe2),'LhIAV':_0x2203bc(0xe3)};if(!this.#config['percyOptions'])return null;const _0x584bcc=path['join'](os[_0x2203bc(0xae)](),_0x39e83b[_0x2203bc(0xb2)]),_0x438a30=this.#config[_0x2203bc(0x9c)];return!_0x438a30[_0x2203bc(0xdd)]&&(_0x438a30[_0x2203bc(0xdd)]='2'),new Promise((_0x545f5a,_0x2dc086)=>{const _0x306ee3=_0x2203bc,_0x2aa9f0={'FiVjK':function(_0x4b5cbe,_0x1edf50){const _0x1a4dbe=a72_0x3cc4;return _0x39e83b[_0x1a4dbe(0xbd)](_0x4b5cbe,_0x1edf50);},'edwSv':function(_0x171c4c,_0x3749eb){const _0x55456c=a72_0x3cc4;return _0x39e83b[_0x55456c(0xd4)](_0x171c4c,_0x3749eb);},'eFZLF':_0x39e83b[_0x306ee3(0xde)]};fs[_0x306ee3(0xcd)](_0x584bcc,JSON[_0x306ee3(0xd6)](_0x438a30),_0x48c83c=>{const _0x4f6767=_0x306ee3;_0x48c83c&&(logger[_0x4f6767(0xd0)](_0x4f6767(0xe0)+_0x48c83c),_0x2aa9f0['FiVjK'](_0x545f5a,null)),logger[_0x4f6767(0xc1)](_0x2aa9f0[_0x4f6767(0xd8)](_0x2aa9f0[_0x4f6767(0xe1)],_0x584bcc)),_0x2aa9f0['FiVjK'](_0x545f5a,_0x584bcc);});});}}function a72_0x3cc4(_0x1fe859,_0x3f98cf){const _0x39e3d0=a72_0x39e3();return a72_0x3cc4=function(_0x3cc4d9,_0x44b1e8){_0x3cc4d9=_0x3cc4d9-0x9b;let _0x8475fd=_0x39e3d0[_0x3cc4d9];return _0x8475fd;},a72_0x3cc4(_0x1fe859,_0x3f98cf);}function a72_0x39e3(){const _0x8e6302=['9999jfQhwV','207pWBtly','path','version','CVYmB','1049WvrgkF','Error\x20creating\x20percy\x20config:\x20','eFZLF','Percy\x20config\x20created\x20at\x20','percy.json','percy/healthcheck','start','exec','Percy\x20fetch\x20token\x20success','percyOptions','stop','309310JAAmZw','PERCY_SERVER_ADDRESS',':start','exec:stop','fetchPercyToken','Aypli','GET','createWriteStream','../../helpers/testhub/constants','projectName','./PercyBinary','nodeRequest','AVWlM','../logger','xvrdY','isProcessRunning','tmpdir','xNpvp','EdvIJ','close','LhIAV','uwqVs','pipe','stderr','LOnBK','ZhRks','180WunIes','env','stdout','NQCkM','isRunning','hAUEj','nNxUB','526dNXQwD','getBinaryPath','debug','child_process','SuUhO','../helper','app','push','1660227BIjfzk','499960HSJWzv','ypdyO','app:exec','healthcheck','join','writeFile','71508QsIvix','&type=','error','createPercyConfig','kZQeA','7mmFxAo','GzzIN','flags','stringify','percy.log','edwSv','48592KVGuEn'];a72_0x39e3=function(){return _0x8e6302;};return a72_0x39e3();}module['exports']=Percy;
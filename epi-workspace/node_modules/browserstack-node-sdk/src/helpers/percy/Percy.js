const a108_0x470443=a108_0x904e;function a108_0x904e(_0xa04cdd,_0x4c0280){const _0x1ab24f=a108_0x1ab2();return a108_0x904e=function(_0x904ee,_0x8014c1){_0x904ee=_0x904ee-0x17f;let _0x482ef6=_0x1ab24f[_0x904ee];return _0x482ef6;},a108_0x904e(_0xa04cdd,_0x4c0280);}function a108_0x1ab2(){const _0x1f0baf=['../../helpers/testhub/constants','hnkZp','nodeRequest','../../helpers/performance/performance-tester','2688318unuAOu','478zrYcHO','join','QLxfD','percyOptions','gxuUI','../helper','182356aCQZRc','./PercyBinary','debug','close','XqRqr','percy/healthcheck','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','CwsSv','3517381NikqWp','3179436QHezQE','1004540fBrpCD','pipe','exec','qXNeC','KLaBY','DOWNLOAD','projectName','ltkCQ','BROWSERSTACK_TESTHUB_UUID','tmpdir','hCauT','version','stdout','start',':start','lUHDV','PERCY_SERVER_ADDRESS','percy.json','assign','fetchPercyToken','16IwljRS','app','writeFile','1149828AOqtWV','data','RueEF','automate','exec:stop','OJMGN','isProcessRunning','pPLaa','gtBMX','error','zEdMD','healthcheck','spsSj','OGqrz','ENV_VAR','createPercyConfig','env','createWriteStream','end','787NUZFdu','fDZws','stop','push','Percy\x20healthcheck\x20successful','../logger','kUnEJ','http://localhost:5338','GET','winstonLogger','irqZm','exports','path'];a108_0x1ab2=function(){return _0x1f0baf;};return a108_0x1ab2();}(function(_0x11765e,_0x3dd8a2){const _0x52747a=a108_0x904e,_0x2fb80c=_0x11765e();while(!![]){try{const _0x23acce=parseInt(_0x52747a(0x184))/0x1*(parseInt(_0x52747a(0x196))/0x2)+parseInt(_0x52747a(0x1bd))/0x3+-parseInt(_0x52747a(0x19c))/0x4+parseInt(_0x52747a(0x1a6))/0x5+-parseInt(_0x52747a(0x1a5))/0x6+-parseInt(_0x52747a(0x1a4))/0x7+parseInt(_0x52747a(0x1ba))/0x8*(parseInt(_0x52747a(0x195))/0x9);if(_0x23acce===_0x3dd8a2)break;else _0x2fb80c['push'](_0x2fb80c['shift']());}catch(_0x1256be){_0x2fb80c['push'](_0x2fb80c['shift']());}}}(a108_0x1ab2,0x47377));const fs=require('fs'),path=require(a108_0x470443(0x190)),os=require('os'),{spawn}=require('child_process'),helper=require(a108_0x470443(0x19b)),logger=require(a108_0x470443(0x189))[a108_0x470443(0x18d)],{getLogDir}=require(a108_0x470443(0x189)),testHubConstants=require(a108_0x470443(0x191)),PerformanceTester=require(a108_0x470443(0x194)),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require(a108_0x470443(0x19d));class Percy{#logfile=path[a108_0x470443(0x197)](getLogDir(),'percy.log');#address=process[a108_0x470443(0x181)][a108_0x470443(0x1b6)]||a108_0x470443(0x18b);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a108_0x470443(0x1c3)]=![];constructor(_0x5a13cd){const _0x28dc24=a108_0x470443;this.#config=_0x5a13cd,!!_0x5a13cd[_0x28dc24(0x1bb)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x5f1daf=a108_0x470443;if(!this.#binaryPath){const _0x1633bf=new PercyBinary();PerformanceTester[_0x5f1daf(0x1b3)](PerformanceEvents[_0x5f1daf(0x1ab)]),this.#binaryPath=await _0x1633bf['getBinaryPath'](this.#config),PerformanceTester[_0x5f1daf(0x183)](PerformanceEvents[_0x5f1daf(0x1ab)]);}return this.#binaryPath;}async #sleep(_0x22a754){return new Promise(_0x2019fa=>setTimeout(_0x2019fa,_0x22a754));}async[a108_0x470443(0x1c8)](){const _0x511501=a108_0x470443,_0x5d3acf={};_0x5d3acf[_0x511501(0x1a9)]=_0x511501(0x18c),_0x5d3acf[_0x511501(0x1c7)]=_0x511501(0x1a1);const _0xac3276=_0x5d3acf;try{const _0x4d1234=await helper[_0x511501(0x193)](_0xac3276[_0x511501(0x1a9)],_0xac3276[_0x511501(0x1c7)],null,null,this.#address);if(_0x4d1234)return!![];}catch(_0x374b64){return![];}}async[a108_0x470443(0x1b3)](){const _0x4b0eb8=a108_0x470443,_0x10eb30={'QLxfD':'app:exec','RueEF':_0x4b0eb8(0x1a8),'irqZm':function(_0x395e15,_0x47b439,_0x2e9722,_0x5eeac9){return _0x395e15(_0x47b439,_0x2e9722,_0x5eeac9);},'kUnEJ':'close','FyJBk':_0x4b0eb8(0x188)},_0x4a6a08=await this.#getBinaryPath(),_0x2f07a3={};_0x2f07a3['flags']='a';const _0x392abf=fs[_0x4b0eb8(0x182)](this.#logfile,_0x2f07a3),_0x2794db=await this[_0x4b0eb8(0x1b9)](),_0x4050a0=await this[_0x4b0eb8(0x180)]();if(!_0x2794db)return![];const _0x42fb17=[(this.#isApp?_0x10eb30[_0x4b0eb8(0x198)]:_0x10eb30[_0x4b0eb8(0x1bf)])+_0x4b0eb8(0x1b4)];_0x4050a0&&_0x42fb17[_0x4b0eb8(0x187)]('-c',_0x4050a0);this.#proc=_0x10eb30[_0x4b0eb8(0x18e)](spawn,_0x4a6a08,_0x42fb17,{'env':Object[_0x4b0eb8(0x1b8)](process[_0x4b0eb8(0x181)],{'PERCY_TOKEN':_0x2794db,'TH_BUILD_UUID':process[_0x4b0eb8(0x181)][testHubConstants[_0x4b0eb8(0x17f)][_0x4b0eb8(0x1ae)]]})}),this.#proc[_0x4b0eb8(0x1b2)][_0x4b0eb8(0x1a7)](_0x392abf),this.#proc['stderr']['pipe'](_0x392abf),this[_0x4b0eb8(0x1c3)]=!![];var _0x245b45=this;this.#proc['on'](_0x10eb30[_0x4b0eb8(0x18a)],function(_0x305171){const _0x23ae6a=_0x4b0eb8;_0x245b45[_0x23ae6a(0x1c3)]=![];});do{const _0x3a8dc1=await this[_0x4b0eb8(0x1c8)]();if(_0x3a8dc1)return logger[_0x4b0eb8(0x19e)](_0x10eb30['FyJBk']),!![];await this.#sleep(0x3e8);}while(this[_0x4b0eb8(0x1c3)]);return![];}async[a108_0x470443(0x186)](){const _0x3397e3=a108_0x470443,_0x49fa09={'gxuUI':function(_0x25c7a0,_0x884908){return _0x25c7a0(_0x884908);},'hnkZp':function(_0x1ff2eb,_0x39669c,_0x1207d8){return _0x1ff2eb(_0x39669c,_0x1207d8);},'OGqrz':_0x3397e3(0x1c1),'OJMGN':_0x3397e3(0x19f)},_0x3ad49c=await this.#getBinaryPath();return new Promise((_0x1413dd,_0x20a01e)=>{const _0x582fa3=_0x3397e3,_0x186ac2=_0x49fa09[_0x582fa3(0x192)](spawn,_0x3ad49c,[_0x49fa09[_0x582fa3(0x1ca)]]);_0x186ac2['on'](_0x49fa09[_0x582fa3(0x1c2)],_0x408a37=>{const _0x1e513b=_0x582fa3;this['isProcessRunning']=![],_0x49fa09[_0x1e513b(0x19a)](_0x1413dd,_0x408a37);});});}['isRunning'](){const _0x286a8e=a108_0x470443;return this[_0x286a8e(0x1c3)];}async[a108_0x470443(0x1b9)](){const _0x33a968=a108_0x470443,_0x34e348={};_0x34e348[_0x33a968(0x1c9)]='app',_0x34e348['pPLaa']=_0x33a968(0x1c0),_0x34e348['XqRqr']='GET',_0x34e348[_0x33a968(0x1aa)]='Percy\x20fetch\x20token\x20success';const _0x5c8ac5=_0x34e348,_0x4c9099=this.#config[_0x33a968(0x1ac)];try{const _0xedb63e=this.#isApp?_0x5c8ac5[_0x33a968(0x1c9)]:_0x5c8ac5[_0x33a968(0x1c4)],_0xe02dfb=await helper['nodeRequest'](_0x5c8ac5[_0x33a968(0x1a0)],'api/app_percy/get_project_token?name='+_0x4c9099+'&type='+_0xedb63e,{},this.#config),_0x5e0c4a=_0xe02dfb[_0x33a968(0x1be)];return logger[_0x33a968(0x19e)](_0x5c8ac5['KLaBY']),_0x5e0c4a['token'];}catch(_0x380ec5){return logger[_0x33a968(0x1c6)](_0x33a968(0x1a2)+_0x380ec5),null;}}async[a108_0x470443(0x180)](){const _0x9c1cfa=a108_0x470443,_0x23dfeb={'hCauT':function(_0x49acbb,_0x298b15){return _0x49acbb(_0x298b15);},'fDZws':function(_0xd18879,_0x5adfde){return _0xd18879+_0x5adfde;},'lUHDV':'Percy\x20config\x20created\x20at\x20','CwsSv':function(_0x371b93,_0x18ebf9){return _0x371b93(_0x18ebf9);},'ltkCQ':_0x9c1cfa(0x1b7)};if(!this.#config[_0x9c1cfa(0x199)])return null;const _0xb70db7=path[_0x9c1cfa(0x197)](os[_0x9c1cfa(0x1af)](),_0x23dfeb[_0x9c1cfa(0x1ad)]),_0x242576=this.#config[_0x9c1cfa(0x199)];return!_0x242576[_0x9c1cfa(0x1b1)]&&(_0x242576['version']='2'),new Promise((_0xd216ee,_0x5c5c84)=>{const _0x435e39=_0x9c1cfa,_0x681f35={'vWBhs':function(_0x5afda9,_0x40fcb5){const _0x4bf697=a108_0x904e;return _0x23dfeb[_0x4bf697(0x1b0)](_0x5afda9,_0x40fcb5);},'gtBMX':function(_0x453f19,_0x3adb00){const _0x57f60a=a108_0x904e;return _0x23dfeb[_0x57f60a(0x185)](_0x453f19,_0x3adb00);},'pakEa':_0x23dfeb[_0x435e39(0x1b5)],'zwyma':function(_0x486a62,_0x20dfae){const _0x21cffc=_0x435e39;return _0x23dfeb[_0x21cffc(0x1a3)](_0x486a62,_0x20dfae);}};fs[_0x435e39(0x1bc)](_0xb70db7,JSON['stringify'](_0x242576),_0x4240fa=>{const _0x3bf6fc=_0x435e39;_0x4240fa&&(logger[_0x3bf6fc(0x1c6)]('Error\x20creating\x20percy\x20config:\x20'+_0x4240fa),_0x681f35['vWBhs'](_0xd216ee,null)),logger[_0x3bf6fc(0x19e)](_0x681f35[_0x3bf6fc(0x1c5)](_0x681f35['pakEa'],_0xb70db7)),_0x681f35['zwyma'](_0xd216ee,_0xb70db7);});});}}module[a108_0x470443(0x18f)]=Percy;
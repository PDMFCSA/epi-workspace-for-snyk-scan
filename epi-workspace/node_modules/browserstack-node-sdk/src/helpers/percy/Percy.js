const a72_0x1dc1b5=a72_0x34be;(function(_0x150ec8,_0x28795d){const _0x5a3699=a72_0x34be,_0x5dfad3=_0x150ec8();while(!![]){try{const _0x4454fa=-parseInt(_0x5a3699(0x10f))/0x1+parseInt(_0x5a3699(0x11b))/0x2*(-parseInt(_0x5a3699(0x107))/0x3)+parseInt(_0x5a3699(0x12f))/0x4+-parseInt(_0x5a3699(0x121))/0x5+-parseInt(_0x5a3699(0x144))/0x6+parseInt(_0x5a3699(0x106))/0x7+parseInt(_0x5a3699(0x14c))/0x8;if(_0x4454fa===_0x28795d)break;else _0x5dfad3['push'](_0x5dfad3['shift']());}catch(_0x16ff28){_0x5dfad3['push'](_0x5dfad3['shift']());}}}(a72_0x244c,0x41581));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a72_0x1dc1b5(0x12b)),helper=require('../helper'),logger=require('../logger')[a72_0x1dc1b5(0x123)],{logDir}=require(a72_0x1dc1b5(0x12d)),testHubConstants=require(a72_0x1dc1b5(0x149)),PerformanceTester=require(a72_0x1dc1b5(0x10e)),{PERCY_EVENTS:PerformanceEvents}=require(a72_0x1dc1b5(0x10a)),PercyBinary=require(a72_0x1dc1b5(0x145));class Percy{#logfile=path[a72_0x1dc1b5(0x12c)](logDir,a72_0x1dc1b5(0x119));#address=process[a72_0x1dc1b5(0x131)][a72_0x1dc1b5(0x132)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a72_0x1dc1b5(0x12e)]=![];constructor(_0x25c6ef){const _0x2eb337=a72_0x1dc1b5;this.#config=_0x25c6ef,!!_0x25c6ef[_0x2eb337(0x11e)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x4e413c=a72_0x1dc1b5;if(!this.#binaryPath){const _0x50e470=new PercyBinary();PerformanceTester['start'](PerformanceEvents[_0x4e413c(0x135)]),this.#binaryPath=await _0x50e470[_0x4e413c(0x10d)](this.#config),PerformanceTester[_0x4e413c(0x13b)](PerformanceEvents[_0x4e413c(0x135)]);}return this.#binaryPath;}async #sleep(_0x66633c){return new Promise(_0x2fb5b5=>setTimeout(_0x2fb5b5,_0x66633c));}async['healthcheck'](){const _0x56036f=a72_0x1dc1b5,_0x9c1c5b={};_0x9c1c5b[_0x56036f(0x14b)]=_0x56036f(0x129),_0x9c1c5b[_0x56036f(0x100)]=_0x56036f(0x142);const _0x2a90b6=_0x9c1c5b;try{const _0x4f688d=await helper[_0x56036f(0x115)](_0x2a90b6['mocXx'],_0x2a90b6[_0x56036f(0x100)],null,null,this.#address);if(_0x4f688d)return!![];}catch(_0x5d91ed){return![];}}async[a72_0x1dc1b5(0x114)](){const _0x4e9811=a72_0x1dc1b5,_0x4be6e4={'Nyjug':_0x4e9811(0x104),'YxnHG':_0x4e9811(0x10b),'VyYLw':function(_0x18521f,_0x28ac5e,_0x397d25,_0x2546dc){return _0x18521f(_0x28ac5e,_0x397d25,_0x2546dc);},'GwLiF':_0x4e9811(0x13c),'gTKac':'Percy\x20healthcheck\x20successful'},_0x1c77c2=await this.#getBinaryPath(),_0x5e01d9={};_0x5e01d9['flags']='a';const _0x466580=fs[_0x4e9811(0x138)](this.#logfile,_0x5e01d9),_0x192842=await this[_0x4e9811(0x113)](),_0x30ca2b=await this['createPercyConfig']();if(!_0x192842)return![];const _0x1b62a3=[(this.#isApp?_0x4be6e4[_0x4e9811(0x105)]:_0x4be6e4[_0x4e9811(0x13f)])+_0x4e9811(0x109)];_0x30ca2b&&_0x1b62a3[_0x4e9811(0x117)]('-c',_0x30ca2b);this.#proc=_0x4be6e4['VyYLw'](spawn,_0x1c77c2,_0x1b62a3,{'env':Object[_0x4e9811(0xff)](process[_0x4e9811(0x131)],{'PERCY_TOKEN':_0x192842,'TH_BUILD_UUID':process[_0x4e9811(0x131)][testHubConstants[_0x4e9811(0xfd)][_0x4e9811(0x13d)]]})}),this.#proc[_0x4e9811(0x137)][_0x4e9811(0x13e)](_0x466580),this.#proc['stderr'][_0x4e9811(0x13e)](_0x466580),this[_0x4e9811(0x12e)]=!![];var _0x3dcfb5=this;this.#proc['on'](_0x4be6e4[_0x4e9811(0x11f)],function(_0xb60bb0){const _0x977368=_0x4e9811;_0x3dcfb5[_0x977368(0x12e)]=![];});do{const _0x3c5cb9=await this[_0x4e9811(0x127)]();if(_0x3c5cb9)return logger[_0x4e9811(0x11a)](_0x4be6e4[_0x4e9811(0x14a)]),!![];await this.#sleep(0x3e8);}while(this[_0x4e9811(0x12e)]);return![];}async[a72_0x1dc1b5(0x13a)](){const _0x472bc2=a72_0x1dc1b5,_0x54734c={'qcdTP':function(_0x347c01,_0x5c7761){return _0x347c01(_0x5c7761);},'NmomK':function(_0x14b332,_0x4e57a7,_0x3c8ab9){return _0x14b332(_0x4e57a7,_0x3c8ab9);},'aovrM':_0x472bc2(0x12a),'rYQfz':'close'},_0x3babc9=await this.#getBinaryPath();return new Promise((_0x47fca7,_0x40033f)=>{const _0x4eb86d=_0x472bc2,_0x1e1b9d={'THXPD':function(_0x159d7f,_0x240c21){const _0x46880b=a72_0x34be;return _0x54734c[_0x46880b(0x147)](_0x159d7f,_0x240c21);}},_0x249e50=_0x54734c[_0x4eb86d(0x124)](spawn,_0x3babc9,[_0x54734c['aovrM']]);_0x249e50['on'](_0x54734c[_0x4eb86d(0x111)],_0x6fd879=>{const _0x1048a6=_0x4eb86d;this['isProcessRunning']=![],_0x1e1b9d[_0x1048a6(0x136)](_0x47fca7,_0x6fd879);});});}[a72_0x1dc1b5(0x128)](){const _0x160091=a72_0x1dc1b5;return this[_0x160091(0x12e)];}async[a72_0x1dc1b5(0x113)](){const _0x59704b=a72_0x1dc1b5,_0x2d01f2={};_0x2d01f2[_0x59704b(0x143)]=_0x59704b(0x11e),_0x2d01f2['HHDJU']=_0x59704b(0x11c),_0x2d01f2[_0x59704b(0x103)]=_0x59704b(0x129),_0x2d01f2[_0x59704b(0x122)]=_0x59704b(0x134);const _0x3e1073=_0x2d01f2,_0x527c25=this.#config[_0x59704b(0x120)];try{const _0x4e0b76=this.#isApp?_0x3e1073[_0x59704b(0x143)]:_0x3e1073[_0x59704b(0x112)],_0x3143d9=await helper[_0x59704b(0x115)](_0x3e1073[_0x59704b(0x103)],'api/app_percy/get_project_token?name='+_0x527c25+_0x59704b(0x11d)+_0x4e0b76,{},this.#config),_0x34d200=_0x3143d9[_0x59704b(0x10c)];return logger[_0x59704b(0x11a)](_0x3e1073['gWbvf']),_0x34d200['token'];}catch(_0x519d95){return logger[_0x59704b(0x126)](_0x59704b(0xfe)+_0x519d95),null;}}async[a72_0x1dc1b5(0x141)](){const _0x40135c=a72_0x1dc1b5,_0xae4a50={'qtZvK':function(_0x2b2728,_0xb9a969){return _0x2b2728(_0xb9a969);},'iUqOI':function(_0xda759d,_0x4570e1){return _0xda759d+_0x4570e1;},'PEFXw':_0x40135c(0x140),'MjFkT':'percy.json'};if(!this.#config['percyOptions'])return null;const _0x549195=path['join'](os[_0x40135c(0x102)](),_0xae4a50[_0x40135c(0x118)]),_0x18833b=this.#config[_0x40135c(0x133)];return!_0x18833b['version']&&(_0x18833b[_0x40135c(0x14d)]='2'),new Promise((_0x2c64b9,_0x4fe795)=>{const _0x34b52d=_0x40135c,_0x6422e5={'IRrkz':function(_0x29908e,_0x3e7d14){const _0x2b3167=a72_0x34be;return _0xae4a50[_0x2b3167(0x116)](_0x29908e,_0x3e7d14);},'ecTgy':function(_0x591120,_0x4425a0){return _0xae4a50['iUqOI'](_0x591120,_0x4425a0);},'ZnlCY':_0xae4a50[_0x34b52d(0x125)],'nosQW':function(_0x34a406,_0x1fb76b){const _0x3d909a=_0x34b52d;return _0xae4a50[_0x3d909a(0x116)](_0x34a406,_0x1fb76b);}};fs['writeFile'](_0x549195,JSON[_0x34b52d(0x110)](_0x18833b),_0x1c5d12=>{const _0x4758a8=_0x34b52d;_0x1c5d12&&(logger[_0x4758a8(0x126)](_0x4758a8(0x130)+_0x1c5d12),_0x6422e5[_0x4758a8(0x139)](_0x2c64b9,null)),logger[_0x4758a8(0x11a)](_0x6422e5[_0x4758a8(0x101)](_0x6422e5[_0x4758a8(0x108)],_0x549195)),_0x6422e5[_0x4758a8(0x148)](_0x2c64b9,_0x549195);});});}}function a72_0x244c(){const _0x4b5121=['puJEY','2912238eLGXnC','./PercyBinary','exports','qcdTP','nosQW','../../helpers/testhub/constants','gTKac','mocXx','5302616pbjoeG','version','ENV_VAR','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','assign','WIjaQ','ecTgy','tmpdir','bpxqd','app:exec','Nyjug','1870540ZEqCxi','284736pgRPSN','ZnlCY',':start','../../helpers/performance/constants','exec','data','getBinaryPath','../../helpers/performance/performance-tester','237660XrQpNU','stringify','rYQfz','HHDJU','fetchPercyToken','start','nodeRequest','qtZvK','push','MjFkT','percy.log','debug','4uUuhBZ','automate','&type=','app','GwLiF','projectName','34650oBjtMV','gWbvf','winstonLogger','NmomK','PEFXw','error','healthcheck','isRunning','GET','exec:stop','child_process','join','../logger','isProcessRunning','1029556kmGYQe','Error\x20creating\x20percy\x20config:\x20','env','PERCY_SERVER_ADDRESS','percyOptions','Percy\x20fetch\x20token\x20success','DOWNLOAD','THXPD','stdout','createWriteStream','IRrkz','stop','end','close','BROWSERSTACK_TESTHUB_UUID','pipe','YxnHG','Percy\x20config\x20created\x20at\x20','createPercyConfig','percy/healthcheck'];a72_0x244c=function(){return _0x4b5121;};return a72_0x244c();}function a72_0x34be(_0x2e7a32,_0xd09a35){const _0x244c2f=a72_0x244c();return a72_0x34be=function(_0x34bea1,_0x1ac919){_0x34bea1=_0x34bea1-0xfd;let _0x4c51ae=_0x244c2f[_0x34bea1];return _0x4c51ae;},a72_0x34be(_0x2e7a32,_0xd09a35);}module[a72_0x1dc1b5(0x146)]=Percy;
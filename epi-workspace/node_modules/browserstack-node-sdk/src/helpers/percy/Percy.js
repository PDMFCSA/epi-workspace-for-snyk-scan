const a109_0x313a39=a109_0x3ff4;function a109_0x4951(){const _0x210178=['token','pipe','createPercyConfig','tmpdir','70ildqmV','19664VnCCDj','AwzzP','BROWSERSTACK_TESTHUB_UUID','close','env','BviIx','GET','JZaBd','automate','fetchPercyToken','HhDFg','projectName','exec','child_process','RZlRC','join','createWriteStream','start','app:exec','2WoRslb','DfjQt','&type=','stdout','12810270oAeDkM','../../helpers/performance/constants','ammtj','Percy\x20fetch\x20token\x20success','version','nodeRequest','exports','ZkOZN','data','error','winstonLogger','yPnYO','isRunning','path','MInmu','./PercyBinary','../logger','percyOptions','stringify','HTJAP','getBinaryPath','omUux','546353KUouFa','Error\x20creating\x20percy\x20config:\x20','2596020mtZfuZ','app','percy/healthcheck','api/app_percy/get_project_token?name=','5ZEujrr','llIzm','DOWNLOAD',':start','exec:stop','nDMGH','3944814SFVMoV','TZGZh','isProcessRunning','822816QqXNqz','stderr','debug','writeFile','push','healthcheck','141qmslok','percy.log','KRHbH','3919672AfmZov','PMVvc'];a109_0x4951=function(){return _0x210178;};return a109_0x4951();}(function(_0x461a76,_0x59a180){const _0x3924f9=a109_0x3ff4,_0x4d9c23=_0x461a76();while(!![]){try{const _0x2c40b7=-parseInt(_0x3924f9(0xc5))/0x1*(-parseInt(_0x3924f9(0xf7))/0x2)+-parseInt(_0x3924f9(0xda))/0x3*(parseInt(_0x3924f9(0xe4))/0x4)+-parseInt(_0x3924f9(0xcb))/0x5*(-parseInt(_0x3924f9(0xd1))/0x6)+parseInt(_0x3924f9(0xc7))/0x7+-parseInt(_0x3924f9(0xdd))/0x8+-parseInt(_0x3924f9(0xd4))/0x9*(-parseInt(_0x3924f9(0xe3))/0xa)+-parseInt(_0x3924f9(0xfb))/0xb;if(_0x2c40b7===_0x59a180)break;else _0x4d9c23['push'](_0x4d9c23['shift']());}catch(_0x59f8c5){_0x4d9c23['push'](_0x4d9c23['shift']());}}}(a109_0x4951,0x5056d));const fs=require('fs'),path=require(a109_0x313a39(0x108)),os=require('os'),{spawn}=require(a109_0x313a39(0xf1)),helper=require('../helper'),logger=require(a109_0x313a39(0x10b))[a109_0x313a39(0x105)],{getLogDir}=require(a109_0x313a39(0x10b)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a109_0x313a39(0xfc)),PercyBinary=require(a109_0x313a39(0x10a));class Percy{#logfile=path[a109_0x313a39(0xf3)](getLogDir(),a109_0x313a39(0xdb));#address=process['env']['PERCY_SERVER_ADDRESS']||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a109_0x313a39(0xd3)]=![];constructor(_0x44f234){const _0x5cd4bc=a109_0x313a39;this.#config=_0x44f234,!!_0x44f234[_0x5cd4bc(0xc8)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0xe1aab1=a109_0x313a39;if(!this.#binaryPath){const _0x52019c=new PercyBinary();PerformanceTester[_0xe1aab1(0xf5)](PerformanceEvents[_0xe1aab1(0xcd)]),this.#binaryPath=await _0x52019c[_0xe1aab1(0xc3)](this.#config),PerformanceTester['end'](PerformanceEvents[_0xe1aab1(0xcd)]);}return this.#binaryPath;}async #sleep(_0x5ed6ba){return new Promise(_0x55e744=>setTimeout(_0x55e744,_0x5ed6ba));}async[a109_0x313a39(0xd9)](){const _0x24f3dc=a109_0x313a39,_0x124d92={};_0x124d92[_0x24f3dc(0xc4)]='GET',_0x124d92[_0x24f3dc(0xee)]=_0x24f3dc(0xc9);const _0x3e366f=_0x124d92;try{const _0x1de2f8=await helper[_0x24f3dc(0x100)](_0x3e366f[_0x24f3dc(0xc4)],_0x3e366f[_0x24f3dc(0xee)],null,null,this.#address);if(_0x1de2f8)return!![];}catch(_0x2789c7){return![];}}async[a109_0x313a39(0xf5)](){const _0x2bc13b=a109_0x313a39,_0x52b4a0={'ZpgfD':_0x2bc13b(0xf6),'JZaBd':_0x2bc13b(0xf0),'MInmu':function(_0x164dac,_0x373e7e,_0x53a742,_0x314410){return _0x164dac(_0x373e7e,_0x53a742,_0x314410);},'ZkOZN':'close','KRHbH':'Percy\x20healthcheck\x20successful'},_0x33a489=await this.#getBinaryPath(),_0x45a9b9={};_0x45a9b9['flags']='a',this.#logStream=fs[_0x2bc13b(0xf4)](this.#logfile,_0x45a9b9);const _0x1c4860=await this[_0x2bc13b(0xed)](),_0x3ed3f5=await this['createPercyConfig']();if(!_0x1c4860)return![];const _0xc5bb04=[(this.#isApp?_0x52b4a0['ZpgfD']:_0x52b4a0[_0x2bc13b(0xeb)])+_0x2bc13b(0xce)];_0x3ed3f5&&_0xc5bb04[_0x2bc13b(0xd8)]('-c',_0x3ed3f5);this.#proc=_0x52b4a0[_0x2bc13b(0x109)](spawn,_0x33a489,_0xc5bb04,{'env':Object['assign'](process[_0x2bc13b(0xe8)],{'PERCY_TOKEN':_0x1c4860,'TH_BUILD_UUID':process[_0x2bc13b(0xe8)][testHubConstants['ENV_VAR'][_0x2bc13b(0xe6)]]})}),this.#proc[_0x2bc13b(0xfa)][_0x2bc13b(0xe0)](this.#logStream),this.#proc[_0x2bc13b(0xd5)][_0x2bc13b(0xe0)](this.#logStream),this[_0x2bc13b(0xd3)]=!![];var _0x1e4688=this;this.#proc['on'](_0x52b4a0[_0x2bc13b(0x102)],function(_0x4fdab4){const _0xa3cecd=_0x2bc13b;_0x1e4688[_0xa3cecd(0xd3)]=![];});do{const _0x12d546=await this[_0x2bc13b(0xd9)]();if(_0x12d546)return logger[_0x2bc13b(0xd6)](_0x52b4a0[_0x2bc13b(0xdc)]),!![];await this.#sleep(0x3e8);}while(this[_0x2bc13b(0xd3)]);return![];}async['stop'](){const _0x5b25c3=a109_0x313a39,_0x25bef5={'RZlRC':function(_0x3a9ed0,_0x447804){return _0x3a9ed0(_0x447804);},'rYNJk':function(_0x5bc728,_0x36dfbb,_0x2f240f){return _0x5bc728(_0x36dfbb,_0x2f240f);},'DfjQt':_0x5b25c3(0xcf),'HTJAP':_0x5b25c3(0xe7)},_0x298344=await this.#getBinaryPath();return new Promise((_0x3dfc31,_0x261fad)=>{const _0x181b5f=_0x5b25c3,_0x5704d8={'TZGZh':function(_0x381858,_0x132246){const _0x2cc419=a109_0x3ff4;return _0x25bef5[_0x2cc419(0xf2)](_0x381858,_0x132246);}},_0x41e8d3=_0x25bef5['rYNJk'](spawn,_0x298344,[_0x25bef5[_0x181b5f(0xf8)]]);_0x41e8d3['on'](_0x25bef5[_0x181b5f(0x10e)],_0x15913d=>{const _0x1c4440=_0x181b5f;this[_0x1c4440(0xd3)]=![],this.#logStream&&(this.#logStream['end'](),this.#logStream=null),_0x5704d8[_0x1c4440(0xd2)](_0x3dfc31,_0x15913d);});});}[a109_0x313a39(0x107)](){const _0x449a5a=a109_0x313a39;return this[_0x449a5a(0xd3)];}async['fetchPercyToken'](){const _0x2301b2=a109_0x313a39,_0x497565={};_0x497565[_0x2301b2(0xd0)]=_0x2301b2(0xc8),_0x497565['llIzm']=_0x2301b2(0xec),_0x497565[_0x2301b2(0xde)]=_0x2301b2(0xea),_0x497565[_0x2301b2(0xfd)]=_0x2301b2(0xfe);const _0x107afa=_0x497565,_0xc6bf96=this.#config[_0x2301b2(0xef)];try{const _0x2eed37=this.#isApp?_0x107afa[_0x2301b2(0xd0)]:_0x107afa[_0x2301b2(0xcc)],_0x19c850=await helper[_0x2301b2(0x100)](_0x107afa[_0x2301b2(0xde)],_0x2301b2(0xca)+_0xc6bf96+_0x2301b2(0xf9)+_0x2eed37,{},this.#config),_0x43d81d=_0x19c850[_0x2301b2(0x103)];return logger[_0x2301b2(0xd6)](_0x107afa[_0x2301b2(0xfd)]),_0x43d81d[_0x2301b2(0xdf)];}catch(_0x19a942){return logger[_0x2301b2(0x104)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x19a942),null;}}async[a109_0x313a39(0xe1)](){const _0x3e061b=a109_0x313a39,_0x2a0126={'AwzzP':function(_0x1e827b,_0x12f0b7){return _0x1e827b(_0x12f0b7);},'yPnYO':function(_0x23cd76,_0x198572){return _0x23cd76+_0x198572;},'wiyXK':'Percy\x20config\x20created\x20at\x20','BviIx':function(_0x975bd2,_0x43eb7a){return _0x975bd2(_0x43eb7a);},'zvbqq':'percy.json'};if(!this.#config[_0x3e061b(0x10c)])return null;const _0x27b508=path['join'](os[_0x3e061b(0xe2)](),_0x2a0126['zvbqq']),_0x458b62=this.#config[_0x3e061b(0x10c)];return!_0x458b62['version']&&(_0x458b62[_0x3e061b(0xff)]='2'),new Promise((_0xe1241d,_0x46ef34)=>{const _0x459945=_0x3e061b;fs[_0x459945(0xd7)](_0x27b508,JSON[_0x459945(0x10d)](_0x458b62),_0x12524c=>{const _0x4af175=_0x459945;_0x12524c&&(logger['error'](_0x4af175(0xc6)+_0x12524c),_0x2a0126[_0x4af175(0xe5)](_0xe1241d,null)),logger[_0x4af175(0xd6)](_0x2a0126[_0x4af175(0x106)](_0x2a0126['wiyXK'],_0x27b508)),_0x2a0126[_0x4af175(0xe9)](_0xe1241d,_0x27b508);});});}}function a109_0x3ff4(_0x39df4b,_0x53cc23){const _0x495192=a109_0x4951();return a109_0x3ff4=function(_0x3ff4d8,_0x81320a){_0x3ff4d8=_0x3ff4d8-0xc3;let _0x524839=_0x495192[_0x3ff4d8];return _0x524839;},a109_0x3ff4(_0x39df4b,_0x53cc23);}module[a109_0x313a39(0x101)]=Percy;
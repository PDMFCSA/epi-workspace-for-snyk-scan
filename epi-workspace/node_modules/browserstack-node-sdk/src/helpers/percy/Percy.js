const a113_0x5c55c2=a113_0x3a5a;(function(_0x2eae2f,_0x268b33){const _0xd43f03=a113_0x3a5a,_0xa4ae9f=_0x2eae2f();while(!![]){try{const _0x29d384=-parseInt(_0xd43f03(0x217))/0x1*(-parseInt(_0xd43f03(0x223))/0x2)+parseInt(_0xd43f03(0x1e0))/0x3*(parseInt(_0xd43f03(0x21b))/0x4)+-parseInt(_0xd43f03(0x21a))/0x5+parseInt(_0xd43f03(0x220))/0x6*(-parseInt(_0xd43f03(0x1f2))/0x7)+parseInt(_0xd43f03(0x1e7))/0x8*(parseInt(_0xd43f03(0x1e9))/0x9)+-parseInt(_0xd43f03(0x200))/0xa+-parseInt(_0xd43f03(0x1fa))/0xb;if(_0x29d384===_0x268b33)break;else _0xa4ae9f['push'](_0xa4ae9f['shift']());}catch(_0xd3f240){_0xa4ae9f['push'](_0xa4ae9f['shift']());}}}(a113_0x554b,0x3047e));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a113_0x5c55c2(0x21c)),helper=require(a113_0x5c55c2(0x1fe)),logger=require(a113_0x5c55c2(0x1e6))[a113_0x5c55c2(0x1f9)],{getLogDir}=require('../logger'),testHubConstants=require(a113_0x5c55c2(0x204)),PerformanceTester=require(a113_0x5c55c2(0x1f1)),{PERCY_EVENTS:PerformanceEvents}=require(a113_0x5c55c2(0x221)),PercyBinary=require('./PercyBinary');class Percy{#logfile=path[a113_0x5c55c2(0x212)](getLogDir(),a113_0x5c55c2(0x1fb));#address=process[a113_0x5c55c2(0x205)][a113_0x5c55c2(0x20f)]||a113_0x5c55c2(0x224);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];['isProcessRunning']=![];constructor(_0x523b89){this.#config=_0x523b89,!!_0x523b89['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x1e0d71=a113_0x5c55c2;if(!this.#binaryPath){const _0x1408e5=new PercyBinary();PerformanceTester[_0x1e0d71(0x211)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x1408e5[_0x1e0d71(0x213)](this.#config),PerformanceTester[_0x1e0d71(0x1f5)](PerformanceEvents[_0x1e0d71(0x222)]);}return this.#binaryPath;}async #sleep(_0x30bb11){return new Promise(_0x27305e=>setTimeout(_0x27305e,_0x30bb11));}async['healthcheck'](){const _0xf42193=a113_0x5c55c2,_0x54954e={};_0x54954e[_0xf42193(0x21f)]=_0xf42193(0x1f0),_0x54954e['dhNtN']='percy/healthcheck';const _0x1af49b=_0x54954e;try{const _0x426a82=await helper['nodeRequest'](_0x1af49b[_0xf42193(0x21f)],_0x1af49b['dhNtN'],null,null,this.#address);if(_0x426a82)return!![];}catch(_0x854fbf){return![];}}async[a113_0x5c55c2(0x211)](){const _0x3aea56=a113_0x5c55c2,_0x176312={'ufzzV':_0x3aea56(0x209),'DmfCa':_0x3aea56(0x201),'KlSOt':function(_0x31238f,_0x2bd55b,_0x3501a7,_0x3a63a7){return _0x31238f(_0x2bd55b,_0x3501a7,_0x3a63a7);},'bivhW':_0x3aea56(0x210),'TwzpZ':_0x3aea56(0x206)},_0x35121a=await this.#getBinaryPath(),_0x1fc9b6={};_0x1fc9b6[_0x3aea56(0x1f6)]='a',this.#logStream=fs[_0x3aea56(0x202)](this.#logfile,_0x1fc9b6);const _0x4db253=await this[_0x3aea56(0x1e5)](),_0xb1bd4f=await this[_0x3aea56(0x1dc)]();if(!_0x4db253)return![];const _0x55cc48=[(this.#isApp?_0x176312[_0x3aea56(0x214)]:_0x176312[_0x3aea56(0x1de)])+':start'];_0xb1bd4f&&_0x55cc48[_0x3aea56(0x219)]('-c',_0xb1bd4f);this.#proc=_0x176312['KlSOt'](spawn,_0x35121a,_0x55cc48,{'env':Object[_0x3aea56(0x203)](process['env'],{'PERCY_TOKEN':_0x4db253,'TH_BUILD_UUID':process[_0x3aea56(0x205)][testHubConstants[_0x3aea56(0x1e1)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x3aea56(0x1e4)][_0x3aea56(0x1dd)](this.#logStream),this.#proc[_0x3aea56(0x1df)][_0x3aea56(0x1dd)](this.#logStream),this[_0x3aea56(0x1e8)]=!![];var _0x39b26e=this;this.#proc['on'](_0x176312[_0x3aea56(0x1e3)],function(_0x4655d1){const _0x35ffa0=_0x3aea56;_0x39b26e[_0x35ffa0(0x1e8)]=![];});do{const _0x2df4c0=await this[_0x3aea56(0x21e)]();if(_0x2df4c0)return logger[_0x3aea56(0x1f8)](_0x176312[_0x3aea56(0x208)]),!![];await this.#sleep(0x3e8);}while(this[_0x3aea56(0x1e8)]);return![];}async[a113_0x5c55c2(0x21d)](){const _0x4d0a62=a113_0x5c55c2,_0x45a292={'tneJl':function(_0x50a0ea,_0x2411b6){return _0x50a0ea(_0x2411b6);},'rElIr':function(_0x3f2090,_0x267080,_0x1883f7){return _0x3f2090(_0x267080,_0x1883f7);},'vjLeQ':_0x4d0a62(0x1eb),'vXOAp':'close'},_0x1eb415=await this.#getBinaryPath();return new Promise((_0xe7ee74,_0x4c81f8)=>{const _0x403282=_0x4d0a62,_0x26794e=_0x45a292[_0x403282(0x1da)](spawn,_0x1eb415,[_0x45a292[_0x403282(0x1ed)]]);_0x26794e['on'](_0x45a292['vXOAp'],_0x547fee=>{const _0x18e12d=_0x403282;this[_0x18e12d(0x1e8)]=![],this.#logStream&&(this.#logStream[_0x18e12d(0x1f5)](),this.#logStream=null),_0x45a292[_0x18e12d(0x1ff)](_0xe7ee74,_0x547fee);});});}[a113_0x5c55c2(0x1fd)](){return this['isProcessRunning'];}async[a113_0x5c55c2(0x1e5)](){const _0x2e3491=a113_0x5c55c2,_0x2c75e1={};_0x2c75e1[_0x2e3491(0x1ea)]=_0x2e3491(0x1f4),_0x2c75e1[_0x2e3491(0x216)]='automate',_0x2c75e1[_0x2e3491(0x1d9)]=_0x2e3491(0x1f0),_0x2c75e1[_0x2e3491(0x215)]=_0x2e3491(0x207);const _0xaf2803=_0x2c75e1,_0x1dca46=this.#config[_0x2e3491(0x20b)];try{const _0x3dd51a=this.#isApp?_0xaf2803[_0x2e3491(0x1ea)]:_0xaf2803[_0x2e3491(0x216)],_0x26f009=await helper[_0x2e3491(0x225)](_0xaf2803[_0x2e3491(0x1d9)],_0x2e3491(0x20e)+_0x1dca46+'&type='+_0x3dd51a,{},this.#config),_0x27dbc7=_0x26f009[_0x2e3491(0x1f3)];return logger['debug'](_0xaf2803['aFcuv']),_0x27dbc7[_0x2e3491(0x1ef)];}catch(_0x2f996c){return logger['error'](_0x2e3491(0x20d)+_0x2f996c),null;}}async[a113_0x5c55c2(0x1dc)](){const _0x285fa5=a113_0x5c55c2,_0x131d70={'rALFM':function(_0x1c8ae6,_0x56262f){return _0x1c8ae6(_0x56262f);},'cRefj':function(_0x2506fa,_0x4972dc){return _0x2506fa+_0x4972dc;},'VaeDt':'Percy\x20config\x20created\x20at\x20','CmYhK':'percy.json'};if(!this.#config[_0x285fa5(0x1db)])return null;const _0x1c272f=path[_0x285fa5(0x212)](os[_0x285fa5(0x1ee)](),_0x131d70['CmYhK']),_0x566300=this.#config[_0x285fa5(0x1db)];return!_0x566300[_0x285fa5(0x20a)]&&(_0x566300[_0x285fa5(0x20a)]='2'),new Promise((_0x3c7fe0,_0x473036)=>{const _0x57b17c=_0x285fa5;fs[_0x57b17c(0x20c)](_0x1c272f,JSON['stringify'](_0x566300),_0x50b7b0=>{const _0x5857a2=_0x57b17c;_0x50b7b0&&(logger['error'](_0x5857a2(0x1f7)+_0x50b7b0),_0x131d70['rALFM'](_0x3c7fe0,null)),logger['debug'](_0x131d70[_0x5857a2(0x218)](_0x131d70[_0x5857a2(0x1fc)],_0x1c272f)),_0x131d70[_0x5857a2(0x1ec)](_0x3c7fe0,_0x1c272f);});});}}function a113_0x554b(){const _0x3b6faa=['DmfCa','stderr','51303SSybhT','ENV_VAR','exports','bivhW','stdout','fetchPercyToken','../logger','1429616ByEXZz','isProcessRunning','18PivEYx','RpeBK','exec:stop','rALFM','vjLeQ','tmpdir','token','GET','../../helpers/performance/performance-tester','357hhosuc','data','app','end','flags','Error\x20creating\x20percy\x20config:\x20','debug','winstonLogger','530739ONhxPz','percy.log','VaeDt','isRunning','../helper','tneJl','2240620DKlzUD','exec','createWriteStream','assign','../../helpers/testhub/constants','env','Percy\x20healthcheck\x20successful','Percy\x20fetch\x20token\x20success','TwzpZ','app:exec','version','projectName','writeFile','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','api/app_percy/get_project_token?name=','PERCY_SERVER_ADDRESS','close','start','join','getBinaryPath','ufzzV','aFcuv','bzroU','337967xBbMSf','cRefj','push','1627205EZTmVn','32WPAJSo','child_process','stop','healthcheck','DArjp','4314xxfWmY','../../helpers/performance/constants','DOWNLOAD','2PvsXuH','http://localhost:5338','nodeRequest','XKYuG','rElIr','percyOptions','createPercyConfig','pipe'];a113_0x554b=function(){return _0x3b6faa;};return a113_0x554b();}function a113_0x3a5a(_0x3e82f2,_0x37ebd5){const _0x554b40=a113_0x554b();return a113_0x3a5a=function(_0x3a5a17,_0x456658){_0x3a5a17=_0x3a5a17-0x1d9;let _0x540cac=_0x554b40[_0x3a5a17];return _0x540cac;},a113_0x3a5a(_0x3e82f2,_0x37ebd5);}module[a113_0x5c55c2(0x1e2)]=Percy;
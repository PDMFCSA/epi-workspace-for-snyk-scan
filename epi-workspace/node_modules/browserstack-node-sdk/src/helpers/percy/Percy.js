const a103_0x5be953=a103_0x1466;(function(_0x38a38d,_0x529f32){const _0x45426f=a103_0x1466,_0x3c9373=_0x38a38d();while(!![]){try{const _0x415303=-parseInt(_0x45426f(0x118))/0x1+-parseInt(_0x45426f(0xe7))/0x2+parseInt(_0x45426f(0xf3))/0x3*(parseInt(_0x45426f(0x119))/0x4)+-parseInt(_0x45426f(0xe2))/0x5+-parseInt(_0x45426f(0x10a))/0x6+-parseInt(_0x45426f(0x11e))/0x7*(-parseInt(_0x45426f(0xed))/0x8)+parseInt(_0x45426f(0xe1))/0x9*(parseInt(_0x45426f(0xea))/0xa);if(_0x415303===_0x529f32)break;else _0x3c9373['push'](_0x3c9373['shift']());}catch(_0x1b56f2){_0x3c9373['push'](_0x3c9373['shift']());}}}(a103_0x4159,0xe1caa));const fs=require('fs'),path=require(a103_0x5be953(0xdc)),os=require('os'),{spawn}=require(a103_0x5be953(0xd8)),helper=require(a103_0x5be953(0x125)),logger=require(a103_0x5be953(0x115))[a103_0x5be953(0x120)],{getLogDir}=require(a103_0x5be953(0x115)),testHubConstants=require(a103_0x5be953(0xf5)),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require('../../helpers/performance/constants'),PercyBinary=require('./PercyBinary');function a103_0x4159(){const _0x21f6d7=['pipe','data','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','percy.log','3095112GVzbxJ','nodeRequest','../../helpers/testhub/constants','bvJAk','projectName','debug','fYcYv','token','rLTis','UpOmC','env','GET','percy.json','push','Error\x20creating\x20percy\x20config:\x20','stop','percyOptions','VjqIE','exports','assign','cNJDZ','PyIHE','version','3577866MwCfOn','start','fvdxl','BROWSERSTACK_TESTHUB_UUID','ENV_VAR','automate','exec','stringify','healthcheck','http://localhost:5338','join','../logger','Percy\x20config\x20created\x20at\x20','oSoyF','1420808dGMbtD','4Bfvqox','fIvHw','tmpdir','getBinaryPath','PERCY_SERVER_ADDRESS','14fEZvvd','sJrmr','winstonLogger','createPercyConfig','Percy\x20healthcheck\x20successful','BEJVZ','aohfR','../helper','stderr','app','child_process','QWCmY','fetchPercyToken','DOWNLOAD','path','writeFile','createWriteStream','wFxPw','error','84573aMJWpU','4629210ZOABez','SteZr','api/app_percy/get_project_token?name=','&type=','end','1080012iMcdUw','ROBwN','close','3530hJYroa','ebWmE','isProcessRunning','235856sgFshm','isRunning'];a103_0x4159=function(){return _0x21f6d7;};return a103_0x4159();}function a103_0x1466(_0x3c37c6,_0x4bd0dc){const _0x415926=a103_0x4159();return a103_0x1466=function(_0x1466dd,_0xfc63ee){_0x1466dd=_0x1466dd-0xd7;let _0x5caf80=_0x415926[_0x1466dd];return _0x5caf80;},a103_0x1466(_0x3c37c6,_0x4bd0dc);}class Percy{#logfile=path['join'](getLogDir(),a103_0x5be953(0xf2));#address=process[a103_0x5be953(0xfd)][a103_0x5be953(0x11d)]||a103_0x5be953(0x113);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a103_0x5be953(0xec)]=![];constructor(_0x573981){const _0x4c503e=a103_0x5be953;this.#config=_0x573981,!!_0x573981[_0x4c503e(0xd7)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x3b3aa6=a103_0x5be953;if(!this.#binaryPath){const _0x2b99e8=new PercyBinary();PerformanceTester[_0x3b3aa6(0x10b)](PerformanceEvents[_0x3b3aa6(0xdb)]),this.#binaryPath=await _0x2b99e8[_0x3b3aa6(0x11c)](this.#config),PerformanceTester[_0x3b3aa6(0xe6)](PerformanceEvents[_0x3b3aa6(0xdb)]);}return this.#binaryPath;}async #sleep(_0x13c6e3){return new Promise(_0x576c73=>setTimeout(_0x576c73,_0x13c6e3));}async[a103_0x5be953(0x112)](){const _0xd38d25=a103_0x5be953,_0x4a1df1={};_0x4a1df1[_0xd38d25(0x11a)]=_0xd38d25(0xfe),_0x4a1df1[_0xd38d25(0xe3)]='percy/healthcheck';const _0x34da83=_0x4a1df1;try{const _0x583859=await helper[_0xd38d25(0xf4)](_0x34da83[_0xd38d25(0x11a)],_0x34da83[_0xd38d25(0xe3)],null,null,this.#address);if(_0x583859)return!![];}catch(_0xfbfacc){return![];}}async['start'](){const _0x1c8f34=a103_0x5be953,_0x29b0e0={'OuYom':'app:exec','zSbug':_0x1c8f34(0x110),'fvdxl':function(_0x13af42,_0x7464db,_0x1be46d,_0x5c604e){return _0x13af42(_0x7464db,_0x1be46d,_0x5c604e);},'bvJAk':_0x1c8f34(0xe9),'aohfR':_0x1c8f34(0x122)},_0x5d42e1=await this.#getBinaryPath(),_0x3b0d71={};_0x3b0d71['flags']='a';const _0x134681=fs[_0x1c8f34(0xde)](this.#logfile,_0x3b0d71),_0xee968e=await this['fetchPercyToken'](),_0xa1e82=await this[_0x1c8f34(0x121)]();if(!_0xee968e)return![];const _0x40fe9e=[(this.#isApp?_0x29b0e0['OuYom']:_0x29b0e0['zSbug'])+':start'];_0xa1e82&&_0x40fe9e[_0x1c8f34(0x100)]('-c',_0xa1e82);this.#proc=_0x29b0e0[_0x1c8f34(0x10c)](spawn,_0x5d42e1,_0x40fe9e,{'env':Object[_0x1c8f34(0x106)](process[_0x1c8f34(0xfd)],{'PERCY_TOKEN':_0xee968e,'TH_BUILD_UUID':process['env'][testHubConstants[_0x1c8f34(0x10e)][_0x1c8f34(0x10d)]]})}),this.#proc['stdout'][_0x1c8f34(0xef)](_0x134681),this.#proc[_0x1c8f34(0x126)]['pipe'](_0x134681),this[_0x1c8f34(0xec)]=!![];var _0x49d2b2=this;this.#proc['on'](_0x29b0e0[_0x1c8f34(0xf6)],function(_0x560509){const _0x3d9907=_0x1c8f34;_0x49d2b2[_0x3d9907(0xec)]=![];});do{const _0x4b8835=await this[_0x1c8f34(0x112)]();if(_0x4b8835)return logger[_0x1c8f34(0xf8)](_0x29b0e0[_0x1c8f34(0x124)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a103_0x5be953(0x102)](){const _0xb33a4b={'PyIHE':function(_0x5202ae,_0x1c1a70){return _0x5202ae(_0x1c1a70);},'fYcYv':function(_0x9c768a,_0x16f8ec,_0x551e64){return _0x9c768a(_0x16f8ec,_0x551e64);},'cNJDZ':'exec:stop','rLTis':'close'},_0x261583=await this.#getBinaryPath();return new Promise((_0x183bd7,_0x493582)=>{const _0x4ef4b2=a103_0x1466,_0x2088d9=_0xb33a4b[_0x4ef4b2(0xf9)](spawn,_0x261583,[_0xb33a4b[_0x4ef4b2(0x107)]]);_0x2088d9['on'](_0xb33a4b[_0x4ef4b2(0xfb)],_0x38ca16=>{const _0x4d2a9a=_0x4ef4b2;this[_0x4d2a9a(0xec)]=![],_0xb33a4b[_0x4d2a9a(0x108)](_0x183bd7,_0x38ca16);});});}[a103_0x5be953(0xee)](){const _0x2918de=a103_0x5be953;return this[_0x2918de(0xec)];}async[a103_0x5be953(0xda)](){const _0x3595cc=a103_0x5be953,_0x11ed66={};_0x11ed66[_0x3595cc(0xd9)]=_0x3595cc(0xd7),_0x11ed66[_0x3595cc(0xe8)]=_0x3595cc(0x10f),_0x11ed66['ebWmE']=_0x3595cc(0xfe),_0x11ed66[_0x3595cc(0x104)]='Percy\x20fetch\x20token\x20success';const _0x334c45=_0x11ed66,_0x71b9e7=this.#config[_0x3595cc(0xf7)];try{const _0x1b359b=this.#isApp?_0x334c45['QWCmY']:_0x334c45[_0x3595cc(0xe8)],_0x1cfe12=await helper['nodeRequest'](_0x334c45[_0x3595cc(0xeb)],_0x3595cc(0xe4)+_0x71b9e7+_0x3595cc(0xe5)+_0x1b359b,{},this.#config),_0xd56bd6=_0x1cfe12[_0x3595cc(0xf0)];return logger['debug'](_0x334c45['VjqIE']),_0xd56bd6[_0x3595cc(0xfa)];}catch(_0xac422b){return logger['error'](_0x3595cc(0xf1)+_0xac422b),null;}}async['createPercyConfig'](){const _0x57a163=a103_0x5be953,_0x19065f={'wFxPw':function(_0x48afb8,_0x5e6e9a){return _0x48afb8(_0x5e6e9a);},'bMbtI':function(_0x11d755,_0x2a1650){return _0x11d755+_0x2a1650;},'mEpuF':_0x57a163(0x116),'UpOmC':_0x57a163(0xff)};if(!this.#config[_0x57a163(0x103)])return null;const _0x29dd4a=path[_0x57a163(0x114)](os[_0x57a163(0x11b)](),_0x19065f[_0x57a163(0xfc)]),_0x3a1281=this.#config[_0x57a163(0x103)];return!_0x3a1281[_0x57a163(0x109)]&&(_0x3a1281[_0x57a163(0x109)]='2'),new Promise((_0x2133be,_0x5bf7d7)=>{const _0x13f7ad=_0x57a163,_0x273c79={'sJrmr':function(_0x30a7ab,_0x57123e){const _0x10169d=a103_0x1466;return _0x19065f[_0x10169d(0xdf)](_0x30a7ab,_0x57123e);},'oSoyF':function(_0x1e6105,_0x806747){return _0x19065f['bMbtI'](_0x1e6105,_0x806747);},'BEJVZ':_0x19065f['mEpuF']};fs[_0x13f7ad(0xdd)](_0x29dd4a,JSON[_0x13f7ad(0x111)](_0x3a1281),_0x50f1ff=>{const _0x45a133=_0x13f7ad;_0x50f1ff&&(logger[_0x45a133(0xe0)](_0x45a133(0x101)+_0x50f1ff),_0x273c79[_0x45a133(0x11f)](_0x2133be,null)),logger['debug'](_0x273c79[_0x45a133(0x117)](_0x273c79[_0x45a133(0x123)],_0x29dd4a)),_0x273c79[_0x45a133(0x11f)](_0x2133be,_0x29dd4a);});});}}module[a103_0x5be953(0x105)]=Percy;
const a112_0x491ec2=a112_0x3bbf;function a112_0x5eae(){const _0x4901dd=['10gXKHPq','../logger','joMyl','520651buZmQX','wObqK','bxoeu','getBinaryPath','app','error','start','9656vqMiSt','http://localhost:5338','../../helpers/performance/constants','stderr','stdout','isRunning','stop','OujIH','7788087MhrWKK','6393BvEkUL','nodeRequest','app:exec','TMseF','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','Percy\x20healthcheck\x20successful','Error\x20creating\x20percy\x20config:\x20','percyOptions','CbUbk','child_process','2502120EMrRzb','BiyLU','Percy\x20config\x20created\x20at\x20','join','end',':start','../helper','env','./PercyBinary','fetchPercyToken','LUFvl','version','data','../../helpers/testhub/constants','percy.log','isProcessRunning','MiDZp','GET','1582ZHECVC','402UBKjrH','NPPKT','../../helpers/performance/performance-tester','debug','path','exports','oFwKz','ltaVr','2342604eadYZu','nisAz','lejTY','stringify','winstonLogger','TsFcX','DpvVF','Percy\x20fetch\x20token\x20success','yyKWY','DOWNLOAD','tmpdir','NcsOV','PERCY_SERVER_ADDRESS','close','jZvbX','healthcheck','assign','2778875JlPmdJ','flags'];a112_0x5eae=function(){return _0x4901dd;};return a112_0x5eae();}(function(_0x20b2ef,_0x394189){const _0x11b53a=a112_0x3bbf,_0x2ecfab=_0x20b2ef();while(!![]){try{const _0x4f5a5d=parseInt(_0x11b53a(0xb5))/0x1+parseInt(_0x11b53a(0xe2))/0x2*(-parseInt(_0x11b53a(0xc5))/0x3)+parseInt(_0x11b53a(0x9f))/0x4+-parseInt(_0x11b53a(0xb0))/0x5+-parseInt(_0x11b53a(0xcf))/0x6+-parseInt(_0x11b53a(0xe1))/0x7*(parseInt(_0x11b53a(0xbc))/0x8)+-parseInt(_0x11b53a(0xc4))/0x9*(-parseInt(_0x11b53a(0xb2))/0xa);if(_0x4f5a5d===_0x394189)break;else _0x2ecfab['push'](_0x2ecfab['shift']());}catch(_0x228d9d){_0x2ecfab['push'](_0x2ecfab['shift']());}}}(a112_0x5eae,0x48b09));const fs=require('fs'),path=require(a112_0x491ec2(0xe6)),os=require('os'),{spawn}=require(a112_0x491ec2(0xce)),helper=require(a112_0x491ec2(0xd5)),logger=require('../logger')[a112_0x491ec2(0xa3)],{getLogDir}=require(a112_0x491ec2(0xb3)),testHubConstants=require(a112_0x491ec2(0xdc)),PerformanceTester=require(a112_0x491ec2(0xe4)),{PERCY_EVENTS:PerformanceEvents}=require(a112_0x491ec2(0xbe)),PercyBinary=require(a112_0x491ec2(0xd7));function a112_0x3bbf(_0x1a9136,_0x1a91f1){const _0x5eaefe=a112_0x5eae();return a112_0x3bbf=function(_0x3bbfc7,_0x573346){_0x3bbfc7=_0x3bbfc7-0x9f;let _0x51255d=_0x5eaefe[_0x3bbfc7];return _0x51255d;},a112_0x3bbf(_0x1a9136,_0x1a91f1);}class Percy{#logfile=path[a112_0x491ec2(0xd2)](getLogDir(),a112_0x491ec2(0xdd));#address=process[a112_0x491ec2(0xd6)][a112_0x491ec2(0xab)]||a112_0x491ec2(0xbd);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a112_0x491ec2(0xde)]=![];constructor(_0x4177d3){const _0x1cc70c=a112_0x491ec2;this.#config=_0x4177d3,!!_0x4177d3[_0x1cc70c(0xb9)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x3f06eb=a112_0x491ec2;if(!this.#binaryPath){const _0x50246a=new PercyBinary();PerformanceTester[_0x3f06eb(0xbb)](PerformanceEvents[_0x3f06eb(0xa8)]),this.#binaryPath=await _0x50246a[_0x3f06eb(0xb8)](this.#config),PerformanceTester[_0x3f06eb(0xd3)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x118492){return new Promise(_0x1ed5f8=>setTimeout(_0x1ed5f8,_0x118492));}async['healthcheck'](){const _0x297ba9=a112_0x491ec2,_0x499ecb={};_0x499ecb[_0x297ba9(0xad)]=_0x297ba9(0xe0),_0x499ecb[_0x297ba9(0xd9)]='percy/healthcheck';const _0x318921=_0x499ecb;try{const _0x489185=await helper['nodeRequest'](_0x318921['jZvbX'],_0x318921[_0x297ba9(0xd9)],null,null,this.#address);if(_0x489185)return!![];}catch(_0x2f34bc){return![];}}async[a112_0x491ec2(0xbb)](){const _0x27b90a=a112_0x491ec2,_0x72d2b0={'TMseF':_0x27b90a(0xc7),'NcsOV':'exec','NPPKT':function(_0x223a5d,_0x2bf977,_0x1c4f20,_0x5910b8){return _0x223a5d(_0x2bf977,_0x1c4f20,_0x5910b8);},'wObqK':_0x27b90a(0xac),'ibsmh':_0x27b90a(0xca)},_0x3da342=await this.#getBinaryPath(),_0x26f120={};_0x26f120[_0x27b90a(0xb1)]='a',this.#logStream=fs['createWriteStream'](this.#logfile,_0x26f120);const _0x26bfe4=await this[_0x27b90a(0xd8)](),_0x10c6e1=await this['createPercyConfig']();if(!_0x26bfe4)return![];const _0x26efb9=[(this.#isApp?_0x72d2b0[_0x27b90a(0xc8)]:_0x72d2b0[_0x27b90a(0xaa)])+_0x27b90a(0xd4)];_0x10c6e1&&_0x26efb9['push']('-c',_0x10c6e1);this.#proc=_0x72d2b0[_0x27b90a(0xe3)](spawn,_0x3da342,_0x26efb9,{'env':Object[_0x27b90a(0xaf)](process[_0x27b90a(0xd6)],{'PERCY_TOKEN':_0x26bfe4,'TH_BUILD_UUID':process[_0x27b90a(0xd6)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x27b90a(0xc0)]['pipe'](this.#logStream),this.#proc[_0x27b90a(0xbf)]['pipe'](this.#logStream),this[_0x27b90a(0xde)]=!![];var _0x189109=this;this.#proc['on'](_0x72d2b0[_0x27b90a(0xb6)],function(_0x1c48ff){const _0x254444=_0x27b90a;_0x189109[_0x254444(0xde)]=![];});do{const _0x5589c2=await this[_0x27b90a(0xae)]();if(_0x5589c2)return logger[_0x27b90a(0xe5)](_0x72d2b0['ibsmh']),!![];await this.#sleep(0x3e8);}while(this[_0x27b90a(0xde)]);return![];}async[a112_0x491ec2(0xc2)](){const _0x54d2c4=a112_0x491ec2,_0x5aa829={'CbUbk':function(_0x3c6277,_0x10a644){return _0x3c6277(_0x10a644);},'BiyLU':function(_0x2543d2,_0x4a44ff,_0x4a27d6){return _0x2543d2(_0x4a44ff,_0x4a27d6);},'lejTY':'exec:stop','ltaVr':_0x54d2c4(0xac)},_0x4db1fc=await this.#getBinaryPath();return new Promise((_0x1a39cd,_0xbd1f44)=>{const _0x480a18=_0x54d2c4,_0x50532e=_0x5aa829[_0x480a18(0xd0)](spawn,_0x4db1fc,[_0x5aa829[_0x480a18(0xa1)]]);_0x50532e['on'](_0x5aa829[_0x480a18(0xe9)],_0x11ad96=>{const _0x27cefc=_0x480a18;this[_0x27cefc(0xde)]=![],this.#logStream&&(this.#logStream[_0x27cefc(0xd3)](),this.#logStream=null),_0x5aa829[_0x27cefc(0xcd)](_0x1a39cd,_0x11ad96);});});}[a112_0x491ec2(0xc1)](){return this['isProcessRunning'];}async[a112_0x491ec2(0xd8)](){const _0x4c91c8=a112_0x491ec2,_0x23c05f={};_0x23c05f['OujIH']=_0x4c91c8(0xb9),_0x23c05f['yyKWY']='automate',_0x23c05f['oFwKz']=_0x4c91c8(0xe0),_0x23c05f[_0x4c91c8(0xa5)]=_0x4c91c8(0xa6);const _0x52c9ec=_0x23c05f,_0x5cf875=this.#config['projectName'];try{const _0x2e1450=this.#isApp?_0x52c9ec[_0x4c91c8(0xc3)]:_0x52c9ec[_0x4c91c8(0xa7)],_0x25bd1b=await helper[_0x4c91c8(0xc6)](_0x52c9ec[_0x4c91c8(0xe8)],'api/app_percy/get_project_token?name='+_0x5cf875+'&type='+_0x2e1450,{},this.#config),_0x4a497d=_0x25bd1b[_0x4c91c8(0xdb)];return logger[_0x4c91c8(0xe5)](_0x52c9ec[_0x4c91c8(0xa5)]),_0x4a497d['token'];}catch(_0x343342){return logger[_0x4c91c8(0xba)](_0x4c91c8(0xc9)+_0x343342),null;}}async['createPercyConfig'](){const _0x855ec8=a112_0x491ec2,_0x228f74={'joMyl':function(_0x419227,_0x2c26b5){return _0x419227(_0x2c26b5);},'bxoeu':function(_0x4a54da,_0x59ac61){return _0x4a54da+_0x59ac61;},'dgMnA':_0x855ec8(0xd1),'IOwTi':function(_0x4869df,_0xd8a72a){return _0x4869df(_0xd8a72a);},'nisAz':'percy.json'};if(!this.#config[_0x855ec8(0xcc)])return null;const _0x1dc020=path['join'](os[_0x855ec8(0xa9)](),_0x228f74[_0x855ec8(0xa0)]),_0x16182b=this.#config[_0x855ec8(0xcc)];return!_0x16182b[_0x855ec8(0xda)]&&(_0x16182b[_0x855ec8(0xda)]='2'),new Promise((_0x649dde,_0x5b0565)=>{const _0x2ac558=_0x855ec8,_0x2aa750={'TsFcX':function(_0x61ed47,_0x54078e){const _0x4d8ddd=a112_0x3bbf;return _0x228f74[_0x4d8ddd(0xb4)](_0x61ed47,_0x54078e);},'gXjlf':function(_0x2fe1b2,_0x57705e){const _0x9b2c6d=a112_0x3bbf;return _0x228f74[_0x9b2c6d(0xb7)](_0x2fe1b2,_0x57705e);},'MxsJu':_0x228f74['dgMnA'],'MiDZp':function(_0x25e8bd,_0xea1cd8){return _0x228f74['IOwTi'](_0x25e8bd,_0xea1cd8);}};fs['writeFile'](_0x1dc020,JSON[_0x2ac558(0xa2)](_0x16182b),_0x47ed42=>{const _0x17f559=_0x2ac558;_0x47ed42&&(logger[_0x17f559(0xba)](_0x17f559(0xcb)+_0x47ed42),_0x2aa750[_0x17f559(0xa4)](_0x649dde,null)),logger[_0x17f559(0xe5)](_0x2aa750['gXjlf'](_0x2aa750['MxsJu'],_0x1dc020)),_0x2aa750[_0x17f559(0xdf)](_0x649dde,_0x1dc020);});});}}module[a112_0x491ec2(0xe7)]=Percy;
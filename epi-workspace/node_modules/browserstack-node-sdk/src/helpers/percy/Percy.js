const a108_0x4041eb=a108_0x1572;(function(_0xf04afd,_0x561f96){const _0x239a95=a108_0x1572,_0x554d85=_0xf04afd();while(!![]){try{const _0x28ac3e=parseInt(_0x239a95(0xb7))/0x1+-parseInt(_0x239a95(0x9a))/0x2+-parseInt(_0x239a95(0xaf))/0x3+-parseInt(_0x239a95(0x9e))/0x4*(-parseInt(_0x239a95(0xaa))/0x5)+-parseInt(_0x239a95(0xc4))/0x6+parseInt(_0x239a95(0xc5))/0x7+parseInt(_0x239a95(0x9f))/0x8*(parseInt(_0x239a95(0xd6))/0x9);if(_0x28ac3e===_0x561f96)break;else _0x554d85['push'](_0x554d85['shift']());}catch(_0x352614){_0x554d85['push'](_0x554d85['shift']());}}}(a108_0x3bd5,0x85778));function a108_0x3bd5(){const _0x4eb5cf=['path','2285697dzwaEh','end','zriVK','getBinaryPath','hiyPw','debug','stringify','winstonLogger','1048534ISMtVG','fetchPercyToken','../../helpers/performance/constants','tmpdir','version','KYwyQ','qAHxD','percy.json','DOWNLOAD','createWriteStream','isProcessRunning','../../helpers/performance/performance-tester','IpCBE','6302598MmlCvV','5710635yCsVne','data','exec:stop','PERCY_SERVER_ADDRESS','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','nodeRequest','http://localhost:5338','pipe','Percy\x20fetch\x20token\x20success','healthcheck','ENV_VAR','DblMr','token','app:exec','HZmMh','PEpyG','BROWSERSTACK_TESTHUB_UUID','255933bapSdT','env','push','VTTBL','error','../../helpers/testhub/constants','XbysD','Percy\x20healthcheck\x20successful','yPtFn','assign','Error\x20creating\x20percy\x20config:\x20','isRunning','../logger','tgcmA','start','stop','api/app_percy/get_project_token?name=','percy.log','703172FtFUpY','child_process','percyOptions','close','388GTYjLh','64PxDawZ','jOWcK','GET','flags','hVFeL','percy/healthcheck','createPercyConfig','writeFile','exec','stdout','CVxAd','31895bQFgtR','stderr','&type=','app'];a108_0x3bd5=function(){return _0x4eb5cf;};return a108_0x3bd5();}const fs=require('fs'),path=require(a108_0x4041eb(0xae)),os=require('os'),{spawn}=require(a108_0x4041eb(0x9b)),helper=require('../helper'),logger=require('../logger')[a108_0x4041eb(0xb6)],{getLogDir}=require(a108_0x4041eb(0x94)),testHubConstants=require(a108_0x4041eb(0xdb)),PerformanceTester=require(a108_0x4041eb(0xc2)),{PERCY_EVENTS:PerformanceEvents}=require(a108_0x4041eb(0xb9)),PercyBinary=require('./PercyBinary');function a108_0x1572(_0x1c607c,_0x7ad21b){const _0x3bd50f=a108_0x3bd5();return a108_0x1572=function(_0x157217,_0x3dac41){_0x157217=_0x157217-0x92;let _0x52d523=_0x3bd50f[_0x157217];return _0x52d523;},a108_0x1572(_0x1c607c,_0x7ad21b);}class Percy{#logfile=path['join'](getLogDir(),a108_0x4041eb(0x99));#address=process[a108_0x4041eb(0xd7)][a108_0x4041eb(0xc8)]||a108_0x4041eb(0xcb);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a108_0x4041eb(0xc1)]=![];constructor(_0x5148e0){const _0x55abad=a108_0x4041eb;this.#config=_0x5148e0,!!_0x5148e0[_0x55abad(0xad)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x24480=a108_0x4041eb;if(!this.#binaryPath){const _0x162c6a=new PercyBinary();PerformanceTester[_0x24480(0x96)](PerformanceEvents['DOWNLOAD']),this.#binaryPath=await _0x162c6a[_0x24480(0xb2)](this.#config),PerformanceTester[_0x24480(0xb0)](PerformanceEvents[_0x24480(0xbf)]);}return this.#binaryPath;}async #sleep(_0xdbf58d){return new Promise(_0x6b5827=>setTimeout(_0x6b5827,_0xdbf58d));}async[a108_0x4041eb(0xce)](){const _0x2e469f=a108_0x4041eb,_0x28e1db={};_0x28e1db[_0x2e469f(0xdc)]=_0x2e469f(0xa1),_0x28e1db[_0x2e469f(0xa0)]=_0x2e469f(0xa4);const _0x2019e8=_0x28e1db;try{const _0x1d3e60=await helper['nodeRequest'](_0x2019e8['XbysD'],_0x2019e8[_0x2e469f(0xa0)],null,null,this.#address);if(_0x1d3e60)return!![];}catch(_0x351e88){return![];}}async[a108_0x4041eb(0x96)](){const _0x5fe214=a108_0x4041eb,_0x4907ec={'oPmfz':_0x5fe214(0xd2),'yPtFn':_0x5fe214(0xa7),'EQTwE':function(_0x32b4f9,_0x484e2a,_0x4100f9,_0xbf45af){return _0x32b4f9(_0x484e2a,_0x4100f9,_0xbf45af);},'qpoBo':_0x5fe214(0x9d),'HZmMh':_0x5fe214(0xdd)},_0x573cd5=await this.#getBinaryPath(),_0x2953ee={};_0x2953ee[_0x5fe214(0xa2)]='a';const _0x35d70c=fs[_0x5fe214(0xc0)](this.#logfile,_0x2953ee),_0x9e0a8a=await this[_0x5fe214(0xb8)](),_0x48f722=await this[_0x5fe214(0xa5)]();if(!_0x9e0a8a)return![];const _0x501410=[(this.#isApp?_0x4907ec['oPmfz']:_0x4907ec[_0x5fe214(0xde)])+':start'];_0x48f722&&_0x501410[_0x5fe214(0xd8)]('-c',_0x48f722);this.#proc=_0x4907ec['EQTwE'](spawn,_0x573cd5,_0x501410,{'env':Object[_0x5fe214(0xdf)](process[_0x5fe214(0xd7)],{'PERCY_TOKEN':_0x9e0a8a,'TH_BUILD_UUID':process[_0x5fe214(0xd7)][testHubConstants[_0x5fe214(0xcf)][_0x5fe214(0xd5)]]})}),this.#proc[_0x5fe214(0xa8)][_0x5fe214(0xcc)](_0x35d70c),this.#proc[_0x5fe214(0xab)][_0x5fe214(0xcc)](_0x35d70c),this[_0x5fe214(0xc1)]=!![];var _0x39c612=this;this.#proc['on'](_0x4907ec['qpoBo'],function(_0x498f7d){_0x39c612['isProcessRunning']=![];});do{const _0x197194=await this[_0x5fe214(0xce)]();if(_0x197194)return logger[_0x5fe214(0xb4)](_0x4907ec[_0x5fe214(0xd3)]),!![];await this.#sleep(0x3e8);}while(this[_0x5fe214(0xc1)]);return![];}async[a108_0x4041eb(0x97)](){const _0x4bf14a=a108_0x4041eb,_0x2f8dd2={'VTTBL':function(_0x2123e7,_0x23a413){return _0x2123e7(_0x23a413);},'zriVK':function(_0x2afb7f,_0x395376,_0x3261c4){return _0x2afb7f(_0x395376,_0x3261c4);},'qAHxD':_0x4bf14a(0xc7),'hVFeL':_0x4bf14a(0x9d)},_0x177387=await this.#getBinaryPath();return new Promise((_0x2404be,_0x41a07d)=>{const _0x2da661=_0x4bf14a,_0x1e8128=_0x2f8dd2[_0x2da661(0xb1)](spawn,_0x177387,[_0x2f8dd2[_0x2da661(0xbd)]]);_0x1e8128['on'](_0x2f8dd2[_0x2da661(0xa3)],_0x42d5d5=>{const _0x5e3945=_0x2da661;this[_0x5e3945(0xc1)]=![],_0x2f8dd2[_0x5e3945(0xd9)](_0x2404be,_0x42d5d5);});});}[a108_0x4041eb(0x93)](){const _0x35c6ca=a108_0x4041eb;return this[_0x35c6ca(0xc1)];}async[a108_0x4041eb(0xb8)](){const _0x1fec8b=a108_0x4041eb,_0x1d9109={};_0x1d9109[_0x1fec8b(0xd4)]=_0x1fec8b(0xad),_0x1d9109[_0x1fec8b(0xc3)]='automate',_0x1d9109['tgcmA']=_0x1fec8b(0xa1),_0x1d9109[_0x1fec8b(0xd0)]=_0x1fec8b(0xcd);const _0x2d7852=_0x1d9109,_0x197aeb=this.#config['projectName'];try{const _0x43c6fa=this.#isApp?_0x2d7852[_0x1fec8b(0xd4)]:_0x2d7852[_0x1fec8b(0xc3)],_0x4aa8a5=await helper[_0x1fec8b(0xca)](_0x2d7852[_0x1fec8b(0x95)],_0x1fec8b(0x98)+_0x197aeb+_0x1fec8b(0xac)+_0x43c6fa,{},this.#config),_0x245b88=_0x4aa8a5[_0x1fec8b(0xc6)];return logger['debug'](_0x2d7852[_0x1fec8b(0xd0)]),_0x245b88[_0x1fec8b(0xd1)];}catch(_0x28bde1){return logger[_0x1fec8b(0xda)](_0x1fec8b(0xc9)+_0x28bde1),null;}}async['createPercyConfig'](){const _0x613edb=a108_0x4041eb,_0x34e2a6={'CVxAd':function(_0x3bb59c,_0x189ea3){return _0x3bb59c(_0x189ea3);},'hiyPw':function(_0x4274e8,_0x37c724){return _0x4274e8+_0x37c724;},'hhLyo':'Percy\x20config\x20created\x20at\x20','KYwyQ':_0x613edb(0xbe)};if(!this.#config[_0x613edb(0x9c)])return null;const _0x5daeeb=path['join'](os[_0x613edb(0xba)](),_0x34e2a6[_0x613edb(0xbc)]),_0x73da9b=this.#config[_0x613edb(0x9c)];return!_0x73da9b[_0x613edb(0xbb)]&&(_0x73da9b[_0x613edb(0xbb)]='2'),new Promise((_0x219c48,_0x2547b6)=>{const _0x43d17d=_0x613edb;fs[_0x43d17d(0xa6)](_0x5daeeb,JSON[_0x43d17d(0xb5)](_0x73da9b),_0x3325aa=>{const _0x3c68a5=_0x43d17d;_0x3325aa&&(logger[_0x3c68a5(0xda)](_0x3c68a5(0x92)+_0x3325aa),_0x34e2a6[_0x3c68a5(0xa9)](_0x219c48,null)),logger[_0x3c68a5(0xb4)](_0x34e2a6[_0x3c68a5(0xb3)](_0x34e2a6['hhLyo'],_0x5daeeb)),_0x34e2a6[_0x3c68a5(0xa9)](_0x219c48,_0x5daeeb);});});}}module['exports']=Percy;
const a106_0x130689=a106_0x5a46;function a106_0x5a46(_0x53a738,_0x5686c5){const _0x145cf7=a106_0x145c();return a106_0x5a46=function(_0x5a4687,_0x39fc52){_0x5a4687=_0x5a4687-0xcb;let _0x4f048e=_0x145cf7[_0x5a4687];return _0x4f048e;},a106_0x5a46(_0x53a738,_0x5686c5);}(function(_0x196ae5,_0x1b9612){const _0x5a3091=a106_0x5a46,_0x4b8894=_0x196ae5();while(!![]){try{const _0x3aaad3=parseInt(_0x5a3091(0xce))/0x1*(-parseInt(_0x5a3091(0x108))/0x2)+-parseInt(_0x5a3091(0x10e))/0x3+parseInt(_0x5a3091(0xcc))/0x4+-parseInt(_0x5a3091(0x116))/0x5+-parseInt(_0x5a3091(0x104))/0x6+-parseInt(_0x5a3091(0x110))/0x7+parseInt(_0x5a3091(0x10b))/0x8*(parseInt(_0x5a3091(0xfe))/0x9);if(_0x3aaad3===_0x1b9612)break;else _0x4b8894['push'](_0x4b8894['shift']());}catch(_0x573419){_0x4b8894['push'](_0x4b8894['shift']());}}}(a106_0x145c,0x38084));const fs=require('fs'),path=require(a106_0x130689(0xd0)),os=require('os'),{spawn}=require('child_process'),helper=require(a106_0x130689(0xe2)),logger=require(a106_0x130689(0x100))[a106_0x130689(0xea)],{getLogDir}=require(a106_0x130689(0x100)),testHubConstants=require(a106_0x130689(0x101)),PerformanceTester=require(a106_0x130689(0xe8)),{PERCY_EVENTS:PerformanceEvents}=require(a106_0x130689(0xcb)),PercyBinary=require(a106_0x130689(0x10d));function a106_0x145c(){const _0x4694fe=['BROWSERSTACK_TESTHUB_UUID','winstonLogger','stderr','NSdOE','env','UWSAO','debug','Msugo','WKCLy','CIDZU','isRunning','QDHQf','Percy\x20fetch\x20token\x20success','YEKDV','GET',':start','sRCAd','start','pipe','projectName','TmOXz','7319961aXrDEQ','YZBaF','../logger','../../helpers/testhub/constants','version','automate','589254bnjbro','percy/healthcheck','push','fetchPercyToken','52826zUqOlo','Percy\x20config\x20created\x20at\x20','tmpdir','8Hapniw','end','./PercyBinary','866466MdboNm','stringify','240660PjePRm','soBYl','EGUMg','percyOptions','isProcessRunning','QemfE','1044460GlbJeI','percy.json','writeFile','../../helpers/performance/constants','1770708pNXHzs','close','15SqPzvb','error','path','app:exec','flags','TPUen','app','&type=','stop','XZQUp','assign','token','nZigj','QuqLs','api/app_percy/get_project_token?name=','getBinaryPath','exec','DOWNLOAD','ENV_VAR','healthcheck','../helper','xpTbV','exec:stop','rcGwG','createPercyConfig','nodeRequest','../../helpers/performance/performance-tester'];a106_0x145c=function(){return _0x4694fe;};return a106_0x145c();}class Percy{#logfile=path['join'](getLogDir(),'percy.log');#address=process[a106_0x130689(0xed)]['PERCY_SERVER_ADDRESS']||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a106_0x130689(0x114)]=![];constructor(_0x19303d){const _0x23d619=a106_0x130689;this.#config=_0x19303d,!!_0x19303d[_0x23d619(0xd4)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x198505=a106_0x130689;if(!this.#binaryPath){const _0x281be5=new PercyBinary();PerformanceTester[_0x198505(0xfa)](PerformanceEvents[_0x198505(0xdf)]),this.#binaryPath=await _0x281be5[_0x198505(0xdd)](this.#config),PerformanceTester[_0x198505(0x10c)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x242b32){return new Promise(_0x1370ad=>setTimeout(_0x1370ad,_0x242b32));}async[a106_0x130689(0xe1)](){const _0x13002d=a106_0x130689,_0x25c1c5={};_0x25c1c5[_0x13002d(0xd7)]=_0x13002d(0xf7),_0x25c1c5['TmOXz']=_0x13002d(0x105);const _0x338e30=_0x25c1c5;try{const _0x5d16ff=await helper[_0x13002d(0xe7)](_0x338e30[_0x13002d(0xd7)],_0x338e30[_0x13002d(0xfd)],null,null,this.#address);if(_0x5d16ff)return!![];}catch(_0x51cc87){return![];}}async['start'](){const _0x1bb872=a106_0x130689,_0x122d9a={'rcGwG':_0x1bb872(0xd1),'Msugo':_0x1bb872(0xde),'EGUMg':function(_0x571e0a,_0x14475f,_0x14e97d,_0x903510){return _0x571e0a(_0x14475f,_0x14e97d,_0x903510);},'TPUen':_0x1bb872(0xcd),'YZBaF':'Percy\x20healthcheck\x20successful'},_0xb62e81=await this.#getBinaryPath(),_0x5350e4={};_0x5350e4[_0x1bb872(0xd2)]='a';const _0x36e148=fs['createWriteStream'](this.#logfile,_0x5350e4),_0x781625=await this[_0x1bb872(0x107)](),_0x569f10=await this[_0x1bb872(0xe6)]();if(!_0x781625)return![];const _0x5b7f0a=[(this.#isApp?_0x122d9a[_0x1bb872(0xe5)]:_0x122d9a[_0x1bb872(0xf0)])+_0x1bb872(0xf8)];_0x569f10&&_0x5b7f0a[_0x1bb872(0x106)]('-c',_0x569f10);this.#proc=_0x122d9a[_0x1bb872(0x112)](spawn,_0xb62e81,_0x5b7f0a,{'env':Object[_0x1bb872(0xd8)](process[_0x1bb872(0xed)],{'PERCY_TOKEN':_0x781625,'TH_BUILD_UUID':process[_0x1bb872(0xed)][testHubConstants[_0x1bb872(0xe0)][_0x1bb872(0xe9)]]})}),this.#proc['stdout'][_0x1bb872(0xfb)](_0x36e148),this.#proc[_0x1bb872(0xeb)][_0x1bb872(0xfb)](_0x36e148),this['isProcessRunning']=!![];var _0x5d8484=this;this.#proc['on'](_0x122d9a[_0x1bb872(0xd3)],function(_0x5e4694){const _0xee4104=_0x1bb872;_0x5d8484[_0xee4104(0x114)]=![];});do{const _0x264474=await this['healthcheck']();if(_0x264474)return logger[_0x1bb872(0xef)](_0x122d9a[_0x1bb872(0xff)]),!![];await this.#sleep(0x3e8);}while(this[_0x1bb872(0x114)]);return![];}async[a106_0x130689(0xd6)](){const _0x34bb0c=a106_0x130689,_0x415a3f={'CIDZU':function(_0x1e5e30,_0x1ec307){return _0x1e5e30(_0x1ec307);},'UWSAO':function(_0x25f598,_0x5bacff,_0x2813ff){return _0x25f598(_0x5bacff,_0x2813ff);},'QemfE':_0x34bb0c(0xe4),'QuqLs':_0x34bb0c(0xcd)},_0x289c0c=await this.#getBinaryPath();return new Promise((_0x4352ad,_0x376651)=>{const _0x8cbfd=_0x34bb0c,_0x521f6e=_0x415a3f[_0x8cbfd(0xee)](spawn,_0x289c0c,[_0x415a3f[_0x8cbfd(0x115)]]);_0x521f6e['on'](_0x415a3f[_0x8cbfd(0xdb)],_0x13e4cd=>{const _0x36d181=_0x8cbfd;this['isProcessRunning']=![],_0x415a3f[_0x36d181(0xf2)](_0x4352ad,_0x13e4cd);});});}[a106_0x130689(0xf3)](){const _0x51b53c=a106_0x130689;return this[_0x51b53c(0x114)];}async['fetchPercyToken'](){const _0x28b3ea=a106_0x130689,_0x44e365={};_0x44e365['sRCAd']=_0x28b3ea(0xd4),_0x44e365[_0x28b3ea(0xe3)]=_0x28b3ea(0x103),_0x44e365[_0x28b3ea(0xf4)]=_0x28b3ea(0xf7),_0x44e365['YEKDV']=_0x28b3ea(0xf5);const _0x4cbc84=_0x44e365,_0x429bcf=this.#config[_0x28b3ea(0xfc)];try{const _0x7f183=this.#isApp?_0x4cbc84[_0x28b3ea(0xf9)]:_0x4cbc84[_0x28b3ea(0xe3)],_0x2d509f=await helper['nodeRequest'](_0x4cbc84[_0x28b3ea(0xf4)],_0x28b3ea(0xdc)+_0x429bcf+_0x28b3ea(0xd5)+_0x7f183,{},this.#config),_0x4e873c=_0x2d509f['data'];return logger[_0x28b3ea(0xef)](_0x4cbc84[_0x28b3ea(0xf6)]),_0x4e873c[_0x28b3ea(0xd9)];}catch(_0x5e7688){return logger[_0x28b3ea(0xcf)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x5e7688),null;}}async[a106_0x130689(0xe6)](){const _0x3bcb09=a106_0x130689,_0x2345ed={'HpXhB':function(_0x15e870,_0x12cb4b){return _0x15e870(_0x12cb4b);},'NSdOE':function(_0x5e86b8,_0x42a345){return _0x5e86b8+_0x42a345;},'soBYl':_0x3bcb09(0x109),'nZigj':function(_0x22e03e,_0x1a12ba){return _0x22e03e(_0x1a12ba);},'WKCLy':_0x3bcb09(0x117)};if(!this.#config['percyOptions'])return null;const _0x571d05=path['join'](os[_0x3bcb09(0x10a)](),_0x2345ed[_0x3bcb09(0xf1)]),_0x39eddd=this.#config[_0x3bcb09(0x113)];return!_0x39eddd['version']&&(_0x39eddd[_0x3bcb09(0x102)]='2'),new Promise((_0x2e1c07,_0xf7e0c4)=>{const _0x99585b=_0x3bcb09;fs[_0x99585b(0x118)](_0x571d05,JSON[_0x99585b(0x10f)](_0x39eddd),_0x5c6c73=>{const _0x6a9cec=_0x99585b;_0x5c6c73&&(logger[_0x6a9cec(0xcf)]('Error\x20creating\x20percy\x20config:\x20'+_0x5c6c73),_0x2345ed['HpXhB'](_0x2e1c07,null)),logger[_0x6a9cec(0xef)](_0x2345ed[_0x6a9cec(0xec)](_0x2345ed[_0x6a9cec(0x111)],_0x571d05)),_0x2345ed[_0x6a9cec(0xda)](_0x2e1c07,_0x571d05);});});}}module['exports']=Percy;
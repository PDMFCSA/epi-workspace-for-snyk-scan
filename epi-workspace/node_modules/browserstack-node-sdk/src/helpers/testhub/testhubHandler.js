function a90_0x39a7(_0x1db9fe,_0x267547){const _0x27b955=a90_0x27b9();return a90_0x39a7=function(_0x39a736,_0x8dfeec){_0x39a736=_0x39a736-0x1e3;let _0x72897a=_0x27b955[_0x39a736];return _0x72897a;},a90_0x39a7(_0x1db9fe,_0x267547);}const a90_0x1c45dd=a90_0x39a7;(function(_0x167ec2,_0x15c9f5){const _0x502e2c=a90_0x39a7,_0x2faf15=_0x167ec2();while(!![]){try{const _0x266c53=-parseInt(_0x502e2c(0x208))/0x1*(parseInt(_0x502e2c(0x23a))/0x2)+parseInt(_0x502e2c(0x249))/0x3*(-parseInt(_0x502e2c(0x223))/0x4)+parseInt(_0x502e2c(0x1ee))/0x5*(-parseInt(_0x502e2c(0x26a))/0x6)+-parseInt(_0x502e2c(0x21f))/0x7*(parseInt(_0x502e2c(0x1f4))/0x8)+parseInt(_0x502e2c(0x20c))/0x9+-parseInt(_0x502e2c(0x214))/0xa*(parseInt(_0x502e2c(0x22d))/0xb)+parseInt(_0x502e2c(0x235))/0xc*(parseInt(_0x502e2c(0x20e))/0xd);if(_0x266c53===_0x15c9f5)break;else _0x2faf15['push'](_0x2faf15['shift']());}catch(_0x131ad1){_0x2faf15['push'](_0x2faf15['shift']());}}}(a90_0x27b9,0x4b28c));function a90_0x27b9(){const _0x9833be=['auth','data','info','getAccessKey','user_killed','job_id','5vIlRwA','QBSVq','getCentralUser','FPHJk','yrbzD','token','48uRQUTz','push','PERCY_SUPPORTED_FRAMEWORKS','BROWSERSTACK_TESTHUB_UUID','setTestHubCommonMetaInfo','central_scanner','PLiUi','message','api/v1/builds/','stop','getProductMap','debug','ImOhS','JWhMm','rNNaj','response','finished_metadata','processTraceZips','getCiInfo','resolve','251003dlVhAy','add','POST','status','3756987MCdIZZ','HKSgz','13SphdCp','buildHashedId','getFrameworkDetails','checkAndSetupPercy','ACCESSIBILITY','stopBuildUpstream\x20event\x20successful!','79330TYMJiS','RMUJi','sQEwe','projectName','isUndefined','config','waitForBuildStatus','../test-observability/utils','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','env','launchBuild','469903KNHozu','settings','vrKgo','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','12SIaBLq','STOP','BROWSERSTACK_ACCESSIBILITY','BROWSERSTACK_CENTRAL_SCANNER_JWT','jwt','fVNCd','getConfig','getInstance','EgzLR','../test-observability/sessionHandler.js','385jGeOWf','./utils.js','BS_TESTOPS_BUILD_COMPLETED','measureWrapper','SgqcF','QBiQH','getAccessibilityOptions','getUserName','15571572OBRXjN','lcnc','../logger','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','allSettled','2ZcfKVT','BROWSERSTACK_RERUN','isBrowserstackInfra','stringify','buildStopSent','toISOString','START','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','getAccessibilityValueFromYml','error','NvgHp','../performance/constants','ENV_VAR','../../bin/utils/constants.js','forEach','179913iGuHMh','Testhub\x20started\x20with\x20id:\x20','assign','PxtLM','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','GBPJo','OBSERVABILITY','buildDescription','Error\x20while\x20waiting\x20for\x20events:\x20','QHhJs','extractDataFromResponse','All\x20trace\x20zip\x20send\x20events\x20complete','authToken','RViOA','success','false','percy','setAccessibilityVariables','exports','isAccessibilityEnabled','setTestObservabilityVariables','framework','../performance/performance-tester.js','nwlhW','null','BROWSERSTACK_BUILD_RUN_IDENTIFIER','accessibility','username','basename','BROWSERSTACK_CENTRAL_SCANNER_JOBID','statusText','PUT','accessibilityOptions','1775262McHvFX','getGitMetaData','util','cwd','/stop','BROWSERSTACK_TESTHUB_JWT','buildIdentifier'];a90_0x27b9=function(){return _0x9833be;};return a90_0x27b9();}const bsSetupHelper=require('../helper'),path=require('path'),util=require(a90_0x1c45dd(0x1e3)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x1c45dd(0x21b)),testhubUtils=require(a90_0x1c45dd(0x22e)),testHubConstants=require('./constants.js'),constants=require(a90_0x1c45dd(0x247)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a90_0x1c45dd(0x237))['winstonLogger'],SessionHandler=require(a90_0x1c45dd(0x22c)),PerformanceTester=require(a90_0x1c45dd(0x25f)),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x1c45dd(0x245)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x4c2980=>{const _0x1cc614=a90_0x1c45dd;OngoingEvents[_0x1cc614(0x209)](_0x4c2980);},awaitAllEvents=async()=>{const _0x4fa055=a90_0x1c45dd;return Promise[_0x4fa055(0x239)](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async[a90_0x1c45dd(0x21e)](_0x41c167,_0x4cd9e8){const _0x320a3a=a90_0x1c45dd,_0x260c0a={'aypTF':function(_0x35f364,_0x5f50f0){return _0x35f364||_0x5f50f0;},'GBPJo':function(_0x4ada3b,_0x37904d){return _0x4ada3b===_0x37904d;},'BNZXg':function(_0x5db4db){return _0x5db4db();},'NvgHp':_0x320a3a(0x24d),'vrKgo':_0x320a3a(0x258),'FPHJk':_0x320a3a(0x241),'dUoMl':function(_0x3386be,_0x317316,_0x40820a,_0x1fdf59,_0x5dd1b1){return _0x3386be(_0x317316,_0x40820a,_0x1fdf59,_0x5dd1b1);},'AdYkm':_0x320a3a(0x20a),'ceWnt':_0x320a3a(0x263),'JWhMm':'true'};await PerformanceTester[_0x320a3a(0x230)](PerformanceEvents[_0x320a3a(0x240)],async()=>{const _0x45dceb=_0x320a3a,_0x56b244=Object[_0x45dceb(0x24b)]({},_0x4cd9e8['config'],{'root_dir_path':'','framework':_0x4cd9e8[_0x45dceb(0x25e)]}),_0x3e4d4b=bsSetupHelper[_0x45dceb(0x234)](_0x56b244),_0x53041b=bsSetupHelper[_0x45dceb(0x1eb)](_0x56b244),_0x42ac3f=_0x260c0a['aypTF'](_0x3e4d4b,'')+':'+_0x260c0a['aypTF'](_0x53041b,''),_0x19c9df=testhubUtils[_0x45dceb(0x1fe)](_0x56b244);process[_0x45dceb(0x21d)]['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x45dceb(0x23d)](_0x19c9df);if(_0x260c0a[_0x45dceb(0x24e)](_0x42ac3f,':'))return _0x260c0a['BNZXg'](isTestObservabilitySession)&&(logger[_0x45dceb(0x1ff)](_0x260c0a[_0x45dceb(0x244)]),process[_0x45dceb(0x21d)]['BS_TESTOPS_BUILD_COMPLETED']=_0x260c0a[_0x45dceb(0x221)]),testhubUtils[_0x45dceb(0x25c)](_0x56b244)&&logger[_0x45dceb(0x1ff)](_0x260c0a[_0x45dceb(0x1f1)]),[null,null];try{const _0x334015=await this['generateBuildUpstreamData'](_0x56b244,_0x41c167),_0x3e2a8c=this[_0x45dceb(0x229)](_0x3e4d4b,_0x53041b),_0x4fbebc=await _0x260c0a['dUoMl'](nodeRequest,_0x260c0a['AdYkm'],testHubConstants['TESTHUB_BUILD_API'],_0x334015,_0x3e2a8c),_0x13bae5=this['extractDataFromResponse'](_0x56b244,_0x4fbebc,_0x3e2a8c);await this['checkAndSetupPercy'](_0x4cd9e8,_0x41c167);if(_0x260c0a[_0x45dceb(0x24e)](testhubUtils[_0x45dceb(0x242)](_0x4cd9e8['config']),null)){const _0x1b4e2f=_0x13bae5[_0x260c0a['ceWnt']];_0x1b4e2f&&_0x1b4e2f[_0x45dceb(0x255)]&&_0x1b4e2f[_0x45dceb(0x20f)]&&(_0x4cd9e8[_0x45dceb(0x219)][_0x45dceb(0x263)]=!![],process[_0x45dceb(0x21d)][_0x45dceb(0x21c)]=_0x260c0a[_0x45dceb(0x201)]);}return _0x13bae5;}catch(_0x37ae3d){if(_0x260c0a[_0x45dceb(0x24e)](_0x37ae3d[_0x45dceb(0x257)],![])){testhubUtils['logBuildError'](_0x37ae3d);return;}}})();}static async[a90_0x1c45dd(0x205)](){const _0x26e3fd=a90_0x1c45dd,_0x529d86={'SgqcF':function(_0x585f0e,_0x59cb90,_0x10b5c9){return _0x585f0e(_0x59cb90,_0x10b5c9);},'vZHaZ':function(_0x2cc6ac,_0x31cbcd){return _0x2cc6ac(_0x31cbcd);},'AaWkm':function(_0x2a30a9){return _0x2a30a9();},'QBiQH':_0x26e3fd(0x254)};if(processedTraceZips)return;const _0x5101cf=TestDetails['getTraceFilePaths']();_0x5101cf[_0x26e3fd(0x248)](({testUId:_0x4b6034,filePath:_0x571aa6})=>{const _0x226ff5=_0x26e3fd;var _0x588ee8=_0x529d86[_0x226ff5(0x231)](uploadTraceZip,_0x571aa6,_0x4b6034);_0x529d86['vZHaZ'](addEvent,_0x588ee8);});try{await _0x529d86['AaWkm'](awaitAllEvents),logger['debug'](_0x529d86[_0x26e3fd(0x232)]),processedTraceZips=!![];}catch(_0x1ade96){logger[_0x26e3fd(0x243)](_0x26e3fd(0x251)+util['format'](_0x1ade96));}}static async[a90_0x1c45dd(0x211)](_0xdbe75e,_0x41c1f6){const _0x39637b=a90_0x1c45dd;if(constants[_0x39637b(0x1f6)]['includes'](_0x41c1f6)){await _0xdbe75e['setupPercy']();return;}_0xdbe75e[_0x39637b(0x219)][_0x39637b(0x259)]&&logger[_0x39637b(0x1ff)]('Percy\x20is\x20not\x20supported\x20for\x20'+_0x41c1f6+'\x20framework');}static[a90_0x1c45dd(0x233)](_0x4732a1){const _0x1d8566=a90_0x1c45dd,_0x19f468={};_0x19f468[_0x1d8566(0x220)]=_0x4732a1[_0x1d8566(0x269)];const _0x36f22a=_0x19f468;return _0x36f22a;}static[a90_0x1c45dd(0x229)](_0x18ace0,_0x236c37){const _0x3e93a3=a90_0x1c45dd,_0x256016={'CbUbm':function(_0xff610f,_0x52757c){return _0xff610f(_0x52757c);}},_0x3e4316={};return _0x3e4316[_0x3e93a3(0x264)]=_0x18ace0,_0x3e4316['password']=_0x236c37,{'auth':_0x3e4316,'headers':_0x256016['CbUbm'](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x55e4fb,_0x4fd290){const _0x200d47=a90_0x1c45dd,_0x5daa47={'PLiUi':function(_0x4216b7,_0x587df2){return _0x4216b7(_0x587df2);}},_0x40af69={'project_name':_0x55e4fb[_0x200d47(0x217)]||'','name':_0x55e4fb['buildName']||path[_0x200d47(0x265)](path[_0x200d47(0x207)](process[_0x200d47(0x1e4)]())),'build_identifier':_0x55e4fb[_0x200d47(0x1e7)],'description':_0x55e4fb[_0x200d47(0x250)]||'','started_at':new Date()[_0x200d47(0x23f)](),'tags':_0x5daa47[_0x200d47(0x1fa)](getCustomTags,_0x55e4fb),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x200d47(0x206)](),'build_run_identifier':process[_0x200d47(0x21d)][_0x200d47(0x262)],'failed_tests_rerun':process['env'][_0x200d47(0x23b)]||![],'version_control':await bsSetupHelper[_0x200d47(0x26b)](),'accessibility':this['getAccessibilityOptions'](_0x55e4fb),'framework_details':testhubUtils[_0x200d47(0x210)](_0x55e4fb,_0x4fd290),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x55e4fb),'browserstackAutomation':bsSetupHelper[_0x200d47(0x23c)](),'grouping_identifier':process[_0x200d47(0x21d)][_0x200d47(0x222)]};if(bsSetupHelper[_0x200d47(0x1f0)]()[_0x200d47(0x1f9)]||bsSetupHelper[_0x200d47(0x1f0)]()[_0x200d47(0x236)]){const _0x35e810={};_0x35e810[_0x200d47(0x1ed)]=process[_0x200d47(0x21d)][_0x200d47(0x266)],_0x35e810[_0x200d47(0x1f3)]=process[_0x200d47(0x21d)][_0x200d47(0x226)],_0x40af69[_0x200d47(0x1f9)]=_0x35e810;}return _0x40af69;}static[a90_0x1c45dd(0x253)](_0x313f3c,_0x2021ec,_0x30d976){const _0x30df54=a90_0x1c45dd,_0x55d1d3={'QHhJs':function(_0x40d93a){return _0x40d93a();},'PxtLM':function(_0x130926,_0x13a635){return _0x130926&&_0x13a635;},'RMUJi':'true','QBSVq':_0x30df54(0x258)},_0x59d1df={};if(_0x55d1d3[_0x30df54(0x252)](isTestObservabilitySession)){const [_0x15bb63,_0x5b044f,_0x4157d2]=testhubUtils[_0x30df54(0x25d)](_0x2021ec[_0x30df54(0x1e9)],_0x30d976[_0x30df54(0x1e8)]);if(_0x55d1d3[_0x30df54(0x24c)](_0x15bb63,_0x5b044f)){const _0x55f4f1={};_0x55f4f1[_0x30df54(0x227)]=_0x15bb63,_0x55f4f1[_0x30df54(0x20f)]=_0x5b044f,_0x55f4f1['allowScreenshot']=_0x4157d2,_0x59d1df[testHubConstants[_0x30df54(0x24f)]]=_0x55f4f1,process[_0x30df54(0x21d)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x55d1d3[_0x30df54(0x215)];}else _0x59d1df[testHubConstants[_0x30df54(0x24f)]]={},process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x55d1d3[_0x30df54(0x1ef)];}else process[_0x30df54(0x21d)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x55d1d3[_0x30df54(0x1ef)];const [_0x5c3532,_0x210138]=testhubUtils[_0x30df54(0x25a)](_0x2021ec['data']);if(_0x55d1d3[_0x30df54(0x24c)](_0x5c3532,_0x210138)){const _0x3cf3f8={};_0x3cf3f8[_0x30df54(0x255)]=_0x5c3532,_0x3cf3f8[_0x30df54(0x20f)]=_0x210138,_0x59d1df[testHubConstants[_0x30df54(0x212)]]=_0x3cf3f8,process['env'][_0x30df54(0x225)]=_0x55d1d3['RMUJi'];}else _0x59d1df[testHubConstants[_0x30df54(0x212)]]={},process['env'][_0x30df54(0x225)]=_0x55d1d3[_0x30df54(0x1ef)];return testhubUtils[_0x30df54(0x1f8)](_0x2021ec[_0x30df54(0x1e9)]),logger[_0x30df54(0x1ea)](_0x30df54(0x24a)+process[_0x30df54(0x21d)]['BROWSERSTACK_TESTHUB_UUID']),_0x59d1df;}static async[a90_0x1c45dd(0x1fd)](_0x244902){const _0x133906=a90_0x1c45dd,_0x39d39a={'hkwMt':function(_0x592142,_0x2933f0){return _0x592142===_0x2933f0;},'bcWdY':_0x133906(0x258),'RViOA':function(_0x165d0a,_0x3141cf){return _0x165d0a===_0x3141cf;},'HKSgz':_0x133906(0x261),'sQEwe':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','EgzLR':'error','nwlhW':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','yrbzD':_0x133906(0x204),'jNrYb':_0x133906(0x1ec),'ImOhS':function(_0x39c32e){return _0x39c32e();},'rNNaj':function(_0x568756,_0x23dfa6,_0x40a6dd,_0x1dc712,_0x22f9f9,_0x5ec9ed){return _0x568756(_0x23dfa6,_0x40a6dd,_0x1dc712,_0x22f9f9,_0x5ec9ed);},'rzMWI':_0x133906(0x268),'fVNCd':_0x133906(0x213),'nErJr':'success'};await this[_0x133906(0x205)](),await PerformanceTester[_0x133906(0x230)](PerformanceEvents[_0x133906(0x224)],async()=>{const _0x6507aa=_0x133906;if(_0x39d39a['hkwMt'](process['env'][_0x6507aa(0x22f)],_0x39d39a['bcWdY'])||TestHubHandler[_0x6507aa(0x23e)]||bsSetupHelper[_0x6507aa(0x218)](process[_0x6507aa(0x21d)][testHubConstants[_0x6507aa(0x246)][_0x6507aa(0x1e6)]]))return;TestHubHandler[_0x6507aa(0x23e)]=!![],await RequestQueueHandler[_0x6507aa(0x22a)]()['uploadPending'](),await SessionHandler[_0x6507aa(0x21a)]();if(_0x39d39a[_0x6507aa(0x256)](process[_0x6507aa(0x21d)][testHubConstants[_0x6507aa(0x246)][_0x6507aa(0x1e6)]],_0x39d39a[_0x6507aa(0x20d)])||_0x39d39a[_0x6507aa(0x256)](process[_0x6507aa(0x21d)][testHubConstants['ENV_VAR'][_0x6507aa(0x1f7)]],_0x39d39a[_0x6507aa(0x20d)])){logger[_0x6507aa(0x1ff)](_0x39d39a[_0x6507aa(0x216)]);const _0x401be2={};return _0x401be2['status']=_0x39d39a[_0x6507aa(0x22b)],_0x401be2['message']=_0x39d39a[_0x6507aa(0x260)],_0x401be2;}const _0x388e9b={'finished_at':new Date()[_0x6507aa(0x23f)](),'finished_metadata':[]};!!_0x244902&&_0x388e9b[_0x39d39a[_0x6507aa(0x1f2)]][_0x6507aa(0x1f5)]({'reason':_0x39d39a['jNrYb'],'signal':_0x244902,'failure_data':''});const _0x5d77dc={'headers':_0x39d39a[_0x6507aa(0x200)](getDefaultHeaders)};try{const _0x56ada6=await _0x39d39a[_0x6507aa(0x202)](nodeRequest,_0x39d39a['rzMWI'],_0x6507aa(0x1fc)+process[_0x6507aa(0x21d)][testHubConstants[_0x6507aa(0x246)][_0x6507aa(0x1f7)]]+_0x6507aa(0x1e5),_0x388e9b,_0x5d77dc,![]);if(_0x56ada6['data']&&_0x56ada6['data']['error']){const _0x34144a={};_0x34144a[_0x6507aa(0x1fb)]=_0x56ada6[_0x6507aa(0x1e9)][_0x6507aa(0x243)];throw _0x34144a;}else{logger[_0x6507aa(0x1ff)](_0x39d39a[_0x6507aa(0x228)]);const _0x5062f7={};return _0x5062f7[_0x6507aa(0x20b)]=_0x39d39a['nErJr'],_0x5062f7['message']='',_0x5062f7;}}catch(_0x87451c){_0x87451c['response']?logger[_0x6507aa(0x1ff)](_0x6507aa(0x238)+_0x87451c[_0x6507aa(0x203)][_0x6507aa(0x20b)]+'\x20'+_0x87451c[_0x6507aa(0x203)][_0x6507aa(0x267)]+'\x20'+JSON[_0x6507aa(0x23d)](_0x87451c[_0x6507aa(0x203)]['data'])):logger[_0x6507aa(0x1ff)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x87451c['message']||_0x87451c));const _0x258256={};return _0x258256['status']=_0x39d39a[_0x6507aa(0x22b)],_0x258256[_0x6507aa(0x1fb)]=_0x87451c['message']||_0x87451c['response']?_0x87451c[_0x6507aa(0x203)][_0x6507aa(0x20b)]+':'+_0x87451c[_0x6507aa(0x203)][_0x6507aa(0x267)]:_0x87451c,_0x258256;}})();}}module[a90_0x1c45dd(0x25b)]=TestHubHandler;
const a90_0xc55cd4=a90_0x2c55;function a90_0xbb79(){const _0x1c3c34=['BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','POST','settings','BROWSERSTACK_ACCESSIBILITY','auth','uploadPending','getAccessibilityOptions','getTraceFilePaths','buildDescription','BROWSERSTACK_TESTHUB_JWT','waitForBuildStatus','PLvir','../logger','../../bin/playwright/reporter/test-details.js','buildHashedId','response','mQbPo','push','2911290TbNxoI','central_scanner','authToken','PUT','setTestHubCommonMetaInfo','LKSUG','setTestObservabilityVariables','winstonLogger','WjXBg','START','exports','username','jPZKS','getCiInfo','message','xBISo','processTraceZips','basename','lOfHb','SGhvf','statusText','logBuildError','BROWSERSTACK_TEST_OBSERVABILITY','BS_TESTOPS_BUILD_COMPLETED','../test-observability/utils','buildStopSent','12MiVMNx','password','info','BROWSERSTACK_RERUN','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','percy','LOABt','OBSERVABILITY','AZUDs','gBMjw','809132zCYFEN','Testhub\x20started\x20with\x20id:\x20','ACCESSIBILITY','BROWSERSTACK_BUILD_RUN_IDENTIFIER','getGitMetaData','getProductMap','getInstance','config','ObjJf','getConfig','CbBDc','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','lcnc','BROWSERSTACK_TESTHUB_UUID','5ULChYX','STOP','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','isUndefined','measureWrapper','stringify','fTrzg','false','/stop','../performance/performance-tester.js','includes','job_id','framework','toISOString','ydsXE','launchBuild','BROWSERSTACK_CENTRAL_SCANNER_JWT','user_killed','projectName','buildName','status','stopBuildUpstream\x20event\x20successful!','mWMiW','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','token','debug','204234DJtCLT','3653792LydAng','siiSB','data','127962rBxYqX','puHFh','forEach','TESTHUB_BUILD_API','clbAs','PERCY_SUPPORTED_FRAMEWORKS','error','KzHRJ','419978DwnXbV','resolve','byEXD','stop','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','checkAndSetupPercy','extractDataFromResponse','../test-observability/requestQueueHandler.js','isAccessibilityEnabled','assign','true','ENV_VAR','setupPercy','success','jUPVv','IdYiN','1204028ygimXR','getUserName','env','FJEAO','fScMy','generateBuildUpstreamData','VwmFB','path'];a90_0xbb79=function(){return _0x1c3c34;};return a90_0xbb79();}(function(_0x39d859,_0x124280){const _0x5c848e=a90_0x2c55,_0x5854f5=_0x39d859();while(!![]){try{const _0x3be802=parseInt(_0x5c848e(0x141))/0x1+parseInt(_0x5c848e(0x175))/0x2+-parseInt(_0x5c848e(0x169))/0x3*(-parseInt(_0x5c848e(0x137))/0x4)+-parseInt(_0x5c848e(0x14f))/0x5*(parseInt(_0x5c848e(0x19f))/0x6)+parseInt(_0x5c848e(0x185))/0x7+-parseInt(_0x5c848e(0x16a))/0x8+parseInt(_0x5c848e(0x16d))/0x9;if(_0x3be802===_0x124280)break;else _0x5854f5['push'](_0x5854f5['shift']());}catch(_0x47e5a6){_0x5854f5['push'](_0x5854f5['shift']());}}}(a90_0xbb79,0x722b6));function a90_0x2c55(_0x5a94f0,_0x2c114d){const _0xbb791d=a90_0xbb79();return a90_0x2c55=function(_0x2c5516,_0x3ea4fe){_0x2c5516=_0x2c5516-0x125;let _0x5920e5=_0xbb791d[_0x2c5516];return _0x5920e5;},a90_0x2c55(_0x5a94f0,_0x2c114d);}const bsSetupHelper=require('../helper'),path=require(a90_0xc55cd4(0x18c)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0xc55cd4(0x135)),testhubUtils=require('./utils.js'),testHubConstants=require('./constants.js'),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a90_0xc55cd4(0x17c)),logger=require(a90_0xc55cd4(0x199))[a90_0xc55cd4(0x1a6)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a90_0xc55cd4(0x158)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a90_0xc55cd4(0x19a)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x3f3f28=>{OngoingEvents['add'](_0x3f3f28);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async[a90_0xc55cd4(0x15e)](_0x211612,_0x4d3f64){const _0x203d34=a90_0xc55cd4,_0x149687={'WjXBg':function(_0x42124a,_0x3b06d7){return _0x42124a||_0x3b06d7;},'drTVd':function(_0xd2a45e,_0x973bc){return _0xd2a45e===_0x973bc;},'mQbPo':function(_0x1ffffd){return _0x1ffffd();},'IJSDo':_0x203d34(0x151),'lOfHb':'false','CbBDc':_0x203d34(0x166),'jUPVv':function(_0x25395f,_0x7bf6f8,_0x482244,_0x4b06fb,_0x3f1b2e){return _0x25395f(_0x7bf6f8,_0x482244,_0x4b06fb,_0x3f1b2e);},'gQDvY':_0x203d34(0x18e),'xBISo':function(_0x5b0254,_0x2fa555){return _0x5b0254===_0x2fa555;}};await PerformanceTester[_0x203d34(0x153)](PerformanceEvents[_0x203d34(0x126)],async()=>{const _0x5d33c0=_0x203d34,_0x1a6e38=Object[_0x5d33c0(0x17e)]({},_0x4d3f64[_0x5d33c0(0x148)],{'root_dir_path':'','framework':_0x4d3f64[_0x5d33c0(0x15b)]}),_0x117dfe=bsSetupHelper[_0x5d33c0(0x186)](_0x1a6e38),_0x589e2a=bsSetupHelper['getAccessKey'](_0x1a6e38),_0x6e95d9=_0x149687[_0x5d33c0(0x125)](_0x117dfe,'')+':'+_0x149687[_0x5d33c0(0x125)](_0x589e2a,''),_0x229475=testhubUtils[_0x5d33c0(0x146)](_0x1a6e38);process[_0x5d33c0(0x187)]['BROWSERSTACK_PRODUCT_MAP']=JSON['stringify'](_0x229475);if(_0x149687['drTVd'](_0x6e95d9,':'))return _0x149687[_0x5d33c0(0x19d)](isTestObservabilitySession)&&(logger[_0x5d33c0(0x168)](_0x149687['IJSDo']),process[_0x5d33c0(0x187)][_0x5d33c0(0x134)]=_0x149687[_0x5d33c0(0x12f)]),testhubUtils[_0x5d33c0(0x17d)](_0x1a6e38)&&logger[_0x5d33c0(0x168)](_0x149687[_0x5d33c0(0x14b)]),[null,null];try{const _0x2df1f2=await this[_0x5d33c0(0x18a)](_0x1a6e38,_0x211612),_0x291b21=this[_0x5d33c0(0x14a)](_0x117dfe,_0x589e2a),_0x2c3256=await _0x149687[_0x5d33c0(0x183)](nodeRequest,_0x149687['gQDvY'],testHubConstants[_0x5d33c0(0x170)],_0x2df1f2,_0x291b21),_0x3b412b=this['extractDataFromResponse'](_0x1a6e38,_0x2c3256,_0x291b21);return await this['checkAndSetupPercy'](_0x4d3f64,_0x211612),_0x3b412b;}catch(_0x3d9815){if(_0x149687[_0x5d33c0(0x12c)](_0x3d9815[_0x5d33c0(0x182)],![])){testhubUtils[_0x5d33c0(0x132)](_0x3d9815);return;}}})();}static async[a90_0xc55cd4(0x12d)](){const _0x57b7fa=a90_0xc55cd4,_0x18a169={'PLvir':function(_0x792e69,_0x594ff5,_0x36d193){return _0x792e69(_0x594ff5,_0x36d193);},'jPZKS':function(_0x52ac9d,_0x38957f){return _0x52ac9d(_0x38957f);},'siiSB':function(_0x1755e7){return _0x1755e7();},'puHFh':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x38dfb0=TestDetails[_0x57b7fa(0x194)]();_0x38dfb0[_0x57b7fa(0x16f)](({testUId:_0x37212d,filePath:_0xc23fe7})=>{const _0x41955a=_0x57b7fa;var _0x2a2363=_0x18a169[_0x41955a(0x198)](uploadTraceZip,_0xc23fe7,_0x37212d);_0x18a169[_0x41955a(0x129)](addEvent,_0x2a2363);});try{await _0x18a169[_0x57b7fa(0x16b)](awaitAllEvents),logger[_0x57b7fa(0x168)](_0x18a169[_0x57b7fa(0x16e)]),processedTraceZips=!![];}catch(_0x418657){logger[_0x57b7fa(0x173)]('Error\x20while\x20waiting\x20for\x20events:\x20'+util['format'](_0x418657));}}static async[a90_0xc55cd4(0x17a)](_0x59fefc,_0x3c1fc9){const _0x1c6854=a90_0xc55cd4;if(constants[_0x1c6854(0x172)][_0x1c6854(0x159)](_0x3c1fc9)){await _0x59fefc[_0x1c6854(0x181)]();return;}_0x59fefc['config'][_0x1c6854(0x13c)]&&logger[_0x1c6854(0x168)]('Percy\x20is\x20not\x20supported\x20for\x20'+_0x3c1fc9+'\x20framework');}static[a90_0xc55cd4(0x193)](_0x39f2dc){const _0xdd7c1c=a90_0xc55cd4,_0x596198={};_0x596198[_0xdd7c1c(0x18f)]=_0x39f2dc['accessibilityOptions'];const _0x5f4265=_0x596198;return _0x5f4265;}static[a90_0xc55cd4(0x14a)](_0x5d1a44,_0x34f1ea){const _0x4901bd=a90_0xc55cd4,_0xcea021={'AZUDs':function(_0x235c54,_0x49291c){return _0x235c54(_0x49291c);}},_0xe97867={};return _0xe97867[_0x4901bd(0x128)]=_0x5d1a44,_0xe97867[_0x4901bd(0x138)]=_0x34f1ea,{'auth':_0xe97867,'headers':_0xcea021[_0x4901bd(0x13f)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x362486,_0x9c8ca0){const _0x7fb122=a90_0xc55cd4,_0x2c305e={'gBMjw':function(_0x3c1ea0,_0x3dcfcc){return _0x3c1ea0(_0x3dcfcc);}},_0x4565ee={'project_name':_0x362486[_0x7fb122(0x161)]||'','name':_0x362486[_0x7fb122(0x162)]||path[_0x7fb122(0x12e)](path[_0x7fb122(0x176)](process['cwd']())),'build_identifier':_0x362486['buildIdentifier'],'description':_0x362486[_0x7fb122(0x195)]||'','started_at':new Date()[_0x7fb122(0x15c)](),'tags':_0x2c305e[_0x7fb122(0x140)](getCustomTags,_0x362486),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x7fb122(0x12a)](),'build_run_identifier':process[_0x7fb122(0x187)][_0x7fb122(0x144)],'failed_tests_rerun':process[_0x7fb122(0x187)][_0x7fb122(0x13a)]||![],'version_control':await bsSetupHelper[_0x7fb122(0x145)](),'accessibility':this['getAccessibilityOptions'](_0x362486),'framework_details':testhubUtils['getFrameworkDetails'](_0x362486,_0x9c8ca0),'product_map':testhubUtils[_0x7fb122(0x146)](_0x362486),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra'](),'grouping_identifier':process[_0x7fb122(0x187)][_0x7fb122(0x18d)]};if(bsSetupHelper['getCentralUser']()[_0x7fb122(0x1a0)]||bsSetupHelper['getCentralUser']()[_0x7fb122(0x14d)]){const _0x4ee760={};_0x4ee760[_0x7fb122(0x15a)]=process['env']['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0x4ee760[_0x7fb122(0x167)]=process[_0x7fb122(0x187)][_0x7fb122(0x15f)],_0x4565ee['central_scanner']=_0x4ee760;}return _0x4565ee;}static[a90_0xc55cd4(0x17b)](_0x162a6d,_0x4ae98c,_0x79be42){const _0x35dcc0=a90_0xc55cd4,_0x433b29={'tDhpE':function(_0xd64ce2){return _0xd64ce2();},'VwmFB':function(_0x2000eb,_0x5140dd){return _0x2000eb&&_0x5140dd;},'ydsXE':_0x35dcc0(0x17f),'ObjJf':_0x35dcc0(0x156),'FJEAO':function(_0x264859,_0x56cb14){return _0x264859&&_0x56cb14;}},_0x482972={};if(_0x433b29['tDhpE'](isTestObservabilitySession)){const [_0x1a994b,_0x4ac9c9,_0x2a3c9b]=testhubUtils[_0x35dcc0(0x1a5)](_0x4ae98c[_0x35dcc0(0x16c)],_0x79be42[_0x35dcc0(0x191)]);if(_0x433b29[_0x35dcc0(0x18b)](_0x1a994b,_0x4ac9c9)){const _0x3b997b={};_0x3b997b['jwt']=_0x1a994b,_0x3b997b[_0x35dcc0(0x19b)]=_0x4ac9c9,_0x3b997b['allowScreenshot']=_0x2a3c9b,_0x482972[testHubConstants[_0x35dcc0(0x13e)]]=_0x3b997b,process[_0x35dcc0(0x187)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x433b29[_0x35dcc0(0x15d)];}else _0x482972[testHubConstants[_0x35dcc0(0x13e)]]={},process[_0x35dcc0(0x187)][_0x35dcc0(0x133)]=_0x433b29['ObjJf'];}else process[_0x35dcc0(0x187)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x433b29['ObjJf'];if(testhubUtils[_0x35dcc0(0x17d)](_0x162a6d)){const [_0x24f9ae,_0x4c8539]=testhubUtils['setAccessibilityVariables'](_0x4ae98c[_0x35dcc0(0x16c)]);if(_0x433b29[_0x35dcc0(0x188)](_0x24f9ae,_0x4c8539)){const _0x3d42bb={};_0x3d42bb[_0x35dcc0(0x1a1)]=_0x24f9ae,_0x3d42bb[_0x35dcc0(0x19b)]=_0x4c8539,_0x482972[testHubConstants[_0x35dcc0(0x143)]]=_0x3d42bb,process[_0x35dcc0(0x187)][_0x35dcc0(0x190)]=_0x433b29[_0x35dcc0(0x15d)];}else _0x482972[testHubConstants[_0x35dcc0(0x143)]]={},process[_0x35dcc0(0x187)][_0x35dcc0(0x190)]=_0x433b29['ObjJf'];}else process[_0x35dcc0(0x187)]['BROWSERSTACK_ACCESSIBILITY']=_0x433b29[_0x35dcc0(0x149)];return testhubUtils[_0x35dcc0(0x1a3)](_0x4ae98c['data']),logger[_0x35dcc0(0x139)](_0x35dcc0(0x142)+process[_0x35dcc0(0x187)][_0x35dcc0(0x14e)]),_0x482972;}static async[a90_0xc55cd4(0x178)](_0x48615d){const _0x1fd94a=a90_0xc55cd4,_0x26f74a={'hiuXL':function(_0x550c56,_0x4ee71e){return _0x550c56===_0x4ee71e;},'pRsmY':_0x1fd94a(0x156),'IdYiN':'null','LKSUG':function(_0x5a42af,_0x346f4c){return _0x5a42af===_0x346f4c;},'SGhvf':_0x1fd94a(0x14c),'byEXD':_0x1fd94a(0x173),'fTrzg':_0x1fd94a(0x179),'mWMiW':'finished_metadata','Nmvuj':_0x1fd94a(0x160),'xcDvs':function(_0x4b6fb5){return _0x4b6fb5();},'LOABt':function(_0xff99e4,_0x1fb344,_0x293ce2,_0x3f2c6d,_0x164908,_0xca3abf){return _0xff99e4(_0x1fb344,_0x293ce2,_0x3f2c6d,_0x164908,_0xca3abf);},'KzHRJ':_0x1fd94a(0x1a2),'clbAs':_0x1fd94a(0x164),'fScMy':'success'};await this[_0x1fd94a(0x12d)](),await PerformanceTester[_0x1fd94a(0x153)](PerformanceEvents[_0x1fd94a(0x150)],async()=>{const _0x5c1e04=_0x1fd94a;if(_0x26f74a['hiuXL'](process[_0x5c1e04(0x187)][_0x5c1e04(0x134)],_0x26f74a['pRsmY'])||TestHubHandler[_0x5c1e04(0x136)]||bsSetupHelper[_0x5c1e04(0x152)](process['env'][testHubConstants[_0x5c1e04(0x180)][_0x5c1e04(0x196)]]))return;TestHubHandler[_0x5c1e04(0x136)]=!![],await RequestQueueHandler[_0x5c1e04(0x147)]()[_0x5c1e04(0x192)](),await SessionHandler[_0x5c1e04(0x197)]();if(_0x26f74a['hiuXL'](process['env'][testHubConstants[_0x5c1e04(0x180)]['BROWSERSTACK_TESTHUB_JWT']],_0x26f74a[_0x5c1e04(0x184)])||_0x26f74a[_0x5c1e04(0x1a4)](process[_0x5c1e04(0x187)][testHubConstants[_0x5c1e04(0x180)]['BROWSERSTACK_TESTHUB_UUID']],_0x26f74a[_0x5c1e04(0x184)])){logger[_0x5c1e04(0x168)](_0x26f74a[_0x5c1e04(0x130)]);const _0x58ddd6={};return _0x58ddd6['status']=_0x26f74a['byEXD'],_0x58ddd6[_0x5c1e04(0x12b)]=_0x26f74a[_0x5c1e04(0x155)],_0x58ddd6;}const _0x4bb151={'finished_at':new Date()['toISOString'](),'finished_metadata':[]};!!_0x48615d&&_0x4bb151[_0x26f74a[_0x5c1e04(0x165)]][_0x5c1e04(0x19e)]({'reason':_0x26f74a['Nmvuj'],'signal':_0x48615d,'failure_data':''});const _0x2d371a={'headers':_0x26f74a['xcDvs'](getDefaultHeaders)};try{const _0x2f57c7=await _0x26f74a[_0x5c1e04(0x13d)](nodeRequest,_0x26f74a[_0x5c1e04(0x174)],'api/v1/builds/'+process['env'][testHubConstants[_0x5c1e04(0x180)][_0x5c1e04(0x14e)]]+_0x5c1e04(0x157),_0x4bb151,_0x2d371a,![]);if(_0x2f57c7[_0x5c1e04(0x16c)]&&_0x2f57c7[_0x5c1e04(0x16c)]['error']){const _0x45fa16={};_0x45fa16['message']=_0x2f57c7['data']['error'];throw _0x45fa16;}else{logger[_0x5c1e04(0x168)](_0x26f74a[_0x5c1e04(0x171)]);const _0x4cb00d={};return _0x4cb00d[_0x5c1e04(0x163)]=_0x26f74a[_0x5c1e04(0x189)],_0x4cb00d['message']='',_0x4cb00d;}}catch(_0x2ba867){_0x2ba867[_0x5c1e04(0x19c)]?logger[_0x5c1e04(0x168)](_0x5c1e04(0x13b)+_0x2ba867[_0x5c1e04(0x19c)][_0x5c1e04(0x163)]+'\x20'+_0x2ba867['response'][_0x5c1e04(0x131)]+'\x20'+JSON[_0x5c1e04(0x154)](_0x2ba867['response']['data'])):logger[_0x5c1e04(0x168)](_0x5c1e04(0x13b)+(_0x2ba867['message']||_0x2ba867));const _0x25f46d={};return _0x25f46d['status']=_0x26f74a[_0x5c1e04(0x177)],_0x25f46d[_0x5c1e04(0x12b)]=_0x2ba867[_0x5c1e04(0x12b)]||_0x2ba867[_0x5c1e04(0x19c)]?_0x2ba867[_0x5c1e04(0x19c)][_0x5c1e04(0x163)]+':'+_0x2ba867[_0x5c1e04(0x19c)]['statusText']:_0x2ba867,_0x25f46d;}})();}}module[a90_0xc55cd4(0x127)]=TestHubHandler;
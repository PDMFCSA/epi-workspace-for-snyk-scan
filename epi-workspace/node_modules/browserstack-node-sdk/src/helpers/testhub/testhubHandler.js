const a129_0x39a458=a129_0x5214;(function(_0x23e674,_0x4ba8a9){const _0x5c9482=a129_0x5214,_0x2e0291=_0x23e674();while(!![]){try{const _0xfc6510=parseInt(_0x5c9482(0x1c3))/0x1+parseInt(_0x5c9482(0x17d))/0x2+-parseInt(_0x5c9482(0x178))/0x3+parseInt(_0x5c9482(0x184))/0x4+parseInt(_0x5c9482(0x147))/0x5*(-parseInt(_0x5c9482(0x171))/0x6)+parseInt(_0x5c9482(0x181))/0x7*(-parseInt(_0x5c9482(0x170))/0x8)+-parseInt(_0x5c9482(0x193))/0x9;if(_0xfc6510===_0x4ba8a9)break;else _0x2e0291['push'](_0x2e0291['shift']());}catch(_0x3f0e72){_0x2e0291['push'](_0x2e0291['shift']());}}}(a129_0x5c78,0xa6770));function a129_0x5214(_0x3ec90a,_0x40cf71){const _0x5c78cc=a129_0x5c78();return a129_0x5214=function(_0x52140b,_0x326889){_0x52140b=_0x52140b-0x134;let _0x2f31f3=_0x5c78cc[_0x52140b];return _0x2f31f3;},a129_0x5214(_0x3ec90a,_0x40cf71);}const bsSetupHelper=require(a129_0x39a458(0x16a)),path=require(a129_0x39a458(0x159)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a129_0x39a458(0x164)),testhubUtils=require(a129_0x39a458(0x13c)),testHubConstants=require(a129_0x39a458(0x13f)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require('../logger')[a129_0x39a458(0x157)],SessionHandler=require(a129_0x39a458(0x17c)),PerformanceTester=require(a129_0x39a458(0x163)),{TESTHUB_EVENTS:PerformanceEvents}=require(a129_0x39a458(0x1a5)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),{uploadTraceZip}=require(a129_0x39a458(0x199)),{isTurboScaleSession}=require(a129_0x39a458(0x1a6)),BrowserstackCLI=require(a129_0x39a458(0x1bd)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x28920c=>{const _0x510694=a129_0x39a458;OngoingEvents[_0x510694(0x1c2)](_0x28920c);},awaitAllEvents=async()=>{const _0x58d7d6=a129_0x39a458;return Promise[_0x58d7d6(0x187)](OngoingEvents);};class TestHubHandler{static [a129_0x39a458(0x19a)]=![];static async['launchBuild'](_0x4b3e10,_0x39b8a8){const _0x46ca50=a129_0x39a458,_0x27c79e={'YsrXG':function(_0x3869c0,_0x586d94){return _0x3869c0||_0x586d94;},'gAmdt':function(_0x1eb2e7,_0x59df36){return _0x1eb2e7===_0x59df36;},'whTcY':function(_0x33d38f){return _0x33d38f();},'swFtR':_0x46ca50(0x16f),'SRKDk':'false','XgSZW':_0x46ca50(0x19b),'tPbtQ':function(_0x4a4528,_0x2cc53f,_0x1e5fd3,_0x349955,_0x467087){return _0x4a4528(_0x2cc53f,_0x1e5fd3,_0x349955,_0x467087);},'QUziK':_0x46ca50(0x194),'NvKNa':function(_0x1e008a,_0x2417f1){return _0x1e008a===_0x2417f1;},'bzZzO':_0x46ca50(0x158),'lYXaq':'true','jlTdy':function(_0xd9b027,_0x4f1d54){return _0xd9b027===_0x4f1d54;}};await PerformanceTester[_0x46ca50(0x1a3)](PerformanceEvents['START'],async()=>{const _0x4c0672=_0x46ca50,_0x526484=Object[_0x4c0672(0x13e)]({},_0x39b8a8[_0x4c0672(0x1b6)],{'root_dir_path':'','framework':_0x39b8a8[_0x4c0672(0x1af)]}),_0x171e96=bsSetupHelper[_0x4c0672(0x1b8)](_0x526484),_0x2737f5=bsSetupHelper['getAccessKey'](_0x526484),_0x67ee1f=_0x27c79e[_0x4c0672(0x15b)](_0x171e96,'')+':'+_0x27c79e[_0x4c0672(0x15b)](_0x2737f5,''),_0x50e914=testhubUtils[_0x4c0672(0x17a)](_0x526484);process[_0x4c0672(0x16e)][_0x4c0672(0x1c4)]=JSON[_0x4c0672(0x151)](_0x50e914);if(_0x27c79e['gAmdt'](_0x67ee1f,':'))return _0x27c79e[_0x4c0672(0x1ab)](isTestObservabilitySession)&&(logger[_0x4c0672(0x1b1)](_0x27c79e[_0x4c0672(0x146)]),process['env'][_0x4c0672(0x148)]=_0x27c79e[_0x4c0672(0x13b)]),testhubUtils[_0x4c0672(0x182)](_0x526484)&&logger[_0x4c0672(0x1b1)](_0x27c79e['XgSZW']),[null,null];try{const _0x39c972=await this[_0x4c0672(0x1c5)](_0x526484,_0x4b3e10),_0x46f8d2=this[_0x4c0672(0x1b4)](_0x171e96,_0x2737f5),_0x54095d=await _0x27c79e['tPbtQ'](nodeRequest,_0x27c79e[_0x4c0672(0x14a)],testHubConstants[_0x4c0672(0x1bf)],_0x39c972,_0x46f8d2),_0x5ba443=this['extractDataFromResponse'](_0x526484,_0x54095d,_0x46f8d2);await this[_0x4c0672(0x1b5)](_0x39b8a8,_0x4b3e10);if(_0x27c79e[_0x4c0672(0x150)](testhubUtils['getAccessibilityValueFromYml'](_0x39b8a8['config']),null)){const _0x323a9b=_0x5ba443[_0x27c79e[_0x4c0672(0x1be)]];_0x323a9b&&_0x323a9b[_0x4c0672(0x154)]&&_0x323a9b[_0x4c0672(0x167)]&&(_0x39b8a8[_0x4c0672(0x1b6)]['accessibility']=!![],process[_0x4c0672(0x16e)][_0x4c0672(0x137)]=_0x27c79e['lYXaq']);}return _0x5ba443;}catch(_0x3051d0){if(_0x27c79e[_0x4c0672(0x165)](_0x3051d0[_0x4c0672(0x1aa)],![])){testhubUtils[_0x4c0672(0x1c1)](_0x3051d0);return;}}})();}static async[a129_0x39a458(0x1c7)](){const _0x25ca17=a129_0x39a458,_0x3863d7={'GKcoU':function(_0x2f26cb,_0x239790,_0x375c15){return _0x2f26cb(_0x239790,_0x375c15);},'HmiIS':function(_0x2cf6f6,_0x298de8){return _0x2cf6f6(_0x298de8);},'GYyFi':function(_0x424e38){return _0x424e38();},'JMOfs':_0x25ca17(0x192)};if(processedTraceZips)return;const _0x3491ef=TestDetails[_0x25ca17(0x18f)]();_0x3491ef['forEach'](({testUId:_0x37f330,filePath:_0x57dd60})=>{var _0x22e0fc=_0x3863d7['GKcoU'](uploadTraceZip,_0x57dd60,_0x37f330);_0x3863d7['HmiIS'](addEvent,_0x22e0fc);});try{await _0x3863d7[_0x25ca17(0x155)](awaitAllEvents),logger[_0x25ca17(0x1b1)](_0x3863d7[_0x25ca17(0x16c)]),processedTraceZips=!![];}catch(_0x3be71e){logger[_0x25ca17(0x161)](_0x25ca17(0x19f)+util['format'](_0x3be71e));}}static async[a129_0x39a458(0x1b5)](_0xf6463,_0x4142ba){const _0x418a15=a129_0x39a458;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x418a15(0x177)](_0x4142ba)){await _0xf6463[_0x418a15(0x144)]();return;}_0xf6463[_0x418a15(0x1b6)][_0x418a15(0x156)]&&logger[_0x418a15(0x1b1)](_0x418a15(0x18c)+_0x4142ba+_0x418a15(0x19e));}static[a129_0x39a458(0x1b3)](_0x11006a){const _0x18ca5a=a129_0x39a458,_0x1d1904={'KGnbr':function(_0x4df037,_0x43f788){return _0x4df037(_0x43f788);},'qhXwP':_0x18ca5a(0x16b)};let _0x3a8564;if(_0x11006a[_0x18ca5a(0x18e)]){const _0x4d0df2={};_0x4d0df2['settings']=_0x11006a[_0x18ca5a(0x18e)],_0x3a8564=_0x4d0df2;}else{const _0x1231c7={};_0x1231c7[_0x18ca5a(0x1a8)]={},_0x3a8564=_0x1231c7;}if((!bsSetupHelper['isBrowserstackInfra']()||_0x1d1904[_0x18ca5a(0x14d)](isTurboScaleSession,_0x11006a))&&testhubUtils['isAccessibilityEnabled'](_0x11006a)){const _0xc8fa3f={};_0xc8fa3f[_0x18ca5a(0x176)]=_0x1d1904[_0x18ca5a(0x191)],Object[_0x18ca5a(0x13e)](_0x3a8564[_0x18ca5a(0x1a8)],_0xc8fa3f);}return _0x3a8564;}static['getConfig'](_0x454303,_0x4e666c){const _0x15d914=a129_0x39a458,_0x3218f8={'rDdFh':function(_0xcf02d8,_0x1178bf){return _0xcf02d8(_0x1178bf);}},_0x3db2e7={};return _0x3db2e7[_0x15d914(0x19d)]=_0x454303,_0x3db2e7['password']=_0x4e666c,{'auth':_0x3db2e7,'headers':_0x3218f8[_0x15d914(0x18a)](getDefaultHeaders,![])};}static async[a129_0x39a458(0x1c5)](_0x226bf3,_0x11e606){const _0x495e65=a129_0x39a458,_0x2cd9ad={'KPORZ':'Generating\x20build\x20upstream\x20data\x20for\x20TestHub','xjqzU':function(_0x1888ef,_0xc86a62){return _0x1888ef(_0xc86a62);}};logger['debug'](_0x2cd9ad['KPORZ']);const _0x3f6275={'project_name':_0x226bf3['projectName']||'','name':_0x226bf3[_0x495e65(0x152)]||path['basename'](path['resolve'](process[_0x495e65(0x142)]())),'build_identifier':_0x226bf3[_0x495e65(0x1b7)],'description':_0x226bf3[_0x495e65(0x175)]||'','started_at':new Date()[_0x495e65(0x173)](),'tags':_0x2cd9ad[_0x495e65(0x186)](getCustomTags,_0x226bf3),'host_info':bsSetupHelper[_0x495e65(0x13a)](),'ci_info':bsSetupHelper[_0x495e65(0x1b9)](),'build_run_identifier':process[_0x495e65(0x16e)][_0x495e65(0x135)],'failed_tests_rerun':process[_0x495e65(0x16e)][_0x495e65(0x15c)]||![],'linked_build_uuid':process[_0x495e65(0x16e)][_0x495e65(0x14b)]||'','version_control':await bsSetupHelper[_0x495e65(0x15f)](),'accessibility':this[_0x495e65(0x1b3)](_0x226bf3),'framework_details':testhubUtils[_0x495e65(0x153)](_0x226bf3,_0x11e606),'product_map':testhubUtils[_0x495e65(0x1c6)](_0x226bf3),'browserstackAutomation':bsSetupHelper[_0x495e65(0x1c8)](),'grouping_identifier':process[_0x495e65(0x16e)][_0x495e65(0x138)],'test_orchestration':testhubUtils[_0x495e65(0x15a)](_0x226bf3)};if(bsSetupHelper['getCentralUser']()[_0x495e65(0x13d)]||bsSetupHelper[_0x495e65(0x197)]()[_0x495e65(0x196)]){const _0x1c6239={};_0x1c6239[_0x495e65(0x1a9)]=process[_0x495e65(0x16e)][_0x495e65(0x162)],_0x1c6239['token']=process[_0x495e65(0x16e)]['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x3f6275[_0x495e65(0x13d)]=_0x1c6239;}return _0x3f6275;}static[a129_0x39a458(0x179)](_0x52b6ac,_0x54ef59,_0x4ef27e){const _0x2487e4=a129_0x39a458,_0x48110b={'HLdZp':function(_0x2f59e0){return _0x2f59e0();},'CMxRk':function(_0x1d31e3,_0x37bd9c){return _0x1d31e3&&_0x37bd9c;},'vpRWY':'true','PABQw':'false','vVKuz':function(_0xe5fc7d,_0x2efbf0){return _0xe5fc7d&&_0x2efbf0;}},_0x469ec7={};if(_0x48110b[_0x2487e4(0x1a0)](isTestObservabilitySession)){const [_0x41044b,_0x23d628,_0x5e486d]=testhubUtils[_0x2487e4(0x1b2)](_0x54ef59[_0x2487e4(0x190)],_0x4ef27e[_0x2487e4(0x149)]);if(_0x48110b[_0x2487e4(0x139)](_0x41044b,_0x23d628)){const _0x4d7ed4={};_0x4d7ed4[_0x2487e4(0x180)]=_0x41044b,_0x4d7ed4[_0x2487e4(0x167)]=_0x23d628,_0x4d7ed4[_0x2487e4(0x15d)]=_0x5e486d,_0x469ec7[testHubConstants[_0x2487e4(0x1ae)]]=_0x4d7ed4,process[_0x2487e4(0x16e)][_0x2487e4(0x166)]=_0x48110b[_0x2487e4(0x172)];}else _0x469ec7[testHubConstants[_0x2487e4(0x1ae)]]={},process['env'][_0x2487e4(0x166)]=_0x48110b[_0x2487e4(0x141)];}else process['env'][_0x2487e4(0x166)]=_0x48110b['PABQw'];const [_0x3cbe35,_0x579daf]=testhubUtils['setAccessibilityVariables'](_0x54ef59[_0x2487e4(0x190)]);if(_0x48110b[_0x2487e4(0x174)](_0x3cbe35,_0x579daf)){const _0x4f67ca={};_0x4f67ca[_0x2487e4(0x154)]=_0x3cbe35,_0x4f67ca[_0x2487e4(0x167)]=_0x579daf,_0x469ec7[testHubConstants[_0x2487e4(0x183)]]=_0x4f67ca,process[_0x2487e4(0x16e)]['BROWSERSTACK_ACCESSIBILITY']=_0x48110b[_0x2487e4(0x172)];}else _0x469ec7[testHubConstants[_0x2487e4(0x183)]]={},process[_0x2487e4(0x16e)][_0x2487e4(0x18d)]=_0x48110b[_0x2487e4(0x141)];return testhubUtils[_0x2487e4(0x169)](_0x54ef59[_0x2487e4(0x190)]),logger[_0x2487e4(0x136)](_0x2487e4(0x1ac)+process[_0x2487e4(0x16e)][_0x2487e4(0x17b)]),_0x469ec7;}static async['stop'](_0x697989){const _0x39d4fa=a129_0x39a458,_0x3fecf8={'QUamr':function(_0x12c71f,_0x100f11){return _0x12c71f===_0x100f11;},'hKCig':_0x39d4fa(0x14f),'URZvb':function(_0x15e95a,_0x2700d3){return _0x15e95a===_0x2700d3;},'pjIzF':_0x39d4fa(0x195),'cVaOI':function(_0x1c06d2,_0x128301){return _0x1c06d2===_0x128301;},'wBByP':_0x39d4fa(0x143),'ASakh':_0x39d4fa(0x161),'gXVIu':_0x39d4fa(0x16d),'ATcoi':'finished_metadata','xUKZB':'user_killed','cghOR':function(_0x92b095){return _0x92b095();},'SvmoQ':function(_0x36d6d1,_0x5a7549,_0x274ea0,_0x105953,_0xc49cb7,_0x197678){return _0x36d6d1(_0x5a7549,_0x274ea0,_0x105953,_0xc49cb7,_0x197678);},'ZzVZs':_0x39d4fa(0x1a4),'mxgUa':_0x39d4fa(0x15e),'GuLiF':_0x39d4fa(0x1aa)};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x39d4fa(0x185)],async()=>{const _0x16ae5a=_0x39d4fa;if(_0x3fecf8['QUamr'](process[_0x16ae5a(0x16e)][_0x16ae5a(0x148)],_0x3fecf8[_0x16ae5a(0x189)])||TestHubHandler[_0x16ae5a(0x19a)]||bsSetupHelper['isUndefined'](process[_0x16ae5a(0x16e)][testHubConstants[_0x16ae5a(0x145)][_0x16ae5a(0x19c)]]))return;TestHubHandler[_0x16ae5a(0x19a)]=!![];if(BrowserstackCLI[_0x16ae5a(0x1a2)]()['isRunning']())return;await this['processTraceZips'](),await RequestQueueHandler['getInstance']()[_0x16ae5a(0x134)](),await SessionHandler[_0x16ae5a(0x17f)]();if(_0x3fecf8[_0x16ae5a(0x17e)](process[_0x16ae5a(0x16e)][testHubConstants['ENV_VAR'][_0x16ae5a(0x19c)]],_0x3fecf8[_0x16ae5a(0x168)])||_0x3fecf8['cVaOI'](process['env'][testHubConstants[_0x16ae5a(0x145)][_0x16ae5a(0x17b)]],_0x3fecf8[_0x16ae5a(0x168)])){logger[_0x16ae5a(0x1b1)](_0x3fecf8[_0x16ae5a(0x14e)]);const _0x15b3d9={};return _0x15b3d9[_0x16ae5a(0x140)]=_0x3fecf8[_0x16ae5a(0x1b0)],_0x15b3d9['message']=_0x3fecf8[_0x16ae5a(0x1ba)],_0x15b3d9;}const _0x158d03={'finished_at':new Date()[_0x16ae5a(0x173)](),'finished_metadata':[]};!!_0x697989&&_0x158d03[_0x3fecf8[_0x16ae5a(0x188)]]['push']({'reason':_0x3fecf8[_0x16ae5a(0x1bc)],'signal':_0x697989,'failure_data':''});const _0x507fe3={'headers':_0x3fecf8[_0x16ae5a(0x1a7)](getDefaultHeaders)};try{const _0x535020=await _0x3fecf8[_0x16ae5a(0x1c0)](nodeRequest,_0x3fecf8['ZzVZs'],_0x16ae5a(0x14c)+process[_0x16ae5a(0x16e)][testHubConstants[_0x16ae5a(0x145)][_0x16ae5a(0x17b)]]+_0x16ae5a(0x18b),_0x158d03,_0x507fe3,![]);if(_0x535020['data']&&_0x535020[_0x16ae5a(0x190)][_0x16ae5a(0x161)]){const _0x528c09={};_0x528c09['message']=_0x535020[_0x16ae5a(0x190)][_0x16ae5a(0x161)];throw _0x528c09;}else{logger[_0x16ae5a(0x1b1)](_0x3fecf8[_0x16ae5a(0x198)]);const _0x172209={};return _0x172209['status']=_0x3fecf8['GuLiF'],_0x172209[_0x16ae5a(0x1a1)]='',_0x172209;}}catch(_0x3e371b){_0x3e371b['response']?logger[_0x16ae5a(0x1b1)](_0x16ae5a(0x160)+_0x3e371b[_0x16ae5a(0x1bb)]['status']+'\x20'+_0x3e371b[_0x16ae5a(0x1bb)][_0x16ae5a(0x1ad)]+'\x20'+JSON['stringify'](_0x3e371b[_0x16ae5a(0x1bb)][_0x16ae5a(0x190)])):logger[_0x16ae5a(0x1b1)](_0x16ae5a(0x160)+(_0x3e371b['message']||_0x3e371b));const _0x203866={};return _0x203866[_0x16ae5a(0x140)]=_0x3fecf8[_0x16ae5a(0x1b0)],_0x203866[_0x16ae5a(0x1a1)]=_0x3e371b['message']||_0x3e371b[_0x16ae5a(0x1bb)]?_0x3e371b[_0x16ae5a(0x1bb)][_0x16ae5a(0x140)]+':'+_0x3e371b[_0x16ae5a(0x1bb)][_0x16ae5a(0x1ad)]:_0x3e371b,_0x203866;}})();}}function a129_0x5c78(){const _0x179b52=['lcnc','getCentralUser','mxgUa','../../bin/playwright/reporter/pwUtils.js','buildStopSent','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','BROWSERSTACK_TESTHUB_JWT','username','\x20framework','Error\x20while\x20waiting\x20for\x20events:\x20','HLdZp','message','getInstance','measureWrapper','PUT','../performance/constants','../helper.js','cghOR','settings','job_id','success','whTcY','Testhub\x20started\x20with\x20id:\x20','statusText','OBSERVABILITY','framework','ASakh','debug','setTestObservabilityVariables','getAccessibilityOptions','getConfig','checkAndSetupPercy','config','buildIdentifier','getUserName','getCiInfo','gXVIu','response','xUKZB','../../bin/v2/browserstackCLI','bzZzO','TESTHUB_BUILD_API','SvmoQ','logBuildError','add','1208446HbytfB','BROWSERSTACK_PRODUCT_MAP','generateBuildUpstreamData','getProductMapForBuildStartCall','processTraceZips','isBrowserstackInfra','uploadPending','BROWSERSTACK_BUILD_RUN_IDENTIFIER','info','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','CMxRk','getHostInfo','SRKDk','./utils.js','central_scanner','assign','./constants.js','status','PABQw','cwd','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','setupPercy','ENV_VAR','swFtR','845nGBUNq','BS_TESTOPS_BUILD_COMPLETED','auth','QUziK','BROWSERSTACK_LINKED_BUILD_UUID','api/v1/builds/','KGnbr','wBByP','false','NvKNa','stringify','buildName','getFrameworkDetails','authToken','GYyFi','percy','winstonLogger','accessibility','path','getTestOrchestrationBuildStartData','YsrXG','BROWSERSTACK_RERUN','allowScreenshot','stopBuildUpstream\x20event\x20successful!','getGitMetaData','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','error','BROWSERSTACK_CENTRAL_SCANNER_JOBID','../performance/performance-tester.js','../test-observability/utils','jlTdy','BROWSERSTACK_TEST_OBSERVABILITY','buildHashedId','pjIzF','setTestHubCommonMetaInfo','../helper','true','JMOfs','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','env','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','7096tyGKjF','9030zcTgLs','vpRWY','toISOString','vVKuz','buildDescription','includeEncodedExtension','includes','537129qwBWIj','extractDataFromResponse','getProductMap','BROWSERSTACK_TESTHUB_UUID','../test-observability/sessionHandler.js','1618552XgfUfi','URZvb','waitForBuildStatus','jwt','8708CoVHpU','isAccessibilityEnabled','ACCESSIBILITY','4928216JIdjEx','STOP','xjqzU','allSettled','ATcoi','hKCig','rDdFh','/stop','Percy\x20is\x20not\x20supported\x20for\x20','BROWSERSTACK_ACCESSIBILITY','accessibilityOptions','getTraceFilePaths','data','qhXwP','All\x20trace\x20zip\x20send\x20events\x20complete','9280080jmsARv','POST','null'];a129_0x5c78=function(){return _0x179b52;};return a129_0x5c78();}module['exports']=TestHubHandler;
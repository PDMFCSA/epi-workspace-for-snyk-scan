const a89_0x2de2fd=a89_0x572a;(function(_0x44a3a2,_0x19e852){const _0xb7515b=a89_0x572a,_0x26a13e=_0x44a3a2();while(!![]){try{const _0x56a119=-parseInt(_0xb7515b(0x146))/0x1*(-parseInt(_0xb7515b(0x127))/0x2)+parseInt(_0xb7515b(0xf3))/0x3*(parseInt(_0xb7515b(0x143))/0x4)+-parseInt(_0xb7515b(0x13b))/0x5*(-parseInt(_0xb7515b(0xe2))/0x6)+parseInt(_0xb7515b(0x162))/0x7*(-parseInt(_0xb7515b(0x164))/0x8)+parseInt(_0xb7515b(0x15a))/0x9*(-parseInt(_0xb7515b(0x12c))/0xa)+-parseInt(_0xb7515b(0x122))/0xb*(parseInt(_0xb7515b(0xeb))/0xc)+-parseInt(_0xb7515b(0xe7))/0xd*(-parseInt(_0xb7515b(0x138))/0xe);if(_0x56a119===_0x19e852)break;else _0x26a13e['push'](_0x26a13e['shift']());}catch(_0x55b3a2){_0x26a13e['push'](_0x26a13e['shift']());}}}(a89_0x7915,0x30fc5));const bsSetupHelper=require('../helper'),path=require(a89_0x2de2fd(0x145)),util=require(a89_0x2de2fd(0x141)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a89_0x2de2fd(0x132)),testhubUtils=require('./utils.js'),testHubConstants=require(a89_0x2de2fd(0x161)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a89_0x2de2fd(0xf8)),logger=require(a89_0x2de2fd(0x108))[a89_0x2de2fd(0x11d)],SessionHandler=require(a89_0x2de2fd(0x144)),PerformanceTester=require(a89_0x2de2fd(0x153)),{TESTHUB_EVENTS:PerformanceEvents}=require(a89_0x2de2fd(0x13f)),TestDetails=require(a89_0x2de2fd(0x102)),{uploadTraceZip}=require(a89_0x2de2fd(0x137)),OngoingEvents=new Set();function a89_0x7915(){const _0x5c1adc=['buildDescription','add','BROWSERSTACK_BUILD_RUN_IDENTIFIER','../performance/performance-tester.js','getAccessibilityOptions','setAccessibilityVariables','password','POST','message','\x20framework','55368cWRekk','BROWSERSTACK_TESTHUB_UUID','extractDataFromResponse','debug','BROWSERSTACK_RERUN','generateBuildUpstreamData','env','./constants.js','1341613CuSknl','PUT','8feNfAa','GAKoK','buildName','resolve','VUhOy','Hskga','getConfig','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','stop','finished_metadata','pDIBL','GErcS','vxgaA','24WSXqTs','ACCESSIBILITY','framework','auth','info','2388373atjXzl','getAccessKey','BROWSERSTACK_TEST_OBSERVABILITY','success','31932HEMxWR','FgNcm','iIwdS','stopBuildUpstream\x20event\x20successful!','ENV_VAR','token','job_id','BdRes','3uYilYV','WLJgL','config','setTestObservabilityVariables','central_scanner','../test-observability/requestQueueHandler.js','error','GYWea','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','Error\x20while\x20waiting\x20for\x20events:\x20','false','OBSERVABILITY','cwd','wEiXY','BROWSERSTACK_ACCESSIBILITY','../../bin/playwright/reporter/test-details.js','NziuJ','KysZn','VdMFm','DFDtK','uploadPending','../logger','waitForBuildStatus','format','lwHCl','TPgEc','getFrameworkDetails','mHZpb','response','WufjU','BROWSERSTACK_CENTRAL_SCANNER_JWT','getTraceFilePaths','null','jwt','measureWrapper','BROWSERSTACK_TESTHUB_JWT','percy','api/v1/builds/','data','BROWSERSTACK_PRODUCT_MAP','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','getGitMetaData','winstonLogger','processTraceZips','buildHashedId','PERCY_SUPPORTED_FRAMEWORKS','allSettled','1023ufKoNw','launchBuild','username','accessibilityOptions','STOP','6110gSReNP','status','Percy\x20is\x20not\x20supported\x20for\x20','basename','exports','230GjZFNv','buildStopSent','forEach','START','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','getInstance','../test-observability/utils','settings','isUndefined','statusText','SHSRK','../../bin/playwright/reporter/pwUtils.js','28ZsGKcr','BS_TESTOPS_BUILD_COMPLETED','BNgqa','29930bBGQkK','checkAndSetupPercy','/stop','toISOString','../performance/constants','LKlsG','util','push','691928DgtnWX','../test-observability/sessionHandler.js','path','71RQeCHF','TdWEW','getProductMap','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','HYtSV','allowScreenshot','BROWSERSTACK_CENTRAL_SCANNER_JOBID','includes','SStgH','getHostInfo'];a89_0x7915=function(){return _0x5c1adc;};return a89_0x7915();}let processedTraceZips=![];const addEvent=_0xb18259=>{const _0x3b7e8f=a89_0x2de2fd;OngoingEvents[_0x3b7e8f(0x151)](_0xb18259);},awaitAllEvents=async()=>{const _0x3bf31a=a89_0x2de2fd;return Promise[_0x3bf31a(0x121)](OngoingEvents);};class TestHubHandler{static [a89_0x2de2fd(0x12d)]=![];static async[a89_0x2de2fd(0x123)](_0x253e4b,_0x33c9eb){const _0x4a5b5a=a89_0x2de2fd,_0x8d82a4={'SHSRK':function(_0x232237,_0x4bf6f1){return _0x232237||_0x4bf6f1;},'TdWEW':function(_0x80fc5e,_0x352e7a){return _0x80fc5e===_0x352e7a;},'TPgEc':function(_0x387953){return _0x387953();},'FddBZ':_0x4a5b5a(0x11b),'GErcS':_0x4a5b5a(0xfd),'BNgqa':_0x4a5b5a(0x149),'SStgH':function(_0x2aefa4,_0x40bcee,_0x1096f8,_0x3d3586,_0x1d02c2){return _0x2aefa4(_0x40bcee,_0x1096f8,_0x3d3586,_0x1d02c2);},'iIwdS':_0x4a5b5a(0x157),'GYWea':function(_0x1fe1fa,_0x583fcf){return _0x1fe1fa===_0x583fcf;}};await PerformanceTester[_0x4a5b5a(0x115)](PerformanceEvents[_0x4a5b5a(0x12f)],async()=>{const _0x50d3b0=_0x4a5b5a,_0x48a783=Object['assign']({},_0x33c9eb[_0x50d3b0(0xf5)],{'root_dir_path':'','framework':_0x33c9eb[_0x50d3b0(0xe4)]}),_0x239a3f=bsSetupHelper['getUserName'](_0x48a783),_0x34f693=bsSetupHelper[_0x50d3b0(0xe8)](_0x48a783),_0x2071d3=_0x8d82a4[_0x50d3b0(0x136)](_0x239a3f,'')+':'+_0x8d82a4[_0x50d3b0(0x136)](_0x34f693,''),_0x178918=testhubUtils[_0x50d3b0(0x148)](_0x48a783);process[_0x50d3b0(0x160)][_0x50d3b0(0x11a)]=JSON['stringify'](_0x178918);if(_0x8d82a4[_0x50d3b0(0x147)](_0x2071d3,':'))return _0x8d82a4[_0x50d3b0(0x10c)](isTestObservabilitySession)&&(logger[_0x50d3b0(0x15d)](_0x8d82a4['FddBZ']),process[_0x50d3b0(0x160)][_0x50d3b0(0x139)]=_0x8d82a4[_0x50d3b0(0xe0)]),testhubUtils['isAccessibilityEnabled'](_0x48a783)&&logger[_0x50d3b0(0x15d)](_0x8d82a4[_0x50d3b0(0x13a)]),[null,null];try{const _0x395a65=await this[_0x50d3b0(0x15f)](_0x48a783,_0x253e4b),_0xbb0a59=this[_0x50d3b0(0x16a)](_0x239a3f,_0x34f693),_0x4fa9ac=await _0x8d82a4[_0x50d3b0(0x14e)](nodeRequest,_0x8d82a4[_0x50d3b0(0xed)],testHubConstants['TESTHUB_BUILD_API'],_0x395a65,_0xbb0a59);await this['checkAndSetupPercy'](_0x33c9eb,_0x253e4b);const _0x10894e=this[_0x50d3b0(0x15c)](_0x48a783,_0x4fa9ac,_0xbb0a59);return _0x10894e;}catch(_0x454248){if(_0x8d82a4[_0x50d3b0(0xfa)](_0x454248[_0x50d3b0(0xea)],![])){testhubUtils['logBuildError'](_0x454248);return;}}})();}static async[a89_0x2de2fd(0x11e)](){const _0x5948c6=a89_0x2de2fd,_0x4cbd79={'uuGPW':function(_0x47c4a6,_0x10b2be,_0x18d44a){return _0x47c4a6(_0x10b2be,_0x18d44a);},'Hskga':function(_0x59dce7,_0x23fdf6){return _0x59dce7(_0x23fdf6);},'aqVmE':function(_0xd2b69b){return _0xd2b69b();},'BdRes':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x15888e=TestDetails[_0x5948c6(0x112)]();_0x15888e[_0x5948c6(0x12e)](({testUId:_0x2ffd61,filePath:_0x579ad5})=>{const _0x555d62=_0x5948c6;var _0x1b331d=_0x4cbd79['uuGPW'](uploadTraceZip,_0x579ad5,_0x2ffd61);_0x4cbd79[_0x555d62(0x169)](addEvent,_0x1b331d);});try{await _0x4cbd79['aqVmE'](awaitAllEvents),logger[_0x5948c6(0x15d)](_0x4cbd79[_0x5948c6(0xf2)]),processedTraceZips=!![];}catch(_0x1b2f5c){logger['error'](_0x5948c6(0xfc)+util[_0x5948c6(0x10a)](_0x1b2f5c));}}static async[a89_0x2de2fd(0x13c)](_0x19aca8,_0x1dca1b){const _0x5087c0=a89_0x2de2fd;if(constants[_0x5087c0(0x120)][_0x5087c0(0x14d)](_0x1dca1b)){await _0x19aca8['setupPercy']();return;}_0x19aca8[_0x5087c0(0xf5)][_0x5087c0(0x117)]&&logger['debug'](_0x5087c0(0x129)+_0x1dca1b+_0x5087c0(0x159));}static['getAccessibilityOptions'](_0x348f85){const _0x295e1b=a89_0x2de2fd,_0x242e76={};_0x242e76[_0x295e1b(0x133)]=_0x348f85[_0x295e1b(0x125)];const _0x121473=_0x242e76;return _0x121473;}static['getConfig'](_0x4f5392,_0x3968ac){const _0x300ed0=a89_0x2de2fd,_0x4f256f={'DFDtK':function(_0x529e73,_0x845d42){return _0x529e73(_0x845d42);}},_0x341768={};return _0x341768[_0x300ed0(0x124)]=_0x4f5392,_0x341768[_0x300ed0(0x156)]=_0x3968ac,{'auth':_0x341768,'headers':_0x4f256f[_0x300ed0(0x106)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x5ceb24,_0x4b3b8a){const _0x56ee60=a89_0x2de2fd,_0x6140ad={'FgNcm':function(_0x3e704b,_0x2c0e28){return _0x3e704b(_0x2c0e28);}},_0x163b58={'project_name':_0x5ceb24['projectName']||'','name':_0x5ceb24[_0x56ee60(0x166)]||path[_0x56ee60(0x12a)](path[_0x56ee60(0x167)](process[_0x56ee60(0xff)]())),'build_identifier':_0x5ceb24['buildIdentifier'],'description':_0x5ceb24[_0x56ee60(0x150)]||'','started_at':new Date()['toISOString'](),'tags':_0x6140ad[_0x56ee60(0xec)](getCustomTags,_0x5ceb24),'host_info':bsSetupHelper[_0x56ee60(0x14f)](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process[_0x56ee60(0x160)][_0x56ee60(0x152)],'failed_tests_rerun':process[_0x56ee60(0x160)][_0x56ee60(0x15e)]||![],'version_control':await bsSetupHelper[_0x56ee60(0x11c)](),'accessibility':this[_0x56ee60(0x154)](_0x5ceb24),'framework_details':testhubUtils[_0x56ee60(0x10d)](_0x5ceb24,_0x4b3b8a),'product_map':testhubUtils[_0x56ee60(0x148)](_0x5ceb24),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra']()};if(process['env']['BROWSERSTACK_CENTRAL_USER']){const _0x39e0ac={};_0x39e0ac[_0x56ee60(0xf1)]=process[_0x56ee60(0x160)][_0x56ee60(0x14c)],_0x39e0ac[_0x56ee60(0xf0)]=process['env'][_0x56ee60(0x111)],_0x163b58[_0x56ee60(0xf7)]=_0x39e0ac;}return _0x163b58;}static['extractDataFromResponse'](_0x511f70,_0x27f5c0,_0xbfedc4){const _0x4ce54d=a89_0x2de2fd,_0x35de52={'WLJgL':function(_0x11f5e0){return _0x11f5e0();},'WixXG':function(_0x507d68,_0x302914){return _0x507d68&&_0x302914;},'vxgaA':'true','wEiXY':_0x4ce54d(0xfd),'cfvsw':function(_0x1d8289,_0x42f0ca){return _0x1d8289&&_0x42f0ca;}},_0x5c7629={};if(_0x35de52[_0x4ce54d(0xf4)](isTestObservabilitySession)){const [_0x9ff2bf,_0x28d5fb,_0x3e7a55]=testhubUtils[_0x4ce54d(0xf6)](_0x27f5c0[_0x4ce54d(0x119)],_0xbfedc4[_0x4ce54d(0xe5)]);if(_0x35de52['WixXG'](_0x9ff2bf,_0x28d5fb)){const _0x11e680={};_0x11e680[_0x4ce54d(0x114)]=_0x9ff2bf,_0x11e680['buildHashedId']=_0x28d5fb,_0x11e680[_0x4ce54d(0x14b)]=_0x3e7a55,_0x5c7629[testHubConstants[_0x4ce54d(0xfe)]]=_0x11e680,process[_0x4ce54d(0x160)][_0x4ce54d(0xe9)]=_0x35de52[_0x4ce54d(0xe1)];}else _0x5c7629[testHubConstants[_0x4ce54d(0xfe)]]={},process[_0x4ce54d(0x160)][_0x4ce54d(0xe9)]=_0x35de52['wEiXY'];}else process[_0x4ce54d(0x160)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x35de52[_0x4ce54d(0x100)];if(testhubUtils['isAccessibilityEnabled'](_0x511f70)){const [_0x121872,_0x2e5e33]=testhubUtils[_0x4ce54d(0x155)](_0x27f5c0[_0x4ce54d(0x119)]);if(_0x35de52['cfvsw'](_0x121872,_0x2e5e33)){const _0x5dac75={};_0x5dac75['authToken']=_0x121872,_0x5dac75[_0x4ce54d(0x11f)]=_0x2e5e33,_0x5c7629[testHubConstants[_0x4ce54d(0xe3)]]=_0x5dac75,process[_0x4ce54d(0x160)][_0x4ce54d(0x101)]=_0x35de52[_0x4ce54d(0xe1)];}else _0x5c7629[testHubConstants[_0x4ce54d(0xe3)]]={},process[_0x4ce54d(0x160)][_0x4ce54d(0x101)]=_0x35de52['wEiXY'];}else process['env']['BROWSERSTACK_ACCESSIBILITY']=_0x35de52[_0x4ce54d(0x100)];return testhubUtils['setTestHubCommonMetaInfo'](_0x27f5c0[_0x4ce54d(0x119)]),logger[_0x4ce54d(0xe6)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x4ce54d(0x160)]['BROWSERSTACK_TESTHUB_UUID']),_0x5c7629;}static async[a89_0x2de2fd(0xdd)](_0x1962b3){const _0xf1c6e3=a89_0x2de2fd,_0x46156b={'pDIBL':function(_0x449593,_0x5082f2){return _0x449593===_0x5082f2;},'muxBx':_0xf1c6e3(0xfd),'LKlsG':function(_0x5b89f6,_0x1f9902){return _0x5b89f6===_0x1f9902;},'NziuJ':_0xf1c6e3(0x113),'VdMFm':_0xf1c6e3(0x130),'WufjU':_0xf1c6e3(0xf9),'lwHCl':_0xf1c6e3(0xdc),'mHZpb':_0xf1c6e3(0xde),'PpIgu':'user_killed','HYtSV':function(_0x24b559){return _0x24b559();},'JFFMY':function(_0x2bb626,_0x46a297,_0x55274a,_0x3c4ab1,_0x4e9d89,_0x36bb4b){return _0x2bb626(_0x46a297,_0x55274a,_0x3c4ab1,_0x4e9d89,_0x36bb4b);},'VUhOy':_0xf1c6e3(0x163),'GAKoK':_0xf1c6e3(0xee),'KysZn':_0xf1c6e3(0xea)};await this[_0xf1c6e3(0x11e)](),await PerformanceTester['measureWrapper'](PerformanceEvents[_0xf1c6e3(0x126)],async()=>{const _0x549655=_0xf1c6e3;if(_0x46156b[_0x549655(0xdf)](process[_0x549655(0x160)][_0x549655(0x139)],_0x46156b['muxBx'])||TestHubHandler[_0x549655(0x12d)]||bsSetupHelper[_0x549655(0x134)](process['env'][testHubConstants[_0x549655(0xef)][_0x549655(0x116)]]))return;TestHubHandler[_0x549655(0x12d)]=!![],await RequestQueueHandler[_0x549655(0x131)]()[_0x549655(0x107)](),await SessionHandler[_0x549655(0x109)]();if(_0x46156b[_0x549655(0x140)](process[_0x549655(0x160)][testHubConstants[_0x549655(0xef)][_0x549655(0x116)]],_0x46156b[_0x549655(0x103)])||_0x46156b[_0x549655(0x140)](process[_0x549655(0x160)][testHubConstants[_0x549655(0xef)][_0x549655(0x15b)]],_0x46156b[_0x549655(0x103)])){logger['debug'](_0x46156b[_0x549655(0x105)]);const _0x228792={};return _0x228792[_0x549655(0x128)]=_0x46156b[_0x549655(0x110)],_0x228792[_0x549655(0x158)]=_0x46156b[_0x549655(0x10b)],_0x228792;}const _0x5a5191={'finished_at':new Date()[_0x549655(0x13e)](),'finished_metadata':[]};!!_0x1962b3&&_0x5a5191[_0x46156b[_0x549655(0x10e)]][_0x549655(0x142)]({'reason':_0x46156b['PpIgu'],'signal':_0x1962b3,'failure_data':''});const _0x513de3={'headers':_0x46156b[_0x549655(0x14a)](getDefaultHeaders)};try{const _0x36336d=await _0x46156b['JFFMY'](nodeRequest,_0x46156b[_0x549655(0x168)],_0x549655(0x118)+process[_0x549655(0x160)][testHubConstants[_0x549655(0xef)][_0x549655(0x15b)]]+_0x549655(0x13d),_0x5a5191,_0x513de3,![]);if(_0x36336d[_0x549655(0x119)]&&_0x36336d[_0x549655(0x119)][_0x549655(0xf9)]){const _0x51a27d={};_0x51a27d[_0x549655(0x158)]=_0x36336d[_0x549655(0x119)]['error'];throw _0x51a27d;}else{logger['debug'](_0x46156b[_0x549655(0x165)]);const _0x2e30a4={};return _0x2e30a4[_0x549655(0x128)]=_0x46156b[_0x549655(0x104)],_0x2e30a4[_0x549655(0x158)]='',_0x2e30a4;}}catch(_0x254ec4){_0x254ec4[_0x549655(0x10f)]?logger[_0x549655(0x15d)](_0x549655(0xfb)+_0x254ec4[_0x549655(0x10f)][_0x549655(0x128)]+'\x20'+_0x254ec4[_0x549655(0x10f)][_0x549655(0x135)]+'\x20'+JSON['stringify'](_0x254ec4[_0x549655(0x10f)]['data'])):logger[_0x549655(0x15d)](_0x549655(0xfb)+(_0x254ec4[_0x549655(0x158)]||_0x254ec4));const _0x2ee0d9={};return _0x2ee0d9[_0x549655(0x128)]=_0x46156b[_0x549655(0x110)],_0x2ee0d9['message']=_0x254ec4[_0x549655(0x158)]||_0x254ec4[_0x549655(0x10f)]?_0x254ec4[_0x549655(0x10f)]['status']+':'+_0x254ec4[_0x549655(0x10f)][_0x549655(0x135)]:_0x254ec4,_0x2ee0d9;}})();}}function a89_0x572a(_0x261f6e,_0x57cfef){const _0x79151f=a89_0x7915();return a89_0x572a=function(_0x572ae7,_0x40d0f5){_0x572ae7=_0x572ae7-0xdc;let _0x2b9de5=_0x79151f[_0x572ae7];return _0x2b9de5;},a89_0x572a(_0x261f6e,_0x57cfef);}module[a89_0x2de2fd(0x12b)]=TestHubHandler;
const a90_0x54b5f3=a90_0x57f5;(function(_0x2adeb3,_0x2517e6){const _0xc3f391=a90_0x57f5,_0x350083=_0x2adeb3();while(!![]){try{const _0xc56d80=parseInt(_0xc3f391(0x25d))/0x1+parseInt(_0xc3f391(0x23a))/0x2*(-parseInt(_0xc3f391(0x21e))/0x3)+parseInt(_0xc3f391(0x21f))/0x4+parseInt(_0xc3f391(0x275))/0x5+-parseInt(_0xc3f391(0x23e))/0x6+-parseInt(_0xc3f391(0x274))/0x7+-parseInt(_0xc3f391(0x261))/0x8*(parseInt(_0xc3f391(0x1ea))/0x9);if(_0xc56d80===_0x2517e6)break;else _0x350083['push'](_0x350083['shift']());}catch(_0x3c75b3){_0x350083['push'](_0x350083['shift']());}}}(a90_0x5156,0x31515));const bsSetupHelper=require(a90_0x54b5f3(0x260)),path=require('path'),util=require(a90_0x54b5f3(0x1ef)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x54b5f3(0x259)),testhubUtils=require(a90_0x54b5f3(0x1f6)),testHubConstants=require(a90_0x54b5f3(0x223)),constants=require(a90_0x54b5f3(0x24e)),RequestQueueHandler=require(a90_0x54b5f3(0x24d)),logger=require('../logger')[a90_0x54b5f3(0x21a)],SessionHandler=require(a90_0x54b5f3(0x208)),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x54b5f3(0x214)),TestDetails=require(a90_0x54b5f3(0x238)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x3d6a02=>{const _0x771e60=a90_0x54b5f3;OngoingEvents[_0x771e60(0x25f)](_0x3d6a02);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};function a90_0x57f5(_0x5d7ac2,_0x4cfeb1){const _0x51564e=a90_0x5156();return a90_0x57f5=function(_0x57f56a,_0x42d2c0){_0x57f56a=_0x57f56a-0x1e4;let _0x26991b=_0x51564e[_0x57f56a];return _0x26991b;},a90_0x57f5(_0x5d7ac2,_0x4cfeb1);}class TestHubHandler{static [a90_0x54b5f3(0x20a)]=![];static async[a90_0x54b5f3(0x215)](_0xdc056,_0x154533){const _0xc0bbbb=a90_0x54b5f3,_0x768fb0={'MDkiv':function(_0x3f48dc,_0x580655){return _0x3f48dc||_0x580655;},'jAPsi':function(_0x1858ac,_0x3a028a){return _0x1858ac||_0x3a028a;},'xpznh':function(_0x5c72e9,_0x2a0d43){return _0x5c72e9===_0x2a0d43;},'mOBfd':function(_0x447303){return _0x447303();},'gjcKz':_0xc0bbbb(0x271),'CmWjH':'false','JDWRP':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','kLFRr':function(_0x135ddb,_0x2ac53c,_0x2f2214,_0x58009c,_0x193704){return _0x135ddb(_0x2ac53c,_0x2f2214,_0x58009c,_0x193704);},'VZbAk':_0xc0bbbb(0x211),'FZhbE':'accessibility','CNIaV':_0xc0bbbb(0x26e),'wjXUT':function(_0x226b47,_0x3b8f56){return _0x226b47===_0x3b8f56;}};await PerformanceTester[_0xc0bbbb(0x210)](PerformanceEvents[_0xc0bbbb(0x229)],async()=>{const _0x3f6e51=_0xc0bbbb,_0x133670=Object[_0x3f6e51(0x255)]({},_0x154533[_0x3f6e51(0x1fd)],{'root_dir_path':'','framework':_0x154533[_0x3f6e51(0x245)]}),_0x437d2d=bsSetupHelper[_0x3f6e51(0x247)](_0x133670),_0x49c2b4=bsSetupHelper[_0x3f6e51(0x273)](_0x133670),_0x59cde1=_0x768fb0[_0x3f6e51(0x20e)](_0x437d2d,'')+':'+_0x768fb0[_0x3f6e51(0x256)](_0x49c2b4,''),_0x65c339=testhubUtils[_0x3f6e51(0x219)](_0x133670);process[_0x3f6e51(0x1ff)][_0x3f6e51(0x226)]=JSON[_0x3f6e51(0x248)](_0x65c339);if(_0x768fb0[_0x3f6e51(0x265)](_0x59cde1,':'))return _0x768fb0[_0x3f6e51(0x235)](isTestObservabilitySession)&&(logger[_0x3f6e51(0x240)](_0x768fb0[_0x3f6e51(0x1fa)]),process[_0x3f6e51(0x1ff)]['BS_TESTOPS_BUILD_COMPLETED']=_0x768fb0[_0x3f6e51(0x1ee)]),testhubUtils[_0x3f6e51(0x1e4)](_0x133670)&&logger[_0x3f6e51(0x240)](_0x768fb0[_0x3f6e51(0x1e5)]),[null,null];try{const _0x3d834a=await this[_0x3f6e51(0x21d)](_0x133670,_0xdc056),_0x118431=this[_0x3f6e51(0x1fe)](_0x437d2d,_0x49c2b4),_0x2d6735=await _0x768fb0[_0x3f6e51(0x218)](nodeRequest,_0x768fb0[_0x3f6e51(0x246)],testHubConstants[_0x3f6e51(0x24a)],_0x3d834a,_0x118431),_0x155325=this[_0x3f6e51(0x20c)](_0x133670,_0x2d6735,_0x118431);await this[_0x3f6e51(0x216)](_0x154533,_0xdc056);if(_0x768fb0[_0x3f6e51(0x265)](testhubUtils[_0x3f6e51(0x1fc)](_0x154533[_0x3f6e51(0x1fd)]),null)){const _0x4287bb=_0x155325[_0x768fb0[_0x3f6e51(0x1e9)]];_0x4287bb&&_0x4287bb[_0x3f6e51(0x24b)]&&_0x4287bb[_0x3f6e51(0x1eb)]&&(_0x154533[_0x3f6e51(0x1fd)][_0x3f6e51(0x20b)]=!![],process[_0x3f6e51(0x1ff)][_0x3f6e51(0x237)]=_0x768fb0[_0x3f6e51(0x217)]);}return _0x155325;}catch(_0x2fcb9e){if(_0x768fb0[_0x3f6e51(0x236)](_0x2fcb9e[_0x3f6e51(0x26d)],![])){testhubUtils[_0x3f6e51(0x26a)](_0x2fcb9e);return;}}})();}static async[a90_0x54b5f3(0x227)](){const _0x1a10f1=a90_0x54b5f3,_0x355547={'jbAdv':function(_0x122ff1,_0x5b1776,_0x493b9c){return _0x122ff1(_0x5b1776,_0x493b9c);},'IArzk':function(_0x1dd1c9,_0x29dc39){return _0x1dd1c9(_0x29dc39);},'iMrXf':function(_0x57542c){return _0x57542c();},'BgLdt':_0x1a10f1(0x204)};if(processedTraceZips)return;const _0x41ccc2=TestDetails['getTraceFilePaths']();_0x41ccc2[_0x1a10f1(0x1f9)](({testUId:_0x3e0d9b,filePath:_0x391877})=>{const _0x87fe45=_0x1a10f1;var _0x35ffb2=_0x355547[_0x87fe45(0x1f2)](uploadTraceZip,_0x391877,_0x3e0d9b);_0x355547[_0x87fe45(0x221)](addEvent,_0x35ffb2);});try{await _0x355547[_0x1a10f1(0x203)](awaitAllEvents),logger[_0x1a10f1(0x240)](_0x355547['BgLdt']),processedTraceZips=!![];}catch(_0x2547d5){logger[_0x1a10f1(0x24f)]('Error\x20while\x20waiting\x20for\x20events:\x20'+util[_0x1a10f1(0x254)](_0x2547d5));}}static async[a90_0x54b5f3(0x216)](_0x10a66c,_0xf86423){const _0x1b351d=a90_0x54b5f3;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x1b351d(0x26f)](_0xf86423)){await _0x10a66c['setupPercy']();return;}_0x10a66c['config'][_0x1b351d(0x205)]&&logger[_0x1b351d(0x240)](_0x1b351d(0x25c)+_0xf86423+'\x20framework');}static[a90_0x54b5f3(0x262)](_0x66ac7b){const _0x274c12=a90_0x54b5f3,_0x5e8c83={};_0x5e8c83[_0x274c12(0x244)]=_0x66ac7b[_0x274c12(0x267)];const _0x3b1988=_0x5e8c83;return _0x3b1988;}static['getConfig'](_0xbe45e6,_0x2b657c){const _0x138e54=a90_0x54b5f3,_0x4fc286={'sFKir':function(_0x19caed,_0x3a76cb){return _0x19caed(_0x3a76cb);}},_0x2d9e08={};return _0x2d9e08[_0x138e54(0x225)]=_0xbe45e6,_0x2d9e08[_0x138e54(0x23d)]=_0x2b657c,{'auth':_0x2d9e08,'headers':_0x4fc286[_0x138e54(0x1f8)](getDefaultHeaders,![])};}static async[a90_0x54b5f3(0x21d)](_0x8404ce,_0x902258){const _0x4547b5=a90_0x54b5f3,_0x4b7db2={'fcziB':function(_0xf22ea2,_0x22e8d6){return _0xf22ea2(_0x22e8d6);}},_0x3c1130={'project_name':_0x8404ce[_0x4547b5(0x22d)]||'','name':_0x8404ce['buildName']||path['basename'](path[_0x4547b5(0x23f)](process[_0x4547b5(0x243)]())),'build_identifier':_0x8404ce[_0x4547b5(0x222)],'description':_0x8404ce[_0x4547b5(0x23c)]||'','started_at':new Date()['toISOString'](),'tags':_0x4b7db2[_0x4547b5(0x220)](getCustomTags,_0x8404ce),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x4547b5(0x26c)](),'build_run_identifier':process[_0x4547b5(0x1ff)][_0x4547b5(0x1ed)],'failed_tests_rerun':process[_0x4547b5(0x1ff)][_0x4547b5(0x252)]||![],'version_control':await bsSetupHelper[_0x4547b5(0x231)](),'accessibility':this[_0x4547b5(0x262)](_0x8404ce),'framework_details':testhubUtils[_0x4547b5(0x1f4)](_0x8404ce,_0x902258),'product_map':testhubUtils[_0x4547b5(0x21b)](_0x8404ce),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra'](),'grouping_identifier':process[_0x4547b5(0x1ff)][_0x4547b5(0x239)]};if(bsSetupHelper['getCentralUser']()['central_scanner']||bsSetupHelper[_0x4547b5(0x1e6)]()[_0x4547b5(0x207)]){const _0xe63456={};_0xe63456['job_id']=process['env'][_0x4547b5(0x250)],_0xe63456[_0x4547b5(0x22a)]=process[_0x4547b5(0x1ff)]['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x3c1130[_0x4547b5(0x257)]=_0xe63456;}return _0x3c1130;}static[a90_0x54b5f3(0x20c)](_0x492267,_0x548564,_0x29b713){const _0x648659=a90_0x54b5f3,_0x56db3f={'gIjRX':function(_0x2cd61b){return _0x2cd61b();},'whOVG':function(_0x2d2918,_0x257348){return _0x2d2918&&_0x257348;},'yVTFh':'true','AyPEz':_0x648659(0x1ec),'TcYQn':function(_0x39bfae,_0x234595){return _0x39bfae&&_0x234595;}},_0x15b141={};if(_0x56db3f['gIjRX'](isTestObservabilitySession)){const [_0x33bbe1,_0x2053b2,_0x305051]=testhubUtils[_0x648659(0x202)](_0x548564[_0x648659(0x209)],_0x29b713[_0x648659(0x212)]);if(_0x56db3f[_0x648659(0x25e)](_0x33bbe1,_0x2053b2)){const _0x457021={};_0x457021[_0x648659(0x1e8)]=_0x33bbe1,_0x457021[_0x648659(0x1eb)]=_0x2053b2,_0x457021[_0x648659(0x213)]=_0x305051,_0x15b141[testHubConstants['OBSERVABILITY']]=_0x457021,process['env'][_0x648659(0x25b)]=_0x56db3f[_0x648659(0x201)];}else _0x15b141[testHubConstants[_0x648659(0x234)]]={},process[_0x648659(0x1ff)][_0x648659(0x25b)]=_0x56db3f[_0x648659(0x232)];}else process[_0x648659(0x1ff)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x56db3f[_0x648659(0x232)];const [_0x577c04,_0xbbada8]=testhubUtils[_0x648659(0x25a)](_0x548564[_0x648659(0x209)]);if(_0x56db3f['TcYQn'](_0x577c04,_0xbbada8)){const _0x218c98={};_0x218c98['authToken']=_0x577c04,_0x218c98[_0x648659(0x1eb)]=_0xbbada8,_0x15b141[testHubConstants[_0x648659(0x242)]]=_0x218c98,process[_0x648659(0x1ff)][_0x648659(0x26b)]=_0x56db3f[_0x648659(0x201)];}else _0x15b141[testHubConstants[_0x648659(0x242)]]={},process[_0x648659(0x1ff)][_0x648659(0x26b)]=_0x56db3f[_0x648659(0x232)];return testhubUtils[_0x648659(0x22f)](_0x548564['data']),logger[_0x648659(0x22e)](_0x648659(0x224)+process[_0x648659(0x1ff)][_0x648659(0x22b)]),_0x15b141;}static async[a90_0x54b5f3(0x1f5)](_0x4ab89a){const _0x4d31e1=a90_0x54b5f3,_0x41be07={'FmSTg':function(_0x28320d,_0x1088e1){return _0x28320d===_0x1088e1;},'UQFSJ':'false','IEZMi':_0x4d31e1(0x230),'yReYl':function(_0x367716,_0x21538b){return _0x367716===_0x21538b;},'YjuWS':_0x4d31e1(0x22c),'xTeDY':_0x4d31e1(0x24f),'bcRQG':_0x4d31e1(0x264),'jCktB':_0x4d31e1(0x270),'wCunM':'user_killed','cqbhs':function(_0x1e7cc3){return _0x1e7cc3();},'WWKFn':function(_0x49131a,_0x416489,_0x445ccc,_0x501531,_0x175353,_0x44e8d8){return _0x49131a(_0x416489,_0x445ccc,_0x501531,_0x175353,_0x44e8d8);},'kEdsa':_0x4d31e1(0x269),'ciraV':_0x4d31e1(0x263),'RzEja':_0x4d31e1(0x26d)};await this[_0x4d31e1(0x227)](),await PerformanceTester[_0x4d31e1(0x210)](PerformanceEvents[_0x4d31e1(0x228)],async()=>{const _0x1b309f=_0x4d31e1;if(_0x41be07[_0x1b309f(0x21c)](process['env'][_0x1b309f(0x1f1)],_0x41be07[_0x1b309f(0x258)])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x1b309f(0x23b)](process['env'][testHubConstants['ENV_VAR'][_0x1b309f(0x241)]]))return;TestHubHandler['buildStopSent']=!![],await RequestQueueHandler[_0x1b309f(0x24c)]()[_0x1b309f(0x1f3)](),await SessionHandler['waitForBuildStatus']();if(_0x41be07[_0x1b309f(0x21c)](process[_0x1b309f(0x1ff)][testHubConstants[_0x1b309f(0x200)]['BROWSERSTACK_TESTHUB_JWT']],_0x41be07[_0x1b309f(0x272)])||_0x41be07['yReYl'](process[_0x1b309f(0x1ff)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']],_0x41be07['IEZMi'])){logger[_0x1b309f(0x240)](_0x41be07[_0x1b309f(0x251)]);const _0xaee66a={};return _0xaee66a[_0x1b309f(0x266)]=_0x41be07[_0x1b309f(0x249)],_0xaee66a['message']=_0x41be07['bcRQG'],_0xaee66a;}const _0x225f97={'finished_at':new Date()[_0x1b309f(0x1f7)](),'finished_metadata':[]};!!_0x4ab89a&&_0x225f97[_0x41be07['jCktB']]['push']({'reason':_0x41be07[_0x1b309f(0x206)],'signal':_0x4ab89a,'failure_data':''});const _0x412077={'headers':_0x41be07[_0x1b309f(0x1e7)](getDefaultHeaders)};try{const _0x204ece=await _0x41be07['WWKFn'](nodeRequest,_0x41be07[_0x1b309f(0x1f0)],_0x1b309f(0x20f)+process[_0x1b309f(0x1ff)][testHubConstants[_0x1b309f(0x200)][_0x1b309f(0x22b)]]+'/stop',_0x225f97,_0x412077,![]);if(_0x204ece['data']&&_0x204ece[_0x1b309f(0x209)][_0x1b309f(0x24f)]){const _0x3fa84f={};_0x3fa84f[_0x1b309f(0x253)]=_0x204ece[_0x1b309f(0x209)][_0x1b309f(0x24f)];throw _0x3fa84f;}else{logger[_0x1b309f(0x240)](_0x41be07[_0x1b309f(0x233)]);const _0x4bd085={};return _0x4bd085['status']=_0x41be07[_0x1b309f(0x276)],_0x4bd085[_0x1b309f(0x253)]='',_0x4bd085;}}catch(_0x40925d){_0x40925d[_0x1b309f(0x1fb)]?logger[_0x1b309f(0x240)](_0x1b309f(0x268)+_0x40925d['response'][_0x1b309f(0x266)]+'\x20'+_0x40925d['response'][_0x1b309f(0x20d)]+'\x20'+JSON['stringify'](_0x40925d[_0x1b309f(0x1fb)][_0x1b309f(0x209)])):logger[_0x1b309f(0x240)](_0x1b309f(0x268)+(_0x40925d[_0x1b309f(0x253)]||_0x40925d));const _0x96cbbf={};return _0x96cbbf[_0x1b309f(0x266)]=_0x41be07[_0x1b309f(0x249)],_0x96cbbf[_0x1b309f(0x253)]=_0x40925d[_0x1b309f(0x253)]||_0x40925d[_0x1b309f(0x1fb)]?_0x40925d[_0x1b309f(0x1fb)][_0x1b309f(0x266)]+':'+_0x40925d[_0x1b309f(0x1fb)][_0x1b309f(0x20d)]:_0x40925d,_0x96cbbf;}})();}}function a90_0x5156(){const _0x5c4077=['forEach','gjcKz','response','getAccessibilityValueFromYml','config','getConfig','env','ENV_VAR','yVTFh','setTestObservabilityVariables','iMrXf','All\x20trace\x20zip\x20send\x20events\x20complete','percy','wCunM','lcnc','../test-observability/sessionHandler.js','data','buildStopSent','accessibility','extractDataFromResponse','statusText','MDkiv','api/v1/builds/','measureWrapper','POST','auth','allowScreenshot','../performance/constants','launchBuild','checkAndSetupPercy','CNIaV','kLFRr','getProductMap','winstonLogger','getProductMapForBuildStartCall','FmSTg','generateBuildUpstreamData','12GvfqLP','105788PlVwuV','fcziB','IArzk','buildIdentifier','./constants.js','Testhub\x20started\x20with\x20id:\x20','username','BROWSERSTACK_PRODUCT_MAP','processTraceZips','STOP','START','token','BROWSERSTACK_TESTHUB_UUID','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','projectName','info','setTestHubCommonMetaInfo','null','getGitMetaData','AyPEz','ciraV','OBSERVABILITY','mOBfd','wjXUT','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','../../bin/playwright/reporter/test-details.js','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','30002EFJKdY','isUndefined','buildDescription','password','432834XiexfF','resolve','debug','BROWSERSTACK_TESTHUB_JWT','ACCESSIBILITY','cwd','settings','framework','VZbAk','getUserName','stringify','xTeDY','TESTHUB_BUILD_API','authToken','getInstance','../test-observability/requestQueueHandler.js','../../bin/utils/constants.js','error','BROWSERSTACK_CENTRAL_SCANNER_JOBID','YjuWS','BROWSERSTACK_RERUN','message','format','assign','jAPsi','central_scanner','UQFSJ','../test-observability/utils','setAccessibilityVariables','BROWSERSTACK_TEST_OBSERVABILITY','Percy\x20is\x20not\x20supported\x20for\x20','80318Xlzlbg','whOVG','add','../helper','3352WzVzWG','getAccessibilityOptions','stopBuildUpstream\x20event\x20successful!','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','xpznh','status','accessibilityOptions','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','PUT','logBuildError','BROWSERSTACK_ACCESSIBILITY','getCiInfo','success','true','includes','finished_metadata','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','IEZMi','getAccessKey','46942SHdeJc','1750760yzCbTP','RzEja','isAccessibilityEnabled','JDWRP','getCentralUser','cqbhs','jwt','FZhbE','2493iWNCwx','buildHashedId','false','BROWSERSTACK_BUILD_RUN_IDENTIFIER','CmWjH','util','kEdsa','BS_TESTOPS_BUILD_COMPLETED','jbAdv','uploadPending','getFrameworkDetails','stop','./utils.js','toISOString','sFKir'];a90_0x5156=function(){return _0x5c4077;};return a90_0x5156();}module['exports']=TestHubHandler;
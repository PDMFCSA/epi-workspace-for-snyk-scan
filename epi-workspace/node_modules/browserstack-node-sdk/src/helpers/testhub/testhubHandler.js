const a90_0x2f406f=a90_0x5a4a;(function(_0x54d159,_0x2875e9){const _0x354025=a90_0x5a4a,_0x3273e6=_0x54d159();while(!![]){try{const _0x575ed4=parseInt(_0x354025(0x187))/0x1+parseInt(_0x354025(0x126))/0x2*(parseInt(_0x354025(0x124))/0x3)+-parseInt(_0x354025(0x167))/0x4+parseInt(_0x354025(0x18c))/0x5+parseInt(_0x354025(0x133))/0x6*(parseInt(_0x354025(0x1b1))/0x7)+parseInt(_0x354025(0x134))/0x8+-parseInt(_0x354025(0x1aa))/0x9;if(_0x575ed4===_0x2875e9)break;else _0x3273e6['push'](_0x3273e6['shift']());}catch(_0x4494c3){_0x3273e6['push'](_0x3273e6['shift']());}}}(a90_0x2be8,0x38df0));const bsSetupHelper=require('../helper'),path=require(a90_0x2f406f(0x177)),util=require(a90_0x2f406f(0x13b)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a90_0x2f406f(0x152)),testHubConstants=require('./constants.js'),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a90_0x2f406f(0x16c)),logger=require(a90_0x2f406f(0x1ae))[a90_0x2f406f(0x1b3)],SessionHandler=require(a90_0x2f406f(0x159)),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a90_0x2f406f(0x193)),{uploadTraceZip}=require(a90_0x2f406f(0x197)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x8995a=>{const _0x4c11ff=a90_0x2f406f;OngoingEvents[_0x4c11ff(0x146)](_0x8995a);},awaitAllEvents=async()=>{const _0x1deac8=a90_0x2f406f;return Promise[_0x1deac8(0x130)](OngoingEvents);};function a90_0x2be8(){const _0x2e3896=['buildDescription','stop','ENV_VAR','OPzbD','null','central_scanner','buildHashedId','JCPku','toISOString','getInstance','lcnc','allowScreenshot','response','uploadPending','assign','finished_metadata','9470916UGqens','ETxvP','getAccessKey','status','../logger','yAayq','BROWSERSTACK_PRODUCT_MAP','3108MvCNpd','waitForBuildStatus','winstonLogger','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','auth','1123323tiQlam','jiLTA','2yCmTZG','HSaRL','IMBOX','stringify','ZpLbh','token','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','data','Percy\x20is\x20not\x20supported\x20for\x20','BROWSERSTACK_CENTRAL_SCANNER_JWT','allSettled','true','false','1548KOMbWY','1373800ULcpCF','IRSHb','info','BROWSERSTACK_TESTHUB_JWT','isUndefined','xMFlT','includes','util','hmOwS','Testhub\x20started\x20with\x20id:\x20','Qjvha','env','rzvoa','measureWrapper','checkAndSetupPercy','getProductMap','BROWSERSTACK_ACCESSIBILITY','BROWSERSTACK_TEST_OBSERVABILITY','add','exports','getAccessibilityOptions','forEach','getCiInfo','push','\x20framework','rRNiE','START','ACCESSIBILITY','fbmaM','extractDataFromResponse','./utils.js','TESTHUB_BUILD_API','BROWSERSTACK_TESTHUB_UUID','BROWSERSTACK_RERUN','HkHij','settings','rJImb','../test-observability/sessionHandler.js','framework','BS_TESTOPS_BUILD_COMPLETED','username','launchBuild','VwqRh','password','vApFs','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','generateBuildUpstreamData','resolve','getAccessibilityValueFromYml','debug','SGTEE','265920Irrych','POST','Error\x20while\x20waiting\x20for\x20events:\x20','format','stopBuildUpstream\x20event\x20successful!','../test-observability/requestQueueHandler.js','accessibilityOptions','getGitMetaData','setupPercy','logBuildError','bJaqd','authToken','blMFx','CQhdZ','DonOl','RUBQb','path','All\x20trace\x20zip\x20send\x20events\x20complete','MNfyi','message','accessibility','buildStopSent','MipzZ','getUserName','basename','BROWSERSTACK_CENTRAL_SCANNER_JOBID','processTraceZips','tQSWA','LpcYv','config','api/v1/builds/','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','273810IHiOEg','getConfig','isBrowserstackInfra','DFrjB','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','2086100rIxyHn','success','buildIdentifier','statusText','BROWSERSTACK_BUILD_RUN_IDENTIFIER','error','buildName','../../bin/playwright/reporter/test-details.js','getFrameworkDetails','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','KMkVU','../../bin/playwright/reporter/pwUtils.js','isAccessibilityEnabled','percy'];a90_0x2be8=function(){return _0x2e3896;};return a90_0x2be8();}function a90_0x5a4a(_0x364b2d,_0x42c2ef){const _0x2be819=a90_0x2be8();return a90_0x5a4a=function(_0x5a4a0c,_0x572aad){_0x5a4a0c=_0x5a4a0c-0x124;let _0x5eab1f=_0x2be819[_0x5a4a0c];return _0x5eab1f;},a90_0x5a4a(_0x364b2d,_0x42c2ef);}class TestHubHandler{static ['buildStopSent']=![];static async[a90_0x2f406f(0x15d)](_0x445a24,_0x161596){const _0x321f15=a90_0x2f406f,_0x47993d={'ZpLbh':function(_0x400bf0,_0x1a4a26){return _0x400bf0||_0x1a4a26;},'rzvoa':function(_0x1cbae0,_0x50235c){return _0x1cbae0||_0x50235c;},'qgTZx':function(_0x184bd9,_0x547a1a){return _0x184bd9===_0x547a1a;},'tQSWA':function(_0x26d556){return _0x26d556();},'bJaqd':'EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','HkHij':'false','KMkVU':_0x321f15(0x186),'gMjZq':function(_0x19b7ce,_0x3662ce,_0x3b2d69,_0x3bbbe0,_0x27fb3b){return _0x19b7ce(_0x3662ce,_0x3b2d69,_0x3bbbe0,_0x27fb3b);},'MNfyi':_0x321f15(0x168),'MipzZ':function(_0x3e4f55,_0x3a36d1){return _0x3e4f55===_0x3a36d1;},'OFpMK':_0x321f15(0x17b),'RUBQb':_0x321f15(0x131),'blMFx':function(_0x2836b2,_0xa33ef4){return _0x2836b2===_0xa33ef4;}};await PerformanceTester[_0x321f15(0x141)](PerformanceEvents[_0x321f15(0x14e)],async()=>{const _0x12b302=_0x321f15,_0x3cbf77=Object[_0x12b302(0x1a8)]({},_0x161596[_0x12b302(0x184)],{'root_dir_path':'','framework':_0x161596[_0x12b302(0x15a)]}),_0x334cff=bsSetupHelper[_0x12b302(0x17e)](_0x3cbf77),_0x5c37ff=bsSetupHelper[_0x12b302(0x1ac)](_0x3cbf77),_0x200047=_0x47993d[_0x12b302(0x12a)](_0x334cff,'')+':'+_0x47993d[_0x12b302(0x140)](_0x5c37ff,''),_0x313acf=testhubUtils[_0x12b302(0x143)](_0x3cbf77);process[_0x12b302(0x13f)][_0x12b302(0x1b0)]=JSON[_0x12b302(0x129)](_0x313acf);if(_0x47993d['qgTZx'](_0x200047,':'))return _0x47993d[_0x12b302(0x182)](isTestObservabilitySession)&&(logger['debug'](_0x47993d[_0x12b302(0x171)]),process[_0x12b302(0x13f)][_0x12b302(0x15b)]=_0x47993d[_0x12b302(0x156)]),testhubUtils[_0x12b302(0x198)](_0x3cbf77)&&logger[_0x12b302(0x165)](_0x47993d[_0x12b302(0x196)]),[null,null];try{const _0x13a39f=await this[_0x12b302(0x162)](_0x3cbf77,_0x445a24),_0x4b6d5e=this[_0x12b302(0x188)](_0x334cff,_0x5c37ff),_0x4ebf53=await _0x47993d['gMjZq'](nodeRequest,_0x47993d[_0x12b302(0x179)],testHubConstants[_0x12b302(0x153)],_0x13a39f,_0x4b6d5e),_0x5e997c=this[_0x12b302(0x151)](_0x3cbf77,_0x4ebf53,_0x4b6d5e);await this[_0x12b302(0x142)](_0x161596,_0x445a24);if(_0x47993d[_0x12b302(0x17d)](testhubUtils[_0x12b302(0x164)](_0x161596[_0x12b302(0x184)]),null)){const _0x39ee51=_0x5e997c[_0x47993d['OFpMK']];_0x39ee51&&_0x39ee51[_0x12b302(0x172)]&&_0x39ee51[_0x12b302(0x1a0)]&&(_0x161596['config']['accessibility']=!![],process[_0x12b302(0x13f)][_0x12b302(0x1b4)]=_0x47993d[_0x12b302(0x176)]);}return _0x5e997c;}catch(_0x439d1c){if(_0x47993d[_0x12b302(0x173)](_0x439d1c[_0x12b302(0x18d)],![])){testhubUtils[_0x12b302(0x170)](_0x439d1c);return;}}})();}static async[a90_0x2f406f(0x181)](){const _0xce4d81=a90_0x2f406f,_0x2eab6b={'CQhdZ':function(_0x306132,_0x845dc3,_0x58a9f2){return _0x306132(_0x845dc3,_0x58a9f2);},'sVPwb':function(_0x35b5fd,_0x178830){return _0x35b5fd(_0x178830);},'IMBOX':function(_0x5143af){return _0x5143af();},'DonOl':_0xce4d81(0x178)};if(processedTraceZips)return;const _0x28ec20=TestDetails['getTraceFilePaths']();_0x28ec20[_0xce4d81(0x149)](({testUId:_0x2512b5,filePath:_0x2f3105})=>{const _0xf15089=_0xce4d81;var _0x41931c=_0x2eab6b[_0xf15089(0x174)](uploadTraceZip,_0x2f3105,_0x2512b5);_0x2eab6b['sVPwb'](addEvent,_0x41931c);});try{await _0x2eab6b[_0xce4d81(0x128)](awaitAllEvents),logger['debug'](_0x2eab6b[_0xce4d81(0x175)]),processedTraceZips=!![];}catch(_0x3a9ab7){logger['error'](_0xce4d81(0x169)+util[_0xce4d81(0x16a)](_0x3a9ab7));}}static async[a90_0x2f406f(0x142)](_0x181f20,_0x41981c){const _0x5f5570=a90_0x2f406f;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x5f5570(0x13a)](_0x41981c)){await _0x181f20[_0x5f5570(0x16f)]();return;}_0x181f20[_0x5f5570(0x184)][_0x5f5570(0x199)]&&logger['debug'](_0x5f5570(0x12e)+_0x41981c+_0x5f5570(0x14c));}static[a90_0x2f406f(0x148)](_0x2ec332){const _0x9f8d11=a90_0x2f406f,_0x389a5f={};_0x389a5f[_0x9f8d11(0x157)]=_0x2ec332[_0x9f8d11(0x16d)];const _0x62eebd=_0x389a5f;return _0x62eebd;}static['getConfig'](_0x491012,_0x13670c){const _0x49f83f=a90_0x2f406f,_0x15ec0a={'iRzcb':function(_0x589927,_0x1b7b37){return _0x589927(_0x1b7b37);}},_0x114b89={};return _0x114b89[_0x49f83f(0x15c)]=_0x491012,_0x114b89[_0x49f83f(0x15f)]=_0x13670c,{'auth':_0x114b89,'headers':_0x15ec0a['iRzcb'](getDefaultHeaders,![])};}static async[a90_0x2f406f(0x162)](_0x46cc05,_0x2a61c2){const _0x4c4229=a90_0x2f406f,_0x5e574e={'vApFs':function(_0x38ccb5,_0x46a5ec){return _0x38ccb5(_0x46a5ec);}},_0x3fa884={'project_name':_0x46cc05['projectName']||'','name':_0x46cc05[_0x4c4229(0x192)]||path[_0x4c4229(0x17f)](path[_0x4c4229(0x163)](process['cwd']())),'build_identifier':_0x46cc05[_0x4c4229(0x18e)],'description':_0x46cc05[_0x4c4229(0x19a)]||'','started_at':new Date()[_0x4c4229(0x1a2)](),'tags':_0x5e574e[_0x4c4229(0x160)](getCustomTags,_0x46cc05),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x4c4229(0x14a)](),'build_run_identifier':process[_0x4c4229(0x13f)][_0x4c4229(0x190)],'failed_tests_rerun':process['env'][_0x4c4229(0x155)]||![],'version_control':await bsSetupHelper[_0x4c4229(0x16e)](),'accessibility':this[_0x4c4229(0x148)](_0x46cc05),'framework_details':testhubUtils[_0x4c4229(0x194)](_0x46cc05,_0x2a61c2),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x46cc05),'browserstackAutomation':bsSetupHelper[_0x4c4229(0x189)](),'grouping_identifier':process[_0x4c4229(0x13f)][_0x4c4229(0x161)]};if(bsSetupHelper['getCentralUser']()[_0x4c4229(0x19f)]||bsSetupHelper['getCentralUser']()[_0x4c4229(0x1a4)]){const _0x3b5d5={};_0x3b5d5['job_id']=process[_0x4c4229(0x13f)][_0x4c4229(0x180)],_0x3b5d5[_0x4c4229(0x12b)]=process['env'][_0x4c4229(0x12f)],_0x3fa884[_0x4c4229(0x19f)]=_0x3b5d5;}return _0x3fa884;}static[a90_0x2f406f(0x151)](_0xdae1dc,_0x248d6c,_0x300df4){const _0x368c36=a90_0x2f406f,_0x614665={'HSaRL':function(_0x22d39e){return _0x22d39e();},'jiLTA':function(_0x2a9887,_0x819dd9){return _0x2a9887&&_0x819dd9;},'IRSHb':_0x368c36(0x131),'OPzbD':'false','izOFt':function(_0x41c17a,_0x26e6ec){return _0x41c17a&&_0x26e6ec;}},_0x2afa90={};if(_0x614665[_0x368c36(0x127)](isTestObservabilitySession)){const [_0x4c558b,_0x4e9bd8,_0x1ce3bf]=testhubUtils['setTestObservabilityVariables'](_0x248d6c[_0x368c36(0x12d)],_0x300df4[_0x368c36(0x1b5)]);if(_0x614665[_0x368c36(0x125)](_0x4c558b,_0x4e9bd8)){const _0x2bb424={};_0x2bb424['jwt']=_0x4c558b,_0x2bb424['buildHashedId']=_0x4e9bd8,_0x2bb424[_0x368c36(0x1a5)]=_0x1ce3bf,_0x2afa90[testHubConstants['OBSERVABILITY']]=_0x2bb424,process[_0x368c36(0x13f)][_0x368c36(0x145)]=_0x614665[_0x368c36(0x135)];}else _0x2afa90[testHubConstants['OBSERVABILITY']]={},process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x614665[_0x368c36(0x19d)];}else process['env'][_0x368c36(0x145)]=_0x614665[_0x368c36(0x19d)];const [_0x2a9cd4,_0xc9d521]=testhubUtils['setAccessibilityVariables'](_0x248d6c[_0x368c36(0x12d)]);if(_0x614665['izOFt'](_0x2a9cd4,_0xc9d521)){const _0x4a40fe={};_0x4a40fe[_0x368c36(0x172)]=_0x2a9cd4,_0x4a40fe[_0x368c36(0x1a0)]=_0xc9d521,_0x2afa90[testHubConstants[_0x368c36(0x14f)]]=_0x4a40fe,process[_0x368c36(0x13f)]['BROWSERSTACK_ACCESSIBILITY']=_0x614665[_0x368c36(0x135)];}else _0x2afa90[testHubConstants[_0x368c36(0x14f)]]={},process[_0x368c36(0x13f)][_0x368c36(0x144)]=_0x614665['OPzbD'];return testhubUtils['setTestHubCommonMetaInfo'](_0x248d6c['data']),logger[_0x368c36(0x136)](_0x368c36(0x13d)+process[_0x368c36(0x13f)][_0x368c36(0x154)]),_0x2afa90;}static async[a90_0x2f406f(0x19b)](_0x4c828d){const _0x2af74c=a90_0x2f406f,_0x532de6={'fbmaM':function(_0x2aea51,_0x627d02){return _0x2aea51===_0x627d02;},'JCPku':_0x2af74c(0x132),'DFrjB':_0x2af74c(0x19e),'ETxvP':function(_0x39f946,_0x4b38cd){return _0x39f946===_0x4b38cd;},'SGTEE':_0x2af74c(0x12c),'yAayq':_0x2af74c(0x191),'VwqRh':_0x2af74c(0x195),'hmOwS':_0x2af74c(0x1a9),'rJImb':'user_killed','xMFlT':function(_0x5e21ae){return _0x5e21ae();},'rRNiE':function(_0x5d2c1d,_0x783949,_0x5ac3f9,_0x2d4ff6,_0x18ecfa,_0xe0272){return _0x5d2c1d(_0x783949,_0x5ac3f9,_0x2d4ff6,_0x18ecfa,_0xe0272);},'BFUXC':'PUT','Qjvha':_0x2af74c(0x16b),'LpcYv':_0x2af74c(0x18d)};await this[_0x2af74c(0x181)](),await PerformanceTester[_0x2af74c(0x141)](PerformanceEvents['STOP'],async()=>{const _0x403b94=_0x2af74c;if(_0x532de6[_0x403b94(0x150)](process[_0x403b94(0x13f)][_0x403b94(0x15b)],_0x532de6[_0x403b94(0x1a1)])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x403b94(0x138)](process['env'][testHubConstants[_0x403b94(0x19c)][_0x403b94(0x137)]]))return;TestHubHandler[_0x403b94(0x17c)]=!![],await RequestQueueHandler[_0x403b94(0x1a3)]()[_0x403b94(0x1a7)](),await SessionHandler[_0x403b94(0x1b2)]();if(_0x532de6[_0x403b94(0x150)](process[_0x403b94(0x13f)][testHubConstants[_0x403b94(0x19c)][_0x403b94(0x137)]],_0x532de6[_0x403b94(0x18a)])||_0x532de6[_0x403b94(0x1ab)](process[_0x403b94(0x13f)][testHubConstants['ENV_VAR'][_0x403b94(0x154)]],_0x532de6['DFrjB'])){logger[_0x403b94(0x165)](_0x532de6[_0x403b94(0x166)]);const _0x162a31={};return _0x162a31[_0x403b94(0x1ad)]=_0x532de6[_0x403b94(0x1af)],_0x162a31['message']=_0x532de6[_0x403b94(0x15e)],_0x162a31;}const _0x4cf6f4={'finished_at':new Date()[_0x403b94(0x1a2)](),'finished_metadata':[]};!!_0x4c828d&&_0x4cf6f4[_0x532de6[_0x403b94(0x13c)]][_0x403b94(0x14b)]({'reason':_0x532de6[_0x403b94(0x158)],'signal':_0x4c828d,'failure_data':''});const _0x36e6c6={'headers':_0x532de6[_0x403b94(0x139)](getDefaultHeaders)};try{const _0x228d8d=await _0x532de6[_0x403b94(0x14d)](nodeRequest,_0x532de6['BFUXC'],_0x403b94(0x185)+process[_0x403b94(0x13f)][testHubConstants[_0x403b94(0x19c)][_0x403b94(0x154)]]+'/stop',_0x4cf6f4,_0x36e6c6,![]);if(_0x228d8d['data']&&_0x228d8d[_0x403b94(0x12d)][_0x403b94(0x191)]){const _0x192dac={};_0x192dac[_0x403b94(0x17a)]=_0x228d8d[_0x403b94(0x12d)][_0x403b94(0x191)];throw _0x192dac;}else{logger[_0x403b94(0x165)](_0x532de6[_0x403b94(0x13e)]);const _0x35639b={};return _0x35639b[_0x403b94(0x1ad)]=_0x532de6[_0x403b94(0x183)],_0x35639b[_0x403b94(0x17a)]='',_0x35639b;}}catch(_0xbd120d){_0xbd120d['response']?logger[_0x403b94(0x165)](_0x403b94(0x18b)+_0xbd120d[_0x403b94(0x1a6)][_0x403b94(0x1ad)]+'\x20'+_0xbd120d[_0x403b94(0x1a6)][_0x403b94(0x18f)]+'\x20'+JSON[_0x403b94(0x129)](_0xbd120d[_0x403b94(0x1a6)][_0x403b94(0x12d)])):logger[_0x403b94(0x165)](_0x403b94(0x18b)+(_0xbd120d[_0x403b94(0x17a)]||_0xbd120d));const _0xfe3fbc={};return _0xfe3fbc['status']=_0x532de6['yAayq'],_0xfe3fbc[_0x403b94(0x17a)]=_0xbd120d[_0x403b94(0x17a)]||_0xbd120d[_0x403b94(0x1a6)]?_0xbd120d['response'][_0x403b94(0x1ad)]+':'+_0xbd120d[_0x403b94(0x1a6)][_0x403b94(0x18f)]:_0xbd120d,_0xfe3fbc;}})();}}module[a90_0x2f406f(0x147)]=TestHubHandler;
const a119_0x19683d=a119_0x4bdc;(function(_0x28649e,_0x5b50be){const _0x3f605f=a119_0x4bdc,_0x35a98a=_0x28649e();while(!![]){try{const _0xdcf769=-parseInt(_0x3f605f(0x16c))/0x1*(-parseInt(_0x3f605f(0x170))/0x2)+-parseInt(_0x3f605f(0x1a5))/0x3*(parseInt(_0x3f605f(0x1d2))/0x4)+parseInt(_0x3f605f(0x167))/0x5*(-parseInt(_0x3f605f(0x150))/0x6)+parseInt(_0x3f605f(0x17f))/0x7+parseInt(_0x3f605f(0x173))/0x8+-parseInt(_0x3f605f(0x15d))/0x9+parseInt(_0x3f605f(0x1ab))/0xa*(parseInt(_0x3f605f(0x1b9))/0xb);if(_0xdcf769===_0x5b50be)break;else _0x35a98a['push'](_0x35a98a['shift']());}catch(_0x428cc7){_0x35a98a['push'](_0x35a98a['shift']());}}}(a119_0x29e4,0x7c25e));const bsSetupHelper=require(a119_0x19683d(0x169)),path=require(a119_0x19683d(0x1ce)),util=require(a119_0x19683d(0x19f)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a119_0x19683d(0x1a4)),testhubUtils=require(a119_0x19683d(0x1b7)),testHubConstants=require(a119_0x19683d(0x197)),constants=require(a119_0x19683d(0x1af)),RequestQueueHandler=require(a119_0x19683d(0x1cf)),logger=require(a119_0x19683d(0x160))['winstonLogger'],SessionHandler=require(a119_0x19683d(0x17c)),PerformanceTester=require(a119_0x19683d(0x1cc)),{TESTHUB_EVENTS:PerformanceEvents}=require(a119_0x19683d(0x1c9)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),BrowserstackCLI=require(a119_0x19683d(0x166)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),TestInfo=require(a119_0x19683d(0x15e)),OngoingEvents=new Set();function a119_0x29e4(){const _0x32e0ee=['9822RlHEnl','waitForBuildStatus','buildHashedId','BROWSERSTACK_TESTHUB_JWT','TESTHUB_BUILD_API','central_scanner','message','kARVe','BROWSERSTACK_TESTHUB_UUID','add','statusText','MLsLQ','resolve','7330950vKpELi','../../bin/v2/TestInfo.js','getAccessibilityOptions','../logger','checkAndSetupPercy','BROWSERSTACK_PRODUCT_MAP','KZRAO','BROWSERSTACK_BUILD_RUN_IDENTIFIER','framework','../../bin/v2/browserstackCLI','1805egKHFn','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','../helper','generateBuildUpstreamData','ANwTT','58BfeteV','getGitMetaData','info','getCentralUser','17180NGNYVa','BROWSERSTACK_TEST_OBSERVABILITY','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','7414472cFYjke','lUAJm','setTestHubCommonMetaInfo','exports','lcnc','basename','null','true','ACCESSIBILITY','../test-observability/sessionHandler.js','getProductMap','launchBuild','1965075RcpNvD','iPxdb','logBuildError','stringify','\x20framework','token','buildDescription','authToken','YmKat','oERqh','data','OBSERVABILITY','success','/stop','UCuVy','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','SIInW','clESa','response','projectName','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','allSettled','username','STOP','./constants.js','TYllE','extractDataFromResponse','SVyTe','BtyJv','getAccessKey','cwd','setTestObservabilityVariables','util','RDzKA','PcUlD','PERCY_SUPPORTED_FRAMEWORKS','PUT','../test-observability/utils','9SbUCnz','getAccessibilityValueFromYml','settings','percy','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','All\x20trace\x20zip\x20send\x20events\x20complete','147990OynmMX','getInstance','ENV_VAR','debug','../../bin/utils/constants.js','ixtcA','setupPercy','WuSUK','JFIGk','allowScreenshot','false','START','./utils.js','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','176GhHmbC','uploadPending','isRunning','processTraceZips','getFrameworkDetails','error','api/v1/builds/','getConfig','omtlG','env','buildIdentifier','BS_TESTOPS_BUILD_COMPLETED','accessibility','aUOkF','duSWm','toISOString','../performance/constants','cchLU','status','../performance/performance-tester.js','push','path','../test-observability/requestQueueHandler.js','accessibilityOptions','Mxzix','38028zsCOCf','buildName','job_id','ssZzv','getUserName','BROWSERSTACK_RERUN','yxvxu','finished_metadata','hTCvP','BROWSERSTACK_CENTRAL_SCANNER_JOBID','buildStopSent','ojLcb','BROWSERSTACK_CENTRAL_SCANNER_JWT','user_killed','includes','forEach','config','stop','getTraceFilePaths','gWnbz'];a119_0x29e4=function(){return _0x32e0ee;};return a119_0x29e4();}let processedTraceZips=![];function a119_0x4bdc(_0x1619f6,_0x5320e3){const _0x29e45a=a119_0x29e4();return a119_0x4bdc=function(_0x4bdc3e,_0x2a2532){_0x4bdc3e=_0x4bdc3e-0x144;let _0x4c778b=_0x29e45a[_0x4bdc3e];return _0x4c778b;},a119_0x4bdc(_0x1619f6,_0x5320e3);}const addEvent=_0x4b105d=>{const _0x4361b5=a119_0x19683d;OngoingEvents[_0x4361b5(0x159)](_0x4b105d);},awaitAllEvents=async()=>{const _0x232b32=a119_0x19683d;return Promise[_0x232b32(0x194)](OngoingEvents);};class TestHubHandler{static [a119_0x19683d(0x146)]=![];static async[a119_0x19683d(0x17e)](_0xe8be81,_0x56219f){const _0x3651fc=a119_0x19683d,_0x32766b={'SVyTe':function(_0x47cf1c,_0x1d6c94){return _0x47cf1c||_0x1d6c94;},'Mxzix':function(_0x56cecb,_0x502885){return _0x56cecb===_0x502885;},'aUOkF':function(_0x278a43){return _0x278a43();},'BtyJv':_0x3651fc(0x1b8),'ixtcA':_0x3651fc(0x1b5),'KZRAO':_0x3651fc(0x168),'TYllE':function(_0x586df0,_0xbebd7f,_0x19183d,_0x26183b,_0x2d1593){return _0x586df0(_0xbebd7f,_0x19183d,_0x26183b,_0x2d1593);},'uCSEX':'POST','gWnbz':_0x3651fc(0x1c5),'ojLcb':_0x3651fc(0x17a),'WuSUK':function(_0x38f66b,_0x376bfa){return _0x38f66b===_0x376bfa;}};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x3651fc(0x1b6)],async()=>{const _0x357c56=_0x3651fc,_0x407a5c=Object['assign']({},_0x56219f[_0x357c56(0x14c)],{'root_dir_path':'','framework':_0x56219f[_0x357c56(0x165)]}),_0x3a5955=bsSetupHelper[_0x357c56(0x1d6)](_0x407a5c),_0x37b0b4=bsSetupHelper[_0x357c56(0x19c)](_0x407a5c),_0x52c7e6=_0x32766b['SVyTe'](_0x3a5955,'')+':'+_0x32766b[_0x357c56(0x19a)](_0x37b0b4,''),_0x3f6968=testhubUtils[_0x357c56(0x17d)](_0x407a5c);process[_0x357c56(0x1c2)][_0x357c56(0x162)]=JSON['stringify'](_0x3f6968);if(_0x32766b['Mxzix'](_0x52c7e6,':'))return _0x32766b[_0x357c56(0x1c6)](isTestObservabilitySession)&&(logger[_0x357c56(0x1ae)](_0x32766b[_0x357c56(0x19b)]),process[_0x357c56(0x1c2)][_0x357c56(0x1c4)]=_0x32766b[_0x357c56(0x1b0)]),testhubUtils['isAccessibilityEnabled'](_0x407a5c)&&logger[_0x357c56(0x1ae)](_0x32766b[_0x357c56(0x163)]),[null,null];try{const _0x3830ae=await this[_0x357c56(0x16a)](_0x407a5c,_0xe8be81),_0x358de9=this[_0x357c56(0x1c0)](_0x3a5955,_0x37b0b4),_0x5b0b9e=await _0x32766b[_0x357c56(0x198)](nodeRequest,_0x32766b['uCSEX'],testHubConstants[_0x357c56(0x154)],_0x3830ae,_0x358de9),_0x1c6c18=this[_0x357c56(0x199)](_0x407a5c,_0x5b0b9e,_0x358de9);await this[_0x357c56(0x161)](_0x56219f,_0xe8be81);if(_0x32766b[_0x357c56(0x1d1)](testhubUtils[_0x357c56(0x1a6)](_0x56219f[_0x357c56(0x14c)]),null)){const _0x52b058=_0x1c6c18[_0x32766b[_0x357c56(0x14f)]];_0x52b058&&_0x52b058[_0x357c56(0x186)]&&_0x52b058[_0x357c56(0x152)]&&(_0x56219f['config']['accessibility']=!![],process[_0x357c56(0x1c2)][_0x357c56(0x1a9)]=_0x32766b[_0x357c56(0x147)]);}return _0x1c6c18;}catch(_0x1ebbe1){if(_0x32766b[_0x357c56(0x1b2)](_0x1ebbe1[_0x357c56(0x18b)],![])){testhubUtils[_0x357c56(0x181)](_0x1ebbe1);return;}}})();}static async['processTraceZips'](){const _0x23c986=a119_0x19683d,_0x17eeab={'UCuVy':function(_0x1df212,_0x112ff0,_0x3313ee){return _0x1df212(_0x112ff0,_0x3313ee);},'omtlG':function(_0x2ab4aa,_0x36cc68){return _0x2ab4aa(_0x36cc68);},'hTCvP':function(_0x2a5394){return _0x2a5394();},'brgZv':_0x23c986(0x1aa)};if(processedTraceZips)return;const _0x600f88=TestDetails[_0x23c986(0x14e)]();_0x600f88[_0x23c986(0x14b)](({testUId:_0x6843de,filePath:_0x2da859})=>{const _0x16026c=_0x23c986;var _0x326664=_0x17eeab[_0x16026c(0x18d)](uploadTraceZip,_0x2da859,_0x6843de);_0x17eeab[_0x16026c(0x1c1)](addEvent,_0x326664);});try{await _0x17eeab[_0x23c986(0x144)](awaitAllEvents),logger[_0x23c986(0x1ae)](_0x17eeab['brgZv']),processedTraceZips=!![];}catch(_0x2f2826){logger[_0x23c986(0x1be)]('Error\x20while\x20waiting\x20for\x20events:\x20'+util['format'](_0x2f2826));}}static async[a119_0x19683d(0x161)](_0x208099,_0x24bb57){const _0x24de18=a119_0x19683d;if(constants[_0x24de18(0x1a2)][_0x24de18(0x14a)](_0x24bb57)){await _0x208099[_0x24de18(0x1b1)]();return;}_0x208099[_0x24de18(0x14c)][_0x24de18(0x1a8)]&&logger[_0x24de18(0x1ae)]('Percy\x20is\x20not\x20supported\x20for\x20'+_0x24bb57+_0x24de18(0x183));}static['getAccessibilityOptions'](_0x504334){const _0x527b24=a119_0x19683d,_0x40ea37={};_0x40ea37[_0x527b24(0x1a7)]=_0x504334[_0x527b24(0x1d0)];const _0x6fbff9=_0x40ea37;return _0x6fbff9;}static[a119_0x19683d(0x1c0)](_0x45ab06,_0x5aa860){const _0x3d5977=a119_0x19683d,_0x31b57e={'duSWm':function(_0xa8fdd3,_0x4d0957){return _0xa8fdd3(_0x4d0957);}},_0x18a016={};return _0x18a016[_0x3d5977(0x195)]=_0x45ab06,_0x18a016['password']=_0x5aa860,{'auth':_0x18a016,'headers':_0x31b57e[_0x3d5977(0x1c7)](getDefaultHeaders,![])};}static async[a119_0x19683d(0x16a)](_0x1b54bf,_0x48e1cd){const _0x4d7989=a119_0x19683d,_0x5d87a3={'cchLU':function(_0x17fd88,_0x29514c){return _0x17fd88(_0x29514c);}},_0x288881={'project_name':_0x1b54bf[_0x4d7989(0x192)]||'','name':_0x1b54bf[_0x4d7989(0x1d3)]||path[_0x4d7989(0x178)](path[_0x4d7989(0x15c)](process[_0x4d7989(0x19d)]())),'build_identifier':_0x1b54bf[_0x4d7989(0x1c3)],'description':_0x1b54bf[_0x4d7989(0x185)]||'','started_at':new Date()[_0x4d7989(0x1c8)](),'tags':_0x5d87a3[_0x4d7989(0x1ca)](getCustomTags,_0x1b54bf),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process[_0x4d7989(0x1c2)][_0x4d7989(0x164)],'failed_tests_rerun':process[_0x4d7989(0x1c2)][_0x4d7989(0x1d7)]||![],'version_control':await bsSetupHelper[_0x4d7989(0x16d)](),'accessibility':this[_0x4d7989(0x15f)](_0x1b54bf),'framework_details':testhubUtils[_0x4d7989(0x1bd)](_0x1b54bf,_0x48e1cd),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x1b54bf),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra'](),'grouping_identifier':process[_0x4d7989(0x1c2)][_0x4d7989(0x193)]};if(bsSetupHelper['getCentralUser']()['central_scanner']||bsSetupHelper[_0x4d7989(0x16f)]()[_0x4d7989(0x177)]){const _0x291b2b={};_0x291b2b[_0x4d7989(0x1d4)]=process['env'][_0x4d7989(0x145)],_0x291b2b[_0x4d7989(0x184)]=process[_0x4d7989(0x1c2)][_0x4d7989(0x148)],_0x288881[_0x4d7989(0x155)]=_0x291b2b;}return _0x288881;}static['extractDataFromResponse'](_0x143e82,_0x958c,_0x2e0cd0){const _0x3315d9=a119_0x19683d,_0x26475f={'RDzKA':function(_0x16c785){return _0x16c785();},'PcUlD':function(_0x479e0b,_0x6c6c86){return _0x479e0b&&_0x6c6c86;},'kARVe':_0x3315d9(0x17a),'clESa':_0x3315d9(0x1b5),'ANwTT':function(_0x1135fb,_0x381bb1){return _0x1135fb&&_0x381bb1;}},_0x47801e={};if(_0x26475f[_0x3315d9(0x1a0)](isTestObservabilitySession)){const [_0x59881e,_0x5d5df8,_0x5943a9]=testhubUtils[_0x3315d9(0x19e)](_0x958c['data'],_0x2e0cd0['auth']);if(_0x26475f[_0x3315d9(0x1a1)](_0x59881e,_0x5d5df8)){const _0x44ec17={};_0x44ec17['jwt']=_0x59881e,_0x44ec17[_0x3315d9(0x152)]=_0x5d5df8,_0x44ec17[_0x3315d9(0x1b4)]=_0x5943a9,_0x47801e[testHubConstants[_0x3315d9(0x18a)]]=_0x44ec17,process[_0x3315d9(0x1c2)][_0x3315d9(0x171)]=_0x26475f[_0x3315d9(0x157)];}else _0x47801e[testHubConstants['OBSERVABILITY']]={},process[_0x3315d9(0x1c2)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x26475f[_0x3315d9(0x190)];}else process[_0x3315d9(0x1c2)][_0x3315d9(0x171)]=_0x26475f[_0x3315d9(0x190)];const [_0xfefedb,_0x2416e1]=testhubUtils['setAccessibilityVariables'](_0x958c[_0x3315d9(0x189)]);if(_0x26475f[_0x3315d9(0x16b)](_0xfefedb,_0x2416e1)){const _0x578d4e={};_0x578d4e[_0x3315d9(0x186)]=_0xfefedb,_0x578d4e[_0x3315d9(0x152)]=_0x2416e1,_0x47801e[testHubConstants[_0x3315d9(0x17b)]]=_0x578d4e,process[_0x3315d9(0x1c2)]['BROWSERSTACK_ACCESSIBILITY']=_0x26475f['kARVe'];}else _0x47801e[testHubConstants['ACCESSIBILITY']]={},process[_0x3315d9(0x1c2)]['BROWSERSTACK_ACCESSIBILITY']=_0x26475f[_0x3315d9(0x190)];return testhubUtils[_0x3315d9(0x175)](_0x958c[_0x3315d9(0x189)]),logger[_0x3315d9(0x16e)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x3315d9(0x1c2)][_0x3315d9(0x158)]),_0x47801e;}static async[a119_0x19683d(0x14d)](_0x26a5f2){const _0x36b386=a119_0x19683d,_0x3383f2={'YGGKL':function(_0x394d16,_0x1b9e9c){return _0x394d16===_0x1b9e9c;},'NtrpY':_0x36b386(0x1b5),'MLsLQ':function(_0xaa96a8,_0x576686){return _0xaa96a8===_0x576686;},'JFIGk':_0x36b386(0x179),'oERqh':_0x36b386(0x18e),'ssZzv':_0x36b386(0x1be),'eJeed':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','YmKat':_0x36b386(0x1d9),'SIInW':_0x36b386(0x149),'AbuBK':function(_0x1d213c){return _0x1d213c();},'iPxdb':function(_0x4f986a,_0x31bb5f,_0x3910b3,_0x5c0b3c,_0x49e3f9,_0xae5ccb){return _0x4f986a(_0x31bb5f,_0x3910b3,_0x5c0b3c,_0x49e3f9,_0xae5ccb);},'yxvxu':_0x36b386(0x1a3),'lUAJm':'stopBuildUpstream\x20event\x20successful!','qNPSk':_0x36b386(0x18b)};!BrowserstackCLI[_0x36b386(0x1ac)]()[_0x36b386(0x1bb)]()&&await this[_0x36b386(0x1bc)](),await PerformanceTester['measureWrapper'](PerformanceEvents[_0x36b386(0x196)],async()=>{const _0x12b1ac=_0x36b386;if(_0x3383f2['YGGKL'](process[_0x12b1ac(0x1c2)][_0x12b1ac(0x1c4)],_0x3383f2['NtrpY'])||TestHubHandler[_0x12b1ac(0x146)]||bsSetupHelper['isUndefined'](process[_0x12b1ac(0x1c2)][testHubConstants[_0x12b1ac(0x1ad)]['BROWSERSTACK_TESTHUB_JWT']]))return;TestHubHandler[_0x12b1ac(0x146)]=!![],await RequestQueueHandler[_0x12b1ac(0x1ac)]()[_0x12b1ac(0x1ba)](),await SessionHandler[_0x12b1ac(0x151)]();if(_0x3383f2[_0x12b1ac(0x15b)](process['env'][testHubConstants[_0x12b1ac(0x1ad)][_0x12b1ac(0x153)]],_0x3383f2[_0x12b1ac(0x1b3)])||_0x3383f2[_0x12b1ac(0x15b)](process[_0x12b1ac(0x1c2)][testHubConstants['ENV_VAR'][_0x12b1ac(0x158)]],_0x3383f2['JFIGk'])){logger[_0x12b1ac(0x1ae)](_0x3383f2[_0x12b1ac(0x188)]);const _0x2f745e={};return _0x2f745e[_0x12b1ac(0x1cb)]=_0x3383f2[_0x12b1ac(0x1d5)],_0x2f745e['message']=_0x3383f2['eJeed'],_0x2f745e;}const _0x301096={'finished_at':new Date()[_0x12b1ac(0x1c8)](),'finished_metadata':[]};!!_0x26a5f2&&_0x301096[_0x3383f2[_0x12b1ac(0x187)]][_0x12b1ac(0x1cd)]({'reason':_0x3383f2[_0x12b1ac(0x18f)],'signal':_0x26a5f2,'failure_data':''});const _0xc84b34={'headers':_0x3383f2['AbuBK'](getDefaultHeaders)};try{const _0x58ba99=await _0x3383f2[_0x12b1ac(0x180)](nodeRequest,_0x3383f2[_0x12b1ac(0x1d8)],_0x12b1ac(0x1bf)+process[_0x12b1ac(0x1c2)][testHubConstants['ENV_VAR'][_0x12b1ac(0x158)]]+_0x12b1ac(0x18c),_0x301096,_0xc84b34,![]);if(_0x58ba99[_0x12b1ac(0x189)]&&_0x58ba99[_0x12b1ac(0x189)][_0x12b1ac(0x1be)]){const _0x13d185={};_0x13d185[_0x12b1ac(0x156)]=_0x58ba99[_0x12b1ac(0x189)]['error'];throw _0x13d185;}else{logger[_0x12b1ac(0x1ae)](_0x3383f2[_0x12b1ac(0x174)]);const _0x19dc53={};return _0x19dc53[_0x12b1ac(0x1cb)]=_0x3383f2['qNPSk'],_0x19dc53[_0x12b1ac(0x156)]='',_0x19dc53;}}catch(_0x3dcec0){_0x3dcec0[_0x12b1ac(0x191)]?logger[_0x12b1ac(0x1ae)](_0x12b1ac(0x172)+_0x3dcec0[_0x12b1ac(0x191)][_0x12b1ac(0x1cb)]+'\x20'+_0x3dcec0['response']['statusText']+'\x20'+JSON[_0x12b1ac(0x182)](_0x3dcec0[_0x12b1ac(0x191)][_0x12b1ac(0x189)])):logger[_0x12b1ac(0x1ae)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x3dcec0[_0x12b1ac(0x156)]||_0x3dcec0));const _0x536d70={};return _0x536d70[_0x12b1ac(0x1cb)]=_0x3383f2[_0x12b1ac(0x1d5)],_0x536d70[_0x12b1ac(0x156)]=_0x3dcec0[_0x12b1ac(0x156)]||_0x3dcec0[_0x12b1ac(0x191)]?_0x3dcec0['response']['status']+':'+_0x3dcec0['response'][_0x12b1ac(0x15a)]:_0x3dcec0,_0x536d70;}})();}}module[a119_0x19683d(0x176)]=TestHubHandler;
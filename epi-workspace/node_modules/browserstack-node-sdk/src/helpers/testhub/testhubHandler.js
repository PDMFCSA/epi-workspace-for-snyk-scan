const a119_0x4861c2=a119_0xef1c;(function(_0x5ad477,_0x498ea4){const _0x4c69b7=a119_0xef1c,_0x26e7ce=_0x5ad477();while(!![]){try{const _0x1a50cc=-parseInt(_0x4c69b7(0x1ee))/0x1+-parseInt(_0x4c69b7(0x1fb))/0x2+parseInt(_0x4c69b7(0x1e9))/0x3+-parseInt(_0x4c69b7(0x224))/0x4+-parseInt(_0x4c69b7(0x209))/0x5*(-parseInt(_0x4c69b7(0x1f1))/0x6)+-parseInt(_0x4c69b7(0x20a))/0x7+parseInt(_0x4c69b7(0x1de))/0x8;if(_0x1a50cc===_0x498ea4)break;else _0x26e7ce['push'](_0x26e7ce['shift']());}catch(_0x1ff156){_0x26e7ce['push'](_0x26e7ce['shift']());}}}(a119_0x1a1f,0xebb6d));const bsSetupHelper=require('../helper'),path=require(a119_0x4861c2(0x1e4)),util=require(a119_0x4861c2(0x219)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a119_0x4861c2(0x1df)),testHubConstants=require('./constants.js'),constants=require(a119_0x4861c2(0x20c)),RequestQueueHandler=require(a119_0x4861c2(0x232)),logger=require(a119_0x4861c2(0x1d5))[a119_0x4861c2(0x1e7)],SessionHandler=require(a119_0x4861c2(0x1fc)),PerformanceTester=require(a119_0x4861c2(0x1d8)),{TESTHUB_EVENTS:PerformanceEvents}=require(a119_0x4861c2(0x226)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),BrowserstackCLI=require('../../bin/v2/browserstackCLI'),{uploadTraceZip}=require(a119_0x4861c2(0x1da)),TestInfo=require('../../bin/v2/TestInfo.js'),OngoingEvents=new Set();function a119_0x1a1f(){const _0x298115=['All\x20trace\x20zip\x20send\x20events\x20complete','\x20framework','getGitMetaData','898960SwYRgx','setupPercy','jwt','6030Uczgss','info','getCentralUser','config','accessibility','START','auth','projectName','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','password','2020738gQdCDH','../test-observability/sessionHandler.js','allowScreenshot','measureWrapper','STOP','getProductMap','XHhFK','api/v1/builds/','percy','getInstance','authToken','MUNdH','ENV_VAR','getFrameworkDetails','7305YxusSX','6484499lKRMEq','BROWSERSTACK_TEST_OBSERVABILITY','../../bin/utils/constants.js','false','PERCY_SUPPORTED_FRAMEWORKS','BROWSERSTACK_CENTRAL_SCANNER_JWT','extractDataFromResponse','bmBFc','basename','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','isAccessibilityEnabled','buildDescription','BROWSERSTACK_TESTHUB_JWT','BROWSERSTACK_BUILD_RUN_IDENTIFIER','FXbfx','util','resolve','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','TESTHUB_BUILD_API','settings','stop','status','allSettled','OBSERVABILITY','format','error','1659692kODGac','generateBuildUpstreamData','../performance/constants','waitForBuildStatus','getAccessibilityOptions','accessibilityOptions','BS_TESTOPS_BUILD_COMPLETED','McPRP','success','getUserName','buildStopSent','buildHashedId','getConfig','ytkjd','../test-observability/requestQueueHandler.js','framework','yEUxc','checkAndSetupPercy','debug','toISOString','processTraceZips','exports','message','uploadPending','setAccessibilityVariables','zFUFe','stopBuildUpstream\x20event\x20successful!','response','BROWSERSTACK_TESTHUB_UUID','finished_metadata','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','true','nYTYc','Testhub\x20started\x20with\x20id:\x20','logBuildError','data','forEach','RzNcv','user_killed','POST','CjOSC','UewuD','isRunning','buildName','kKDJG','setTestObservabilityVariables','launchBuild','Wybvm','EjSFA','nSRwe','includes','username','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','PUT','token','getAccessibilityValueFromYml','push','job_id','lcnc','/stop','getCiInfo','ybRfE','TUFSC','getHostInfo','isUndefined','../logger','QyTlS','setTestHubCommonMetaInfo','../performance/performance-tester.js','Error\x20while\x20waiting\x20for\x20events:\x20','../../bin/playwright/reporter/pwUtils.js','ACCESSIBILITY','Rgkhp','WJmSU','6633896eyJiHE','./utils.js','statusText','isBrowserstackInfra','env','central_scanner','path','stringify','getProductMapForBuildStartCall','winstonLogger','BROWSERSTACK_ACCESSIBILITY','5755656jpJHPz','hvRzf'];a119_0x1a1f=function(){return _0x298115;};return a119_0x1a1f();}let processedTraceZips=![];function a119_0xef1c(_0x24387d,_0x2a29f6){const _0x1a1f06=a119_0x1a1f();return a119_0xef1c=function(_0xef1c61,_0x5a37a7){_0xef1c61=_0xef1c61-0x1d3;let _0x1d97a0=_0x1a1f06[_0xef1c61];return _0x1d97a0;},a119_0xef1c(_0x24387d,_0x2a29f6);}const addEvent=_0x368e96=>{OngoingEvents['add'](_0x368e96);},awaitAllEvents=async()=>{const _0x348eac=a119_0x4861c2;return Promise[_0x348eac(0x220)](OngoingEvents);};class TestHubHandler{static [a119_0x4861c2(0x22e)]=![];static async[a119_0x4861c2(0x252)](_0x2319c5,_0x588a4f){const _0x4b9eb0=a119_0x4861c2,_0x30de78={'ytkjd':function(_0x1f6f83,_0xfc40c8){return _0x1f6f83||_0xfc40c8;},'RzNcv':function(_0x3ea4be,_0x214b88){return _0x3ea4be===_0x214b88;},'EjSFA':function(_0x48b172){return _0x48b172();},'jYfDt':_0x4b9eb0(0x242),'bmBFc':_0x4b9eb0(0x20d),'UewuD':_0x4b9eb0(0x213),'ZzBdX':function(_0xd8c447,_0x4d01e1,_0x301c0e,_0x16e935,_0x384347){return _0xd8c447(_0x4d01e1,_0x301c0e,_0x16e935,_0x384347);},'yEUxc':_0x4b9eb0(0x24b),'jdKIC':'accessibility','zFUFe':_0x4b9eb0(0x243)};await PerformanceTester[_0x4b9eb0(0x1fe)](PerformanceEvents[_0x4b9eb0(0x1f6)],async()=>{const _0x584eb8=_0x4b9eb0,_0x4e2104=Object['assign']({},_0x588a4f[_0x584eb8(0x1f4)],{'root_dir_path':'','framework':_0x588a4f[_0x584eb8(0x233)]}),_0x3bd288=bsSetupHelper[_0x584eb8(0x22d)](_0x4e2104),_0x2e97d7=bsSetupHelper['getAccessKey'](_0x4e2104),_0x524c5d=_0x30de78[_0x584eb8(0x231)](_0x3bd288,'')+':'+_0x30de78['ytkjd'](_0x2e97d7,''),_0x153f8c=testhubUtils[_0x584eb8(0x200)](_0x4e2104);process['env']['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x584eb8(0x1e5)](_0x153f8c);if(_0x30de78[_0x584eb8(0x249)](_0x524c5d,':'))return _0x30de78[_0x584eb8(0x254)](isTestObservabilitySession)&&(logger['debug'](_0x30de78['jYfDt']),process[_0x584eb8(0x1e2)][_0x584eb8(0x22a)]=_0x30de78[_0x584eb8(0x211)]),testhubUtils[_0x584eb8(0x214)](_0x4e2104)&&logger['debug'](_0x30de78[_0x584eb8(0x24d)]),[null,null];try{const _0x743cf9=await this[_0x584eb8(0x225)](_0x4e2104,_0x2319c5),_0x3dbf1a=this[_0x584eb8(0x230)](_0x3bd288,_0x2e97d7),_0x132b95=await _0x30de78['ZzBdX'](nodeRequest,_0x30de78[_0x584eb8(0x234)],testHubConstants[_0x584eb8(0x21c)],_0x743cf9,_0x3dbf1a),_0x57bfef=this[_0x584eb8(0x210)](_0x4e2104,_0x132b95,_0x3dbf1a);await this[_0x584eb8(0x235)](_0x588a4f,_0x2319c5);if(_0x30de78['RzNcv'](testhubUtils[_0x584eb8(0x25b)](_0x588a4f[_0x584eb8(0x1f4)]),null)){const _0xf7e565=_0x57bfef[_0x30de78['jdKIC']];_0xf7e565&&_0xf7e565[_0x584eb8(0x205)]&&_0xf7e565[_0x584eb8(0x22f)]&&(_0x588a4f[_0x584eb8(0x1f4)][_0x584eb8(0x1f5)]=!![],process[_0x584eb8(0x1e2)][_0x584eb8(0x21b)]=_0x30de78[_0x584eb8(0x23d)]);}return _0x57bfef;}catch(_0x1357c6){if(_0x30de78[_0x584eb8(0x249)](_0x1357c6[_0x584eb8(0x22c)],![])){testhubUtils[_0x584eb8(0x246)](_0x1357c6);return;}}})();}static async['processTraceZips'](){const _0x3881a1=a119_0x4861c2,_0x482f84={'ufVFk':function(_0x3e37fe,_0x43101a,_0x60ab52){return _0x3e37fe(_0x43101a,_0x60ab52);},'nSRwe':function(_0x5de89b,_0x1a51a1){return _0x5de89b(_0x1a51a1);},'VyusJ':function(_0x1cf74e){return _0x1cf74e();},'McPRP':_0x3881a1(0x1eb)};if(processedTraceZips)return;const _0x5614e8=TestDetails['getTraceFilePaths']();_0x5614e8[_0x3881a1(0x248)](({testUId:_0x5aa26e,filePath:_0x1b7dd7})=>{const _0x13cd54=_0x3881a1;var _0x475922=_0x482f84['ufVFk'](uploadTraceZip,_0x1b7dd7,_0x5aa26e);_0x482f84[_0x13cd54(0x255)](addEvent,_0x475922);});try{await _0x482f84['VyusJ'](awaitAllEvents),logger[_0x3881a1(0x236)](_0x482f84[_0x3881a1(0x22b)]),processedTraceZips=!![];}catch(_0x3aeaf9){logger[_0x3881a1(0x223)](_0x3881a1(0x1d9)+util[_0x3881a1(0x222)](_0x3aeaf9));}}static async[a119_0x4861c2(0x235)](_0x4e2ba8,_0x1b3ea2){const _0x59b048=a119_0x4861c2;if(constants[_0x59b048(0x20e)][_0x59b048(0x256)](_0x1b3ea2)){await _0x4e2ba8[_0x59b048(0x1ef)]();return;}_0x4e2ba8[_0x59b048(0x1f4)][_0x59b048(0x203)]&&logger['debug']('Percy\x20is\x20not\x20supported\x20for\x20'+_0x1b3ea2+_0x59b048(0x1ec));}static['getAccessibilityOptions'](_0x39ac88){const _0x545839=a119_0x4861c2,_0x162b80={};_0x162b80[_0x545839(0x21d)]=_0x39ac88[_0x545839(0x229)];const _0xa7851=_0x162b80;return _0xa7851;}static['getConfig'](_0x4772e9,_0x4baed3){const _0x1e5e2d=a119_0x4861c2,_0xe899b7={'WJmSU':function(_0x450390,_0x212098){return _0x450390(_0x212098);}},_0x31668e={};return _0x31668e[_0x1e5e2d(0x257)]=_0x4772e9,_0x31668e[_0x1e5e2d(0x1fa)]=_0x4baed3,{'auth':_0x31668e,'headers':_0xe899b7[_0x1e5e2d(0x1dd)](getDefaultHeaders,![])};}static async[a119_0x4861c2(0x225)](_0x3acafa,_0x1d6ad9){const _0x5db248=a119_0x4861c2,_0x24c932={'AZsKR':function(_0x4447be,_0x2a0e8d){return _0x4447be(_0x2a0e8d);}},_0x5eb2e9={'project_name':_0x3acafa[_0x5db248(0x1f8)]||'','name':_0x3acafa[_0x5db248(0x24f)]||path[_0x5db248(0x212)](path[_0x5db248(0x21a)](process['cwd']())),'build_identifier':_0x3acafa['buildIdentifier'],'description':_0x3acafa[_0x5db248(0x215)]||'','started_at':new Date()[_0x5db248(0x237)](),'tags':_0x24c932['AZsKR'](getCustomTags,_0x3acafa),'host_info':bsSetupHelper[_0x5db248(0x1d3)](),'ci_info':bsSetupHelper[_0x5db248(0x260)](),'build_run_identifier':process[_0x5db248(0x1e2)][_0x5db248(0x217)],'failed_tests_rerun':process['env']['BROWSERSTACK_RERUN']||![],'version_control':await bsSetupHelper[_0x5db248(0x1ed)](),'accessibility':this[_0x5db248(0x228)](_0x3acafa),'framework_details':testhubUtils[_0x5db248(0x208)](_0x3acafa,_0x1d6ad9),'product_map':testhubUtils[_0x5db248(0x1e6)](_0x3acafa),'browserstackAutomation':bsSetupHelper[_0x5db248(0x1e1)](),'grouping_identifier':process[_0x5db248(0x1e2)]['BROWSERSTACK_BUILD_GROUPING_IDENTIFIER']};if(bsSetupHelper[_0x5db248(0x1f3)]()['central_scanner']||bsSetupHelper[_0x5db248(0x1f3)]()[_0x5db248(0x25e)]){const _0x538022={};_0x538022[_0x5db248(0x25d)]=process['env']['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0x538022[_0x5db248(0x25a)]=process[_0x5db248(0x1e2)][_0x5db248(0x20f)],_0x5eb2e9[_0x5db248(0x1e3)]=_0x538022;}return _0x5eb2e9;}static[a119_0x4861c2(0x210)](_0x273c18,_0x3ba5ef,_0x3b920c){const _0x24b2ca=a119_0x4861c2,_0x4dcfd1={'XXadR':function(_0x5492d0){return _0x5492d0();},'CjOSC':function(_0x40d082,_0x580da2){return _0x40d082&&_0x580da2;},'MUNdH':'true','Rgkhp':_0x24b2ca(0x20d)},_0x4a417c={};if(_0x4dcfd1['XXadR'](isTestObservabilitySession)){const [_0x3bda1,_0x298364,_0xdbd6c8]=testhubUtils[_0x24b2ca(0x251)](_0x3ba5ef[_0x24b2ca(0x247)],_0x3b920c[_0x24b2ca(0x1f7)]);if(_0x4dcfd1[_0x24b2ca(0x24c)](_0x3bda1,_0x298364)){const _0x34891b={};_0x34891b[_0x24b2ca(0x1f0)]=_0x3bda1,_0x34891b[_0x24b2ca(0x22f)]=_0x298364,_0x34891b[_0x24b2ca(0x1fd)]=_0xdbd6c8,_0x4a417c[testHubConstants['OBSERVABILITY']]=_0x34891b,process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x4dcfd1[_0x24b2ca(0x206)];}else _0x4a417c[testHubConstants[_0x24b2ca(0x221)]]={},process['env'][_0x24b2ca(0x20b)]=_0x4dcfd1[_0x24b2ca(0x1dc)];}else process['env'][_0x24b2ca(0x20b)]=_0x4dcfd1[_0x24b2ca(0x1dc)];const [_0x42e2e4,_0x55d4cb]=testhubUtils[_0x24b2ca(0x23c)](_0x3ba5ef['data']);if(_0x4dcfd1['CjOSC'](_0x42e2e4,_0x55d4cb)){const _0x43ef56={};_0x43ef56[_0x24b2ca(0x205)]=_0x42e2e4,_0x43ef56[_0x24b2ca(0x22f)]=_0x55d4cb,_0x4a417c[testHubConstants[_0x24b2ca(0x1db)]]=_0x43ef56,process[_0x24b2ca(0x1e2)][_0x24b2ca(0x1e8)]=_0x4dcfd1[_0x24b2ca(0x206)];}else _0x4a417c[testHubConstants[_0x24b2ca(0x1db)]]={},process[_0x24b2ca(0x1e2)][_0x24b2ca(0x1e8)]=_0x4dcfd1[_0x24b2ca(0x1dc)];return testhubUtils[_0x24b2ca(0x1d7)](_0x3ba5ef['data']),logger[_0x24b2ca(0x1f2)](_0x24b2ca(0x245)+process[_0x24b2ca(0x1e2)][_0x24b2ca(0x240)]),_0x4a417c;}static async[a119_0x4861c2(0x21e)](_0x4402d6){const _0x3536d2=a119_0x4861c2,_0x956def={'hvRzf':function(_0x1df113,_0x492780){return _0x1df113===_0x492780;},'kKDJG':'false','Wybvm':'null','QyTlS':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','XHhFK':_0x3536d2(0x223),'FXbfx':_0x3536d2(0x258),'SymyV':_0x3536d2(0x241),'TUFSC':_0x3536d2(0x24a),'dDkGK':function(_0x1415dc){return _0x1415dc();},'rtYJz':function(_0x258df9,_0x5a3833,_0x194a0a,_0x3d8cb6,_0x197b29,_0x38cf76){return _0x258df9(_0x5a3833,_0x194a0a,_0x3d8cb6,_0x197b29,_0x38cf76);},'ybRfE':_0x3536d2(0x259),'SJwyw':_0x3536d2(0x23e),'nYTYc':_0x3536d2(0x22c)};!BrowserstackCLI['getInstance']()[_0x3536d2(0x24e)]()&&await this[_0x3536d2(0x238)](),await PerformanceTester[_0x3536d2(0x1fe)](PerformanceEvents[_0x3536d2(0x1ff)],async()=>{const _0x2a252e=_0x3536d2;if(_0x956def[_0x2a252e(0x1ea)](process[_0x2a252e(0x1e2)][_0x2a252e(0x22a)],_0x956def[_0x2a252e(0x250)])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x2a252e(0x1d4)](process[_0x2a252e(0x1e2)][testHubConstants[_0x2a252e(0x207)][_0x2a252e(0x216)]]))return;TestHubHandler[_0x2a252e(0x22e)]=!![],await RequestQueueHandler[_0x2a252e(0x204)]()[_0x2a252e(0x23b)](),await SessionHandler[_0x2a252e(0x227)]();if(_0x956def['hvRzf'](process[_0x2a252e(0x1e2)][testHubConstants[_0x2a252e(0x207)][_0x2a252e(0x216)]],_0x956def[_0x2a252e(0x253)])||_0x956def[_0x2a252e(0x1ea)](process[_0x2a252e(0x1e2)][testHubConstants[_0x2a252e(0x207)][_0x2a252e(0x240)]],_0x956def['Wybvm'])){logger[_0x2a252e(0x236)](_0x956def[_0x2a252e(0x1d6)]);const _0x3a3c3a={};return _0x3a3c3a[_0x2a252e(0x21f)]=_0x956def['XHhFK'],_0x3a3c3a[_0x2a252e(0x23a)]=_0x956def[_0x2a252e(0x218)],_0x3a3c3a;}const _0x5dc807={'finished_at':new Date()[_0x2a252e(0x237)](),'finished_metadata':[]};!!_0x4402d6&&_0x5dc807[_0x956def['SymyV']][_0x2a252e(0x25c)]({'reason':_0x956def[_0x2a252e(0x262)],'signal':_0x4402d6,'failure_data':''});const _0x152dfe={'headers':_0x956def['dDkGK'](getDefaultHeaders)};try{const _0x31f0bd=await _0x956def['rtYJz'](nodeRequest,_0x956def[_0x2a252e(0x261)],_0x2a252e(0x202)+process[_0x2a252e(0x1e2)][testHubConstants[_0x2a252e(0x207)]['BROWSERSTACK_TESTHUB_UUID']]+_0x2a252e(0x25f),_0x5dc807,_0x152dfe,![]);if(_0x31f0bd[_0x2a252e(0x247)]&&_0x31f0bd[_0x2a252e(0x247)][_0x2a252e(0x223)]){const _0x4e4f77={};_0x4e4f77[_0x2a252e(0x23a)]=_0x31f0bd[_0x2a252e(0x247)]['error'];throw _0x4e4f77;}else{logger['debug'](_0x956def['SJwyw']);const _0x1d3c0a={};return _0x1d3c0a['status']=_0x956def[_0x2a252e(0x244)],_0x1d3c0a[_0x2a252e(0x23a)]='',_0x1d3c0a;}}catch(_0x3be82a){_0x3be82a['response']?logger['debug'](_0x2a252e(0x1f9)+_0x3be82a[_0x2a252e(0x23f)]['status']+'\x20'+_0x3be82a[_0x2a252e(0x23f)][_0x2a252e(0x1e0)]+'\x20'+JSON[_0x2a252e(0x1e5)](_0x3be82a[_0x2a252e(0x23f)][_0x2a252e(0x247)])):logger[_0x2a252e(0x236)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x3be82a[_0x2a252e(0x23a)]||_0x3be82a));const _0x45efd2={};return _0x45efd2[_0x2a252e(0x21f)]=_0x956def[_0x2a252e(0x201)],_0x45efd2[_0x2a252e(0x23a)]=_0x3be82a[_0x2a252e(0x23a)]||_0x3be82a[_0x2a252e(0x23f)]?_0x3be82a[_0x2a252e(0x23f)][_0x2a252e(0x21f)]+':'+_0x3be82a[_0x2a252e(0x23f)][_0x2a252e(0x1e0)]:_0x3be82a,_0x45efd2;}})();}}module[a119_0x4861c2(0x239)]=TestHubHandler;
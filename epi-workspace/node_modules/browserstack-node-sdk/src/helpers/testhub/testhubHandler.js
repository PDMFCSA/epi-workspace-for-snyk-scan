const a90_0x404463=a90_0xa668;(function(_0x3c9026,_0x3d4ff9){const _0x583dfd=a90_0xa668,_0x58a497=_0x3c9026();while(!![]){try{const _0x313531=-parseInt(_0x583dfd(0xee))/0x1+parseInt(_0x583dfd(0xe9))/0x2+-parseInt(_0x583dfd(0xbf))/0x3+parseInt(_0x583dfd(0xae))/0x4+parseInt(_0x583dfd(0xd3))/0x5+-parseInt(_0x583dfd(0xb1))/0x6*(parseInt(_0x583dfd(0xcf))/0x7)+-parseInt(_0x583dfd(0xc6))/0x8*(-parseInt(_0x583dfd(0x110))/0x9);if(_0x313531===_0x3d4ff9)break;else _0x58a497['push'](_0x58a497['shift']());}catch(_0x12885c){_0x58a497['push'](_0x58a497['shift']());}}}(a90_0x365d,0xa155b));const bsSetupHelper=require(a90_0x404463(0xed)),path=require(a90_0x404463(0xd4)),util=require(a90_0x404463(0x9d)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x404463(0xbd)),testhubUtils=require(a90_0x404463(0xfd)),testHubConstants=require('./constants.js'),constants=require(a90_0x404463(0xa4)),RequestQueueHandler=require(a90_0x404463(0xbe)),logger=require('../logger')[a90_0x404463(0xd0)],SessionHandler=require(a90_0x404463(0xfa)),PerformanceTester=require(a90_0x404463(0x95)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require('../../bin/playwright/reporter/test-details.js'),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),OngoingEvents=new Set();function a90_0xa668(_0x2aa4f7,_0x5e60c5){const _0x365d8f=a90_0x365d();return a90_0xa668=function(_0xa668af,_0x3413f0){_0xa668af=_0xa668af-0x95;let _0x2cdeb0=_0x365d8f[_0xa668af];return _0x2cdeb0;},a90_0xa668(_0x2aa4f7,_0x5e60c5);}let processedTraceZips=![];const addEvent=_0x2063fe=>{OngoingEvents['add'](_0x2063fe);},awaitAllEvents=async()=>{const _0xc38846=a90_0x404463;return Promise[_0xc38846(0xd1)](OngoingEvents);};class TestHubHandler{static [a90_0x404463(0x9e)]=![];static async[a90_0x404463(0xd6)](_0x2bef8e,_0x1f2be5){const _0x199c8c=a90_0x404463,_0x2647de={'VPkPz':function(_0x10763b,_0x40baf2){return _0x10763b||_0x40baf2;},'GODfy':function(_0x12552b,_0xdf6327){return _0x12552b===_0xdf6327;},'CAqvw':function(_0x5b0b02){return _0x5b0b02();},'mEztk':'EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','AQtZG':_0x199c8c(0xc7),'gJXxO':_0x199c8c(0xdc),'ITMuw':function(_0x4e6330,_0x553916,_0x12c666,_0x574284,_0x1a1f04){return _0x4e6330(_0x553916,_0x12c666,_0x574284,_0x1a1f04);},'mTYnJ':'POST','iWWWq':function(_0x459980,_0x1f2fd7){return _0x459980===_0x1f2fd7;}};await PerformanceTester[_0x199c8c(0xce)](PerformanceEvents[_0x199c8c(0xf6)],async()=>{const _0x197d35=_0x199c8c,_0x46a2ef=Object[_0x197d35(0xb7)]({},_0x1f2be5['config'],{'root_dir_path':'','framework':_0x1f2be5[_0x197d35(0xd8)]}),_0x2dad31=bsSetupHelper[_0x197d35(0xf4)](_0x46a2ef),_0xd31876=bsSetupHelper['getAccessKey'](_0x46a2ef),_0x20dc7c=_0x2647de[_0x197d35(0xb6)](_0x2dad31,'')+':'+_0x2647de[_0x197d35(0xb6)](_0xd31876,''),_0xcccea0=testhubUtils[_0x197d35(0xac)](_0x46a2ef);process['env'][_0x197d35(0xa1)]=JSON[_0x197d35(0xdf)](_0xcccea0);if(_0x2647de[_0x197d35(0xef)](_0x20dc7c,':'))return _0x2647de['CAqvw'](isTestObservabilitySession)&&(logger[_0x197d35(0xcd)](_0x2647de[_0x197d35(0x9c)]),process[_0x197d35(0xc5)][_0x197d35(0xe5)]=_0x2647de['AQtZG']),testhubUtils['isAccessibilityEnabled'](_0x46a2ef)&&logger['debug'](_0x2647de[_0x197d35(0xcc)]),[null,null];try{const _0x7a2bb2=await this['generateBuildUpstreamData'](_0x46a2ef,_0x2bef8e),_0x24fbde=this[_0x197d35(0x100)](_0x2dad31,_0xd31876),_0x2cde17=await _0x2647de[_0x197d35(0xeb)](nodeRequest,_0x2647de[_0x197d35(0x10b)],testHubConstants[_0x197d35(0xf7)],_0x7a2bb2,_0x24fbde),_0x513cd8=this['extractDataFromResponse'](_0x46a2ef,_0x2cde17,_0x24fbde);return await this[_0x197d35(0xa3)](_0x1f2be5,_0x2bef8e),_0x513cd8;}catch(_0x51652d){if(_0x2647de[_0x197d35(0xaa)](_0x51652d[_0x197d35(0xda)],![])){testhubUtils[_0x197d35(0xff)](_0x51652d);return;}}})();}static async[a90_0x404463(0x97)](){const _0x4e16d2=a90_0x404463,_0x26b9a8={'rtbQj':function(_0x4fdde0,_0x1ea92b,_0x39a0c5){return _0x4fdde0(_0x1ea92b,_0x39a0c5);},'oOkDC':function(_0x9da02e,_0x2254c4){return _0x9da02e(_0x2254c4);},'Yossx':function(_0x59d280){return _0x59d280();},'eAaAw':_0x4e16d2(0xe4)};if(processedTraceZips)return;const _0x16436b=TestDetails[_0x4e16d2(0x108)]();_0x16436b[_0x4e16d2(0x104)](({testUId:_0xe32c77,filePath:_0x4bed82})=>{const _0x1c4c07=_0x4e16d2;var _0x9ea9d5=_0x26b9a8['rtbQj'](uploadTraceZip,_0x4bed82,_0xe32c77);_0x26b9a8[_0x1c4c07(0xf9)](addEvent,_0x9ea9d5);});try{await _0x26b9a8[_0x4e16d2(0x10a)](awaitAllEvents),logger['debug'](_0x26b9a8[_0x4e16d2(0xdb)]),processedTraceZips=!![];}catch(_0x135c86){logger['error']('Error\x20while\x20waiting\x20for\x20events:\x20'+util['format'](_0x135c86));}}static async[a90_0x404463(0xa3)](_0x1d5697,_0x1169a7){const _0x4ea6ca=a90_0x404463;if(constants['PERCY_SUPPORTED_FRAMEWORKS']['includes'](_0x1169a7)){await _0x1d5697[_0x4ea6ca(0x10c)]();return;}_0x1d5697[_0x4ea6ca(0x10e)]['percy']&&logger['debug']('Percy\x20is\x20not\x20supported\x20for\x20'+_0x1169a7+_0x4ea6ca(0xd2));}static[a90_0x404463(0xc1)](_0x5d13b0){const _0x54747e=a90_0x404463,_0x243844={};_0x243844['settings']=_0x5d13b0[_0x54747e(0xb9)];const _0x5a1725=_0x243844;return _0x5a1725;}static[a90_0x404463(0x100)](_0x449a03,_0x4d1406){const _0x1f779d=a90_0x404463,_0x3bf1e2={'fSbAk':function(_0x3fe43b,_0x4fceff){return _0x3fe43b(_0x4fceff);}},_0x4dd4c9={};return _0x4dd4c9['username']=_0x449a03,_0x4dd4c9[_0x1f779d(0x107)]=_0x4d1406,{'auth':_0x4dd4c9,'headers':_0x3bf1e2[_0x1f779d(0xba)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x3aae38,_0x5ccba9){const _0x1b61ad=a90_0x404463,_0x4538bc={'TSDEO':function(_0x4725ab,_0x99a02b){return _0x4725ab(_0x99a02b);}},_0x526bdf={'project_name':_0x3aae38[_0x1b61ad(0xc4)]||'','name':_0x3aae38[_0x1b61ad(0x98)]||path[_0x1b61ad(0xbb)](path['resolve'](process[_0x1b61ad(0xd7)]())),'build_identifier':_0x3aae38[_0x1b61ad(0xa5)],'description':_0x3aae38['buildDescription']||'','started_at':new Date()[_0x1b61ad(0x109)](),'tags':_0x4538bc['TSDEO'](getCustomTags,_0x3aae38),'host_info':bsSetupHelper[_0x1b61ad(0x96)](),'ci_info':bsSetupHelper[_0x1b61ad(0xa0)](),'build_run_identifier':process[_0x1b61ad(0xc5)][_0x1b61ad(0xc2)],'failed_tests_rerun':process[_0x1b61ad(0xc5)]['BROWSERSTACK_RERUN']||![],'version_control':await bsSetupHelper[_0x1b61ad(0xfb)](),'accessibility':this[_0x1b61ad(0xc1)](_0x3aae38),'framework_details':testhubUtils[_0x1b61ad(0x10d)](_0x3aae38,_0x5ccba9),'product_map':testhubUtils[_0x1b61ad(0xac)](_0x3aae38),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra'](),'grouping_identifier':process[_0x1b61ad(0xc5)][_0x1b61ad(0x113)]};if(bsSetupHelper[_0x1b61ad(0x99)]()[_0x1b61ad(0xd5)]||bsSetupHelper[_0x1b61ad(0x99)]()[_0x1b61ad(0xec)]){const _0x32fa70={};_0x32fa70[_0x1b61ad(0x103)]=process[_0x1b61ad(0xc5)][_0x1b61ad(0xe6)],_0x32fa70[_0x1b61ad(0x112)]=process[_0x1b61ad(0xc5)][_0x1b61ad(0xa2)],_0x526bdf['central_scanner']=_0x32fa70;}return _0x526bdf;}static[a90_0x404463(0xb5)](_0x3c5f91,_0x4e42a1,_0x3f4909){const _0x41e38b=a90_0x404463,_0x26e3ae={'rsEAP':function(_0x47f581){return _0x47f581();},'FlvRk':function(_0x5f5d68,_0x3c1d88){return _0x5f5d68&&_0x3c1d88;},'JCUSq':'true','WxGQc':_0x41e38b(0xc7),'EjZUl':function(_0x51a8f9,_0x14ce7d){return _0x51a8f9&&_0x14ce7d;}},_0x5ab2ff={};if(_0x26e3ae[_0x41e38b(0xea)](isTestObservabilitySession)){const [_0x429fad,_0x1b7988,_0x56cea6]=testhubUtils[_0x41e38b(0xb4)](_0x4e42a1[_0x41e38b(0x101)],_0x3f4909[_0x41e38b(0xe3)]);if(_0x26e3ae['FlvRk'](_0x429fad,_0x1b7988)){const _0x47aad0={};_0x47aad0[_0x41e38b(0xab)]=_0x429fad,_0x47aad0['buildHashedId']=_0x1b7988,_0x47aad0[_0x41e38b(0xfc)]=_0x56cea6,_0x5ab2ff[testHubConstants[_0x41e38b(0xc8)]]=_0x47aad0,process[_0x41e38b(0xc5)][_0x41e38b(0xc0)]=_0x26e3ae['JCUSq'];}else _0x5ab2ff[testHubConstants[_0x41e38b(0xc8)]]={},process[_0x41e38b(0xc5)][_0x41e38b(0xc0)]=_0x26e3ae[_0x41e38b(0x102)];}else process[_0x41e38b(0xc5)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x26e3ae[_0x41e38b(0x102)];if(testhubUtils[_0x41e38b(0xcb)](_0x3c5f91)){const [_0x866ae4,_0x3201f7]=testhubUtils['setAccessibilityVariables'](_0x4e42a1[_0x41e38b(0x101)]);if(_0x26e3ae[_0x41e38b(0x10f)](_0x866ae4,_0x3201f7)){const _0x5aa128={};_0x5aa128[_0x41e38b(0xf5)]=_0x866ae4,_0x5aa128['buildHashedId']=_0x3201f7,_0x5ab2ff[testHubConstants[_0x41e38b(0xad)]]=_0x5aa128,process[_0x41e38b(0xc5)]['BROWSERSTACK_ACCESSIBILITY']=_0x26e3ae[_0x41e38b(0xaf)];}else _0x5ab2ff[testHubConstants[_0x41e38b(0xad)]]={},process[_0x41e38b(0xc5)][_0x41e38b(0xb0)]=_0x26e3ae[_0x41e38b(0x102)];}else process['env'][_0x41e38b(0xb0)]=_0x26e3ae[_0x41e38b(0x102)];return testhubUtils['setTestHubCommonMetaInfo'](_0x4e42a1['data']),logger[_0x41e38b(0xc9)](_0x41e38b(0xb3)+process['env']['BROWSERSTACK_TESTHUB_UUID']),_0x5ab2ff;}static async[a90_0x404463(0xc3)](_0x4f7270){const _0x3d11e6=a90_0x404463,_0x5cef12={'jzqix':function(_0x50c500,_0x143e18){return _0x50c500===_0x143e18;},'EUvaT':'false','zxHUa':function(_0x5266a5,_0x491d18){return _0x5266a5===_0x491d18;},'znVMj':'null','GTSCB':function(_0x374720,_0x2c518c){return _0x374720===_0x2c518c;},'DkoiS':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','aMFLF':_0x3d11e6(0xa9),'NXFZP':_0x3d11e6(0xf1),'VgvpD':_0x3d11e6(0xa8),'ALMxQ':'user_killed','BVoSw':function(_0x7018b7){return _0x7018b7();},'ETdwS':function(_0x37a1fc,_0x3e1a38,_0xfdf3a8,_0x42cbf4,_0x444b59,_0xcc8698){return _0x37a1fc(_0x3e1a38,_0xfdf3a8,_0x42cbf4,_0x444b59,_0xcc8698);},'nPaRH':'PUT','tSKkT':'stopBuildUpstream\x20event\x20successful!','yukoZ':_0x3d11e6(0xda)};await this['processTraceZips'](),await PerformanceTester[_0x3d11e6(0xce)](PerformanceEvents['STOP'],async()=>{const _0x54b9a6=_0x3d11e6;if(_0x5cef12[_0x54b9a6(0x9b)](process[_0x54b9a6(0xc5)][_0x54b9a6(0xe5)],_0x5cef12[_0x54b9a6(0x9a)])||TestHubHandler[_0x54b9a6(0x9e)]||bsSetupHelper['isUndefined'](process[_0x54b9a6(0xc5)][testHubConstants['ENV_VAR'][_0x54b9a6(0xe2)]]))return;TestHubHandler[_0x54b9a6(0x9e)]=!![],await RequestQueueHandler['getInstance']()[_0x54b9a6(0xf2)](),await SessionHandler[_0x54b9a6(0x106)]();if(_0x5cef12['zxHUa'](process[_0x54b9a6(0xc5)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_JWT']],_0x5cef12['znVMj'])||_0x5cef12[_0x54b9a6(0xf0)](process[_0x54b9a6(0xc5)][testHubConstants[_0x54b9a6(0xa6)]['BROWSERSTACK_TESTHUB_UUID']],_0x5cef12['znVMj'])){logger[_0x54b9a6(0xcd)](_0x5cef12[_0x54b9a6(0xf3)]);const _0x3738bd={};return _0x3738bd[_0x54b9a6(0xde)]=_0x5cef12[_0x54b9a6(0x111)],_0x3738bd[_0x54b9a6(0xa7)]=_0x5cef12[_0x54b9a6(0x9f)],_0x3738bd;}const _0x1b0e05={'finished_at':new Date()[_0x54b9a6(0x109)](),'finished_metadata':[]};!!_0x4f7270&&_0x1b0e05[_0x5cef12[_0x54b9a6(0xe7)]][_0x54b9a6(0x105)]({'reason':_0x5cef12[_0x54b9a6(0xb2)],'signal':_0x4f7270,'failure_data':''});const _0x5732a5={'headers':_0x5cef12[_0x54b9a6(0xe1)](getDefaultHeaders)};try{const _0x43c48e=await _0x5cef12[_0x54b9a6(0xe0)](nodeRequest,_0x5cef12[_0x54b9a6(0xd9)],_0x54b9a6(0xbc)+process[_0x54b9a6(0xc5)][testHubConstants[_0x54b9a6(0xa6)][_0x54b9a6(0xdd)]]+_0x54b9a6(0xe8),_0x1b0e05,_0x5732a5,![]);if(_0x43c48e[_0x54b9a6(0x101)]&&_0x43c48e[_0x54b9a6(0x101)][_0x54b9a6(0xa9)]){const _0x523a7e={};_0x523a7e[_0x54b9a6(0xa7)]=_0x43c48e['data'][_0x54b9a6(0xa9)];throw _0x523a7e;}else{logger[_0x54b9a6(0xcd)](_0x5cef12[_0x54b9a6(0xb8)]);const _0x22a0de={};return _0x22a0de['status']=_0x5cef12['yukoZ'],_0x22a0de[_0x54b9a6(0xa7)]='',_0x22a0de;}}catch(_0x245bb3){_0x245bb3[_0x54b9a6(0xf8)]?logger[_0x54b9a6(0xcd)](_0x54b9a6(0xca)+_0x245bb3[_0x54b9a6(0xf8)][_0x54b9a6(0xde)]+'\x20'+_0x245bb3['response']['statusText']+'\x20'+JSON['stringify'](_0x245bb3[_0x54b9a6(0xf8)][_0x54b9a6(0x101)])):logger[_0x54b9a6(0xcd)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x245bb3[_0x54b9a6(0xa7)]||_0x245bb3));const _0x5448ea={};return _0x5448ea[_0x54b9a6(0xde)]=_0x5cef12[_0x54b9a6(0x111)],_0x5448ea[_0x54b9a6(0xa7)]=_0x245bb3[_0x54b9a6(0xa7)]||_0x245bb3[_0x54b9a6(0xf8)]?_0x245bb3['response'][_0x54b9a6(0xde)]+':'+_0x245bb3[_0x54b9a6(0xf8)]['statusText']:_0x245bb3,_0x5448ea;}})();}}function a90_0x365d(){const _0x4e4192=['setTestObservabilityVariables','extractDataFromResponse','VPkPz','assign','tSKkT','accessibilityOptions','fSbAk','basename','api/v1/builds/','../test-observability/utils','../test-observability/requestQueueHandler.js','2166342EMyaxs','BROWSERSTACK_TEST_OBSERVABILITY','getAccessibilityOptions','BROWSERSTACK_BUILD_RUN_IDENTIFIER','stop','projectName','env','5721624yExxCq','false','OBSERVABILITY','info','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','isAccessibilityEnabled','gJXxO','debug','measureWrapper','3289993quANTp','winstonLogger','allSettled','\x20framework','572125WdQcXk','path','central_scanner','launchBuild','cwd','framework','nPaRH','success','eAaAw','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','BROWSERSTACK_TESTHUB_UUID','status','stringify','ETdwS','BVoSw','BROWSERSTACK_TESTHUB_JWT','auth','All\x20trace\x20zip\x20send\x20events\x20complete','BS_TESTOPS_BUILD_COMPLETED','BROWSERSTACK_CENTRAL_SCANNER_JOBID','VgvpD','/stop','1509342ItqNlN','rsEAP','ITMuw','lcnc','../helper','458073LWFPEw','GODfy','GTSCB','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','uploadPending','DkoiS','getUserName','authToken','START','TESTHUB_BUILD_API','response','oOkDC','../test-observability/sessionHandler.js','getGitMetaData','allowScreenshot','./utils.js','exports','logBuildError','getConfig','data','WxGQc','job_id','forEach','push','waitForBuildStatus','password','getTraceFilePaths','toISOString','Yossx','mTYnJ','setupPercy','getFrameworkDetails','config','EjZUl','9TMZxvu','aMFLF','token','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','../performance/performance-tester.js','getHostInfo','processTraceZips','buildName','getCentralUser','EUvaT','jzqix','mEztk','util','buildStopSent','NXFZP','getCiInfo','BROWSERSTACK_PRODUCT_MAP','BROWSERSTACK_CENTRAL_SCANNER_JWT','checkAndSetupPercy','../../bin/utils/constants.js','buildIdentifier','ENV_VAR','message','finished_metadata','error','iWWWq','jwt','getProductMap','ACCESSIBILITY','2906856ifPTct','JCUSq','BROWSERSTACK_ACCESSIBILITY','6VfAWRA','ALMxQ','Testhub\x20started\x20with\x20id:\x20'];a90_0x365d=function(){return _0x4e4192;};return a90_0x365d();}module[a90_0x404463(0xfe)]=TestHubHandler;
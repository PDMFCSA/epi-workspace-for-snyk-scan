const a90_0x1030e3=a90_0x100b;(function(_0x1a1b2f,_0x45af56){const _0x58a90f=a90_0x100b,_0x3a2eb0=_0x1a1b2f();while(!![]){try{const _0x2d81e5=-parseInt(_0x58a90f(0x169))/0x1*(parseInt(_0x58a90f(0x11f))/0x2)+parseInt(_0x58a90f(0x16e))/0x3*(parseInt(_0x58a90f(0x137))/0x4)+parseInt(_0x58a90f(0x198))/0x5*(parseInt(_0x58a90f(0x11e))/0x6)+parseInt(_0x58a90f(0x15f))/0x7+parseInt(_0x58a90f(0x157))/0x8*(parseInt(_0x58a90f(0x134))/0x9)+-parseInt(_0x58a90f(0x12b))/0xa*(-parseInt(_0x58a90f(0x15e))/0xb)+-parseInt(_0x58a90f(0x150))/0xc;if(_0x2d81e5===_0x45af56)break;else _0x3a2eb0['push'](_0x3a2eb0['shift']());}catch(_0x1bf468){_0x3a2eb0['push'](_0x3a2eb0['shift']());}}}(a90_0x1dba,0x391e1));const bsSetupHelper=require(a90_0x1030e3(0x15b)),path=require('path'),util=require(a90_0x1030e3(0x13a)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x1030e3(0x136)),testhubUtils=require('./utils.js'),testHubConstants=require(a90_0x1030e3(0x119)),constants=require(a90_0x1030e3(0x179)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a90_0x1030e3(0x11a))[a90_0x1030e3(0x163)],SessionHandler=require(a90_0x1030e3(0x116)),PerformanceTester=require(a90_0x1030e3(0x192)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a90_0x1030e3(0x174)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),OngoingEvents=new Set();function a90_0x100b(_0x34d287,_0x47885){const _0x1dbadb=a90_0x1dba();return a90_0x100b=function(_0x100b5a,_0x2fbdf7){_0x100b5a=_0x100b5a-0x116;let _0x366bec=_0x1dbadb[_0x100b5a];return _0x366bec;},a90_0x100b(_0x34d287,_0x47885);}let processedTraceZips=![];const addEvent=_0xbf12ea=>{const _0x342974=a90_0x1030e3;OngoingEvents[_0x342974(0x165)](_0xbf12ea);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};class TestHubHandler{static [a90_0x1030e3(0x160)]=![];static async[a90_0x1030e3(0x13b)](_0x549c79,_0x4b453c){const _0x147211=a90_0x1030e3,_0x1fda81={'JeZmx':function(_0x48d0a7,_0xe86b34){return _0x48d0a7||_0xe86b34;},'WxwZU':function(_0x5d5c95,_0x38aa9a){return _0x5d5c95||_0x38aa9a;},'IRKEl':function(_0x27be8d,_0x44414c){return _0x27be8d===_0x44414c;},'aaTnD':function(_0x2f9977){return _0x2f9977();},'QePUb':_0x147211(0x123),'buVjU':_0x147211(0x17e),'xKVfn':_0x147211(0x126),'LtRUU':function(_0x10ff56,_0x1c2ede,_0x2ad0dd,_0x4b731e,_0x4ef334){return _0x10ff56(_0x1c2ede,_0x2ad0dd,_0x4b731e,_0x4ef334);},'Xerbi':_0x147211(0x16f)};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x147211(0x12f)],async()=>{const _0x4686dd=_0x147211,_0x1de0e3=Object[_0x4686dd(0x141)]({},_0x4b453c[_0x4686dd(0x153)],{'root_dir_path':'','framework':_0x4b453c['framework']}),_0x146b97=bsSetupHelper[_0x4686dd(0x162)](_0x1de0e3),_0x41e358=bsSetupHelper[_0x4686dd(0x188)](_0x1de0e3),_0x4bc348=_0x1fda81[_0x4686dd(0x17b)](_0x146b97,'')+':'+_0x1fda81['WxwZU'](_0x41e358,''),_0x997847=testhubUtils[_0x4686dd(0x16a)](_0x1de0e3);process[_0x4686dd(0x13c)]['BROWSERSTACK_PRODUCT_MAP']=JSON['stringify'](_0x997847);if(_0x1fda81[_0x4686dd(0x191)](_0x4bc348,':'))return _0x1fda81[_0x4686dd(0x175)](isTestObservabilitySession)&&(logger[_0x4686dd(0x159)](_0x1fda81[_0x4686dd(0x14b)]),process[_0x4686dd(0x13c)][_0x4686dd(0x122)]=_0x1fda81[_0x4686dd(0x197)]),testhubUtils[_0x4686dd(0x187)](_0x1de0e3)&&logger['debug'](_0x1fda81[_0x4686dd(0x155)]),[null,null];try{const _0x14b8be=await this['generateBuildUpstreamData'](_0x1de0e3,_0x549c79),_0x59b659=this[_0x4686dd(0x184)](_0x146b97,_0x41e358),_0x461fe9=await _0x1fda81['LtRUU'](nodeRequest,_0x1fda81[_0x4686dd(0x18a)],testHubConstants['TESTHUB_BUILD_API'],_0x14b8be,_0x59b659),_0x46b57f=this['extractDataFromResponse'](_0x1de0e3,_0x461fe9,_0x59b659);return await this[_0x4686dd(0x143)](_0x4b453c,_0x549c79),_0x46b57f;}catch(_0x5e90a5){if(_0x1fda81[_0x4686dd(0x191)](_0x5e90a5['success'],![])){testhubUtils[_0x4686dd(0x18f)](_0x5e90a5);return;}}})();}static async['processTraceZips'](){const _0x31b36c=a90_0x1030e3,_0x176ca3={'HMjKK':function(_0x2c5dee,_0x51ebba,_0x427a16){return _0x2c5dee(_0x51ebba,_0x427a16);},'DBhFo':function(_0x2ee6fa,_0x1fb91d){return _0x2ee6fa(_0x1fb91d);},'mVLvm':function(_0x326536){return _0x326536();},'BmnIF':_0x31b36c(0x13f)};if(processedTraceZips)return;const _0x2c6b0a=TestDetails['getTraceFilePaths']();_0x2c6b0a[_0x31b36c(0x15a)](({testUId:_0x46df1c,filePath:_0x502557})=>{const _0x484141=_0x31b36c;var _0x3bfd6d=_0x176ca3['HMjKK'](uploadTraceZip,_0x502557,_0x46df1c);_0x176ca3[_0x484141(0x182)](addEvent,_0x3bfd6d);});try{await _0x176ca3[_0x31b36c(0x14a)](awaitAllEvents),logger['debug'](_0x176ca3['BmnIF']),processedTraceZips=!![];}catch(_0x1cedf7){logger[_0x31b36c(0x147)](_0x31b36c(0x186)+util[_0x31b36c(0x171)](_0x1cedf7));}}static async[a90_0x1030e3(0x143)](_0x5a22ea,_0x2d7638){const _0x41f7a7=a90_0x1030e3;if(constants[_0x41f7a7(0x128)][_0x41f7a7(0x14c)](_0x2d7638)){await _0x5a22ea[_0x41f7a7(0x145)]();return;}_0x5a22ea[_0x41f7a7(0x153)][_0x41f7a7(0x12e)]&&logger[_0x41f7a7(0x159)]('Percy\x20is\x20not\x20supported\x20for\x20'+_0x2d7638+'\x20framework');}static[a90_0x1030e3(0x13d)](_0x1a366c){const _0x3e9ebf=a90_0x1030e3,_0x3288ec={};_0x3288ec['settings']=_0x1a366c[_0x3e9ebf(0x14f)];const _0x4b1453=_0x3288ec;return _0x4b1453;}static['getConfig'](_0x12b7c6,_0x220e37){const _0x2ae38b=a90_0x1030e3,_0x7b7e0={'kCPkm':function(_0x301c8a,_0x5bad6a){return _0x301c8a(_0x5bad6a);}},_0x2bc9ee={};return _0x2bc9ee[_0x2ae38b(0x14d)]=_0x12b7c6,_0x2bc9ee[_0x2ae38b(0x139)]=_0x220e37,{'auth':_0x2bc9ee,'headers':_0x7b7e0[_0x2ae38b(0x19b)](getDefaultHeaders,![])};}static async[a90_0x1030e3(0x17f)](_0x5122fa,_0x5b623a){const _0x17ad3e=a90_0x1030e3,_0x414827={'lYwfe':function(_0x3ab699,_0x360aa2){return _0x3ab699(_0x360aa2);}},_0x31e448={'project_name':_0x5122fa[_0x17ad3e(0x166)]||'','name':_0x5122fa[_0x17ad3e(0x19c)]||path[_0x17ad3e(0x17d)](path[_0x17ad3e(0x11c)](process[_0x17ad3e(0x167)]())),'build_identifier':_0x5122fa[_0x17ad3e(0x170)],'description':_0x5122fa[_0x17ad3e(0x183)]||'','started_at':new Date()[_0x17ad3e(0x129)](),'tags':_0x414827[_0x17ad3e(0x11b)](getCustomTags,_0x5122fa),'host_info':bsSetupHelper[_0x17ad3e(0x199)](),'ci_info':bsSetupHelper[_0x17ad3e(0x18e)](),'build_run_identifier':process[_0x17ad3e(0x13c)][_0x17ad3e(0x11d)],'failed_tests_rerun':process[_0x17ad3e(0x13c)]['BROWSERSTACK_RERUN']||![],'version_control':await bsSetupHelper[_0x17ad3e(0x168)](),'accessibility':this['getAccessibilityOptions'](_0x5122fa),'framework_details':testhubUtils[_0x17ad3e(0x121)](_0x5122fa,_0x5b623a),'product_map':testhubUtils['getProductMap'](_0x5122fa),'browserstackAutomation':bsSetupHelper[_0x17ad3e(0x15c)](),'grouping_identifier':process[_0x17ad3e(0x13c)][_0x17ad3e(0x125)]};if(bsSetupHelper[_0x17ad3e(0x193)]()[_0x17ad3e(0x185)]||bsSetupHelper[_0x17ad3e(0x193)]()[_0x17ad3e(0x151)]){const _0x5580d5={};_0x5580d5[_0x17ad3e(0x195)]=process['env'][_0x17ad3e(0x190)],_0x5580d5[_0x17ad3e(0x148)]=process[_0x17ad3e(0x13c)]['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x31e448[_0x17ad3e(0x185)]=_0x5580d5;}return _0x31e448;}static['extractDataFromResponse'](_0x4a1853,_0x20a52b,_0x5801df){const _0x19801b=a90_0x1030e3,_0x25f4c1={'IYzvw':function(_0x2b28d2){return _0x2b28d2();},'SgApS':function(_0x390063,_0x498a67){return _0x390063&&_0x498a67;},'mdAGl':_0x19801b(0x156),'QZvGU':'false'},_0x478c0f={};if(_0x25f4c1[_0x19801b(0x144)](isTestObservabilitySession)){const [_0xe80d60,_0x182a4f,_0x29a58b]=testhubUtils[_0x19801b(0x12a)](_0x20a52b[_0x19801b(0x133)],_0x5801df[_0x19801b(0x161)]);if(_0x25f4c1[_0x19801b(0x15d)](_0xe80d60,_0x182a4f)){const _0x12a4cb={};_0x12a4cb[_0x19801b(0x18d)]=_0xe80d60,_0x12a4cb[_0x19801b(0x18b)]=_0x182a4f,_0x12a4cb[_0x19801b(0x19a)]=_0x29a58b,_0x478c0f[testHubConstants['OBSERVABILITY']]=_0x12a4cb,process[_0x19801b(0x13c)][_0x19801b(0x14e)]=_0x25f4c1[_0x19801b(0x124)];}else _0x478c0f[testHubConstants[_0x19801b(0x154)]]={},process[_0x19801b(0x13c)][_0x19801b(0x14e)]=_0x25f4c1[_0x19801b(0x158)];}else process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x25f4c1['QZvGU'];if(testhubUtils['isAccessibilityEnabled'](_0x4a1853)){const [_0x47bff6,_0x4961c9]=testhubUtils[_0x19801b(0x12c)](_0x20a52b[_0x19801b(0x133)]);if(_0x25f4c1['SgApS'](_0x47bff6,_0x4961c9)){const _0x717eb={};_0x717eb[_0x19801b(0x135)]=_0x47bff6,_0x717eb[_0x19801b(0x18b)]=_0x4961c9,_0x478c0f[testHubConstants[_0x19801b(0x140)]]=_0x717eb,process[_0x19801b(0x13c)][_0x19801b(0x17a)]=_0x25f4c1['mdAGl'];}else _0x478c0f[testHubConstants[_0x19801b(0x140)]]={},process[_0x19801b(0x13c)][_0x19801b(0x17a)]=_0x25f4c1['QZvGU'];}else process['env'][_0x19801b(0x17a)]=_0x25f4c1['QZvGU'];return testhubUtils['setTestHubCommonMetaInfo'](_0x20a52b[_0x19801b(0x133)]),logger[_0x19801b(0x16d)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x19801b(0x13c)][_0x19801b(0x172)]),_0x478c0f;}static async['stop'](_0x5e2124){const _0x36daa1=a90_0x1030e3,_0x13b43a={'rHxcG':function(_0x3c1e3e,_0x303c90){return _0x3c1e3e===_0x303c90;},'glnvv':'false','VrSVb':function(_0x3fb8c3,_0x54dd80){return _0x3fb8c3===_0x54dd80;},'Grxoq':_0x36daa1(0x177),'NjPmm':function(_0x52d377,_0x3bbd20){return _0x52d377===_0x3bbd20;},'doXeo':_0x36daa1(0x127),'AZSpX':'error','QyNWx':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','noItu':'finished_metadata','owsWQ':_0x36daa1(0x149),'OVTBn':function(_0x2d49db){return _0x2d49db();},'mzqiL':function(_0x472ede,_0x53651d,_0x1342f8,_0x569594,_0x6e023e,_0x3bf27d){return _0x472ede(_0x53651d,_0x1342f8,_0x569594,_0x6e023e,_0x3bf27d);},'UwjVv':_0x36daa1(0x17c),'gcGrB':'stopBuildUpstream\x20event\x20successful!','mfPCd':'success'};await this['processTraceZips'](),await PerformanceTester[_0x36daa1(0x176)](PerformanceEvents['STOP'],async()=>{const _0xc5a3d0=_0x36daa1;if(_0x13b43a[_0xc5a3d0(0x13e)](process[_0xc5a3d0(0x13c)][_0xc5a3d0(0x122)],_0x13b43a['glnvv'])||TestHubHandler[_0xc5a3d0(0x160)]||bsSetupHelper['isUndefined'](process['env'][testHubConstants[_0xc5a3d0(0x173)][_0xc5a3d0(0x178)]]))return;TestHubHandler[_0xc5a3d0(0x160)]=!![],await RequestQueueHandler[_0xc5a3d0(0x117)]()[_0xc5a3d0(0x12d)](),await SessionHandler[_0xc5a3d0(0x138)]();if(_0x13b43a[_0xc5a3d0(0x194)](process['env'][testHubConstants[_0xc5a3d0(0x173)][_0xc5a3d0(0x178)]],_0x13b43a[_0xc5a3d0(0x196)])||_0x13b43a[_0xc5a3d0(0x189)](process['env'][testHubConstants[_0xc5a3d0(0x173)]['BROWSERSTACK_TESTHUB_UUID']],_0x13b43a[_0xc5a3d0(0x196)])){logger[_0xc5a3d0(0x159)](_0x13b43a[_0xc5a3d0(0x16b)]);const _0x27cc65={};return _0x27cc65[_0xc5a3d0(0x130)]=_0x13b43a[_0xc5a3d0(0x180)],_0x27cc65[_0xc5a3d0(0x164)]=_0x13b43a['QyNWx'],_0x27cc65;}const _0x15639f={'finished_at':new Date()[_0xc5a3d0(0x129)](),'finished_metadata':[]};!!_0x5e2124&&_0x15639f[_0x13b43a[_0xc5a3d0(0x18c)]]['push']({'reason':_0x13b43a[_0xc5a3d0(0x142)],'signal':_0x5e2124,'failure_data':''});const _0x553b3f={'headers':_0x13b43a[_0xc5a3d0(0x132)](getDefaultHeaders)};try{const _0xc1cf68=await _0x13b43a['mzqiL'](nodeRequest,_0x13b43a['UwjVv'],_0xc5a3d0(0x118)+process['env'][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']]+'/stop',_0x15639f,_0x553b3f,![]);if(_0xc1cf68[_0xc5a3d0(0x133)]&&_0xc1cf68['data']['error']){const _0xe992ee={};_0xe992ee['message']=_0xc1cf68[_0xc5a3d0(0x133)][_0xc5a3d0(0x147)];throw _0xe992ee;}else{logger[_0xc5a3d0(0x159)](_0x13b43a[_0xc5a3d0(0x131)]);const _0x3244b9={};return _0x3244b9[_0xc5a3d0(0x130)]=_0x13b43a['mfPCd'],_0x3244b9[_0xc5a3d0(0x164)]='',_0x3244b9;}}catch(_0x55dff7){_0x55dff7['response']?logger[_0xc5a3d0(0x159)](_0xc5a3d0(0x181)+_0x55dff7[_0xc5a3d0(0x152)][_0xc5a3d0(0x130)]+'\x20'+_0x55dff7[_0xc5a3d0(0x152)][_0xc5a3d0(0x16c)]+'\x20'+JSON[_0xc5a3d0(0x146)](_0x55dff7[_0xc5a3d0(0x152)]['data'])):logger[_0xc5a3d0(0x159)](_0xc5a3d0(0x181)+(_0x55dff7[_0xc5a3d0(0x164)]||_0x55dff7));const _0x1b5d70={};return _0x1b5d70[_0xc5a3d0(0x130)]=_0x13b43a[_0xc5a3d0(0x180)],_0x1b5d70[_0xc5a3d0(0x164)]=_0x55dff7['message']||_0x55dff7[_0xc5a3d0(0x152)]?_0x55dff7[_0xc5a3d0(0x152)][_0xc5a3d0(0x130)]+':'+_0x55dff7[_0xc5a3d0(0x152)][_0xc5a3d0(0x16c)]:_0x55dff7,_0x1b5d70;}})();}}module[a90_0x1030e3(0x120)]=TestHubHandler;function a90_0x1dba(){const _0x5eeefb=['getCiInfo','logBuildError','BROWSERSTACK_CENTRAL_SCANNER_JOBID','IRKEl','../performance/performance-tester.js','getCentralUser','VrSVb','job_id','Grxoq','buVjU','2051365ToYSOO','getHostInfo','allowScreenshot','kCPkm','buildName','../test-observability/sessionHandler.js','getInstance','api/v1/builds/','./constants.js','../logger','lYwfe','resolve','BROWSERSTACK_BUILD_RUN_IDENTIFIER','6uBHByW','2uyztwI','exports','getFrameworkDetails','BS_TESTOPS_BUILD_COMPLETED','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','mdAGl','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','PERCY_SUPPORTED_FRAMEWORKS','toISOString','setTestObservabilityVariables','6540bbVosc','setAccessibilityVariables','uploadPending','percy','START','status','gcGrB','OVTBn','data','63mIlGCu','authToken','../test-observability/utils','160VsbCZU','waitForBuildStatus','password','util','launchBuild','env','getAccessibilityOptions','rHxcG','All\x20trace\x20zip\x20send\x20events\x20complete','ACCESSIBILITY','assign','owsWQ','checkAndSetupPercy','IYzvw','setupPercy','stringify','error','token','user_killed','mVLvm','QePUb','includes','username','BROWSERSTACK_TEST_OBSERVABILITY','accessibilityOptions','10589064WFLKUt','lcnc','response','config','OBSERVABILITY','xKVfn','true','36968pfNBPe','QZvGU','debug','forEach','../helper','isBrowserstackInfra','SgApS','6083jIWJRo','336532zhmGSG','buildStopSent','auth','getUserName','winstonLogger','message','add','projectName','cwd','getGitMetaData','86583JUHsCY','getProductMap','doXeo','statusText','info','26295hvQYMg','POST','buildIdentifier','format','BROWSERSTACK_TESTHUB_UUID','ENV_VAR','../../bin/playwright/reporter/test-details.js','aaTnD','measureWrapper','null','BROWSERSTACK_TESTHUB_JWT','../../bin/utils/constants.js','BROWSERSTACK_ACCESSIBILITY','JeZmx','PUT','basename','false','generateBuildUpstreamData','AZSpX','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','DBhFo','buildDescription','getConfig','central_scanner','Error\x20while\x20waiting\x20for\x20events:\x20','isAccessibilityEnabled','getAccessKey','NjPmm','Xerbi','buildHashedId','noItu','jwt'];a90_0x1dba=function(){return _0x5eeefb;};return a90_0x1dba();}
const a90_0x190f97=a90_0x5875;(function(_0x5546ac,_0x1a8861){const _0x3d851e=a90_0x5875,_0x2416f9=_0x5546ac();while(!![]){try{const _0x5a5190=parseInt(_0x3d851e(0x1cb))/0x1*(-parseInt(_0x3d851e(0x1bb))/0x2)+-parseInt(_0x3d851e(0x1f7))/0x3+-parseInt(_0x3d851e(0x191))/0x4*(parseInt(_0x3d851e(0x1b3))/0x5)+parseInt(_0x3d851e(0x1db))/0x6+parseInt(_0x3d851e(0x1c5))/0x7+-parseInt(_0x3d851e(0x1b8))/0x8*(parseInt(_0x3d851e(0x1d0))/0x9)+parseInt(_0x3d851e(0x203))/0xa*(parseInt(_0x3d851e(0x1c8))/0xb);if(_0x5a5190===_0x1a8861)break;else _0x2416f9['push'](_0x2416f9['shift']());}catch(_0x48b9a3){_0x2416f9['push'](_0x2416f9['shift']());}}}(a90_0x2bab,0xe7fa6));const bsSetupHelper=require(a90_0x190f97(0x197)),path=require(a90_0x190f97(0x1f4)),util=require(a90_0x190f97(0x208)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x190f97(0x1ed)),testhubUtils=require(a90_0x190f97(0x1b6)),testHubConstants=require('./constants.js'),constants=require(a90_0x190f97(0x1a8)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a90_0x190f97(0x204))[a90_0x190f97(0x1aa)],SessionHandler=require(a90_0x190f97(0x1f9)),PerformanceTester=require(a90_0x190f97(0x1e3)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a90_0x190f97(0x1ec)),{uploadTraceZip}=require(a90_0x190f97(0x1e0)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x1dff6e=>{const _0x23484e=a90_0x190f97;OngoingEvents[_0x23484e(0x1b1)](_0x1dff6e);},awaitAllEvents=async()=>{const _0x328880=a90_0x190f97;return Promise[_0x328880(0x201)](OngoingEvents);};function a90_0x5875(_0x3ce50e,_0x1a5b0f){const _0x2bab53=a90_0x2bab();return a90_0x5875=function(_0x58751d,_0x3c548d){_0x58751d=_0x58751d-0x183;let _0x4b0f41=_0x2bab53[_0x58751d];return _0x4b0f41;},a90_0x5875(_0x3ce50e,_0x1a5b0f);}function a90_0x2bab(){const _0x5d4619=['percy','username','BROWSERSTACK_ACCESSIBILITY','error','TEBQK','1456052HAloXV','PFeNM','EciVD','assign','finished_metadata','getConfig','../helper','MsCNq','measureWrapper','bFdvl','eMKCk','jwt','buildDescription','api/v1/builds/','auth','PERCY_SUPPORTED_FRAMEWORKS','YFONF','OzHVQ','uploadPending','CQUyc','ACCESSIBILITY','BROWSERSTACK_CENTRAL_SCANNER_JOBID','isUndefined','../../bin/utils/constants.js','BROWSERSTACK_TESTHUB_JWT','winstonLogger','resolve','forEach','buildName','jLJkZ','UDeoH','mRbTA','add','stop','5VpFLMw','checkAndSetupPercy','iHCyU','./utils.js','waitForBuildStatus','8fFEefS','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','getTraceFilePaths','125098zdaznU','Ahhxi','lvlEX','getProductMapForBuildStartCall','qVgYe','BROWSERSTACK_CENTRAL_SCANNER_JWT','cwd','stringify','extractDataFromResponse','BBSIa','6394234tbwmjk','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','getAccessibilityValueFromYml','11diYwJO','getProductMap','setTestHubCommonMetaInfo','22XTiWlf','processTraceZips','buildStopSent','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','password','6163119eJZomV','duNYM','TESTHUB_BUILD_API','status','message','STOP','mqcEg','response','GLuqy','ENV_VAR','START','9040290IpNJDa','env','data','hxjPF','projectName','../../bin/playwright/reporter/pwUtils.js','stopBuildUpstream\x20event\x20successful!','BROWSERSTACK_TEST_OBSERVABILITY','../performance/performance-tester.js','getAccessKey','accessibility','Testhub\x20started\x20with\x20id:\x20','Error\x20while\x20waiting\x20for\x20events:\x20','khpUw','BROWSERSTACK_BUILD_RUN_IDENTIFIER','basename','BROWSERSTACK_PRODUCT_MAP','../../bin/playwright/reporter/test-details.js','../test-observability/utils','authToken','statusText','toISOString','getCiInfo','BROWSERSTACK_TESTHUB_UUID','All\x20trace\x20zip\x20send\x20events\x20complete','path','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','debug','4900857lrzgTq','setAccessibilityVariables','../test-observability/sessionHandler.js','central_scanner','tlHnS','buildIdentifier','/stop','Percy\x20is\x20not\x20supported\x20for\x20','config','format','allSettled','false','25885060OExXvg','../logger','JMyuC','tXdid','buildHashedId','util','xLcXx','generateBuildUpstreamData','includes','lcnc','allowScreenshot','getAccessibilityOptions','ydXLX','isBrowserstackInfra','cCifn','BS_TESTOPS_BUILD_COMPLETED','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','snBlH','framework','true','VDmGm','VWYGL','NYnMS','getCentralUser'];a90_0x2bab=function(){return _0x5d4619;};return a90_0x2bab();}class TestHubHandler{static [a90_0x190f97(0x1cd)]=![];static async['launchBuild'](_0x38e51f,_0x27964f){const _0x418841=a90_0x190f97,_0x3dc5ae={'eMKCk':function(_0x441664,_0x182ac0){return _0x441664||_0x182ac0;},'VWYGL':function(_0x30b644,_0x38c45e){return _0x30b644===_0x38c45e;},'duNYM':function(_0x5a5c54){return _0x5a5c54();},'CQUyc':_0x418841(0x1c6),'OzHVQ':_0x418841(0x202),'ydXLX':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','EciVD':function(_0x28ac62,_0x85691,_0x3c5c11,_0xf80475,_0x263250){return _0x28ac62(_0x85691,_0x3c5c11,_0xf80475,_0x263250);},'snBlH':'POST','ZcCin':'accessibility','mRbTA':_0x418841(0x187),'Hlgqs':function(_0x26ccb8,_0x26e215){return _0x26ccb8===_0x26e215;}};await PerformanceTester[_0x418841(0x199)](PerformanceEvents[_0x418841(0x1da)],async()=>{const _0x5d42e7=_0x418841,_0x33ae4e=Object[_0x5d42e7(0x194)]({},_0x27964f[_0x5d42e7(0x1ff)],{'root_dir_path':'','framework':_0x27964f[_0x5d42e7(0x186)]}),_0x389308=bsSetupHelper['getUserName'](_0x33ae4e),_0x5417c7=bsSetupHelper[_0x5d42e7(0x1e4)](_0x33ae4e),_0x376f0f=_0x3dc5ae[_0x5d42e7(0x19b)](_0x389308,'')+':'+_0x3dc5ae['eMKCk'](_0x5417c7,''),_0x4570da=testhubUtils[_0x5d42e7(0x1c9)](_0x33ae4e);process[_0x5d42e7(0x1dc)][_0x5d42e7(0x1eb)]=JSON['stringify'](_0x4570da);if(_0x3dc5ae['VWYGL'](_0x376f0f,':'))return _0x3dc5ae[_0x5d42e7(0x1d1)](isTestObservabilitySession)&&(logger[_0x5d42e7(0x1f6)](_0x3dc5ae[_0x5d42e7(0x1a4)]),process[_0x5d42e7(0x1dc)]['BS_TESTOPS_BUILD_COMPLETED']=_0x3dc5ae[_0x5d42e7(0x1a2)]),testhubUtils['isAccessibilityEnabled'](_0x33ae4e)&&logger[_0x5d42e7(0x1f6)](_0x3dc5ae[_0x5d42e7(0x20f)]),[null,null];try{const _0xb46494=await this['generateBuildUpstreamData'](_0x33ae4e,_0x38e51f),_0x3928b4=this['getConfig'](_0x389308,_0x5417c7),_0x1d3fc6=await _0x3dc5ae[_0x5d42e7(0x193)](nodeRequest,_0x3dc5ae[_0x5d42e7(0x185)],testHubConstants[_0x5d42e7(0x1d2)],_0xb46494,_0x3928b4),_0x399008=this[_0x5d42e7(0x1c3)](_0x33ae4e,_0x1d3fc6,_0x3928b4);await this[_0x5d42e7(0x1b4)](_0x27964f,_0x38e51f);if(_0x3dc5ae[_0x5d42e7(0x189)](testhubUtils[_0x5d42e7(0x1c7)](_0x27964f[_0x5d42e7(0x1ff)]),null)){const _0x24a5d4=_0x399008[_0x3dc5ae['ZcCin']];_0x24a5d4&&_0x24a5d4[_0x5d42e7(0x1ee)]&&_0x24a5d4[_0x5d42e7(0x207)]&&(_0x27964f[_0x5d42e7(0x1ff)][_0x5d42e7(0x1e5)]=!![],process['env'][_0x5d42e7(0x1b9)]=_0x3dc5ae[_0x5d42e7(0x1b0)]);}return _0x399008;}catch(_0x1130b0){if(_0x3dc5ae['Hlgqs'](_0x1130b0['success'],![])){testhubUtils['logBuildError'](_0x1130b0);return;}}})();}static async[a90_0x190f97(0x1cc)](){const _0x4b0f38=a90_0x190f97,_0x166532={'tXdid':function(_0x36c942,_0x57d56f,_0x30d6d0){return _0x36c942(_0x57d56f,_0x30d6d0);},'SPbHD':function(_0x44a363,_0x1ad7e8){return _0x44a363(_0x1ad7e8);},'GLuqy':function(_0x316986){return _0x316986();},'khpUw':_0x4b0f38(0x1f3)};if(processedTraceZips)return;const _0x1ed418=TestDetails[_0x4b0f38(0x1ba)]();_0x1ed418[_0x4b0f38(0x1ac)](({testUId:_0x3d238d,filePath:_0x292458})=>{const _0x11abfd=_0x4b0f38;var _0x1d8c9d=_0x166532[_0x11abfd(0x206)](uploadTraceZip,_0x292458,_0x3d238d);_0x166532['SPbHD'](addEvent,_0x1d8c9d);});try{await _0x166532[_0x4b0f38(0x1d8)](awaitAllEvents),logger['debug'](_0x166532[_0x4b0f38(0x1e8)]),processedTraceZips=!![];}catch(_0x534ff7){logger[_0x4b0f38(0x18f)](_0x4b0f38(0x1e7)+util[_0x4b0f38(0x200)](_0x534ff7));}}static async[a90_0x190f97(0x1b4)](_0x19ef2b,_0x3fce9b){const _0x389054=a90_0x190f97;if(constants[_0x389054(0x1a0)][_0x389054(0x20b)](_0x3fce9b)){await _0x19ef2b['setupPercy']();return;}_0x19ef2b['config'][_0x389054(0x18c)]&&logger[_0x389054(0x1f6)](_0x389054(0x1fe)+_0x3fce9b+'\x20framework');}static[a90_0x190f97(0x20e)](_0x30a54d){const _0x2449d9={};_0x2449d9['settings']=_0x30a54d['accessibilityOptions'];const _0x2931d6=_0x2449d9;return _0x2931d6;}static[a90_0x190f97(0x196)](_0x149e5a,_0x1f0f11){const _0x278f13=a90_0x190f97,_0xa9081b={'hxjPF':function(_0x543cf9,_0x4d386c){return _0x543cf9(_0x4d386c);}},_0x4b7ad1={};return _0x4b7ad1[_0x278f13(0x18d)]=_0x149e5a,_0x4b7ad1[_0x278f13(0x1cf)]=_0x1f0f11,{'auth':_0x4b7ad1,'headers':_0xa9081b[_0x278f13(0x1de)](getDefaultHeaders,![])};}static async[a90_0x190f97(0x20a)](_0x2c47d8,_0x190fa3){const _0x549989=a90_0x190f97,_0x15b6a6={'TEBQK':function(_0x3a2fde,_0x4be64a){return _0x3a2fde(_0x4be64a);}},_0x4e8112={'project_name':_0x2c47d8[_0x549989(0x1df)]||'','name':_0x2c47d8[_0x549989(0x1ad)]||path[_0x549989(0x1ea)](path[_0x549989(0x1ab)](process[_0x549989(0x1c1)]())),'build_identifier':_0x2c47d8[_0x549989(0x1fc)],'description':_0x2c47d8[_0x549989(0x19d)]||'','started_at':new Date()[_0x549989(0x1f0)](),'tags':_0x15b6a6[_0x549989(0x190)](getCustomTags,_0x2c47d8),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x549989(0x1f1)](),'build_run_identifier':process[_0x549989(0x1dc)][_0x549989(0x1e9)],'failed_tests_rerun':process[_0x549989(0x1dc)]['BROWSERSTACK_RERUN']||![],'version_control':await bsSetupHelper['getGitMetaData'](),'accessibility':this[_0x549989(0x20e)](_0x2c47d8),'framework_details':testhubUtils['getFrameworkDetails'](_0x2c47d8,_0x190fa3),'product_map':testhubUtils[_0x549989(0x1be)](_0x2c47d8),'browserstackAutomation':bsSetupHelper[_0x549989(0x210)](),'grouping_identifier':process['env'][_0x549989(0x1f5)]};if(bsSetupHelper[_0x549989(0x18b)]()[_0x549989(0x1fa)]||bsSetupHelper[_0x549989(0x18b)]()[_0x549989(0x20c)]){const _0x1b822b={};_0x1b822b['job_id']=process[_0x549989(0x1dc)][_0x549989(0x1a6)],_0x1b822b['token']=process[_0x549989(0x1dc)][_0x549989(0x1c0)],_0x4e8112[_0x549989(0x1fa)]=_0x1b822b;}return _0x4e8112;}static['extractDataFromResponse'](_0x88ea7d,_0x2eff1d,_0x1bc91b){const _0x150f20=a90_0x190f97,_0x2547e1={'YFONF':function(_0x1500d7){return _0x1500d7();},'JMyuC':function(_0x41b91b,_0x4165e0){return _0x41b91b&&_0x4165e0;},'cCifn':_0x150f20(0x187),'lvlEX':_0x150f20(0x202)},_0x583cd4={};if(_0x2547e1[_0x150f20(0x1a1)](isTestObservabilitySession)){const [_0x17907d,_0x5a509b,_0x106b70]=testhubUtils['setTestObservabilityVariables'](_0x2eff1d[_0x150f20(0x1dd)],_0x1bc91b[_0x150f20(0x19f)]);if(_0x2547e1['JMyuC'](_0x17907d,_0x5a509b)){const _0x2e44d8={};_0x2e44d8[_0x150f20(0x19c)]=_0x17907d,_0x2e44d8[_0x150f20(0x207)]=_0x5a509b,_0x2e44d8[_0x150f20(0x20d)]=_0x106b70,_0x583cd4[testHubConstants['OBSERVABILITY']]=_0x2e44d8,process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x2547e1[_0x150f20(0x211)];}else _0x583cd4[testHubConstants['OBSERVABILITY']]={},process[_0x150f20(0x1dc)][_0x150f20(0x1e2)]=_0x2547e1[_0x150f20(0x1bd)];}else process['env'][_0x150f20(0x1e2)]=_0x2547e1['lvlEX'];const [_0x4e4a0e,_0x9643bf]=testhubUtils[_0x150f20(0x1f8)](_0x2eff1d[_0x150f20(0x1dd)]);if(_0x2547e1[_0x150f20(0x205)](_0x4e4a0e,_0x9643bf)){const _0x153e0c={};_0x153e0c[_0x150f20(0x1ee)]=_0x4e4a0e,_0x153e0c['buildHashedId']=_0x9643bf,_0x583cd4[testHubConstants[_0x150f20(0x1a5)]]=_0x153e0c,process[_0x150f20(0x1dc)][_0x150f20(0x18e)]=_0x2547e1['cCifn'];}else _0x583cd4[testHubConstants[_0x150f20(0x1a5)]]={},process[_0x150f20(0x1dc)][_0x150f20(0x18e)]=_0x2547e1[_0x150f20(0x1bd)];return testhubUtils[_0x150f20(0x1ca)](_0x2eff1d[_0x150f20(0x1dd)]),logger['info'](_0x150f20(0x1e6)+process[_0x150f20(0x1dc)]['BROWSERSTACK_TESTHUB_UUID']),_0x583cd4;}static async[a90_0x190f97(0x1b2)](_0x465fdf){const _0x503c99=a90_0x190f97,_0x41d6d7={'zpXRA':function(_0x5a408e,_0x4c11f5){return _0x5a408e===_0x4c11f5;},'bFdvl':'false','BBSIa':function(_0x3e7e5a,_0x4f74c4){return _0x3e7e5a===_0x4f74c4;},'mqcEg':'null','MsCNq':function(_0x19bf60,_0x5745f4){return _0x19bf60===_0x5745f4;},'Ahhxi':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','xLcXx':_0x503c99(0x18f),'VDmGm':_0x503c99(0x1ce),'iHCyU':_0x503c99(0x195),'NYnMS':'user_killed','PFeNM':function(_0x1f01fa){return _0x1f01fa();},'tlHnS':function(_0x5262ce,_0x506219,_0x34223b,_0x4bbaa9,_0x963ea4,_0x43c3bb){return _0x5262ce(_0x506219,_0x34223b,_0x4bbaa9,_0x963ea4,_0x43c3bb);},'UDeoH':'PUT','qVgYe':_0x503c99(0x1e1),'jLJkZ':'success'};await this[_0x503c99(0x1cc)](),await PerformanceTester[_0x503c99(0x199)](PerformanceEvents[_0x503c99(0x1d5)],async()=>{const _0x298b34=_0x503c99;if(_0x41d6d7['zpXRA'](process['env'][_0x298b34(0x183)],_0x41d6d7[_0x298b34(0x19a)])||TestHubHandler[_0x298b34(0x1cd)]||bsSetupHelper[_0x298b34(0x1a7)](process[_0x298b34(0x1dc)][testHubConstants['ENV_VAR'][_0x298b34(0x1a9)]]))return;TestHubHandler[_0x298b34(0x1cd)]=!![],await RequestQueueHandler['getInstance']()[_0x298b34(0x1a3)](),await SessionHandler[_0x298b34(0x1b7)]();if(_0x41d6d7[_0x298b34(0x1c4)](process[_0x298b34(0x1dc)][testHubConstants['ENV_VAR'][_0x298b34(0x1a9)]],_0x41d6d7[_0x298b34(0x1d6)])||_0x41d6d7[_0x298b34(0x198)](process[_0x298b34(0x1dc)][testHubConstants[_0x298b34(0x1d9)]['BROWSERSTACK_TESTHUB_UUID']],_0x41d6d7['mqcEg'])){logger['debug'](_0x41d6d7[_0x298b34(0x1bc)]);const _0x3853a2={};return _0x3853a2[_0x298b34(0x1d3)]=_0x41d6d7['xLcXx'],_0x3853a2[_0x298b34(0x1d4)]=_0x41d6d7[_0x298b34(0x188)],_0x3853a2;}const _0x3467f4={'finished_at':new Date()[_0x298b34(0x1f0)](),'finished_metadata':[]};!!_0x465fdf&&_0x3467f4[_0x41d6d7[_0x298b34(0x1b5)]]['push']({'reason':_0x41d6d7[_0x298b34(0x18a)],'signal':_0x465fdf,'failure_data':''});const _0x2df716={'headers':_0x41d6d7[_0x298b34(0x192)](getDefaultHeaders)};try{const _0x351b33=await _0x41d6d7[_0x298b34(0x1fb)](nodeRequest,_0x41d6d7[_0x298b34(0x1af)],_0x298b34(0x19e)+process[_0x298b34(0x1dc)][testHubConstants['ENV_VAR'][_0x298b34(0x1f2)]]+_0x298b34(0x1fd),_0x3467f4,_0x2df716,![]);if(_0x351b33['data']&&_0x351b33[_0x298b34(0x1dd)][_0x298b34(0x18f)]){const _0x52a5b6={};_0x52a5b6['message']=_0x351b33['data'][_0x298b34(0x18f)];throw _0x52a5b6;}else{logger[_0x298b34(0x1f6)](_0x41d6d7[_0x298b34(0x1bf)]);const _0x3ae265={};return _0x3ae265[_0x298b34(0x1d3)]=_0x41d6d7[_0x298b34(0x1ae)],_0x3ae265[_0x298b34(0x1d4)]='',_0x3ae265;}}catch(_0x1b863b){_0x1b863b[_0x298b34(0x1d7)]?logger[_0x298b34(0x1f6)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x1b863b[_0x298b34(0x1d7)]['status']+'\x20'+_0x1b863b[_0x298b34(0x1d7)][_0x298b34(0x1ef)]+'\x20'+JSON[_0x298b34(0x1c2)](_0x1b863b['response'][_0x298b34(0x1dd)])):logger[_0x298b34(0x1f6)](_0x298b34(0x184)+(_0x1b863b[_0x298b34(0x1d4)]||_0x1b863b));const _0x3a579f={};return _0x3a579f[_0x298b34(0x1d3)]=_0x41d6d7[_0x298b34(0x209)],_0x3a579f[_0x298b34(0x1d4)]=_0x1b863b[_0x298b34(0x1d4)]||_0x1b863b[_0x298b34(0x1d7)]?_0x1b863b[_0x298b34(0x1d7)][_0x298b34(0x1d3)]+':'+_0x1b863b[_0x298b34(0x1d7)]['statusText']:_0x1b863b,_0x3a579f;}})();}}module['exports']=TestHubHandler;
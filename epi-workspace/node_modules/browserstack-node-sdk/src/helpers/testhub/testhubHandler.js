const a90_0x5df58c=a90_0x4b69;function a90_0x9ea8(){const _0x355037=['../../bin/playwright/reporter/test-details.js','START','processTraceZips','tVGIg','status','percy','password','includes','4PrYYHE','KvPmA','BROWSERSTACK_TESTHUB_UUID','isAccessibilityEnabled','iHbhc','cPSes','setTestObservabilityVariables','6963560DxvApM','eFVBo','stringify','TESTHUB_BUILD_API','evvpA','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','XZoRj','1682376OnPiIw','dTtuO','yjHQL','QoVyh','Testhub\x20started\x20with\x20id:\x20','PxGCZ','extractDataFromResponse','BROWSERSTACK_BUILD_RUN_IDENTIFIER','success','1758QtbAfp','basename','getAccessKey','buildHashedId','OBSERVABILITY','13425LQGdPM','getHostInfo','getConfig','util','../performance/constants','../performance/performance-tester.js','accessibilityOptions','response','ENV_VAR','GbcYN','../test-observability/requestQueueHandler.js','PtJHp','buildStopSent','allowScreenshot','Percy\x20is\x20not\x20supported\x20for\x20','ELOlD','projectName','wkHSj','BROWSERSTACK_RERUN','setupPercy','config','cwd','waitForBuildStatus','getUserName','BROWSERSTACK_ACCESSIBILITY','authToken','statusText','toISOString','env','10xnhDPX','central_scanner','uploadPending','1898019bDikIK','getAccessibilityOptions','launchBuild','finished_metadata','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','buildIdentifier','FouPf','VvstJ','EsdTo','setTestHubCommonMetaInfo','stopBuildUpstream\x20event\x20successful!','./utils.js','fqdvw','1EeeKDf','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','BROWSERSTACK_TEST_OBSERVABILITY','auth','job_id','getCentralUser','20036388bFUJQL','QjWOR','error','message','NRBnj','false','api/v1/builds/','debug','checkAndSetupPercy','/stop','zBJuM','isBrowserstackInfra','format','getCiInfo','Error\x20while\x20waiting\x20for\x20events:\x20','PUT','logBuildError','exports','getGitMetaData','ACCESSIBILITY','PERCY_SUPPORTED_FRAMEWORKS','push','info','true','buildName','settings','getProductMap','2021781hpvyss','7PwAbJb','stop','QNnfF','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','data','8181855EtERca','setAccessibilityVariables','forEach','measureWrapper','PxDfM','POST','../../bin/playwright/reporter/pwUtils.js','BROWSERSTACK_TESTHUB_JWT','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','../test-observability/sessionHandler.js','null','STOP','getTraceFilePaths','isUndefined','jwt','BROWSERSTACK_CENTRAL_SCANNER_JWT','kcouf','HVoiM','zcwmw','allSettled','BS_TESTOPS_BUILD_COMPLETED'];a90_0x9ea8=function(){return _0x355037;};return a90_0x9ea8();}(function(_0x326398,_0x47df55){const _0x144ac9=a90_0x4b69,_0x4f20a0=_0x326398();while(!![]){try{const _0x47a4ec=-parseInt(_0x144ac9(0x115))/0x1*(parseInt(_0x144ac9(0xda))/0x2)+-parseInt(_0x144ac9(0x136))/0x3*(-parseInt(_0x144ac9(0xcc))/0x4)+-parseInt(_0x144ac9(0xe8))/0x5*(-parseInt(_0x144ac9(0xe3))/0x6)+-parseInt(_0x144ac9(0x137))/0x7*(parseInt(_0x144ac9(0xd3))/0x8)+-parseInt(_0x144ac9(0x108))/0x9+-parseInt(_0x144ac9(0x105))/0xa*(parseInt(_0x144ac9(0x13c))/0xb)+parseInt(_0x144ac9(0x11b))/0xc;if(_0x47a4ec===_0x47df55)break;else _0x4f20a0['push'](_0x4f20a0['shift']());}catch(_0x3b43c2){_0x4f20a0['push'](_0x4f20a0['shift']());}}}(a90_0x9ea8,0x71482));function a90_0x4b69(_0x38a63d,_0x5d6f7e){const _0x9ea85e=a90_0x9ea8();return a90_0x4b69=function(_0x4b6981,_0x44d371){_0x4b6981=_0x4b6981-0xbb;let _0x544085=_0x9ea85e[_0x4b6981];return _0x544085;},a90_0x4b69(_0x38a63d,_0x5d6f7e);}const bsSetupHelper=require('../helper'),path=require('path'),util=require(a90_0x5df58c(0xeb)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a90_0x5df58c(0x113)),testHubConstants=require('./constants.js'),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a90_0x5df58c(0xf2)),logger=require('../logger')['winstonLogger'],SessionHandler=require(a90_0x5df58c(0x145)),PerformanceTester=require(a90_0x5df58c(0xed)),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x5df58c(0xec)),TestDetails=require(a90_0x5df58c(0xc4)),{uploadTraceZip}=require(a90_0x5df58c(0x142)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x31bea9=>{OngoingEvents['add'](_0x31bea9);},awaitAllEvents=async()=>{const _0x31a86a=a90_0x5df58c;return Promise[_0x31a86a(0xc2)](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async[a90_0x5df58c(0x10a)](_0x3dcd1e,_0x3cefe1){const _0x58a92f=a90_0x5df58c,_0x1d0c44={'yjHQL':function(_0x2adc4,_0x2f47d1){return _0x2adc4||_0x2f47d1;},'dTtuO':function(_0x39befa,_0x4cbfc0){return _0x39befa||_0x4cbfc0;},'tVGIg':function(_0x4c25d8,_0x2b6e11){return _0x4c25d8===_0x2b6e11;},'iHbhc':function(_0x47612d){return _0x47612d();},'KvPmA':_0x58a92f(0x13a),'FouPf':_0x58a92f(0x120),'evvpA':_0x58a92f(0xd8),'HVoiM':function(_0x41bda6,_0x1e5c2b,_0xb4fc33,_0x1d40b0,_0x10be48){return _0x41bda6(_0x1e5c2b,_0xb4fc33,_0x1d40b0,_0x10be48);},'QNnfF':_0x58a92f(0x141),'GbcYN':function(_0x5c8a91,_0x770d66){return _0x5c8a91===_0x770d66;}};await PerformanceTester[_0x58a92f(0x13f)](PerformanceEvents[_0x58a92f(0xc5)],async()=>{const _0x487a48=_0x58a92f,_0x1a9867=Object['assign']({},_0x3cefe1['config'],{'root_dir_path':'','framework':_0x3cefe1['framework']}),_0x523890=bsSetupHelper[_0x487a48(0xff)](_0x1a9867),_0x3d8797=bsSetupHelper[_0x487a48(0xe5)](_0x1a9867),_0x22a974=_0x1d0c44[_0x487a48(0xdc)](_0x523890,'')+':'+_0x1d0c44[_0x487a48(0xdb)](_0x3d8797,''),_0x4600bd=testhubUtils[_0x487a48(0x135)](_0x1a9867);process[_0x487a48(0x104)]['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x487a48(0xd5)](_0x4600bd);if(_0x1d0c44[_0x487a48(0xc7)](_0x22a974,':'))return _0x1d0c44[_0x487a48(0xd0)](isTestObservabilitySession)&&(logger[_0x487a48(0x122)](_0x1d0c44[_0x487a48(0xcd)]),process[_0x487a48(0x104)][_0x487a48(0xc3)]=_0x1d0c44[_0x487a48(0x10e)]),testhubUtils['isAccessibilityEnabled'](_0x1a9867)&&logger[_0x487a48(0x122)](_0x1d0c44[_0x487a48(0xd7)]),[null,null];try{const _0x101328=await this['generateBuildUpstreamData'](_0x1a9867,_0x3dcd1e),_0x43faae=this['getConfig'](_0x523890,_0x3d8797),_0x5f31de=await _0x1d0c44[_0x487a48(0xc0)](nodeRequest,_0x1d0c44[_0x487a48(0x139)],testHubConstants[_0x487a48(0xd6)],_0x101328,_0x43faae),_0x4a4830=this[_0x487a48(0xe0)](_0x1a9867,_0x5f31de,_0x43faae);return await this[_0x487a48(0x123)](_0x3cefe1,_0x3dcd1e),_0x4a4830;}catch(_0x2ba033){if(_0x1d0c44[_0x487a48(0xf1)](_0x2ba033[_0x487a48(0xe2)],![])){testhubUtils[_0x487a48(0x12b)](_0x2ba033);return;}}})();}static async[a90_0x5df58c(0xc6)](){const _0x31b54a=a90_0x5df58c,_0x2a4fc7={'WvFwc':function(_0x2de916,_0x11979b,_0x17f605){return _0x2de916(_0x11979b,_0x17f605);},'PxDfM':function(_0x14dbe3,_0x3b0a8a){return _0x14dbe3(_0x3b0a8a);},'PtJHp':function(_0xe2626a){return _0xe2626a();},'rUcBa':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x2e6aad=TestDetails[_0x31b54a(0xbb)]();_0x2e6aad[_0x31b54a(0x13e)](({testUId:_0x5284eb,filePath:_0xd128d0})=>{const _0x4caa24=_0x31b54a;var _0x19169c=_0x2a4fc7['WvFwc'](uploadTraceZip,_0xd128d0,_0x5284eb);_0x2a4fc7[_0x4caa24(0x140)](addEvent,_0x19169c);});try{await _0x2a4fc7[_0x31b54a(0xf3)](awaitAllEvents),logger[_0x31b54a(0x122)](_0x2a4fc7['rUcBa']),processedTraceZips=!![];}catch(_0x30f6e2){logger['error'](_0x31b54a(0x129)+util[_0x31b54a(0x127)](_0x30f6e2));}}static async[a90_0x5df58c(0x123)](_0x63e1cd,_0x59b987){const _0x1aa3e1=a90_0x5df58c;if(constants[_0x1aa3e1(0x12f)][_0x1aa3e1(0xcb)](_0x59b987)){await _0x63e1cd[_0x1aa3e1(0xfb)]();return;}_0x63e1cd[_0x1aa3e1(0xfc)][_0x1aa3e1(0xc9)]&&logger[_0x1aa3e1(0x122)](_0x1aa3e1(0xf6)+_0x59b987+'\x20framework');}static[a90_0x5df58c(0x109)](_0xe93ad7){const _0x3ba7e9=a90_0x5df58c,_0x4d9f77={};_0x4d9f77[_0x3ba7e9(0x134)]=_0xe93ad7[_0x3ba7e9(0xee)];const _0x23da9e=_0x4d9f77;return _0x23da9e;}static[a90_0x5df58c(0xea)](_0xf64735,_0x474291){const _0x39124f=a90_0x5df58c,_0x4eed48={'NRBnj':function(_0x40626a,_0x3fc3a4){return _0x40626a(_0x3fc3a4);}},_0x5c01c7={};return _0x5c01c7['username']=_0xf64735,_0x5c01c7[_0x39124f(0xca)]=_0x474291,{'auth':_0x5c01c7,'headers':_0x4eed48[_0x39124f(0x11f)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x50bf55,_0x920378){const _0x5d47e0=a90_0x5df58c,_0xc31dae={'XZoRj':function(_0xc1d145,_0x5aa513){return _0xc1d145(_0x5aa513);}},_0x3de445={'project_name':_0x50bf55[_0x5d47e0(0xf8)]||'','name':_0x50bf55[_0x5d47e0(0x133)]||path[_0x5d47e0(0xe4)](path['resolve'](process[_0x5d47e0(0xfd)]())),'build_identifier':_0x50bf55[_0x5d47e0(0x10d)],'description':_0x50bf55['buildDescription']||'','started_at':new Date()[_0x5d47e0(0x103)](),'tags':_0xc31dae[_0x5d47e0(0xd9)](getCustomTags,_0x50bf55),'host_info':bsSetupHelper[_0x5d47e0(0xe9)](),'ci_info':bsSetupHelper[_0x5d47e0(0x128)](),'build_run_identifier':process[_0x5d47e0(0x104)][_0x5d47e0(0xe1)],'failed_tests_rerun':process[_0x5d47e0(0x104)][_0x5d47e0(0xfa)]||![],'version_control':await bsSetupHelper[_0x5d47e0(0x12d)](),'accessibility':this['getAccessibilityOptions'](_0x50bf55),'framework_details':testhubUtils['getFrameworkDetails'](_0x50bf55,_0x920378),'product_map':testhubUtils['getProductMap'](_0x50bf55),'browserstackAutomation':bsSetupHelper[_0x5d47e0(0x126)](),'grouping_identifier':process['env'][_0x5d47e0(0x116)]};if(bsSetupHelper[_0x5d47e0(0x11a)]()[_0x5d47e0(0x106)]||bsSetupHelper[_0x5d47e0(0x11a)]()['lcnc']){const _0xa450f6={};_0xa450f6[_0x5d47e0(0x119)]=process[_0x5d47e0(0x104)]['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0xa450f6['token']=process[_0x5d47e0(0x104)][_0x5d47e0(0xbe)],_0x3de445[_0x5d47e0(0x106)]=_0xa450f6;}return _0x3de445;}static[a90_0x5df58c(0xe0)](_0x2badff,_0x471e84,_0x35ed66){const _0x23dbb5=a90_0x5df58c,_0xed53e0={'QjWOR':function(_0x23a822){return _0x23a822();},'eFVBo':function(_0x5a2803,_0x449775){return _0x5a2803&&_0x449775;},'cPSes':_0x23dbb5(0x132),'wkHSj':'false','ELOlD':function(_0x1fd10e,_0x5cdb3e){return _0x1fd10e&&_0x5cdb3e;}},_0x3d9d47={};if(_0xed53e0[_0x23dbb5(0x11c)](isTestObservabilitySession)){const [_0x5fd065,_0xbe1842,_0x44ba32]=testhubUtils[_0x23dbb5(0xd2)](_0x471e84[_0x23dbb5(0x13b)],_0x35ed66[_0x23dbb5(0x118)]);if(_0xed53e0[_0x23dbb5(0xd4)](_0x5fd065,_0xbe1842)){const _0x51dc3c={};_0x51dc3c[_0x23dbb5(0xbd)]=_0x5fd065,_0x51dc3c[_0x23dbb5(0xe6)]=_0xbe1842,_0x51dc3c[_0x23dbb5(0xf5)]=_0x44ba32,_0x3d9d47[testHubConstants[_0x23dbb5(0xe7)]]=_0x51dc3c,process[_0x23dbb5(0x104)][_0x23dbb5(0x117)]=_0xed53e0['cPSes'];}else _0x3d9d47[testHubConstants[_0x23dbb5(0xe7)]]={},process['env'][_0x23dbb5(0x117)]=_0xed53e0[_0x23dbb5(0xf9)];}else process['env'][_0x23dbb5(0x117)]=_0xed53e0['wkHSj'];if(testhubUtils[_0x23dbb5(0xcf)](_0x2badff)){const [_0x59fdec,_0x2d4076]=testhubUtils[_0x23dbb5(0x13d)](_0x471e84[_0x23dbb5(0x13b)]);if(_0xed53e0[_0x23dbb5(0xf7)](_0x59fdec,_0x2d4076)){const _0x2ec2b7={};_0x2ec2b7[_0x23dbb5(0x101)]=_0x59fdec,_0x2ec2b7[_0x23dbb5(0xe6)]=_0x2d4076,_0x3d9d47[testHubConstants[_0x23dbb5(0x12e)]]=_0x2ec2b7,process[_0x23dbb5(0x104)]['BROWSERSTACK_ACCESSIBILITY']=_0xed53e0[_0x23dbb5(0xd1)];}else _0x3d9d47[testHubConstants[_0x23dbb5(0x12e)]]={},process[_0x23dbb5(0x104)][_0x23dbb5(0x100)]=_0xed53e0['wkHSj'];}else process[_0x23dbb5(0x104)][_0x23dbb5(0x100)]=_0xed53e0[_0x23dbb5(0xf9)];return testhubUtils[_0x23dbb5(0x111)](_0x471e84['data']),logger[_0x23dbb5(0x131)](_0x23dbb5(0xde)+process[_0x23dbb5(0x104)][_0x23dbb5(0xce)]),_0x3d9d47;}static async[a90_0x5df58c(0x138)](_0x12dd61){const _0x2e696b=a90_0x5df58c,_0x40b6ce={'VvstJ':function(_0x2d1114,_0x2c5986){return _0x2d1114===_0x2c5986;},'EsdTo':_0x2e696b(0x120),'QoVyh':_0x2e696b(0x146),'zcwmw':_0x2e696b(0x144),'fqdvw':'error','pfMPk':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','oRBdd':_0x2e696b(0x10b),'kcouf':'user_killed','mcUCG':function(_0x23d004){return _0x23d004();},'CrFcI':function(_0x530dc2,_0x4a3e2b,_0x58bd39,_0x1e6045,_0x4a0ef4,_0x10418b){return _0x530dc2(_0x4a3e2b,_0x58bd39,_0x1e6045,_0x4a0ef4,_0x10418b);},'PxGCZ':_0x2e696b(0x12a),'zBJuM':_0x2e696b(0x112),'DyciT':_0x2e696b(0xe2)};await this[_0x2e696b(0xc6)](),await PerformanceTester[_0x2e696b(0x13f)](PerformanceEvents[_0x2e696b(0x147)],async()=>{const _0x29f8a4=_0x2e696b;if(_0x40b6ce[_0x29f8a4(0x10f)](process[_0x29f8a4(0x104)]['BS_TESTOPS_BUILD_COMPLETED'],_0x40b6ce[_0x29f8a4(0x110)])||TestHubHandler[_0x29f8a4(0xf4)]||bsSetupHelper[_0x29f8a4(0xbc)](process[_0x29f8a4(0x104)][testHubConstants[_0x29f8a4(0xf0)]['BROWSERSTACK_TESTHUB_JWT']]))return;TestHubHandler[_0x29f8a4(0xf4)]=!![],await RequestQueueHandler['getInstance']()[_0x29f8a4(0x107)](),await SessionHandler[_0x29f8a4(0xfe)]();if(_0x40b6ce[_0x29f8a4(0x10f)](process['env'][testHubConstants[_0x29f8a4(0xf0)][_0x29f8a4(0x143)]],_0x40b6ce[_0x29f8a4(0xdd)])||_0x40b6ce['VvstJ'](process[_0x29f8a4(0x104)][testHubConstants[_0x29f8a4(0xf0)][_0x29f8a4(0xce)]],_0x40b6ce[_0x29f8a4(0xdd)])){logger[_0x29f8a4(0x122)](_0x40b6ce[_0x29f8a4(0xc1)]);const _0x3947c7={};return _0x3947c7[_0x29f8a4(0xc8)]=_0x40b6ce[_0x29f8a4(0x114)],_0x3947c7[_0x29f8a4(0x11e)]=_0x40b6ce['pfMPk'],_0x3947c7;}const _0x4037b5={'finished_at':new Date()[_0x29f8a4(0x103)](),'finished_metadata':[]};!!_0x12dd61&&_0x4037b5[_0x40b6ce['oRBdd']][_0x29f8a4(0x130)]({'reason':_0x40b6ce[_0x29f8a4(0xbf)],'signal':_0x12dd61,'failure_data':''});const _0x566bae={'headers':_0x40b6ce['mcUCG'](getDefaultHeaders)};try{const _0x498b4f=await _0x40b6ce['CrFcI'](nodeRequest,_0x40b6ce[_0x29f8a4(0xdf)],_0x29f8a4(0x121)+process['env'][testHubConstants[_0x29f8a4(0xf0)]['BROWSERSTACK_TESTHUB_UUID']]+_0x29f8a4(0x124),_0x4037b5,_0x566bae,![]);if(_0x498b4f[_0x29f8a4(0x13b)]&&_0x498b4f[_0x29f8a4(0x13b)][_0x29f8a4(0x11d)]){const _0x173639={};_0x173639[_0x29f8a4(0x11e)]=_0x498b4f[_0x29f8a4(0x13b)][_0x29f8a4(0x11d)];throw _0x173639;}else{logger[_0x29f8a4(0x122)](_0x40b6ce[_0x29f8a4(0x125)]);const _0x3bc622={};return _0x3bc622[_0x29f8a4(0xc8)]=_0x40b6ce['DyciT'],_0x3bc622['message']='',_0x3bc622;}}catch(_0x5c6f26){_0x5c6f26['response']?logger[_0x29f8a4(0x122)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x5c6f26['response']['status']+'\x20'+_0x5c6f26[_0x29f8a4(0xef)][_0x29f8a4(0x102)]+'\x20'+JSON[_0x29f8a4(0xd5)](_0x5c6f26[_0x29f8a4(0xef)][_0x29f8a4(0x13b)])):logger['debug'](_0x29f8a4(0x10c)+(_0x5c6f26[_0x29f8a4(0x11e)]||_0x5c6f26));const _0x3bec61={};return _0x3bec61[_0x29f8a4(0xc8)]=_0x40b6ce[_0x29f8a4(0x114)],_0x3bec61[_0x29f8a4(0x11e)]=_0x5c6f26[_0x29f8a4(0x11e)]||_0x5c6f26[_0x29f8a4(0xef)]?_0x5c6f26[_0x29f8a4(0xef)]['status']+':'+_0x5c6f26[_0x29f8a4(0xef)][_0x29f8a4(0x102)]:_0x5c6f26,_0x3bec61;}})();}}module[a90_0x5df58c(0x12c)]=TestHubHandler;
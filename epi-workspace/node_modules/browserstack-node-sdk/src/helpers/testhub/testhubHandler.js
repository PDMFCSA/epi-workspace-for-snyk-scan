function a139_0x1933(){const _0x45c247=['error','hYhOr','YWwaW','TrRMd','getCentralUser','BROWSERSTACK_PRODUCT_MAP','resolve','response','ACCESSIBILITY','username','BROWSERSTACK_TEST_OBSERVABILITY','../../bin/playwright/reporter/pwUtils.js','central_scanner','PUT','statusText','FnYNM','126ONGpJK','BROWSERSTACK_TESTHUB_UUID','pkSsO','setTestHubCommonMetaInfo','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','buildStopSent','getAccessibilityValueFromYml','../performance/constants','getInstance','BROWSERSTACK_RERUN','mauhl','hNgqH','scannerProcessingTimeout','env','message','getAccessKey','add','buildHashedId','Error\x20while\x20waiting\x20for\x20events:\x20','\x20framework','checkAndSetupPercy','2Tpkmfi','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','isAccessibilityEnabled','getFrameworkDetails','/stop','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','getProductMapForBuildStartCall','lhsTR','BS_TESTOPS_BUILD_COMPLETED','isBrowserstackInfra','kgZVo','10LAlbBT','cwd','../test-observability/requestQueueHandler.js','launchBuild','../helper','ERymB','allSettled','buildDescription','config','basename','authToken','484281qGKUdD','VJeCx','Testhub\x20started\x20with\x20id:\x20','projectName','rLZwG','HOjEQ','accessibilityOptions','BROWSERSTACK_CENTRAL_SCANNER_JOBID','true','status','api/v1/builds/','wSlHv','YjKhv','OBSERVABILITY','assign','BROWSERSTACK_ACCESSIBILITY','waitForBuildStatus','Percy\x20is\x20not\x20supported\x20for\x20','percy','All\x20trace\x20zip\x20send\x20events\x20complete','DNEed','../../bin/v2/browserstackCLI','BAesC','stop','tzJTB','data','ilPuE','RXiTB','user_killed','86425BbNQzw','isUndefined','POST','862040SxSyZn','getConfig','BROWSERSTACK_CENTRAL_SCANNER_JWT','PERCY_SUPPORTED_FRAMEWORKS','getTestOrchestrationBuildStartData','debug','1416195FcbCjU','2395617iUyFJP','IjxTG','jznOB','setupPercy','toISOString','../test-observability/utils','setTestObservabilityVariables','password','token','getHostInfo','jwt','oIeLE','format','BROWSERSTACK_TESTHUB_JWT','extractDataFromResponse','../../bin/utils/constants.js','getUserName','START','generateBuildUpstreamData','UaGxi','measureWrapper','TESTHUB_BUILD_API','473156EkFYDa','info','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','accessibility','../performance/performance-tester.js','getTraceFilePaths','../logger','dkbGw','1560679SvKNew','UPviR','getCiInfo','null','IWAgs','setAccessibilityVariables','ENV_VAR','IWfwV','success','processTraceZips','false','epbOi','../helper.js','forEach','job_id','./utils.js','settings','allowScreenshot','buildName','winstonLogger'];a139_0x1933=function(){return _0x45c247;};return a139_0x1933();}const a139_0x175351=a139_0x2ec8;function a139_0x2ec8(_0x46169f,_0x5a4ad7){const _0x193319=a139_0x1933();return a139_0x2ec8=function(_0x2ec837,_0x5865ef){_0x2ec837=_0x2ec837-0xb1;let _0x110296=_0x193319[_0x2ec837];return _0x110296;},a139_0x2ec8(_0x46169f,_0x5a4ad7);}(function(_0x53f61b,_0x36ee90){const _0xc143ba=a139_0x2ec8,_0x3f9912=_0x53f61b();while(!![]){try{const _0x1a2cba=-parseInt(_0xc143ba(0xe9))/0x1*(-parseInt(_0xc143ba(0x122))/0x2)+-parseInt(_0xc143ba(0xcb))/0x3+-parseInt(_0xc143ba(0xe1))/0x4+parseInt(_0xc143ba(0xc1))/0x5*(parseInt(_0xc143ba(0x10d))/0x6)+parseInt(_0xc143ba(0x138))/0x7+-parseInt(_0xc143ba(0xc4))/0x8+-parseInt(_0xc143ba(0xca))/0x9*(parseInt(_0xc143ba(0x12d))/0xa);if(_0x1a2cba===_0x36ee90)break;else _0x3f9912['push'](_0x3f9912['shift']());}catch(_0x43a847){_0x3f9912['push'](_0x3f9912['shift']());}}}(a139_0x1933,0xc5f9d));const bsSetupHelper=require(a139_0x175351(0x131)),path=require('path'),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a139_0x175351(0xd0)),testhubUtils=require(a139_0x175351(0xf8)),testHubConstants=require('./constants.js'),constants=require(a139_0x175351(0xda)),RequestQueueHandler=require(a139_0x175351(0x12f)),logger=require(a139_0x175351(0xe7))[a139_0x175351(0xfc)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a139_0x175351(0xe5)),{TESTHUB_EVENTS:PerformanceEvents}=require(a139_0x175351(0x114)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),{uploadTraceZip}=require(a139_0x175351(0x108)),{isTurboScaleSession}=require(a139_0x175351(0xf5)),BrowserstackCLI=require(a139_0x175351(0xb9)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x331cd1=>{const _0x2962c2=a139_0x175351;OngoingEvents[_0x2962c2(0x11d)](_0x331cd1);},awaitAllEvents=async()=>{const _0x27fc57=a139_0x175351;return Promise[_0x27fc57(0x133)](OngoingEvents);};class TestHubHandler{static [a139_0x175351(0x112)]=![];static async[a139_0x175351(0x130)](_0x12306f,_0x5330ef){const _0x189c01=a139_0x175351,_0x2d19e0={'ERymB':function(_0x20acb4,_0xbab728){return _0x20acb4||_0xbab728;},'UaGxi':function(_0x49c3b9,_0x450c7f){return _0x49c3b9===_0x450c7f;},'tzJTB':function(_0x1c7aa8){return _0x1c7aa8();},'ABnEY':'EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','IWAgs':_0x189c01(0xf3),'wfCVL':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','iwmZx':function(_0xe5a2c4,_0x5b2aba,_0x3eaeba,_0x2ba965,_0x27ea02){return _0xe5a2c4(_0x5b2aba,_0x3eaeba,_0x2ba965,_0x27ea02);},'epbOi':_0x189c01(0xc3),'QBuVb':function(_0x55b188,_0x4c1ab0){return _0x55b188===_0x4c1ab0;},'dkbGw':_0x189c01(0xe4),'oIeLE':'true','RXiTB':'scannerProcessingTimeout'};await PerformanceTester[_0x189c01(0xdf)](PerformanceEvents[_0x189c01(0xdc)],async()=>{const _0xab9c26=_0x189c01,_0xf2b686=Object[_0xab9c26(0xb2)]({},_0x5330ef[_0xab9c26(0x135)],{'root_dir_path':'','framework':_0x5330ef['framework']}),_0x1dc049=bsSetupHelper[_0xab9c26(0xdb)](_0xf2b686),_0x2d5740=bsSetupHelper[_0xab9c26(0x11c)](_0xf2b686),_0x3401b7=_0x2d19e0['ERymB'](_0x1dc049,'')+':'+_0x2d19e0[_0xab9c26(0x132)](_0x2d5740,'');if(_0x2d19e0[_0xab9c26(0xde)](_0x3401b7,':'))return _0x2d19e0[_0xab9c26(0xbc)](isTestObservabilitySession)&&(logger['debug'](_0x2d19e0['ABnEY']),process[_0xab9c26(0x11a)][_0xab9c26(0x12a)]=_0x2d19e0[_0xab9c26(0xed)]),testhubUtils[_0xab9c26(0x124)](_0xf2b686)&&logger[_0xab9c26(0xc9)](_0x2d19e0['wfCVL']),[null,null];try{const _0x5375b1=await this[_0xab9c26(0xdd)](_0xf2b686,_0x12306f),_0x4820ff=this[_0xab9c26(0xc5)](_0x1dc049,_0x2d5740),_0x4747b1=await _0x2d19e0['iwmZx'](nodeRequest,_0x2d19e0[_0xab9c26(0xf4)],testHubConstants[_0xab9c26(0xe0)],_0x5375b1,_0x4820ff),_0x47ad8a=this[_0xab9c26(0xd9)](_0xf2b686,_0x4747b1,_0x4820ff);await this['checkAndSetupPercy'](_0x5330ef,_0x12306f);const _0xe3fffa=testhubUtils['getProductMap'](_0xf2b686);process[_0xab9c26(0x11a)][_0xab9c26(0x102)]=JSON['stringify'](_0xe3fffa);if(_0x2d19e0['QBuVb'](testhubUtils[_0xab9c26(0x113)](_0x5330ef[_0xab9c26(0x135)]),null)){const _0x264ed8=_0x47ad8a[_0x2d19e0[_0xab9c26(0xe8)]];_0x264ed8&&_0x264ed8[_0xab9c26(0x137)]&&_0x264ed8[_0xab9c26(0x11e)]&&(_0x5330ef['config'][_0xab9c26(0xe4)]=!![],process[_0xab9c26(0x11a)][_0xab9c26(0x123)]=_0x2d19e0[_0xab9c26(0xd6)]);}return _0x47ad8a&&_0x47ad8a[_0x2d19e0[_0xab9c26(0xe8)]]&&_0x47ad8a[_0x2d19e0['dkbGw']][_0x2d19e0[_0xab9c26(0xbf)]]&&(process['env']['BROWSERSTACK_TEST_ACCESSIBILITY_SCRIPT_TIMEOUT']=_0x47ad8a[_0x2d19e0[_0xab9c26(0xe8)]][_0x2d19e0['RXiTB']]),_0x47ad8a;}catch(_0x207d6c){if(_0x2d19e0[_0xab9c26(0xde)](_0x207d6c[_0xab9c26(0xf1)],![])){testhubUtils['logBuildError'](_0x207d6c);return;}}})();}static async['processTraceZips'](){const _0x2e584e=a139_0x175351,_0x300c1b={'FnYNM':function(_0x246c64,_0x4b4c46,_0x248387){return _0x246c64(_0x4b4c46,_0x248387);},'zELEh':function(_0x2f2cb5,_0x45e8b2){return _0x2f2cb5(_0x45e8b2);},'EhfMy':function(_0x3f045b){return _0x3f045b();},'UPviR':_0x2e584e(0xb7)};if(processedTraceZips)return;const _0x1aa955=TestDetails[_0x2e584e(0xe6)]();_0x1aa955[_0x2e584e(0xf6)](({testUId:_0x250c07,filePath:_0x476d39})=>{const _0x2476bb=_0x2e584e;var _0x38439b=_0x300c1b[_0x2476bb(0x10c)](uploadTraceZip,_0x476d39,_0x250c07);_0x300c1b['zELEh'](addEvent,_0x38439b);});try{await _0x300c1b['EhfMy'](awaitAllEvents),logger[_0x2e584e(0xc9)](_0x300c1b[_0x2e584e(0xea)]),processedTraceZips=!![];}catch(_0x520cbf){logger[_0x2e584e(0xfd)](_0x2e584e(0x11f)+util[_0x2e584e(0xd7)](_0x520cbf));}}static async[a139_0x175351(0x121)](_0x5aece4,_0x1fe53f){const _0x1caf1c=a139_0x175351;if(constants[_0x1caf1c(0xc7)]['includes'](_0x1fe53f)){await _0x5aece4[_0x1caf1c(0xce)]();return;}_0x5aece4[_0x1caf1c(0x135)][_0x1caf1c(0xb6)]&&logger[_0x1caf1c(0xc9)](_0x1caf1c(0xb5)+_0x1fe53f+_0x1caf1c(0x120));}static['getAccessibilityOptions'](_0x1eaf77){const _0x143040=a139_0x175351,_0x1c2265={'TrRMd':function(_0x49f21e,_0x4d916){return _0x49f21e(_0x4d916);},'BAesC':'true'};let _0x2be0dc;if(_0x1eaf77['accessibilityOptions']){const _0x11fd2d={};_0x11fd2d[_0x143040(0xf9)]=_0x1eaf77[_0x143040(0x13e)],_0x2be0dc=_0x11fd2d;}else{const _0x27fab7={};_0x27fab7['settings']={},_0x2be0dc=_0x27fab7;}if((!bsSetupHelper['isBrowserstackInfra']()||_0x1c2265[_0x143040(0x100)](isTurboScaleSession,_0x1eaf77))&&testhubUtils[_0x143040(0x124)](_0x1eaf77)){const _0x3b960b={};_0x3b960b['includeEncodedExtension']=_0x1c2265[_0x143040(0xba)],Object[_0x143040(0xb2)](_0x2be0dc[_0x143040(0xf9)],_0x3b960b);}return _0x2be0dc;}static[a139_0x175351(0xc5)](_0x12a85d,_0x164528){const _0x2ad965=a139_0x175351,_0x48136f={'zngNY':function(_0x1a2241,_0x1ae001){return _0x1a2241(_0x1ae001);}},_0x37484b={};return _0x37484b[_0x2ad965(0x106)]=_0x12a85d,_0x37484b[_0x2ad965(0xd2)]=_0x164528,{'auth':_0x37484b,'headers':_0x48136f['zngNY'](getDefaultHeaders,![])};}static async[a139_0x175351(0xdd)](_0x5127bd,_0x5ab268){const _0x5bc420=a139_0x175351,_0x1f06cc={'IWfwV':'Generating\x20build\x20upstream\x20data\x20for\x20TestHub','IjxTG':function(_0x44ed47,_0x3bb50d){return _0x44ed47(_0x3bb50d);}};logger[_0x5bc420(0xc9)](_0x1f06cc[_0x5bc420(0xf0)]);const _0x2d8255={'project_name':_0x5127bd[_0x5bc420(0x13b)]||'','name':_0x5127bd[_0x5bc420(0xfb)]||path[_0x5bc420(0x136)](path[_0x5bc420(0x103)](process[_0x5bc420(0x12e)]())),'build_identifier':_0x5127bd['buildIdentifier'],'description':_0x5127bd[_0x5bc420(0x134)]||'','started_at':new Date()['toISOString'](),'tags':_0x1f06cc[_0x5bc420(0xcc)](getCustomTags,_0x5127bd),'host_info':bsSetupHelper[_0x5bc420(0xd4)](),'ci_info':bsSetupHelper[_0x5bc420(0xeb)](),'build_run_identifier':process[_0x5bc420(0x11a)]['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process['env'][_0x5bc420(0x116)]||![],'linked_build_uuid':process['env']['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper['getGitMetaData'](),'accessibility':this['getAccessibilityOptions'](_0x5127bd),'framework_details':testhubUtils[_0x5bc420(0x125)](_0x5127bd,_0x5ab268),'product_map':testhubUtils[_0x5bc420(0x128)](_0x5127bd),'browserstackAutomation':bsSetupHelper[_0x5bc420(0x12b)](),'grouping_identifier':process[_0x5bc420(0x11a)][_0x5bc420(0xe3)],'test_orchestration':testhubUtils[_0x5bc420(0xc8)](_0x5127bd)};if(bsSetupHelper[_0x5bc420(0x101)]()[_0x5bc420(0x109)]||bsSetupHelper['getCentralUser']()['lcnc']){const _0xaa86e3={};_0xaa86e3[_0x5bc420(0xf7)]=process[_0x5bc420(0x11a)][_0x5bc420(0x13f)],_0xaa86e3[_0x5bc420(0xd3)]=process[_0x5bc420(0x11a)][_0x5bc420(0xc6)],_0x2d8255['central_scanner']=_0xaa86e3;}return _0x2d8255;}static[a139_0x175351(0xd9)](_0x252168,_0x24441d,_0x8b1651){const _0x368488=a139_0x175351,_0x5dace0={'rLZwG':function(_0x26a27d){return _0x26a27d();},'DiNYU':function(_0x360df3,_0x5386c2){return _0x360df3&&_0x5386c2;},'YWwaW':_0x368488(0x140),'kgZVo':_0x368488(0xf3),'ilPuE':function(_0x1d101a,_0xb7b1e5){return _0x1d101a&&_0xb7b1e5;}},_0x1f0ee2={};if(_0x5dace0[_0x368488(0x13c)](isTestObservabilitySession)){const [_0x45a8d3,_0x530a8c,_0x334e22]=testhubUtils[_0x368488(0xd1)](_0x24441d[_0x368488(0xbd)],_0x8b1651['auth']);if(_0x5dace0['DiNYU'](_0x45a8d3,_0x530a8c)){const _0x4129f0={};_0x4129f0[_0x368488(0xd5)]=_0x45a8d3,_0x4129f0[_0x368488(0x11e)]=_0x530a8c,_0x4129f0[_0x368488(0xfa)]=_0x334e22,_0x1f0ee2[testHubConstants[_0x368488(0xb1)]]=_0x4129f0,process[_0x368488(0x11a)][_0x368488(0x107)]=_0x5dace0[_0x368488(0xff)];}else _0x1f0ee2[testHubConstants[_0x368488(0xb1)]]={},process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x5dace0['kgZVo'];}else process[_0x368488(0x11a)][_0x368488(0x107)]=_0x5dace0[_0x368488(0x12c)];const [_0x33ebfa,_0x43375a,_0x458baf]=testhubUtils[_0x368488(0xee)](_0x24441d[_0x368488(0xbd)]);if(_0x5dace0[_0x368488(0xbe)](_0x33ebfa,_0x43375a)){const _0x49c421={};_0x49c421[_0x368488(0x137)]=_0x33ebfa,_0x49c421[_0x368488(0x11e)]=_0x43375a,_0x49c421[_0x368488(0x119)]=_0x458baf,_0x1f0ee2[testHubConstants[_0x368488(0x105)]]=_0x49c421,process['env'][_0x368488(0xb3)]=_0x5dace0[_0x368488(0xff)];}else _0x1f0ee2[testHubConstants['ACCESSIBILITY']]={},process[_0x368488(0x11a)][_0x368488(0xb3)]=_0x5dace0['kgZVo'];return testhubUtils[_0x368488(0x110)](_0x24441d[_0x368488(0xbd)]),logger[_0x368488(0xe2)](_0x368488(0x13a)+process['env'][_0x368488(0x10e)]),_0x1f0ee2;}static async[a139_0x175351(0xbb)](_0x5973a7){const _0x17d319=a139_0x175351,_0x13b8bb={'hNgqH':function(_0x5321f5,_0xec4464){return _0x5321f5===_0xec4464;},'mauhl':_0x17d319(0xf3),'wSlHv':function(_0x404ac5,_0x56e477){return _0x404ac5===_0x56e477;},'pkSsO':_0x17d319(0xec),'YjKhv':_0x17d319(0x127),'HOjEQ':_0x17d319(0xfd),'jznOB':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','VPcIV':'finished_metadata','DNEed':_0x17d319(0xc0),'hYhOr':function(_0x5aa636){return _0x5aa636();},'jsxYW':function(_0x42c6a2,_0x3c394e,_0x2a30a1,_0x44e642,_0x58d6e2,_0xd1741b){return _0x42c6a2(_0x3c394e,_0x2a30a1,_0x44e642,_0x58d6e2,_0xd1741b);},'yTiEX':_0x17d319(0x10a),'VJeCx':'stopBuildUpstream\x20event\x20successful!','lhsTR':_0x17d319(0xf1)};await PerformanceTester[_0x17d319(0xdf)](PerformanceEvents['STOP'],async()=>{const _0x30df48=_0x17d319;if(_0x13b8bb[_0x30df48(0x118)](process[_0x30df48(0x11a)][_0x30df48(0x12a)],_0x13b8bb[_0x30df48(0x117)])||TestHubHandler[_0x30df48(0x112)]||bsSetupHelper[_0x30df48(0xc2)](process[_0x30df48(0x11a)][testHubConstants[_0x30df48(0xef)][_0x30df48(0xd8)]]))return;TestHubHandler[_0x30df48(0x112)]=!![];if(BrowserstackCLI[_0x30df48(0x115)]()['isRunning']())return;await this[_0x30df48(0xf2)](),await RequestQueueHandler[_0x30df48(0x115)]()['uploadPending'](),await SessionHandler[_0x30df48(0xb4)]();if(_0x13b8bb['wSlHv'](process[_0x30df48(0x11a)][testHubConstants[_0x30df48(0xef)]['BROWSERSTACK_TESTHUB_JWT']],_0x13b8bb['pkSsO'])||_0x13b8bb[_0x30df48(0x143)](process[_0x30df48(0x11a)][testHubConstants[_0x30df48(0xef)][_0x30df48(0x10e)]],_0x13b8bb[_0x30df48(0x10f)])){logger[_0x30df48(0xc9)](_0x13b8bb[_0x30df48(0x144)]);const _0x150c2f={};return _0x150c2f[_0x30df48(0x141)]=_0x13b8bb[_0x30df48(0x13d)],_0x150c2f[_0x30df48(0x11b)]=_0x13b8bb[_0x30df48(0xcd)],_0x150c2f;}const _0xfa6872={'finished_at':new Date()[_0x30df48(0xcf)](),'finished_metadata':[]};!!_0x5973a7&&_0xfa6872[_0x13b8bb['VPcIV']]['push']({'reason':_0x13b8bb[_0x30df48(0xb8)],'signal':_0x5973a7,'failure_data':''});const _0x39c2d0={'headers':_0x13b8bb[_0x30df48(0xfe)](getDefaultHeaders)};try{const _0x2bdb79=await _0x13b8bb['jsxYW'](nodeRequest,_0x13b8bb['yTiEX'],_0x30df48(0x142)+process[_0x30df48(0x11a)][testHubConstants[_0x30df48(0xef)][_0x30df48(0x10e)]]+_0x30df48(0x126),_0xfa6872,_0x39c2d0,![]);if(_0x2bdb79[_0x30df48(0xbd)]&&_0x2bdb79['data']['error']){const _0x4c57bc={};_0x4c57bc[_0x30df48(0x11b)]=_0x2bdb79[_0x30df48(0xbd)][_0x30df48(0xfd)];throw _0x4c57bc;}else{logger['debug'](_0x13b8bb[_0x30df48(0x139)]);const _0x7790a9={};return _0x7790a9['status']=_0x13b8bb[_0x30df48(0x129)],_0x7790a9[_0x30df48(0x11b)]='',_0x7790a9;}}catch(_0x52ee3e){_0x52ee3e[_0x30df48(0x104)]?logger[_0x30df48(0xc9)](_0x30df48(0x111)+_0x52ee3e['response'][_0x30df48(0x141)]+'\x20'+_0x52ee3e[_0x30df48(0x104)][_0x30df48(0x10b)]+'\x20'+JSON['stringify'](_0x52ee3e[_0x30df48(0x104)][_0x30df48(0xbd)])):logger[_0x30df48(0xc9)](_0x30df48(0x111)+(_0x52ee3e[_0x30df48(0x11b)]||_0x52ee3e));const _0x4f5ed3={};return _0x4f5ed3[_0x30df48(0x141)]=_0x13b8bb['HOjEQ'],_0x4f5ed3[_0x30df48(0x11b)]=_0x52ee3e[_0x30df48(0x11b)]||_0x52ee3e[_0x30df48(0x104)]?_0x52ee3e[_0x30df48(0x104)]['status']+':'+_0x52ee3e[_0x30df48(0x104)][_0x30df48(0x10b)]:_0x52ee3e,_0x4f5ed3;}})();}}module['exports']=TestHubHandler;
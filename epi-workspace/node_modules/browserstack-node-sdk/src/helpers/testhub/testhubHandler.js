function a90_0x2da4(_0x138c56,_0x20addb){const _0x3c8e6e=a90_0x3c8e();return a90_0x2da4=function(_0x2da439,_0x18cfcf){_0x2da439=_0x2da439-0x172;let _0x309876=_0x3c8e6e[_0x2da439];return _0x309876;},a90_0x2da4(_0x138c56,_0x20addb);}const a90_0x2d0cb4=a90_0x2da4;(function(_0x3e92b,_0x2c2dc5){const _0x4854d0=a90_0x2da4,_0x45c95e=_0x3e92b();while(!![]){try{const _0x5d227c=-parseInt(_0x4854d0(0x1a8))/0x1+-parseInt(_0x4854d0(0x1dd))/0x2+parseInt(_0x4854d0(0x17d))/0x3+parseInt(_0x4854d0(0x1f4))/0x4*(-parseInt(_0x4854d0(0x1a3))/0x5)+parseInt(_0x4854d0(0x1f5))/0x6*(parseInt(_0x4854d0(0x201))/0x7)+parseInt(_0x4854d0(0x1ab))/0x8+-parseInt(_0x4854d0(0x1ce))/0x9;if(_0x5d227c===_0x2c2dc5)break;else _0x45c95e['push'](_0x45c95e['shift']());}catch(_0x4a0681){_0x45c95e['push'](_0x45c95e['shift']());}}}(a90_0x3c8e,0x504e6));const bsSetupHelper=require(a90_0x2d0cb4(0x175)),path=require('path'),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x2d0cb4(0x1e8)),testhubUtils=require('./utils.js'),testHubConstants=require('./constants.js'),constants=require(a90_0x2d0cb4(0x1f2)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a90_0x2d0cb4(0x1a4))[a90_0x2d0cb4(0x1c5)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a90_0x2d0cb4(0x1ef)),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x2d0cb4(0x1c7)),TestDetails=require(a90_0x2d0cb4(0x1aa)),{uploadTraceZip}=require(a90_0x2d0cb4(0x1ba)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x447559=>{const _0x4f6ba9=a90_0x2d0cb4;OngoingEvents[_0x4f6ba9(0x18f)](_0x447559);},awaitAllEvents=async()=>{const _0x2d92f6=a90_0x2d0cb4;return Promise[_0x2d92f6(0x1f6)](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async['launchBuild'](_0x5aae75,_0xe8de77){const _0x5a815f=a90_0x2d0cb4,_0x5cdaac={'AXNnk':function(_0x2988e7,_0x221609){return _0x2988e7||_0x221609;},'POiux':function(_0x489ed9,_0x174533){return _0x489ed9===_0x174533;},'mkYDc':function(_0x684b2d){return _0x684b2d();},'IGjKf':_0x5a815f(0x1e1),'XvkfR':_0x5a815f(0x18c),'tSZpK':_0x5a815f(0x199),'sOUsa':function(_0x5ecf24,_0x190bd2,_0x4af855,_0x486a60,_0x236426){return _0x5ecf24(_0x190bd2,_0x4af855,_0x486a60,_0x236426);},'pByli':_0x5a815f(0x193),'oxCUL':function(_0x27a908,_0x1dd934){return _0x27a908===_0x1dd934;},'xWndl':_0x5a815f(0x173),'LAgCI':_0x5a815f(0x1ad)};await PerformanceTester[_0x5a815f(0x203)](PerformanceEvents[_0x5a815f(0x1c6)],async()=>{const _0x3e36bb=_0x5a815f,_0x2def8a=Object[_0x3e36bb(0x178)]({},_0xe8de77['config'],{'root_dir_path':'','framework':_0xe8de77[_0x3e36bb(0x1d1)]}),_0x4e0877=bsSetupHelper[_0x3e36bb(0x1bc)](_0x2def8a),_0x43ab8=bsSetupHelper['getAccessKey'](_0x2def8a),_0x335e11=_0x5cdaac[_0x3e36bb(0x1a7)](_0x4e0877,'')+':'+_0x5cdaac['AXNnk'](_0x43ab8,''),_0xd738b7=testhubUtils[_0x3e36bb(0x1c3)](_0x2def8a);process['env']['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x3e36bb(0x174)](_0xd738b7);if(_0x5cdaac['POiux'](_0x335e11,':'))return _0x5cdaac[_0x3e36bb(0x1a1)](isTestObservabilitySession)&&(logger[_0x3e36bb(0x1dc)](_0x5cdaac[_0x3e36bb(0x1df)]),process[_0x3e36bb(0x1b0)]['BS_TESTOPS_BUILD_COMPLETED']=_0x5cdaac[_0x3e36bb(0x1b7)]),testhubUtils['isAccessibilityEnabled'](_0x2def8a)&&logger[_0x3e36bb(0x1dc)](_0x5cdaac['tSZpK']),[null,null];try{const _0xf26c63=await this[_0x3e36bb(0x17f)](_0x2def8a,_0x5aae75),_0xbd471e=this[_0x3e36bb(0x184)](_0x4e0877,_0x43ab8),_0x174be4=await _0x5cdaac[_0x3e36bb(0x1eb)](nodeRequest,_0x5cdaac[_0x3e36bb(0x17e)],testHubConstants[_0x3e36bb(0x1b8)],_0xf26c63,_0xbd471e),_0x4f9e3c=this[_0x3e36bb(0x1a0)](_0x2def8a,_0x174be4,_0xbd471e);await this[_0x3e36bb(0x1cb)](_0xe8de77,_0x5aae75);if(_0x5cdaac[_0x3e36bb(0x204)](testhubUtils['getAccessibilityValueFromYml'](_0xe8de77['config']),null)){const _0x42f69c=_0x4f9e3c[_0x5cdaac[_0x3e36bb(0x196)]];_0x42f69c&&_0x42f69c[_0x3e36bb(0x172)]&&_0x42f69c['buildHashedId']&&(_0xe8de77[_0x3e36bb(0x1ca)][_0x3e36bb(0x173)]=!![],process['env'][_0x3e36bb(0x186)]=_0x5cdaac[_0x3e36bb(0x188)]);}return _0x4f9e3c;}catch(_0x948de8){if(_0x5cdaac[_0x3e36bb(0x1ee)](_0x948de8['success'],![])){testhubUtils[_0x3e36bb(0x1cf)](_0x948de8);return;}}})();}static async['processTraceZips'](){const _0x190f13=a90_0x2d0cb4,_0x599b79={'ZPXRT':function(_0xe78b5b,_0x34aaa2,_0x13b734){return _0xe78b5b(_0x34aaa2,_0x13b734);},'eCrbs':function(_0x26fde2,_0x59dc05){return _0x26fde2(_0x59dc05);},'jHikB':function(_0x27fc95){return _0x27fc95();},'SUJpt':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x4d8ca5=TestDetails[_0x190f13(0x1b1)]();_0x4d8ca5[_0x190f13(0x1f0)](({testUId:_0x55b515,filePath:_0x29e6f3})=>{const _0xd1b630=_0x190f13;var _0x2c5ce0=_0x599b79[_0xd1b630(0x1a2)](uploadTraceZip,_0x29e6f3,_0x55b515);_0x599b79[_0xd1b630(0x1a9)](addEvent,_0x2c5ce0);});try{await _0x599b79[_0x190f13(0x19b)](awaitAllEvents),logger['debug'](_0x599b79[_0x190f13(0x1b4)]),processedTraceZips=!![];}catch(_0x13e9d1){logger[_0x190f13(0x177)](_0x190f13(0x17a)+util[_0x190f13(0x191)](_0x13e9d1));}}static async[a90_0x2d0cb4(0x1cb)](_0x33de62,_0x59e8c7){const _0x2c3edc=a90_0x2d0cb4;if(constants[_0x2c3edc(0x1cd)][_0x2c3edc(0x1d3)](_0x59e8c7)){await _0x33de62[_0x2c3edc(0x1c8)]();return;}_0x33de62[_0x2c3edc(0x1ca)][_0x2c3edc(0x1d9)]&&logger['debug'](_0x2c3edc(0x197)+_0x59e8c7+'\x20framework');}static['getAccessibilityOptions'](_0x565edc){const _0x247b92=a90_0x2d0cb4,_0x2ff250={};_0x2ff250['settings']=_0x565edc[_0x247b92(0x1e9)];const _0x5b1c04=_0x2ff250;return _0x5b1c04;}static[a90_0x2d0cb4(0x184)](_0x4e9909,_0x4afaa5){const _0x4f40e0=a90_0x2d0cb4,_0x7df065={'SgaNV':function(_0x56c17e,_0x1d34e8){return _0x56c17e(_0x1d34e8);}},_0x383c02={};return _0x383c02[_0x4f40e0(0x19e)]=_0x4e9909,_0x383c02[_0x4f40e0(0x1fd)]=_0x4afaa5,{'auth':_0x383c02,'headers':_0x7df065[_0x4f40e0(0x1c9)](getDefaultHeaders,![])};}static async[a90_0x2d0cb4(0x17f)](_0xf96f76,_0x1e9f32){const _0x1698bb=a90_0x2d0cb4,_0x4c8aaa={'aBUrQ':function(_0x41faac,_0x4791cb){return _0x41faac(_0x4791cb);}},_0x22f884={'project_name':_0xf96f76[_0x1698bb(0x1d7)]||'','name':_0xf96f76['buildName']||path[_0x1698bb(0x1e7)](path[_0x1698bb(0x179)](process['cwd']())),'build_identifier':_0xf96f76[_0x1698bb(0x1c0)],'description':_0xf96f76[_0x1698bb(0x1e5)]||'','started_at':new Date()[_0x1698bb(0x1cc)](),'tags':_0x4c8aaa[_0x1698bb(0x198)](getCustomTags,_0xf96f76),'host_info':bsSetupHelper[_0x1698bb(0x1e0)](),'ci_info':bsSetupHelper[_0x1698bb(0x1a6)](),'build_run_identifier':process[_0x1698bb(0x1b0)][_0x1698bb(0x1b3)],'failed_tests_rerun':process[_0x1698bb(0x1b0)]['BROWSERSTACK_RERUN']||![],'version_control':await bsSetupHelper[_0x1698bb(0x1be)](),'accessibility':this[_0x1698bb(0x182)](_0xf96f76),'framework_details':testhubUtils[_0x1698bb(0x1d2)](_0xf96f76,_0x1e9f32),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0xf96f76),'browserstackAutomation':bsSetupHelper[_0x1698bb(0x1f7)](),'grouping_identifier':process[_0x1698bb(0x1b0)][_0x1698bb(0x1fe)]};if(bsSetupHelper['getCentralUser']()[_0x1698bb(0x1e3)]||bsSetupHelper['getCentralUser']()[_0x1698bb(0x190)]){const _0x11da2a={};_0x11da2a[_0x1698bb(0x194)]=process[_0x1698bb(0x1b0)][_0x1698bb(0x1d0)],_0x11da2a[_0x1698bb(0x1d8)]=process[_0x1698bb(0x1b0)][_0x1698bb(0x1db)],_0x22f884['central_scanner']=_0x11da2a;}return _0x22f884;}static[a90_0x2d0cb4(0x1a0)](_0x331e6e,_0x1d9f78,_0x591707){const _0x1cec1b=a90_0x2d0cb4,_0x827744={'vKhcY':function(_0xd09f65){return _0xd09f65();},'eTLNk':function(_0x3e892b,_0xefc348){return _0x3e892b&&_0xefc348;},'tYxyw':_0x1cec1b(0x1ad),'IhoBc':_0x1cec1b(0x18c),'DHRjh':function(_0x49d9f2,_0x2c8f32){return _0x49d9f2&&_0x2c8f32;}},_0x4234c6={};if(_0x827744[_0x1cec1b(0x1fb)](isTestObservabilitySession)){const [_0xc324a1,_0x364aa6,_0x357a03]=testhubUtils[_0x1cec1b(0x1d5)](_0x1d9f78[_0x1cec1b(0x1e4)],_0x591707[_0x1cec1b(0x1f9)]);if(_0x827744[_0x1cec1b(0x17c)](_0xc324a1,_0x364aa6)){const _0x45bd92={};_0x45bd92[_0x1cec1b(0x18e)]=_0xc324a1,_0x45bd92[_0x1cec1b(0x1bb)]=_0x364aa6,_0x45bd92[_0x1cec1b(0x1ac)]=_0x357a03,_0x4234c6[testHubConstants[_0x1cec1b(0x1de)]]=_0x45bd92,process[_0x1cec1b(0x1b0)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x827744['tYxyw'];}else _0x4234c6[testHubConstants['OBSERVABILITY']]={},process[_0x1cec1b(0x1b0)][_0x1cec1b(0x1bf)]=_0x827744[_0x1cec1b(0x1b6)];}else process[_0x1cec1b(0x1b0)][_0x1cec1b(0x1bf)]=_0x827744['IhoBc'];const [_0x26c48b,_0x545b3c]=testhubUtils[_0x1cec1b(0x1bd)](_0x1d9f78[_0x1cec1b(0x1e4)]);if(_0x827744[_0x1cec1b(0x1fa)](_0x26c48b,_0x545b3c)){const _0x5a4501={};_0x5a4501[_0x1cec1b(0x172)]=_0x26c48b,_0x5a4501[_0x1cec1b(0x1bb)]=_0x545b3c,_0x4234c6[testHubConstants[_0x1cec1b(0x1af)]]=_0x5a4501,process['env']['BROWSERSTACK_ACCESSIBILITY']=_0x827744['tYxyw'];}else _0x4234c6[testHubConstants[_0x1cec1b(0x1af)]]={},process[_0x1cec1b(0x1b0)][_0x1cec1b(0x200)]=_0x827744[_0x1cec1b(0x1b6)];return testhubUtils['setTestHubCommonMetaInfo'](_0x1d9f78[_0x1cec1b(0x1e4)]),logger[_0x1cec1b(0x192)](_0x1cec1b(0x202)+process[_0x1cec1b(0x1b0)][_0x1cec1b(0x1d4)]),_0x4234c6;}static async[a90_0x2d0cb4(0x1ae)](_0x58af11){const _0x2b2068=a90_0x2d0cb4,_0x22be34={'BRquV':function(_0x95c7c3,_0x16ed62){return _0x95c7c3===_0x16ed62;},'fZIUe':'false','fBKbj':function(_0x2418ea,_0x4464d6){return _0x2418ea===_0x4464d6;},'nRLgn':_0x2b2068(0x1f3),'aciEM':function(_0x11c669,_0x535631){return _0x11c669===_0x535631;},'jkzwa':_0x2b2068(0x18b),'qPBdJ':_0x2b2068(0x177),'Xinme':_0x2b2068(0x19c),'MBRrg':'finished_metadata','LwKVZ':_0x2b2068(0x180),'IjeyY':function(_0xfe9308){return _0xfe9308();},'mSVzy':function(_0x55044e,_0xe92eec,_0x7e37d8,_0x39a679,_0x386784,_0xe72ac0){return _0x55044e(_0xe92eec,_0x7e37d8,_0x39a679,_0x386784,_0xe72ac0);},'MWstl':_0x2b2068(0x181),'BcoHr':_0x2b2068(0x1f8),'zIdug':_0x2b2068(0x19f)};await this[_0x2b2068(0x1ea)](),await PerformanceTester[_0x2b2068(0x203)](PerformanceEvents[_0x2b2068(0x18d)],async()=>{const _0x19c380=_0x2b2068;if(_0x22be34[_0x19c380(0x1b5)](process[_0x19c380(0x1b0)]['BS_TESTOPS_BUILD_COMPLETED'],_0x22be34[_0x19c380(0x176)])||TestHubHandler[_0x19c380(0x189)]||bsSetupHelper[_0x19c380(0x1c2)](process[_0x19c380(0x1b0)][testHubConstants[_0x19c380(0x1e2)][_0x19c380(0x1ec)]]))return;TestHubHandler[_0x19c380(0x189)]=!![],await RequestQueueHandler[_0x19c380(0x1d6)]()['uploadPending'](),await SessionHandler[_0x19c380(0x1f1)]();if(_0x22be34[_0x19c380(0x1e6)](process['env'][testHubConstants[_0x19c380(0x1e2)][_0x19c380(0x1ec)]],_0x22be34[_0x19c380(0x1c1)])||_0x22be34['aciEM'](process[_0x19c380(0x1b0)][testHubConstants['ENV_VAR'][_0x19c380(0x1d4)]],_0x22be34[_0x19c380(0x1c1)])){logger[_0x19c380(0x1dc)](_0x22be34[_0x19c380(0x187)]);const _0x1a1a18={};return _0x1a1a18[_0x19c380(0x1ff)]=_0x22be34['qPBdJ'],_0x1a1a18['message']=_0x22be34[_0x19c380(0x1b2)],_0x1a1a18;}const _0x428b04={'finished_at':new Date()[_0x19c380(0x1cc)](),'finished_metadata':[]};!!_0x58af11&&_0x428b04[_0x22be34[_0x19c380(0x1ed)]][_0x19c380(0x17b)]({'reason':_0x22be34[_0x19c380(0x19d)],'signal':_0x58af11,'failure_data':''});const _0x2ea522={'headers':_0x22be34[_0x19c380(0x1fc)](getDefaultHeaders)};try{const _0x82c9d7=await _0x22be34[_0x19c380(0x1c4)](nodeRequest,_0x22be34[_0x19c380(0x195)],'api/v1/builds/'+process[_0x19c380(0x1b0)][testHubConstants[_0x19c380(0x1e2)][_0x19c380(0x1d4)]]+_0x19c380(0x1da),_0x428b04,_0x2ea522,![]);if(_0x82c9d7[_0x19c380(0x1e4)]&&_0x82c9d7['data']['error']){const _0x3b996a={};_0x3b996a[_0x19c380(0x1b9)]=_0x82c9d7[_0x19c380(0x1e4)][_0x19c380(0x177)];throw _0x3b996a;}else{logger[_0x19c380(0x1dc)](_0x22be34['BcoHr']);const _0x991b64={};return _0x991b64['status']=_0x22be34[_0x19c380(0x1a5)],_0x991b64[_0x19c380(0x1b9)]='',_0x991b64;}}catch(_0x928960){_0x928960[_0x19c380(0x18a)]?logger[_0x19c380(0x1dc)](_0x19c380(0x183)+_0x928960[_0x19c380(0x18a)][_0x19c380(0x1ff)]+'\x20'+_0x928960[_0x19c380(0x18a)]['statusText']+'\x20'+JSON['stringify'](_0x928960[_0x19c380(0x18a)][_0x19c380(0x1e4)])):logger['debug'](_0x19c380(0x183)+(_0x928960[_0x19c380(0x1b9)]||_0x928960));const _0x37245c={};return _0x37245c[_0x19c380(0x1ff)]=_0x22be34['qPBdJ'],_0x37245c['message']=_0x928960[_0x19c380(0x1b9)]||_0x928960['response']?_0x928960[_0x19c380(0x18a)][_0x19c380(0x1ff)]+':'+_0x928960[_0x19c380(0x18a)][_0x19c380(0x19a)]:_0x928960,_0x37245c;}})();}}function a90_0x3c8e(){const _0x38e4bc=['POST','job_id','MWstl','xWndl','Percy\x20is\x20not\x20supported\x20for\x20','aBUrQ','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','statusText','jHikB','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','LwKVZ','username','success','extractDataFromResponse','mkYDc','ZPXRT','804200eWdwFv','../logger','zIdug','getCiInfo','AXNnk','367703jyBgzH','eCrbs','../../bin/playwright/reporter/test-details.js','4199720PBUPiF','allowScreenshot','true','stop','ACCESSIBILITY','env','getTraceFilePaths','Xinme','BROWSERSTACK_BUILD_RUN_IDENTIFIER','SUJpt','BRquV','IhoBc','XvkfR','TESTHUB_BUILD_API','message','../../bin/playwright/reporter/pwUtils.js','buildHashedId','getUserName','setAccessibilityVariables','getGitMetaData','BROWSERSTACK_TEST_OBSERVABILITY','buildIdentifier','nRLgn','isUndefined','getProductMap','mSVzy','winstonLogger','START','../performance/constants','setupPercy','SgaNV','config','checkAndSetupPercy','toISOString','PERCY_SUPPORTED_FRAMEWORKS','2773233SATbnm','logBuildError','BROWSERSTACK_CENTRAL_SCANNER_JOBID','framework','getFrameworkDetails','includes','BROWSERSTACK_TESTHUB_UUID','setTestObservabilityVariables','getInstance','projectName','token','percy','/stop','BROWSERSTACK_CENTRAL_SCANNER_JWT','debug','9962ituujf','OBSERVABILITY','IGjKf','getHostInfo','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','ENV_VAR','central_scanner','data','buildDescription','fBKbj','basename','../test-observability/utils','accessibilityOptions','processTraceZips','sOUsa','BROWSERSTACK_TESTHUB_JWT','MBRrg','POiux','../performance/performance-tester.js','forEach','waitForBuildStatus','../../bin/utils/constants.js','null','4dbVPHv','1878QpQOtu','allSettled','isBrowserstackInfra','stopBuildUpstream\x20event\x20successful!','auth','DHRjh','vKhcY','IjeyY','password','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','status','BROWSERSTACK_ACCESSIBILITY','13853ZJUhBT','Testhub\x20started\x20with\x20id:\x20','measureWrapper','oxCUL','authToken','accessibility','stringify','../helper','fZIUe','error','assign','resolve','Error\x20while\x20waiting\x20for\x20events:\x20','push','eTLNk','78609QtijPj','pByli','generateBuildUpstreamData','user_killed','PUT','getAccessibilityOptions','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','getConfig','exports','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','jkzwa','LAgCI','buildStopSent','response','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','false','STOP','jwt','add','lcnc','format','info'];a90_0x3c8e=function(){return _0x38e4bc;};return a90_0x3c8e();}module[a90_0x2d0cb4(0x185)]=TestHubHandler;
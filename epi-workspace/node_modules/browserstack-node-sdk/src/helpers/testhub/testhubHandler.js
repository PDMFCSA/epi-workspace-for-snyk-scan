const a90_0x4f633e=a90_0x3f47;function a90_0x43d0(){const _0xddd63e=['buildName','qLzMI','BROWSERSTACK_ACCESSIBILITY','framework','./constants.js','8otlOCH','success','../logger','extractDataFromResponse','JfOLP','isAccessibilityEnabled','10225467ZZRZUU','bYfzK','stop','13683582ooXFeQ','jEzSe','getCentralUser','status','Lnscr','../helper','token','../../bin/utils/constants.js','BROWSERSTACK_CENTRAL_SCANNER_JWT','info','false','message','../test-observability/requestQueueHandler.js','stringify','user_killed','dWoHi','uuosT','BROWSERSTACK_BUILD_RUN_IDENTIFIER','chQwe','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','lcnc','vVXzZ','error','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','\x20framework','132ShjPNQ','getCiInfo','uploadPending','3459065XKnTig','PUT','OBSERVABILITY','DShEy','MbsId','util','ACCESSIBILITY','data','resolve','Testhub\x20started\x20with\x20id:\x20','basename','processTraceZips','dYowq','11861648rpMEHD','settings','TESTHUB_BUILD_API','../test-observability/utils','getUserName','xuhUW','../../bin/playwright/reporter/test-details.js','allSettled','AJmfc','getAccessibilityValueFromYml','../test-observability/sessionHandler.js','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','BROWSERSTACK_TEST_OBSERVABILITY','setTestHubCommonMetaInfo','buildStopSent','response','START','api/v1/builds/','auth','7637340mkJIHh','QjltQ','accessibilityOptions','PERCY_SUPPORTED_FRAMEWORKS','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','BROWSERSTACK_TESTHUB_JWT','./utils.js','push','ENV_VAR','6usYHmw','checkAndSetupPercy','buildDescription','config','username','exports','BROWSERSTACK_TESTHUB_UUID','isBrowserstackInfra','statusText','getProductMapForBuildStartCall','BROWSERSTACK_RERUN','accessibility','KlLay','buildHashedId','allowScreenshot','true','getGitMetaData','260068edqbfJ','finished_metadata','../performance/performance-tester.js','hUuKd','ULvho','setTestObservabilityVariables','debug','getTraceFilePaths','../../bin/playwright/reporter/pwUtils.js','BROWSERSTACK_CENTRAL_SCANNER_JOBID','getConfig','central_scanner','ngBkh','cwd','cnYYH','launchBuild','toISOString','isUndefined','path','31329mrKQrp','add','lDFPj','xHezq','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','All\x20trace\x20zip\x20send\x20events\x20complete','Qbynf','Percy\x20is\x20not\x20supported\x20for\x20','authToken','env','AaDph'];a90_0x43d0=function(){return _0xddd63e;};return a90_0x43d0();}(function(_0x1aef72,_0x23a99b){const _0x551357=a90_0x3f47,_0x13edf9=_0x1aef72();while(!![]){try{const _0x40fd12=-parseInt(_0x551357(0x15b))/0x1*(-parseInt(_0x551357(0x138))/0x2)+parseInt(_0x551357(0x14b))/0x3*(-parseInt(_0x551357(0x17d))/0x4)+parseInt(_0x551357(0x180))/0x5*(-parseInt(_0x551357(0x127))/0x6)+-parseInt(_0x551357(0x161))/0x7+parseInt(_0x551357(0x18d))/0x8+parseInt(_0x551357(0x164))/0x9+-parseInt(_0x551357(0x1a0))/0xa;if(_0x40fd12===_0x23a99b)break;else _0x13edf9['push'](_0x13edf9['shift']());}catch(_0x1dec8e){_0x13edf9['push'](_0x13edf9['shift']());}}}(a90_0x43d0,0xbf05d));const bsSetupHelper=require(a90_0x4f633e(0x169)),path=require(a90_0x4f633e(0x14a)),util=require(a90_0x4f633e(0x185)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x4f633e(0x190)),testhubUtils=require(a90_0x4f633e(0x124)),testHubConstants=require(a90_0x4f633e(0x15a)),constants=require(a90_0x4f633e(0x16b)),RequestQueueHandler=require(a90_0x4f633e(0x170)),logger=require(a90_0x4f633e(0x15d))['winstonLogger'],SessionHandler=require(a90_0x4f633e(0x197)),PerformanceTester=require(a90_0x4f633e(0x13a)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a90_0x4f633e(0x193)),{uploadTraceZip}=require(a90_0x4f633e(0x140)),OngoingEvents=new Set();function a90_0x3f47(_0x4b8abf,_0x20b3ab){const _0x43d04e=a90_0x43d0();return a90_0x3f47=function(_0x3f4733,_0x1b2bf3){_0x3f4733=_0x3f4733-0x120;let _0x37b5a4=_0x43d04e[_0x3f4733];return _0x37b5a4;},a90_0x3f47(_0x4b8abf,_0x20b3ab);}let processedTraceZips=![];const addEvent=_0x44b6c0=>{const _0x33dadd=a90_0x4f633e;OngoingEvents[_0x33dadd(0x14c)](_0x44b6c0);},awaitAllEvents=async()=>{const _0x338912=a90_0x4f633e;return Promise[_0x338912(0x194)](OngoingEvents);};class TestHubHandler{static [a90_0x4f633e(0x19b)]=![];static async[a90_0x4f633e(0x147)](_0x343075,_0x345dfa){const _0x2e179f=a90_0x4f633e,_0x8bad9c={'OqFZj':function(_0x15b7a4,_0x323ed){return _0x15b7a4||_0x323ed;},'dYowq':function(_0x4f1544,_0x509900){return _0x4f1544===_0x509900;},'MbsId':function(_0x1e06e2){return _0x1e06e2();},'fvVxJ':_0x2e179f(0x198),'dWoHi':'false','ngBkh':_0x2e179f(0x14f),'NwDQL':function(_0x1c8a93,_0x44082e,_0x2be6d1,_0x1b3dd3,_0x21d5b4){return _0x1c8a93(_0x44082e,_0x2be6d1,_0x1b3dd3,_0x21d5b4);},'sGFAX':'POST','uckPy':_0x2e179f(0x132),'AaDph':_0x2e179f(0x136)};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x2e179f(0x19d)],async()=>{const _0x12a3e8=_0x2e179f,_0x5a55a4=Object['assign']({},_0x345dfa['config'],{'root_dir_path':'','framework':_0x345dfa[_0x12a3e8(0x159)]}),_0x39ddf0=bsSetupHelper[_0x12a3e8(0x191)](_0x5a55a4),_0x583afd=bsSetupHelper['getAccessKey'](_0x5a55a4),_0x5e033a=_0x8bad9c['OqFZj'](_0x39ddf0,'')+':'+_0x8bad9c['OqFZj'](_0x583afd,''),_0x466569=testhubUtils['getProductMap'](_0x5a55a4);process['env']['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x12a3e8(0x171)](_0x466569);if(_0x8bad9c[_0x12a3e8(0x18c)](_0x5e033a,':'))return _0x8bad9c[_0x12a3e8(0x184)](isTestObservabilitySession)&&(logger[_0x12a3e8(0x13e)](_0x8bad9c['fvVxJ']),process[_0x12a3e8(0x154)]['BS_TESTOPS_BUILD_COMPLETED']=_0x8bad9c[_0x12a3e8(0x173)]),testhubUtils[_0x12a3e8(0x160)](_0x5a55a4)&&logger['debug'](_0x8bad9c[_0x12a3e8(0x144)]),[null,null];try{const _0x149c9f=await this['generateBuildUpstreamData'](_0x5a55a4,_0x343075),_0x1f41de=this[_0x12a3e8(0x142)](_0x39ddf0,_0x583afd),_0x2e42f1=await _0x8bad9c['NwDQL'](nodeRequest,_0x8bad9c['sGFAX'],testHubConstants[_0x12a3e8(0x18f)],_0x149c9f,_0x1f41de),_0x57883e=this[_0x12a3e8(0x15e)](_0x5a55a4,_0x2e42f1,_0x1f41de);await this[_0x12a3e8(0x128)](_0x345dfa,_0x343075);if(_0x8bad9c[_0x12a3e8(0x18c)](testhubUtils[_0x12a3e8(0x196)](_0x345dfa[_0x12a3e8(0x12a)]),null)){const _0x37d2f6=_0x57883e[_0x8bad9c['uckPy']];_0x37d2f6&&_0x37d2f6[_0x12a3e8(0x153)]&&_0x37d2f6[_0x12a3e8(0x134)]&&(_0x345dfa[_0x12a3e8(0x12a)]['accessibility']=!![],process[_0x12a3e8(0x154)]['BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM']=_0x8bad9c[_0x12a3e8(0x155)]);}return _0x57883e;}catch(_0xebf265){if(_0x8bad9c[_0x12a3e8(0x18c)](_0xebf265[_0x12a3e8(0x15c)],![])){testhubUtils['logBuildError'](_0xebf265);return;}}})();}static async['processTraceZips'](){const _0x49641e=a90_0x4f633e,_0x5a445e={'ecRPz':function(_0x41550c,_0x411531,_0x4f7fd8){return _0x41550c(_0x411531,_0x4f7fd8);},'HsHkj':function(_0x2a60fc,_0x363401){return _0x2a60fc(_0x363401);},'KlLay':function(_0x2c04ed){return _0x2c04ed();},'ULfrW':_0x49641e(0x150)};if(processedTraceZips)return;const _0x3cea8c=TestDetails[_0x49641e(0x13f)]();_0x3cea8c['forEach'](({testUId:_0x3e1955,filePath:_0x31544b})=>{var _0x56733d=_0x5a445e['ecRPz'](uploadTraceZip,_0x31544b,_0x3e1955);_0x5a445e['HsHkj'](addEvent,_0x56733d);});try{await _0x5a445e[_0x49641e(0x133)](awaitAllEvents),logger['debug'](_0x5a445e['ULfrW']),processedTraceZips=!![];}catch(_0x4062cd){logger['error']('Error\x20while\x20waiting\x20for\x20events:\x20'+util['format'](_0x4062cd));}}static async['checkAndSetupPercy'](_0x3c88b2,_0x5c382d){const _0x33705f=a90_0x4f633e;if(constants[_0x33705f(0x121)]['includes'](_0x5c382d)){await _0x3c88b2['setupPercy']();return;}_0x3c88b2[_0x33705f(0x12a)]['percy']&&logger[_0x33705f(0x13e)](_0x33705f(0x152)+_0x5c382d+_0x33705f(0x17c));}static['getAccessibilityOptions'](_0x7f0893){const _0x5ad1f1=a90_0x4f633e,_0x172808={};_0x172808[_0x5ad1f1(0x18e)]=_0x7f0893[_0x5ad1f1(0x120)];const _0x4ae7b0=_0x172808;return _0x4ae7b0;}static['getConfig'](_0x17d318,_0x56def3){const _0x25676a=a90_0x4f633e,_0x3fa5b1={'ULvho':function(_0x50c229,_0x1e2489){return _0x50c229(_0x1e2489);}},_0x34e9a9={};return _0x34e9a9[_0x25676a(0x12b)]=_0x17d318,_0x34e9a9['password']=_0x56def3,{'auth':_0x34e9a9,'headers':_0x3fa5b1[_0x25676a(0x13c)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x202577,_0xbdb6b9){const _0x1dbbf9=a90_0x4f633e,_0x139a48={'Lnscr':function(_0x24f05e,_0x1ada23){return _0x24f05e(_0x1ada23);}},_0x3837f9={'project_name':_0x202577['projectName']||'','name':_0x202577[_0x1dbbf9(0x156)]||path[_0x1dbbf9(0x18a)](path[_0x1dbbf9(0x188)](process[_0x1dbbf9(0x145)]())),'build_identifier':_0x202577['buildIdentifier'],'description':_0x202577[_0x1dbbf9(0x129)]||'','started_at':new Date()[_0x1dbbf9(0x148)](),'tags':_0x139a48[_0x1dbbf9(0x168)](getCustomTags,_0x202577),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x1dbbf9(0x17e)](),'build_run_identifier':process[_0x1dbbf9(0x154)][_0x1dbbf9(0x175)],'failed_tests_rerun':process['env'][_0x1dbbf9(0x131)]||![],'version_control':await bsSetupHelper[_0x1dbbf9(0x137)](),'accessibility':this['getAccessibilityOptions'](_0x202577),'framework_details':testhubUtils['getFrameworkDetails'](_0x202577,_0xbdb6b9),'product_map':testhubUtils[_0x1dbbf9(0x130)](_0x202577),'browserstackAutomation':bsSetupHelper[_0x1dbbf9(0x12e)](),'grouping_identifier':process[_0x1dbbf9(0x154)]['BROWSERSTACK_BUILD_GROUPING_IDENTIFIER']};if(bsSetupHelper['getCentralUser']()[_0x1dbbf9(0x143)]||bsSetupHelper[_0x1dbbf9(0x166)]()[_0x1dbbf9(0x178)]){const _0x476d4c={};_0x476d4c['job_id']=process[_0x1dbbf9(0x154)][_0x1dbbf9(0x141)],_0x476d4c[_0x1dbbf9(0x16a)]=process[_0x1dbbf9(0x154)][_0x1dbbf9(0x16c)],_0x3837f9[_0x1dbbf9(0x143)]=_0x476d4c;}return _0x3837f9;}static[a90_0x4f633e(0x15e)](_0x599e84,_0x478b38,_0x44597d){const _0x387231=a90_0x4f633e,_0x1d42b6={'iyCUX':function(_0x161fdd){return _0x161fdd();},'cnYYH':function(_0x1dba3b,_0x59e8b8){return _0x1dba3b&&_0x59e8b8;},'chQwe':_0x387231(0x136),'qLzMI':'false'},_0x247490={};if(_0x1d42b6['iyCUX'](isTestObservabilitySession)){const [_0x3ba9a4,_0x2e4ff4,_0x4c40a2]=testhubUtils[_0x387231(0x13d)](_0x478b38['data'],_0x44597d[_0x387231(0x19f)]);if(_0x1d42b6['cnYYH'](_0x3ba9a4,_0x2e4ff4)){const _0x2d1eed={};_0x2d1eed['jwt']=_0x3ba9a4,_0x2d1eed[_0x387231(0x134)]=_0x2e4ff4,_0x2d1eed[_0x387231(0x135)]=_0x4c40a2,_0x247490[testHubConstants[_0x387231(0x182)]]=_0x2d1eed,process['env'][_0x387231(0x199)]=_0x1d42b6[_0x387231(0x176)];}else _0x247490[testHubConstants[_0x387231(0x182)]]={},process['env'][_0x387231(0x199)]=_0x1d42b6[_0x387231(0x157)];}else process[_0x387231(0x154)][_0x387231(0x199)]=_0x1d42b6[_0x387231(0x157)];const [_0x20e60b,_0x1e39d4]=testhubUtils['setAccessibilityVariables'](_0x478b38['data']);if(_0x1d42b6[_0x387231(0x146)](_0x20e60b,_0x1e39d4)){const _0x48a32b={};_0x48a32b[_0x387231(0x153)]=_0x20e60b,_0x48a32b[_0x387231(0x134)]=_0x1e39d4,_0x247490[testHubConstants[_0x387231(0x186)]]=_0x48a32b,process[_0x387231(0x154)][_0x387231(0x158)]=_0x1d42b6[_0x387231(0x176)];}else _0x247490[testHubConstants[_0x387231(0x186)]]={},process[_0x387231(0x154)]['BROWSERSTACK_ACCESSIBILITY']=_0x1d42b6[_0x387231(0x157)];return testhubUtils[_0x387231(0x19a)](_0x478b38[_0x387231(0x187)]),logger[_0x387231(0x16d)](_0x387231(0x189)+process[_0x387231(0x154)][_0x387231(0x12d)]),_0x247490;}static async[a90_0x4f633e(0x163)](_0x2f9eeb){const _0x44686a=a90_0x4f633e,_0x4615c4={'Qbynf':function(_0xa34d29,_0x438f0e){return _0xa34d29===_0x438f0e;},'AJmfc':_0x44686a(0x16e),'hUuKd':function(_0x74e2d6,_0x278628){return _0x74e2d6===_0x278628;},'jEzSe':'null','ZdHYI':function(_0x57b69b,_0x3e2abb){return _0x57b69b===_0x3e2abb;},'xuhUW':_0x44686a(0x122),'JfOLP':_0x44686a(0x17a),'vVXzZ':_0x44686a(0x17b),'DShEy':_0x44686a(0x139),'lDFPj':_0x44686a(0x172),'bYfzK':function(_0x5403b3){return _0x5403b3();},'uuosT':function(_0x99e531,_0x274a72,_0x5d3f2e,_0x1e2887,_0x35d8c4,_0x4e6d51){return _0x99e531(_0x274a72,_0x5d3f2e,_0x1e2887,_0x35d8c4,_0x4e6d51);},'HzwEQ':_0x44686a(0x181),'QjltQ':'stopBuildUpstream\x20event\x20successful!','xHezq':_0x44686a(0x15c)};await this[_0x44686a(0x18b)](),await PerformanceTester['measureWrapper'](PerformanceEvents['STOP'],async()=>{const _0x52ee2a=_0x44686a;if(_0x4615c4[_0x52ee2a(0x151)](process[_0x52ee2a(0x154)]['BS_TESTOPS_BUILD_COMPLETED'],_0x4615c4[_0x52ee2a(0x195)])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x52ee2a(0x149)](process[_0x52ee2a(0x154)][testHubConstants['ENV_VAR'][_0x52ee2a(0x123)]]))return;TestHubHandler[_0x52ee2a(0x19b)]=!![],await RequestQueueHandler['getInstance']()[_0x52ee2a(0x17f)](),await SessionHandler['waitForBuildStatus']();if(_0x4615c4[_0x52ee2a(0x13b)](process[_0x52ee2a(0x154)][testHubConstants[_0x52ee2a(0x126)][_0x52ee2a(0x123)]],_0x4615c4[_0x52ee2a(0x165)])||_0x4615c4['ZdHYI'](process[_0x52ee2a(0x154)][testHubConstants['ENV_VAR'][_0x52ee2a(0x12d)]],_0x4615c4[_0x52ee2a(0x165)])){logger[_0x52ee2a(0x13e)](_0x4615c4[_0x52ee2a(0x192)]);const _0xe94b53={};return _0xe94b53['status']=_0x4615c4[_0x52ee2a(0x15f)],_0xe94b53['message']=_0x4615c4[_0x52ee2a(0x179)],_0xe94b53;}const _0x25e0d7={'finished_at':new Date()[_0x52ee2a(0x148)](),'finished_metadata':[]};!!_0x2f9eeb&&_0x25e0d7[_0x4615c4[_0x52ee2a(0x183)]][_0x52ee2a(0x125)]({'reason':_0x4615c4[_0x52ee2a(0x14d)],'signal':_0x2f9eeb,'failure_data':''});const _0x5986ac={'headers':_0x4615c4[_0x52ee2a(0x162)](getDefaultHeaders)};try{const _0x3cab93=await _0x4615c4[_0x52ee2a(0x174)](nodeRequest,_0x4615c4['HzwEQ'],_0x52ee2a(0x19e)+process['env'][testHubConstants[_0x52ee2a(0x126)]['BROWSERSTACK_TESTHUB_UUID']]+'/stop',_0x25e0d7,_0x5986ac,![]);if(_0x3cab93[_0x52ee2a(0x187)]&&_0x3cab93[_0x52ee2a(0x187)][_0x52ee2a(0x17a)]){const _0x2565b9={};_0x2565b9[_0x52ee2a(0x16f)]=_0x3cab93['data']['error'];throw _0x2565b9;}else{logger[_0x52ee2a(0x13e)](_0x4615c4[_0x52ee2a(0x1a1)]);const _0x1bac79={};return _0x1bac79[_0x52ee2a(0x167)]=_0x4615c4[_0x52ee2a(0x14e)],_0x1bac79['message']='',_0x1bac79;}}catch(_0x3605f2){_0x3605f2[_0x52ee2a(0x19c)]?logger[_0x52ee2a(0x13e)](_0x52ee2a(0x177)+_0x3605f2[_0x52ee2a(0x19c)][_0x52ee2a(0x167)]+'\x20'+_0x3605f2['response'][_0x52ee2a(0x12f)]+'\x20'+JSON['stringify'](_0x3605f2['response'][_0x52ee2a(0x187)])):logger['debug'](_0x52ee2a(0x177)+(_0x3605f2['message']||_0x3605f2));const _0x162943={};return _0x162943['status']=_0x4615c4['JfOLP'],_0x162943[_0x52ee2a(0x16f)]=_0x3605f2[_0x52ee2a(0x16f)]||_0x3605f2[_0x52ee2a(0x19c)]?_0x3605f2[_0x52ee2a(0x19c)][_0x52ee2a(0x167)]+':'+_0x3605f2['response'][_0x52ee2a(0x12f)]:_0x3605f2,_0x162943;}})();}}module[a90_0x4f633e(0x12c)]=TestHubHandler;
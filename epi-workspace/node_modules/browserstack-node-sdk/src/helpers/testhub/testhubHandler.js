const a90_0x44f9dc=a90_0x1cf6;(function(_0x97c4ca,_0x119174){const _0x29cf88=a90_0x1cf6,_0x1f5176=_0x97c4ca();while(!![]){try{const _0x194d82=parseInt(_0x29cf88(0x135))/0x1*(parseInt(_0x29cf88(0x177))/0x2)+-parseInt(_0x29cf88(0x182))/0x3*(-parseInt(_0x29cf88(0x173))/0x4)+parseInt(_0x29cf88(0x163))/0x5+-parseInt(_0x29cf88(0x143))/0x6+parseInt(_0x29cf88(0x157))/0x7*(-parseInt(_0x29cf88(0x126))/0x8)+-parseInt(_0x29cf88(0x176))/0x9+parseInt(_0x29cf88(0x16b))/0xa;if(_0x194d82===_0x119174)break;else _0x1f5176['push'](_0x1f5176['shift']());}catch(_0xcecdb1){_0x1f5176['push'](_0x1f5176['shift']());}}}(a90_0x288d,0xdbc0e));function a90_0x1cf6(_0x4a8c2e,_0xcf1844){const _0x288d88=a90_0x288d();return a90_0x1cf6=function(_0x1cf666,_0x21f6c6){_0x1cf666=_0x1cf666-0xfd;let _0x1d1953=_0x288d88[_0x1cf666];return _0x1d1953;},a90_0x1cf6(_0x4a8c2e,_0xcf1844);}const bsSetupHelper=require(a90_0x44f9dc(0x154)),path=require(a90_0x44f9dc(0x153)),util=require(a90_0x44f9dc(0x14c)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x44f9dc(0x10a)),testhubUtils=require(a90_0x44f9dc(0x136)),testHubConstants=require('./constants.js'),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a90_0x44f9dc(0x102)),logger=require('../logger')['winstonLogger'],SessionHandler=require(a90_0x44f9dc(0x10d)),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x44f9dc(0x16d)),TestDetails=require(a90_0x44f9dc(0x166)),{uploadTraceZip}=require(a90_0x44f9dc(0x167)),OngoingEvents=new Set();function a90_0x288d(){const _0x1f856c=['getCentralUser','error','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','sGnwJ','job_id','success','Percy\x20is\x20not\x20supported\x20for\x20','BROWSERSTACK_TEST_OBSERVABILITY','setupPercy','isUndefined','BROWSERSTACK_BUILD_RUN_IDENTIFIER','../test-observability/requestQueueHandler.js','allSettled','sMOxM','jhzwE','BROWSERSTACK_TESTHUB_UUID','buildDescription','FlevZ','push','../test-observability/utils','setAccessibilityVariables','lcnc','../test-observability/sessionHandler.js','status','user_killed','BROWSERSTACK_RERUN','getGitMetaData','wgrJq','finished_metadata','stopBuildUpstream\x20event\x20successful!','config','response','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','data','BROWSERSTACK_CENTRAL_SCANNER_JOBID','All\x20trace\x20zip\x20send\x20events\x20complete','accessibilityOptions','wgqyn','framework','ugInq','getHostInfo','true','jLKqW','zPBzw','isBrowserstackInfra','generateBuildUpstreamData','processTraceZips','392wFDxbH','buildHashedId','waitForBuildStatus','setTestHubCommonMetaInfo','getInstance','rkWxu','xwUhJ','measureWrapper','stringify','hzYpW','basename','forEach','getConfig','format','csENW','558709AszLGs','./utils.js','YJBid','projectName','XuEYG','yPmAx','BS_TESTOPS_BUILD_COMPLETED','getProductMap','yskxx','uploadPending','launchBuild','BROWSERSTACK_CENTRAL_SCANNER_JWT','buildStopSent','exports','2168556XlpQak','iwkFf','BROWSERSTACK_TESTHUB_JWT','checkAndSetupPercy','debug','ACCESSIBILITY','authToken','LkNWo','central_scanner','util','BROWSERSTACK_PRODUCT_MAP','Error\x20while\x20waiting\x20for\x20events:\x20','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','iJdGB','password','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','path','../helper','toISOString','add','169911GKKvyA','PERCY_SUPPORTED_FRAMEWORKS','oRDDP','setTestObservabilityVariables','false','Testhub\x20started\x20with\x20id:\x20','KvAHS','buildName','allowScreenshot','getFrameworkDetails','Ftzgb','START','3566400PydMFm','RKvJm','isAccessibilityEnabled','../../bin/playwright/reporter/test-details.js','../../bin/playwright/reporter/pwUtils.js','env','bBWAe','extractDataFromResponse','19211820eRTSAC','resolve','../performance/constants','getTraceFilePaths','accessibility','tzLly','ENV_VAR','message','80bjMCss','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','info','11569842dxsrJj','2GwWsPN','UgdOx','\x20framework','STOP','getProductMapForBuildStartCall','KkwwZ','statusText','qgFkJ','LfUgh','PUT','stop','81492RBNsOt','auth','OBSERVABILITY','settings','VspTe','OYUrN','BROWSERSTACK_ACCESSIBILITY'];a90_0x288d=function(){return _0x1f856c;};return a90_0x288d();}let processedTraceZips=![];const addEvent=_0x297399=>{const _0x1248d=a90_0x44f9dc;OngoingEvents[_0x1248d(0x156)](_0x297399);},awaitAllEvents=async()=>{const _0xbf1440=a90_0x44f9dc;return Promise[_0xbf1440(0x103)](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async[a90_0x44f9dc(0x13f)](_0x1f86c6,_0x40938f){const _0x361f76=a90_0x44f9dc,_0x141b6e={'XuEYG':function(_0x24cca2,_0x181a31){return _0x24cca2||_0x181a31;},'wgrJq':function(_0x6a0e96,_0x33beb2){return _0x6a0e96||_0x33beb2;},'iJdGB':function(_0x2a6c1c,_0x31c1b0){return _0x2a6c1c===_0x31c1b0;},'bBWAe':function(_0x19282f){return _0x19282f();},'fcfZR':_0x361f76(0x14f),'tzLly':'false','xwUhJ':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','oRDDP':function(_0x1f777a,_0x244fc3,_0x38ce13,_0x3ac217,_0x164f73){return _0x1f777a(_0x244fc3,_0x38ce13,_0x3ac217,_0x164f73);},'wgqyn':'POST','YJBid':function(_0x2830b1,_0x46d231){return _0x2830b1===_0x46d231;},'iwkFf':_0x361f76(0x16f),'LfUgh':_0x361f76(0x120)};await PerformanceTester[_0x361f76(0x12d)](PerformanceEvents[_0x361f76(0x162)],async()=>{const _0x4a6911=_0x361f76,_0x38e765=Object['assign']({},_0x40938f['config'],{'root_dir_path':'','framework':_0x40938f[_0x4a6911(0x11d)]}),_0x62abc7=bsSetupHelper['getUserName'](_0x38e765),_0x541243=bsSetupHelper['getAccessKey'](_0x38e765),_0x5c1782=_0x141b6e[_0x4a6911(0x139)](_0x62abc7,'')+':'+_0x141b6e[_0x4a6911(0x112)](_0x541243,''),_0x4e1c80=testhubUtils[_0x4a6911(0x13c)](_0x38e765);process[_0x4a6911(0x168)][_0x4a6911(0x14d)]=JSON[_0x4a6911(0x12e)](_0x4e1c80);if(_0x141b6e['iJdGB'](_0x5c1782,':'))return _0x141b6e[_0x4a6911(0x169)](isTestObservabilitySession)&&(logger[_0x4a6911(0x147)](_0x141b6e['fcfZR']),process[_0x4a6911(0x168)]['BS_TESTOPS_BUILD_COMPLETED']=_0x141b6e[_0x4a6911(0x170)]),testhubUtils[_0x4a6911(0x165)](_0x38e765)&&logger['debug'](_0x141b6e[_0x4a6911(0x12c)]),[null,null];try{const _0x2b816e=await this[_0x4a6911(0x124)](_0x38e765,_0x1f86c6),_0x371d9d=this[_0x4a6911(0x132)](_0x62abc7,_0x541243),_0xf7cef8=await _0x141b6e[_0x4a6911(0x159)](nodeRequest,_0x141b6e[_0x4a6911(0x11c)],testHubConstants['TESTHUB_BUILD_API'],_0x2b816e,_0x371d9d),_0x3ca9db=this[_0x4a6911(0x16a)](_0x38e765,_0xf7cef8,_0x371d9d);await this['checkAndSetupPercy'](_0x40938f,_0x1f86c6);if(_0x141b6e[_0x4a6911(0x137)](testhubUtils['getAccessibilityValueFromYml'](_0x40938f[_0x4a6911(0x115)]),null)){const _0x4b8f3d=_0x3ca9db[_0x141b6e[_0x4a6911(0x144)]];_0x4b8f3d&&_0x4b8f3d[_0x4a6911(0x149)]&&_0x4b8f3d[_0x4a6911(0x127)]&&(_0x40938f[_0x4a6911(0x115)][_0x4a6911(0x16f)]=!![],process[_0x4a6911(0x168)]['BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM']=_0x141b6e[_0x4a6911(0x17f)]);}return _0x3ca9db;}catch(_0x7eb330){if(_0x141b6e[_0x4a6911(0x150)](_0x7eb330['success'],![])){testhubUtils['logBuildError'](_0x7eb330);return;}}})();}static async[a90_0x44f9dc(0x125)](){const _0x1db9f6=a90_0x44f9dc,_0x5ad537={'csENW':function(_0x475c09,_0x3d0025,_0x3a908a){return _0x475c09(_0x3d0025,_0x3a908a);},'SdxLV':function(_0x5a9111,_0x37ea64){return _0x5a9111(_0x37ea64);},'LkNWo':function(_0x277295){return _0x277295();},'jhzwE':_0x1db9f6(0x11a)};if(processedTraceZips)return;const _0x43bc83=TestDetails[_0x1db9f6(0x16e)]();_0x43bc83[_0x1db9f6(0x131)](({testUId:_0x3e1425,filePath:_0xe36dc6})=>{const _0x23ec66=_0x1db9f6;var _0x34d6f1=_0x5ad537[_0x23ec66(0x134)](uploadTraceZip,_0xe36dc6,_0x3e1425);_0x5ad537['SdxLV'](addEvent,_0x34d6f1);});try{await _0x5ad537[_0x1db9f6(0x14a)](awaitAllEvents),logger['debug'](_0x5ad537[_0x1db9f6(0x105)]),processedTraceZips=!![];}catch(_0x39f115){logger[_0x1db9f6(0x18a)](_0x1db9f6(0x14e)+util[_0x1db9f6(0x133)](_0x39f115));}}static async[a90_0x44f9dc(0x146)](_0x4853db,_0x59a4c5){const _0x2abc14=a90_0x44f9dc;if(constants[_0x2abc14(0x158)]['includes'](_0x59a4c5)){await _0x4853db[_0x2abc14(0xff)]();return;}_0x4853db[_0x2abc14(0x115)]['percy']&&logger[_0x2abc14(0x147)](_0x2abc14(0xfd)+_0x59a4c5+_0x2abc14(0x179));}static['getAccessibilityOptions'](_0xe3950d){const _0x5edb00=a90_0x44f9dc,_0x156632={};_0x156632[_0x5edb00(0x185)]=_0xe3950d[_0x5edb00(0x11b)];const _0x2a4aa6=_0x156632;return _0x2a4aa6;}static[a90_0x44f9dc(0x132)](_0x20db3f,_0x2833b2){const _0x29741a=a90_0x44f9dc,_0x357546={'FlevZ':function(_0x8a112b,_0x5cd733){return _0x8a112b(_0x5cd733);}},_0x15370c={};return _0x15370c['username']=_0x20db3f,_0x15370c[_0x29741a(0x151)]=_0x2833b2,{'auth':_0x15370c,'headers':_0x357546[_0x29741a(0x108)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x136685,_0x44d4db){const _0x391077=a90_0x44f9dc,_0x379568={'sLgYo':function(_0x819761,_0x34b2e5){return _0x819761(_0x34b2e5);}},_0xf95a85={'project_name':_0x136685[_0x391077(0x138)]||'','name':_0x136685[_0x391077(0x15e)]||path[_0x391077(0x130)](path[_0x391077(0x16c)](process['cwd']())),'build_identifier':_0x136685['buildIdentifier'],'description':_0x136685[_0x391077(0x107)]||'','started_at':new Date()[_0x391077(0x155)](),'tags':_0x379568['sLgYo'](getCustomTags,_0x136685),'host_info':bsSetupHelper[_0x391077(0x11f)](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process[_0x391077(0x168)][_0x391077(0x101)],'failed_tests_rerun':process[_0x391077(0x168)][_0x391077(0x110)]||![],'version_control':await bsSetupHelper[_0x391077(0x111)](),'accessibility':this['getAccessibilityOptions'](_0x136685),'framework_details':testhubUtils[_0x391077(0x160)](_0x136685,_0x44d4db),'product_map':testhubUtils[_0x391077(0x17b)](_0x136685),'browserstackAutomation':bsSetupHelper[_0x391077(0x123)](),'grouping_identifier':process[_0x391077(0x168)][_0x391077(0x117)]};if(bsSetupHelper[_0x391077(0x189)]()[_0x391077(0x14b)]||bsSetupHelper[_0x391077(0x189)]()[_0x391077(0x10c)]){const _0x1c2a3c={};_0x1c2a3c[_0x391077(0x18d)]=process[_0x391077(0x168)][_0x391077(0x119)],_0x1c2a3c['token']=process[_0x391077(0x168)][_0x391077(0x140)],_0xf95a85[_0x391077(0x14b)]=_0x1c2a3c;}return _0xf95a85;}static[a90_0x44f9dc(0x16a)](_0x2a3530,_0x20e98c,_0x413708){const _0x3e32eb=a90_0x44f9dc,_0x35baf5={'Ftzgb':function(_0x346bf0){return _0x346bf0();},'hzYpW':function(_0x3599f4,_0x48459a){return _0x3599f4&&_0x48459a;},'sGnwJ':_0x3e32eb(0x120),'zPBzw':_0x3e32eb(0x15b),'KvAHS':function(_0x237ee3,_0x60f3bc){return _0x237ee3&&_0x60f3bc;}},_0x3c1a4a={};if(_0x35baf5[_0x3e32eb(0x161)](isTestObservabilitySession)){const [_0x5246da,_0x4979ad,_0x1392c8]=testhubUtils[_0x3e32eb(0x15a)](_0x20e98c[_0x3e32eb(0x118)],_0x413708[_0x3e32eb(0x183)]);if(_0x35baf5[_0x3e32eb(0x12f)](_0x5246da,_0x4979ad)){const _0x5e172f={};_0x5e172f['jwt']=_0x5246da,_0x5e172f[_0x3e32eb(0x127)]=_0x4979ad,_0x5e172f[_0x3e32eb(0x15f)]=_0x1392c8,_0x3c1a4a[testHubConstants['OBSERVABILITY']]=_0x5e172f,process['env'][_0x3e32eb(0xfe)]=_0x35baf5[_0x3e32eb(0x18c)];}else _0x3c1a4a[testHubConstants[_0x3e32eb(0x184)]]={},process[_0x3e32eb(0x168)][_0x3e32eb(0xfe)]=_0x35baf5[_0x3e32eb(0x122)];}else process[_0x3e32eb(0x168)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x35baf5['zPBzw'];const [_0x2352e8,_0x527fe1]=testhubUtils[_0x3e32eb(0x10b)](_0x20e98c[_0x3e32eb(0x118)]);if(_0x35baf5[_0x3e32eb(0x15d)](_0x2352e8,_0x527fe1)){const _0x4f0c82={};_0x4f0c82[_0x3e32eb(0x149)]=_0x2352e8,_0x4f0c82[_0x3e32eb(0x127)]=_0x527fe1,_0x3c1a4a[testHubConstants[_0x3e32eb(0x148)]]=_0x4f0c82,process['env'][_0x3e32eb(0x188)]=_0x35baf5[_0x3e32eb(0x18c)];}else _0x3c1a4a[testHubConstants[_0x3e32eb(0x148)]]={},process[_0x3e32eb(0x168)][_0x3e32eb(0x188)]=_0x35baf5[_0x3e32eb(0x122)];return testhubUtils[_0x3e32eb(0x129)](_0x20e98c[_0x3e32eb(0x118)]),logger[_0x3e32eb(0x175)](_0x3e32eb(0x15c)+process[_0x3e32eb(0x168)][_0x3e32eb(0x106)]),_0x3c1a4a;}static async[a90_0x44f9dc(0x181)](_0x3c0887){const _0x3868d3=a90_0x44f9dc,_0x3ac07f={'rkWxu':function(_0x5ae18e,_0x462221){return _0x5ae18e===_0x462221;},'ZFhem':_0x3868d3(0x15b),'sMOxM':'null','KkwwZ':function(_0xacd694,_0x5852e5){return _0xacd694===_0x5852e5;},'ugInq':_0x3868d3(0x174),'VspTe':_0x3868d3(0x18a),'OYUrN':_0x3868d3(0x152),'aYWCK':_0x3868d3(0x113),'yskxx':_0x3868d3(0x10f),'RKvJm':function(_0x2c7cf8){return _0x2c7cf8();},'qgFkJ':function(_0x599e43,_0x2905f5,_0x4780c8,_0x21fd4b,_0x501824,_0x192725){return _0x599e43(_0x2905f5,_0x4780c8,_0x21fd4b,_0x501824,_0x192725);},'yPmAx':_0x3868d3(0x180),'UgdOx':_0x3868d3(0x114),'jLKqW':_0x3868d3(0x18e)};await this[_0x3868d3(0x125)](),await PerformanceTester[_0x3868d3(0x12d)](PerformanceEvents[_0x3868d3(0x17a)],async()=>{const _0x14626b=_0x3868d3;if(_0x3ac07f['rkWxu'](process['env'][_0x14626b(0x13b)],_0x3ac07f['ZFhem'])||TestHubHandler[_0x14626b(0x141)]||bsSetupHelper[_0x14626b(0x100)](process[_0x14626b(0x168)][testHubConstants['ENV_VAR'][_0x14626b(0x145)]]))return;TestHubHandler['buildStopSent']=!![],await RequestQueueHandler[_0x14626b(0x12a)]()[_0x14626b(0x13e)](),await SessionHandler[_0x14626b(0x128)]();if(_0x3ac07f[_0x14626b(0x12b)](process[_0x14626b(0x168)][testHubConstants[_0x14626b(0x171)][_0x14626b(0x145)]],_0x3ac07f['sMOxM'])||_0x3ac07f[_0x14626b(0x17c)](process[_0x14626b(0x168)][testHubConstants[_0x14626b(0x171)][_0x14626b(0x106)]],_0x3ac07f[_0x14626b(0x104)])){logger[_0x14626b(0x147)](_0x3ac07f[_0x14626b(0x11e)]);const _0x1e6894={};return _0x1e6894[_0x14626b(0x10e)]=_0x3ac07f[_0x14626b(0x186)],_0x1e6894[_0x14626b(0x172)]=_0x3ac07f[_0x14626b(0x187)],_0x1e6894;}const _0x3d1440={'finished_at':new Date()[_0x14626b(0x155)](),'finished_metadata':[]};!!_0x3c0887&&_0x3d1440[_0x3ac07f['aYWCK']][_0x14626b(0x109)]({'reason':_0x3ac07f[_0x14626b(0x13d)],'signal':_0x3c0887,'failure_data':''});const _0x21c2be={'headers':_0x3ac07f[_0x14626b(0x164)](getDefaultHeaders)};try{const _0x167a6b=await _0x3ac07f[_0x14626b(0x17e)](nodeRequest,_0x3ac07f[_0x14626b(0x13a)],'api/v1/builds/'+process[_0x14626b(0x168)][testHubConstants[_0x14626b(0x171)]['BROWSERSTACK_TESTHUB_UUID']]+'/stop',_0x3d1440,_0x21c2be,![]);if(_0x167a6b['data']&&_0x167a6b['data']['error']){const _0x41856e={};_0x41856e[_0x14626b(0x172)]=_0x167a6b[_0x14626b(0x118)][_0x14626b(0x18a)];throw _0x41856e;}else{logger[_0x14626b(0x147)](_0x3ac07f[_0x14626b(0x178)]);const _0xfb1ddd={};return _0xfb1ddd[_0x14626b(0x10e)]=_0x3ac07f[_0x14626b(0x121)],_0xfb1ddd[_0x14626b(0x172)]='',_0xfb1ddd;}}catch(_0x188935){_0x188935[_0x14626b(0x116)]?logger['debug'](_0x14626b(0x18b)+_0x188935[_0x14626b(0x116)][_0x14626b(0x10e)]+'\x20'+_0x188935[_0x14626b(0x116)][_0x14626b(0x17d)]+'\x20'+JSON['stringify'](_0x188935[_0x14626b(0x116)]['data'])):logger[_0x14626b(0x147)](_0x14626b(0x18b)+(_0x188935[_0x14626b(0x172)]||_0x188935));const _0x3b2176={};return _0x3b2176[_0x14626b(0x10e)]=_0x3ac07f[_0x14626b(0x186)],_0x3b2176['message']=_0x188935[_0x14626b(0x172)]||_0x188935[_0x14626b(0x116)]?_0x188935[_0x14626b(0x116)][_0x14626b(0x10e)]+':'+_0x188935[_0x14626b(0x116)][_0x14626b(0x17d)]:_0x188935,_0x3b2176;}})();}}module[a90_0x44f9dc(0x142)]=TestHubHandler;
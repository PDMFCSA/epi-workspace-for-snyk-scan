const a90_0xaae652=a90_0x5783;function a90_0x5783(_0x2cdee0,_0x10760a){const _0x5cffd3=a90_0x5cff();return a90_0x5783=function(_0x5783c8,_0x21e04e){_0x5783c8=_0x5783c8-0x7a;let _0x415516=_0x5cffd3[_0x5783c8];return _0x415516;},a90_0x5783(_0x2cdee0,_0x10760a);}(function(_0x5aa1fc,_0xbb2c13){const _0x208fb6=a90_0x5783,_0x32073f=_0x5aa1fc();while(!![]){try{const _0x4bf4ac=parseInt(_0x208fb6(0xb2))/0x1+parseInt(_0x208fb6(0xe8))/0x2+-parseInt(_0x208fb6(0x98))/0x3*(-parseInt(_0x208fb6(0xdb))/0x4)+-parseInt(_0x208fb6(0x7c))/0x5*(-parseInt(_0x208fb6(0xa7))/0x6)+-parseInt(_0x208fb6(0xd6))/0x7+-parseInt(_0x208fb6(0x94))/0x8*(-parseInt(_0x208fb6(0xac))/0x9)+-parseInt(_0x208fb6(0x8c))/0xa;if(_0x4bf4ac===_0xbb2c13)break;else _0x32073f['push'](_0x32073f['shift']());}catch(_0x30bfd5){_0x32073f['push'](_0x32073f['shift']());}}}(a90_0x5cff,0x1db3e));const bsSetupHelper=require('../helper'),path=require(a90_0xaae652(0xe6)),util=require(a90_0xaae652(0xdf)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0xaae652(0x92)),testhubUtils=require('./utils.js'),testHubConstants=require('./constants.js'),constants=require(a90_0xaae652(0xc1)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a90_0xaae652(0x7e))[a90_0xaae652(0xf2)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a90_0xaae652(0xf9)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a90_0xaae652(0xde)),{uploadTraceZip}=require(a90_0xaae652(0xc5)),OngoingEvents=new Set();let processedTraceZips=![];function a90_0x5cff(){const _0x29970a=['getHostInfo','WqbCp','assign','jwt','buildIdentifier','allowScreenshot','ooaiq','../../bin/utils/constants.js','setAccessibilityVariables','razIe','authToken','../../bin/playwright/reporter/pwUtils.js','BROWSERSTACK_PRODUCT_MAP','uploadPending','Percy\x20is\x20not\x20supported\x20for\x20','buildStopSent','checkAndSetupPercy','ANEtt','tpvjR','buildHashedId','isUndefined','CMNWc','settings','data','rvLDT','ACCESSIBILITY','/stop','icQay','923356zLbFLV','aDZah','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','BROWSERSTACK_TESTHUB_JWT','SDvLJ','3380WZQTsq','fjXcS','debug','../../bin/playwright/reporter/test-details.js','util','uGRBm','TuhOw','getAccessibilityOptions','finished_metadata','allSettled','isAccessibilityEnabled','path','JyDbH','174388qLahNv','PbOMh','getCiInfo','stopBuildUpstream\x20event\x20successful!','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','BROWSERSTACK_BUILD_RUN_IDENTIFIER','All\x20trace\x20zip\x20send\x20events\x20complete','anBoV','uWYfu','getInstance','winstonLogger','Kspff','surMT','exports','jeYBF','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','getAccessKey','../performance/performance-tester.js','token','isBrowserstackInfra','forEach','HMndF','false','user_killed','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','18785AUbmXs','measureWrapper','../logger','BS_TESTOPS_BUILD_COMPLETED','buildName','central_scanner','error','stop','getUserName','success','PUT','xPflU','BROWSERSTACK_TESTHUB_UUID','env','extractDataFromResponse','cwd','1339770csPbiA','generateBuildUpstreamData','NoVHz','BROWSERSTACK_ACCESSIBILITY','password','null','../test-observability/utils','toISOString','8sWBGJf','\x20framework','getGitMetaData','processTraceZips','351vdOPWm','QAeEC','START','getCentralUser','auth','getConfig','lcnc','stringify','PERCY_SUPPORTED_FRAMEWORKS','api/v1/builds/','ZZiDI','POST','username','format','Testhub\x20started\x20with\x20id:\x20','108iQNTUK','BROWSERSTACK_TEST_OBSERVABILITY','getTraceFilePaths','TESTHUB_BUILD_API','STOP','77967XkeZLb','brYxM','response','BROWSERSTACK_RERUN','config','status','125199fLkVuQ','BbHQK','framework','job_id','setupPercy','getProductMap','ENV_VAR','message'];a90_0x5cff=function(){return _0x29970a;};return a90_0x5cff();}const addEvent=_0x477282=>{OngoingEvents['add'](_0x477282);},awaitAllEvents=async()=>{const _0x3c6fe4=a90_0xaae652;return Promise[_0x3c6fe4(0xe4)](OngoingEvents);};class TestHubHandler{static [a90_0xaae652(0xc9)]=![];static async['launchBuild'](_0x2f930e,_0x2440be){const _0x331c0d=a90_0xaae652,_0xcb8d73={'rvLDT':function(_0x5bda3b,_0x15ecf3){return _0x5bda3b||_0x15ecf3;},'razIe':function(_0x427712,_0x5058e1){return _0x427712||_0x5058e1;},'brYxM':function(_0x2df6ac,_0x403676){return _0x2df6ac===_0x403676;},'ooaiq':function(_0x148f85){return _0x148f85();},'ZZiDI':_0x331c0d(0x7b),'fjXcS':_0x331c0d(0xfe),'ANEtt':_0x331c0d(0xec),'TuhOw':function(_0x3a65b8,_0x3a6e7d,_0x273dfd,_0x3641f7,_0x2c4a02){return _0x3a65b8(_0x3a6e7d,_0x273dfd,_0x3641f7,_0x2c4a02);},'Kspff':_0x331c0d(0xa3)};await PerformanceTester[_0x331c0d(0x7d)](PerformanceEvents[_0x331c0d(0x9a)],async()=>{const _0x2f6df3=_0x331c0d,_0x5e8eba=Object[_0x2f6df3(0xbc)]({},_0x2440be[_0x2f6df3(0xb0)],{'root_dir_path':'','framework':_0x2440be[_0x2f6df3(0xb4)]}),_0x51f475=bsSetupHelper[_0x2f6df3(0x84)](_0x5e8eba),_0x59b662=bsSetupHelper[_0x2f6df3(0xf8)](_0x5e8eba),_0x3f56e1=_0xcb8d73[_0x2f6df3(0xd2)](_0x51f475,'')+':'+_0xcb8d73[_0x2f6df3(0xc3)](_0x59b662,''),_0x281b67=testhubUtils[_0x2f6df3(0xb7)](_0x5e8eba);process[_0x2f6df3(0x89)][_0x2f6df3(0xc6)]=JSON[_0x2f6df3(0x9f)](_0x281b67);if(_0xcb8d73[_0x2f6df3(0xad)](_0x3f56e1,':'))return _0xcb8d73[_0x2f6df3(0xc0)](isTestObservabilitySession)&&(logger[_0x2f6df3(0xdd)](_0xcb8d73[_0x2f6df3(0xa2)]),process['env'][_0x2f6df3(0x7f)]=_0xcb8d73[_0x2f6df3(0xdc)]),testhubUtils['isAccessibilityEnabled'](_0x5e8eba)&&logger['debug'](_0xcb8d73[_0x2f6df3(0xcb)]),[null,null];try{const _0xf2c50b=await this[_0x2f6df3(0x8d)](_0x5e8eba,_0x2f930e),_0x38851a=this[_0x2f6df3(0x9d)](_0x51f475,_0x59b662),_0x11e6f2=await _0xcb8d73[_0x2f6df3(0xe1)](nodeRequest,_0xcb8d73[_0x2f6df3(0xf3)],testHubConstants[_0x2f6df3(0xaa)],_0xf2c50b,_0x38851a),_0x3e0b74=this[_0x2f6df3(0x8a)](_0x5e8eba,_0x11e6f2,_0x38851a);return await this[_0x2f6df3(0xca)](_0x2440be,_0x2f930e),_0x3e0b74;}catch(_0x3f25ae){if(_0xcb8d73[_0x2f6df3(0xad)](_0x3f25ae[_0x2f6df3(0x85)],![])){testhubUtils['logBuildError'](_0x3f25ae);return;}}})();}static async[a90_0xaae652(0x97)](){const _0x519108=a90_0xaae652,_0x53fe14={'WqbCp':function(_0x28e6ff,_0x4e2d09,_0x561ffb){return _0x28e6ff(_0x4e2d09,_0x561ffb);},'Gcger':function(_0xe7c2c6,_0xfd3ad8){return _0xe7c2c6(_0xfd3ad8);},'tpvjR':function(_0x3b584a){return _0x3b584a();},'surMT':_0x519108(0xee)};if(processedTraceZips)return;const _0x55a5af=TestDetails[_0x519108(0xa9)]();_0x55a5af[_0x519108(0xfc)](({testUId:_0x277700,filePath:_0x44c3c7})=>{const _0x564b97=_0x519108;var _0x57becf=_0x53fe14[_0x564b97(0xbb)](uploadTraceZip,_0x44c3c7,_0x277700);_0x53fe14['Gcger'](addEvent,_0x57becf);});try{await _0x53fe14[_0x519108(0xcc)](awaitAllEvents),logger[_0x519108(0xdd)](_0x53fe14[_0x519108(0xf4)]),processedTraceZips=!![];}catch(_0x24e28e){logger['error']('Error\x20while\x20waiting\x20for\x20events:\x20'+util[_0x519108(0xa5)](_0x24e28e));}}static async['checkAndSetupPercy'](_0x13a804,_0x33ae62){const _0x40f7b9=a90_0xaae652;if(constants[_0x40f7b9(0xa0)]['includes'](_0x33ae62)){await _0x13a804[_0x40f7b9(0xb6)]();return;}_0x13a804[_0x40f7b9(0xb0)]['percy']&&logger['debug'](_0x40f7b9(0xc8)+_0x33ae62+_0x40f7b9(0x95));}static['getAccessibilityOptions'](_0x56370c){const _0xd4a065=a90_0xaae652,_0x3c61f5={};_0x3c61f5[_0xd4a065(0xd0)]=_0x56370c['accessibilityOptions'];const _0x2c553f=_0x3c61f5;return _0x2c553f;}static[a90_0xaae652(0x9d)](_0xe917c8,_0x2b0e65){const _0x23e7fc=a90_0xaae652,_0x4a6639={'uWYfu':function(_0xd442ca,_0xeb6dcc){return _0xd442ca(_0xeb6dcc);}},_0xf09bee={};return _0xf09bee[_0x23e7fc(0xa4)]=_0xe917c8,_0xf09bee[_0x23e7fc(0x90)]=_0x2b0e65,{'auth':_0xf09bee,'headers':_0x4a6639[_0x23e7fc(0xf0)](getDefaultHeaders,![])};}static async[a90_0xaae652(0x8d)](_0x1d1985,_0x4e5dfd){const _0xbc11bb=a90_0xaae652,_0x11a22a={'HMndF':function(_0x4b9f89,_0x30b3db){return _0x4b9f89(_0x30b3db);}},_0x20ad1b={'project_name':_0x1d1985['projectName']||'','name':_0x1d1985[_0xbc11bb(0x80)]||path['basename'](path['resolve'](process[_0xbc11bb(0x8b)]())),'build_identifier':_0x1d1985[_0xbc11bb(0xbe)],'description':_0x1d1985['buildDescription']||'','started_at':new Date()['toISOString'](),'tags':_0x11a22a[_0xbc11bb(0xfd)](getCustomTags,_0x1d1985),'host_info':bsSetupHelper[_0xbc11bb(0xba)](),'ci_info':bsSetupHelper[_0xbc11bb(0xea)](),'build_run_identifier':process['env'][_0xbc11bb(0xed)],'failed_tests_rerun':process['env'][_0xbc11bb(0xaf)]||![],'version_control':await bsSetupHelper[_0xbc11bb(0x96)](),'accessibility':this[_0xbc11bb(0xe2)](_0x1d1985),'framework_details':testhubUtils['getFrameworkDetails'](_0x1d1985,_0x4e5dfd),'product_map':testhubUtils['getProductMap'](_0x1d1985),'browserstackAutomation':bsSetupHelper[_0xbc11bb(0xfb)](),'grouping_identifier':process['env']['BROWSERSTACK_BUILD_GROUPING_IDENTIFIER']};if(bsSetupHelper['getCentralUser']()[_0xbc11bb(0x81)]||bsSetupHelper[_0xbc11bb(0x9b)]()[_0xbc11bb(0x9e)]){const _0x1e05fc={};_0x1e05fc[_0xbc11bb(0xb5)]=process[_0xbc11bb(0x89)]['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0x1e05fc[_0xbc11bb(0xfa)]=process[_0xbc11bb(0x89)]['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x20ad1b[_0xbc11bb(0x81)]=_0x1e05fc;}return _0x20ad1b;}static['extractDataFromResponse'](_0x2f4acf,_0x816e8d,_0x9186b){const _0x28754c=a90_0xaae652,_0x2d8b94={'eLRTN':function(_0x12ab06){return _0x12ab06();},'BbHQK':function(_0x22f0ea,_0x2853b1){return _0x22f0ea&&_0x2853b1;},'PbOMh':'true','xPflU':'false'},_0x17f722={};if(_0x2d8b94['eLRTN'](isTestObservabilitySession)){const [_0x5d8797,_0x297e24,_0x44b67d]=testhubUtils['setTestObservabilityVariables'](_0x816e8d[_0x28754c(0xd1)],_0x9186b[_0x28754c(0x9c)]);if(_0x2d8b94[_0x28754c(0xb3)](_0x5d8797,_0x297e24)){const _0x17da02={};_0x17da02[_0x28754c(0xbd)]=_0x5d8797,_0x17da02['buildHashedId']=_0x297e24,_0x17da02[_0x28754c(0xbf)]=_0x44b67d,_0x17f722[testHubConstants['OBSERVABILITY']]=_0x17da02,process[_0x28754c(0x89)][_0x28754c(0xa8)]=_0x2d8b94[_0x28754c(0xe9)];}else _0x17f722[testHubConstants['OBSERVABILITY']]={},process[_0x28754c(0x89)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x2d8b94[_0x28754c(0x87)];}else process[_0x28754c(0x89)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x2d8b94['xPflU'];if(testhubUtils[_0x28754c(0xe5)](_0x2f4acf)){const [_0x559a43,_0x345ec3]=testhubUtils[_0x28754c(0xc2)](_0x816e8d[_0x28754c(0xd1)]);if(_0x2d8b94['BbHQK'](_0x559a43,_0x345ec3)){const _0x9bf799={};_0x9bf799[_0x28754c(0xc4)]=_0x559a43,_0x9bf799[_0x28754c(0xcd)]=_0x345ec3,_0x17f722[testHubConstants[_0x28754c(0xd3)]]=_0x9bf799,process[_0x28754c(0x89)][_0x28754c(0x8f)]=_0x2d8b94['PbOMh'];}else _0x17f722[testHubConstants[_0x28754c(0xd3)]]={},process[_0x28754c(0x89)][_0x28754c(0x8f)]=_0x2d8b94[_0x28754c(0x87)];}else process[_0x28754c(0x89)]['BROWSERSTACK_ACCESSIBILITY']=_0x2d8b94[_0x28754c(0x87)];return testhubUtils['setTestHubCommonMetaInfo'](_0x816e8d['data']),logger['info'](_0x28754c(0xa6)+process['env'][_0x28754c(0x88)]),_0x17f722;}static async[a90_0xaae652(0x83)](_0x3f03a5){const _0x3a8b55=a90_0xaae652,_0x1c8c09={'SDvLJ':function(_0x1f4427,_0x5bf12e){return _0x1f4427===_0x5bf12e;},'ApzVg':_0x3a8b55(0xfe),'QAeEC':_0x3a8b55(0x91),'anBoV':function(_0x1c6154,_0x1749e6){return _0x1c6154===_0x1749e6;},'LylWV':_0x3a8b55(0xd8),'aDZah':_0x3a8b55(0x82),'CMNWc':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','jeYBF':_0x3a8b55(0xe3),'JyDbH':_0x3a8b55(0x7a),'icQay':function(_0x34360d){return _0x34360d();},'WQXMa':function(_0x2a85f1,_0x28ee16,_0x3243a5,_0x166df7,_0x49e62a,_0x36c69c){return _0x2a85f1(_0x28ee16,_0x3243a5,_0x166df7,_0x49e62a,_0x36c69c);},'FTxoW':_0x3a8b55(0x86),'uGRBm':_0x3a8b55(0xeb),'NoVHz':'success'};await this[_0x3a8b55(0x97)](),await PerformanceTester[_0x3a8b55(0x7d)](PerformanceEvents[_0x3a8b55(0xab)],async()=>{const _0x518821=_0x3a8b55;if(_0x1c8c09[_0x518821(0xda)](process[_0x518821(0x89)][_0x518821(0x7f)],_0x1c8c09['ApzVg'])||TestHubHandler[_0x518821(0xc9)]||bsSetupHelper[_0x518821(0xce)](process['env'][testHubConstants[_0x518821(0xb8)][_0x518821(0xd9)]]))return;TestHubHandler['buildStopSent']=!![],await RequestQueueHandler[_0x518821(0xf1)]()[_0x518821(0xc7)](),await SessionHandler['waitForBuildStatus']();if(_0x1c8c09[_0x518821(0xda)](process['env'][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_JWT']],_0x1c8c09[_0x518821(0x99)])||_0x1c8c09[_0x518821(0xef)](process[_0x518821(0x89)][testHubConstants[_0x518821(0xb8)]['BROWSERSTACK_TESTHUB_UUID']],_0x1c8c09[_0x518821(0x99)])){logger[_0x518821(0xdd)](_0x1c8c09['LylWV']);const _0x5caa7a={};return _0x5caa7a[_0x518821(0xb1)]=_0x1c8c09[_0x518821(0xd7)],_0x5caa7a[_0x518821(0xb9)]=_0x1c8c09[_0x518821(0xcf)],_0x5caa7a;}const _0x2e7726={'finished_at':new Date()[_0x518821(0x93)](),'finished_metadata':[]};!!_0x3f03a5&&_0x2e7726[_0x1c8c09[_0x518821(0xf6)]]['push']({'reason':_0x1c8c09[_0x518821(0xe7)],'signal':_0x3f03a5,'failure_data':''});const _0x444e07={'headers':_0x1c8c09[_0x518821(0xd5)](getDefaultHeaders)};try{const _0x13336a=await _0x1c8c09['WQXMa'](nodeRequest,_0x1c8c09['FTxoW'],_0x518821(0xa1)+process['env'][testHubConstants['ENV_VAR'][_0x518821(0x88)]]+_0x518821(0xd4),_0x2e7726,_0x444e07,![]);if(_0x13336a[_0x518821(0xd1)]&&_0x13336a[_0x518821(0xd1)]['error']){const _0x1efc0b={};_0x1efc0b[_0x518821(0xb9)]=_0x13336a[_0x518821(0xd1)]['error'];throw _0x1efc0b;}else{logger['debug'](_0x1c8c09[_0x518821(0xe0)]);const _0x4879f4={};return _0x4879f4[_0x518821(0xb1)]=_0x1c8c09[_0x518821(0x8e)],_0x4879f4['message']='',_0x4879f4;}}catch(_0x561ad4){_0x561ad4['response']?logger[_0x518821(0xdd)](_0x518821(0xf7)+_0x561ad4[_0x518821(0xae)][_0x518821(0xb1)]+'\x20'+_0x561ad4[_0x518821(0xae)]['statusText']+'\x20'+JSON[_0x518821(0x9f)](_0x561ad4[_0x518821(0xae)][_0x518821(0xd1)])):logger[_0x518821(0xdd)](_0x518821(0xf7)+(_0x561ad4['message']||_0x561ad4));const _0x585d3d={};return _0x585d3d[_0x518821(0xb1)]=_0x1c8c09[_0x518821(0xd7)],_0x585d3d['message']=_0x561ad4[_0x518821(0xb9)]||_0x561ad4[_0x518821(0xae)]?_0x561ad4[_0x518821(0xae)][_0x518821(0xb1)]+':'+_0x561ad4[_0x518821(0xae)]['statusText']:_0x561ad4,_0x585d3d;}})();}}module[a90_0xaae652(0xf5)]=TestHubHandler;
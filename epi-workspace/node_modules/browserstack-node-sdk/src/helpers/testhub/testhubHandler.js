const a124_0x4387ad=a124_0x36cd;(function(_0x5b46b5,_0x49a5a5){const _0x285444=a124_0x36cd,_0x22e574=_0x5b46b5();while(!![]){try{const _0x11d7ca=parseInt(_0x285444(0xb8))/0x1*(-parseInt(_0x285444(0x100))/0x2)+-parseInt(_0x285444(0xe1))/0x3+-parseInt(_0x285444(0xe0))/0x4+-parseInt(_0x285444(0xd7))/0x5*(-parseInt(_0x285444(0x12d))/0x6)+-parseInt(_0x285444(0x123))/0x7*(-parseInt(_0x285444(0x11c))/0x8)+-parseInt(_0x285444(0x135))/0x9+-parseInt(_0x285444(0xd3))/0xa*(-parseInt(_0x285444(0xed))/0xb);if(_0x11d7ca===_0x49a5a5)break;else _0x22e574['push'](_0x22e574['shift']());}catch(_0x4dd941){_0x22e574['push'](_0x22e574['shift']());}}}(a124_0x42da,0xc089a));const bsSetupHelper=require(a124_0x4387ad(0xe5)),path=require(a124_0x4387ad(0xb3)),util=require(a124_0x4387ad(0xf1)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a124_0x4387ad(0xaa)),testHubConstants=require('./constants.js'),constants=require(a124_0x4387ad(0x12f)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a124_0x4387ad(0xc5))[a124_0x4387ad(0xb7)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a124_0x4387ad(0xf9)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),BrowserstackCLI=require(a124_0x4387ad(0xf6)),{uploadTraceZip}=require(a124_0x4387ad(0xfe)),TestInfo=require(a124_0x4387ad(0xeb)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x108321=>{const _0x1bc671=a124_0x4387ad;OngoingEvents[_0x1bc671(0x122)](_0x108321);},awaitAllEvents=async()=>{const _0x5d0631=a124_0x4387ad;return Promise[_0x5d0631(0xb5)](OngoingEvents);};class TestHubHandler{static [a124_0x4387ad(0x116)]=![];static async['launchBuild'](_0xbfc9c7,_0x568687){const _0x183de5=a124_0x4387ad,_0x26b3dc={'WCIuM':function(_0x5b2398,_0x317676){return _0x5b2398||_0x317676;},'EPejk':function(_0x106d45,_0x39c66f){return _0x106d45===_0x39c66f;},'wimtB':function(_0x34b552){return _0x34b552();},'jQZYn':_0x183de5(0x11b),'upzwO':_0x183de5(0xdd),'DxYHM':_0x183de5(0x133),'hTiNU':function(_0x52c88e,_0x313c7e,_0x3d5ba5,_0x22c7b9,_0x209098){return _0x52c88e(_0x313c7e,_0x3d5ba5,_0x22c7b9,_0x209098);},'IQtnO':_0x183de5(0xa9),'duHcd':_0x183de5(0x111),'oJsts':_0x183de5(0xee),'vtgvD':function(_0x3ea5bb,_0xd79476){return _0x3ea5bb===_0xd79476;}};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x183de5(0x105)],async()=>{const _0x18cd15=_0x183de5,_0x52ce9d=Object['assign']({},_0x568687[_0x18cd15(0xc1)],{'root_dir_path':'','framework':_0x568687[_0x18cd15(0xb1)]}),_0xcc945=bsSetupHelper['getUserName'](_0x52ce9d),_0x1f6764=bsSetupHelper[_0x18cd15(0x127)](_0x52ce9d),_0x79d5c8=_0x26b3dc[_0x18cd15(0xfb)](_0xcc945,'')+':'+_0x26b3dc['WCIuM'](_0x1f6764,''),_0x133975=testhubUtils['getProductMap'](_0x52ce9d);process[_0x18cd15(0x121)][_0x18cd15(0xbd)]=JSON['stringify'](_0x133975);if(_0x26b3dc[_0x18cd15(0x138)](_0x79d5c8,':'))return _0x26b3dc[_0x18cd15(0x10c)](isTestObservabilitySession)&&(logger[_0x18cd15(0xcf)](_0x26b3dc['jQZYn']),process[_0x18cd15(0x121)][_0x18cd15(0x10f)]=_0x26b3dc[_0x18cd15(0xd8)]),testhubUtils[_0x18cd15(0xaf)](_0x52ce9d)&&logger[_0x18cd15(0xcf)](_0x26b3dc[_0x18cd15(0xd0)]),[null,null];try{const _0x1d6558=await this[_0x18cd15(0x120)](_0x52ce9d,_0xbfc9c7),_0x2a2655=this[_0x18cd15(0x10d)](_0xcc945,_0x1f6764),_0x1fa966=await _0x26b3dc['hTiNU'](nodeRequest,_0x26b3dc[_0x18cd15(0x124)],testHubConstants[_0x18cd15(0xc9)],_0x1d6558,_0x2a2655),_0x3f7607=this[_0x18cd15(0x12c)](_0x52ce9d,_0x1fa966,_0x2a2655);await this[_0x18cd15(0xb9)](_0x568687,_0xbfc9c7);if(_0x26b3dc[_0x18cd15(0x138)](testhubUtils['getAccessibilityValueFromYml'](_0x568687[_0x18cd15(0xc1)]),null)){const _0x242391=_0x3f7607[_0x26b3dc[_0x18cd15(0x114)]];_0x242391&&_0x242391[_0x18cd15(0x103)]&&_0x242391[_0x18cd15(0xfa)]&&(_0x568687[_0x18cd15(0xc1)]['accessibility']=!![],process[_0x18cd15(0x121)][_0x18cd15(0xe3)]=_0x26b3dc[_0x18cd15(0xca)]);}return _0x3f7607;}catch(_0x24c05f){if(_0x26b3dc['vtgvD'](_0x24c05f[_0x18cd15(0xe8)],![])){testhubUtils['logBuildError'](_0x24c05f);return;}}})();}static async[a124_0x4387ad(0xf2)](){const _0x4e69c7=a124_0x4387ad,_0x154fd0={'frSIr':function(_0x424265,_0x1f97ac,_0x2a6106){return _0x424265(_0x1f97ac,_0x2a6106);},'RkqdU':function(_0x4f6c9d,_0xb91920){return _0x4f6c9d(_0xb91920);},'AfAvC':function(_0x4c03a4){return _0x4c03a4();},'kYHHV':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x2d4ee7=TestDetails[_0x4e69c7(0x132)]();_0x2d4ee7[_0x4e69c7(0xf4)](({testUId:_0x55351d,filePath:_0x560ac7})=>{const _0x3e8263=_0x4e69c7;var _0x97922a=_0x154fd0[_0x3e8263(0xba)](uploadTraceZip,_0x560ac7,_0x55351d);_0x154fd0['RkqdU'](addEvent,_0x97922a);});try{await _0x154fd0[_0x4e69c7(0xcb)](awaitAllEvents),logger['debug'](_0x154fd0[_0x4e69c7(0xc3)]),processedTraceZips=!![];}catch(_0x2da379){logger[_0x4e69c7(0xc4)]('Error\x20while\x20waiting\x20for\x20events:\x20'+util[_0x4e69c7(0xa8)](_0x2da379));}}static async['checkAndSetupPercy'](_0x1925fc,_0x4e7d73){const _0x44f7e9=a124_0x4387ad;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x44f7e9(0x131)](_0x4e7d73)){await _0x1925fc[_0x44f7e9(0xcd)]();return;}_0x1925fc[_0x44f7e9(0xc1)][_0x44f7e9(0xc7)]&&logger[_0x44f7e9(0xcf)]('Percy\x20is\x20not\x20supported\x20for\x20'+_0x4e7d73+_0x44f7e9(0x102));}static['getAccessibilityOptions'](_0x250579){const _0x29fad8=a124_0x4387ad,_0x495a32={};_0x495a32[_0x29fad8(0xbb)]=_0x250579[_0x29fad8(0x129)];const _0x39e803=_0x495a32;return _0x39e803;}static[a124_0x4387ad(0x10d)](_0x4a2ce8,_0x2f9fc1){const _0x43e1ab=a124_0x4387ad,_0x9c0ad3={'RPQxA':function(_0x22083d,_0x6d4d02){return _0x22083d(_0x6d4d02);}},_0x4cbf54={};return _0x4cbf54[_0x43e1ab(0xec)]=_0x4a2ce8,_0x4cbf54[_0x43e1ab(0x11a)]=_0x2f9fc1,{'auth':_0x4cbf54,'headers':_0x9c0ad3['RPQxA'](getDefaultHeaders,![])};}static async[a124_0x4387ad(0x120)](_0x1efcfd,_0x26be47){const _0x1d0661=a124_0x4387ad,_0x2c77d8={'woQTS':'Generating\x20build\x20upstream\x20data\x20for\x20TestHub','mFimU':function(_0x4e37d8,_0x5751bc){return _0x4e37d8(_0x5751bc);}};logger['debug'](_0x2c77d8[_0x1d0661(0x11e)]);const _0x4219ff={'project_name':_0x1efcfd[_0x1d0661(0xff)]||'','name':_0x1efcfd[_0x1d0661(0x12a)]||path[_0x1d0661(0xea)](path[_0x1d0661(0x115)](process[_0x1d0661(0xb0)]())),'build_identifier':_0x1efcfd['buildIdentifier'],'description':_0x1efcfd[_0x1d0661(0x101)]||'','started_at':new Date()['toISOString'](),'tags':_0x2c77d8[_0x1d0661(0x109)](getCustomTags,_0x1efcfd),'host_info':bsSetupHelper[_0x1d0661(0x12e)](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process['env']['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process[_0x1d0661(0x121)][_0x1d0661(0xe7)]||![],'version_control':await bsSetupHelper[_0x1d0661(0xc2)](),'accessibility':this[_0x1d0661(0x112)](_0x1efcfd),'framework_details':testhubUtils[_0x1d0661(0xcc)](_0x1efcfd,_0x26be47),'product_map':testhubUtils[_0x1d0661(0x104)](_0x1efcfd),'browserstackAutomation':bsSetupHelper[_0x1d0661(0xde)](),'grouping_identifier':process[_0x1d0661(0x121)][_0x1d0661(0xd4)],'test_orchestration':testhubUtils[_0x1d0661(0x117)](_0x1efcfd)};if(bsSetupHelper[_0x1d0661(0xc6)]()[_0x1d0661(0xfd)]||bsSetupHelper['getCentralUser']()[_0x1d0661(0x137)]){const _0x52ec4f={};_0x52ec4f[_0x1d0661(0xe9)]=process['env'][_0x1d0661(0xd2)],_0x52ec4f['token']=process[_0x1d0661(0x121)][_0x1d0661(0xf5)],_0x4219ff['central_scanner']=_0x52ec4f;}return _0x4219ff;}static['extractDataFromResponse'](_0x1148c3,_0x4bd49c,_0x1a00ac){const _0x5085be=a124_0x4387ad,_0x12a46b={'PBrQF':function(_0x38494e){return _0x38494e();},'yShpk':function(_0x3b19c1,_0x1bb65d){return _0x3b19c1&&_0x1bb65d;},'CARVM':_0x5085be(0xee),'gXTvP':_0x5085be(0xdd)},_0x5952dc={};if(_0x12a46b[_0x5085be(0xdf)](isTestObservabilitySession)){const [_0x50d59d,_0xb6426b,_0x53a32e]=testhubUtils['setTestObservabilityVariables'](_0x4bd49c[_0x5085be(0x130)],_0x1a00ac['auth']);if(_0x12a46b[_0x5085be(0x126)](_0x50d59d,_0xb6426b)){const _0x3c1023={};_0x3c1023[_0x5085be(0x11f)]=_0x50d59d,_0x3c1023['buildHashedId']=_0xb6426b,_0x3c1023[_0x5085be(0xdc)]=_0x53a32e,_0x5952dc[testHubConstants[_0x5085be(0x110)]]=_0x3c1023,process['env'][_0x5085be(0xf7)]=_0x12a46b['CARVM'];}else _0x5952dc[testHubConstants[_0x5085be(0x110)]]={},process[_0x5085be(0x121)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x12a46b[_0x5085be(0xc8)];}else process[_0x5085be(0x121)][_0x5085be(0xf7)]=_0x12a46b[_0x5085be(0xc8)];const [_0x3cd3f3,_0x49d971]=testhubUtils[_0x5085be(0xb2)](_0x4bd49c[_0x5085be(0x130)]);if(_0x12a46b[_0x5085be(0x126)](_0x3cd3f3,_0x49d971)){const _0x2bbbad={};_0x2bbbad[_0x5085be(0x103)]=_0x3cd3f3,_0x2bbbad[_0x5085be(0xfa)]=_0x49d971,_0x5952dc[testHubConstants['ACCESSIBILITY']]=_0x2bbbad,process[_0x5085be(0x121)][_0x5085be(0xac)]=_0x12a46b['CARVM'];}else _0x5952dc[testHubConstants[_0x5085be(0x12b)]]={},process[_0x5085be(0x121)]['BROWSERSTACK_ACCESSIBILITY']=_0x12a46b[_0x5085be(0xc8)];return testhubUtils[_0x5085be(0xbc)](_0x4bd49c[_0x5085be(0x130)]),logger[_0x5085be(0x113)](_0x5085be(0x128)+process[_0x5085be(0x121)][_0x5085be(0xdb)]),_0x5952dc;}static async[a124_0x4387ad(0xb6)](_0x3e5969){const _0x2538c6=a124_0x4387ad,_0x249347={'flAAE':function(_0x49afe2,_0x534b52){return _0x49afe2===_0x534b52;},'DfXjK':_0x2538c6(0xdd),'nbknj':_0x2538c6(0x108),'QkqMl':_0x2538c6(0xad),'NOxBX':_0x2538c6(0xc4),'HFPVy':_0x2538c6(0x106),'ZRMPV':'finished_metadata','HzmHd':_0x2538c6(0xbf),'zOljA':function(_0x1e3f57){return _0x1e3f57();},'DKvPh':function(_0x1418b8,_0x55f704,_0x49f272,_0x3ba29c,_0x2cb60f,_0x22dcb7){return _0x1418b8(_0x55f704,_0x49f272,_0x3ba29c,_0x2cb60f,_0x22dcb7);},'bfPDd':'PUT','uPCmN':'stopBuildUpstream\x20event\x20successful!','fmHbE':_0x2538c6(0xe8)};!BrowserstackCLI[_0x2538c6(0xbe)]()[_0x2538c6(0x10b)]()&&await this[_0x2538c6(0xf2)](),await PerformanceTester['measureWrapper'](PerformanceEvents[_0x2538c6(0xab)],async()=>{const _0x2d37df=_0x2538c6;if(_0x249347['flAAE'](process[_0x2d37df(0x121)][_0x2d37df(0x10f)],_0x249347[_0x2d37df(0xb4)])||TestHubHandler[_0x2d37df(0x116)]||bsSetupHelper['isUndefined'](process['env'][testHubConstants[_0x2d37df(0x107)][_0x2d37df(0xef)]]))return;TestHubHandler[_0x2d37df(0x116)]=!![],await RequestQueueHandler[_0x2d37df(0xbe)]()[_0x2d37df(0x136)](),await SessionHandler[_0x2d37df(0x118)]();if(_0x249347[_0x2d37df(0x125)](process[_0x2d37df(0x121)][testHubConstants[_0x2d37df(0x107)][_0x2d37df(0xef)]],_0x249347[_0x2d37df(0xf0)])||_0x249347[_0x2d37df(0x125)](process[_0x2d37df(0x121)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']],_0x249347[_0x2d37df(0xf0)])){logger[_0x2d37df(0xcf)](_0x249347[_0x2d37df(0xfc)]);const _0x4b1241={};return _0x4b1241[_0x2d37df(0x10e)]=_0x249347[_0x2d37df(0xd6)],_0x4b1241[_0x2d37df(0xf8)]=_0x249347[_0x2d37df(0xe4)],_0x4b1241;}const _0x4a6c9e={'finished_at':new Date()[_0x2d37df(0xd5)](),'finished_metadata':[]};!!_0x3e5969&&_0x4a6c9e[_0x249347['ZRMPV']][_0x2d37df(0xe6)]({'reason':_0x249347[_0x2d37df(0x134)],'signal':_0x3e5969,'failure_data':''});const _0x3e998a={'headers':_0x249347['zOljA'](getDefaultHeaders)};try{const _0x191bdc=await _0x249347[_0x2d37df(0x119)](nodeRequest,_0x249347[_0x2d37df(0x10a)],_0x2d37df(0xae)+process[_0x2d37df(0x121)][testHubConstants['ENV_VAR'][_0x2d37df(0xdb)]]+_0x2d37df(0xf3),_0x4a6c9e,_0x3e998a,![]);if(_0x191bdc[_0x2d37df(0x130)]&&_0x191bdc['data'][_0x2d37df(0xc4)]){const _0x5f423f={};_0x5f423f[_0x2d37df(0xf8)]=_0x191bdc[_0x2d37df(0x130)][_0x2d37df(0xc4)];throw _0x5f423f;}else{logger['debug'](_0x249347[_0x2d37df(0xe2)]);const _0x5f3caf={};return _0x5f3caf[_0x2d37df(0x10e)]=_0x249347[_0x2d37df(0xd1)],_0x5f3caf[_0x2d37df(0xf8)]='',_0x5f3caf;}}catch(_0x14ffd6){_0x14ffd6[_0x2d37df(0xce)]?logger[_0x2d37df(0xcf)](_0x2d37df(0xd9)+_0x14ffd6['response'][_0x2d37df(0x10e)]+'\x20'+_0x14ffd6[_0x2d37df(0xce)][_0x2d37df(0xda)]+'\x20'+JSON[_0x2d37df(0x11d)](_0x14ffd6[_0x2d37df(0xce)][_0x2d37df(0x130)])):logger[_0x2d37df(0xcf)](_0x2d37df(0xd9)+(_0x14ffd6[_0x2d37df(0xf8)]||_0x14ffd6));const _0x4d7df0={};return _0x4d7df0[_0x2d37df(0x10e)]=_0x249347[_0x2d37df(0xd6)],_0x4d7df0[_0x2d37df(0xf8)]=_0x14ffd6['message']||_0x14ffd6['response']?_0x14ffd6[_0x2d37df(0xce)][_0x2d37df(0x10e)]+':'+_0x14ffd6[_0x2d37df(0xce)]['statusText']:_0x14ffd6,_0x4d7df0;}})();}}function a124_0x36cd(_0x235327,_0x59f2dd){const _0x42da06=a124_0x42da();return a124_0x36cd=function(_0x36cd0b,_0x2b6cf5){_0x36cd0b=_0x36cd0b-0xa8;let _0x49e45e=_0x42da06[_0x36cd0b];return _0x49e45e;},a124_0x36cd(_0x235327,_0x59f2dd);}function a124_0x42da(){const _0x4dba39=['EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','9936752eaUZUD','stringify','woQTS','jwt','generateBuildUpstreamData','env','add','7tjJSCh','IQtnO','flAAE','yShpk','getAccessKey','Testhub\x20started\x20with\x20id:\x20','accessibilityOptions','buildName','ACCESSIBILITY','extractDataFromResponse','85818CyLkiR','getHostInfo','../../bin/utils/constants.js','data','includes','getTraceFilePaths','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','HzmHd','5140719pYbkgk','uploadPending','lcnc','EPejk','format','POST','./utils.js','STOP','BROWSERSTACK_ACCESSIBILITY','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','api/v1/builds/','isAccessibilityEnabled','cwd','framework','setAccessibilityVariables','path','DfXjK','allSettled','stop','winstonLogger','1wFDOkR','checkAndSetupPercy','frSIr','settings','setTestHubCommonMetaInfo','BROWSERSTACK_PRODUCT_MAP','getInstance','user_killed','exports','config','getGitMetaData','kYHHV','error','../logger','getCentralUser','percy','gXTvP','TESTHUB_BUILD_API','oJsts','AfAvC','getFrameworkDetails','setupPercy','response','debug','DxYHM','fmHbE','BROWSERSTACK_CENTRAL_SCANNER_JOBID','30559190SJFZso','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','toISOString','NOxBX','20DLNXpM','upzwO','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','statusText','BROWSERSTACK_TESTHUB_UUID','allowScreenshot','false','isBrowserstackInfra','PBrQF','3639112AvcjEn','2946687iRrzIQ','uPCmN','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','HFPVy','../helper','push','BROWSERSTACK_RERUN','success','job_id','basename','../../bin/v2/TestInfo.js','username','11bQGzwi','true','BROWSERSTACK_TESTHUB_JWT','nbknj','util','processTraceZips','/stop','forEach','BROWSERSTACK_CENTRAL_SCANNER_JWT','../../bin/v2/browserstackCLI','BROWSERSTACK_TEST_OBSERVABILITY','message','../performance/constants','buildHashedId','WCIuM','QkqMl','central_scanner','../../bin/playwright/reporter/pwUtils.js','projectName','2206786GOOCZA','buildDescription','\x20framework','authToken','getProductMapForBuildStartCall','START','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','ENV_VAR','null','mFimU','bfPDd','isRunning','wimtB','getConfig','status','BS_TESTOPS_BUILD_COMPLETED','OBSERVABILITY','accessibility','getAccessibilityOptions','info','duHcd','resolve','buildStopSent','getTestOrchestrationBuildStartData','waitForBuildStatus','DKvPh','password'];a124_0x42da=function(){return _0x4dba39;};return a124_0x42da();}module[a124_0x4387ad(0xc0)]=TestHubHandler;
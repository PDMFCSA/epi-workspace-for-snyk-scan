const a134_0x1a0c6c=a134_0x126f;(function(_0x361a7d,_0x1e6bb3){const _0x59f5e4=a134_0x126f,_0x36ff97=_0x361a7d();while(!![]){try{const _0x5b7596=parseInt(_0x59f5e4(0x102))/0x1+parseInt(_0x59f5e4(0xba))/0x2+parseInt(_0x59f5e4(0x127))/0x3*(-parseInt(_0x59f5e4(0xff))/0x4)+-parseInt(_0x59f5e4(0xed))/0x5*(parseInt(_0x59f5e4(0x128))/0x6)+-parseInt(_0x59f5e4(0xb8))/0x7+parseInt(_0x59f5e4(0x111))/0x8*(-parseInt(_0x59f5e4(0xc9))/0x9)+parseInt(_0x59f5e4(0x11a))/0xa;if(_0x5b7596===_0x1e6bb3)break;else _0x36ff97['push'](_0x36ff97['shift']());}catch(_0x5cd059){_0x36ff97['push'](_0x36ff97['shift']());}}}(a134_0x5d6a,0x7fb16));const bsSetupHelper=require('../helper'),path=require(a134_0x1a0c6c(0xd3)),util=require(a134_0x1a0c6c(0xe8)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a134_0x1a0c6c(0xa1)),testHubConstants=require(a134_0x1a0c6c(0xc1)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a134_0x1a0c6c(0xf1))[a134_0x1a0c6c(0x12d)],SessionHandler=require(a134_0x1a0c6c(0xf2)),PerformanceTester=require(a134_0x1a0c6c(0xe0)),{TESTHUB_EVENTS:PerformanceEvents}=require(a134_0x1a0c6c(0xbf)),TestDetails=require(a134_0x1a0c6c(0xb5)),{uploadTraceZip}=require(a134_0x1a0c6c(0xce)),{isTurboScaleSession}=require(a134_0x1a0c6c(0x112)),BrowserstackCLI=require(a134_0x1a0c6c(0xd1)),OngoingEvents=new Set();function a134_0x126f(_0x18580c,_0x1aafb2){const _0x5d6a27=a134_0x5d6a();return a134_0x126f=function(_0x126f8c,_0x4724a1){_0x126f8c=_0x126f8c-0x97;let _0x17b49e=_0x5d6a27[_0x126f8c];return _0x17b49e;},a134_0x126f(_0x18580c,_0x1aafb2);}let processedTraceZips=![];const addEvent=_0x3054b0=>{const _0x5ac429=a134_0x1a0c6c;OngoingEvents[_0x5ac429(0xa4)](_0x3054b0);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};class TestHubHandler{static [a134_0x1a0c6c(0xd6)]=![];static async['launchBuild'](_0x1fb7f4,_0x52b20c){const _0x519931=a134_0x1a0c6c,_0x21c382={'ohgwX':function(_0x4929a8,_0xf310d4){return _0x4929a8||_0xf310d4;},'pudVc':function(_0x33b4bf,_0x8eaada){return _0x33b4bf||_0x8eaada;},'IHpKr':function(_0x51de65,_0x53ec95){return _0x51de65===_0x53ec95;},'ZEmBc':function(_0x374a7f){return _0x374a7f();},'ccSPV':_0x519931(0xcf),'bQZoW':'false','hnSUF':_0x519931(0xe3),'RAGOt':function(_0x4ff6cf,_0x3c0f92,_0x1bed26,_0x3159ad,_0x12381b){return _0x4ff6cf(_0x3c0f92,_0x1bed26,_0x3159ad,_0x12381b);},'gSThs':_0x519931(0x113),'DUwIf':function(_0x44ebe7,_0x2caa5b){return _0x44ebe7===_0x2caa5b;},'QahHC':_0x519931(0x12f),'tbkxY':'true','YTWEb':_0x519931(0xf0),'hdHPG':function(_0x2d871a,_0x3e19b5){return _0x2d871a===_0x3e19b5;}};await PerformanceTester[_0x519931(0xa7)](PerformanceEvents[_0x519931(0xdc)],async()=>{const _0xcfb923=_0x519931,_0x36726=Object['assign']({},_0x52b20c[_0xcfb923(0xc4)],{'root_dir_path':'','framework':_0x52b20c[_0xcfb923(0x109)]}),_0x5e05b1=bsSetupHelper[_0xcfb923(0xd4)](_0x36726),_0xfb73f7=bsSetupHelper['getAccessKey'](_0x36726),_0x38c644=_0x21c382[_0xcfb923(0xfa)](_0x5e05b1,'')+':'+_0x21c382['pudVc'](_0xfb73f7,''),_0x548881=testhubUtils[_0xcfb923(0x12c)](_0x36726);process[_0xcfb923(0x9d)][_0xcfb923(0x115)]=JSON[_0xcfb923(0xfc)](_0x548881);if(_0x21c382[_0xcfb923(0xaa)](_0x38c644,':'))return _0x21c382['ZEmBc'](isTestObservabilitySession)&&(logger['debug'](_0x21c382['ccSPV']),process['env'][_0xcfb923(0xa6)]=_0x21c382[_0xcfb923(0x9b)]),testhubUtils[_0xcfb923(0x118)](_0x36726)&&logger['debug'](_0x21c382[_0xcfb923(0xb1)]),[null,null];try{const _0x5558c=await this[_0xcfb923(0xa9)](_0x36726,_0x1fb7f4),_0x4b9261=this[_0xcfb923(0xbd)](_0x5e05b1,_0xfb73f7),_0x308fe9=await _0x21c382[_0xcfb923(0xc7)](nodeRequest,_0x21c382['gSThs'],testHubConstants[_0xcfb923(0xc5)],_0x5558c,_0x4b9261),_0x21f038=this['extractDataFromResponse'](_0x36726,_0x308fe9,_0x4b9261);await this['checkAndSetupPercy'](_0x52b20c,_0x1fb7f4);if(_0x21c382[_0xcfb923(0xae)](testhubUtils[_0xcfb923(0x101)](_0x52b20c[_0xcfb923(0xc4)]),null)){const _0x3a7b72=_0x21f038[_0x21c382['QahHC']];_0x3a7b72&&_0x3a7b72['authToken']&&_0x3a7b72[_0xcfb923(0xd5)]&&(_0x52b20c[_0xcfb923(0xc4)][_0xcfb923(0x12f)]=!![],process['env'][_0xcfb923(0xa8)]=_0x21c382[_0xcfb923(0xf5)]);}return _0x21f038&&_0x21f038[_0x21c382[_0xcfb923(0xc2)]]&&_0x21f038[_0x21c382[_0xcfb923(0xc2)]][_0x21c382[_0xcfb923(0x123)]]&&(process[_0xcfb923(0x9d)][_0xcfb923(0xec)]=_0x21f038[_0x21c382[_0xcfb923(0xc2)]][_0x21c382['YTWEb']]),_0x21f038;}catch(_0x399aae){if(_0x21c382[_0xcfb923(0xf7)](_0x399aae[_0xcfb923(0x114)],![])){testhubUtils['logBuildError'](_0x399aae);return;}}})();}static async[a134_0x1a0c6c(0x11f)](){const _0x5df6d1=a134_0x1a0c6c,_0x283e01={'CKiCa':function(_0x325045,_0x2ab271,_0x5c2212){return _0x325045(_0x2ab271,_0x5c2212);},'BENUx':function(_0x5e099b,_0x2cd49c){return _0x5e099b(_0x2cd49c);},'jhsxb':function(_0x2355d1){return _0x2355d1();},'dRUkz':_0x5df6d1(0x10c)};if(processedTraceZips)return;const _0x5f11e3=TestDetails[_0x5df6d1(0xc3)]();_0x5f11e3[_0x5df6d1(0xfd)](({testUId:_0xa758e1,filePath:_0x3c9bd9})=>{const _0x44f833=_0x5df6d1;var _0xf0edf4=_0x283e01['CKiCa'](uploadTraceZip,_0x3c9bd9,_0xa758e1);_0x283e01[_0x44f833(0x108)](addEvent,_0xf0edf4);});try{await _0x283e01[_0x5df6d1(0xc6)](awaitAllEvents),logger[_0x5df6d1(0x105)](_0x283e01['dRUkz']),processedTraceZips=!![];}catch(_0x471409){logger['error'](_0x5df6d1(0xd9)+util[_0x5df6d1(0x10e)](_0x471409));}}static async[a134_0x1a0c6c(0xe6)](_0x7bfac9,_0x24b834){const _0x1bba72=a134_0x1a0c6c;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x1bba72(0x106)](_0x24b834)){await _0x7bfac9[_0x1bba72(0xee)]();return;}_0x7bfac9[_0x1bba72(0xc4)]['percy']&&logger[_0x1bba72(0x105)](_0x1bba72(0x10a)+_0x24b834+_0x1bba72(0xfb));}static['getAccessibilityOptions'](_0x336678){const _0x4a3076=a134_0x1a0c6c,_0x190553={'PfBkL':function(_0x17ceee,_0x44b20e){return _0x17ceee(_0x44b20e);},'QfbuL':_0x4a3076(0x12e)};let _0x3b8e24;if(_0x336678[_0x4a3076(0xc8)]){const _0x590fbc={};_0x590fbc['settings']=_0x336678[_0x4a3076(0xc8)],_0x3b8e24=_0x590fbc;}else{const _0x1da108={};_0x1da108[_0x4a3076(0x122)]={},_0x3b8e24=_0x1da108;}if((!bsSetupHelper[_0x4a3076(0x119)]()||_0x190553[_0x4a3076(0x10b)](isTurboScaleSession,_0x336678))&&testhubUtils[_0x4a3076(0x118)](_0x336678)){const _0x46e48a={};_0x46e48a[_0x4a3076(0xb7)]=_0x190553[_0x4a3076(0xe9)],Object[_0x4a3076(0x11e)](_0x3b8e24[_0x4a3076(0x122)],_0x46e48a);}return _0x3b8e24;}static[a134_0x1a0c6c(0xbd)](_0x352838,_0x5eabe8){const _0x587800=a134_0x1a0c6c,_0x21a922={'dbyTo':function(_0x43cecd,_0x5da89e){return _0x43cecd(_0x5da89e);}},_0x3b746f={};return _0x3b746f[_0x587800(0x132)]=_0x352838,_0x3b746f['password']=_0x5eabe8,{'auth':_0x3b746f,'headers':_0x21a922[_0x587800(0xeb)](getDefaultHeaders,![])};}static async[a134_0x1a0c6c(0xa9)](_0x46de63,_0x4d487a){const _0xa09d73=a134_0x1a0c6c,_0x14edeb={'dwqhW':_0xa09d73(0xd0),'hsJVF':function(_0x7188f0,_0x337003){return _0x7188f0(_0x337003);}};logger[_0xa09d73(0x105)](_0x14edeb[_0xa09d73(0xc0)]);const _0x26dc1e={'project_name':_0x46de63[_0xa09d73(0x11b)]||'','name':_0x46de63['buildName']||path[_0xa09d73(0xf6)](path[_0xa09d73(0x97)](process[_0xa09d73(0xad)]())),'build_identifier':_0x46de63[_0xa09d73(0xab)],'description':_0x46de63[_0xa09d73(0xac)]||'','started_at':new Date()['toISOString'](),'tags':_0x14edeb[_0xa09d73(0xb6)](getCustomTags,_0x46de63),'host_info':bsSetupHelper[_0xa09d73(0x12a)](),'ci_info':bsSetupHelper[_0xa09d73(0xf8)](),'build_run_identifier':process[_0xa09d73(0x9d)]['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process[_0xa09d73(0x9d)][_0xa09d73(0xda)]||![],'linked_build_uuid':process[_0xa09d73(0x9d)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper['getGitMetaData'](),'accessibility':this[_0xa09d73(0xb3)](_0x46de63),'framework_details':testhubUtils[_0xa09d73(0xea)](_0x46de63,_0x4d487a),'product_map':testhubUtils[_0xa09d73(0xbe)](_0x46de63),'browserstackAutomation':bsSetupHelper[_0xa09d73(0x119)](),'grouping_identifier':process[_0xa09d73(0x9d)][_0xa09d73(0xe1)],'test_orchestration':testhubUtils[_0xa09d73(0xef)](_0x46de63)};if(bsSetupHelper[_0xa09d73(0x104)]()[_0xa09d73(0x116)]||bsSetupHelper['getCentralUser']()[_0xa09d73(0x9c)]){const _0x296dac={};_0x296dac[_0xa09d73(0xca)]=process['env'][_0xa09d73(0x9e)],_0x296dac[_0xa09d73(0x124)]=process['env']['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x26dc1e[_0xa09d73(0x116)]=_0x296dac;}return _0x26dc1e;}static[a134_0x1a0c6c(0x11d)](_0x268af1,_0x454455,_0x42c9d8){const _0x520783=a134_0x1a0c6c,_0xfc225={'SULVZ':function(_0x3cc364){return _0x3cc364();},'JyrmO':function(_0x45a1af,_0x324a8e){return _0x45a1af&&_0x324a8e;},'DRAIj':_0x520783(0x12e),'kHdHD':'false'},_0x358d8d={};if(_0xfc225['SULVZ'](isTestObservabilitySession)){const [_0x18bd99,_0x1b5ca8,_0x340b65]=testhubUtils[_0x520783(0x131)](_0x454455[_0x520783(0x9f)],_0x42c9d8[_0x520783(0x12b)]);if(_0xfc225['JyrmO'](_0x18bd99,_0x1b5ca8)){const _0x515e87={};_0x515e87[_0x520783(0xcd)]=_0x18bd99,_0x515e87[_0x520783(0xd5)]=_0x1b5ca8,_0x515e87[_0x520783(0xb2)]=_0x340b65,_0x358d8d[testHubConstants[_0x520783(0xbc)]]=_0x515e87,process[_0x520783(0x9d)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0xfc225[_0x520783(0xa3)];}else _0x358d8d[testHubConstants[_0x520783(0xbc)]]={},process[_0x520783(0x9d)][_0x520783(0x9a)]=_0xfc225[_0x520783(0xb9)];}else process[_0x520783(0x9d)][_0x520783(0x9a)]=_0xfc225[_0x520783(0xb9)];const [_0x277638,_0x2135af,_0x2de140]=testhubUtils[_0x520783(0xde)](_0x454455[_0x520783(0x9f)]);if(_0xfc225['JyrmO'](_0x277638,_0x2135af)){const _0x23b507={};_0x23b507[_0x520783(0x110)]=_0x277638,_0x23b507[_0x520783(0xd5)]=_0x2135af,_0x23b507['scannerProcessingTimeout']=_0x2de140,_0x358d8d[testHubConstants[_0x520783(0x107)]]=_0x23b507,process[_0x520783(0x9d)][_0x520783(0xf9)]=_0xfc225[_0x520783(0xa3)];}else _0x358d8d[testHubConstants[_0x520783(0x107)]]={},process['env'][_0x520783(0xf9)]=_0xfc225['kHdHD'];return testhubUtils[_0x520783(0x10d)](_0x454455[_0x520783(0x9f)]),logger[_0x520783(0xd8)](_0x520783(0xbb)+process[_0x520783(0x9d)][_0x520783(0x10f)]),_0x358d8d;}static async['stop'](_0x22e74c){const _0x1fbc47=a134_0x1a0c6c,_0x4862ab={'ohhhZ':function(_0x4299bc,_0x31c6ad){return _0x4299bc===_0x31c6ad;},'gtWAp':'false','Vkqpt':_0x1fbc47(0xe5),'qkVSI':function(_0x138e86,_0x318bb5){return _0x138e86===_0x318bb5;},'QloJV':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','zLLbr':_0x1fbc47(0xf4),'oXXys':_0x1fbc47(0xd7),'BwQfF':'finished_metadata','lXpSD':_0x1fbc47(0xf3),'hvrKX':function(_0x578752){return _0x578752();},'Ipsxv':function(_0x3053e4,_0x11bc05,_0x407aaf,_0x310a55,_0x30f242,_0xbd4179){return _0x3053e4(_0x11bc05,_0x407aaf,_0x310a55,_0x30f242,_0xbd4179);},'lIdkK':_0x1fbc47(0xa2),'jObtV':_0x1fbc47(0x11c),'FsiXQ':_0x1fbc47(0x114)};await PerformanceTester[_0x1fbc47(0xa7)](PerformanceEvents[_0x1fbc47(0xe7)],async()=>{const _0x488959=_0x1fbc47;if(_0x4862ab[_0x488959(0x103)](process[_0x488959(0x9d)][_0x488959(0xa6)],_0x4862ab[_0x488959(0xa0)])||TestHubHandler['buildStopSent']||bsSetupHelper['isUndefined'](process['env'][testHubConstants[_0x488959(0x126)][_0x488959(0x98)]]))return;TestHubHandler['buildStopSent']=!![];if(BrowserstackCLI[_0x488959(0x100)]()[_0x488959(0xfe)]())return;await this[_0x488959(0x11f)](),await RequestQueueHandler['getInstance']()['uploadPending'](),await SessionHandler[_0x488959(0xe2)]();if(_0x4862ab['ohhhZ'](process[_0x488959(0x9d)][testHubConstants[_0x488959(0x126)][_0x488959(0x98)]],_0x4862ab[_0x488959(0xdb)])||_0x4862ab[_0x488959(0xb4)](process['env'][testHubConstants[_0x488959(0x126)][_0x488959(0x10f)]],_0x4862ab[_0x488959(0xdb)])){logger[_0x488959(0x105)](_0x4862ab[_0x488959(0xdf)]);const _0x1c1014={};return _0x1c1014[_0x488959(0xd2)]=_0x4862ab[_0x488959(0xa5)],_0x1c1014['message']=_0x4862ab[_0x488959(0x125)],_0x1c1014;}const _0x18f0e4={'finished_at':new Date()[_0x488959(0xcb)](),'finished_metadata':[]};!!_0x22e74c&&_0x18f0e4[_0x4862ab['BwQfF']][_0x488959(0xb0)]({'reason':_0x4862ab[_0x488959(0x117)],'signal':_0x22e74c,'failure_data':''});const _0x49156d={'headers':_0x4862ab[_0x488959(0xcc)](getDefaultHeaders)};try{const _0x2ec45d=await _0x4862ab[_0x488959(0xaf)](nodeRequest,_0x4862ab[_0x488959(0xdd)],'api/v1/builds/'+process[_0x488959(0x9d)][testHubConstants[_0x488959(0x126)][_0x488959(0x10f)]]+'/stop',_0x18f0e4,_0x49156d,![]);if(_0x2ec45d[_0x488959(0x9f)]&&_0x2ec45d[_0x488959(0x9f)]['error']){const _0x1336b4={};_0x1336b4[_0x488959(0x129)]=_0x2ec45d['data'][_0x488959(0xf4)];throw _0x1336b4;}else{logger[_0x488959(0x105)](_0x4862ab[_0x488959(0x130)]);const _0x3976f3={};return _0x3976f3[_0x488959(0xd2)]=_0x4862ab['FsiXQ'],_0x3976f3[_0x488959(0x129)]='',_0x3976f3;}}catch(_0x5861ac){_0x5861ac['response']?logger[_0x488959(0x105)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x5861ac[_0x488959(0x121)][_0x488959(0xd2)]+'\x20'+_0x5861ac[_0x488959(0x121)][_0x488959(0xe4)]+'\x20'+JSON[_0x488959(0xfc)](_0x5861ac[_0x488959(0x121)][_0x488959(0x9f)])):logger[_0x488959(0x105)](_0x488959(0x99)+(_0x5861ac[_0x488959(0x129)]||_0x5861ac));const _0x1a2437={};return _0x1a2437[_0x488959(0xd2)]=_0x4862ab[_0x488959(0xa5)],_0x1a2437['message']=_0x5861ac[_0x488959(0x129)]||_0x5861ac[_0x488959(0x121)]?_0x5861ac['response'][_0x488959(0xd2)]+':'+_0x5861ac['response'][_0x488959(0xe4)]:_0x5861ac,_0x1a2437;}})();}}function a134_0x5d6a(){const _0x37db42=['../helper.js','POST','success','BROWSERSTACK_PRODUCT_MAP','central_scanner','lXpSD','isAccessibilityEnabled','isBrowserstackInfra','23693070bIQfNI','projectName','stopBuildUpstream\x20event\x20successful!','extractDataFromResponse','assign','processTraceZips','exports','response','settings','YTWEb','token','oXXys','ENV_VAR','1899IpBCvd','6pEMweX','message','getHostInfo','auth','getProductMap','winstonLogger','true','accessibility','jObtV','setTestObservabilityVariables','username','resolve','BROWSERSTACK_TESTHUB_JWT','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','BROWSERSTACK_TEST_OBSERVABILITY','bQZoW','lcnc','env','BROWSERSTACK_CENTRAL_SCANNER_JOBID','data','gtWAp','./utils.js','PUT','DRAIj','add','zLLbr','BS_TESTOPS_BUILD_COMPLETED','measureWrapper','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','generateBuildUpstreamData','IHpKr','buildIdentifier','buildDescription','cwd','DUwIf','Ipsxv','push','hnSUF','allowScreenshot','getAccessibilityOptions','qkVSI','../../bin/playwright/reporter/test-details.js','hsJVF','includeEncodedExtension','5122593Hligkl','kHdHD','1171166kUwtVX','Testhub\x20started\x20with\x20id:\x20','OBSERVABILITY','getConfig','getProductMapForBuildStartCall','../performance/constants','dwqhW','./constants.js','QahHC','getTraceFilePaths','config','TESTHUB_BUILD_API','jhsxb','RAGOt','accessibilityOptions','4550274kcUAmS','job_id','toISOString','hvrKX','jwt','../../bin/playwright/reporter/pwUtils.js','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','../../bin/v2/browserstackCLI','status','path','getUserName','buildHashedId','buildStopSent','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','info','Error\x20while\x20waiting\x20for\x20events:\x20','BROWSERSTACK_RERUN','Vkqpt','START','lIdkK','setAccessibilityVariables','QloJV','../performance/performance-tester.js','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','waitForBuildStatus','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','statusText','null','checkAndSetupPercy','STOP','util','QfbuL','getFrameworkDetails','dbyTo','BROWSERSTACK_TEST_ACCESSIBILITY_SCRIPT_TIMEOUT','4047790xYJLuO','setupPercy','getTestOrchestrationBuildStartData','scannerProcessingTimeout','../logger','../test-observability/sessionHandler.js','user_killed','error','tbkxY','basename','hdHPG','getCiInfo','BROWSERSTACK_ACCESSIBILITY','ohgwX','\x20framework','stringify','forEach','isRunning','2564wnZVdI','getInstance','getAccessibilityValueFromYml','526422esScmB','ohhhZ','getCentralUser','debug','includes','ACCESSIBILITY','BENUx','framework','Percy\x20is\x20not\x20supported\x20for\x20','PfBkL','All\x20trace\x20zip\x20send\x20events\x20complete','setTestHubCommonMetaInfo','format','BROWSERSTACK_TESTHUB_UUID','authToken','16WXjNYy'];a134_0x5d6a=function(){return _0x37db42;};return a134_0x5d6a();}module[a134_0x1a0c6c(0x120)]=TestHubHandler;
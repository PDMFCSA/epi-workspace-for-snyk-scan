const a89_0x4565f8=a89_0x3648;function a89_0x3648(_0x3d2d64,_0x526ff8){const _0x21ef34=a89_0x21ef();return a89_0x3648=function(_0x3648aa,_0x4c6896){_0x3648aa=_0x3648aa-0x1d4;let _0x6ae5c5=_0x21ef34[_0x3648aa];return _0x6ae5c5;},a89_0x3648(_0x3d2d64,_0x526ff8);}(function(_0x569a35,_0x1da015){const _0x52ee44=a89_0x3648,_0x2e9aef=_0x569a35();while(!![]){try{const _0xad644d=-parseInt(_0x52ee44(0x1e1))/0x1*(-parseInt(_0x52ee44(0x1fa))/0x2)+parseInt(_0x52ee44(0x1e4))/0x3*(parseInt(_0x52ee44(0x245))/0x4)+-parseInt(_0x52ee44(0x216))/0x5*(-parseInt(_0x52ee44(0x1e3))/0x6)+-parseInt(_0x52ee44(0x1d6))/0x7+-parseInt(_0x52ee44(0x253))/0x8+-parseInt(_0x52ee44(0x201))/0x9+parseInt(_0x52ee44(0x1fb))/0xa*(-parseInt(_0x52ee44(0x227))/0xb);if(_0xad644d===_0x1da015)break;else _0x2e9aef['push'](_0x2e9aef['shift']());}catch(_0x3b21dd){_0x2e9aef['push'](_0x2e9aef['shift']());}}}(a89_0x21ef,0x8b1f6));const bsSetupHelper=require(a89_0x4565f8(0x209)),path=require(a89_0x4565f8(0x21c)),util=require(a89_0x4565f8(0x226)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a89_0x4565f8(0x238)),testhubUtils=require(a89_0x4565f8(0x257)),testHubConstants=require(a89_0x4565f8(0x1ee)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a89_0x4565f8(0x1ea)),logger=require('../logger')[a89_0x4565f8(0x1e7)],SessionHandler=require(a89_0x4565f8(0x214)),PerformanceTester=require(a89_0x4565f8(0x234)),{TESTHUB_EVENTS:PerformanceEvents}=require(a89_0x4565f8(0x1dd)),TestDetails=require(a89_0x4565f8(0x24f)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x396ab6=>{const _0x4da869=a89_0x4565f8;OngoingEvents[_0x4da869(0x239)](_0x396ab6);},awaitAllEvents=async()=>{const _0x4d2a7c=a89_0x4565f8;return Promise[_0x4d2a7c(0x1e5)](OngoingEvents);};class TestHubHandler{static [a89_0x4565f8(0x20e)]=![];static async[a89_0x4565f8(0x1f9)](_0x53f8c1,_0x4b265d){const _0x23a2ea=a89_0x4565f8,_0x3b01bc={'aeeyo':function(_0x256cd6,_0x43b1a8){return _0x256cd6||_0x43b1a8;},'uuKmf':function(_0x21f6e3,_0x51462f){return _0x21f6e3===_0x51462f;},'XtMeq':function(_0x3d3855){return _0x3d3855();},'rMXQw':'EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','AgtkM':_0x23a2ea(0x251),'AQWFe':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','NJEiy':function(_0x1ca1d8,_0x23fabe,_0x484743,_0x17ccba,_0x1fbb7c){return _0x1ca1d8(_0x23fabe,_0x484743,_0x17ccba,_0x1fbb7c);},'xVAVC':_0x23a2ea(0x249)};await PerformanceTester[_0x23a2ea(0x1f3)](PerformanceEvents[_0x23a2ea(0x248)],async()=>{const _0x2aec3a=_0x23a2ea,_0x2569a6=Object['assign']({},_0x4b265d[_0x2aec3a(0x242)],{'root_dir_path':'','framework':_0x4b265d[_0x2aec3a(0x210)]}),_0x355431=bsSetupHelper[_0x2aec3a(0x24a)](_0x2569a6),_0xf6391e=bsSetupHelper[_0x2aec3a(0x243)](_0x2569a6),_0x4a7049=_0x3b01bc[_0x2aec3a(0x223)](_0x355431,'')+':'+_0x3b01bc[_0x2aec3a(0x223)](_0xf6391e,''),_0x4f916d=testhubUtils[_0x2aec3a(0x255)](_0x2569a6);process[_0x2aec3a(0x22e)][_0x2aec3a(0x220)]=JSON['stringify'](_0x4f916d);if(_0x3b01bc['uuKmf'](_0x4a7049,':'))return _0x3b01bc[_0x2aec3a(0x235)](isTestObservabilitySession)&&(logger[_0x2aec3a(0x222)](_0x3b01bc[_0x2aec3a(0x247)]),process[_0x2aec3a(0x22e)][_0x2aec3a(0x1e2)]=_0x3b01bc['AgtkM']),testhubUtils[_0x2aec3a(0x20a)](_0x2569a6)&&logger[_0x2aec3a(0x222)](_0x3b01bc[_0x2aec3a(0x23e)]),[null,null];try{const _0x9d3661=await this[_0x2aec3a(0x21b)](_0x2569a6,_0x53f8c1),_0xec3e28=this[_0x2aec3a(0x232)](_0x355431,_0xf6391e),_0x454e11=await _0x3b01bc[_0x2aec3a(0x1fe)](nodeRequest,_0x3b01bc[_0x2aec3a(0x231)],testHubConstants[_0x2aec3a(0x21a)],_0x9d3661,_0xec3e28);await this[_0x2aec3a(0x1f2)](_0x4b265d,_0x53f8c1);const _0x54ac25=this[_0x2aec3a(0x228)](_0x2569a6,_0x454e11,_0xec3e28);return _0x54ac25;}catch(_0xe4f52a){if(_0x3b01bc[_0x2aec3a(0x22a)](_0xe4f52a[_0x2aec3a(0x237)],![])){testhubUtils['logBuildError'](_0xe4f52a);return;}}})();}static async['processTraceZips'](){const _0xa2f8b3=a89_0x4565f8,_0x227c37={'vtvTq':function(_0x434177,_0x3e4e5a,_0x31336f){return _0x434177(_0x3e4e5a,_0x31336f);},'MiBES':function(_0x4408d3,_0x5e09c6){return _0x4408d3(_0x5e09c6);},'sThCl':function(_0x1f420f){return _0x1f420f();},'wOLZc':_0xa2f8b3(0x254)};if(processedTraceZips)return;const _0x4d8e8f=TestDetails[_0xa2f8b3(0x258)]();_0x4d8e8f[_0xa2f8b3(0x240)](({testUId:_0xa28eb4,filePath:_0x51dbb7})=>{const _0x3beafc=_0xa2f8b3;var _0x56466d=_0x227c37['vtvTq'](uploadTraceZip,_0x51dbb7,_0xa28eb4);_0x227c37[_0x3beafc(0x20c)](addEvent,_0x56466d);});try{await _0x227c37[_0xa2f8b3(0x1ec)](awaitAllEvents),logger[_0xa2f8b3(0x222)](_0x227c37[_0xa2f8b3(0x1ef)]),processedTraceZips=!![];}catch(_0x3fe398){logger[_0xa2f8b3(0x1f7)]('Error\x20while\x20waiting\x20for\x20events:\x20'+util['format'](_0x3fe398));}}static async[a89_0x4565f8(0x1f2)](_0x4a140f,_0xb3e503){const _0x2c5e69=a89_0x4565f8;if(constants[_0x2c5e69(0x224)][_0x2c5e69(0x1fd)](_0xb3e503)){await _0x4a140f['setupPercy']();return;}_0x4a140f[_0x2c5e69(0x242)][_0x2c5e69(0x25a)]&&logger[_0x2c5e69(0x222)]('Percy\x20is\x20not\x20supported\x20for\x20'+_0xb3e503+'\x20framework');}static[a89_0x4565f8(0x236)](_0x203657){const _0x1d8325=a89_0x4565f8,_0xa5ec7f={};_0xa5ec7f[_0x1d8325(0x1e8)]=_0x203657['accessibilityOptions'];const _0x5296c2=_0xa5ec7f;return _0x5296c2;}static[a89_0x4565f8(0x232)](_0x1d90bd,_0x414447){const _0x317bfe=a89_0x4565f8,_0x5c9389={'YqxKe':function(_0x132e3d,_0x12227d){return _0x132e3d(_0x12227d);}},_0x459549={};return _0x459549['username']=_0x1d90bd,_0x459549[_0x317bfe(0x1f0)]=_0x414447,{'auth':_0x459549,'headers':_0x5c9389['YqxKe'](getDefaultHeaders,![])};}static async[a89_0x4565f8(0x21b)](_0x1505d8,_0x2cda66){const _0x21454b=a89_0x4565f8,_0x1b94b8={'eoCAK':function(_0x3dc36a,_0x52950d){return _0x3dc36a(_0x52950d);}},_0x5b97b3={'project_name':_0x1505d8[_0x21454b(0x219)]||'','name':_0x1505d8['buildName']||path[_0x21454b(0x225)](path[_0x21454b(0x1f6)](process[_0x21454b(0x217)]())),'build_identifier':_0x1505d8['buildIdentifier'],'description':_0x1505d8[_0x21454b(0x1f4)]||'','started_at':new Date()[_0x21454b(0x207)](),'tags':_0x1b94b8['eoCAK'](getCustomTags,_0x1505d8),'host_info':bsSetupHelper[_0x21454b(0x205)](),'ci_info':bsSetupHelper[_0x21454b(0x208)](),'build_run_identifier':process['env'][_0x21454b(0x1f5)],'failed_tests_rerun':process['env'][_0x21454b(0x22d)]||![],'version_control':await bsSetupHelper[_0x21454b(0x202)](),'accessibility':this[_0x21454b(0x236)](_0x1505d8),'framework_details':testhubUtils[_0x21454b(0x229)](_0x1505d8,_0x2cda66),'product_map':testhubUtils['getProductMap'](_0x1505d8),'browserstackAutomation':bsSetupHelper[_0x21454b(0x1fc)]()};if(process['env'][_0x21454b(0x24b)]){const _0x38bb33={};_0x38bb33[_0x21454b(0x22f)]=process[_0x21454b(0x22e)][_0x21454b(0x1d7)],_0x38bb33[_0x21454b(0x246)]=process[_0x21454b(0x22e)][_0x21454b(0x215)],_0x5b97b3['central_scanner']=_0x38bb33;}return _0x5b97b3;}static[a89_0x4565f8(0x228)](_0x49cdbf,_0x1dc983,_0x521634){const _0x1a12a8=a89_0x4565f8,_0x436444={'aarUm':function(_0x417f72){return _0x417f72();},'zWvxU':function(_0xccf460,_0x25bd43){return _0xccf460&&_0x25bd43;},'fFmFM':_0x1a12a8(0x256),'nkwyr':_0x1a12a8(0x251),'FltUM':function(_0x1b3931,_0x2175a8){return _0x1b3931&&_0x2175a8;}},_0x449f8b={};if(_0x436444[_0x1a12a8(0x203)](isTestObservabilitySession)){const [_0x2ef985,_0x5d7433,_0x57c713]=testhubUtils['setTestObservabilityVariables'](_0x1dc983[_0x1a12a8(0x23c)],_0x521634[_0x1a12a8(0x206)]);if(_0x436444[_0x1a12a8(0x20b)](_0x2ef985,_0x5d7433)){const _0x1f68e5={};_0x1f68e5[_0x1a12a8(0x1df)]=_0x2ef985,_0x1f68e5[_0x1a12a8(0x24c)]=_0x5d7433,_0x1f68e5[_0x1a12a8(0x1f1)]=_0x57c713,_0x449f8b[testHubConstants['OBSERVABILITY']]=_0x1f68e5,process['env'][_0x1a12a8(0x233)]=_0x436444[_0x1a12a8(0x1d4)];}else _0x449f8b[testHubConstants[_0x1a12a8(0x1de)]]={},process[_0x1a12a8(0x22e)][_0x1a12a8(0x233)]=_0x436444[_0x1a12a8(0x218)];}else process[_0x1a12a8(0x22e)][_0x1a12a8(0x233)]=_0x436444['nkwyr'];if(testhubUtils[_0x1a12a8(0x20a)](_0x49cdbf)){const [_0x117450,_0x18f720]=testhubUtils['setAccessibilityVariables'](_0x1dc983[_0x1a12a8(0x23c)]);if(_0x436444[_0x1a12a8(0x1ff)](_0x117450,_0x18f720)){const _0x581320={};_0x581320[_0x1a12a8(0x204)]=_0x117450,_0x581320[_0x1a12a8(0x24c)]=_0x18f720,_0x449f8b[testHubConstants[_0x1a12a8(0x1eb)]]=_0x581320,process[_0x1a12a8(0x22e)][_0x1a12a8(0x24e)]=_0x436444['fFmFM'];}else _0x449f8b[testHubConstants[_0x1a12a8(0x1eb)]]={},process[_0x1a12a8(0x22e)][_0x1a12a8(0x24e)]=_0x436444[_0x1a12a8(0x218)];}else process[_0x1a12a8(0x22e)][_0x1a12a8(0x24e)]=_0x436444[_0x1a12a8(0x218)];return testhubUtils[_0x1a12a8(0x213)](_0x1dc983[_0x1a12a8(0x23c)]),logger[_0x1a12a8(0x20d)](_0x1a12a8(0x24d)+process['env'][_0x1a12a8(0x22b)]),_0x449f8b;}static async[a89_0x4565f8(0x23b)](_0x21521d){const _0xd0d0c2=a89_0x4565f8,_0x219fc1={'rFfpR':function(_0x1db165,_0x1288ab){return _0x1db165===_0x1288ab;},'XjGus':_0xd0d0c2(0x251),'CWeVA':function(_0x5f04d5,_0x3fe145){return _0x5f04d5===_0x3fe145;},'IYZZt':'null','QLZVo':_0xd0d0c2(0x1d5),'abiJD':'error','rJhTS':_0xd0d0c2(0x200),'dNqNV':_0xd0d0c2(0x20f),'cqNKq':'user_killed','xdctO':function(_0xab113){return _0xab113();},'YnOOa':function(_0x4bf2ff,_0x9d5832,_0x48e06f,_0x2d7f79,_0x5c1320,_0x47c35b){return _0x4bf2ff(_0x9d5832,_0x48e06f,_0x2d7f79,_0x5c1320,_0x47c35b);},'bSgbo':_0xd0d0c2(0x1e0),'uuiXu':_0xd0d0c2(0x21f),'ajxVO':_0xd0d0c2(0x237)};await this[_0xd0d0c2(0x244)](),await PerformanceTester[_0xd0d0c2(0x1f3)](PerformanceEvents[_0xd0d0c2(0x23d)],async()=>{const _0x32467a=_0xd0d0c2;if(_0x219fc1[_0x32467a(0x211)](process[_0x32467a(0x22e)][_0x32467a(0x1e2)],_0x219fc1['XjGus'])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x32467a(0x21d)](process[_0x32467a(0x22e)][testHubConstants[_0x32467a(0x1dc)][_0x32467a(0x22c)]]))return;TestHubHandler[_0x32467a(0x20e)]=!![],await RequestQueueHandler['getInstance']()[_0x32467a(0x259)](),await SessionHandler[_0x32467a(0x1d9)]();if(_0x219fc1[_0x32467a(0x250)](process[_0x32467a(0x22e)][testHubConstants[_0x32467a(0x1dc)][_0x32467a(0x22c)]],_0x219fc1[_0x32467a(0x241)])||_0x219fc1['rFfpR'](process[_0x32467a(0x22e)][testHubConstants[_0x32467a(0x1dc)][_0x32467a(0x22b)]],_0x219fc1[_0x32467a(0x241)])){logger['debug'](_0x219fc1['QLZVo']);const _0x1c4385={};return _0x1c4385[_0x32467a(0x1e9)]=_0x219fc1[_0x32467a(0x221)],_0x1c4385[_0x32467a(0x1ed)]=_0x219fc1['rJhTS'],_0x1c4385;}const _0x41d8c1={'finished_at':new Date()[_0x32467a(0x207)](),'finished_metadata':[]};!!_0x21521d&&_0x41d8c1[_0x219fc1[_0x32467a(0x230)]][_0x32467a(0x1db)]({'reason':_0x219fc1[_0x32467a(0x212)],'signal':_0x21521d,'failure_data':''});const _0x890179={'headers':_0x219fc1['xdctO'](getDefaultHeaders)};try{const _0xb2d8cb=await _0x219fc1['YnOOa'](nodeRequest,_0x219fc1[_0x32467a(0x1e6)],_0x32467a(0x23f)+process[_0x32467a(0x22e)][testHubConstants['ENV_VAR'][_0x32467a(0x22b)]]+'/stop',_0x41d8c1,_0x890179,![]);if(_0xb2d8cb['data']&&_0xb2d8cb[_0x32467a(0x23c)][_0x32467a(0x1f7)]){const _0x1eab29={};_0x1eab29['message']=_0xb2d8cb[_0x32467a(0x23c)][_0x32467a(0x1f7)];throw _0x1eab29;}else{logger[_0x32467a(0x222)](_0x219fc1[_0x32467a(0x1d8)]);const _0x16c32e={};return _0x16c32e[_0x32467a(0x1e9)]=_0x219fc1[_0x32467a(0x23a)],_0x16c32e[_0x32467a(0x1ed)]='',_0x16c32e;}}catch(_0x5e3f88){_0x5e3f88[_0x32467a(0x1f8)]?logger[_0x32467a(0x222)](_0x32467a(0x21e)+_0x5e3f88['response'][_0x32467a(0x1e9)]+'\x20'+_0x5e3f88[_0x32467a(0x1f8)]['statusText']+'\x20'+JSON['stringify'](_0x5e3f88[_0x32467a(0x1f8)][_0x32467a(0x23c)])):logger[_0x32467a(0x222)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x5e3f88[_0x32467a(0x1ed)]||_0x5e3f88));const _0x118d6b={};return _0x118d6b[_0x32467a(0x1e9)]=_0x219fc1[_0x32467a(0x221)],_0x118d6b[_0x32467a(0x1ed)]=_0x5e3f88[_0x32467a(0x1ed)]||_0x5e3f88[_0x32467a(0x1f8)]?_0x5e3f88[_0x32467a(0x1f8)][_0x32467a(0x1e9)]+':'+_0x5e3f88[_0x32467a(0x1f8)][_0x32467a(0x1da)]:_0x5e3f88,_0x118d6b;}})();}}module[a89_0x4565f8(0x252)]=TestHubHandler;function a89_0x21ef(){const _0x370f0e=['56fYIccf','token','rMXQw','START','POST','getUserName','BROWSERSTACK_CENTRAL_USER','buildHashedId','Testhub\x20started\x20with\x20id:\x20','BROWSERSTACK_ACCESSIBILITY','../../bin/playwright/reporter/test-details.js','CWeVA','false','exports','5786680FQezHI','All\x20trace\x20zip\x20send\x20events\x20complete','getProductMap','true','./utils.js','getTraceFilePaths','uploadPending','percy','fFmFM','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','6356665dswluO','BROWSERSTACK_CENTRAL_SCANNER_JOBID','uuiXu','waitForBuildStatus','statusText','push','ENV_VAR','../performance/constants','OBSERVABILITY','jwt','PUT','1ogOxif','BS_TESTOPS_BUILD_COMPLETED','11646NhzuFS','154719ZJIoTl','allSettled','bSgbo','winstonLogger','settings','status','../test-observability/requestQueueHandler.js','ACCESSIBILITY','sThCl','message','./constants.js','wOLZc','password','allowScreenshot','checkAndSetupPercy','measureWrapper','buildDescription','BROWSERSTACK_BUILD_RUN_IDENTIFIER','resolve','error','response','launchBuild','1703588VhYUcK','110hrtszI','isBrowserstackInfra','includes','NJEiy','FltUM','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','2794671omHxZu','getGitMetaData','aarUm','authToken','getHostInfo','auth','toISOString','getCiInfo','../helper','isAccessibilityEnabled','zWvxU','MiBES','info','buildStopSent','finished_metadata','framework','rFfpR','cqNKq','setTestHubCommonMetaInfo','../test-observability/sessionHandler.js','BROWSERSTACK_CENTRAL_SCANNER_JWT','2440DXLYBV','cwd','nkwyr','projectName','TESTHUB_BUILD_API','generateBuildUpstreamData','path','isUndefined','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','stopBuildUpstream\x20event\x20successful!','BROWSERSTACK_PRODUCT_MAP','abiJD','debug','aeeyo','PERCY_SUPPORTED_FRAMEWORKS','basename','util','9229QPfHAe','extractDataFromResponse','getFrameworkDetails','uuKmf','BROWSERSTACK_TESTHUB_UUID','BROWSERSTACK_TESTHUB_JWT','BROWSERSTACK_RERUN','env','job_id','dNqNV','xVAVC','getConfig','BROWSERSTACK_TEST_OBSERVABILITY','../performance/performance-tester.js','XtMeq','getAccessibilityOptions','success','../test-observability/utils','add','ajxVO','stop','data','STOP','AQWFe','api/v1/builds/','forEach','IYZZt','config','getAccessKey','processTraceZips'];a89_0x21ef=function(){return _0x370f0e;};return a89_0x21ef();}
const a126_0x5a53a2=a126_0x5e8f;(function(_0x5ccbd9,_0x46fb49){const _0x10f957=a126_0x5e8f,_0x5f163d=_0x5ccbd9();while(!![]){try{const _0x4f9228=-parseInt(_0x10f957(0x262))/0x1+-parseInt(_0x10f957(0x222))/0x2*(parseInt(_0x10f957(0x229))/0x3)+parseInt(_0x10f957(0x1f0))/0x4*(parseInt(_0x10f957(0x203))/0x5)+-parseInt(_0x10f957(0x1ea))/0x6*(-parseInt(_0x10f957(0x228))/0x7)+parseInt(_0x10f957(0x251))/0x8+parseInt(_0x10f957(0x25b))/0x9+parseInt(_0x10f957(0x269))/0xa;if(_0x4f9228===_0x46fb49)break;else _0x5f163d['push'](_0x5f163d['shift']());}catch(_0x40e411){_0x5f163d['push'](_0x5f163d['shift']());}}}(a126_0xc810,0x21360));const bsSetupHelper=require(a126_0x5a53a2(0x25c)),path=require(a126_0x5a53a2(0x260)),util=require(a126_0x5a53a2(0x20f)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a126_0x5a53a2(0x246)),testhubUtils=require(a126_0x5a53a2(0x1ed)),testHubConstants=require('./constants.js'),constants=require(a126_0x5a53a2(0x22c)),RequestQueueHandler=require(a126_0x5a53a2(0x1f3)),logger=require(a126_0x5a53a2(0x1fd))[a126_0x5a53a2(0x259)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a126_0x5a53a2(0x26b)),{TESTHUB_EVENTS:PerformanceEvents}=require(a126_0x5a53a2(0x21a)),TestDetails=require(a126_0x5a53a2(0x225)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),{isTurboScaleSession}=require(a126_0x5a53a2(0x24c)),BrowserstackCLI=require(a126_0x5a53a2(0x267)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x3877c3=>{OngoingEvents['add'](_0x3877c3);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};function a126_0xc810(){const _0x510d7f=['getAccessibilityOptions','getFrameworkDetails','../helper.js','accessibilityOptions','BROWSERSTACK_TEST_OBSERVABILITY','ravFD','ENV_VAR','234360NeDYNa','setAccessibilityVariables','getTraceFilePaths','nXPFk','nNaiq','setupPercy','setTestHubCommonMetaInfo','success','winstonLogger','accessibility','1049850YAwVcr','../helper','oRvPS','framework','isRunning','path','finished_metadata','244030sgMMYg','bSzDK','basename','response','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','../../bin/v2/browserstackCLI','env','1383940OCMmRN','START','../performance/performance-tester.js','getAccessKey','IJZPR','CfQZw','cmSNH','Percy\x20is\x20not\x20supported\x20for\x20','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','vSHaw','push','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','logBuildError','JLiWg','getProductMapForBuildStartCall','token','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','statusText','info','extractDataFromResponse','BROWSERSTACK_TESTHUB_JWT','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','setTestObservabilityVariables','Oxcjk','DGyDF','uploadPending','status','96414dRfQzU','RvXCt','vYubC','./utils.js','ACCESSIBILITY','tRhpd','8VYeDUA','BROWSERSTACK_PRODUCT_MAP','api/v1/builds/','../test-observability/requestQueueHandler.js','zIduN','mdduV','false','authToken','username','projectName','KWGld','true','PUT','../logger','BROWSERSTACK_BUILD_RUN_IDENTIFIER','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','/stop','rWfMl','All\x20trace\x20zip\x20send\x20events\x20complete','175440JUnpty','central_scanner','message','BROWSERSTACK_CENTRAL_SCANNER_JOBID','getInstance','stop','sgyXk','includes','generateBuildUpstreamData','ipKcN','includeEncodedExtension','boAZm','util','TESTHUB_BUILD_API','job_id','isBrowserstackInfra','Testhub\x20started\x20with\x20id:\x20','error','debug','Error\x20while\x20waiting\x20for\x20events:\x20','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','buildDescription','resolve','../performance/constants','buildStopSent','STOP','buildHashedId','ArcYD','config','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','lcnc','26936vtgtiW','BROWSERSTACK_RERUN','getCiInfo','../../bin/playwright/reporter/test-details.js','BROWSERSTACK_TESTHUB_UUID','SDUcP','105JbJskF','48PpchSc','ASXIx','gJnBX','../../bin/utils/constants.js','checkAndSetupPercy','forEach','assign','settings','BROWSERSTACK_ACCESSIBILITY','auth','UCRCM','percy','isAccessibilityEnabled','buildName','AnKou','jwt','ZswPv','data','toISOString','format','getAccessibilityValueFromYml','HtSkv','getGitMetaData','stopBuildUpstream\x20event\x20successful!','password','BROWSERSTACK_CENTRAL_SCANNER_JWT','processTraceZips','JYWHh','launchBuild','../test-observability/utils','stringify','PERCY_SUPPORTED_FRAMEWORKS','isUndefined'];a126_0xc810=function(){return _0x510d7f;};return a126_0xc810();}function a126_0x5e8f(_0xbff08e,_0x3a3f73){const _0xc810ff=a126_0xc810();return a126_0x5e8f=function(_0x5e8fb3,_0x4182c0){_0x5e8fb3=_0x5e8fb3-0x1ea;let _0x5a4c42=_0xc810ff[_0x5e8fb3];return _0x5a4c42;},a126_0x5e8f(_0xbff08e,_0x3a3f73);}class TestHubHandler{static [a126_0x5a53a2(0x21b)]=![];static async[a126_0x5a53a2(0x245)](_0x43d96b,_0x42c66d){const _0x45c35f=a126_0x5a53a2,_0x5a2287={'oRvPS':function(_0x442edf,_0xa27b10){return _0x442edf||_0xa27b10;},'PiqUF':function(_0x87a892,_0x3c3b07){return _0x87a892||_0x3c3b07;},'AitKF':function(_0x3d2e2d,_0x3ae8fe){return _0x3d2e2d===_0x3ae8fe;},'DGyDF':function(_0x3c5170){return _0x3c5170();},'nXPFk':_0x45c35f(0x279),'Oxcjk':_0x45c35f(0x1f6),'vSHaw':_0x45c35f(0x1ff),'rWfMl':function(_0x1b0ace,_0x37f6b4,_0x15aa8f,_0x5be6c9,_0x1049dd){return _0x1b0ace(_0x37f6b4,_0x15aa8f,_0x5be6c9,_0x1049dd);},'gJnBX':'POST','EzKHJ':'accessibility','CCdqI':_0x45c35f(0x1fb),'boAZm':function(_0x2a690d,_0x1c1c28){return _0x2a690d===_0x1c1c28;}};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x45c35f(0x26a)],async()=>{const _0x24f96c=_0x45c35f,_0x414e05=Object[_0x24f96c(0x22f)]({},_0x42c66d[_0x24f96c(0x21f)],{'root_dir_path':'','framework':_0x42c66d[_0x24f96c(0x25e)]}),_0x3ffef3=bsSetupHelper['getUserName'](_0x414e05),_0x2d745e=bsSetupHelper[_0x24f96c(0x26c)](_0x414e05),_0x5ac23d=_0x5a2287[_0x24f96c(0x25d)](_0x3ffef3,'')+':'+_0x5a2287['PiqUF'](_0x2d745e,''),_0x90b319=testhubUtils['getProductMap'](_0x414e05);process[_0x24f96c(0x268)][_0x24f96c(0x1f1)]=JSON[_0x24f96c(0x247)](_0x90b319);if(_0x5a2287['AitKF'](_0x5ac23d,':'))return _0x5a2287[_0x24f96c(0x281)](isTestObservabilitySession)&&(logger[_0x24f96c(0x215)](_0x5a2287[_0x24f96c(0x254)]),process['env']['BS_TESTOPS_BUILD_COMPLETED']=_0x5a2287[_0x24f96c(0x280)]),testhubUtils[_0x24f96c(0x235)](_0x414e05)&&logger['debug'](_0x5a2287[_0x24f96c(0x272)]),[null,null];try{const _0x58ea5e=await this[_0x24f96c(0x20b)](_0x414e05,_0x43d96b),_0x37b03e=this['getConfig'](_0x3ffef3,_0x2d745e),_0x5e7444=await _0x5a2287[_0x24f96c(0x201)](nodeRequest,_0x5a2287[_0x24f96c(0x22b)],testHubConstants[_0x24f96c(0x210)],_0x58ea5e,_0x37b03e),_0x10b3c5=this[_0x24f96c(0x27c)](_0x414e05,_0x5e7444,_0x37b03e);await this['checkAndSetupPercy'](_0x42c66d,_0x43d96b);if(_0x5a2287['AitKF'](testhubUtils[_0x24f96c(0x23d)](_0x42c66d['config']),null)){const _0x556ba=_0x10b3c5[_0x5a2287['EzKHJ']];_0x556ba&&_0x556ba[_0x24f96c(0x1f7)]&&_0x556ba[_0x24f96c(0x21d)]&&(_0x42c66d[_0x24f96c(0x21f)][_0x24f96c(0x25a)]=!![],process[_0x24f96c(0x268)][_0x24f96c(0x271)]=_0x5a2287['CCdqI']);}return _0x10b3c5;}catch(_0x3adc7b){if(_0x5a2287[_0x24f96c(0x20e)](_0x3adc7b[_0x24f96c(0x258)],![])){testhubUtils[_0x24f96c(0x275)](_0x3adc7b);return;}}})();}static async[a126_0x5a53a2(0x243)](){const _0x44a762=a126_0x5a53a2,_0xef2466={'JYWHh':function(_0x3fa872,_0x2b836e,_0x3b5769){return _0x3fa872(_0x2b836e,_0x3b5769);},'JLiWg':function(_0x1ffeca,_0x1e560b){return _0x1ffeca(_0x1e560b);},'mdduV':function(_0x18be9d){return _0x18be9d();},'NLISZ':_0x44a762(0x202)};if(processedTraceZips)return;const _0x55186c=TestDetails[_0x44a762(0x253)]();_0x55186c[_0x44a762(0x22e)](({testUId:_0x149113,filePath:_0xf6d8ae})=>{const _0x3ca821=_0x44a762;var _0x423ca1=_0xef2466[_0x3ca821(0x244)](uploadTraceZip,_0xf6d8ae,_0x149113);_0xef2466[_0x3ca821(0x276)](addEvent,_0x423ca1);});try{await _0xef2466[_0x44a762(0x1f5)](awaitAllEvents),logger[_0x44a762(0x215)](_0xef2466['NLISZ']),processedTraceZips=!![];}catch(_0x5af35c){logger[_0x44a762(0x214)](_0x44a762(0x216)+util[_0x44a762(0x23c)](_0x5af35c));}}static async[a126_0x5a53a2(0x22d)](_0x48aa38,_0x47cb54){const _0x3f8466=a126_0x5a53a2;if(constants[_0x3f8466(0x248)][_0x3f8466(0x20a)](_0x47cb54)){await _0x48aa38[_0x3f8466(0x256)]();return;}_0x48aa38[_0x3f8466(0x21f)][_0x3f8466(0x234)]&&logger[_0x3f8466(0x215)](_0x3f8466(0x270)+_0x47cb54+'\x20framework');}static[a126_0x5a53a2(0x24a)](_0x4c177d){const _0x420a81=a126_0x5a53a2,_0x2cce86={'ipKcN':function(_0x4a14b9,_0x4e44b2){return _0x4a14b9(_0x4e44b2);},'UCRCM':_0x420a81(0x1fb)};let _0x4551b4;if(_0x4c177d[_0x420a81(0x24d)]){const _0x34c84f={};_0x34c84f[_0x420a81(0x230)]=_0x4c177d['accessibilityOptions'],_0x4551b4=_0x34c84f;}else{const _0x76ee96={};_0x76ee96[_0x420a81(0x230)]={},_0x4551b4=_0x76ee96;}if((!bsSetupHelper['isBrowserstackInfra']()||_0x2cce86[_0x420a81(0x20c)](isTurboScaleSession,_0x4c177d))&&testhubUtils[_0x420a81(0x235)](_0x4c177d)){const _0x56e0fd={};_0x56e0fd[_0x420a81(0x20d)]=_0x2cce86[_0x420a81(0x233)],Object[_0x420a81(0x22f)](_0x4551b4[_0x420a81(0x230)],_0x56e0fd);}return _0x4551b4;}static['getConfig'](_0x5596ca,_0x3a84f4){const _0x81cd86=a126_0x5a53a2,_0x528614={'ASXIx':function(_0x543ff2,_0x4569dd){return _0x543ff2(_0x4569dd);}},_0x4b0b8e={};return _0x4b0b8e[_0x81cd86(0x1f8)]=_0x5596ca,_0x4b0b8e[_0x81cd86(0x241)]=_0x3a84f4,{'auth':_0x4b0b8e,'headers':_0x528614[_0x81cd86(0x22a)](getDefaultHeaders,![])};}static async[a126_0x5a53a2(0x20b)](_0x12fab4,_0xaeec72){const _0x55e242=a126_0x5a53a2,_0x1abaa6={'AnKou':_0x55e242(0x217),'eNMGL':function(_0x17551c,_0x1b8e3d){return _0x17551c(_0x1b8e3d);}};logger[_0x55e242(0x215)](_0x1abaa6[_0x55e242(0x237)]);const _0x5c05ed={'project_name':_0x12fab4[_0x55e242(0x1f9)]||'','name':_0x12fab4[_0x55e242(0x236)]||path[_0x55e242(0x264)](path[_0x55e242(0x219)](process['cwd']())),'build_identifier':_0x12fab4['buildIdentifier'],'description':_0x12fab4[_0x55e242(0x218)]||'','started_at':new Date()[_0x55e242(0x23b)](),'tags':_0x1abaa6['eNMGL'](getCustomTags,_0x12fab4),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x55e242(0x224)](),'build_run_identifier':process['env'][_0x55e242(0x1fe)],'failed_tests_rerun':process[_0x55e242(0x268)][_0x55e242(0x223)]||![],'linked_build_uuid':process[_0x55e242(0x268)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper[_0x55e242(0x23f)](),'accessibility':this[_0x55e242(0x24a)](_0x12fab4),'framework_details':testhubUtils[_0x55e242(0x24b)](_0x12fab4,_0xaeec72),'product_map':testhubUtils[_0x55e242(0x277)](_0x12fab4),'browserstackAutomation':bsSetupHelper[_0x55e242(0x212)](),'grouping_identifier':process[_0x55e242(0x268)][_0x55e242(0x27e)],'test_orchestration':testhubUtils['getTestOrchestrationBuildStartData'](_0x12fab4)};if(bsSetupHelper['getCentralUser']()['central_scanner']||bsSetupHelper['getCentralUser']()[_0x55e242(0x221)]){const _0x59371f={};_0x59371f[_0x55e242(0x211)]=process[_0x55e242(0x268)][_0x55e242(0x206)],_0x59371f[_0x55e242(0x278)]=process[_0x55e242(0x268)][_0x55e242(0x242)],_0x5c05ed[_0x55e242(0x204)]=_0x59371f;}return _0x5c05ed;}static[a126_0x5a53a2(0x27c)](_0x4e4dab,_0x47449c,_0x4ade40){const _0x2e8bc2=a126_0x5a53a2,_0x2b80fe={'ArcYD':function(_0x6ea0){return _0x6ea0();},'vmybX':function(_0x37ab26,_0x813087){return _0x37ab26&&_0x813087;},'sgyXk':_0x2e8bc2(0x1fb),'RvXCt':_0x2e8bc2(0x1f6),'ZswPv':function(_0x19aced,_0x95efc0){return _0x19aced&&_0x95efc0;}},_0x2e1502={};if(_0x2b80fe[_0x2e8bc2(0x21e)](isTestObservabilitySession)){const [_0xea302e,_0x2965a9,_0x886f3f]=testhubUtils[_0x2e8bc2(0x27f)](_0x47449c[_0x2e8bc2(0x23a)],_0x4ade40[_0x2e8bc2(0x232)]);if(_0x2b80fe['vmybX'](_0xea302e,_0x2965a9)){const _0xdde3f={};_0xdde3f[_0x2e8bc2(0x238)]=_0xea302e,_0xdde3f[_0x2e8bc2(0x21d)]=_0x2965a9,_0xdde3f['allowScreenshot']=_0x886f3f,_0x2e1502[testHubConstants['OBSERVABILITY']]=_0xdde3f,process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x2b80fe[_0x2e8bc2(0x209)];}else _0x2e1502[testHubConstants['OBSERVABILITY']]={},process[_0x2e8bc2(0x268)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x2b80fe['RvXCt'];}else process[_0x2e8bc2(0x268)][_0x2e8bc2(0x24e)]=_0x2b80fe[_0x2e8bc2(0x1eb)];const [_0x3198a9,_0x5acc2d]=testhubUtils[_0x2e8bc2(0x252)](_0x47449c[_0x2e8bc2(0x23a)]);if(_0x2b80fe[_0x2e8bc2(0x239)](_0x3198a9,_0x5acc2d)){const _0xa167af={};_0xa167af['authToken']=_0x3198a9,_0xa167af['buildHashedId']=_0x5acc2d,_0x2e1502[testHubConstants[_0x2e8bc2(0x1ee)]]=_0xa167af,process[_0x2e8bc2(0x268)][_0x2e8bc2(0x231)]=_0x2b80fe['sgyXk'];}else _0x2e1502[testHubConstants[_0x2e8bc2(0x1ee)]]={},process['env'][_0x2e8bc2(0x231)]=_0x2b80fe['RvXCt'];return testhubUtils[_0x2e8bc2(0x257)](_0x47449c['data']),logger[_0x2e8bc2(0x27b)](_0x2e8bc2(0x213)+process[_0x2e8bc2(0x268)][_0x2e8bc2(0x226)]),_0x2e1502;}static async[a126_0x5a53a2(0x208)](_0x291559){const _0x5ffbb6=a126_0x5a53a2,_0xdd9649={'ravFD':function(_0xed151f,_0x3a7f5b){return _0xed151f===_0x3a7f5b;},'SDUcP':'false','nNaiq':'null','CfQZw':_0x5ffbb6(0x266),'tRhpd':_0x5ffbb6(0x214),'KWGld':_0x5ffbb6(0x220),'zIduN':_0x5ffbb6(0x261),'bSzDK':'user_killed','HtSkv':function(_0x3857a6){return _0x3857a6();},'IJZPR':function(_0x28093e,_0x2502ab,_0x4572ad,_0x8cd417,_0x50f995,_0x578eb3){return _0x28093e(_0x2502ab,_0x4572ad,_0x8cd417,_0x50f995,_0x578eb3);},'vYubC':_0x5ffbb6(0x1fc),'kYokZ':_0x5ffbb6(0x240),'cmSNH':_0x5ffbb6(0x258)};!BrowserstackCLI[_0x5ffbb6(0x207)]()[_0x5ffbb6(0x25f)]()&&await this[_0x5ffbb6(0x243)](),await PerformanceTester['measureWrapper'](PerformanceEvents[_0x5ffbb6(0x21c)],async()=>{const _0x46aa30=_0x5ffbb6;if(_0xdd9649[_0x46aa30(0x24f)](process['env']['BS_TESTOPS_BUILD_COMPLETED'],_0xdd9649[_0x46aa30(0x227)])||TestHubHandler[_0x46aa30(0x21b)]||bsSetupHelper[_0x46aa30(0x249)](process[_0x46aa30(0x268)][testHubConstants[_0x46aa30(0x250)][_0x46aa30(0x27d)]]))return;TestHubHandler[_0x46aa30(0x21b)]=!![],await RequestQueueHandler[_0x46aa30(0x207)]()[_0x46aa30(0x282)](),await SessionHandler['waitForBuildStatus']();if(_0xdd9649['ravFD'](process[_0x46aa30(0x268)][testHubConstants[_0x46aa30(0x250)]['BROWSERSTACK_TESTHUB_JWT']],_0xdd9649[_0x46aa30(0x255)])||_0xdd9649[_0x46aa30(0x24f)](process['env'][testHubConstants[_0x46aa30(0x250)][_0x46aa30(0x226)]],_0xdd9649['nNaiq'])){logger[_0x46aa30(0x215)](_0xdd9649[_0x46aa30(0x26e)]);const _0x42a00c={};return _0x42a00c['status']=_0xdd9649[_0x46aa30(0x1ef)],_0x42a00c[_0x46aa30(0x205)]=_0xdd9649[_0x46aa30(0x1fa)],_0x42a00c;}const _0x1df029={'finished_at':new Date()[_0x46aa30(0x23b)](),'finished_metadata':[]};!!_0x291559&&_0x1df029[_0xdd9649[_0x46aa30(0x1f4)]][_0x46aa30(0x273)]({'reason':_0xdd9649[_0x46aa30(0x263)],'signal':_0x291559,'failure_data':''});const _0xd37e47={'headers':_0xdd9649[_0x46aa30(0x23e)](getDefaultHeaders)};try{const _0x96e3fb=await _0xdd9649[_0x46aa30(0x26d)](nodeRequest,_0xdd9649[_0x46aa30(0x1ec)],_0x46aa30(0x1f2)+process[_0x46aa30(0x268)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']]+_0x46aa30(0x200),_0x1df029,_0xd37e47,![]);if(_0x96e3fb[_0x46aa30(0x23a)]&&_0x96e3fb[_0x46aa30(0x23a)][_0x46aa30(0x214)]){const _0xe5868c={};_0xe5868c[_0x46aa30(0x205)]=_0x96e3fb['data'][_0x46aa30(0x214)];throw _0xe5868c;}else{logger[_0x46aa30(0x215)](_0xdd9649['kYokZ']);const _0x16b616={};return _0x16b616[_0x46aa30(0x283)]=_0xdd9649[_0x46aa30(0x26f)],_0x16b616[_0x46aa30(0x205)]='',_0x16b616;}}catch(_0x2959a1){_0x2959a1[_0x46aa30(0x265)]?logger['debug']('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x2959a1[_0x46aa30(0x265)][_0x46aa30(0x283)]+'\x20'+_0x2959a1[_0x46aa30(0x265)][_0x46aa30(0x27a)]+'\x20'+JSON[_0x46aa30(0x247)](_0x2959a1['response'][_0x46aa30(0x23a)])):logger['debug'](_0x46aa30(0x274)+(_0x2959a1[_0x46aa30(0x205)]||_0x2959a1));const _0x31a1f5={};return _0x31a1f5[_0x46aa30(0x283)]=_0xdd9649[_0x46aa30(0x1ef)],_0x31a1f5[_0x46aa30(0x205)]=_0x2959a1['message']||_0x2959a1[_0x46aa30(0x265)]?_0x2959a1[_0x46aa30(0x265)][_0x46aa30(0x283)]+':'+_0x2959a1[_0x46aa30(0x265)][_0x46aa30(0x27a)]:_0x2959a1,_0x31a1f5;}})();}}module['exports']=TestHubHandler;
function a134_0x3202(){const _0x56d91f=['EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','BROWSERSTACK_TESTHUB_UUID','checkAndSetupPercy','status','bTVQH','setAccessibilityVariables','BROWSERSTACK_RERUN','success','settings','VnRlf','\x20framework','resolve','false','../performance/performance-tester.js','./utils.js','isBrowserstackInfra','getTestOrchestrationBuildStartData','nhmgO','percy','All\x20trace\x20zip\x20send\x20events\x20complete','framework','includes','xGTMJ','nersp','buildDescription','11064RCesOE','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','waitForBuildStatus','EfkYE','../../bin/utils/constants.js','error','KHiDg','isAccessibilityEnabled','api/v1/builds/','BROWSERSTACK_TEST_ACCESSIBILITY_SCRIPT_TIMEOUT','stopBuildUpstream\x20event\x20successful!','BROWSERSTACK_TEST_OBSERVABILITY','password','central_scanner','7068OHaVZG','accessibility','Percy\x20is\x20not\x20supported\x20for\x20','getProductMapForBuildStartCall','BROWSERSTACK_CENTRAL_SCANNER_JOBID','POST','includeEncodedExtension','stop','BS_TESTOPS_BUILD_COMPLETED','uploadPending','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','4215112bMOnDX','../logger','getCentralUser','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','BROWSERSTACK_ACCESSIBILITY','../test-observability/utils','env','push','getAccessibilityOptions','getConfig','getProductMap','RNmAG','assign','winstonLogger','nWUte','HtfjY','token','null','getCiInfo','ahnGw','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','debug','BROWSERSTACK_CENTRAL_SCANNER_JWT','PERCY_SUPPORTED_FRAMEWORKS','../../bin/playwright/reporter/test-details.js','TESTHUB_BUILD_API','temZg','cwd','eSGNf','980bTWpHU','buildHashedId','mClkV','allowScreenshot','218azWnMQ','username','toISOString','scannerProcessingTimeout','OBSERVABILITY','3101265haRdRc','true','STOP','getFrameworkDetails','response','hXwKc','processTraceZips','azOkE','YTCRz','lHWKV','info','config','lcnc','KcdKS','WWdIF','egwKW','ENV_VAR','rRasr','../../bin/v2/browserstackCLI','message','extractDataFromResponse','buildStopSent','exports','BROWSERSTACK_TESTHUB_JWT','getAccessKey','finished_metadata','Error\x20while\x20waiting\x20for\x20events:\x20','PUT','./constants.js','accessibilityOptions','path','63kRvSfW','generateBuildUpstreamData','BROWSERSTACK_PRODUCT_MAP','setTestObservabilityVariables','mlXSQ','28287760csjCYA','stringify','/stop','setTestHubCommonMetaInfo','../helper.js','dBkDX','346504BPJfFE','basename','BROWSERSTACK_LINKED_BUILD_UUID','BROWSERSTACK_BUILD_RUN_IDENTIFIER','user_killed','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','6424731BIRebq','BdQZk','getAccessibilityValueFromYml','../performance/constants','zpKUs','data'];a134_0x3202=function(){return _0x56d91f;};return a134_0x3202();}const a134_0x50e47b=a134_0x2e1d;function a134_0x2e1d(_0x4fd3b2,_0x503eb3){const _0x3202f2=a134_0x3202();return a134_0x2e1d=function(_0x2e1d58,_0x8a2597){_0x2e1d58=_0x2e1d58-0xa8;let _0x1e8267=_0x3202f2[_0x2e1d58];return _0x1e8267;},a134_0x2e1d(_0x4fd3b2,_0x503eb3);}(function(_0x38a2a8,_0x468f12){const _0x1cdc2c=a134_0x2e1d,_0x4a3feb=_0x38a2a8();while(!![]){try{const _0x4bbd3f=-parseInt(_0x1cdc2c(0xf2))/0x1*(parseInt(_0x1cdc2c(0xc6))/0x2)+-parseInt(_0x1cdc2c(0xf7))/0x3+-parseInt(_0x1cdc2c(0xd1))/0x4+-parseInt(_0x1cdc2c(0xee))/0x5*(-parseInt(_0x1cdc2c(0xb8))/0x6)+parseInt(_0x1cdc2c(0x116))/0x7*(-parseInt(_0x1cdc2c(0x121))/0x8)+parseInt(_0x1cdc2c(0x127))/0x9+parseInt(_0x1cdc2c(0x11b))/0xa;if(_0x4bbd3f===_0x468f12)break;else _0x4a3feb['push'](_0x4a3feb['shift']());}catch(_0x431b5a){_0x4a3feb['push'](_0x4a3feb['shift']());}}}(a134_0x3202,0xa03a9));const bsSetupHelper=require('../helper'),path=require(a134_0x50e47b(0x115)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a134_0x50e47b(0xd6)),testhubUtils=require(a134_0x50e47b(0xad)),testHubConstants=require(a134_0x50e47b(0x113)),constants=require(a134_0x50e47b(0xbc)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a134_0x50e47b(0xd2))[a134_0x50e47b(0xde)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a134_0x50e47b(0xac)),{TESTHUB_EVENTS:PerformanceEvents}=require(a134_0x50e47b(0x12a)),TestDetails=require(a134_0x50e47b(0xe9)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),{isTurboScaleSession}=require(a134_0x50e47b(0x11f)),BrowserstackCLI=require(a134_0x50e47b(0x109)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x501b9e=>{OngoingEvents['add'](_0x501b9e);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async['launchBuild'](_0x33376f,_0x1f5cef){const _0x48b2a6=a134_0x50e47b,_0x894465={'mClkV':function(_0x81c05a,_0x236d97){return _0x81c05a||_0x236d97;},'KHiDg':function(_0x249176,_0x56812d){return _0x249176||_0x56812d;},'HtfjY':function(_0x16c573,_0x3dbd47){return _0x16c573===_0x3dbd47;},'oTFLl':function(_0x51e9cc){return _0x51e9cc();},'xGTMJ':_0x48b2a6(0x12d),'LyMtP':_0x48b2a6(0xab),'nersp':_0x48b2a6(0x126),'hXwKc':function(_0x2fc6e9,_0x482d21,_0xae7eb5,_0x1f17f8,_0x6759d2){return _0x2fc6e9(_0x482d21,_0xae7eb5,_0x1f17f8,_0x6759d2);},'BdQZk':_0x48b2a6(0xcb),'mlXSQ':'accessibility','CuBct':_0x48b2a6(0xf8),'eSGNf':_0x48b2a6(0xf5),'OtYPo':function(_0x1f0986,_0x31ac61){return _0x1f0986===_0x31ac61;}};await PerformanceTester['measureWrapper'](PerformanceEvents['START'],async()=>{const _0x40e193=_0x48b2a6,_0x299168=Object[_0x40e193(0xdd)]({},_0x1f5cef[_0x40e193(0x102)],{'root_dir_path':'','framework':_0x1f5cef[_0x40e193(0xb3)]}),_0xb920f8=bsSetupHelper['getUserName'](_0x299168),_0x548c2a=bsSetupHelper[_0x40e193(0x10f)](_0x299168),_0x5f0242=_0x894465[_0x40e193(0xf0)](_0xb920f8,'')+':'+_0x894465[_0x40e193(0xbe)](_0x548c2a,''),_0xbc38db=testhubUtils[_0x40e193(0xdb)](_0x299168);process[_0x40e193(0xd7)][_0x40e193(0x118)]=JSON[_0x40e193(0x11c)](_0xbc38db);if(_0x894465[_0x40e193(0xe0)](_0x5f0242,':'))return _0x894465['oTFLl'](isTestObservabilitySession)&&(logger[_0x40e193(0xe6)](_0x894465[_0x40e193(0xb5)]),process[_0x40e193(0xd7)][_0x40e193(0xce)]=_0x894465['LyMtP']),testhubUtils['isAccessibilityEnabled'](_0x299168)&&logger[_0x40e193(0xe6)](_0x894465[_0x40e193(0xb6)]),[null,null];try{const _0x19f0dc=await this[_0x40e193(0x117)](_0x299168,_0x33376f),_0x3ef6da=this[_0x40e193(0xda)](_0xb920f8,_0x548c2a),_0x240abd=await _0x894465[_0x40e193(0xfc)](nodeRequest,_0x894465[_0x40e193(0x128)],testHubConstants[_0x40e193(0xea)],_0x19f0dc,_0x3ef6da),_0x51014b=this['extractDataFromResponse'](_0x299168,_0x240abd,_0x3ef6da);await this[_0x40e193(0x12f)](_0x1f5cef,_0x33376f);if(_0x894465[_0x40e193(0xe0)](testhubUtils[_0x40e193(0x129)](_0x1f5cef['config']),null)){const _0x2945a3=_0x51014b[_0x894465[_0x40e193(0x11a)]];_0x2945a3&&_0x2945a3['authToken']&&_0x2945a3[_0x40e193(0xef)]&&(_0x1f5cef[_0x40e193(0x102)][_0x40e193(0xc7)]=!![],process[_0x40e193(0xd7)][_0x40e193(0xd0)]=_0x894465['CuBct']);}return _0x51014b&&_0x51014b[_0x894465['mlXSQ']]&&_0x51014b[_0x894465[_0x40e193(0x11a)]][_0x894465[_0x40e193(0xed)]]&&(process[_0x40e193(0xd7)][_0x40e193(0xc1)]=_0x51014b[_0x894465[_0x40e193(0x11a)]][_0x894465[_0x40e193(0xed)]]),_0x51014b;}catch(_0x5d12bd){if(_0x894465['OtYPo'](_0x5d12bd[_0x40e193(0x134)],![])){testhubUtils['logBuildError'](_0x5d12bd);return;}}})();}static async[a134_0x50e47b(0xfd)](){const _0x320371=a134_0x50e47b,_0x5f53f8={'bEFTy':function(_0xfb6949,_0x2f286d,_0x395e21){return _0xfb6949(_0x2f286d,_0x395e21);},'KcdKS':function(_0x442620,_0x233374){return _0x442620(_0x233374);},'zpKUs':function(_0x4ca253){return _0x4ca253();},'rRasr':_0x320371(0xb2)};if(processedTraceZips)return;const _0x54de82=TestDetails['getTraceFilePaths']();_0x54de82['forEach'](({testUId:_0x259e0f,filePath:_0x3d8ceb})=>{const _0x4e3818=_0x320371;var _0x6a22fb=_0x5f53f8['bEFTy'](uploadTraceZip,_0x3d8ceb,_0x259e0f);_0x5f53f8[_0x4e3818(0x104)](addEvent,_0x6a22fb);});try{await _0x5f53f8[_0x320371(0x12b)](awaitAllEvents),logger[_0x320371(0xe6)](_0x5f53f8[_0x320371(0x108)]),processedTraceZips=!![];}catch(_0x5dc2a8){logger[_0x320371(0xbd)](_0x320371(0x111)+util['format'](_0x5dc2a8));}}static async[a134_0x50e47b(0x12f)](_0x523979,_0x42f330){const _0x2e0f63=a134_0x50e47b;if(constants[_0x2e0f63(0xe8)][_0x2e0f63(0xb4)](_0x42f330)){await _0x523979['setupPercy']();return;}_0x523979['config'][_0x2e0f63(0xb1)]&&logger['debug'](_0x2e0f63(0xc8)+_0x42f330+_0x2e0f63(0xa9));}static[a134_0x50e47b(0xd9)](_0x98a316){const _0x434282=a134_0x50e47b,_0x5359d3={'KvPsF':function(_0x3200ec,_0x5b3efc){return _0x3200ec(_0x5b3efc);},'dBkDX':_0x434282(0xf8)};let _0x117ee6;if(_0x98a316[_0x434282(0x114)]){const _0x5b9172={};_0x5b9172[_0x434282(0x135)]=_0x98a316[_0x434282(0x114)],_0x117ee6=_0x5b9172;}else{const _0x407355={};_0x407355['settings']={},_0x117ee6=_0x407355;}if((!bsSetupHelper[_0x434282(0xae)]()||_0x5359d3['KvPsF'](isTurboScaleSession,_0x98a316))&&testhubUtils[_0x434282(0xbf)](_0x98a316)){const _0x261d09={};_0x261d09[_0x434282(0xcc)]=_0x5359d3[_0x434282(0x120)],Object[_0x434282(0xdd)](_0x117ee6[_0x434282(0x135)],_0x261d09);}return _0x117ee6;}static[a134_0x50e47b(0xda)](_0x417e00,_0x5541e6){const _0x129db3=a134_0x50e47b,_0x2bd626={'EfkYE':function(_0x5d9141,_0x120ac1){return _0x5d9141(_0x120ac1);}},_0x569815={};return _0x569815[_0x129db3(0xf3)]=_0x417e00,_0x569815[_0x129db3(0xc4)]=_0x5541e6,{'auth':_0x569815,'headers':_0x2bd626[_0x129db3(0xbb)](getDefaultHeaders,![])};}static async[a134_0x50e47b(0x117)](_0x102f22,_0xfe3bc){const _0x213222=a134_0x50e47b,_0x2fb883={'xnSpG':_0x213222(0xb9),'RNmAG':function(_0x3e027d,_0x437caf){return _0x3e027d(_0x437caf);}};logger[_0x213222(0xe6)](_0x2fb883['xnSpG']);const _0xfcd57d={'project_name':_0x102f22['projectName']||'','name':_0x102f22['buildName']||path[_0x213222(0x122)](path[_0x213222(0xaa)](process[_0x213222(0xec)]())),'build_identifier':_0x102f22['buildIdentifier'],'description':_0x102f22[_0x213222(0xb7)]||'','started_at':new Date()[_0x213222(0xf4)](),'tags':_0x2fb883[_0x213222(0xdc)](getCustomTags,_0x102f22),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x213222(0xe3)](),'build_run_identifier':process[_0x213222(0xd7)][_0x213222(0x124)],'failed_tests_rerun':process[_0x213222(0xd7)][_0x213222(0x133)]||![],'linked_build_uuid':process[_0x213222(0xd7)][_0x213222(0x123)]||'','version_control':await bsSetupHelper['getGitMetaData'](),'accessibility':this[_0x213222(0xd9)](_0x102f22),'framework_details':testhubUtils[_0x213222(0xfa)](_0x102f22,_0xfe3bc),'product_map':testhubUtils[_0x213222(0xc9)](_0x102f22),'browserstackAutomation':bsSetupHelper[_0x213222(0xae)](),'grouping_identifier':process[_0x213222(0xd7)][_0x213222(0xd4)],'test_orchestration':testhubUtils[_0x213222(0xaf)](_0x102f22)};if(bsSetupHelper['getCentralUser']()[_0x213222(0xc5)]||bsSetupHelper[_0x213222(0xd3)]()[_0x213222(0x103)]){const _0x3dc3c9={};_0x3dc3c9['job_id']=process[_0x213222(0xd7)][_0x213222(0xca)],_0x3dc3c9[_0x213222(0xe1)]=process['env'][_0x213222(0xe7)],_0xfcd57d[_0x213222(0xc5)]=_0x3dc3c9;}return _0xfcd57d;}static[a134_0x50e47b(0x10b)](_0x2f9e53,_0x5456d4,_0x5a408b){const _0x44cda3=a134_0x50e47b,_0x3610ab={'JJYtO':function(_0x2ebe15){return _0x2ebe15();},'temZg':function(_0x1049a9,_0x2a0f7f){return _0x1049a9&&_0x2a0f7f;},'QVSOo':_0x44cda3(0xf8),'WWdIF':_0x44cda3(0xab)},_0x1944cb={};if(_0x3610ab['JJYtO'](isTestObservabilitySession)){const [_0x4fa655,_0x2bb50f,_0x3209d7]=testhubUtils[_0x44cda3(0x119)](_0x5456d4[_0x44cda3(0x12c)],_0x5a408b['auth']);if(_0x3610ab[_0x44cda3(0xeb)](_0x4fa655,_0x2bb50f)){const _0x515412={};_0x515412['jwt']=_0x4fa655,_0x515412[_0x44cda3(0xef)]=_0x2bb50f,_0x515412[_0x44cda3(0xf1)]=_0x3209d7,_0x1944cb[testHubConstants[_0x44cda3(0xf6)]]=_0x515412,process[_0x44cda3(0xd7)][_0x44cda3(0xc3)]=_0x3610ab['QVSOo'];}else _0x1944cb[testHubConstants[_0x44cda3(0xf6)]]={},process[_0x44cda3(0xd7)][_0x44cda3(0xc3)]=_0x3610ab[_0x44cda3(0x105)];}else process[_0x44cda3(0xd7)][_0x44cda3(0xc3)]=_0x3610ab['WWdIF'];const [_0x5036e2,_0x18888b,_0x2e6ae4]=testhubUtils[_0x44cda3(0x132)](_0x5456d4[_0x44cda3(0x12c)]);if(_0x3610ab[_0x44cda3(0xeb)](_0x5036e2,_0x18888b)){const _0x38f680={};_0x38f680['authToken']=_0x5036e2,_0x38f680[_0x44cda3(0xef)]=_0x18888b,_0x38f680['scannerProcessingTimeout']=_0x2e6ae4,_0x1944cb[testHubConstants['ACCESSIBILITY']]=_0x38f680,process['env'][_0x44cda3(0xd5)]=_0x3610ab['QVSOo'];}else _0x1944cb[testHubConstants['ACCESSIBILITY']]={},process['env'][_0x44cda3(0xd5)]=_0x3610ab[_0x44cda3(0x105)];return testhubUtils[_0x44cda3(0x11e)](_0x5456d4[_0x44cda3(0x12c)]),logger[_0x44cda3(0x101)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x44cda3(0xd7)][_0x44cda3(0x12e)]),_0x1944cb;}static async[a134_0x50e47b(0xcd)](_0x1f2d09){const _0x5555d3=a134_0x50e47b,_0x44bf9f={'azOkE':function(_0x117d09,_0x9e35e1){return _0x117d09===_0x9e35e1;},'ahnGw':_0x5555d3(0xab),'nhmgO':_0x5555d3(0xe2),'rdgxT':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','egwKW':'error','pCwEh':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','TYrjP':_0x5555d3(0x110),'bTVQH':_0x5555d3(0x125),'lHWKV':function(_0x15ef64){return _0x15ef64();},'VnRlf':function(_0x25afc3,_0x53fbf3,_0x526bd9,_0x46a90a,_0x523155,_0x1b9aae){return _0x25afc3(_0x53fbf3,_0x526bd9,_0x46a90a,_0x523155,_0x1b9aae);},'YTCRz':_0x5555d3(0x112),'nWUte':_0x5555d3(0xc2),'iGeDh':'success'};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x5555d3(0xf9)],async()=>{const _0x4093a8=_0x5555d3;if(_0x44bf9f['azOkE'](process['env'][_0x4093a8(0xce)],_0x44bf9f[_0x4093a8(0xe4)])||TestHubHandler[_0x4093a8(0x10c)]||bsSetupHelper['isUndefined'](process[_0x4093a8(0xd7)][testHubConstants[_0x4093a8(0x107)][_0x4093a8(0x10e)]]))return;TestHubHandler[_0x4093a8(0x10c)]=!![];if(BrowserstackCLI['getInstance']()['isRunning']())return;await this[_0x4093a8(0xfd)](),await RequestQueueHandler['getInstance']()[_0x4093a8(0xcf)](),await SessionHandler[_0x4093a8(0xba)]();if(_0x44bf9f['azOkE'](process['env'][testHubConstants[_0x4093a8(0x107)][_0x4093a8(0x10e)]],_0x44bf9f['nhmgO'])||_0x44bf9f[_0x4093a8(0xfe)](process['env'][testHubConstants[_0x4093a8(0x107)][_0x4093a8(0x12e)]],_0x44bf9f[_0x4093a8(0xb0)])){logger['debug'](_0x44bf9f['rdgxT']);const _0x5c9f97={};return _0x5c9f97[_0x4093a8(0x130)]=_0x44bf9f[_0x4093a8(0x106)],_0x5c9f97[_0x4093a8(0x10a)]=_0x44bf9f['pCwEh'],_0x5c9f97;}const _0x4dd83a={'finished_at':new Date()[_0x4093a8(0xf4)](),'finished_metadata':[]};!!_0x1f2d09&&_0x4dd83a[_0x44bf9f['TYrjP']][_0x4093a8(0xd8)]({'reason':_0x44bf9f[_0x4093a8(0x131)],'signal':_0x1f2d09,'failure_data':''});const _0x220cfc={'headers':_0x44bf9f[_0x4093a8(0x100)](getDefaultHeaders)};try{const _0x2ee96f=await _0x44bf9f[_0x4093a8(0xa8)](nodeRequest,_0x44bf9f[_0x4093a8(0xff)],_0x4093a8(0xc0)+process[_0x4093a8(0xd7)][testHubConstants[_0x4093a8(0x107)]['BROWSERSTACK_TESTHUB_UUID']]+_0x4093a8(0x11d),_0x4dd83a,_0x220cfc,![]);if(_0x2ee96f[_0x4093a8(0x12c)]&&_0x2ee96f[_0x4093a8(0x12c)][_0x4093a8(0xbd)]){const _0x2c5861={};_0x2c5861['message']=_0x2ee96f[_0x4093a8(0x12c)][_0x4093a8(0xbd)];throw _0x2c5861;}else{logger['debug'](_0x44bf9f[_0x4093a8(0xdf)]);const _0x336c85={};return _0x336c85[_0x4093a8(0x130)]=_0x44bf9f['iGeDh'],_0x336c85[_0x4093a8(0x10a)]='',_0x336c85;}}catch(_0x3e7915){_0x3e7915[_0x4093a8(0xfb)]?logger[_0x4093a8(0xe6)](_0x4093a8(0xe5)+_0x3e7915[_0x4093a8(0xfb)]['status']+'\x20'+_0x3e7915[_0x4093a8(0xfb)]['statusText']+'\x20'+JSON[_0x4093a8(0x11c)](_0x3e7915['response'][_0x4093a8(0x12c)])):logger[_0x4093a8(0xe6)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x3e7915['message']||_0x3e7915));const _0x67fe76={};return _0x67fe76[_0x4093a8(0x130)]=_0x44bf9f[_0x4093a8(0x106)],_0x67fe76['message']=_0x3e7915[_0x4093a8(0x10a)]||_0x3e7915[_0x4093a8(0xfb)]?_0x3e7915[_0x4093a8(0xfb)][_0x4093a8(0x130)]+':'+_0x3e7915['response']['statusText']:_0x3e7915,_0x67fe76;}})();}}module[a134_0x50e47b(0x10d)]=TestHubHandler;
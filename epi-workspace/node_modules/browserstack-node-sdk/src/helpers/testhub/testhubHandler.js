const a90_0x153329=a90_0x2963;(function(_0x102e39,_0x28b399){const _0x381afb=a90_0x2963,_0x3a577d=_0x102e39();while(!![]){try{const _0x1f0c29=-parseInt(_0x381afb(0xa6))/0x1+-parseInt(_0x381afb(0xb6))/0x2+parseInt(_0x381afb(0xe8))/0x3+parseInt(_0x381afb(0xd4))/0x4+-parseInt(_0x381afb(0x96))/0x5+-parseInt(_0x381afb(0xe2))/0x6+parseInt(_0x381afb(0x101))/0x7;if(_0x1f0c29===_0x28b399)break;else _0x3a577d['push'](_0x3a577d['shift']());}catch(_0x4301ac){_0x3a577d['push'](_0x3a577d['shift']());}}}(a90_0x3353,0x2f303));const bsSetupHelper=require(a90_0x153329(0x118)),path=require(a90_0x153329(0xd6)),util=require(a90_0x153329(0xd9)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require('./utils.js'),testHubConstants=require(a90_0x153329(0xe9)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a90_0x153329(0xed))[a90_0x153329(0xbd)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a90_0x153329(0xf3)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a90_0x153329(0xc0)),{uploadTraceZip}=require(a90_0x153329(0x102)),OngoingEvents=new Set();let processedTraceZips=![];function a90_0x3353(){const _0x3bb036=['START','uRYrc','buildName','user_killed','170205iDNwzt','./constants.js','isBrowserstackInfra','env','generateBuildUpstreamData','../logger','POST','framework','TESTHUB_BUILD_API','EmoKM','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','../performance/performance-tester.js','nmNWx','stop','isUndefined','iXOQh','Percy\x20is\x20not\x20supported\x20for\x20','mHhnH','stringify','central_scanner','getAccessibilityOptions','getProductMap','DCXtq','JOVHO','BROWSERSTACK_ACCESSIBILITY','4608345qsxniR','../../bin/playwright/reporter/pwUtils.js','uploadPending','resolve','BROWSERSTACK_BUILD_RUN_IDENTIFIER','projectName','mSFuy','zACnb','authToken','getUserName','success','logBuildError','aClIG','rIIDb','PERCY_SUPPORTED_FRAMEWORKS','aqfTy','STOP','JBlBB','PYWTl','basename','finished_metadata','BROWSERSTACK_TESTHUB_UUID','BROWSERSTACK_TESTHUB_JWT','../helper','ACCESSIBILITY','1390430bASIib','accessibilityOptions','statusText','rEOEA','ZbIvH','DdOee','kUmii','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','setupPercy','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','status','ryiDD','getCentralUser','ZCLFn','222160fDNpGl','false','BS_TESTOPS_BUILD_COMPLETED','buildHashedId','auth','format','JkJsH','response','debug','BROWSERSTACK_TEST_OBSERVABILITY','VDMhw','checkAndSetupPercy','waitForBuildStatus','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','Error\x20while\x20waiting\x20for\x20events:\x20','All\x20trace\x20zip\x20send\x20events\x20complete','595410PfzrFv','stopBuildUpstream\x20event\x20successful!','MMDKo','includes','token','buildIdentifier','allSettled','winstonLogger','/stop','username','../../bin/playwright/reporter/test-details.js','qztNB','config','ENV_VAR','PUT','hLqzJ','measureWrapper','percy','jwt','message','getConfig','getAccessKey','toISOString','qRnEG','Xnfrt','getTraceFilePaths','alZpN','push','null','settings','1300524DLutPE','getFrameworkDetails','path','processTraceZips','AAdPo','util','exports','Testhub\x20started\x20with\x20id:\x20','data','buildStopSent','add','setAccessibilityVariables','extractDataFromResponse','error','293802IzOifL','setTestObservabilityVariables'];a90_0x3353=function(){return _0x3bb036;};return a90_0x3353();}const addEvent=_0x440427=>{const _0x208804=a90_0x153329;OngoingEvents[_0x208804(0xde)](_0x440427);},awaitAllEvents=async()=>{const _0x205554=a90_0x153329;return Promise[_0x205554(0xbc)](OngoingEvents);};class TestHubHandler{static [a90_0x153329(0xdd)]=![];static async['launchBuild'](_0x3cf11f,_0x474440){const _0x3ac283=a90_0x153329,_0x5a59fd={'mHhnH':function(_0x55c81e,_0x3b5aaf){return _0x55c81e||_0x3b5aaf;},'ZbIvH':function(_0x409828,_0x1f1992){return _0x409828||_0x1f1992;},'HLUub':function(_0x5a1408,_0x48bd81){return _0x5a1408===_0x48bd81;},'zACnb':function(_0x52e422){return _0x52e422();},'Xnfrt':_0x3ac283(0xf2),'JkJsH':_0x3ac283(0xa7),'alZpN':_0x3ac283(0xb3),'AAdPo':function(_0x411801,_0x55cbff,_0x1c57b9,_0x255b3c,_0x2b38db){return _0x411801(_0x55cbff,_0x1c57b9,_0x255b3c,_0x2b38db);},'aqfTy':_0x3ac283(0xee),'DCXtq':function(_0x567e44,_0x4fbf41){return _0x567e44===_0x4fbf41;}};await PerformanceTester[_0x3ac283(0xc6)](PerformanceEvents[_0x3ac283(0xe4)],async()=>{const _0x2bf25b=_0x3ac283,_0x47b6cf=Object['assign']({},_0x474440[_0x2bf25b(0xc2)],{'root_dir_path':'','framework':_0x474440[_0x2bf25b(0xef)]}),_0x3ff985=bsSetupHelper[_0x2bf25b(0x10a)](_0x47b6cf),_0x4d84c9=bsSetupHelper[_0x2bf25b(0xcb)](_0x47b6cf),_0x18da43=_0x5a59fd[_0x2bf25b(0xf9)](_0x3ff985,'')+':'+_0x5a59fd[_0x2bf25b(0x9a)](_0x4d84c9,''),_0x5637fc=testhubUtils[_0x2bf25b(0xfd)](_0x47b6cf);process[_0x2bf25b(0xeb)]['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x2bf25b(0xfa)](_0x5637fc);if(_0x5a59fd['HLUub'](_0x18da43,':'))return _0x5a59fd[_0x2bf25b(0x108)](isTestObservabilitySession)&&(logger[_0x2bf25b(0xae)](_0x5a59fd[_0x2bf25b(0xce)]),process['env']['BS_TESTOPS_BUILD_COMPLETED']=_0x5a59fd[_0x2bf25b(0xac)]),testhubUtils['isAccessibilityEnabled'](_0x47b6cf)&&logger['debug'](_0x5a59fd[_0x2bf25b(0xd0)]),[null,null];try{const _0x40d655=await this[_0x2bf25b(0xec)](_0x47b6cf,_0x3cf11f),_0x56797a=this[_0x2bf25b(0xca)](_0x3ff985,_0x4d84c9),_0xf3338a=await _0x5a59fd[_0x2bf25b(0xd8)](nodeRequest,_0x5a59fd[_0x2bf25b(0x110)],testHubConstants[_0x2bf25b(0xf0)],_0x40d655,_0x56797a),_0x24efa8=this['extractDataFromResponse'](_0x47b6cf,_0xf3338a,_0x56797a);return await this[_0x2bf25b(0xb1)](_0x474440,_0x3cf11f),_0x24efa8;}catch(_0x3f8c69){if(_0x5a59fd[_0x2bf25b(0xfe)](_0x3f8c69[_0x2bf25b(0x10b)],![])){testhubUtils[_0x2bf25b(0x10c)](_0x3f8c69);return;}}})();}static async[a90_0x153329(0xd7)](){const _0x2db1b2=a90_0x153329,_0x1aaa20={'aRVGK':function(_0x15f598,_0x50f64f,_0x1b2d3d){return _0x15f598(_0x50f64f,_0x1b2d3d);},'qRnEG':function(_0x43b7cc,_0x43c4a0){return _0x43b7cc(_0x43c4a0);},'rIIDb':function(_0x2dcdb3){return _0x2dcdb3();},'tlceA':_0x2db1b2(0xb5)};if(processedTraceZips)return;const _0x4e4574=TestDetails[_0x2db1b2(0xcf)]();_0x4e4574['forEach'](({testUId:_0x7b995b,filePath:_0x203a53})=>{const _0x5a7a17=_0x2db1b2;var _0x2319f8=_0x1aaa20['aRVGK'](uploadTraceZip,_0x203a53,_0x7b995b);_0x1aaa20[_0x5a7a17(0xcd)](addEvent,_0x2319f8);});try{await _0x1aaa20[_0x2db1b2(0x10e)](awaitAllEvents),logger['debug'](_0x1aaa20['tlceA']),processedTraceZips=!![];}catch(_0x281d88){logger['error'](_0x2db1b2(0xb4)+util[_0x2db1b2(0xab)](_0x281d88));}}static async[a90_0x153329(0xb1)](_0x535537,_0x46730b){const _0xf8479=a90_0x153329;if(constants[_0xf8479(0x10f)][_0xf8479(0xb9)](_0x46730b)){await _0x535537[_0xf8479(0xa0)]();return;}_0x535537[_0xf8479(0xc2)][_0xf8479(0xc7)]&&logger[_0xf8479(0xae)](_0xf8479(0xf8)+_0x46730b+'\x20framework');}static[a90_0x153329(0xfc)](_0xe51a6d){const _0x5d3dd9=a90_0x153329,_0x169dd1={};_0x169dd1[_0x5d3dd9(0xd3)]=_0xe51a6d[_0x5d3dd9(0x97)];const _0x316e98=_0x169dd1;return _0x316e98;}static[a90_0x153329(0xca)](_0x25a42f,_0x425221){const _0x198588=a90_0x153329,_0x343317={'ZCLFn':function(_0xc03927,_0x334933){return _0xc03927(_0x334933);}},_0x2a7929={};return _0x2a7929[_0x198588(0xbf)]=_0x25a42f,_0x2a7929['password']=_0x425221,{'auth':_0x2a7929,'headers':_0x343317[_0x198588(0xa5)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x14b787,_0x5200cb){const _0x1288fe=a90_0x153329,_0x1841a3={'kUmii':function(_0x56af5b,_0x18a71a){return _0x56af5b(_0x18a71a);}},_0x49588d={'project_name':_0x14b787[_0x1288fe(0x106)]||'','name':_0x14b787[_0x1288fe(0xe6)]||path[_0x1288fe(0x114)](path[_0x1288fe(0x104)](process['cwd']())),'build_identifier':_0x14b787[_0x1288fe(0xbb)],'description':_0x14b787['buildDescription']||'','started_at':new Date()[_0x1288fe(0xcc)](),'tags':_0x1841a3[_0x1288fe(0x9c)](getCustomTags,_0x14b787),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process[_0x1288fe(0xeb)][_0x1288fe(0x105)],'failed_tests_rerun':process[_0x1288fe(0xeb)]['BROWSERSTACK_RERUN']||![],'version_control':await bsSetupHelper['getGitMetaData'](),'accessibility':this[_0x1288fe(0xfc)](_0x14b787),'framework_details':testhubUtils[_0x1288fe(0xd5)](_0x14b787,_0x5200cb),'product_map':testhubUtils['getProductMap'](_0x14b787),'browserstackAutomation':bsSetupHelper[_0x1288fe(0xea)](),'grouping_identifier':process[_0x1288fe(0xeb)][_0x1288fe(0x9f)]};if(bsSetupHelper[_0x1288fe(0xa4)]()['central_scanner']||bsSetupHelper['getCentralUser']()['lcnc']){const _0x444836={};_0x444836['job_id']=process['env']['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0x444836[_0x1288fe(0xba)]=process[_0x1288fe(0xeb)]['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x49588d[_0x1288fe(0xfb)]=_0x444836;}return _0x49588d;}static[a90_0x153329(0xe0)](_0x53900d,_0x325c3e,_0x3f55d2){const _0x1063a1=a90_0x153329,_0x2d49ff={'NmuJn':function(_0x53d88b){return _0x53d88b();},'hLqzJ':function(_0x1e48fe,_0x8f8d3c){return _0x1e48fe&&_0x8f8d3c;},'JBlBB':'true','JOVHO':_0x1063a1(0xa7),'rEOEA':function(_0x2e5807,_0x42ac68){return _0x2e5807&&_0x42ac68;}},_0x582d7a={};if(_0x2d49ff['NmuJn'](isTestObservabilitySession)){const [_0x44325d,_0xc4bc67,_0x38e908]=testhubUtils[_0x1063a1(0xe3)](_0x325c3e[_0x1063a1(0xdc)],_0x3f55d2[_0x1063a1(0xaa)]);if(_0x2d49ff[_0x1063a1(0xc5)](_0x44325d,_0xc4bc67)){const _0x2c4376={};_0x2c4376[_0x1063a1(0xc8)]=_0x44325d,_0x2c4376[_0x1063a1(0xa9)]=_0xc4bc67,_0x2c4376['allowScreenshot']=_0x38e908,_0x582d7a[testHubConstants['OBSERVABILITY']]=_0x2c4376,process['env'][_0x1063a1(0xaf)]=_0x2d49ff[_0x1063a1(0x112)];}else _0x582d7a[testHubConstants['OBSERVABILITY']]={},process[_0x1063a1(0xeb)][_0x1063a1(0xaf)]=_0x2d49ff[_0x1063a1(0xff)];}else process[_0x1063a1(0xeb)][_0x1063a1(0xaf)]=_0x2d49ff[_0x1063a1(0xff)];if(testhubUtils['isAccessibilityEnabled'](_0x53900d)){const [_0x178c73,_0x40d618]=testhubUtils[_0x1063a1(0xdf)](_0x325c3e[_0x1063a1(0xdc)]);if(_0x2d49ff[_0x1063a1(0x99)](_0x178c73,_0x40d618)){const _0x3e3bab={};_0x3e3bab[_0x1063a1(0x109)]=_0x178c73,_0x3e3bab['buildHashedId']=_0x40d618,_0x582d7a[testHubConstants[_0x1063a1(0x119)]]=_0x3e3bab,process[_0x1063a1(0xeb)][_0x1063a1(0x100)]=_0x2d49ff[_0x1063a1(0x112)];}else _0x582d7a[testHubConstants[_0x1063a1(0x119)]]={},process['env'][_0x1063a1(0x100)]=_0x2d49ff[_0x1063a1(0xff)];}else process[_0x1063a1(0xeb)][_0x1063a1(0x100)]=_0x2d49ff[_0x1063a1(0xff)];return testhubUtils['setTestHubCommonMetaInfo'](_0x325c3e[_0x1063a1(0xdc)]),logger['info'](_0x1063a1(0xdb)+process['env'][_0x1063a1(0x116)]),_0x582d7a;}static async[a90_0x153329(0xf5)](_0x4edf22){const _0x1feb46=a90_0x153329,_0x4d06f5={'DdOee':function(_0x15d6f2,_0x5d7548){return _0x15d6f2===_0x5d7548;},'KUGsr':_0x1feb46(0xa7),'mSFuy':_0x1feb46(0xd2),'qztNB':function(_0x47931f,_0x59bd08){return _0x47931f===_0x59bd08;},'uRYrc':_0x1feb46(0x9d),'EmoKM':'error','MMDKo':_0x1feb46(0x9e),'VDMhw':_0x1feb46(0x115),'xLoaH':_0x1feb46(0xe7),'PYWTl':function(_0x33261b){return _0x33261b();},'aClIG':function(_0x418f65,_0x4c40af,_0x143236,_0x49171e,_0x36e50d,_0x58ddfa){return _0x418f65(_0x4c40af,_0x143236,_0x49171e,_0x36e50d,_0x58ddfa);},'iXOQh':_0x1feb46(0xc4),'ryiDD':_0x1feb46(0xb7),'nmNWx':_0x1feb46(0x10b)};await this['processTraceZips'](),await PerformanceTester[_0x1feb46(0xc6)](PerformanceEvents[_0x1feb46(0x111)],async()=>{const _0x53627b=_0x1feb46;if(_0x4d06f5[_0x53627b(0x9b)](process['env'][_0x53627b(0xa8)],_0x4d06f5['KUGsr'])||TestHubHandler[_0x53627b(0xdd)]||bsSetupHelper[_0x53627b(0xf6)](process[_0x53627b(0xeb)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_JWT']]))return;TestHubHandler[_0x53627b(0xdd)]=!![],await RequestQueueHandler['getInstance']()[_0x53627b(0x103)](),await SessionHandler[_0x53627b(0xb2)]();if(_0x4d06f5[_0x53627b(0x9b)](process[_0x53627b(0xeb)][testHubConstants[_0x53627b(0xc3)][_0x53627b(0x117)]],_0x4d06f5['mSFuy'])||_0x4d06f5[_0x53627b(0xc1)](process[_0x53627b(0xeb)][testHubConstants[_0x53627b(0xc3)][_0x53627b(0x116)]],_0x4d06f5[_0x53627b(0x107)])){logger['debug'](_0x4d06f5[_0x53627b(0xe5)]);const _0x56bdf={};return _0x56bdf[_0x53627b(0xa2)]=_0x4d06f5[_0x53627b(0xf1)],_0x56bdf[_0x53627b(0xc9)]=_0x4d06f5[_0x53627b(0xb8)],_0x56bdf;}const _0x131c97={'finished_at':new Date()[_0x53627b(0xcc)](),'finished_metadata':[]};!!_0x4edf22&&_0x131c97[_0x4d06f5[_0x53627b(0xb0)]][_0x53627b(0xd1)]({'reason':_0x4d06f5['xLoaH'],'signal':_0x4edf22,'failure_data':''});const _0x43cbe7={'headers':_0x4d06f5[_0x53627b(0x113)](getDefaultHeaders)};try{const _0x4b0ead=await _0x4d06f5[_0x53627b(0x10d)](nodeRequest,_0x4d06f5[_0x53627b(0xf7)],'api/v1/builds/'+process['env'][testHubConstants[_0x53627b(0xc3)][_0x53627b(0x116)]]+_0x53627b(0xbe),_0x131c97,_0x43cbe7,![]);if(_0x4b0ead[_0x53627b(0xdc)]&&_0x4b0ead[_0x53627b(0xdc)][_0x53627b(0xe1)]){const _0xafd05={};_0xafd05[_0x53627b(0xc9)]=_0x4b0ead[_0x53627b(0xdc)]['error'];throw _0xafd05;}else{logger['debug'](_0x4d06f5[_0x53627b(0xa3)]);const _0x264407={};return _0x264407[_0x53627b(0xa2)]=_0x4d06f5[_0x53627b(0xf4)],_0x264407[_0x53627b(0xc9)]='',_0x264407;}}catch(_0x2692b1){_0x2692b1['response']?logger[_0x53627b(0xae)](_0x53627b(0xa1)+_0x2692b1[_0x53627b(0xad)][_0x53627b(0xa2)]+'\x20'+_0x2692b1[_0x53627b(0xad)][_0x53627b(0x98)]+'\x20'+JSON[_0x53627b(0xfa)](_0x2692b1[_0x53627b(0xad)][_0x53627b(0xdc)])):logger[_0x53627b(0xae)](_0x53627b(0xa1)+(_0x2692b1[_0x53627b(0xc9)]||_0x2692b1));const _0x4dcfdf={};return _0x4dcfdf['status']=_0x4d06f5['EmoKM'],_0x4dcfdf['message']=_0x2692b1[_0x53627b(0xc9)]||_0x2692b1['response']?_0x2692b1[_0x53627b(0xad)]['status']+':'+_0x2692b1[_0x53627b(0xad)][_0x53627b(0x98)]:_0x2692b1,_0x4dcfdf;}})();}}function a90_0x2963(_0x89344b,_0x1b4acc){const _0x3353ad=a90_0x3353();return a90_0x2963=function(_0x29634d,_0x1ad20a){_0x29634d=_0x29634d-0x96;let _0x2e6924=_0x3353ad[_0x29634d];return _0x2e6924;},a90_0x2963(_0x89344b,_0x1b4acc);}module[a90_0x153329(0xda)]=TestHubHandler;
const a129_0x2562c1=a129_0x2179;(function(_0x12f9bf,_0xb96ee2){const _0x41eedd=a129_0x2179,_0x2c296e=_0x12f9bf();while(!![]){try{const _0x2b90ab=parseInt(_0x41eedd(0x1c0))/0x1*(-parseInt(_0x41eedd(0x22b))/0x2)+-parseInt(_0x41eedd(0x21f))/0x3*(parseInt(_0x41eedd(0x1ce))/0x4)+parseInt(_0x41eedd(0x206))/0x5*(-parseInt(_0x41eedd(0x1bf))/0x6)+-parseInt(_0x41eedd(0x1c9))/0x7*(-parseInt(_0x41eedd(0x1fd))/0x8)+parseInt(_0x41eedd(0x23b))/0x9+-parseInt(_0x41eedd(0x223))/0xa+parseInt(_0x41eedd(0x235))/0xb;if(_0x2b90ab===_0xb96ee2)break;else _0x2c296e['push'](_0x2c296e['shift']());}catch(_0x410aca){_0x2c296e['push'](_0x2c296e['shift']());}}}(a129_0x712a,0x1a925));const bsSetupHelper=require(a129_0x2562c1(0x213)),path=require(a129_0x2562c1(0x242)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a129_0x2562c1(0x22a)),testhubUtils=require(a129_0x2562c1(0x232)),testHubConstants=require(a129_0x2562c1(0x220)),constants=require(a129_0x2562c1(0x1b9)),RequestQueueHandler=require(a129_0x2562c1(0x1c6)),logger=require('../logger')[a129_0x2562c1(0x1d8)],SessionHandler=require(a129_0x2562c1(0x203)),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a129_0x2562c1(0x217)),TestDetails=require(a129_0x2562c1(0x1bb)),{uploadTraceZip}=require(a129_0x2562c1(0x23d)),{isTurboScaleSession}=require(a129_0x2562c1(0x1c8)),BrowserstackCLI=require(a129_0x2562c1(0x1e7)),OngoingEvents=new Set();function a129_0x712a(){const _0x1a7838=['zxVIS','../test-observability/utils','16yHJXen','false','projectName','PERCY_SUPPORTED_FRAMEWORKS','authToken','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','info','./utils.js','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','ACCESSIBILITY','5607063mDXrHY','message','POST','processTraceZips','BS_TESTOPS_BUILD_COMPLETED','allowScreenshot','995184AtYBsE','BROWSERSTACK_TESTHUB_UUID','../../bin/playwright/reporter/pwUtils.js','generateBuildUpstreamData','isBrowserstackInfra','allSettled','jMgCU','path','buildDescription','job_id','ENV_VAR','lILRK','../../bin/utils/constants.js','yBqNw','../../bin/playwright/reporter/test-details.js','toISOString','HmxIz','getTraceFilePaths','66MEJcdQ','8623QXmEkv','error','buildName','Error\x20while\x20waiting\x20for\x20events:\x20','RjclQ','exports','../test-observability/requestQueueHandler.js','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','../helper.js','7889fJomYM','push','launchBuild','token','debug','1516ZBMLoY','vzwae','kIdwt','getHostInfo','getProductMapForBuildStartCall','statusText','setTestObservabilityVariables','mIhha','OTbpl','getCiInfo','winstonLogger','kIoEN','framework','getProductMap','resolve','JZcSe','AvwPR','STOP','jsvry','/stop','buildHashedId','forEach','getGitMetaData','finished_metadata','tHtsn','../../bin/v2/browserstackCLI','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','api/v1/builds/','config','BROWSERSTACK_TESTHUB_JWT','env','mSDYx','PUT','BROWSERSTACK_TEST_OBSERVABILITY','lcnc','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','BROWSERSTACK_BUILD_RUN_IDENTIFIER','buildIdentifier','data','ANNyN','includes','assign','JpNxK','UqEeG','status','BROWSERSTACK_CENTRAL_SCANNER_JOBID','stringify','424vpcCLI','true','accessibility','buildStopSent','START','response','../test-observability/sessionHandler.js','includeEncodedExtension','getAccessKey','95515kVjPfz','BROWSERSTACK_CENTRAL_SCANNER_JWT','KqDdi','measureWrapper','format','waitForBuildStatus','settings','percy','extractDataFromResponse','central_scanner','success','PPBUA','OBSERVABILITY','../helper','tFmJF','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','nNhWT','../performance/constants','checkAndSetupPercy','getCentralUser','getAccessibilityOptions','password','fmlun','sQJvM','yoBzR','879MlxCSZ','./constants.js','isAccessibilityEnabled','stop','1810390jHrqii','accessibilityOptions','setTestHubCommonMetaInfo','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','FzFzd','All\x20trace\x20zip\x20send\x20events\x20complete'];a129_0x712a=function(){return _0x1a7838;};return a129_0x712a();}function a129_0x2179(_0x3ee627,_0x373d95){const _0x712af3=a129_0x712a();return a129_0x2179=function(_0x217959,_0x7dd4bd){_0x217959=_0x217959-0x1b9;let _0x663c42=_0x712af3[_0x217959];return _0x663c42;},a129_0x2179(_0x3ee627,_0x373d95);}let processedTraceZips=![];const addEvent=_0x2bb3d7=>{OngoingEvents['add'](_0x2bb3d7);},awaitAllEvents=async()=>{const _0x6a89f4=a129_0x2562c1;return Promise[_0x6a89f4(0x240)](OngoingEvents);};class TestHubHandler{static [a129_0x2562c1(0x200)]=![];static async[a129_0x2562c1(0x1cb)](_0x3d306c,_0x4c7312){const _0x1c945f=a129_0x2562c1,_0x4fff60={'HQKTr':function(_0x15a686,_0x51acd3){return _0x15a686||_0x51acd3;},'RjclQ':function(_0x18544,_0x4db5ed){return _0x18544===_0x4db5ed;},'JpNxK':function(_0x386a9b){return _0x386a9b();},'mSDYx':_0x1c945f(0x1c7),'HVVue':_0x1c945f(0x22c),'vzwae':_0x1c945f(0x230),'OTbpl':function(_0x2d6141,_0x4311d0,_0x356f8d,_0x52dd0c,_0xc737ee){return _0x2d6141(_0x4311d0,_0x356f8d,_0x52dd0c,_0xc737ee);},'HmxIz':_0x1c945f(0x237),'KqDdi':function(_0x5bdb8a,_0x474ff4){return _0x5bdb8a===_0x474ff4;},'BpmuI':_0x1c945f(0x1ff),'UTbnG':'true'};await PerformanceTester[_0x1c945f(0x209)](PerformanceEvents[_0x1c945f(0x201)],async()=>{const _0x3edf97=_0x1c945f,_0xade3c4=Object[_0x3edf97(0x1f7)]({},_0x4c7312[_0x3edf97(0x1ea)],{'root_dir_path':'','framework':_0x4c7312[_0x3edf97(0x1da)]}),_0x2b4b60=bsSetupHelper['getUserName'](_0xade3c4),_0x5077e3=bsSetupHelper[_0x3edf97(0x205)](_0xade3c4),_0x583f6c=_0x4fff60['HQKTr'](_0x2b4b60,'')+':'+_0x4fff60['HQKTr'](_0x5077e3,''),_0x206dad=testhubUtils[_0x3edf97(0x1db)](_0xade3c4);process[_0x3edf97(0x1ec)]['BROWSERSTACK_PRODUCT_MAP']=JSON['stringify'](_0x206dad);if(_0x4fff60[_0x3edf97(0x1c4)](_0x583f6c,':'))return _0x4fff60[_0x3edf97(0x1f8)](isTestObservabilitySession)&&(logger['debug'](_0x4fff60[_0x3edf97(0x1ed)]),process[_0x3edf97(0x1ec)][_0x3edf97(0x239)]=_0x4fff60['HVVue']),testhubUtils[_0x3edf97(0x221)](_0xade3c4)&&logger[_0x3edf97(0x1cd)](_0x4fff60[_0x3edf97(0x1cf)]),[null,null];try{const _0xdf63b6=await this[_0x3edf97(0x23e)](_0xade3c4,_0x3d306c),_0x22af49=this['getConfig'](_0x2b4b60,_0x5077e3),_0x41a834=await _0x4fff60[_0x3edf97(0x1d6)](nodeRequest,_0x4fff60[_0x3edf97(0x1bd)],testHubConstants['TESTHUB_BUILD_API'],_0xdf63b6,_0x22af49),_0x32d563=this[_0x3edf97(0x20e)](_0xade3c4,_0x41a834,_0x22af49);await this[_0x3edf97(0x218)](_0x4c7312,_0x3d306c);if(_0x4fff60[_0x3edf97(0x208)](testhubUtils['getAccessibilityValueFromYml'](_0x4c7312[_0x3edf97(0x1ea)]),null)){const _0x52001d=_0x32d563[_0x4fff60['BpmuI']];_0x52001d&&_0x52001d['authToken']&&_0x52001d[_0x3edf97(0x1e2)]&&(_0x4c7312[_0x3edf97(0x1ea)]['accessibility']=!![],process['env'][_0x3edf97(0x1f1)]=_0x4fff60['UTbnG']);}return _0x32d563;}catch(_0x67540c){if(_0x4fff60[_0x3edf97(0x208)](_0x67540c['success'],![])){testhubUtils['logBuildError'](_0x67540c);return;}}})();}static async[a129_0x2562c1(0x238)](){const _0x440309=a129_0x2562c1,_0x19c1b9={'AvwPR':function(_0x129e2f,_0x96491f,_0x237543){return _0x129e2f(_0x96491f,_0x237543);},'zxVIS':function(_0x176470,_0x40ea9a){return _0x176470(_0x40ea9a);},'sTcfX':function(_0x2e46eb){return _0x2e46eb();},'UqEeG':_0x440309(0x228)};if(processedTraceZips)return;const _0x2d4881=TestDetails[_0x440309(0x1be)]();_0x2d4881[_0x440309(0x1e3)](({testUId:_0x2f0884,filePath:_0x52e870})=>{const _0x6ab401=_0x440309;var _0x45cfd4=_0x19c1b9[_0x6ab401(0x1de)](uploadTraceZip,_0x52e870,_0x2f0884);_0x19c1b9[_0x6ab401(0x229)](addEvent,_0x45cfd4);});try{await _0x19c1b9['sTcfX'](awaitAllEvents),logger['debug'](_0x19c1b9[_0x440309(0x1f9)]),processedTraceZips=!![];}catch(_0x3d6a4c){logger['error'](_0x440309(0x1c3)+util[_0x440309(0x20a)](_0x3d6a4c));}}static async[a129_0x2562c1(0x218)](_0x31651d,_0x389274){const _0x53eb7b=a129_0x2562c1;if(constants[_0x53eb7b(0x22e)][_0x53eb7b(0x1f6)](_0x389274)){await _0x31651d['setupPercy']();return;}_0x31651d[_0x53eb7b(0x1ea)][_0x53eb7b(0x20d)]&&logger[_0x53eb7b(0x1cd)]('Percy\x20is\x20not\x20supported\x20for\x20'+_0x389274+'\x20framework');}static[a129_0x2562c1(0x21a)](_0xe24f88){const _0x7ebcb0=a129_0x2562c1,_0x1cbdc4={'wBhGW':function(_0x133868,_0x5a09a1){return _0x133868(_0x5a09a1);},'tFmJF':_0x7ebcb0(0x1fe)};let _0x415ff5;if(_0xe24f88[_0x7ebcb0(0x224)]){const _0x367c0a={};_0x367c0a[_0x7ebcb0(0x20c)]=_0xe24f88['accessibilityOptions'],_0x415ff5=_0x367c0a;}else{const _0x4914b6={};_0x4914b6[_0x7ebcb0(0x20c)]={},_0x415ff5=_0x4914b6;}if((!bsSetupHelper[_0x7ebcb0(0x23f)]()||_0x1cbdc4['wBhGW'](isTurboScaleSession,_0xe24f88))&&testhubUtils[_0x7ebcb0(0x221)](_0xe24f88)){const _0x1970e0={};_0x1970e0[_0x7ebcb0(0x204)]=_0x1cbdc4[_0x7ebcb0(0x214)],Object[_0x7ebcb0(0x1f7)](_0x415ff5[_0x7ebcb0(0x20c)],_0x1970e0);}return _0x415ff5;}static['getConfig'](_0x1e7b0c,_0x32e166){const _0x19722c=a129_0x2562c1,_0x1951da={'nNhWT':function(_0x15046f,_0x18e287){return _0x15046f(_0x18e287);}},_0x53ab36={};return _0x53ab36['username']=_0x1e7b0c,_0x53ab36[_0x19722c(0x21b)]=_0x32e166,{'auth':_0x53ab36,'headers':_0x1951da[_0x19722c(0x216)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x4dfc7b,_0x48eb67){const _0x4fd283=a129_0x2562c1,_0x35cb81={'yBqNw':_0x4fd283(0x1e8),'JZcSe':function(_0x37c673,_0x54dac2){return _0x37c673(_0x54dac2);}};logger['debug'](_0x35cb81[_0x4fd283(0x1ba)]);const _0x2a55ae={'project_name':_0x4dfc7b[_0x4fd283(0x22d)]||'','name':_0x4dfc7b[_0x4fd283(0x1c2)]||path['basename'](path[_0x4fd283(0x1dc)](process['cwd']())),'build_identifier':_0x4dfc7b[_0x4fd283(0x1f3)],'description':_0x4dfc7b[_0x4fd283(0x243)]||'','started_at':new Date()[_0x4fd283(0x1bc)](),'tags':_0x35cb81[_0x4fd283(0x1dd)](getCustomTags,_0x4dfc7b),'host_info':bsSetupHelper[_0x4fd283(0x1d1)](),'ci_info':bsSetupHelper[_0x4fd283(0x1d7)](),'build_run_identifier':process[_0x4fd283(0x1ec)][_0x4fd283(0x1f2)],'failed_tests_rerun':process[_0x4fd283(0x1ec)]['BROWSERSTACK_RERUN']||![],'linked_build_uuid':process[_0x4fd283(0x1ec)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper[_0x4fd283(0x1e4)](),'accessibility':this[_0x4fd283(0x21a)](_0x4dfc7b),'framework_details':testhubUtils['getFrameworkDetails'](_0x4dfc7b,_0x48eb67),'product_map':testhubUtils[_0x4fd283(0x1d2)](_0x4dfc7b),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra'](),'grouping_identifier':process[_0x4fd283(0x1ec)][_0x4fd283(0x215)],'test_orchestration':testhubUtils['getTestOrchestrationBuildStartData'](_0x4dfc7b)};if(bsSetupHelper[_0x4fd283(0x219)]()[_0x4fd283(0x20f)]||bsSetupHelper['getCentralUser']()[_0x4fd283(0x1f0)]){const _0xf32070={};_0xf32070[_0x4fd283(0x244)]=process[_0x4fd283(0x1ec)][_0x4fd283(0x1fb)],_0xf32070[_0x4fd283(0x1cc)]=process['env'][_0x4fd283(0x207)],_0x2a55ae[_0x4fd283(0x20f)]=_0xf32070;}return _0x2a55ae;}static['extractDataFromResponse'](_0x4936c2,_0x25158c,_0x1b9d7e){const _0x5739c8=a129_0x2562c1,_0x453eac={'fDHgM':function(_0x583212){return _0x583212();},'dRyKj':function(_0x586b68,_0x4ac3ca){return _0x586b68&&_0x4ac3ca;},'jsvry':_0x5739c8(0x1fe),'ANNyN':'false','jMgCU':function(_0x81ca6e,_0x3da619){return _0x81ca6e&&_0x3da619;}},_0x4764b7={};if(_0x453eac['fDHgM'](isTestObservabilitySession)){const [_0x391dba,_0x4e4436,_0x18b075]=testhubUtils[_0x5739c8(0x1d4)](_0x25158c['data'],_0x1b9d7e['auth']);if(_0x453eac['dRyKj'](_0x391dba,_0x4e4436)){const _0x2f0b58={};_0x2f0b58['jwt']=_0x391dba,_0x2f0b58[_0x5739c8(0x1e2)]=_0x4e4436,_0x2f0b58[_0x5739c8(0x23a)]=_0x18b075,_0x4764b7[testHubConstants[_0x5739c8(0x212)]]=_0x2f0b58,process[_0x5739c8(0x1ec)][_0x5739c8(0x1ef)]=_0x453eac[_0x5739c8(0x1e0)];}else _0x4764b7[testHubConstants['OBSERVABILITY']]={},process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x453eac[_0x5739c8(0x1f5)];}else process[_0x5739c8(0x1ec)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x453eac['ANNyN'];const [_0x1e44f1,_0x311641]=testhubUtils['setAccessibilityVariables'](_0x25158c[_0x5739c8(0x1f4)]);if(_0x453eac[_0x5739c8(0x241)](_0x1e44f1,_0x311641)){const _0x5cecf7={};_0x5cecf7[_0x5739c8(0x22f)]=_0x1e44f1,_0x5cecf7['buildHashedId']=_0x311641,_0x4764b7[testHubConstants[_0x5739c8(0x234)]]=_0x5cecf7,process[_0x5739c8(0x1ec)]['BROWSERSTACK_ACCESSIBILITY']=_0x453eac['jsvry'];}else _0x4764b7[testHubConstants[_0x5739c8(0x234)]]={},process[_0x5739c8(0x1ec)]['BROWSERSTACK_ACCESSIBILITY']=_0x453eac[_0x5739c8(0x1f5)];return testhubUtils[_0x5739c8(0x225)](_0x25158c[_0x5739c8(0x1f4)]),logger[_0x5739c8(0x231)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x5739c8(0x1ec)]['BROWSERSTACK_TESTHUB_UUID']),_0x4764b7;}static async[a129_0x2562c1(0x222)](_0x49dbef){const _0x34cdfd=a129_0x2562c1,_0x4ee0f3={'mIhha':function(_0xe0786b,_0x55cd3d){return _0xe0786b===_0x55cd3d;},'QSzwF':_0x34cdfd(0x22c),'lILRK':'null','fmlun':_0x34cdfd(0x226),'PPBUA':_0x34cdfd(0x1c1),'FzFzd':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','yoBzR':_0x34cdfd(0x1e5),'VfOyw':'user_killed','kIoEN':function(_0x54d325){return _0x54d325();},'sLZWI':function(_0x732b9,_0x5d4c97,_0x314162,_0x209639,_0x1a2e7d,_0x4e00a8){return _0x732b9(_0x5d4c97,_0x314162,_0x209639,_0x1a2e7d,_0x4e00a8);},'sQJvM':_0x34cdfd(0x1ee),'tHtsn':'stopBuildUpstream\x20event\x20successful!','kIdwt':_0x34cdfd(0x210)};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x34cdfd(0x1df)],async()=>{const _0x46f6a2=_0x34cdfd;if(_0x4ee0f3['mIhha'](process[_0x46f6a2(0x1ec)][_0x46f6a2(0x239)],_0x4ee0f3['QSzwF'])||TestHubHandler['buildStopSent']||bsSetupHelper['isUndefined'](process[_0x46f6a2(0x1ec)][testHubConstants[_0x46f6a2(0x245)][_0x46f6a2(0x1eb)]]))return;TestHubHandler[_0x46f6a2(0x200)]=!![];if(BrowserstackCLI['getInstance']()['isRunning']())return;await this[_0x46f6a2(0x238)](),await RequestQueueHandler['getInstance']()['uploadPending'](),await SessionHandler[_0x46f6a2(0x20b)]();if(_0x4ee0f3[_0x46f6a2(0x1d5)](process[_0x46f6a2(0x1ec)][testHubConstants['ENV_VAR'][_0x46f6a2(0x1eb)]],_0x4ee0f3[_0x46f6a2(0x246)])||_0x4ee0f3[_0x46f6a2(0x1d5)](process[_0x46f6a2(0x1ec)][testHubConstants[_0x46f6a2(0x245)][_0x46f6a2(0x23c)]],_0x4ee0f3[_0x46f6a2(0x246)])){logger[_0x46f6a2(0x1cd)](_0x4ee0f3[_0x46f6a2(0x21c)]);const _0x496837={};return _0x496837['status']=_0x4ee0f3[_0x46f6a2(0x211)],_0x496837['message']=_0x4ee0f3[_0x46f6a2(0x227)],_0x496837;}const _0x4f3a8d={'finished_at':new Date()[_0x46f6a2(0x1bc)](),'finished_metadata':[]};!!_0x49dbef&&_0x4f3a8d[_0x4ee0f3[_0x46f6a2(0x21e)]][_0x46f6a2(0x1ca)]({'reason':_0x4ee0f3['VfOyw'],'signal':_0x49dbef,'failure_data':''});const _0x16682f={'headers':_0x4ee0f3[_0x46f6a2(0x1d9)](getDefaultHeaders)};try{const _0x91fbe2=await _0x4ee0f3['sLZWI'](nodeRequest,_0x4ee0f3[_0x46f6a2(0x21d)],_0x46f6a2(0x1e9)+process['env'][testHubConstants[_0x46f6a2(0x245)][_0x46f6a2(0x23c)]]+_0x46f6a2(0x1e1),_0x4f3a8d,_0x16682f,![]);if(_0x91fbe2['data']&&_0x91fbe2['data'][_0x46f6a2(0x1c1)]){const _0x1fe0ce={};_0x1fe0ce[_0x46f6a2(0x236)]=_0x91fbe2[_0x46f6a2(0x1f4)][_0x46f6a2(0x1c1)];throw _0x1fe0ce;}else{logger[_0x46f6a2(0x1cd)](_0x4ee0f3[_0x46f6a2(0x1e6)]);const _0x255b78={};return _0x255b78[_0x46f6a2(0x1fa)]=_0x4ee0f3[_0x46f6a2(0x1d0)],_0x255b78[_0x46f6a2(0x236)]='',_0x255b78;}}catch(_0x2d00f2){_0x2d00f2[_0x46f6a2(0x202)]?logger[_0x46f6a2(0x1cd)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x2d00f2[_0x46f6a2(0x202)][_0x46f6a2(0x1fa)]+'\x20'+_0x2d00f2[_0x46f6a2(0x202)]['statusText']+'\x20'+JSON[_0x46f6a2(0x1fc)](_0x2d00f2['response'][_0x46f6a2(0x1f4)])):logger[_0x46f6a2(0x1cd)](_0x46f6a2(0x233)+(_0x2d00f2['message']||_0x2d00f2));const _0x262f43={};return _0x262f43['status']=_0x4ee0f3['PPBUA'],_0x262f43[_0x46f6a2(0x236)]=_0x2d00f2[_0x46f6a2(0x236)]||_0x2d00f2[_0x46f6a2(0x202)]?_0x2d00f2['response'][_0x46f6a2(0x1fa)]+':'+_0x2d00f2[_0x46f6a2(0x202)][_0x46f6a2(0x1d3)]:_0x2d00f2,_0x262f43;}})();}}module[a129_0x2562c1(0x1c5)]=TestHubHandler;
const a126_0x5380e1=a126_0x4695;(function(_0x4f1af2,_0x330e4d){const _0x13b189=a126_0x4695,_0xf3e758=_0x4f1af2();while(!![]){try{const _0x2e5b70=-parseInt(_0x13b189(0xea))/0x1*(parseInt(_0x13b189(0xc9))/0x2)+-parseInt(_0x13b189(0xbf))/0x3+parseInt(_0x13b189(0xb3))/0x4*(parseInt(_0x13b189(0x113))/0x5)+-parseInt(_0x13b189(0x11c))/0x6*(-parseInt(_0x13b189(0x11f))/0x7)+parseInt(_0x13b189(0xe9))/0x8+-parseInt(_0x13b189(0xff))/0x9*(parseInt(_0x13b189(0x118))/0xa)+parseInt(_0x13b189(0xe7))/0xb;if(_0x2e5b70===_0x330e4d)break;else _0xf3e758['push'](_0xf3e758['shift']());}catch(_0x8ef410){_0xf3e758['push'](_0xf3e758['shift']());}}}(a126_0x32bc,0xe34bd));function a126_0x4695(_0x2b8cf3,_0x284cb3){const _0x32bc73=a126_0x32bc();return a126_0x4695=function(_0x46956e,_0x3d3acf){_0x46956e=_0x46956e-0x8e;let _0x2a6882=_0x32bc73[_0x46956e];return _0x2a6882;},a126_0x4695(_0x2b8cf3,_0x284cb3);}function a126_0x32bc(){const _0xf448d3=['basename','settings','../../bin/playwright/reporter/pwUtils.js','getCentralUser','percy','BS_TESTOPS_BUILD_COMPLETED','includes','../helper','waitForBuildStatus','getTraceFilePaths','toISOString','BROWSERSTACK_ACCESSIBILITY','ACCESSIBILITY','measureWrapper','../../bin/playwright/reporter/test-details.js','buildDescription','POST','LLqtm','framework','true','TESTHUB_BUILD_API','message','getProductMap','Testhub\x20started\x20with\x20id:\x20','CRyAD','projectName','HyEBj','job_id','false','19901178kQQxVl','error','12000232EMILZk','108897QeZbkR','Error\x20while\x20waiting\x20for\x20events:\x20','DCkzY','accessibility','OiPyh','VjRyl','uploadPending','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','resolve','IXSzz','forEach','./constants.js','accessibilityOptions','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','Percy\x20is\x20not\x20supported\x20for\x20','status','OBSERVABILITY','user_killed','BROWSERSTACK_CENTRAL_SCANNER_JOBID','VzaDK','getGitMetaData','4622697zVRAgG','add','logBuildError','password','buildStopSent','ENV_VAR','getInstance','\x20framework','setupPercy','processTraceZips','START','statusText','kEMXf','BROWSERSTACK_TEST_OBSERVABILITY','getFrameworkDetails','getAccessibilityValueFromYml','assign','getTestOrchestrationBuildStartData','central_scanner','../../bin/v2/browserstackCLI','3003380UkiNQN','../test-observability/utils','QVQnt','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','cwd','30WjhZnj','allowScreenshot','../../bin/utils/constants.js','BROWSERSTACK_BUILD_RUN_IDENTIFIER','6mMhVNf','path','../performance/performance-tester.js','9704051Pecbeg','getAccessibilityOptions','setTestObservabilityVariables','data','buildIdentifier','env','PERCY_SUPPORTED_FRAMEWORKS','BEFyQ','BROWSERSTACK_TESTHUB_UUID','PGQpD','lcnc','pQWQi','response','BROWSERSTACK_TESTHUB_JWT','success','push','winstonLogger','jwt','LCwyh','allSettled','token','WUzoi','setAccessibilityVariables','debug','stringify','ECIcO','TULcK','Dwifc','getCiInfo','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','upbJY','getUserName','mTXVG','../helper.js','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','AUEDA','isUndefined','All\x20trace\x20zip\x20send\x20events\x20complete','4yvOgMf','qEZHJ','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','config','getHostInfo','tDDuy','../logger','isAccessibilityEnabled','getConfig','BROWSERSTACK_CENTRAL_SCANNER_JWT','enhMe','launchBuild','5532657DOsunZ','BROWSERSTACK_PRODUCT_MAP','format','generateBuildUpstreamData','VsRIl','buildHashedId','extractDataFromResponse','authToken','isBrowserstackInfra','stop','18hfkitG'];a126_0x32bc=function(){return _0xf448d3;};return a126_0x32bc();}const bsSetupHelper=require(a126_0x5380e1(0xd1)),path=require(a126_0x5380e1(0x11d)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a126_0x5380e1(0x114)),testhubUtils=require('./utils.js'),testHubConstants=require(a126_0x5380e1(0xf5)),constants=require(a126_0x5380e1(0x11a)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a126_0x5380e1(0xb9))[a126_0x5380e1(0x9d)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a126_0x5380e1(0x11e)),{TESTHUB_EVENTS:PerformanceEvents}=require('../performance/constants'),TestDetails=require(a126_0x5380e1(0xd8)),{uploadTraceZip}=require(a126_0x5380e1(0xcc)),{isTurboScaleSession}=require(a126_0x5380e1(0xae)),BrowserstackCLI=require(a126_0x5380e1(0x112)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x51a1cd=>{const _0x24a927=a126_0x5380e1;OngoingEvents[_0x24a927(0x100)](_0x51a1cd);},awaitAllEvents=async()=>{const _0x35d5c2=a126_0x5380e1;return Promise[_0x35d5c2(0xa0)](OngoingEvents);};class TestHubHandler{static [a126_0x5380e1(0x103)]=![];static async[a126_0x5380e1(0xbe)](_0x16b1da,_0x49d491){const _0x4c0b56=a126_0x5380e1,_0x3acb9f={'AUEDA':function(_0x4a88d5,_0x5505ba){return _0x4a88d5||_0x5505ba;},'QVQnt':function(_0x5c3ec5,_0x2d4a1a){return _0x5c3ec5||_0x2d4a1a;},'VsRIl':function(_0xe90737,_0x517047){return _0xe90737===_0x517047;},'PGQpD':function(_0x4754fb){return _0x4754fb();},'hMbeu':_0x4c0b56(0xb5),'uPMrW':_0x4c0b56(0xe6),'ECIcO':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','LCwyh':function(_0x54c533,_0x3f4867,_0x5408e3,_0x5ce5c6,_0xfe37e2){return _0x54c533(_0x3f4867,_0x5408e3,_0x5ce5c6,_0xfe37e2);},'upbJY':_0x4c0b56(0xda),'LLqtm':_0x4c0b56(0xed),'HGqbK':_0x4c0b56(0xdd)};await PerformanceTester[_0x4c0b56(0xd7)](PerformanceEvents[_0x4c0b56(0x109)],async()=>{const _0x497630=_0x4c0b56,_0x303a6d=Object[_0x497630(0x10f)]({},_0x49d491[_0x497630(0xb6)],{'root_dir_path':'','framework':_0x49d491[_0x497630(0xdc)]}),_0x5da70c=bsSetupHelper[_0x497630(0xac)](_0x303a6d),_0x49bdd0=bsSetupHelper['getAccessKey'](_0x303a6d),_0x29289e=_0x3acb9f[_0x497630(0xb0)](_0x5da70c,'')+':'+_0x3acb9f[_0x497630(0x115)](_0x49bdd0,''),_0x1742e9=testhubUtils[_0x497630(0xe0)](_0x303a6d);process[_0x497630(0x92)][_0x497630(0xc0)]=JSON[_0x497630(0xa5)](_0x1742e9);if(_0x3acb9f['VsRIl'](_0x29289e,':'))return _0x3acb9f[_0x497630(0x96)](isTestObservabilitySession)&&(logger[_0x497630(0xa4)](_0x3acb9f['hMbeu']),process[_0x497630(0x92)]['BS_TESTOPS_BUILD_COMPLETED']=_0x3acb9f['uPMrW']),testhubUtils['isAccessibilityEnabled'](_0x303a6d)&&logger[_0x497630(0xa4)](_0x3acb9f[_0x497630(0xa6)]),[null,null];try{const _0x1d605c=await this[_0x497630(0xc2)](_0x303a6d,_0x16b1da),_0x558dc4=this[_0x497630(0xbb)](_0x5da70c,_0x49bdd0),_0x4579fe=await _0x3acb9f[_0x497630(0x9f)](nodeRequest,_0x3acb9f[_0x497630(0xab)],testHubConstants[_0x497630(0xde)],_0x1d605c,_0x558dc4),_0x1a19e4=this['extractDataFromResponse'](_0x303a6d,_0x4579fe,_0x558dc4);await this['checkAndSetupPercy'](_0x49d491,_0x16b1da);if(_0x3acb9f[_0x497630(0xc3)](testhubUtils[_0x497630(0x10e)](_0x49d491[_0x497630(0xb6)]),null)){const _0x4199ef=_0x1a19e4[_0x3acb9f[_0x497630(0xdb)]];_0x4199ef&&_0x4199ef[_0x497630(0xc6)]&&_0x4199ef['buildHashedId']&&(_0x49d491[_0x497630(0xb6)][_0x497630(0xed)]=!![],process[_0x497630(0x92)]['BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM']=_0x3acb9f['HGqbK']);}return _0x1a19e4;}catch(_0x24538a){if(_0x3acb9f[_0x497630(0xc3)](_0x24538a['success'],![])){testhubUtils[_0x497630(0x101)](_0x24538a);return;}}})();}static async[a126_0x5380e1(0x108)](){const _0x2739ff=a126_0x5380e1,_0xbdfade={'vMhAd':function(_0x802a5e,_0x3099ad,_0x413c3e){return _0x802a5e(_0x3099ad,_0x413c3e);},'DZtJa':function(_0x13d8bf,_0x2e05e1){return _0x13d8bf(_0x2e05e1);},'MQPDn':function(_0x350a75){return _0x350a75();},'KwpPI':_0x2739ff(0xb2)};if(processedTraceZips)return;const _0x115a80=TestDetails[_0x2739ff(0xd3)]();_0x115a80[_0x2739ff(0xf4)](({testUId:_0x2f03e4,filePath:_0x1e7728})=>{var _0x4b2983=_0xbdfade['vMhAd'](uploadTraceZip,_0x1e7728,_0x2f03e4);_0xbdfade['DZtJa'](addEvent,_0x4b2983);});try{await _0xbdfade['MQPDn'](awaitAllEvents),logger[_0x2739ff(0xa4)](_0xbdfade['KwpPI']),processedTraceZips=!![];}catch(_0x30b77e){logger[_0x2739ff(0xe8)](_0x2739ff(0xeb)+util[_0x2739ff(0xc1)](_0x30b77e));}}static async['checkAndSetupPercy'](_0x418f8e,_0x32c653){const _0x1c34d0=a126_0x5380e1;if(constants[_0x1c34d0(0x93)][_0x1c34d0(0xd0)](_0x32c653)){await _0x418f8e[_0x1c34d0(0x107)]();return;}_0x418f8e[_0x1c34d0(0xb6)][_0x1c34d0(0xce)]&&logger[_0x1c34d0(0xa4)](_0x1c34d0(0xf8)+_0x32c653+_0x1c34d0(0x106));}static[a126_0x5380e1(0x8e)](_0x94dfa3){const _0x379b3a=a126_0x5380e1,_0x20c202={'DCkzY':function(_0x394503,_0x4496dc){return _0x394503(_0x4496dc);},'DsXPk':_0x379b3a(0xdd)};let _0x3b3458;if(_0x94dfa3[_0x379b3a(0xf6)]){const _0x14da0b={};_0x14da0b[_0x379b3a(0xcb)]=_0x94dfa3[_0x379b3a(0xf6)],_0x3b3458=_0x14da0b;}else{const _0x57ab62={};_0x57ab62[_0x379b3a(0xcb)]={},_0x3b3458=_0x57ab62;}if((!bsSetupHelper[_0x379b3a(0xc7)]()||_0x20c202[_0x379b3a(0xec)](isTurboScaleSession,_0x94dfa3))&&testhubUtils[_0x379b3a(0xba)](_0x94dfa3)){const _0xf1a490={};_0xf1a490['includeEncodedExtension']=_0x20c202['DsXPk'],Object[_0x379b3a(0x10f)](_0x3b3458['settings'],_0xf1a490);}return _0x3b3458;}static[a126_0x5380e1(0xbb)](_0x20dba7,_0x94bd14){const _0x4fe25b=a126_0x5380e1,_0x2e8992={'CRyAD':function(_0x4b374d,_0x5219d0){return _0x4b374d(_0x5219d0);}},_0x11323a={};return _0x11323a['username']=_0x20dba7,_0x11323a[_0x4fe25b(0x102)]=_0x94bd14,{'auth':_0x11323a,'headers':_0x2e8992[_0x4fe25b(0xe2)](getDefaultHeaders,![])};}static async[a126_0x5380e1(0xc2)](_0x474333,_0x52ee45){const _0x3ae000=a126_0x5380e1,_0xc4e49e={'Dwifc':_0x3ae000(0x116),'bgUGp':function(_0x5ab216,_0x22c4bd){return _0x5ab216(_0x22c4bd);}};logger[_0x3ae000(0xa4)](_0xc4e49e[_0x3ae000(0xa8)]);const _0x451fb5={'project_name':_0x474333[_0x3ae000(0xe3)]||'','name':_0x474333['buildName']||path[_0x3ae000(0xca)](path[_0x3ae000(0xf2)](process[_0x3ae000(0x117)]())),'build_identifier':_0x474333[_0x3ae000(0x91)],'description':_0x474333[_0x3ae000(0xd9)]||'','started_at':new Date()[_0x3ae000(0xd4)](),'tags':_0xc4e49e['bgUGp'](getCustomTags,_0x474333),'host_info':bsSetupHelper[_0x3ae000(0xb7)](),'ci_info':bsSetupHelper[_0x3ae000(0xa9)](),'build_run_identifier':process[_0x3ae000(0x92)][_0x3ae000(0x11b)],'failed_tests_rerun':process['env']['BROWSERSTACK_RERUN']||![],'linked_build_uuid':process[_0x3ae000(0x92)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper[_0x3ae000(0xfe)](),'accessibility':this[_0x3ae000(0x8e)](_0x474333),'framework_details':testhubUtils[_0x3ae000(0x10d)](_0x474333,_0x52ee45),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x474333),'browserstackAutomation':bsSetupHelper[_0x3ae000(0xc7)](),'grouping_identifier':process[_0x3ae000(0x92)][_0x3ae000(0xf7)],'test_orchestration':testhubUtils[_0x3ae000(0x110)](_0x474333)};if(bsSetupHelper[_0x3ae000(0xcd)]()[_0x3ae000(0x111)]||bsSetupHelper[_0x3ae000(0xcd)]()[_0x3ae000(0x97)]){const _0x1ed76c={};_0x1ed76c[_0x3ae000(0xe5)]=process[_0x3ae000(0x92)][_0x3ae000(0xfc)],_0x1ed76c[_0x3ae000(0xa1)]=process[_0x3ae000(0x92)][_0x3ae000(0xbc)],_0x451fb5[_0x3ae000(0x111)]=_0x1ed76c;}return _0x451fb5;}static[a126_0x5380e1(0xc5)](_0x3fb8ab,_0x2b5a2c,_0x16e340){const _0x292aaf=a126_0x5380e1,_0x2c3cb1={'enhMe':function(_0x2c1d5b){return _0x2c1d5b();},'qEZHJ':function(_0x67b290,_0x5d7a21){return _0x67b290&&_0x5d7a21;},'TULcK':_0x292aaf(0xdd),'tDDuy':'false','kEMXf':function(_0x3658fe,_0x5e4987){return _0x3658fe&&_0x5e4987;}},_0x102d03={};if(_0x2c3cb1[_0x292aaf(0xbd)](isTestObservabilitySession)){const [_0x43ebae,_0x2b64f6,_0x443774]=testhubUtils[_0x292aaf(0x8f)](_0x2b5a2c[_0x292aaf(0x90)],_0x16e340['auth']);if(_0x2c3cb1[_0x292aaf(0xb4)](_0x43ebae,_0x2b64f6)){const _0x2ab3a9={};_0x2ab3a9[_0x292aaf(0x9e)]=_0x43ebae,_0x2ab3a9[_0x292aaf(0xc4)]=_0x2b64f6,_0x2ab3a9[_0x292aaf(0x119)]=_0x443774,_0x102d03[testHubConstants[_0x292aaf(0xfa)]]=_0x2ab3a9,process['env'][_0x292aaf(0x10c)]=_0x2c3cb1[_0x292aaf(0xa7)];}else _0x102d03[testHubConstants[_0x292aaf(0xfa)]]={},process[_0x292aaf(0x92)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x2c3cb1[_0x292aaf(0xb8)];}else process['env'][_0x292aaf(0x10c)]=_0x2c3cb1[_0x292aaf(0xb8)];const [_0x13f9da,_0x51cc2c]=testhubUtils[_0x292aaf(0xa3)](_0x2b5a2c[_0x292aaf(0x90)]);if(_0x2c3cb1[_0x292aaf(0x10b)](_0x13f9da,_0x51cc2c)){const _0x254b95={};_0x254b95['authToken']=_0x13f9da,_0x254b95[_0x292aaf(0xc4)]=_0x51cc2c,_0x102d03[testHubConstants['ACCESSIBILITY']]=_0x254b95,process[_0x292aaf(0x92)][_0x292aaf(0xd5)]=_0x2c3cb1[_0x292aaf(0xa7)];}else _0x102d03[testHubConstants[_0x292aaf(0xd6)]]={},process[_0x292aaf(0x92)][_0x292aaf(0xd5)]=_0x2c3cb1[_0x292aaf(0xb8)];return testhubUtils['setTestHubCommonMetaInfo'](_0x2b5a2c['data']),logger['info'](_0x292aaf(0xe1)+process[_0x292aaf(0x92)][_0x292aaf(0x95)]),_0x102d03;}static async[a126_0x5380e1(0xc8)](_0x45c7f7){const _0x9d2232=a126_0x5380e1,_0x1feef2={'WUzoi':function(_0x244ef1,_0x36e6d5){return _0x244ef1===_0x36e6d5;},'DdmSF':_0x9d2232(0xe6),'jwKUJ':'null','mTXVG':function(_0x22978d,_0x15647f){return _0x22978d===_0x15647f;},'McPXT':_0x9d2232(0xaa),'VjRyl':_0x9d2232(0xe8),'OiPyh':_0x9d2232(0xaf),'sQrcI':'finished_metadata','HyEBj':_0x9d2232(0xfb),'IXSzz':function(_0x1230d7){return _0x1230d7();},'HjYZi':function(_0x3a379f,_0x572813,_0x343e62,_0x4c354e,_0x214ce0,_0x2bd44f){return _0x3a379f(_0x572813,_0x343e62,_0x4c354e,_0x214ce0,_0x2bd44f);},'pQWQi':'PUT','VzaDK':'stopBuildUpstream\x20event\x20successful!','BEFyQ':_0x9d2232(0x9b)};!BrowserstackCLI[_0x9d2232(0x105)]()['isRunning']()&&await this[_0x9d2232(0x108)](),await PerformanceTester[_0x9d2232(0xd7)](PerformanceEvents['STOP'],async()=>{const _0x293774=_0x9d2232;if(_0x1feef2[_0x293774(0xa2)](process['env'][_0x293774(0xcf)],_0x1feef2['DdmSF'])||TestHubHandler[_0x293774(0x103)]||bsSetupHelper[_0x293774(0xb1)](process[_0x293774(0x92)][testHubConstants[_0x293774(0x104)][_0x293774(0x9a)]]))return;TestHubHandler[_0x293774(0x103)]=!![],await RequestQueueHandler[_0x293774(0x105)]()[_0x293774(0xf0)](),await SessionHandler[_0x293774(0xd2)]();if(_0x1feef2[_0x293774(0xa2)](process['env'][testHubConstants[_0x293774(0x104)]['BROWSERSTACK_TESTHUB_JWT']],_0x1feef2['jwKUJ'])||_0x1feef2[_0x293774(0xad)](process[_0x293774(0x92)][testHubConstants['ENV_VAR'][_0x293774(0x95)]],_0x1feef2['jwKUJ'])){logger['debug'](_0x1feef2['McPXT']);const _0x18301a={};return _0x18301a[_0x293774(0xf9)]=_0x1feef2['VjRyl'],_0x18301a['message']=_0x1feef2[_0x293774(0xee)],_0x18301a;}const _0x43d6cf={'finished_at':new Date()['toISOString'](),'finished_metadata':[]};!!_0x45c7f7&&_0x43d6cf[_0x1feef2['sQrcI']][_0x293774(0x9c)]({'reason':_0x1feef2[_0x293774(0xe4)],'signal':_0x45c7f7,'failure_data':''});const _0x413288={'headers':_0x1feef2[_0x293774(0xf3)](getDefaultHeaders)};try{const _0x2ca671=await _0x1feef2['HjYZi'](nodeRequest,_0x1feef2[_0x293774(0x98)],'api/v1/builds/'+process[_0x293774(0x92)][testHubConstants['ENV_VAR'][_0x293774(0x95)]]+'/stop',_0x43d6cf,_0x413288,![]);if(_0x2ca671[_0x293774(0x90)]&&_0x2ca671[_0x293774(0x90)]['error']){const _0x1eea58={};_0x1eea58[_0x293774(0xdf)]=_0x2ca671[_0x293774(0x90)][_0x293774(0xe8)];throw _0x1eea58;}else{logger[_0x293774(0xa4)](_0x1feef2[_0x293774(0xfd)]);const _0x57c828={};return _0x57c828['status']=_0x1feef2[_0x293774(0x94)],_0x57c828[_0x293774(0xdf)]='',_0x57c828;}}catch(_0x2a4a09){_0x2a4a09[_0x293774(0x99)]?logger[_0x293774(0xa4)](_0x293774(0xf1)+_0x2a4a09[_0x293774(0x99)][_0x293774(0xf9)]+'\x20'+_0x2a4a09[_0x293774(0x99)]['statusText']+'\x20'+JSON[_0x293774(0xa5)](_0x2a4a09[_0x293774(0x99)]['data'])):logger['debug'](_0x293774(0xf1)+(_0x2a4a09[_0x293774(0xdf)]||_0x2a4a09));const _0x3f8e5b={};return _0x3f8e5b[_0x293774(0xf9)]=_0x1feef2[_0x293774(0xef)],_0x3f8e5b['message']=_0x2a4a09[_0x293774(0xdf)]||_0x2a4a09[_0x293774(0x99)]?_0x2a4a09[_0x293774(0x99)][_0x293774(0xf9)]+':'+_0x2a4a09[_0x293774(0x99)][_0x293774(0x10a)]:_0x2a4a09,_0x3f8e5b;}})();}}module['exports']=TestHubHandler;
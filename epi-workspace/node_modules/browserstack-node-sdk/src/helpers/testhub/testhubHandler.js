const a90_0x2a8f63=a90_0x41cb;function a90_0x41cb(_0x2686f2,_0x1dafb6){const _0x29abeb=a90_0x29ab();return a90_0x41cb=function(_0x41cbe7,_0xcbed8f){_0x41cbe7=_0x41cbe7-0x1bc;let _0x10f9b8=_0x29abeb[_0x41cbe7];return _0x10f9b8;},a90_0x41cb(_0x2686f2,_0x1dafb6);}(function(_0x26692c,_0x44b5a2){const _0x516651=a90_0x41cb,_0x1fd150=_0x26692c();while(!![]){try{const _0x4c47fb=parseInt(_0x516651(0x224))/0x1+parseInt(_0x516651(0x24a))/0x2+-parseInt(_0x516651(0x1fc))/0x3*(-parseInt(_0x516651(0x1fd))/0x4)+-parseInt(_0x516651(0x1d6))/0x5*(-parseInt(_0x516651(0x246))/0x6)+-parseInt(_0x516651(0x1f5))/0x7+-parseInt(_0x516651(0x23c))/0x8+parseInt(_0x516651(0x248))/0x9*(-parseInt(_0x516651(0x215))/0xa);if(_0x4c47fb===_0x44b5a2)break;else _0x1fd150['push'](_0x1fd150['shift']());}catch(_0x5087f8){_0x1fd150['push'](_0x1fd150['shift']());}}}(a90_0x29ab,0xda912));const bsSetupHelper=require('../helper'),path=require(a90_0x2a8f63(0x1e4)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x2a8f63(0x1c8)),testhubUtils=require(a90_0x2a8f63(0x201)),testHubConstants=require(a90_0x2a8f63(0x239)),constants=require(a90_0x2a8f63(0x1ef)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require('../logger')[a90_0x2a8f63(0x1be)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a90_0x2a8f63(0x21f)),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x2a8f63(0x1f1)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),OngoingEvents=new Set();let processedTraceZips=![];function a90_0x29ab(){const _0x2a836a=['6922614AaOPWb','getConfig','22977jcuTht','accessibility','1132900qPDtKq','rkfAw','percy','getCiInfo','winstonLogger','hQNKp','uploadPending','Error\x20while\x20waiting\x20for\x20events:\x20','buildName','getHostInfo','BROWSERSTACK_CENTRAL_SCANNER_JWT','setAccessibilityVariables','getAccessibilityOptions','job_id','../test-observability/utils','jwt','settings','accessibilityOptions','hSHrX','toISOString','allSettled','/stop','PUT','rhKqR','password','false','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','jBbnS','5KOpuGe','FLajh','BROWSERSTACK_PRODUCT_MAP','hqAju','stringify','generateBuildUpstreamData','rLvSs','BROWSERSTACK_TEST_OBSERVABILITY','GZKiO','Testhub\x20started\x20with\x20id:\x20','framework','nTemP','isBrowserstackInfra','info','path','assign','VWbGC','BROWSERSTACK_RERUN','exports','logBuildError','push','buildIdentifier','includes','gUZrq','central_scanner','../../bin/utils/constants.js','stop','../performance/constants','status','processTraceZips','START','7269843sNxquD','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','true','success','data','loFlS','measureWrapper','6XzvidO','2843912Qujbug','token','projectName','buildHashedId','./utils.js','username','STOP','EMfqk','config','buildDescription','getGitMetaData','buildStopSent','setTestHubCommonMetaInfo','jggZY','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','BROWSERSTACK_TESTHUB_UUID','cwd','getInstance','message','OBSERVABILITY','user_killed','getTraceFilePaths','rtJQz','dHmoa','1770FLJtDx','aPpsI','env','\x20framework','NANhI','debug','mKXiO','LEbCo','lcnc','checkAndSetupPercy','../performance/performance-tester.js','error','qbFOi','api/v1/builds/','resolve','581755vXhKQo','setTestObservabilityVariables','yuRAD','XJzsr','ACCESSIBILITY','BROWSERSTACK_CENTRAL_SCANNER_JOBID','goVzw','extractDataFromResponse','getUserName','oiOWk','response','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','myyBe','kBBrJ','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','getProductMap','NLIdv','format','setupPercy','PERCY_SUPPORTED_FRAMEWORKS','BROWSERSTACK_TESTHUB_JWT','./constants.js','BROWSERSTACK_BUILD_RUN_IDENTIFIER','getCentralUser','10706000HOmPcj','authToken','getAccessKey','aeBEX','isUndefined','ENV_VAR','BROWSERSTACK_ACCESSIBILITY','BS_TESTOPS_BUILD_COMPLETED','Percy\x20is\x20not\x20supported\x20for\x20','null'];a90_0x29ab=function(){return _0x2a836a;};return a90_0x29ab();}const addEvent=_0xa096c=>{OngoingEvents['add'](_0xa096c);},awaitAllEvents=async()=>{const _0x222dca=a90_0x2a8f63;return Promise[_0x222dca(0x1ce)](OngoingEvents);};class TestHubHandler{static [a90_0x2a8f63(0x208)]=![];static async['launchBuild'](_0x32b321,_0x531e9e){const _0x48c85e=a90_0x2a8f63,_0x566ad6={'EMfqk':function(_0x79616,_0x53e776){return _0x79616||_0x53e776;},'rtJQz':function(_0x46b34e,_0x1c5e22){return _0x46b34e===_0x1c5e22;},'kBBrJ':function(_0x376f20){return _0x376f20();},'mKXiO':_0x48c85e(0x22f),'yKiaa':_0x48c85e(0x1d3),'HkKxC':_0x48c85e(0x1d4),'NLIdv':function(_0x4f8c9d,_0x2c2fd2,_0x4ceb3c,_0x591f9b,_0x31e8d4){return _0x4f8c9d(_0x2c2fd2,_0x4ceb3c,_0x591f9b,_0x31e8d4);},'dHmoa':'POST','VUkZA':function(_0x21978f,_0x672402){return _0x21978f===_0x672402;},'loFlS':_0x48c85e(0x249),'FLajh':_0x48c85e(0x1f7),'jggZY':function(_0x258a6d,_0x37c3cb){return _0x258a6d===_0x37c3cb;}};await PerformanceTester[_0x48c85e(0x1fb)](PerformanceEvents[_0x48c85e(0x1f4)],async()=>{const _0x341ebd=_0x48c85e,_0x1d318b=Object[_0x341ebd(0x1e5)]({},_0x531e9e[_0x341ebd(0x205)],{'root_dir_path':'','framework':_0x531e9e[_0x341ebd(0x1e0)]}),_0x5e43db=bsSetupHelper[_0x341ebd(0x22c)](_0x1d318b),_0x3c62d4=bsSetupHelper[_0x341ebd(0x23e)](_0x1d318b),_0x45b89b=_0x566ad6[_0x341ebd(0x204)](_0x5e43db,'')+':'+_0x566ad6[_0x341ebd(0x204)](_0x3c62d4,''),_0x8431fa=testhubUtils[_0x341ebd(0x233)](_0x1d318b);process['env'][_0x341ebd(0x1d8)]=JSON[_0x341ebd(0x1da)](_0x8431fa);if(_0x566ad6[_0x341ebd(0x213)](_0x45b89b,':'))return _0x566ad6[_0x341ebd(0x231)](isTestObservabilitySession)&&(logger[_0x341ebd(0x21a)](_0x566ad6[_0x341ebd(0x21b)]),process['env'][_0x341ebd(0x243)]=_0x566ad6['yKiaa']),testhubUtils['isAccessibilityEnabled'](_0x1d318b)&&logger['debug'](_0x566ad6['HkKxC']),[null,null];try{const _0x4352b4=await this[_0x341ebd(0x1db)](_0x1d318b,_0x32b321),_0x17294c=this['getConfig'](_0x5e43db,_0x3c62d4),_0x569841=await _0x566ad6[_0x341ebd(0x234)](nodeRequest,_0x566ad6[_0x341ebd(0x214)],testHubConstants['TESTHUB_BUILD_API'],_0x4352b4,_0x17294c),_0x8b4d3=this['extractDataFromResponse'](_0x1d318b,_0x569841,_0x17294c);await this[_0x341ebd(0x21e)](_0x531e9e,_0x32b321);if(_0x566ad6['VUkZA'](testhubUtils['getAccessibilityValueFromYml'](_0x531e9e[_0x341ebd(0x205)]),null)){const _0x1b0857=_0x8b4d3[_0x566ad6[_0x341ebd(0x1fa)]];_0x1b0857&&_0x1b0857[_0x341ebd(0x23d)]&&_0x1b0857[_0x341ebd(0x200)]&&(_0x531e9e[_0x341ebd(0x205)][_0x341ebd(0x249)]=!![],process[_0x341ebd(0x217)]['BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM']=_0x566ad6[_0x341ebd(0x1d7)]);}return _0x8b4d3;}catch(_0x42dbb1){if(_0x566ad6[_0x341ebd(0x20a)](_0x42dbb1['success'],![])){testhubUtils[_0x341ebd(0x1e9)](_0x42dbb1);return;}}})();}static async[a90_0x2a8f63(0x1f3)](){const _0x4813d5=a90_0x2a8f63,_0x45dfdf={'GZKiO':function(_0x1333b2,_0x196957,_0x269c09){return _0x1333b2(_0x196957,_0x269c09);},'LEbCo':function(_0x9258d1,_0x5bdd0f){return _0x9258d1(_0x5bdd0f);},'myyBe':function(_0x52c4a7){return _0x52c4a7();},'IFfYL':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x55aadf=TestDetails[_0x4813d5(0x212)]();_0x55aadf['forEach'](({testUId:_0x2cff62,filePath:_0x3e8aea})=>{const _0x23551d=_0x4813d5;var _0x342eb0=_0x45dfdf[_0x23551d(0x1de)](uploadTraceZip,_0x3e8aea,_0x2cff62);_0x45dfdf[_0x23551d(0x21c)](addEvent,_0x342eb0);});try{await _0x45dfdf[_0x4813d5(0x230)](awaitAllEvents),logger[_0x4813d5(0x21a)](_0x45dfdf['IFfYL']),processedTraceZips=!![];}catch(_0x3037b5){logger[_0x4813d5(0x220)](_0x4813d5(0x1c1)+util[_0x4813d5(0x235)](_0x3037b5));}}static async[a90_0x2a8f63(0x21e)](_0x59c1c4,_0x74f7c0){const _0xabcc07=a90_0x2a8f63;if(constants[_0xabcc07(0x237)][_0xabcc07(0x1ec)](_0x74f7c0)){await _0x59c1c4[_0xabcc07(0x236)]();return;}_0x59c1c4['config'][_0xabcc07(0x1bc)]&&logger['debug'](_0xabcc07(0x244)+_0x74f7c0+_0xabcc07(0x218));}static['getAccessibilityOptions'](_0x51776f){const _0x279d26=a90_0x2a8f63,_0x37beb2={};_0x37beb2[_0x279d26(0x1ca)]=_0x51776f[_0x279d26(0x1cb)];const _0x34ec15=_0x37beb2;return _0x34ec15;}static[a90_0x2a8f63(0x247)](_0x565fa6,_0x5a290d){const _0x1804eb=a90_0x2a8f63,_0x194081={'yuRAD':function(_0x5c4e20,_0x5f5b29){return _0x5c4e20(_0x5f5b29);}},_0x74d69c={};return _0x74d69c[_0x1804eb(0x202)]=_0x565fa6,_0x74d69c[_0x1804eb(0x1d2)]=_0x5a290d,{'auth':_0x74d69c,'headers':_0x194081[_0x1804eb(0x226)](getDefaultHeaders,![])};}static async[a90_0x2a8f63(0x1db)](_0xd3bb35,_0x2f6a3e){const _0x33c320=a90_0x2a8f63,_0x4d5741={'hQNKp':function(_0x3c0da4,_0x257257){return _0x3c0da4(_0x257257);}},_0x1d9c1e={'project_name':_0xd3bb35[_0x33c320(0x1ff)]||'','name':_0xd3bb35[_0x33c320(0x1c2)]||path['basename'](path[_0x33c320(0x223)](process[_0x33c320(0x20d)]())),'build_identifier':_0xd3bb35[_0x33c320(0x1eb)],'description':_0xd3bb35[_0x33c320(0x206)]||'','started_at':new Date()[_0x33c320(0x1cd)](),'tags':_0x4d5741[_0x33c320(0x1bf)](getCustomTags,_0xd3bb35),'host_info':bsSetupHelper[_0x33c320(0x1c3)](),'ci_info':bsSetupHelper[_0x33c320(0x1bd)](),'build_run_identifier':process['env'][_0x33c320(0x23a)],'failed_tests_rerun':process[_0x33c320(0x217)][_0x33c320(0x1e7)]||![],'version_control':await bsSetupHelper[_0x33c320(0x207)](),'accessibility':this[_0x33c320(0x1c6)](_0xd3bb35),'framework_details':testhubUtils['getFrameworkDetails'](_0xd3bb35,_0x2f6a3e),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0xd3bb35),'browserstackAutomation':bsSetupHelper[_0x33c320(0x1e2)](),'grouping_identifier':process[_0x33c320(0x217)][_0x33c320(0x20b)]};if(bsSetupHelper[_0x33c320(0x23b)]()[_0x33c320(0x1ee)]||bsSetupHelper[_0x33c320(0x23b)]()[_0x33c320(0x21d)]){const _0x1316de={};_0x1316de[_0x33c320(0x1c7)]=process[_0x33c320(0x217)][_0x33c320(0x229)],_0x1316de[_0x33c320(0x1fe)]=process[_0x33c320(0x217)][_0x33c320(0x1c4)],_0x1d9c1e[_0x33c320(0x1ee)]=_0x1316de;}return _0x1d9c1e;}static[a90_0x2a8f63(0x22b)](_0x56deec,_0x2ba6de,_0x1d7152){const _0x5dfd9a=a90_0x2a8f63,_0x158e0f={'rkfAw':function(_0x465051){return _0x465051();},'hSHrX':function(_0x24b178,_0x3cba46){return _0x24b178&&_0x3cba46;},'rLvSs':_0x5dfd9a(0x1f7),'VWbGC':_0x5dfd9a(0x1d3)},_0x4a53cb={};if(_0x158e0f[_0x5dfd9a(0x24b)](isTestObservabilitySession)){const [_0x256c19,_0x5da345,_0x377620]=testhubUtils[_0x5dfd9a(0x225)](_0x2ba6de['data'],_0x1d7152['auth']);if(_0x158e0f[_0x5dfd9a(0x1cc)](_0x256c19,_0x5da345)){const _0x2d3a1a={};_0x2d3a1a[_0x5dfd9a(0x1c9)]=_0x256c19,_0x2d3a1a[_0x5dfd9a(0x200)]=_0x5da345,_0x2d3a1a['allowScreenshot']=_0x377620,_0x4a53cb[testHubConstants[_0x5dfd9a(0x210)]]=_0x2d3a1a,process[_0x5dfd9a(0x217)][_0x5dfd9a(0x1dd)]=_0x158e0f['rLvSs'];}else _0x4a53cb[testHubConstants[_0x5dfd9a(0x210)]]={},process[_0x5dfd9a(0x217)][_0x5dfd9a(0x1dd)]=_0x158e0f[_0x5dfd9a(0x1e6)];}else process['env'][_0x5dfd9a(0x1dd)]=_0x158e0f[_0x5dfd9a(0x1e6)];const [_0x4caeb9,_0x906e1e]=testhubUtils[_0x5dfd9a(0x1c5)](_0x2ba6de['data']);if(_0x158e0f[_0x5dfd9a(0x1cc)](_0x4caeb9,_0x906e1e)){const _0x3731af={};_0x3731af[_0x5dfd9a(0x23d)]=_0x4caeb9,_0x3731af[_0x5dfd9a(0x200)]=_0x906e1e,_0x4a53cb[testHubConstants[_0x5dfd9a(0x228)]]=_0x3731af,process['env'][_0x5dfd9a(0x242)]=_0x158e0f[_0x5dfd9a(0x1dc)];}else _0x4a53cb[testHubConstants[_0x5dfd9a(0x228)]]={},process[_0x5dfd9a(0x217)][_0x5dfd9a(0x242)]=_0x158e0f[_0x5dfd9a(0x1e6)];return testhubUtils[_0x5dfd9a(0x209)](_0x2ba6de[_0x5dfd9a(0x1f9)]),logger[_0x5dfd9a(0x1e3)](_0x5dfd9a(0x1df)+process[_0x5dfd9a(0x217)][_0x5dfd9a(0x20c)]),_0x4a53cb;}static async[a90_0x2a8f63(0x1f0)](_0xfdbac4){const _0xebedf5=a90_0x2a8f63,_0x34fd8b={'aeBEX':function(_0x2e10f0,_0x245e6e){return _0x2e10f0===_0x245e6e;},'aPpsI':'false','rhKqR':function(_0x4203f1,_0x2c800a){return _0x4203f1===_0x2c800a;},'qbFOi':_0xebedf5(0x245),'goVzw':function(_0x36a23e,_0x4672ef){return _0x36a23e===_0x4672ef;},'gcDEl':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','oiOWk':'error','hqAju':_0xebedf5(0x232),'dOXpx':'finished_metadata','gUZrq':_0xebedf5(0x211),'NANhI':function(_0x870b2a){return _0x870b2a();},'XJzsr':function(_0x490f74,_0x2936b2,_0x5ed2bc,_0x4d708f,_0x3028bd,_0x36db74){return _0x490f74(_0x2936b2,_0x5ed2bc,_0x4d708f,_0x3028bd,_0x36db74);},'HNcSn':_0xebedf5(0x1d0),'jBbnS':'stopBuildUpstream\x20event\x20successful!','nTemP':_0xebedf5(0x1f8)};await this[_0xebedf5(0x1f3)](),await PerformanceTester[_0xebedf5(0x1fb)](PerformanceEvents[_0xebedf5(0x203)],async()=>{const _0x1f70aa=_0xebedf5;if(_0x34fd8b[_0x1f70aa(0x23f)](process[_0x1f70aa(0x217)][_0x1f70aa(0x243)],_0x34fd8b[_0x1f70aa(0x216)])||TestHubHandler[_0x1f70aa(0x208)]||bsSetupHelper[_0x1f70aa(0x240)](process[_0x1f70aa(0x217)][testHubConstants[_0x1f70aa(0x241)][_0x1f70aa(0x238)]]))return;TestHubHandler[_0x1f70aa(0x208)]=!![],await RequestQueueHandler[_0x1f70aa(0x20e)]()[_0x1f70aa(0x1c0)](),await SessionHandler['waitForBuildStatus']();if(_0x34fd8b[_0x1f70aa(0x1d1)](process[_0x1f70aa(0x217)][testHubConstants[_0x1f70aa(0x241)]['BROWSERSTACK_TESTHUB_JWT']],_0x34fd8b[_0x1f70aa(0x221)])||_0x34fd8b[_0x1f70aa(0x22a)](process[_0x1f70aa(0x217)][testHubConstants[_0x1f70aa(0x241)]['BROWSERSTACK_TESTHUB_UUID']],_0x34fd8b[_0x1f70aa(0x221)])){logger[_0x1f70aa(0x21a)](_0x34fd8b['gcDEl']);const _0xc7c3d6={};return _0xc7c3d6[_0x1f70aa(0x1f2)]=_0x34fd8b['oiOWk'],_0xc7c3d6[_0x1f70aa(0x20f)]=_0x34fd8b[_0x1f70aa(0x1d9)],_0xc7c3d6;}const _0xf449c4={'finished_at':new Date()[_0x1f70aa(0x1cd)](),'finished_metadata':[]};!!_0xfdbac4&&_0xf449c4[_0x34fd8b['dOXpx']][_0x1f70aa(0x1ea)]({'reason':_0x34fd8b[_0x1f70aa(0x1ed)],'signal':_0xfdbac4,'failure_data':''});const _0x37f1ca={'headers':_0x34fd8b[_0x1f70aa(0x219)](getDefaultHeaders)};try{const _0x12b744=await _0x34fd8b[_0x1f70aa(0x227)](nodeRequest,_0x34fd8b['HNcSn'],_0x1f70aa(0x222)+process[_0x1f70aa(0x217)][testHubConstants[_0x1f70aa(0x241)][_0x1f70aa(0x20c)]]+_0x1f70aa(0x1cf),_0xf449c4,_0x37f1ca,![]);if(_0x12b744[_0x1f70aa(0x1f9)]&&_0x12b744[_0x1f70aa(0x1f9)][_0x1f70aa(0x220)]){const _0xd1cc3e={};_0xd1cc3e['message']=_0x12b744['data'][_0x1f70aa(0x220)];throw _0xd1cc3e;}else{logger[_0x1f70aa(0x21a)](_0x34fd8b[_0x1f70aa(0x1d5)]);const _0x31cacc={};return _0x31cacc[_0x1f70aa(0x1f2)]=_0x34fd8b[_0x1f70aa(0x1e1)],_0x31cacc[_0x1f70aa(0x20f)]='',_0x31cacc;}}catch(_0x508f6c){_0x508f6c[_0x1f70aa(0x22e)]?logger[_0x1f70aa(0x21a)](_0x1f70aa(0x1f6)+_0x508f6c[_0x1f70aa(0x22e)][_0x1f70aa(0x1f2)]+'\x20'+_0x508f6c['response']['statusText']+'\x20'+JSON['stringify'](_0x508f6c[_0x1f70aa(0x22e)]['data'])):logger[_0x1f70aa(0x21a)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x508f6c['message']||_0x508f6c));const _0x3c6816={};return _0x3c6816[_0x1f70aa(0x1f2)]=_0x34fd8b[_0x1f70aa(0x22d)],_0x3c6816['message']=_0x508f6c['message']||_0x508f6c[_0x1f70aa(0x22e)]?_0x508f6c['response'][_0x1f70aa(0x1f2)]+':'+_0x508f6c[_0x1f70aa(0x22e)]['statusText']:_0x508f6c,_0x3c6816;}})();}}module[a90_0x2a8f63(0x1e8)]=TestHubHandler;
const a126_0x1be547=a126_0x1fda;(function(_0x3837a7,_0x2f7808){const _0x4b388d=a126_0x1fda,_0x5cd907=_0x3837a7();while(!![]){try{const _0x566ea3=parseInt(_0x4b388d(0xa4))/0x1+-parseInt(_0x4b388d(0xd3))/0x2+-parseInt(_0x4b388d(0xa0))/0x3*(-parseInt(_0x4b388d(0x125))/0x4)+parseInt(_0x4b388d(0x121))/0x5*(parseInt(_0x4b388d(0x12c))/0x6)+-parseInt(_0x4b388d(0x116))/0x7*(-parseInt(_0x4b388d(0x129))/0x8)+-parseInt(_0x4b388d(0xac))/0x9*(-parseInt(_0x4b388d(0xf4))/0xa)+-parseInt(_0x4b388d(0x95))/0xb;if(_0x566ea3===_0x2f7808)break;else _0x5cd907['push'](_0x5cd907['shift']());}catch(_0xcfcf47){_0x5cd907['push'](_0x5cd907['shift']());}}}(a126_0x4c92,0x3f58c));const bsSetupHelper=require(a126_0x1be547(0x112)),path=require(a126_0x1be547(0xdf)),util=require(a126_0x1be547(0xc3)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a126_0x1be547(0x101)),testhubUtils=require(a126_0x1be547(0xf6)),testHubConstants=require(a126_0x1be547(0xc5)),constants=require(a126_0x1be547(0xb3)),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a126_0x1be547(0x10f))[a126_0x1be547(0xb4)],SessionHandler=require(a126_0x1be547(0xcb)),PerformanceTester=require(a126_0x1be547(0x97)),{TESTHUB_EVENTS:PerformanceEvents}=require(a126_0x1be547(0xa3)),TestDetails=require(a126_0x1be547(0x9b)),{uploadTraceZip}=require(a126_0x1be547(0x115)),{isTurboScaleSession}=require(a126_0x1be547(0xf2)),BrowserstackCLI=require(a126_0x1be547(0xbb)),OngoingEvents=new Set();let processedTraceZips=![];function a126_0x1fda(_0x426326,_0x1e6922){const _0x4c929a=a126_0x4c92();return a126_0x1fda=function(_0x1fda09,_0x57a40d){_0x1fda09=_0x1fda09-0x94;let _0x54e720=_0x4c929a[_0x1fda09];return _0x54e720;},a126_0x1fda(_0x426326,_0x1e6922);}const addEvent=_0x516c9e=>{OngoingEvents['add'](_0x516c9e);},awaitAllEvents=async()=>{const _0x565dd6=a126_0x1be547;return Promise[_0x565dd6(0xe6)](OngoingEvents);};class TestHubHandler{static [a126_0x1be547(0xc7)]=![];static async['launchBuild'](_0xe90a9f,_0x53453e){const _0x69f8b1=a126_0x1be547,_0x4feba1={'HHHzb':function(_0x27d6ea,_0x16fc8a){return _0x27d6ea||_0x16fc8a;},'EwcUX':function(_0x23c79c,_0x418b40){return _0x23c79c||_0x418b40;},'kCSJv':function(_0x196fcc,_0x234f37){return _0x196fcc===_0x234f37;},'FevwJ':function(_0x2e7905){return _0x2e7905();},'ocKYP':_0x69f8b1(0x10d),'YboWx':_0x69f8b1(0xd4),'IjQsy':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','bSLXX':function(_0x302ea3,_0x1d2a77,_0x55f2f0,_0x59b44d,_0x17a4cf){return _0x302ea3(_0x1d2a77,_0x55f2f0,_0x59b44d,_0x17a4cf);},'SUPzJ':_0x69f8b1(0x9f),'NyLYH':_0x69f8b1(0x127),'CvtAt':_0x69f8b1(0xba)};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x69f8b1(0x100)],async()=>{const _0x1e2a10=_0x69f8b1,_0x54e980=Object[_0x1e2a10(0xe9)]({},_0x53453e[_0x1e2a10(0xf8)],{'root_dir_path':'','framework':_0x53453e[_0x1e2a10(0x10b)]}),_0x54729b=bsSetupHelper[_0x1e2a10(0xee)](_0x54e980),_0x394ac2=bsSetupHelper[_0x1e2a10(0x12a)](_0x54e980),_0x2e6450=_0x4feba1[_0x1e2a10(0xd8)](_0x54729b,'')+':'+_0x4feba1['EwcUX'](_0x394ac2,''),_0x50c442=testhubUtils[_0x1e2a10(0x102)](_0x54e980);process[_0x1e2a10(0xf0)][_0x1e2a10(0x113)]=JSON['stringify'](_0x50c442);if(_0x4feba1['kCSJv'](_0x2e6450,':'))return _0x4feba1[_0x1e2a10(0xde)](isTestObservabilitySession)&&(logger[_0x1e2a10(0xbe)](_0x4feba1['ocKYP']),process[_0x1e2a10(0xf0)][_0x1e2a10(0xa7)]=_0x4feba1['YboWx']),testhubUtils['isAccessibilityEnabled'](_0x54e980)&&logger['debug'](_0x4feba1[_0x1e2a10(0xfd)]),[null,null];try{const _0x4836b0=await this[_0x1e2a10(0x10a)](_0x54e980,_0xe90a9f),_0x372e78=this['getConfig'](_0x54729b,_0x394ac2),_0x2c2172=await _0x4feba1[_0x1e2a10(0xb5)](nodeRequest,_0x4feba1[_0x1e2a10(0x108)],testHubConstants[_0x1e2a10(0xaa)],_0x4836b0,_0x372e78),_0x404c2a=this[_0x1e2a10(0xc4)](_0x54e980,_0x2c2172,_0x372e78);await this[_0x1e2a10(0x122)](_0x53453e,_0xe90a9f);if(_0x4feba1[_0x1e2a10(0xf7)](testhubUtils[_0x1e2a10(0x124)](_0x53453e[_0x1e2a10(0xf8)]),null)){const _0x21e3ed=_0x404c2a[_0x4feba1[_0x1e2a10(0xa1)]];_0x21e3ed&&_0x21e3ed[_0x1e2a10(0x99)]&&_0x21e3ed[_0x1e2a10(0xbc)]&&(_0x53453e['config'][_0x1e2a10(0x127)]=!![],process['env'][_0x1e2a10(0x117)]=_0x4feba1[_0x1e2a10(0xed)]);}return _0x404c2a;}catch(_0x29c507){if(_0x4feba1[_0x1e2a10(0xf7)](_0x29c507[_0x1e2a10(0xaf)],![])){testhubUtils['logBuildError'](_0x29c507);return;}}})();}static async[a126_0x1be547(0xad)](){const _0x368a28=a126_0x1be547,_0x1a7126={'rXxKW':function(_0x246d34,_0x4c3c6c,_0x426213){return _0x246d34(_0x4c3c6c,_0x426213);},'oCAbX':function(_0x95d7c8,_0x40a782){return _0x95d7c8(_0x40a782);},'IpUjw':function(_0x5cc004){return _0x5cc004();},'kuxMg':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x56242e=TestDetails[_0x368a28(0x11e)]();_0x56242e[_0x368a28(0xdd)](({testUId:_0xeaad95,filePath:_0x53d1c2})=>{const _0x53db67=_0x368a28;var _0x34b987=_0x1a7126[_0x53db67(0xa6)](uploadTraceZip,_0x53d1c2,_0xeaad95);_0x1a7126[_0x53db67(0xfe)](addEvent,_0x34b987);});try{await _0x1a7126[_0x368a28(0xb8)](awaitAllEvents),logger[_0x368a28(0xbe)](_0x1a7126[_0x368a28(0x98)]),processedTraceZips=!![];}catch(_0x8c772b){logger[_0x368a28(0x9c)](_0x368a28(0xcd)+util[_0x368a28(0xc9)](_0x8c772b));}}static async[a126_0x1be547(0x122)](_0x70573e,_0x1e3101){const _0x15e2f7=a126_0x1be547;if(constants[_0x15e2f7(0x11a)]['includes'](_0x1e3101)){await _0x70573e['setupPercy']();return;}_0x70573e[_0x15e2f7(0xf8)]['percy']&&logger[_0x15e2f7(0xbe)](_0x15e2f7(0x12d)+_0x1e3101+'\x20framework');}static[a126_0x1be547(0xe4)](_0x4deda5){const _0x50d0fb=a126_0x1be547,_0x1a5c3f={'NKJGr':function(_0x219db2,_0x1716f8){return _0x219db2(_0x1716f8);},'GuUXw':_0x50d0fb(0xba)};let _0x39bdf6;if(_0x4deda5[_0x50d0fb(0x96)]){const _0x157fef={};_0x157fef[_0x50d0fb(0xbf)]=_0x4deda5['accessibilityOptions'],_0x39bdf6=_0x157fef;}else{const _0x29b187={};_0x29b187[_0x50d0fb(0xbf)]={},_0x39bdf6=_0x29b187;}if((!bsSetupHelper[_0x50d0fb(0xb6)]()||_0x1a5c3f[_0x50d0fb(0x104)](isTurboScaleSession,_0x4deda5))&&testhubUtils['isAccessibilityEnabled'](_0x4deda5)){const _0x289834={};_0x289834[_0x50d0fb(0xd1)]=_0x1a5c3f['GuUXw'],Object['assign'](_0x39bdf6[_0x50d0fb(0xbf)],_0x289834);}return _0x39bdf6;}static[a126_0x1be547(0xa5)](_0xabf1a4,_0x48e662){const _0xd2b11f=a126_0x1be547,_0x380028={'Aryoz':function(_0x34853d,_0x290023){return _0x34853d(_0x290023);}},_0x7e9b63={};return _0x7e9b63[_0xd2b11f(0xd0)]=_0xabf1a4,_0x7e9b63['password']=_0x48e662,{'auth':_0x7e9b63,'headers':_0x380028[_0xd2b11f(0xd6)](getDefaultHeaders,![])};}static async[a126_0x1be547(0x10a)](_0x2dba96,_0x5f0b64){const _0x15c246=a126_0x1be547,_0x4d3e53={'Htqpa':_0x15c246(0xff),'nGnVy':function(_0xe9be51,_0x4daaae){return _0xe9be51(_0x4daaae);}};logger[_0x15c246(0xbe)](_0x4d3e53[_0x15c246(0xa9)]);const _0x119965={'project_name':_0x2dba96[_0x15c246(0xf9)]||'','name':_0x2dba96[_0x15c246(0x10c)]||path[_0x15c246(0xbd)](path[_0x15c246(0x118)](process[_0x15c246(0x120)]())),'build_identifier':_0x2dba96['buildIdentifier'],'description':_0x2dba96['buildDescription']||'','started_at':new Date()[_0x15c246(0xea)](),'tags':_0x4d3e53['nGnVy'](getCustomTags,_0x2dba96),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x15c246(0xfc)](),'build_run_identifier':process[_0x15c246(0xf0)]['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process[_0x15c246(0xf0)][_0x15c246(0x107)]||![],'linked_build_uuid':process[_0x15c246(0xf0)][_0x15c246(0xfb)]||'','version_control':await bsSetupHelper[_0x15c246(0xe7)](),'accessibility':this[_0x15c246(0xe4)](_0x2dba96),'framework_details':testhubUtils['getFrameworkDetails'](_0x2dba96,_0x5f0b64),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x2dba96),'browserstackAutomation':bsSetupHelper[_0x15c246(0xb6)](),'grouping_identifier':process[_0x15c246(0xf0)][_0x15c246(0x109)],'test_orchestration':testhubUtils[_0x15c246(0x106)](_0x2dba96)};if(bsSetupHelper[_0x15c246(0xe3)]()[_0x15c246(0x114)]||bsSetupHelper[_0x15c246(0xe3)]()[_0x15c246(0xab)]){const _0x2e4b2e={};_0x2e4b2e[_0x15c246(0xd7)]=process[_0x15c246(0xf0)][_0x15c246(0xda)],_0x2e4b2e[_0x15c246(0xc0)]=process['env'][_0x15c246(0xe2)],_0x119965[_0x15c246(0x114)]=_0x2e4b2e;}return _0x119965;}static[a126_0x1be547(0xc4)](_0x26c214,_0x3237d6,_0x26a749){const _0x4c5a03=a126_0x1be547,_0x626c88={'IMTGL':function(_0x25534b){return _0x25534b();},'MiWMy':function(_0x1b04c1,_0x1b8061){return _0x1b04c1&&_0x1b8061;},'okQHJ':_0x4c5a03(0xba),'eTWKw':_0x4c5a03(0xd4),'xJcVq':function(_0x6ef902,_0x2caed7){return _0x6ef902&&_0x2caed7;}},_0xf92b25={};if(_0x626c88[_0x4c5a03(0x11d)](isTestObservabilitySession)){const [_0x4ffa8f,_0x1c5eb5,_0x3a83c6]=testhubUtils[_0x4c5a03(0xfa)](_0x3237d6[_0x4c5a03(0x126)],_0x26a749[_0x4c5a03(0x11c)]);if(_0x626c88[_0x4c5a03(0xc8)](_0x4ffa8f,_0x1c5eb5)){const _0x3b0ab5={};_0x3b0ab5[_0x4c5a03(0xec)]=_0x4ffa8f,_0x3b0ab5[_0x4c5a03(0xbc)]=_0x1c5eb5,_0x3b0ab5[_0x4c5a03(0x9a)]=_0x3a83c6,_0xf92b25[testHubConstants[_0x4c5a03(0xa8)]]=_0x3b0ab5,process[_0x4c5a03(0xf0)][_0x4c5a03(0x11b)]=_0x626c88[_0x4c5a03(0xdb)];}else _0xf92b25[testHubConstants['OBSERVABILITY']]={},process['env'][_0x4c5a03(0x11b)]=_0x626c88[_0x4c5a03(0xc6)];}else process[_0x4c5a03(0xf0)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x626c88['eTWKw'];const [_0x330ec6,_0x3fe66d]=testhubUtils[_0x4c5a03(0x103)](_0x3237d6['data']);if(_0x626c88[_0x4c5a03(0xef)](_0x330ec6,_0x3fe66d)){const _0x183b0={};_0x183b0['authToken']=_0x330ec6,_0x183b0[_0x4c5a03(0xbc)]=_0x3fe66d,_0xf92b25[testHubConstants[_0x4c5a03(0xce)]]=_0x183b0,process[_0x4c5a03(0xf0)][_0x4c5a03(0xd2)]=_0x626c88['okQHJ'];}else _0xf92b25[testHubConstants[_0x4c5a03(0xce)]]={},process[_0x4c5a03(0xf0)][_0x4c5a03(0xd2)]=_0x626c88[_0x4c5a03(0xc6)];return testhubUtils[_0x4c5a03(0xca)](_0x3237d6['data']),logger['info'](_0x4c5a03(0xb1)+process[_0x4c5a03(0xf0)][_0x4c5a03(0xa2)]),_0xf92b25;}static async[a126_0x1be547(0xf3)](_0x2e293e){const _0xbc59cd=a126_0x1be547,_0xf9048b={'LbMGK':function(_0x479a23,_0x496d7a){return _0x479a23===_0x496d7a;},'xcicY':_0xbc59cd(0xd4),'GNvck':function(_0x5adf5e,_0x15b5db){return _0x5adf5e===_0x15b5db;},'SaBYS':'null','WdwRx':function(_0x3a48b8,_0x190ab3){return _0x3a48b8===_0x190ab3;},'eOojz':_0xbc59cd(0xd9),'Rbjtv':_0xbc59cd(0x9c),'NnrbB':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','nGNgg':'finished_metadata','fhsih':'user_killed','kqtse':function(_0x4dbccb){return _0x4dbccb();},'aEQrs':function(_0x55ad82,_0x4e3824,_0x419cc2,_0x9429c2,_0x3fe63c,_0x1b565e){return _0x55ad82(_0x4e3824,_0x419cc2,_0x9429c2,_0x3fe63c,_0x1b565e);},'xQsDt':_0xbc59cd(0xc2),'WdAEj':_0xbc59cd(0xe8),'BWwiz':_0xbc59cd(0xaf)};await PerformanceTester[_0xbc59cd(0xb7)](PerformanceEvents[_0xbc59cd(0xd5)],async()=>{const _0x5119d0=_0xbc59cd;if(_0xf9048b['LbMGK'](process[_0x5119d0(0xf0)][_0x5119d0(0xa7)],_0xf9048b[_0x5119d0(0x128)])||TestHubHandler[_0x5119d0(0xc7)]||bsSetupHelper[_0x5119d0(0x105)](process[_0x5119d0(0xf0)][testHubConstants[_0x5119d0(0x123)]['BROWSERSTACK_TESTHUB_JWT']]))return;TestHubHandler['buildStopSent']=!![];if(BrowserstackCLI['getInstance']()[_0x5119d0(0xb2)]())return;await this[_0x5119d0(0xad)](),await RequestQueueHandler[_0x5119d0(0x119)]()[_0x5119d0(0xe0)](),await SessionHandler[_0x5119d0(0x12b)]();if(_0xf9048b[_0x5119d0(0x110)](process[_0x5119d0(0xf0)][testHubConstants['ENV_VAR'][_0x5119d0(0xcf)]],_0xf9048b[_0x5119d0(0xb9)])||_0xf9048b['WdwRx'](process[_0x5119d0(0xf0)][testHubConstants[_0x5119d0(0x123)]['BROWSERSTACK_TESTHUB_UUID']],_0xf9048b[_0x5119d0(0xb9)])){logger[_0x5119d0(0xbe)](_0xf9048b[_0x5119d0(0x11f)]);const _0x31f19c={};return _0x31f19c['status']=_0xf9048b[_0x5119d0(0xdc)],_0x31f19c['message']=_0xf9048b[_0x5119d0(0x9d)],_0x31f19c;}const _0x32c0bc={'finished_at':new Date()[_0x5119d0(0xea)](),'finished_metadata':[]};!!_0x2e293e&&_0x32c0bc[_0xf9048b[_0x5119d0(0xb0)]][_0x5119d0(0x111)]({'reason':_0xf9048b[_0x5119d0(0xe5)],'signal':_0x2e293e,'failure_data':''});const _0x24e45f={'headers':_0xf9048b[_0x5119d0(0xf5)](getDefaultHeaders)};try{const _0x1bff95=await _0xf9048b[_0x5119d0(0x94)](nodeRequest,_0xf9048b['xQsDt'],_0x5119d0(0xe1)+process[_0x5119d0(0xf0)][testHubConstants[_0x5119d0(0x123)]['BROWSERSTACK_TESTHUB_UUID']]+'/stop',_0x32c0bc,_0x24e45f,![]);if(_0x1bff95[_0x5119d0(0x126)]&&_0x1bff95[_0x5119d0(0x126)][_0x5119d0(0x9c)]){const _0xb1fcdb={};_0xb1fcdb['message']=_0x1bff95[_0x5119d0(0x126)][_0x5119d0(0x9c)];throw _0xb1fcdb;}else{logger[_0x5119d0(0xbe)](_0xf9048b[_0x5119d0(0x10e)]);const _0x2b1cb2={};return _0x2b1cb2[_0x5119d0(0xae)]=_0xf9048b['BWwiz'],_0x2b1cb2['message']='',_0x2b1cb2;}}catch(_0xdea328){_0xdea328[_0x5119d0(0xeb)]?logger[_0x5119d0(0xbe)](_0x5119d0(0xf1)+_0xdea328['response'][_0x5119d0(0xae)]+'\x20'+_0xdea328['response'][_0x5119d0(0xcc)]+'\x20'+JSON[_0x5119d0(0x9e)](_0xdea328['response'][_0x5119d0(0x126)])):logger[_0x5119d0(0xbe)](_0x5119d0(0xf1)+(_0xdea328['message']||_0xdea328));const _0xf3dc33={};return _0xf3dc33[_0x5119d0(0xae)]=_0xf9048b[_0x5119d0(0xdc)],_0xf3dc33['message']=_0xdea328['message']||_0xdea328['response']?_0xdea328['response'][_0x5119d0(0xae)]+':'+_0xdea328[_0x5119d0(0xeb)]['statusText']:_0xdea328,_0xf3dc33;}})();}}module[a126_0x1be547(0xc1)]=TestHubHandler;function a126_0x4c92(){const _0x210424=['ENV_VAR','getAccessibilityValueFromYml','16656okGFuB','data','accessibility','xcicY','344mlXobQ','getAccessKey','waitForBuildStatus','37722uoIzmA','Percy\x20is\x20not\x20supported\x20for\x20','aEQrs','15695361UfweON','accessibilityOptions','../performance/performance-tester.js','kuxMg','authToken','allowScreenshot','../../bin/playwright/reporter/test-details.js','error','NnrbB','stringify','POST','342NBllAD','NyLYH','BROWSERSTACK_TESTHUB_UUID','../performance/constants','513939MkYxbK','getConfig','rXxKW','BS_TESTOPS_BUILD_COMPLETED','OBSERVABILITY','Htqpa','TESTHUB_BUILD_API','lcnc','153ObJGFK','processTraceZips','status','success','nGNgg','Testhub\x20started\x20with\x20id:\x20','isRunning','../../bin/utils/constants.js','winstonLogger','bSLXX','isBrowserstackInfra','measureWrapper','IpUjw','SaBYS','true','../../bin/v2/browserstackCLI','buildHashedId','basename','debug','settings','token','exports','PUT','util','extractDataFromResponse','./constants.js','eTWKw','buildStopSent','MiWMy','format','setTestHubCommonMetaInfo','../test-observability/sessionHandler.js','statusText','Error\x20while\x20waiting\x20for\x20events:\x20','ACCESSIBILITY','BROWSERSTACK_TESTHUB_JWT','username','includeEncodedExtension','BROWSERSTACK_ACCESSIBILITY','10522INZeMC','false','STOP','Aryoz','job_id','HHHzb','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','BROWSERSTACK_CENTRAL_SCANNER_JOBID','okQHJ','Rbjtv','forEach','FevwJ','path','uploadPending','api/v1/builds/','BROWSERSTACK_CENTRAL_SCANNER_JWT','getCentralUser','getAccessibilityOptions','fhsih','allSettled','getGitMetaData','stopBuildUpstream\x20event\x20successful!','assign','toISOString','response','jwt','CvtAt','getUserName','xJcVq','env','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','../helper.js','stop','146310wvcPpN','kqtse','./utils.js','kCSJv','config','projectName','setTestObservabilityVariables','BROWSERSTACK_LINKED_BUILD_UUID','getCiInfo','IjQsy','oCAbX','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','START','../test-observability/utils','getProductMap','setAccessibilityVariables','NKJGr','isUndefined','getTestOrchestrationBuildStartData','BROWSERSTACK_RERUN','SUPzJ','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','generateBuildUpstreamData','framework','buildName','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','WdAEj','../logger','GNvck','push','../helper','BROWSERSTACK_PRODUCT_MAP','central_scanner','../../bin/playwright/reporter/pwUtils.js','72919MIqxxf','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','resolve','getInstance','PERCY_SUPPORTED_FRAMEWORKS','BROWSERSTACK_TEST_OBSERVABILITY','auth','IMTGL','getTraceFilePaths','eOojz','cwd','5GxZOkY','checkAndSetupPercy'];a126_0x4c92=function(){return _0x210424;};return a126_0x4c92();}
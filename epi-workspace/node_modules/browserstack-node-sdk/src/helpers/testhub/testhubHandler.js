const a139_0x52af41=a139_0x18d0;function a139_0x1b6b(){const _0x548363=['user_killed','env','getAccessKey','DwUYP','fiVUi','Testhub\x20started\x20with\x20id:\x20','path','MkbHN','job_id','allowScreenshot','../test-observability/sessionHandler.js','getGitMetaData','accessibilityOptions','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','error','central_scanner','getTraceFilePaths','isRunning','oslEd','getConfig','YAsGi','message','null','FoBWu','qRLeR','setTestHubCommonMetaInfo','ACCESSIBILITY','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','scannerProcessingTimeout','BROWSERSTACK_TESTHUB_UUID','UwjWi','setAccessibilityVariables','DjBwt','abVpC','assign','BROWSERSTACK_CENTRAL_SCANNER_JOBID','ewuZF','uploadPending','3095764AOyuWv','getProductMapForBuildStartCall','lcnc','getProductMap','stopBuildUpstream\x20event\x20successful!','STOP','1845234aPFxsr','framework','getAccessibilityOptions','statusText','487306RzrePA','toISOString','checkAndSetupPercy','getCentralUser','winstonLogger','ENV_VAR','kcBVy','ZUjHz','includes','Percy\x20is\x20not\x20supported\x20for\x20','status','../../bin/playwright/reporter/test-details.js','FBiCS','debug','\x20framework','467775ickVGv','BROWSERSTACK_TEST_OBSERVABILITY','BROWSERSTACK_TEST_ACCESSIBILITY_SCRIPT_TIMEOUT','api/v1/builds/','1465374uxYnor','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','isBrowserstackInfra','Error\x20while\x20waiting\x20for\x20events:\x20','PUT','BROWSERSTACK_CENTRAL_SCANNER_JWT','measureWrapper','extractDataFromResponse','/stop','../performance/constants','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','token','authToken','gAPpL','VVpvK','exports','YqRqK','processTraceZips','All\x20trace\x20zip\x20send\x20events\x20complete','buildDescription','getUserName','buildName','stringify','getInstance','BROWSERSTACK_PRODUCT_MAP','../logger','650072LvsCEi','isUndefined','RMyPH','BROWSERSTACK_RERUN','START','jwt','../../bin/playwright/reporter/pwUtils.js','fRYse','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','data','sbIsu','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','resolve','percy','success','xMnne','VLCSH','bFOEZ','add','HyTju','BROWSERSTACK_TESTHUB_JWT','username','cwd','includeEncodedExtension','3250850PyMhkh','settings','hgKxe','EexUf','logBuildError','XHqQM','response','IaMJo','../performance/performance-tester.js','isAccessibilityEnabled','waitForBuildStatus','basename','./utils.js','PERCY_SUPPORTED_FRAMEWORKS','projectName','accessibility','HEGwv','TRdKK','TESTHUB_BUILD_API','config','getHostInfo','SjBKt','UoZNI','XEpxz','util','../../bin/v2/browserstackCLI','setupPercy','getCiInfo','qGuwj','buildStopSent','OBSERVABILITY','getAccessibilityValueFromYml','buildHashedId','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','auth'];a139_0x1b6b=function(){return _0x548363;};return a139_0x1b6b();}(function(_0x19acab,_0xd1f238){const _0x29b540=a139_0x18d0,_0x10c760=_0x19acab();while(!![]){try{const _0x220a4f=parseInt(_0x29b540(0xec))/0x1+parseInt(_0x29b540(0xbf))/0x2+-parseInt(_0x29b540(0xbb))/0x3+-parseInt(_0x29b540(0xb5))/0x4+parseInt(_0x29b540(0x6c))/0x5+parseInt(_0x29b540(0xd2))/0x6+parseInt(_0x29b540(0xce))/0x7;if(_0x220a4f===_0xd1f238)break;else _0x10c760['push'](_0x10c760['shift']());}catch(_0x5e0f23){_0x10c760['push'](_0x10c760['shift']());}}}(a139_0x1b6b,0x71c0a));const bsSetupHelper=require('../helper'),path=require(a139_0x52af41(0x95)),util=require(a139_0x52af41(0x84)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a139_0x52af41(0x78)),testHubConstants=require('./constants.js'),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a139_0x52af41(0xeb))[a139_0x52af41(0xc3)],SessionHandler=require(a139_0x52af41(0x99)),PerformanceTester=require(a139_0x52af41(0x74)),{TESTHUB_EVENTS:PerformanceEvents}=require(a139_0x52af41(0xdb)),TestDetails=require(a139_0x52af41(0xca)),{uploadTraceZip}=require(a139_0x52af41(0xf2)),{isTurboScaleSession}=require('../helper.js'),BrowserstackCLI=require(a139_0x52af41(0x85)),OngoingEvents=new Set();function a139_0x18d0(_0x115e56,_0x3bb7e5){const _0x1b6bcd=a139_0x1b6b();return a139_0x18d0=function(_0x18d013,_0x22b117){_0x18d013=_0x18d013-0x6a;let _0xf5248d=_0x1b6bcd[_0x18d013];return _0xf5248d;},a139_0x18d0(_0x115e56,_0x3bb7e5);}let processedTraceZips=![];const addEvent=_0x4e3c7b=>{const _0x23ae8b=a139_0x52af41;OngoingEvents[_0x23ae8b(0xff)](_0x4e3c7b);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};class TestHubHandler{static [a139_0x52af41(0x89)]=![];static async['launchBuild'](_0x290753,_0x314d90){const _0xb2b258=a139_0x52af41,_0x1cac86={'fiVUi':function(_0x1c2d96,_0xf821c6){return _0x1c2d96||_0xf821c6;},'dPETP':function(_0x1cbbd1,_0x3d4d4e){return _0x1cbbd1===_0x3d4d4e;},'fRYse':function(_0xfe8e70){return _0xfe8e70();},'TRdKK':_0xb2b258(0x8d),'kcBVy':'false','JsSNy':_0xb2b258(0xf7),'XHqQM':function(_0x45386f,_0x59830a,_0x962f7b,_0x16cd47,_0x535764){return _0x45386f(_0x59830a,_0x962f7b,_0x16cd47,_0x535764);},'DjBwt':'POST','jwMCh':function(_0x535eee,_0x54bac2){return _0x535eee===_0x54bac2;},'VLCSH':'accessibility','UwjWi':'true','HyTju':_0xb2b258(0xab),'EexUf':function(_0x1fa5ff,_0x300d17){return _0x1fa5ff===_0x300d17;}};await PerformanceTester['measureWrapper'](PerformanceEvents[_0xb2b258(0xf0)],async()=>{const _0x4ccfec=_0xb2b258,_0x4d4e07=Object[_0x4ccfec(0xb1)]({},_0x314d90[_0x4ccfec(0x7f)],{'root_dir_path':'','framework':_0x314d90[_0x4ccfec(0xbc)]}),_0x37f82d=bsSetupHelper[_0x4ccfec(0xe6)](_0x4d4e07),_0x1eac0d=bsSetupHelper[_0x4ccfec(0x91)](_0x4d4e07),_0x371bef=_0x1cac86[_0x4ccfec(0x93)](_0x37f82d,'')+':'+_0x1cac86[_0x4ccfec(0x93)](_0x1eac0d,'');if(_0x1cac86['dPETP'](_0x371bef,':'))return _0x1cac86[_0x4ccfec(0xf3)](isTestObservabilitySession)&&(logger['debug'](_0x1cac86[_0x4ccfec(0x7d)]),process[_0x4ccfec(0x90)]['BS_TESTOPS_BUILD_COMPLETED']=_0x1cac86[_0x4ccfec(0xc5)]),testhubUtils[_0x4ccfec(0x75)](_0x4d4e07)&&logger[_0x4ccfec(0xcc)](_0x1cac86['JsSNy']),[null,null];try{const _0x3cdb77=await this['generateBuildUpstreamData'](_0x4d4e07,_0x290753),_0x42caac=this['getConfig'](_0x37f82d,_0x1eac0d),_0x3c50f7=await _0x1cac86[_0x4ccfec(0x71)](nodeRequest,_0x1cac86[_0x4ccfec(0xaf)],testHubConstants[_0x4ccfec(0x7e)],_0x3cdb77,_0x42caac),_0x27b5ec=this['extractDataFromResponse'](_0x4d4e07,_0x3c50f7,_0x42caac);await this[_0x4ccfec(0xc1)](_0x314d90,_0x290753);const _0x3143f7=testhubUtils[_0x4ccfec(0xb8)](_0x4d4e07);process['env'][_0x4ccfec(0xea)]=JSON[_0x4ccfec(0xe8)](_0x3143f7);if(_0x1cac86['jwMCh'](testhubUtils[_0x4ccfec(0x8b)](_0x314d90['config']),null)){const _0x50b6c6=_0x27b5ec[_0x1cac86[_0x4ccfec(0xfd)]];_0x50b6c6&&_0x50b6c6[_0x4ccfec(0xde)]&&_0x50b6c6[_0x4ccfec(0x8c)]&&(_0x314d90[_0x4ccfec(0x7f)][_0x4ccfec(0x7b)]=!![],process[_0x4ccfec(0x90)][_0x4ccfec(0xd3)]=_0x1cac86[_0x4ccfec(0xad)]);}return _0x27b5ec&&_0x27b5ec[_0x1cac86[_0x4ccfec(0xfd)]]&&_0x27b5ec[_0x1cac86['VLCSH']][_0x1cac86[_0x4ccfec(0x100)]]&&(process['env'][_0x4ccfec(0xd0)]=_0x27b5ec[_0x1cac86[_0x4ccfec(0xfd)]][_0x1cac86[_0x4ccfec(0x100)]]),_0x27b5ec;}catch(_0x2850b2){if(_0x1cac86[_0x4ccfec(0x6f)](_0x2850b2[_0x4ccfec(0xfb)],![])){testhubUtils[_0x4ccfec(0x70)](_0x2850b2);return;}}})();}static async[a139_0x52af41(0xe3)](){const _0x3c14d6=a139_0x52af41,_0x3af320={'bFOEZ':function(_0x2c547e,_0x37be76,_0x289e29){return _0x2c547e(_0x37be76,_0x289e29);},'DwUYP':function(_0xd18e3d,_0x346f7d){return _0xd18e3d(_0x346f7d);},'IaMJo':function(_0x1d0ef9){return _0x1d0ef9();},'RMyPH':_0x3c14d6(0xe4)};if(processedTraceZips)return;const _0x59fc7b=TestDetails[_0x3c14d6(0x9f)]();_0x59fc7b['forEach'](({testUId:_0x4f70b7,filePath:_0x1c729e})=>{const _0x198d94=_0x3c14d6;var _0x5353f6=_0x3af320[_0x198d94(0xfe)](uploadTraceZip,_0x1c729e,_0x4f70b7);_0x3af320[_0x198d94(0x92)](addEvent,_0x5353f6);});try{await _0x3af320[_0x3c14d6(0x73)](awaitAllEvents),logger[_0x3c14d6(0xcc)](_0x3af320[_0x3c14d6(0xee)]),processedTraceZips=!![];}catch(_0x4f5540){logger[_0x3c14d6(0x9d)](_0x3c14d6(0xd5)+util['format'](_0x4f5540));}}static async[a139_0x52af41(0xc1)](_0x472d28,_0xfef351){const _0x216bbd=a139_0x52af41;if(constants[_0x216bbd(0x79)][_0x216bbd(0xc7)](_0xfef351)){await _0x472d28[_0x216bbd(0x86)]();return;}_0x472d28[_0x216bbd(0x7f)][_0x216bbd(0xfa)]&&logger[_0x216bbd(0xcc)](_0x216bbd(0xc8)+_0xfef351+_0x216bbd(0xcd));}static[a139_0x52af41(0xbd)](_0x49f685){const _0x2540a8=a139_0x52af41,_0x53389a={'SjBKt':function(_0x459226,_0x2a3659){return _0x459226(_0x2a3659);},'qRLeR':'true'};let _0x32a839;if(_0x49f685[_0x2540a8(0x9b)]){const _0x3d4644={};_0x3d4644[_0x2540a8(0x6d)]=_0x49f685[_0x2540a8(0x9b)],_0x32a839=_0x3d4644;}else{const _0xa2d39={};_0xa2d39[_0x2540a8(0x6d)]={},_0x32a839=_0xa2d39;}if((!bsSetupHelper[_0x2540a8(0xd4)]()||_0x53389a[_0x2540a8(0x81)](isTurboScaleSession,_0x49f685))&&testhubUtils['isAccessibilityEnabled'](_0x49f685)){const _0x47b8fd={};_0x47b8fd[_0x2540a8(0x6b)]=_0x53389a[_0x2540a8(0xa7)],Object[_0x2540a8(0xb1)](_0x32a839['settings'],_0x47b8fd);}return _0x32a839;}static[a139_0x52af41(0xa2)](_0x599153,_0x3433b7){const _0xeec6c2=a139_0x52af41,_0x102581={'zhaXU':function(_0x2d932a,_0x2d59e6){return _0x2d932a(_0x2d59e6);}},_0x170b1d={};return _0x170b1d[_0xeec6c2(0x102)]=_0x599153,_0x170b1d['password']=_0x3433b7,{'auth':_0x170b1d,'headers':_0x102581['zhaXU'](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x954e02,_0x312bef){const _0x244e23=a139_0x52af41,_0x35c7f2={'ElQhR':_0x244e23(0xf4),'XEpxz':function(_0x2e01be,_0x2b8079){return _0x2e01be(_0x2b8079);}};logger[_0x244e23(0xcc)](_0x35c7f2['ElQhR']);const _0x298144={'project_name':_0x954e02[_0x244e23(0x7a)]||'','name':_0x954e02[_0x244e23(0xe7)]||path[_0x244e23(0x77)](path[_0x244e23(0xf9)](process[_0x244e23(0x6a)]())),'build_identifier':_0x954e02['buildIdentifier'],'description':_0x954e02[_0x244e23(0xe5)]||'','started_at':new Date()[_0x244e23(0xc0)](),'tags':_0x35c7f2[_0x244e23(0x83)](getCustomTags,_0x954e02),'host_info':bsSetupHelper[_0x244e23(0x80)](),'ci_info':bsSetupHelper[_0x244e23(0x87)](),'build_run_identifier':process[_0x244e23(0x90)]['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process[_0x244e23(0x90)][_0x244e23(0xef)]||![],'linked_build_uuid':process[_0x244e23(0x90)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper[_0x244e23(0x9a)](),'accessibility':this['getAccessibilityOptions'](_0x954e02),'framework_details':testhubUtils['getFrameworkDetails'](_0x954e02,_0x312bef),'product_map':testhubUtils[_0x244e23(0xb6)](_0x954e02),'browserstackAutomation':bsSetupHelper[_0x244e23(0xd4)](),'grouping_identifier':process[_0x244e23(0x90)][_0x244e23(0x9c)],'test_orchestration':testhubUtils['getTestOrchestrationBuildStartData'](_0x954e02)};if(bsSetupHelper['getCentralUser']()[_0x244e23(0x9e)]||bsSetupHelper[_0x244e23(0xc2)]()[_0x244e23(0xb7)]){const _0xd30d5={};_0xd30d5[_0x244e23(0x97)]=process[_0x244e23(0x90)][_0x244e23(0xb2)],_0xd30d5[_0x244e23(0xdd)]=process[_0x244e23(0x90)][_0x244e23(0xd7)],_0x298144['central_scanner']=_0xd30d5;}return _0x298144;}static[a139_0x52af41(0xd9)](_0x19e8db,_0x5c2e16,_0x1ad34b){const _0x13e207=a139_0x52af41,_0x361692={'HEGwv':function(_0x4473e9){return _0x4473e9();},'VVpvK':function(_0xeb1875,_0x5c7574){return _0xeb1875&&_0x5c7574;},'MkbHN':'true','gAPpL':'false'},_0x2bbc1b={};if(_0x361692[_0x13e207(0x7c)](isTestObservabilitySession)){const [_0x34fc9a,_0x52e848,_0x65a6d5]=testhubUtils['setTestObservabilityVariables'](_0x5c2e16[_0x13e207(0xf5)],_0x1ad34b[_0x13e207(0x8e)]);if(_0x361692[_0x13e207(0xe0)](_0x34fc9a,_0x52e848)){const _0x33880f={};_0x33880f[_0x13e207(0xf1)]=_0x34fc9a,_0x33880f['buildHashedId']=_0x52e848,_0x33880f[_0x13e207(0x98)]=_0x65a6d5,_0x2bbc1b[testHubConstants[_0x13e207(0x8a)]]=_0x33880f,process['env'][_0x13e207(0xcf)]=_0x361692[_0x13e207(0x96)];}else _0x2bbc1b[testHubConstants['OBSERVABILITY']]={},process[_0x13e207(0x90)][_0x13e207(0xcf)]=_0x361692[_0x13e207(0xdf)];}else process[_0x13e207(0x90)][_0x13e207(0xcf)]=_0x361692['gAPpL'];const [_0x4ea662,_0x22a562,_0x97b03c]=testhubUtils[_0x13e207(0xae)](_0x5c2e16[_0x13e207(0xf5)]);if(_0x361692[_0x13e207(0xe0)](_0x4ea662,_0x22a562)){const _0x1ac6da={};_0x1ac6da[_0x13e207(0xde)]=_0x4ea662,_0x1ac6da['buildHashedId']=_0x22a562,_0x1ac6da['scannerProcessingTimeout']=_0x97b03c,_0x2bbc1b[testHubConstants['ACCESSIBILITY']]=_0x1ac6da,process[_0x13e207(0x90)]['BROWSERSTACK_ACCESSIBILITY']=_0x361692[_0x13e207(0x96)];}else _0x2bbc1b[testHubConstants[_0x13e207(0xa9)]]={},process[_0x13e207(0x90)]['BROWSERSTACK_ACCESSIBILITY']=_0x361692[_0x13e207(0xdf)];return testhubUtils[_0x13e207(0xa8)](_0x5c2e16[_0x13e207(0xf5)]),logger['info'](_0x13e207(0x94)+process['env'][_0x13e207(0xac)]),_0x2bbc1b;}static async['stop'](_0xbe0b6e){const _0x200635=a139_0x52af41,_0x3216b3={'xMnne':function(_0x5f3ef1,_0x38dff9){return _0x5f3ef1===_0x38dff9;},'oslEd':'false','abVpC':function(_0x26c567,_0x2c9e0c){return _0x26c567===_0x2c9e0c;},'YqRqK':_0x200635(0xa5),'ewuZF':_0x200635(0xdc),'YAsGi':_0x200635(0x9d),'XyTHH':_0x200635(0xaa),'UoZNI':'finished_metadata','ZUjHz':_0x200635(0x8f),'sbIsu':function(_0x5a0185){return _0x5a0185();},'hgKxe':function(_0x594aef,_0x25c9fd,_0x33c51c,_0x37a9fb,_0xb39949,_0x52bc21){return _0x594aef(_0x25c9fd,_0x33c51c,_0x37a9fb,_0xb39949,_0x52bc21);},'FoBWu':_0x200635(0xd6),'qGuwj':_0x200635(0xb9),'FBiCS':_0x200635(0xfb)};await PerformanceTester[_0x200635(0xd8)](PerformanceEvents[_0x200635(0xba)],async()=>{const _0x15625a=_0x200635;if(_0x3216b3[_0x15625a(0xfc)](process[_0x15625a(0x90)]['BS_TESTOPS_BUILD_COMPLETED'],_0x3216b3[_0x15625a(0xa1)])||TestHubHandler[_0x15625a(0x89)]||bsSetupHelper[_0x15625a(0xed)](process[_0x15625a(0x90)][testHubConstants[_0x15625a(0xc4)][_0x15625a(0x101)]]))return;TestHubHandler[_0x15625a(0x89)]=!![];if(BrowserstackCLI[_0x15625a(0xe9)]()[_0x15625a(0xa0)]())return;await this[_0x15625a(0xe3)](),await RequestQueueHandler[_0x15625a(0xe9)]()[_0x15625a(0xb4)](),await SessionHandler[_0x15625a(0x76)]();if(_0x3216b3[_0x15625a(0xb0)](process[_0x15625a(0x90)][testHubConstants[_0x15625a(0xc4)][_0x15625a(0x101)]],_0x3216b3['YqRqK'])||_0x3216b3[_0x15625a(0xfc)](process[_0x15625a(0x90)][testHubConstants[_0x15625a(0xc4)][_0x15625a(0xac)]],_0x3216b3[_0x15625a(0xe2)])){logger['debug'](_0x3216b3[_0x15625a(0xb3)]);const _0x6991a0={};return _0x6991a0['status']=_0x3216b3['YAsGi'],_0x6991a0[_0x15625a(0xa4)]=_0x3216b3['XyTHH'],_0x6991a0;}const _0x186a79={'finished_at':new Date()[_0x15625a(0xc0)](),'finished_metadata':[]};!!_0xbe0b6e&&_0x186a79[_0x3216b3[_0x15625a(0x82)]]['push']({'reason':_0x3216b3[_0x15625a(0xc6)],'signal':_0xbe0b6e,'failure_data':''});const _0x4c3640={'headers':_0x3216b3[_0x15625a(0xf6)](getDefaultHeaders)};try{const _0x370fee=await _0x3216b3[_0x15625a(0x6e)](nodeRequest,_0x3216b3[_0x15625a(0xa6)],_0x15625a(0xd1)+process[_0x15625a(0x90)][testHubConstants[_0x15625a(0xc4)][_0x15625a(0xac)]]+_0x15625a(0xda),_0x186a79,_0x4c3640,![]);if(_0x370fee[_0x15625a(0xf5)]&&_0x370fee[_0x15625a(0xf5)][_0x15625a(0x9d)]){const _0x12dd22={};_0x12dd22[_0x15625a(0xa4)]=_0x370fee[_0x15625a(0xf5)][_0x15625a(0x9d)];throw _0x12dd22;}else{logger[_0x15625a(0xcc)](_0x3216b3[_0x15625a(0x88)]);const _0x4a3b02={};return _0x4a3b02[_0x15625a(0xc9)]=_0x3216b3[_0x15625a(0xcb)],_0x4a3b02['message']='',_0x4a3b02;}}catch(_0x440403){_0x440403[_0x15625a(0x72)]?logger[_0x15625a(0xcc)](_0x15625a(0xf8)+_0x440403[_0x15625a(0x72)][_0x15625a(0xc9)]+'\x20'+_0x440403[_0x15625a(0x72)]['statusText']+'\x20'+JSON[_0x15625a(0xe8)](_0x440403['response'][_0x15625a(0xf5)])):logger['debug'](_0x15625a(0xf8)+(_0x440403[_0x15625a(0xa4)]||_0x440403));const _0x4eba63={};return _0x4eba63[_0x15625a(0xc9)]=_0x3216b3[_0x15625a(0xa3)],_0x4eba63[_0x15625a(0xa4)]=_0x440403['message']||_0x440403[_0x15625a(0x72)]?_0x440403[_0x15625a(0x72)][_0x15625a(0xc9)]+':'+_0x440403[_0x15625a(0x72)][_0x15625a(0xbe)]:_0x440403,_0x4eba63;}})();}}module[a139_0x52af41(0xe1)]=TestHubHandler;
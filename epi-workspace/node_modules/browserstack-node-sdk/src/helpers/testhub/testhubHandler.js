const a126_0x2d4b61=a126_0x4b5d;(function(_0x85cacb,_0x6ebe8b){const _0xad09fb=a126_0x4b5d,_0x24807a=_0x85cacb();while(!![]){try{const _0xd92c62=parseInt(_0xad09fb(0x1a2))/0x1+parseInt(_0xad09fb(0x178))/0x2*(parseInt(_0xad09fb(0x1b4))/0x3)+parseInt(_0xad09fb(0x1a1))/0x4*(-parseInt(_0xad09fb(0x1df))/0x5)+-parseInt(_0xad09fb(0x1b0))/0x6+parseInt(_0xad09fb(0x1ba))/0x7*(-parseInt(_0xad09fb(0x1f3))/0x8)+parseInt(_0xad09fb(0x1f6))/0x9+parseInt(_0xad09fb(0x1ad))/0xa;if(_0xd92c62===_0x6ebe8b)break;else _0x24807a['push'](_0x24807a['shift']());}catch(_0x3055b5){_0x24807a['push'](_0x24807a['shift']());}}}(a126_0xe17e,0x67735));const bsSetupHelper=require(a126_0x2d4b61(0x1a4)),path=require(a126_0x2d4b61(0x182)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a126_0x2d4b61(0x1e4)),testhubUtils=require(a126_0x2d4b61(0x18f)),testHubConstants=require(a126_0x2d4b61(0x180)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a126_0x2d4b61(0x190))[a126_0x2d4b61(0x1f8)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a126_0x2d4b61(0x1db)),TestDetails=require(a126_0x2d4b61(0x1fd)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),{isTurboScaleSession}=require(a126_0x2d4b61(0x1dc)),BrowserstackCLI=require(a126_0x2d4b61(0x175)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x4fb9f9=>{const _0x155864=a126_0x2d4b61;OngoingEvents[_0x155864(0x1b9)](_0x4fb9f9);},awaitAllEvents=async()=>{const _0x443ffa=a126_0x2d4b61;return Promise[_0x443ffa(0x200)](OngoingEvents);};function a126_0x4b5d(_0x2fb7e8,_0x2a9280){const _0xe17ea6=a126_0xe17e();return a126_0x4b5d=function(_0x4b5de6,_0x17f6fa){_0x4b5de6=_0x4b5de6-0x174;let _0x5bd37c=_0xe17ea6[_0x4b5de6];return _0x5bd37c;},a126_0x4b5d(_0x2fb7e8,_0x2a9280);}class TestHubHandler{static ['buildStopSent']=![];static async['launchBuild'](_0x13a9a3,_0x135523){const _0x144361=a126_0x2d4b61,_0x40f552={'wtbQL':function(_0x4a9976,_0x4a00bc){return _0x4a9976||_0x4a00bc;},'ZIQqz':function(_0x106aed,_0x44738f){return _0x106aed||_0x44738f;},'bEioY':function(_0x5f0a76,_0x45149e){return _0x5f0a76===_0x45149e;},'JqHtj':function(_0x3383f5){return _0x3383f5();},'RdYfU':_0x144361(0x1c0),'sCZia':_0x144361(0x181),'IRguw':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','oBUUz':function(_0x42e284,_0xa3460d,_0x3ff8cf,_0x579d8c,_0x5c9a8){return _0x42e284(_0xa3460d,_0x3ff8cf,_0x579d8c,_0x5c9a8);},'sRCQO':_0x144361(0x1ed),'wJCNY':function(_0x55b969,_0x2cedab){return _0x55b969===_0x2cedab;},'zRGjZ':_0x144361(0x1cc),'YacqE':'true'};await PerformanceTester[_0x144361(0x1c3)](PerformanceEvents[_0x144361(0x19e)],async()=>{const _0x382e35=_0x144361,_0xe962ea=Object[_0x382e35(0x1f7)]({},_0x135523['config'],{'root_dir_path':'','framework':_0x135523[_0x382e35(0x174)]}),_0x1717b2=bsSetupHelper[_0x382e35(0x197)](_0xe962ea),_0x11f965=bsSetupHelper[_0x382e35(0x1af)](_0xe962ea),_0x31ccb1=_0x40f552[_0x382e35(0x1d7)](_0x1717b2,'')+':'+_0x40f552[_0x382e35(0x1b6)](_0x11f965,''),_0x15cf0f=testhubUtils['getProductMap'](_0xe962ea);process[_0x382e35(0x1b3)]['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x382e35(0x176)](_0x15cf0f);if(_0x40f552['bEioY'](_0x31ccb1,':'))return _0x40f552[_0x382e35(0x1aa)](isTestObservabilitySession)&&(logger[_0x382e35(0x1bc)](_0x40f552[_0x382e35(0x177)]),process[_0x382e35(0x1b3)][_0x382e35(0x1ab)]=_0x40f552[_0x382e35(0x188)]),testhubUtils[_0x382e35(0x1f5)](_0xe962ea)&&logger[_0x382e35(0x1bc)](_0x40f552[_0x382e35(0x1ca)]),[null,null];try{const _0x1d9224=await this[_0x382e35(0x1fe)](_0xe962ea,_0x13a9a3),_0x18f375=this[_0x382e35(0x1fa)](_0x1717b2,_0x11f965),_0x3907c0=await _0x40f552[_0x382e35(0x1c5)](nodeRequest,_0x40f552['sRCQO'],testHubConstants['TESTHUB_BUILD_API'],_0x1d9224,_0x18f375),_0x1255c5=this[_0x382e35(0x1f0)](_0xe962ea,_0x3907c0,_0x18f375);await this[_0x382e35(0x1d9)](_0x135523,_0x13a9a3);if(_0x40f552[_0x382e35(0x191)](testhubUtils[_0x382e35(0x198)](_0x135523['config']),null)){const _0x13ecd3=_0x1255c5[_0x40f552[_0x382e35(0x1d5)]];_0x13ecd3&&_0x13ecd3[_0x382e35(0x193)]&&_0x13ecd3[_0x382e35(0x184)]&&(_0x135523[_0x382e35(0x19a)][_0x382e35(0x1cc)]=!![],process[_0x382e35(0x1b3)][_0x382e35(0x1fb)]=_0x40f552[_0x382e35(0x1a6)]);}return _0x1255c5;}catch(_0x458a77){if(_0x40f552[_0x382e35(0x191)](_0x458a77[_0x382e35(0x195)],![])){testhubUtils[_0x382e35(0x1c4)](_0x458a77);return;}}})();}static async[a126_0x2d4b61(0x17a)](){const _0x47b0a7=a126_0x2d4b61,_0x50e69d={'LydYi':function(_0x3439a1,_0x45f86c,_0x26c80f){return _0x3439a1(_0x45f86c,_0x26c80f);},'MoTlB':function(_0x414e83,_0x3b396a){return _0x414e83(_0x3b396a);},'XeHrV':function(_0x1f834d){return _0x1f834d();},'qAfKX':_0x47b0a7(0x1d8)};if(processedTraceZips)return;const _0xe9fd1a=TestDetails[_0x47b0a7(0x1be)]();_0xe9fd1a[_0x47b0a7(0x1f9)](({testUId:_0x358a41,filePath:_0x2b4c95})=>{const _0xda2aaa=_0x47b0a7;var _0x163062=_0x50e69d[_0xda2aaa(0x1bb)](uploadTraceZip,_0x2b4c95,_0x358a41);_0x50e69d['MoTlB'](addEvent,_0x163062);});try{await _0x50e69d['XeHrV'](awaitAllEvents),logger[_0x47b0a7(0x1bc)](_0x50e69d['qAfKX']),processedTraceZips=!![];}catch(_0x5eece9){logger[_0x47b0a7(0x179)]('Error\x20while\x20waiting\x20for\x20events:\x20'+util[_0x47b0a7(0x1e8)](_0x5eece9));}}static async['checkAndSetupPercy'](_0x2711ad,_0x34e7bb){const _0x2a8d22=a126_0x2d4b61;if(constants[_0x2a8d22(0x1e1)][_0x2a8d22(0x1cb)](_0x34e7bb)){await _0x2711ad[_0x2a8d22(0x1c9)]();return;}_0x2711ad['config'][_0x2a8d22(0x1b1)]&&logger[_0x2a8d22(0x1bc)](_0x2a8d22(0x1b7)+_0x34e7bb+'\x20framework');}static['getAccessibilityOptions'](_0x38caf8){const _0x3724fe=a126_0x2d4b61,_0x541a3f={'ErGNq':function(_0x154555,_0x107292){return _0x154555(_0x107292);},'PYXBV':'true'};let _0x3aec70;if(_0x38caf8['accessibilityOptions']){const _0x9cb3c1={};_0x9cb3c1['settings']=_0x38caf8[_0x3724fe(0x1ef)],_0x3aec70=_0x9cb3c1;}else{const _0x12ebb2={};_0x12ebb2['settings']={},_0x3aec70=_0x12ebb2;}if((!bsSetupHelper[_0x3724fe(0x189)]()||_0x541a3f[_0x3724fe(0x1d6)](isTurboScaleSession,_0x38caf8))&&testhubUtils[_0x3724fe(0x1f5)](_0x38caf8)){const _0x5f4c10={};_0x5f4c10[_0x3724fe(0x1eb)]=_0x541a3f['PYXBV'],Object[_0x3724fe(0x1f7)](_0x3aec70['settings'],_0x5f4c10);}return _0x3aec70;}static[a126_0x2d4b61(0x1fa)](_0x1bbcf1,_0x1908e3){const _0x840c23=a126_0x2d4b61,_0xfdd845={'JKdcg':function(_0x462f71,_0xdf7789){return _0x462f71(_0xdf7789);}},_0x41ac37={};return _0x41ac37['username']=_0x1bbcf1,_0x41ac37['password']=_0x1908e3,{'auth':_0x41ac37,'headers':_0xfdd845[_0x840c23(0x194)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x18db68,_0x2250a4){const _0x1c74bc=a126_0x2d4b61,_0x5740ea={'bcevU':'Generating\x20build\x20upstream\x20data\x20for\x20TestHub','JjOxm':function(_0x3e0484,_0x296e15){return _0x3e0484(_0x296e15);}};logger['debug'](_0x5740ea[_0x1c74bc(0x1da)]);const _0x535d16={'project_name':_0x18db68['projectName']||'','name':_0x18db68[_0x1c74bc(0x1d4)]||path['basename'](path[_0x1c74bc(0x1c2)](process[_0x1c74bc(0x1d3)]())),'build_identifier':_0x18db68[_0x1c74bc(0x1e2)],'description':_0x18db68[_0x1c74bc(0x1ae)]||'','started_at':new Date()['toISOString'](),'tags':_0x5740ea[_0x1c74bc(0x18e)](getCustomTags,_0x18db68),'host_info':bsSetupHelper[_0x1c74bc(0x18b)](),'ci_info':bsSetupHelper[_0x1c74bc(0x1dd)](),'build_run_identifier':process[_0x1c74bc(0x1b3)]['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process['env'][_0x1c74bc(0x1ea)]||![],'linked_build_uuid':process['env'][_0x1c74bc(0x1ff)]||'','version_control':await bsSetupHelper['getGitMetaData'](),'accessibility':this[_0x1c74bc(0x1d2)](_0x18db68),'framework_details':testhubUtils[_0x1c74bc(0x17e)](_0x18db68,_0x2250a4),'product_map':testhubUtils[_0x1c74bc(0x19f)](_0x18db68),'browserstackAutomation':bsSetupHelper[_0x1c74bc(0x189)](),'grouping_identifier':process[_0x1c74bc(0x1b3)][_0x1c74bc(0x19c)],'test_orchestration':testhubUtils[_0x1c74bc(0x1c6)](_0x18db68)};if(bsSetupHelper[_0x1c74bc(0x1e6)]()[_0x1c74bc(0x1b5)]||bsSetupHelper[_0x1c74bc(0x1e6)]()['lcnc']){const _0x426761={};_0x426761[_0x1c74bc(0x1a0)]=process[_0x1c74bc(0x1b3)][_0x1c74bc(0x17f)],_0x426761['token']=process['env'][_0x1c74bc(0x196)],_0x535d16['central_scanner']=_0x426761;}return _0x535d16;}static[a126_0x2d4b61(0x1f0)](_0x5b1300,_0x50895c,_0x5bd965){const _0x3f7960=a126_0x2d4b61,_0x421d3f={'LxAPj':function(_0x1f45b9){return _0x1f45b9();},'PHdYn':function(_0x22397d,_0x1778c2){return _0x22397d&&_0x1778c2;},'XwZPS':'true','jvfhW':_0x3f7960(0x181),'NQLEh':function(_0x862a4e,_0x4199e5){return _0x862a4e&&_0x4199e5;}},_0x738806={};if(_0x421d3f['LxAPj'](isTestObservabilitySession)){const [_0x5e0571,_0x88bb1c,_0x31f7af]=testhubUtils['setTestObservabilityVariables'](_0x50895c[_0x3f7960(0x1c1)],_0x5bd965[_0x3f7960(0x183)]);if(_0x421d3f[_0x3f7960(0x1e3)](_0x5e0571,_0x88bb1c)){const _0x4e8afb={};_0x4e8afb[_0x3f7960(0x1d1)]=_0x5e0571,_0x4e8afb[_0x3f7960(0x184)]=_0x88bb1c,_0x4e8afb[_0x3f7960(0x192)]=_0x31f7af,_0x738806[testHubConstants[_0x3f7960(0x185)]]=_0x4e8afb,process[_0x3f7960(0x1b3)][_0x3f7960(0x19d)]=_0x421d3f[_0x3f7960(0x1c8)];}else _0x738806[testHubConstants[_0x3f7960(0x185)]]={},process[_0x3f7960(0x1b3)][_0x3f7960(0x19d)]=_0x421d3f[_0x3f7960(0x1c7)];}else process['env'][_0x3f7960(0x19d)]=_0x421d3f[_0x3f7960(0x1c7)];const [_0x119d5b,_0x177934]=testhubUtils[_0x3f7960(0x1b8)](_0x50895c[_0x3f7960(0x1c1)]);if(_0x421d3f['NQLEh'](_0x119d5b,_0x177934)){const _0x331a35={};_0x331a35['authToken']=_0x119d5b,_0x331a35[_0x3f7960(0x184)]=_0x177934,_0x738806[testHubConstants[_0x3f7960(0x1a9)]]=_0x331a35,process['env'][_0x3f7960(0x18c)]=_0x421d3f[_0x3f7960(0x1c8)];}else _0x738806[testHubConstants[_0x3f7960(0x1a9)]]={},process['env'][_0x3f7960(0x18c)]=_0x421d3f[_0x3f7960(0x1c7)];return testhubUtils[_0x3f7960(0x1f1)](_0x50895c[_0x3f7960(0x1c1)]),logger['info'](_0x3f7960(0x1cd)+process[_0x3f7960(0x1b3)]['BROWSERSTACK_TESTHUB_UUID']),_0x738806;}static async[a126_0x2d4b61(0x1ec)](_0x54a51f){const _0x13612f=a126_0x2d4b61,_0x200af2={'AXKAa':function(_0x301d98,_0x851508){return _0x301d98===_0x851508;},'pbFLu':'false','GLeVl':function(_0x43528a,_0x4ae274){return _0x43528a===_0x4ae274;},'Mabtu':_0x13612f(0x18a),'YXciI':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','YdYVF':_0x13612f(0x179),'QEQqt':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','UaSud':'finished_metadata','dPZid':_0x13612f(0x1bf),'MPEQx':function(_0x10ded4){return _0x10ded4();},'gptgR':function(_0x1776bf,_0x213549,_0x1318fa,_0x35092b,_0x17f9d0,_0x21d421){return _0x1776bf(_0x213549,_0x1318fa,_0x35092b,_0x17f9d0,_0x21d421);},'eRCGC':_0x13612f(0x199),'WRKfI':'stopBuildUpstream\x20event\x20successful!','zZUVx':'success'};await PerformanceTester[_0x13612f(0x1c3)](PerformanceEvents['STOP'],async()=>{const _0x365df8=_0x13612f;if(_0x200af2['AXKAa'](process[_0x365df8(0x1b3)][_0x365df8(0x1ab)],_0x200af2['pbFLu'])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x365df8(0x1d0)](process[_0x365df8(0x1b3)][testHubConstants['ENV_VAR'][_0x365df8(0x1e0)]]))return;TestHubHandler[_0x365df8(0x1a8)]=!![];if(BrowserstackCLI['getInstance']()[_0x365df8(0x1e9)]())return;await this[_0x365df8(0x17a)](),await RequestQueueHandler[_0x365df8(0x19b)]()[_0x365df8(0x1a7)](),await SessionHandler[_0x365df8(0x1ce)]();if(_0x200af2[_0x365df8(0x1f2)](process[_0x365df8(0x1b3)][testHubConstants[_0x365df8(0x17c)][_0x365df8(0x1e0)]],_0x200af2['Mabtu'])||_0x200af2[_0x365df8(0x187)](process[_0x365df8(0x1b3)][testHubConstants[_0x365df8(0x17c)][_0x365df8(0x1a5)]],_0x200af2[_0x365df8(0x1bd)])){logger[_0x365df8(0x1bc)](_0x200af2[_0x365df8(0x1a3)]);const _0x1da284={};return _0x1da284[_0x365df8(0x18d)]=_0x200af2['YdYVF'],_0x1da284[_0x365df8(0x17b)]=_0x200af2[_0x365df8(0x1e5)],_0x1da284;}const _0x115d10={'finished_at':new Date()[_0x365df8(0x186)](),'finished_metadata':[]};!!_0x54a51f&&_0x115d10[_0x200af2[_0x365df8(0x1e7)]][_0x365df8(0x1f4)]({'reason':_0x200af2['dPZid'],'signal':_0x54a51f,'failure_data':''});const _0x248c75={'headers':_0x200af2[_0x365df8(0x1ee)](getDefaultHeaders)};try{const _0x2e18a4=await _0x200af2[_0x365df8(0x17d)](nodeRequest,_0x200af2[_0x365df8(0x1de)],_0x365df8(0x1ac)+process['env'][testHubConstants[_0x365df8(0x17c)][_0x365df8(0x1a5)]]+'/stop',_0x115d10,_0x248c75,![]);if(_0x2e18a4[_0x365df8(0x1c1)]&&_0x2e18a4[_0x365df8(0x1c1)][_0x365df8(0x179)]){const _0x245b83={};_0x245b83[_0x365df8(0x17b)]=_0x2e18a4['data'][_0x365df8(0x179)];throw _0x245b83;}else{logger[_0x365df8(0x1bc)](_0x200af2['WRKfI']);const _0x44211d={};return _0x44211d['status']=_0x200af2['zZUVx'],_0x44211d['message']='',_0x44211d;}}catch(_0x38a559){_0x38a559[_0x365df8(0x1cf)]?logger[_0x365df8(0x1bc)](_0x365df8(0x1fc)+_0x38a559[_0x365df8(0x1cf)][_0x365df8(0x18d)]+'\x20'+_0x38a559['response']['statusText']+'\x20'+JSON[_0x365df8(0x176)](_0x38a559['response'][_0x365df8(0x1c1)])):logger[_0x365df8(0x1bc)](_0x365df8(0x1fc)+(_0x38a559[_0x365df8(0x17b)]||_0x38a559));const _0x2453e2={};return _0x2453e2[_0x365df8(0x18d)]=_0x200af2['YdYVF'],_0x2453e2[_0x365df8(0x17b)]=_0x38a559[_0x365df8(0x17b)]||_0x38a559[_0x365df8(0x1cf)]?_0x38a559[_0x365df8(0x1cf)][_0x365df8(0x18d)]+':'+_0x38a559[_0x365df8(0x1cf)]['statusText']:_0x38a559,_0x2453e2;}})();}}function a126_0xe17e(){const _0x5138ea=['getUserName','getAccessibilityValueFromYml','PUT','config','getInstance','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','BROWSERSTACK_TEST_OBSERVABILITY','START','getProductMapForBuildStartCall','job_id','4UPxXbQ','507519moZSmW','YXciI','../helper','BROWSERSTACK_TESTHUB_UUID','YacqE','uploadPending','buildStopSent','ACCESSIBILITY','JqHtj','BS_TESTOPS_BUILD_COMPLETED','api/v1/builds/','12724430LlvJCo','buildDescription','getAccessKey','3970428DAmuQl','percy','exports','env','112374bplerC','central_scanner','ZIQqz','Percy\x20is\x20not\x20supported\x20for\x20','setAccessibilityVariables','add','2813671PTfEDD','LydYi','debug','Mabtu','getTraceFilePaths','user_killed','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','data','resolve','measureWrapper','logBuildError','oBUUz','getTestOrchestrationBuildStartData','jvfhW','XwZPS','setupPercy','IRguw','includes','accessibility','Testhub\x20started\x20with\x20id:\x20','waitForBuildStatus','response','isUndefined','jwt','getAccessibilityOptions','cwd','buildName','zRGjZ','ErGNq','wtbQL','All\x20trace\x20zip\x20send\x20events\x20complete','checkAndSetupPercy','bcevU','../performance/constants','../helper.js','getCiInfo','eRCGC','1938900rXgmVu','BROWSERSTACK_TESTHUB_JWT','PERCY_SUPPORTED_FRAMEWORKS','buildIdentifier','PHdYn','../test-observability/utils','QEQqt','getCentralUser','UaSud','format','isRunning','BROWSERSTACK_RERUN','includeEncodedExtension','stop','POST','MPEQx','accessibilityOptions','extractDataFromResponse','setTestHubCommonMetaInfo','GLeVl','8ezaLJM','push','isAccessibilityEnabled','520056Dmbvbc','assign','winstonLogger','forEach','getConfig','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','../../bin/playwright/reporter/test-details.js','generateBuildUpstreamData','BROWSERSTACK_LINKED_BUILD_UUID','allSettled','framework','../../bin/v2/browserstackCLI','stringify','RdYfU','2acfRxK','error','processTraceZips','message','ENV_VAR','gptgR','getFrameworkDetails','BROWSERSTACK_CENTRAL_SCANNER_JOBID','./constants.js','false','path','auth','buildHashedId','OBSERVABILITY','toISOString','AXKAa','sCZia','isBrowserstackInfra','null','getHostInfo','BROWSERSTACK_ACCESSIBILITY','status','JjOxm','./utils.js','../logger','wJCNY','allowScreenshot','authToken','JKdcg','success','BROWSERSTACK_CENTRAL_SCANNER_JWT'];a126_0xe17e=function(){return _0x5138ea;};return a126_0xe17e();}module[a126_0x2d4b61(0x1b2)]=TestHubHandler;
const a126_0x4febb0=a126_0x460f;(function(_0x90c52f,_0x457b08){const _0x184204=a126_0x460f,_0x409427=_0x90c52f();while(!![]){try{const _0x3b818e=parseInt(_0x184204(0x112))/0x1+parseInt(_0x184204(0xe4))/0x2*(-parseInt(_0x184204(0xd6))/0x3)+parseInt(_0x184204(0x117))/0x4+-parseInt(_0x184204(0xc2))/0x5+parseInt(_0x184204(0x124))/0x6+-parseInt(_0x184204(0xa8))/0x7*(-parseInt(_0x184204(0x107))/0x8)+parseInt(_0x184204(0xb1))/0x9*(-parseInt(_0x184204(0x11e))/0xa);if(_0x3b818e===_0x457b08)break;else _0x409427['push'](_0x409427['shift']());}catch(_0x16fcd7){_0x409427['push'](_0x409427['shift']());}}}(a126_0x4dbb,0xef235));const bsSetupHelper=require(a126_0x4febb0(0x11f)),path=require(a126_0x4febb0(0x115)),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a126_0x4febb0(0x108)),testhubUtils=require(a126_0x4febb0(0xe5)),testHubConstants=require(a126_0x4febb0(0x129)),constants=require(a126_0x4febb0(0x12e)),RequestQueueHandler=require(a126_0x4febb0(0x125)),logger=require('../logger')[a126_0x4febb0(0xe2)],SessionHandler=require(a126_0x4febb0(0xb3)),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a126_0x4febb0(0xb4)),TestDetails=require(a126_0x4febb0(0xc6)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),{isTurboScaleSession}=require(a126_0x4febb0(0x105)),BrowserstackCLI=require('../../bin/v2/browserstackCLI'),OngoingEvents=new Set();function a126_0x460f(_0x1b1030,_0x590081){const _0x4dbb8c=a126_0x4dbb();return a126_0x460f=function(_0x460f95,_0x43988b){_0x460f95=_0x460f95-0xa6;let _0x5be3e0=_0x4dbb8c[_0x460f95];return _0x5be3e0;},a126_0x460f(_0x1b1030,_0x590081);}let processedTraceZips=![];const addEvent=_0x2b5c00=>{OngoingEvents['add'](_0x2b5c00);},awaitAllEvents=async()=>{const _0x407450=a126_0x4febb0;return Promise[_0x407450(0xd2)](OngoingEvents);};function a126_0x4dbb(){const _0xfc6b82=['BROWSERSTACK_ACCESSIBILITY','isAccessibilityEnabled','username','../helper.js','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','84912JlmlKk','../test-observability/utils','response','buildStopSent','config','authToken','getAccessibilityOptions','buildIdentifier','XxksW','BROWSERSTACK_TESTHUB_UUID','getHostInfo','1922090fCDyYj','xeZzq','START','path','bwwzq','657928MqQXgm','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','accessibilityOptions','cwd','zujJn','ACCESSIBILITY','ihJxO','2468590rXirRg','../helper','toISOString','getTestOrchestrationBuildStartData','getCiInfo','false','8945010ZRBnYq','../test-observability/requestQueueHandler.js','accessibility','nrFil','env','./constants.js','JZkPy','/stop','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','basename','../../bin/utils/constants.js','getConfig','generateBuildUpstreamData','BROWSERSTACK_CENTRAL_SCANNER_JWT','Qgvfk','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','POST','token','tfMKr','stopBuildUpstream\x20event\x20successful!','ELRQa','launchBuild','password','percy','STOP','projectName','stop','jpvbU','693jYNOEz','oIGVD','isUndefined','true','info','qqPxe','isRunning','EtZCY','fWgvX','72uQmidh','getAccessibilityValueFromYml','../test-observability/sessionHandler.js','../performance/constants','gJXmg','getGitMetaData','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','BROWSERSTACK_TESTHUB_JWT','All\x20trace\x20zip\x20send\x20events\x20complete','measureWrapper','vCXVS','getInstance','buildName','error','ENV_VAR','exports','setAccessibilityVariables','1024975iJgqPz','xDupW','push','BROWSERSTACK_PRODUCT_MAP','../../bin/playwright/reporter/test-details.js','waitForBuildStatus','HXgZs','message','buildDescription','getCentralUser','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','buildHashedId','auth','PERCY_SUPPORTED_FRAMEWORKS','zsZLq','format','allSettled','BROWSERSTACK_TEST_OBSERVABILITY','allowScreenshot','data','51qRNxFC','XQuxs','success','XTHwn','Percy\x20is\x20not\x20supported\x20for\x20','null','job_id','getUserName','HELee','setTestHubCommonMetaInfo','stringify','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','winstonLogger','MtGrg','172802dkMRqr','./utils.js','debug','extractDataFromResponse','BROWSERSTACK_RERUN','status','LkYyb','rulyr','KtHqT','logBuildError','setupPercy','TESTHUB_BUILD_API','checkAndSetupPercy','CWuOg','BROWSERSTACK_CENTRAL_SCANNER_JOBID','jwt','central_scanner','KhXTq','getTraceFilePaths','ERKoX','Error\x20while\x20waiting\x20for\x20events:\x20','jCNQQ','processTraceZips','bTJyi','BROWSERSTACK_BUILD_RUN_IDENTIFIER','statusText','isBrowserstackInfra','assign','OBSERVABILITY','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'];a126_0x4dbb=function(){return _0xfc6b82;};return a126_0x4dbb();}class TestHubHandler{static [a126_0x4febb0(0x10a)]=![];static async[a126_0x4febb0(0x139)](_0x2d2e2f,_0x289354){const _0x162c20=a126_0x4febb0,_0x49334b={'HELee':function(_0x5c4b0c,_0x186b95){return _0x5c4b0c||_0x186b95;},'jpvbU':function(_0x4f55c2,_0x3414d9){return _0x4f55c2||_0x3414d9;},'KhXTq':function(_0x179c52,_0x45faf0){return _0x179c52===_0x45faf0;},'HdFDP':function(_0x88c2ba){return _0x88c2ba();},'LFXdp':_0x162c20(0xb7),'tfMKr':_0x162c20(0x123),'OgYMg':_0x162c20(0x12c),'MxJRl':function(_0x2a3351,_0x1f2d8e,_0x381f58,_0x4253a0,_0x2ab805){return _0x2a3351(_0x1f2d8e,_0x381f58,_0x4253a0,_0x2ab805);},'rulyr':_0x162c20(0x134),'LkYyb':_0x162c20(0x126),'JZkPy':_0x162c20(0xab)};await PerformanceTester[_0x162c20(0xba)](PerformanceEvents[_0x162c20(0x114)],async()=>{const _0x3d6982=_0x162c20,_0x56f835=Object[_0x3d6982(0xff)]({},_0x289354['config'],{'root_dir_path':'','framework':_0x289354['framework']}),_0x40a29b=bsSetupHelper[_0x3d6982(0xdd)](_0x56f835),_0x1b8e75=bsSetupHelper['getAccessKey'](_0x56f835),_0x31bce8=_0x49334b[_0x3d6982(0xde)](_0x40a29b,'')+':'+_0x49334b[_0x3d6982(0xa7)](_0x1b8e75,''),_0x2faeac=testhubUtils['getProductMap'](_0x56f835);process[_0x3d6982(0x128)][_0x3d6982(0xc5)]=JSON[_0x3d6982(0xe0)](_0x2faeac);if(_0x49334b['KhXTq'](_0x31bce8,':'))return _0x49334b['HdFDP'](isTestObservabilitySession)&&(logger[_0x3d6982(0xe6)](_0x49334b['LFXdp']),process[_0x3d6982(0x128)]['BS_TESTOPS_BUILD_COMPLETED']=_0x49334b[_0x3d6982(0x136)]),testhubUtils[_0x3d6982(0x103)](_0x56f835)&&logger[_0x3d6982(0xe6)](_0x49334b['OgYMg']),[null,null];try{const _0x2df708=await this[_0x3d6982(0x130)](_0x56f835,_0x2d2e2f),_0x4f1b93=this[_0x3d6982(0x12f)](_0x40a29b,_0x1b8e75),_0x25d0b5=await _0x49334b['MxJRl'](nodeRequest,_0x49334b[_0x3d6982(0xeb)],testHubConstants[_0x3d6982(0xef)],_0x2df708,_0x4f1b93),_0xa318d4=this[_0x3d6982(0xe7)](_0x56f835,_0x25d0b5,_0x4f1b93);await this[_0x3d6982(0xf0)](_0x289354,_0x2d2e2f);if(_0x49334b[_0x3d6982(0xf5)](testhubUtils[_0x3d6982(0xb2)](_0x289354[_0x3d6982(0x10b)]),null)){const _0x3a11e3=_0xa318d4[_0x49334b[_0x3d6982(0xea)]];_0x3a11e3&&_0x3a11e3[_0x3d6982(0x10c)]&&_0x3a11e3[_0x3d6982(0xcd)]&&(_0x289354[_0x3d6982(0x10b)]['accessibility']=!![],process[_0x3d6982(0x128)][_0x3d6982(0xe1)]=_0x49334b[_0x3d6982(0x12a)]);}return _0xa318d4;}catch(_0x5898c2){if(_0x49334b['KhXTq'](_0x5898c2[_0x3d6982(0xd8)],![])){testhubUtils[_0x3d6982(0xed)](_0x5898c2);return;}}})();}static async[a126_0x4febb0(0xfa)](){const _0x14d6cd=a126_0x4febb0,_0xb3a253={'EtZCY':function(_0x4c62dd,_0x632667,_0x5c90bb){return _0x4c62dd(_0x632667,_0x5c90bb);},'bwwzq':function(_0x4fe02c,_0x1e11ac){return _0x4fe02c(_0x1e11ac);},'wUAdY':function(_0x4bdef3){return _0x4bdef3();},'gJXmg':_0x14d6cd(0xb9)};if(processedTraceZips)return;const _0x4ff7d4=TestDetails[_0x14d6cd(0xf6)]();_0x4ff7d4['forEach'](({testUId:_0x5f2ef9,filePath:_0x56ce43})=>{const _0x43f66f=_0x14d6cd;var _0x4b758f=_0xb3a253[_0x43f66f(0xaf)](uploadTraceZip,_0x56ce43,_0x5f2ef9);_0xb3a253[_0x43f66f(0x116)](addEvent,_0x4b758f);});try{await _0xb3a253['wUAdY'](awaitAllEvents),logger[_0x14d6cd(0xe6)](_0xb3a253[_0x14d6cd(0xb5)]),processedTraceZips=!![];}catch(_0x29d887){logger[_0x14d6cd(0xbe)](_0x14d6cd(0xf8)+util[_0x14d6cd(0xd1)](_0x29d887));}}static async['checkAndSetupPercy'](_0x57b7b5,_0x494231){const _0x4f6102=a126_0x4febb0;if(constants[_0x4f6102(0xcf)]['includes'](_0x494231)){await _0x57b7b5[_0x4f6102(0xee)]();return;}_0x57b7b5[_0x4f6102(0x10b)][_0x4f6102(0x13b)]&&logger[_0x4f6102(0xe6)](_0x4f6102(0xda)+_0x494231+'\x20framework');}static[a126_0x4febb0(0x10d)](_0x2032d1){const _0x202ba4=a126_0x4febb0,_0x555edf={'nFKfl':function(_0x31304a,_0x1bdbe5){return _0x31304a(_0x1bdbe5);},'nrFil':_0x202ba4(0xab)};let _0x422405;if(_0x2032d1[_0x202ba4(0x119)]){const _0x5688b3={};_0x5688b3['settings']=_0x2032d1[_0x202ba4(0x119)],_0x422405=_0x5688b3;}else{const _0x1b09c9={};_0x1b09c9['settings']={},_0x422405=_0x1b09c9;}if((!bsSetupHelper[_0x202ba4(0xfe)]()||_0x555edf['nFKfl'](isTurboScaleSession,_0x2032d1))&&testhubUtils[_0x202ba4(0x103)](_0x2032d1)){const _0x336bc6={};_0x336bc6['includeEncodedExtension']=_0x555edf[_0x202ba4(0x127)],Object['assign'](_0x422405['settings'],_0x336bc6);}return _0x422405;}static[a126_0x4febb0(0x12f)](_0xa19346,_0x448295){const _0x36dc9b=a126_0x4febb0,_0x59330c={'ERKoX':function(_0x35b14e,_0x5bd8f6){return _0x35b14e(_0x5bd8f6);}},_0x59f2da={};return _0x59f2da[_0x36dc9b(0x104)]=_0xa19346,_0x59f2da[_0x36dc9b(0x13a)]=_0x448295,{'auth':_0x59f2da,'headers':_0x59330c[_0x36dc9b(0xf7)](getDefaultHeaders,![])};}static async[a126_0x4febb0(0x130)](_0x326711,_0x1f3441){const _0x4c887b=a126_0x4febb0,_0x30ca9b={'xDupW':_0x4c887b(0xcc),'XxksW':function(_0x457085,_0x2e5792){return _0x457085(_0x2e5792);}};logger[_0x4c887b(0xe6)](_0x30ca9b[_0x4c887b(0xc3)]);const _0x582c5a={'project_name':_0x326711[_0x4c887b(0x13d)]||'','name':_0x326711[_0x4c887b(0xbd)]||path[_0x4c887b(0x12d)](path['resolve'](process[_0x4c887b(0x11a)]())),'build_identifier':_0x326711[_0x4c887b(0x10e)],'description':_0x326711[_0x4c887b(0xca)]||'','started_at':new Date()[_0x4c887b(0x120)](),'tags':_0x30ca9b[_0x4c887b(0x10f)](getCustomTags,_0x326711),'host_info':bsSetupHelper[_0x4c887b(0x111)](),'ci_info':bsSetupHelper[_0x4c887b(0x122)](),'build_run_identifier':process[_0x4c887b(0x128)][_0x4c887b(0xfc)],'failed_tests_rerun':process[_0x4c887b(0x128)][_0x4c887b(0xe8)]||![],'linked_build_uuid':process[_0x4c887b(0x128)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper[_0x4c887b(0xb6)](),'accessibility':this['getAccessibilityOptions'](_0x326711),'framework_details':testhubUtils['getFrameworkDetails'](_0x326711,_0x1f3441),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x326711),'browserstackAutomation':bsSetupHelper[_0x4c887b(0xfe)](),'grouping_identifier':process[_0x4c887b(0x128)][_0x4c887b(0x118)],'test_orchestration':testhubUtils[_0x4c887b(0x121)](_0x326711)};if(bsSetupHelper[_0x4c887b(0xcb)]()[_0x4c887b(0xf4)]||bsSetupHelper[_0x4c887b(0xcb)]()['lcnc']){const _0x25375c={};_0x25375c[_0x4c887b(0xdc)]=process[_0x4c887b(0x128)][_0x4c887b(0xf2)],_0x25375c[_0x4c887b(0x135)]=process[_0x4c887b(0x128)][_0x4c887b(0x131)],_0x582c5a[_0x4c887b(0xf4)]=_0x25375c;}return _0x582c5a;}static[a126_0x4febb0(0xe7)](_0x4cdc82,_0x1fd055,_0xf82559){const _0x18809f=a126_0x4febb0,_0x208a01={'xeZzq':function(_0x288f41){return _0x288f41();},'MtGrg':function(_0x4f102f,_0x36b55a){return _0x4f102f&&_0x36b55a;},'ihJxO':_0x18809f(0xab),'vCXVS':_0x18809f(0x123)},_0x968351={};if(_0x208a01[_0x18809f(0x113)](isTestObservabilitySession)){const [_0x50c171,_0x1e13e4,_0x2ffb78]=testhubUtils['setTestObservabilityVariables'](_0x1fd055['data'],_0xf82559[_0x18809f(0xce)]);if(_0x208a01[_0x18809f(0xe3)](_0x50c171,_0x1e13e4)){const _0x3d987d={};_0x3d987d[_0x18809f(0xf3)]=_0x50c171,_0x3d987d[_0x18809f(0xcd)]=_0x1e13e4,_0x3d987d[_0x18809f(0xd4)]=_0x2ffb78,_0x968351[testHubConstants[_0x18809f(0x100)]]=_0x3d987d,process[_0x18809f(0x128)][_0x18809f(0xd3)]=_0x208a01[_0x18809f(0x11d)];}else _0x968351[testHubConstants[_0x18809f(0x100)]]={},process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x208a01[_0x18809f(0xbb)];}else process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x208a01[_0x18809f(0xbb)];const [_0x3700cd,_0x467220]=testhubUtils[_0x18809f(0xc1)](_0x1fd055['data']);if(_0x208a01[_0x18809f(0xe3)](_0x3700cd,_0x467220)){const _0x5c00ba={};_0x5c00ba[_0x18809f(0x10c)]=_0x3700cd,_0x5c00ba['buildHashedId']=_0x467220,_0x968351[testHubConstants[_0x18809f(0x11c)]]=_0x5c00ba,process[_0x18809f(0x128)][_0x18809f(0x102)]=_0x208a01[_0x18809f(0x11d)];}else _0x968351[testHubConstants[_0x18809f(0x11c)]]={},process[_0x18809f(0x128)][_0x18809f(0x102)]=_0x208a01[_0x18809f(0xbb)];return testhubUtils[_0x18809f(0xdf)](_0x1fd055[_0x18809f(0xd5)]),logger[_0x18809f(0xac)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x18809f(0x128)][_0x18809f(0x110)]),_0x968351;}static async[a126_0x4febb0(0xa6)](_0x2519fb){const _0x67fcd2=a126_0x4febb0,_0x17b058={'XTHwn':function(_0x2e1ab1,_0x5ac990){return _0x2e1ab1===_0x5ac990;},'KtHqT':'false','Qgvfk':function(_0x4a6624,_0x97d2f9){return _0x4a6624===_0x97d2f9;},'bTJyi':_0x67fcd2(0xdb),'fWgvX':function(_0x127afe,_0x222e24){return _0x127afe===_0x222e24;},'CWuOg':_0x67fcd2(0x106),'zujJn':_0x67fcd2(0xbe),'jCNQQ':_0x67fcd2(0x133),'dTplH':'finished_metadata','HXgZs':'user_killed','zsZLq':function(_0x98b85){return _0x98b85();},'qqPxe':function(_0x28c830,_0x5b866a,_0x40adc3,_0x3e03a4,_0x5dc694,_0x2bce03){return _0x28c830(_0x5b866a,_0x40adc3,_0x3e03a4,_0x5dc694,_0x2bce03);},'XQuxs':'PUT','oIGVD':_0x67fcd2(0x137),'ELRQa':_0x67fcd2(0xd8)};!BrowserstackCLI['getInstance']()[_0x67fcd2(0xae)]()&&await this['processTraceZips'](),await PerformanceTester[_0x67fcd2(0xba)](PerformanceEvents[_0x67fcd2(0x13c)],async()=>{const _0x2c2b36=_0x67fcd2;if(_0x17b058[_0x2c2b36(0xd9)](process[_0x2c2b36(0x128)]['BS_TESTOPS_BUILD_COMPLETED'],_0x17b058[_0x2c2b36(0xec)])||TestHubHandler[_0x2c2b36(0x10a)]||bsSetupHelper[_0x2c2b36(0xaa)](process[_0x2c2b36(0x128)][testHubConstants[_0x2c2b36(0xbf)][_0x2c2b36(0xb8)]]))return;TestHubHandler[_0x2c2b36(0x10a)]=!![],await RequestQueueHandler[_0x2c2b36(0xbc)]()['uploadPending'](),await SessionHandler[_0x2c2b36(0xc7)]();if(_0x17b058[_0x2c2b36(0x132)](process[_0x2c2b36(0x128)][testHubConstants[_0x2c2b36(0xbf)][_0x2c2b36(0xb8)]],_0x17b058[_0x2c2b36(0xfb)])||_0x17b058[_0x2c2b36(0xb0)](process['env'][testHubConstants['ENV_VAR'][_0x2c2b36(0x110)]],_0x17b058[_0x2c2b36(0xfb)])){logger[_0x2c2b36(0xe6)](_0x17b058[_0x2c2b36(0xf1)]);const _0x438f48={};return _0x438f48[_0x2c2b36(0xe9)]=_0x17b058[_0x2c2b36(0x11b)],_0x438f48[_0x2c2b36(0xc9)]=_0x17b058[_0x2c2b36(0xf9)],_0x438f48;}const _0x430dc2={'finished_at':new Date()[_0x2c2b36(0x120)](),'finished_metadata':[]};!!_0x2519fb&&_0x430dc2[_0x17b058['dTplH']][_0x2c2b36(0xc4)]({'reason':_0x17b058[_0x2c2b36(0xc8)],'signal':_0x2519fb,'failure_data':''});const _0x5d5024={'headers':_0x17b058[_0x2c2b36(0xd0)](getDefaultHeaders)};try{const _0x543c45=await _0x17b058[_0x2c2b36(0xad)](nodeRequest,_0x17b058[_0x2c2b36(0xd7)],'api/v1/builds/'+process['env'][testHubConstants[_0x2c2b36(0xbf)][_0x2c2b36(0x110)]]+_0x2c2b36(0x12b),_0x430dc2,_0x5d5024,![]);if(_0x543c45[_0x2c2b36(0xd5)]&&_0x543c45[_0x2c2b36(0xd5)][_0x2c2b36(0xbe)]){const _0x401b77={};_0x401b77[_0x2c2b36(0xc9)]=_0x543c45[_0x2c2b36(0xd5)][_0x2c2b36(0xbe)];throw _0x401b77;}else{logger[_0x2c2b36(0xe6)](_0x17b058[_0x2c2b36(0xa9)]);const _0x56da7d={};return _0x56da7d['status']=_0x17b058[_0x2c2b36(0x138)],_0x56da7d[_0x2c2b36(0xc9)]='',_0x56da7d;}}catch(_0x5219d4){_0x5219d4[_0x2c2b36(0x109)]?logger[_0x2c2b36(0xe6)](_0x2c2b36(0x101)+_0x5219d4[_0x2c2b36(0x109)][_0x2c2b36(0xe9)]+'\x20'+_0x5219d4['response']['statusText']+'\x20'+JSON[_0x2c2b36(0xe0)](_0x5219d4[_0x2c2b36(0x109)][_0x2c2b36(0xd5)])):logger[_0x2c2b36(0xe6)](_0x2c2b36(0x101)+(_0x5219d4['message']||_0x5219d4));const _0x562c9a={};return _0x562c9a[_0x2c2b36(0xe9)]=_0x17b058[_0x2c2b36(0x11b)],_0x562c9a[_0x2c2b36(0xc9)]=_0x5219d4[_0x2c2b36(0xc9)]||_0x5219d4[_0x2c2b36(0x109)]?_0x5219d4[_0x2c2b36(0x109)]['status']+':'+_0x5219d4[_0x2c2b36(0x109)][_0x2c2b36(0xfd)]:_0x5219d4,_0x562c9a;}})();}}module[a126_0x4febb0(0xc0)]=TestHubHandler;
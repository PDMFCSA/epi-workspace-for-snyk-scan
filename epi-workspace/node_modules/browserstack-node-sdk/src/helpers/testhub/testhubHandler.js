const a126_0x4af2c8=a126_0x5ac8;(function(_0xf88e07,_0x53c5ad){const _0x190b80=a126_0x5ac8,_0x10901a=_0xf88e07();while(!![]){try{const _0x54fe1d=-parseInt(_0x190b80(0x106))/0x1+parseInt(_0x190b80(0xfc))/0x2*(parseInt(_0x190b80(0x132))/0x3)+-parseInt(_0x190b80(0x11c))/0x4+parseInt(_0x190b80(0x14e))/0x5*(-parseInt(_0x190b80(0x127))/0x6)+-parseInt(_0x190b80(0x14c))/0x7+parseInt(_0x190b80(0x160))/0x8*(parseInt(_0x190b80(0x14d))/0x9)+parseInt(_0x190b80(0x100))/0xa;if(_0x54fe1d===_0x53c5ad)break;else _0x10901a['push'](_0x10901a['shift']());}catch(_0x265742){_0x10901a['push'](_0x10901a['shift']());}}}(a126_0x268e,0xe3ef4));const bsSetupHelper=require(a126_0x4af2c8(0xf3)),path=require(a126_0x4af2c8(0x11b)),util=require(a126_0x4af2c8(0x120)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a126_0x4af2c8(0x16d)),testhubUtils=require(a126_0x4af2c8(0x138)),testHubConstants=require(a126_0x4af2c8(0x15f)),constants=require(a126_0x4af2c8(0x109)),RequestQueueHandler=require(a126_0x4af2c8(0x165)),logger=require(a126_0x4af2c8(0x146))[a126_0x4af2c8(0x11d)],SessionHandler=require(a126_0x4af2c8(0x185)),PerformanceTester=require(a126_0x4af2c8(0x13d)),{TESTHUB_EVENTS:PerformanceEvents}=require(a126_0x4af2c8(0x163)),TestDetails=require(a126_0x4af2c8(0x182)),{uploadTraceZip}=require(a126_0x4af2c8(0x10d)),{isTurboScaleSession}=require(a126_0x4af2c8(0x102)),BrowserstackCLI=require(a126_0x4af2c8(0x151)),OngoingEvents=new Set();let processedTraceZips=![];function a126_0x268e(){const _0x51397a=['yzdzD','basename','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','message','Error\x20while\x20waiting\x20for\x20events:\x20','isRunning','ENV_VAR','WdDbx','true','BROWSERSTACK_LINKED_BUILD_UUID','stringify','finished_metadata','../../bin/playwright/reporter/test-details.js','assign','uJhYy','../test-observability/sessionHandler.js','FVAlm','null','GteiY','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','data','pqTzu','extractDataFromResponse','TvVaS','forEach','cwd','SslwQ','START','getTestOrchestrationBuildStartData','wOHbh','../helper','measureWrapper','env','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','checkAndSetupPercy','debug','buildIdentifier','DdvFj','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','56AYvZXO','buildStopSent','BROWSERSTACK_TESTHUB_UUID','hcQDd','20269680vaCZrF','JBlae','../helper.js','All\x20trace\x20zip\x20send\x20events\x20complete','ozEFj','Bwrxv','911804UCmTdW','CJiFC','jwt','../../bin/utils/constants.js','getAccessibilityOptions','add','auth','../../bin/playwright/reporter/pwUtils.js','includeEncodedExtension','processTraceZips','BROWSERSTACK_TESTHUB_JWT','OBSERVABILITY','settings','HVgJH','accessibility','ZVTSV','\x20framework','getProductMapForBuildStartCall','stopBuildUpstream\x20event\x20successful!','getCentralUser','getConfig','path','3427772bzsIDe','winstonLogger','POST','DthuH','util','BROWSERSTACK_CENTRAL_SCANNER_JOBID','waitForBuildStatus','buildDescription','buildName','statusText','ImomK','108198vSLQrf','STOP','BiXFN','resolve','jWCcJ','generateBuildUpstreamData','getInstance','BROWSERSTACK_PRODUCT_MAP','lcnc','oAhNg','framework','96645sJiTna','getAccessibilityValueFromYml','getFrameworkDetails','stop','BROWSERSTACK_RERUN','/stop','./utils.js','includes','getUserName','response','uploadPending','../performance/performance-tester.js','user_killed','getHostInfo','getGitMetaData','authToken','RYmkp','setAccessibilityVariables','Percy\x20is\x20not\x20supported\x20for\x20','username','../logger','setTestObservabilityVariables','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','isAccessibilityEnabled','BROWSERSTACK_TEST_OBSERVABILITY','eZymi','1111166YTFFvj','3508506ghVFKo','235vSjEIh','JEUzl','api/v1/builds/','../../bin/v2/browserstackCLI','mLJDH','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','toISOString','config','setupPercy','BROWSERSTACK_BUILD_RUN_IDENTIFIER','success','ZTTjf','cMcnm','PERCY_SUPPORTED_FRAMEWORKS','setTestHubCommonMetaInfo','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','BROWSERSTACK_ACCESSIBILITY','./constants.js','16EiiupA','buildHashedId','projectName','../performance/constants','accessibilityOptions','../test-observability/requestQueueHandler.js','password','AsTlq','ACCESSIBILITY','TnmWB','central_scanner','getTraceFilePaths','SYXwT','../test-observability/utils','Testhub\x20started\x20with\x20id:\x20','push','token','WKATJ','RIYiT','error','status','false'];a126_0x268e=function(){return _0x51397a;};return a126_0x268e();}const addEvent=_0x146085=>{const _0x2587e4=a126_0x4af2c8;OngoingEvents[_0x2587e4(0x10b)](_0x146085);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};function a126_0x5ac8(_0x430c6e,_0x3ac17b){const _0x268e51=a126_0x268e();return a126_0x5ac8=function(_0x5ac8f7,_0x583248){_0x5ac8f7=_0x5ac8f7-0xea;let _0x2430bc=_0x268e51[_0x5ac8f7];return _0x2430bc;},a126_0x5ac8(_0x430c6e,_0x3ac17b);}class TestHubHandler{static ['buildStopSent']=![];static async['launchBuild'](_0x7df1ad,_0x29d8c3){const _0x1d106d=a126_0x4af2c8,_0x4a31f7={'mLJDH':function(_0x121b29,_0x1aa945){return _0x121b29||_0x1aa945;},'BiXFN':function(_0x4a9396,_0x18f709){return _0x4a9396||_0x18f709;},'uJhYy':function(_0x1c06ce,_0x2b5d62){return _0x1c06ce===_0x2b5d62;},'Bwrxv':function(_0x3aada3){return _0x3aada3();},'hcQDd':_0x1d106d(0xf6),'JBlae':_0x1d106d(0x175),'eZymi':_0x1d106d(0x189),'DthuH':function(_0x1901d8,_0x5b5eb5,_0x2abbda,_0x58833a,_0x1fc023){return _0x1901d8(_0x5b5eb5,_0x2abbda,_0x58833a,_0x1fc023);},'ONdTQ':_0x1d106d(0x11e),'TvVaS':_0x1d106d(0x114),'CJiFC':_0x1d106d(0x17e),'ZTTjf':function(_0x1fe99f,_0x3e7135){return _0x1fe99f===_0x3e7135;}};await PerformanceTester[_0x1d106d(0xf4)](PerformanceEvents[_0x1d106d(0xf0)],async()=>{const _0x1d4317=_0x1d106d,_0x544ecb=Object[_0x1d4317(0x183)]({},_0x29d8c3[_0x1d4317(0x155)],{'root_dir_path':'','framework':_0x29d8c3[_0x1d4317(0x131)]}),_0x3f9b65=bsSetupHelper[_0x1d4317(0x13a)](_0x544ecb),_0x501e7a=bsSetupHelper['getAccessKey'](_0x544ecb),_0x21a929=_0x4a31f7[_0x1d4317(0x152)](_0x3f9b65,'')+':'+_0x4a31f7[_0x1d4317(0x129)](_0x501e7a,''),_0x307ea8=testhubUtils['getProductMap'](_0x544ecb);process[_0x1d4317(0xf5)][_0x1d4317(0x12e)]=JSON[_0x1d4317(0x180)](_0x307ea8);if(_0x4a31f7[_0x1d4317(0x184)](_0x21a929,':'))return _0x4a31f7[_0x1d4317(0x105)](isTestObservabilitySession)&&(logger[_0x1d4317(0xf8)](_0x4a31f7[_0x1d4317(0xff)]),process[_0x1d4317(0xf5)]['BS_TESTOPS_BUILD_COMPLETED']=_0x4a31f7[_0x1d4317(0x101)]),testhubUtils[_0x1d4317(0x149)](_0x544ecb)&&logger['debug'](_0x4a31f7[_0x1d4317(0x14b)]),[null,null];try{const _0x42cb39=await this[_0x1d4317(0x12c)](_0x544ecb,_0x7df1ad),_0x546654=this[_0x1d4317(0x11a)](_0x3f9b65,_0x501e7a),_0x488d91=await _0x4a31f7[_0x1d4317(0x11f)](nodeRequest,_0x4a31f7['ONdTQ'],testHubConstants['TESTHUB_BUILD_API'],_0x42cb39,_0x546654),_0x128b04=this[_0x1d4317(0xeb)](_0x544ecb,_0x488d91,_0x546654);await this[_0x1d4317(0xf7)](_0x29d8c3,_0x7df1ad);if(_0x4a31f7[_0x1d4317(0x184)](testhubUtils[_0x1d4317(0x133)](_0x29d8c3[_0x1d4317(0x155)]),null)){const _0x252d19=_0x128b04[_0x4a31f7[_0x1d4317(0xec)]];_0x252d19&&_0x252d19[_0x1d4317(0x141)]&&_0x252d19[_0x1d4317(0x161)]&&(_0x29d8c3[_0x1d4317(0x155)][_0x1d4317(0x114)]=!![],process[_0x1d4317(0xf5)][_0x1d4317(0x15d)]=_0x4a31f7[_0x1d4317(0x107)]);}return _0x128b04;}catch(_0x3b7fca){if(_0x4a31f7[_0x1d4317(0x159)](_0x3b7fca[_0x1d4317(0x158)],![])){testhubUtils['logBuildError'](_0x3b7fca);return;}}})();}static async[a126_0x4af2c8(0x10f)](){const _0x255095=a126_0x4af2c8,_0x5ededb={'SslwQ':function(_0x30aff7,_0x54a0fb,_0x31e547){return _0x30aff7(_0x54a0fb,_0x31e547);},'XZfdM':function(_0x3bb5dd,_0x4abfc2){return _0x3bb5dd(_0x4abfc2);},'AsTlq':function(_0x3c073d){return _0x3c073d();},'TnmWB':_0x255095(0x103)};if(processedTraceZips)return;const _0xe06ffb=TestDetails[_0x255095(0x16b)]();_0xe06ffb[_0x255095(0xed)](({testUId:_0x4a8328,filePath:_0x2b1600})=>{const _0xaca0eb=_0x255095;var _0x22e76b=_0x5ededb[_0xaca0eb(0xef)](uploadTraceZip,_0x2b1600,_0x4a8328);_0x5ededb['XZfdM'](addEvent,_0x22e76b);});try{await _0x5ededb[_0x255095(0x167)](awaitAllEvents),logger[_0x255095(0xf8)](_0x5ededb[_0x255095(0x169)]),processedTraceZips=!![];}catch(_0x335b1c){logger['error'](_0x255095(0x17a)+util['format'](_0x335b1c));}}static async[a126_0x4af2c8(0xf7)](_0x27d793,_0x4f5409){const _0x19d598=a126_0x4af2c8;if(constants[_0x19d598(0x15b)][_0x19d598(0x139)](_0x4f5409)){await _0x27d793[_0x19d598(0x156)]();return;}_0x27d793[_0x19d598(0x155)]['percy']&&logger['debug'](_0x19d598(0x144)+_0x4f5409+_0x19d598(0x116));}static[a126_0x4af2c8(0x10a)](_0x1e2e0d){const _0x34c360=a126_0x4af2c8,_0x4be50e={'JEUzl':function(_0x15661d,_0x99313f){return _0x15661d(_0x99313f);},'jWCcJ':'true'};let _0x44360f;if(_0x1e2e0d[_0x34c360(0x164)]){const _0x31c909={};_0x31c909[_0x34c360(0x112)]=_0x1e2e0d[_0x34c360(0x164)],_0x44360f=_0x31c909;}else{const _0xdf4a37={};_0xdf4a37[_0x34c360(0x112)]={},_0x44360f=_0xdf4a37;}if((!bsSetupHelper['isBrowserstackInfra']()||_0x4be50e[_0x34c360(0x14f)](isTurboScaleSession,_0x1e2e0d))&&testhubUtils[_0x34c360(0x149)](_0x1e2e0d)){const _0x1358a1={};_0x1358a1[_0x34c360(0x10e)]=_0x4be50e[_0x34c360(0x12b)],Object[_0x34c360(0x183)](_0x44360f[_0x34c360(0x112)],_0x1358a1);}return _0x44360f;}static[a126_0x4af2c8(0x11a)](_0x53644e,_0x4c0d26){const _0x38d4d2=a126_0x4af2c8,_0x28ea94={'wOHbh':function(_0x247fcd,_0x5dfd55){return _0x247fcd(_0x5dfd55);}},_0x330260={};return _0x330260[_0x38d4d2(0x145)]=_0x53644e,_0x330260[_0x38d4d2(0x166)]=_0x4c0d26,{'auth':_0x330260,'headers':_0x28ea94[_0x38d4d2(0xf2)](getDefaultHeaders,![])};}static async[a126_0x4af2c8(0x12c)](_0x5e3ebe,_0x268441){const _0x12c444=a126_0x4af2c8,_0x392e22={'WdDbx':_0x12c444(0x153),'AqfVb':function(_0x24a9c6,_0x20b00f){return _0x24a9c6(_0x20b00f);}};logger['debug'](_0x392e22[_0x12c444(0x17d)]);const _0x798c2a={'project_name':_0x5e3ebe[_0x12c444(0x162)]||'','name':_0x5e3ebe[_0x12c444(0x124)]||path[_0x12c444(0x177)](path[_0x12c444(0x12a)](process[_0x12c444(0xee)]())),'build_identifier':_0x5e3ebe[_0x12c444(0xf9)],'description':_0x5e3ebe[_0x12c444(0x123)]||'','started_at':new Date()[_0x12c444(0x154)](),'tags':_0x392e22['AqfVb'](getCustomTags,_0x5e3ebe),'host_info':bsSetupHelper[_0x12c444(0x13f)](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process['env'][_0x12c444(0x157)],'failed_tests_rerun':process['env'][_0x12c444(0x136)]||![],'linked_build_uuid':process['env'][_0x12c444(0x17f)]||'','version_control':await bsSetupHelper[_0x12c444(0x140)](),'accessibility':this[_0x12c444(0x10a)](_0x5e3ebe),'framework_details':testhubUtils[_0x12c444(0x134)](_0x5e3ebe,_0x268441),'product_map':testhubUtils[_0x12c444(0x117)](_0x5e3ebe),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra'](),'grouping_identifier':process[_0x12c444(0xf5)][_0x12c444(0xfb)],'test_orchestration':testhubUtils[_0x12c444(0xf1)](_0x5e3ebe)};if(bsSetupHelper[_0x12c444(0x119)]()[_0x12c444(0x16a)]||bsSetupHelper['getCentralUser']()[_0x12c444(0x12f)]){const _0x353a26={};_0x353a26['job_id']=process['env'][_0x12c444(0x121)],_0x353a26[_0x12c444(0x170)]=process[_0x12c444(0xf5)]['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x798c2a['central_scanner']=_0x353a26;}return _0x798c2a;}static['extractDataFromResponse'](_0x3a2f3a,_0x20c11e,_0x4cfd60){const _0x3bebad=a126_0x4af2c8,_0x47b071={'noWTI':function(_0x47af50){return _0x47af50();},'ImomK':function(_0x58723b,_0x4c6c6a){return _0x58723b&&_0x4c6c6a;},'oAhNg':'true','FVAlm':_0x3bebad(0x175)},_0xdcb364={};if(_0x47b071['noWTI'](isTestObservabilitySession)){const [_0x3aa173,_0x32cfa2,_0x181f81]=testhubUtils[_0x3bebad(0x147)](_0x20c11e['data'],_0x4cfd60[_0x3bebad(0x10c)]);if(_0x47b071[_0x3bebad(0x126)](_0x3aa173,_0x32cfa2)){const _0x271f67={};_0x271f67[_0x3bebad(0x108)]=_0x3aa173,_0x271f67[_0x3bebad(0x161)]=_0x32cfa2,_0x271f67['allowScreenshot']=_0x181f81,_0xdcb364[testHubConstants[_0x3bebad(0x111)]]=_0x271f67,process['env'][_0x3bebad(0x14a)]=_0x47b071[_0x3bebad(0x130)];}else _0xdcb364[testHubConstants['OBSERVABILITY']]={},process[_0x3bebad(0xf5)][_0x3bebad(0x14a)]=_0x47b071[_0x3bebad(0x186)];}else process[_0x3bebad(0xf5)][_0x3bebad(0x14a)]=_0x47b071[_0x3bebad(0x186)];const [_0x4a1edf,_0x14be5d]=testhubUtils[_0x3bebad(0x143)](_0x20c11e['data']);if(_0x47b071[_0x3bebad(0x126)](_0x4a1edf,_0x14be5d)){const _0x50801c={};_0x50801c['authToken']=_0x4a1edf,_0x50801c[_0x3bebad(0x161)]=_0x14be5d,_0xdcb364[testHubConstants[_0x3bebad(0x168)]]=_0x50801c,process[_0x3bebad(0xf5)][_0x3bebad(0x15e)]=_0x47b071[_0x3bebad(0x130)];}else _0xdcb364[testHubConstants[_0x3bebad(0x168)]]={},process[_0x3bebad(0xf5)][_0x3bebad(0x15e)]=_0x47b071[_0x3bebad(0x186)];return testhubUtils[_0x3bebad(0x15c)](_0x20c11e[_0x3bebad(0x18a)]),logger['info'](_0x3bebad(0x16e)+process['env'][_0x3bebad(0xfe)]),_0xdcb364;}static async[a126_0x4af2c8(0x135)](_0x26d48d){const _0x1c6b19=a126_0x4af2c8,_0x2ccf9f={'RIYiT':function(_0x427495,_0x485f38){return _0x427495===_0x485f38;},'ZVTSV':_0x1c6b19(0x175),'DdvFj':function(_0xc57fca,_0x11552a){return _0xc57fca===_0x11552a;},'SYXwT':_0x1c6b19(0x187),'gndgY':function(_0x1f4fd8,_0x13a8f0){return _0x1f4fd8===_0x13a8f0;},'YKaEI':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','WKATJ':_0x1c6b19(0x173),'kIdzO':_0x1c6b19(0x148),'RYmkp':_0x1c6b19(0x181),'cMcnm':_0x1c6b19(0x13e),'pqTzu':function(_0x17d838){return _0x17d838();},'yzdzD':function(_0x2865a0,_0x14440e,_0x38af30,_0x259364,_0x5847c9,_0x58dfaf){return _0x2865a0(_0x14440e,_0x38af30,_0x259364,_0x5847c9,_0x58dfaf);},'GteiY':'PUT','ozEFj':_0x1c6b19(0x118),'HVgJH':_0x1c6b19(0x158)};await PerformanceTester[_0x1c6b19(0xf4)](PerformanceEvents[_0x1c6b19(0x128)],async()=>{const _0x492151=_0x1c6b19;if(_0x2ccf9f[_0x492151(0x172)](process[_0x492151(0xf5)]['BS_TESTOPS_BUILD_COMPLETED'],_0x2ccf9f[_0x492151(0x115)])||TestHubHandler['buildStopSent']||bsSetupHelper['isUndefined'](process[_0x492151(0xf5)][testHubConstants[_0x492151(0x17c)][_0x492151(0x110)]]))return;TestHubHandler[_0x492151(0xfd)]=!![];if(BrowserstackCLI[_0x492151(0x12d)]()[_0x492151(0x17b)]())return;await this[_0x492151(0x10f)](),await RequestQueueHandler[_0x492151(0x12d)]()[_0x492151(0x13c)](),await SessionHandler[_0x492151(0x122)]();if(_0x2ccf9f[_0x492151(0xfa)](process[_0x492151(0xf5)][testHubConstants['ENV_VAR'][_0x492151(0x110)]],_0x2ccf9f[_0x492151(0x16c)])||_0x2ccf9f['gndgY'](process[_0x492151(0xf5)][testHubConstants[_0x492151(0x17c)]['BROWSERSTACK_TESTHUB_UUID']],_0x2ccf9f['SYXwT'])){logger[_0x492151(0xf8)](_0x2ccf9f['YKaEI']);const _0x59e515={};return _0x59e515['status']=_0x2ccf9f['WKATJ'],_0x59e515[_0x492151(0x179)]=_0x2ccf9f['kIdzO'],_0x59e515;}const _0x29a32e={'finished_at':new Date()[_0x492151(0x154)](),'finished_metadata':[]};!!_0x26d48d&&_0x29a32e[_0x2ccf9f[_0x492151(0x142)]][_0x492151(0x16f)]({'reason':_0x2ccf9f[_0x492151(0x15a)],'signal':_0x26d48d,'failure_data':''});const _0x35539b={'headers':_0x2ccf9f[_0x492151(0xea)](getDefaultHeaders)};try{const _0x2e5cb5=await _0x2ccf9f[_0x492151(0x176)](nodeRequest,_0x2ccf9f[_0x492151(0x188)],_0x492151(0x150)+process['env'][testHubConstants['ENV_VAR'][_0x492151(0xfe)]]+_0x492151(0x137),_0x29a32e,_0x35539b,![]);if(_0x2e5cb5[_0x492151(0x18a)]&&_0x2e5cb5[_0x492151(0x18a)]['error']){const _0x5e07a7={};_0x5e07a7['message']=_0x2e5cb5[_0x492151(0x18a)][_0x492151(0x173)];throw _0x5e07a7;}else{logger[_0x492151(0xf8)](_0x2ccf9f[_0x492151(0x104)]);const _0x69b36e={};return _0x69b36e['status']=_0x2ccf9f[_0x492151(0x113)],_0x69b36e[_0x492151(0x179)]='',_0x69b36e;}}catch(_0x570398){_0x570398[_0x492151(0x13b)]?logger['debug'](_0x492151(0x178)+_0x570398['response'][_0x492151(0x174)]+'\x20'+_0x570398[_0x492151(0x13b)][_0x492151(0x125)]+'\x20'+JSON[_0x492151(0x180)](_0x570398['response'][_0x492151(0x18a)])):logger[_0x492151(0xf8)](_0x492151(0x178)+(_0x570398[_0x492151(0x179)]||_0x570398));const _0x5cd943={};return _0x5cd943[_0x492151(0x174)]=_0x2ccf9f[_0x492151(0x171)],_0x5cd943[_0x492151(0x179)]=_0x570398[_0x492151(0x179)]||_0x570398['response']?_0x570398[_0x492151(0x13b)][_0x492151(0x174)]+':'+_0x570398[_0x492151(0x13b)][_0x492151(0x125)]:_0x570398,_0x5cd943;}})();}}module['exports']=TestHubHandler;
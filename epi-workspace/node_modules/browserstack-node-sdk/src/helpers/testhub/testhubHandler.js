const a126_0xb83670=a126_0x5c2b;function a126_0x5c2b(_0x1358b6,_0x33416f){const _0x57c088=a126_0x57c0();return a126_0x5c2b=function(_0x5c2b3e,_0xa98c0f){_0x5c2b3e=_0x5c2b3e-0x93;let _0x4fefab=_0x57c088[_0x5c2b3e];return _0x4fefab;},a126_0x5c2b(_0x1358b6,_0x33416f);}function a126_0x57c0(){const _0x2a1261=['assign','getConfig','allowScreenshot','includeEncodedExtension','twJjD','VEqee','./utils.js','rTCmc','config','projectName','fdmAi','BROWSERSTACK_ACCESSIBILITY','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','BROWSERSTACK_TESTHUB_UUID','ACCESSIBILITY','BROWSERSTACK_LINKED_BUILD_UUID','GVLzj','PUT','stopBuildUpstream\x20event\x20successful!','362111PTZKMc','xOtNG','All\x20trace\x20zip\x20send\x20events\x20complete','isAccessibilityEnabled','generateBuildUpstreamData','getCentralUser','getProductMap','GbxIu','getHostInfo','3047356OYWuCo','accessibility','11AxdpFF','push','BROWSERSTACK_CENTRAL_SCANNER_JOBID','ISwDE','getInstance','../performance/constants','ENV_VAR','BROWSERSTACK_TESTHUB_JWT','BROWSERSTACK_PRODUCT_MAP','debug','ZKhVB','PERCY_SUPPORTED_FRAMEWORKS','data','true','error','allSettled','536394wpUApJ','getCiInfo','JEAuE','password','2KHkAlc','getUserName','response','status','setTestHubCommonMetaInfo','extractDataFromResponse','setTestObservabilityVariables','Testhub\x20started\x20with\x20id:\x20','authToken','cwd','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','basename','BS_TESTOPS_BUILD_COMPLETED','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','GhAri','includes','getGitMetaData','24lDKTMJ','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','settings','add','3277827xpgRKU','xQvnG','success','WdcZm','toISOString','getAccessibilityOptions','SWOMI','../test-observability/utils','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','../logger','xgsLO','measureWrapper','percy','BROWSERSTACK_BUILD_RUN_IDENTIFIER','auth','WuaYl','false','getTestOrchestrationBuildStartData','getProductMapForBuildStartCall','buildHashedId','BROWSERSTACK_CENTRAL_SCANNER_JWT','stringify','resolve','/stop','Error\x20while\x20waiting\x20for\x20events:\x20','processTraceZips','token','1053336dRfQPe','../../bin/playwright/reporter/pwUtils.js','job_id','cOobx','isUndefined','STOP','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','OBSERVABILITY','forEach','accessibilityOptions','../performance/performance-tester.js','setAccessibilityVariables','central_scanner','zJPGY','../test-observability/requestQueueHandler.js','xtHAM','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','BROWSERSTACK_TEST_OBSERVABILITY','MJZpT','../../bin/utils/constants.js','Xawiv','lcnc','eertu','BROWSERSTACK_RERUN','15sgZNzr','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','\x20framework','../test-observability/sessionHandler.js','statusText','env','19773650qVYCNa','EbDHK','getAccessibilityValueFromYml','user_killed','finished_metadata','811647WEBcXd','path','buildStopSent','format','isRunning','ciuKW','setupPercy','api/v1/builds/','Percy\x20is\x20not\x20supported\x20for\x20','util','message','isBrowserstackInfra','getAccessKey','VmfMI','uploadPending','FXeSC'];a126_0x57c0=function(){return _0x2a1261;};return a126_0x57c0();}(function(_0x3ee0a7,_0x23c1ca){const _0x5526ea=a126_0x5c2b,_0x4d64b9=_0x3ee0a7();while(!![]){try{const _0x4baa8d=-parseInt(_0x5526ea(0x104))/0x1*(-parseInt(_0x5526ea(0x123))/0x2)+parseInt(_0x5526ea(0x11f))/0x3+parseInt(_0x5526ea(0x10d))/0x4+parseInt(_0x5526ea(0xd6))/0x5*(parseInt(_0x5526ea(0xbe))/0x6)+parseInt(_0x5526ea(0xa3))/0x7+parseInt(_0x5526ea(0x9f))/0x8*(parseInt(_0x5526ea(0xe1))/0x9)+parseInt(_0x5526ea(0xdc))/0xa*(-parseInt(_0x5526ea(0x10f))/0xb);if(_0x4baa8d===_0x23c1ca)break;else _0x4d64b9['push'](_0x4d64b9['shift']());}catch(_0x5b84e7){_0x4d64b9['push'](_0x4d64b9['shift']());}}}(a126_0x57c0,0x9040d));const bsSetupHelper=require('../helper'),path=require(a126_0xb83670(0xe2)),util=require(a126_0xb83670(0xea)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a126_0xb83670(0xaa)),testhubUtils=require(a126_0xb83670(0xf7)),testHubConstants=require('./constants.js'),constants=require(a126_0xb83670(0xd1)),RequestQueueHandler=require(a126_0xb83670(0xcc)),logger=require(a126_0xb83670(0xac))['winstonLogger'],SessionHandler=require(a126_0xb83670(0xd9)),PerformanceTester=require(a126_0xb83670(0xc8)),{TESTHUB_EVENTS:PerformanceEvents}=require(a126_0xb83670(0x114)),TestDetails=require('../../bin/playwright/reporter/test-details.js'),{uploadTraceZip}=require(a126_0xb83670(0xbf)),{isTurboScaleSession}=require('../helper.js'),BrowserstackCLI=require('../../bin/v2/browserstackCLI'),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0xf4fc34=>{const _0x3a37ba=a126_0xb83670;OngoingEvents[_0x3a37ba(0xa2)](_0xf4fc34);},awaitAllEvents=async()=>{const _0x5bbef9=a126_0xb83670;return Promise[_0x5bbef9(0x11e)](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async['launchBuild'](_0x2e5141,_0x57959e){const _0x56f57c=a126_0xb83670,_0x362018={'WuaYl':function(_0x4e8697,_0x18359b){return _0x4e8697||_0x18359b;},'rTCmc':function(_0x993335,_0x46ccd1){return _0x993335===_0x46ccd1;},'cOobx':function(_0xd5944b){return _0xd5944b();},'xQvnG':_0x56f57c(0x9b),'ciuKW':'false','oHGzP':_0x56f57c(0xfd),'UsmvX':function(_0x15033b,_0x13b6f5,_0x385b19,_0x579fa7,_0x107d33){return _0x15033b(_0x13b6f5,_0x385b19,_0x579fa7,_0x107d33);},'ftnFG':'POST','xtHAM':function(_0x18398d,_0x46febe){return _0x18398d===_0x46febe;},'sZIbY':_0x56f57c(0x10e),'VmfMI':_0x56f57c(0x11c)};await PerformanceTester[_0x56f57c(0xae)](PerformanceEvents['START'],async()=>{const _0x16bf22=_0x56f57c,_0x365736=Object[_0x16bf22(0xf1)]({},_0x57959e[_0x16bf22(0xf9)],{'root_dir_path':'','framework':_0x57959e['framework']}),_0x1e6acb=bsSetupHelper[_0x16bf22(0x124)](_0x365736),_0x434450=bsSetupHelper[_0x16bf22(0xed)](_0x365736),_0x35bea3=_0x362018[_0x16bf22(0xb2)](_0x1e6acb,'')+':'+_0x362018['WuaYl'](_0x434450,''),_0x2d08a9=testhubUtils[_0x16bf22(0x10a)](_0x365736);process[_0x16bf22(0xdb)][_0x16bf22(0x117)]=JSON[_0x16bf22(0xb8)](_0x2d08a9);if(_0x362018[_0x16bf22(0xf8)](_0x35bea3,':'))return _0x362018[_0x16bf22(0xc1)](isTestObservabilitySession)&&(logger[_0x16bf22(0x118)](_0x362018[_0x16bf22(0xa4)]),process[_0x16bf22(0xdb)][_0x16bf22(0x9a)]=_0x362018[_0x16bf22(0xe6)]),testhubUtils[_0x16bf22(0x107)](_0x365736)&&logger[_0x16bf22(0x118)](_0x362018['oHGzP']),[null,null];try{const _0x217e04=await this[_0x16bf22(0x108)](_0x365736,_0x2e5141),_0x1a6715=this[_0x16bf22(0xf2)](_0x1e6acb,_0x434450),_0x1b58d8=await _0x362018['UsmvX'](nodeRequest,_0x362018['ftnFG'],testHubConstants['TESTHUB_BUILD_API'],_0x217e04,_0x1a6715),_0x4b1c7a=this[_0x16bf22(0x93)](_0x365736,_0x1b58d8,_0x1a6715);await this['checkAndSetupPercy'](_0x57959e,_0x2e5141);if(_0x362018[_0x16bf22(0xcd)](testhubUtils[_0x16bf22(0xde)](_0x57959e[_0x16bf22(0xf9)]),null)){const _0x1c5c54=_0x4b1c7a[_0x362018['sZIbY']];_0x1c5c54&&_0x1c5c54['authToken']&&_0x1c5c54[_0x16bf22(0xb6)]&&(_0x57959e[_0x16bf22(0xf9)][_0x16bf22(0x10e)]=!![],process[_0x16bf22(0xdb)][_0x16bf22(0xce)]=_0x362018[_0x16bf22(0xee)]);}return _0x4b1c7a;}catch(_0x20fa0a){if(_0x362018[_0x16bf22(0xcd)](_0x20fa0a[_0x16bf22(0xa5)],![])){testhubUtils['logBuildError'](_0x20fa0a);return;}}})();}static async['processTraceZips'](){const _0x29a5e1=a126_0xb83670,_0x32b0ad={'CQleC':function(_0x2bf8ee,_0xf71a9d,_0x374bfa){return _0x2bf8ee(_0xf71a9d,_0x374bfa);},'ADCBM':function(_0x7bf321,_0x12569f){return _0x7bf321(_0x12569f);},'GbxIu':function(_0xaecdbe){return _0xaecdbe();},'GhAri':_0x29a5e1(0x106)};if(processedTraceZips)return;const _0x4f776f=TestDetails['getTraceFilePaths']();_0x4f776f[_0x29a5e1(0xc6)](({testUId:_0x58496c,filePath:_0x34071f})=>{var _0x530ded=_0x32b0ad['CQleC'](uploadTraceZip,_0x34071f,_0x58496c);_0x32b0ad['ADCBM'](addEvent,_0x530ded);});try{await _0x32b0ad[_0x29a5e1(0x10b)](awaitAllEvents),logger['debug'](_0x32b0ad[_0x29a5e1(0x9c)]),processedTraceZips=!![];}catch(_0x3e4a14){logger['error'](_0x29a5e1(0xbb)+util[_0x29a5e1(0xe4)](_0x3e4a14));}}static async['checkAndSetupPercy'](_0x3fce9f,_0x4d059b){const _0x18f584=a126_0xb83670;if(constants[_0x18f584(0x11a)][_0x18f584(0x9d)](_0x4d059b)){await _0x3fce9f[_0x18f584(0xe7)]();return;}_0x3fce9f[_0x18f584(0xf9)][_0x18f584(0xaf)]&&logger[_0x18f584(0x118)](_0x18f584(0xe9)+_0x4d059b+_0x18f584(0xd8));}static[a126_0xb83670(0xa8)](_0x4996f3){const _0x10d25f=a126_0xb83670,_0x5e0588={'SWOMI':function(_0x1349d8,_0x3a7251){return _0x1349d8(_0x3a7251);},'Luqrx':'true'};let _0x4dccb4;if(_0x4996f3[_0x10d25f(0xc7)]){const _0x1cde5f={};_0x1cde5f[_0x10d25f(0xa1)]=_0x4996f3[_0x10d25f(0xc7)],_0x4dccb4=_0x1cde5f;}else{const _0x586d57={};_0x586d57[_0x10d25f(0xa1)]={},_0x4dccb4=_0x586d57;}if((!bsSetupHelper['isBrowserstackInfra']()||_0x5e0588[_0x10d25f(0xa9)](isTurboScaleSession,_0x4996f3))&&testhubUtils['isAccessibilityEnabled'](_0x4996f3)){const _0x1d0c60={};_0x1d0c60[_0x10d25f(0xf4)]=_0x5e0588['Luqrx'],Object[_0x10d25f(0xf1)](_0x4dccb4['settings'],_0x1d0c60);}return _0x4dccb4;}static[a126_0xb83670(0xf2)](_0x5bb236,_0x5e3293){const _0x4fc13d=a126_0xb83670,_0x475808={'xOtNG':function(_0x32b56d,_0x19408e){return _0x32b56d(_0x19408e);}},_0x2da9ec={};return _0x2da9ec['username']=_0x5bb236,_0x2da9ec[_0x4fc13d(0x122)]=_0x5e3293,{'auth':_0x2da9ec,'headers':_0x475808[_0x4fc13d(0x105)](getDefaultHeaders,![])};}static async[a126_0xb83670(0x108)](_0x15f153,_0xb7ffa3){const _0x37cba6=a126_0xb83670,_0x499a18={'EbDHK':_0x37cba6(0x98),'ZKhVB':function(_0x436fac,_0x272ac5){return _0x436fac(_0x272ac5);}};logger[_0x37cba6(0x118)](_0x499a18[_0x37cba6(0xdd)]);const _0x27e9c0={'project_name':_0x15f153[_0x37cba6(0xfa)]||'','name':_0x15f153['buildName']||path[_0x37cba6(0x99)](path[_0x37cba6(0xb9)](process[_0x37cba6(0x97)]())),'build_identifier':_0x15f153['buildIdentifier'],'description':_0x15f153['buildDescription']||'','started_at':new Date()[_0x37cba6(0xa7)](),'tags':_0x499a18[_0x37cba6(0x119)](getCustomTags,_0x15f153),'host_info':bsSetupHelper[_0x37cba6(0x10c)](),'ci_info':bsSetupHelper[_0x37cba6(0x120)](),'build_run_identifier':process['env'][_0x37cba6(0xb0)],'failed_tests_rerun':process[_0x37cba6(0xdb)][_0x37cba6(0xd5)]||![],'linked_build_uuid':process[_0x37cba6(0xdb)][_0x37cba6(0x100)]||'','version_control':await bsSetupHelper[_0x37cba6(0x9e)](),'accessibility':this[_0x37cba6(0xa8)](_0x15f153),'framework_details':testhubUtils['getFrameworkDetails'](_0x15f153,_0xb7ffa3),'product_map':testhubUtils[_0x37cba6(0xb5)](_0x15f153),'browserstackAutomation':bsSetupHelper[_0x37cba6(0xec)](),'grouping_identifier':process[_0x37cba6(0xdb)][_0x37cba6(0xd7)],'test_orchestration':testhubUtils[_0x37cba6(0xb4)](_0x15f153)};if(bsSetupHelper[_0x37cba6(0x109)]()[_0x37cba6(0xca)]||bsSetupHelper[_0x37cba6(0x109)]()[_0x37cba6(0xd3)]){const _0x3c0660={};_0x3c0660[_0x37cba6(0xc0)]=process['env'][_0x37cba6(0x111)],_0x3c0660[_0x37cba6(0xbd)]=process[_0x37cba6(0xdb)][_0x37cba6(0xb7)],_0x27e9c0['central_scanner']=_0x3c0660;}return _0x27e9c0;}static['extractDataFromResponse'](_0x23c529,_0x37f30c,_0x3cef20){const _0x319439=a126_0xb83670,_0x506bc0={'xgsLO':function(_0x4e50ae){return _0x4e50ae();},'FXeSC':function(_0x1fe321,_0x164758){return _0x1fe321&&_0x164758;},'JEAuE':_0x319439(0x11c),'MJZpT':'false'},_0x3dcb68={};if(_0x506bc0[_0x319439(0xad)](isTestObservabilitySession)){const [_0x597351,_0x858e8,_0x3d497c]=testhubUtils[_0x319439(0x94)](_0x37f30c[_0x319439(0x11b)],_0x3cef20[_0x319439(0xb1)]);if(_0x506bc0[_0x319439(0xf0)](_0x597351,_0x858e8)){const _0x2bfd7a={};_0x2bfd7a['jwt']=_0x597351,_0x2bfd7a[_0x319439(0xb6)]=_0x858e8,_0x2bfd7a[_0x319439(0xf3)]=_0x3d497c,_0x3dcb68[testHubConstants[_0x319439(0xc5)]]=_0x2bfd7a,process[_0x319439(0xdb)][_0x319439(0xcf)]=_0x506bc0[_0x319439(0x121)];}else _0x3dcb68[testHubConstants['OBSERVABILITY']]={},process[_0x319439(0xdb)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x506bc0['MJZpT'];}else process['env'][_0x319439(0xcf)]=_0x506bc0[_0x319439(0xd0)];const [_0x50f12e,_0x47d5ec]=testhubUtils[_0x319439(0xc9)](_0x37f30c[_0x319439(0x11b)]);if(_0x506bc0['FXeSC'](_0x50f12e,_0x47d5ec)){const _0x2f7ae1={};_0x2f7ae1[_0x319439(0x96)]=_0x50f12e,_0x2f7ae1[_0x319439(0xb6)]=_0x47d5ec,_0x3dcb68[testHubConstants['ACCESSIBILITY']]=_0x2f7ae1,process[_0x319439(0xdb)][_0x319439(0xfc)]=_0x506bc0[_0x319439(0x121)];}else _0x3dcb68[testHubConstants[_0x319439(0xff)]]={},process[_0x319439(0xdb)][_0x319439(0xfc)]=_0x506bc0[_0x319439(0xd0)];return testhubUtils[_0x319439(0x127)](_0x37f30c[_0x319439(0x11b)]),logger['info'](_0x319439(0x95)+process[_0x319439(0xdb)]['BROWSERSTACK_TESTHUB_UUID']),_0x3dcb68;}static async['stop'](_0x2c066c){const _0x2f9f9b=a126_0xb83670,_0x4fe881={'GVLzj':function(_0x2e14c3,_0x285411){return _0x2e14c3===_0x285411;},'JsYOo':_0x2f9f9b(0xb3),'ISwDE':'null','lBszS':function(_0x3ec542,_0x34efab){return _0x3ec542===_0x34efab;},'wPecc':_0x2f9f9b(0xc4),'BCigY':_0x2f9f9b(0x11d),'zJPGY':_0x2f9f9b(0xa0),'WdcZm':_0x2f9f9b(0xe0),'VEqee':_0x2f9f9b(0xdf),'jnaVC':function(_0x4f2ba8){return _0x4f2ba8();},'eertu':function(_0xc3402c,_0x57642e,_0xeec8ea,_0xaf8597,_0x4044e7,_0x4af56d){return _0xc3402c(_0x57642e,_0xeec8ea,_0xaf8597,_0x4044e7,_0x4af56d);},'Xawiv':_0x2f9f9b(0x102),'fdmAi':_0x2f9f9b(0x103),'twJjD':_0x2f9f9b(0xa5)};!BrowserstackCLI['getInstance']()[_0x2f9f9b(0xe5)]()&&await this[_0x2f9f9b(0xbc)](),await PerformanceTester[_0x2f9f9b(0xae)](PerformanceEvents[_0x2f9f9b(0xc3)],async()=>{const _0x2f2ac6=_0x2f9f9b;if(_0x4fe881[_0x2f2ac6(0x101)](process[_0x2f2ac6(0xdb)][_0x2f2ac6(0x9a)],_0x4fe881['JsYOo'])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x2f2ac6(0xc2)](process[_0x2f2ac6(0xdb)][testHubConstants[_0x2f2ac6(0x115)][_0x2f2ac6(0x116)]]))return;TestHubHandler[_0x2f2ac6(0xe3)]=!![],await RequestQueueHandler[_0x2f2ac6(0x113)]()[_0x2f2ac6(0xef)](),await SessionHandler['waitForBuildStatus']();if(_0x4fe881[_0x2f2ac6(0x101)](process['env'][testHubConstants['ENV_VAR'][_0x2f2ac6(0x116)]],_0x4fe881[_0x2f2ac6(0x112)])||_0x4fe881['lBszS'](process[_0x2f2ac6(0xdb)][testHubConstants[_0x2f2ac6(0x115)][_0x2f2ac6(0xfe)]],_0x4fe881['ISwDE'])){logger['debug'](_0x4fe881['wPecc']);const _0x41dc3d={};return _0x41dc3d[_0x2f2ac6(0x126)]=_0x4fe881['BCigY'],_0x41dc3d[_0x2f2ac6(0xeb)]=_0x4fe881[_0x2f2ac6(0xcb)],_0x41dc3d;}const _0x13aaae={'finished_at':new Date()[_0x2f2ac6(0xa7)](),'finished_metadata':[]};!!_0x2c066c&&_0x13aaae[_0x4fe881[_0x2f2ac6(0xa6)]][_0x2f2ac6(0x110)]({'reason':_0x4fe881[_0x2f2ac6(0xf6)],'signal':_0x2c066c,'failure_data':''});const _0x3111e3={'headers':_0x4fe881['jnaVC'](getDefaultHeaders)};try{const _0x4bc7da=await _0x4fe881[_0x2f2ac6(0xd4)](nodeRequest,_0x4fe881[_0x2f2ac6(0xd2)],_0x2f2ac6(0xe8)+process[_0x2f2ac6(0xdb)][testHubConstants['ENV_VAR'][_0x2f2ac6(0xfe)]]+_0x2f2ac6(0xba),_0x13aaae,_0x3111e3,![]);if(_0x4bc7da[_0x2f2ac6(0x11b)]&&_0x4bc7da[_0x2f2ac6(0x11b)][_0x2f2ac6(0x11d)]){const _0x5880d8={};_0x5880d8['message']=_0x4bc7da[_0x2f2ac6(0x11b)]['error'];throw _0x5880d8;}else{logger['debug'](_0x4fe881[_0x2f2ac6(0xfb)]);const _0x6c8443={};return _0x6c8443[_0x2f2ac6(0x126)]=_0x4fe881[_0x2f2ac6(0xf5)],_0x6c8443[_0x2f2ac6(0xeb)]='',_0x6c8443;}}catch(_0x5348b8){_0x5348b8['response']?logger[_0x2f2ac6(0x118)](_0x2f2ac6(0xab)+_0x5348b8[_0x2f2ac6(0x125)][_0x2f2ac6(0x126)]+'\x20'+_0x5348b8[_0x2f2ac6(0x125)][_0x2f2ac6(0xda)]+'\x20'+JSON[_0x2f2ac6(0xb8)](_0x5348b8[_0x2f2ac6(0x125)]['data'])):logger[_0x2f2ac6(0x118)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x5348b8[_0x2f2ac6(0xeb)]||_0x5348b8));const _0x3f117d={};return _0x3f117d[_0x2f2ac6(0x126)]=_0x4fe881['BCigY'],_0x3f117d['message']=_0x5348b8[_0x2f2ac6(0xeb)]||_0x5348b8['response']?_0x5348b8['response']['status']+':'+_0x5348b8[_0x2f2ac6(0x125)]['statusText']:_0x5348b8,_0x3f117d;}})();}}module['exports']=TestHubHandler;
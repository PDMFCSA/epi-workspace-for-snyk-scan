const a90_0x59cb44=a90_0x3021;(function(_0x15bfab,_0x4f0153){const _0x4841a8=a90_0x3021,_0x1030a8=_0x15bfab();while(!![]){try{const _0x3600f0=-parseInt(_0x4841a8(0x1e7))/0x1+parseInt(_0x4841a8(0x227))/0x2+parseInt(_0x4841a8(0x1fe))/0x3+parseInt(_0x4841a8(0x24f))/0x4*(-parseInt(_0x4841a8(0x231))/0x5)+parseInt(_0x4841a8(0x237))/0x6+-parseInt(_0x4841a8(0x1f5))/0x7*(-parseInt(_0x4841a8(0x235))/0x8)+parseInt(_0x4841a8(0x262))/0x9;if(_0x3600f0===_0x4f0153)break;else _0x1030a8['push'](_0x1030a8['shift']());}catch(_0x303494){_0x1030a8['push'](_0x1030a8['shift']());}}}(a90_0x233e,0x80902));function a90_0x3021(_0x38941d,_0x83ba29){const _0x233e6c=a90_0x233e();return a90_0x3021=function(_0x30212f,_0x543785){_0x30212f=_0x30212f-0x1e3;let _0x4174ac=_0x233e6c[_0x30212f];return _0x4174ac;},a90_0x3021(_0x38941d,_0x83ba29);}const bsSetupHelper=require(a90_0x59cb44(0x1f2)),path=require('path'),util=require('util'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a90_0x59cb44(0x26e)),testhubUtils=require(a90_0x59cb44(0x25b)),testHubConstants=require(a90_0x59cb44(0x209)),constants=require(a90_0x59cb44(0x266)),RequestQueueHandler=require(a90_0x59cb44(0x253)),logger=require(a90_0x59cb44(0x257))['winstonLogger'],SessionHandler=require(a90_0x59cb44(0x263)),PerformanceTester=require(a90_0x59cb44(0x255)),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x59cb44(0x259)),TestDetails=require(a90_0x59cb44(0x233)),{uploadTraceZip}=require(a90_0x59cb44(0x22d)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x27e230=>{const _0x35bd9f=a90_0x59cb44;OngoingEvents[_0x35bd9f(0x216)](_0x27e230);},awaitAllEvents=async()=>{return Promise['allSettled'](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async['launchBuild'](_0xe9ad38,_0x46e81e){const _0x5a4833=a90_0x59cb44,_0x3d43a9={'RoFRY':function(_0xb94bab,_0xc37b45){return _0xb94bab||_0xc37b45;},'RyjQw':function(_0x2cb540,_0x2e8d76){return _0x2cb540||_0x2e8d76;},'ZkrTg':function(_0x2dad9e,_0x2d70e7){return _0x2dad9e===_0x2d70e7;},'LmsRq':function(_0x2107c7){return _0x2107c7();},'XhIgF':_0x5a4833(0x228),'QhOcP':_0x5a4833(0x1ef),'Yhkdj':_0x5a4833(0x26b),'trfqT':function(_0x3a01c9,_0x247f43,_0x5301d9,_0x39305f,_0x8cbff6){return _0x3a01c9(_0x247f43,_0x5301d9,_0x39305f,_0x8cbff6);},'TGvWo':_0x5a4833(0x229),'SVLgZ':_0x5a4833(0x23a),'sDKid':_0x5a4833(0x230)};await PerformanceTester[_0x5a4833(0x20b)](PerformanceEvents['START'],async()=>{const _0x5900d8=_0x5a4833,_0x3d499d=Object[_0x5900d8(0x202)]({},_0x46e81e[_0x5900d8(0x219)],{'root_dir_path':'','framework':_0x46e81e[_0x5900d8(0x261)]}),_0x34c3ed=bsSetupHelper[_0x5900d8(0x1fc)](_0x3d499d),_0x223a2b=bsSetupHelper['getAccessKey'](_0x3d499d),_0x2d2ddd=_0x3d43a9[_0x5900d8(0x214)](_0x34c3ed,'')+':'+_0x3d43a9[_0x5900d8(0x217)](_0x223a2b,''),_0x22881e=testhubUtils['getProductMap'](_0x3d499d);process[_0x5900d8(0x204)][_0x5900d8(0x258)]=JSON[_0x5900d8(0x26c)](_0x22881e);if(_0x3d43a9[_0x5900d8(0x226)](_0x2d2ddd,':'))return _0x3d43a9[_0x5900d8(0x220)](isTestObservabilitySession)&&(logger[_0x5900d8(0x1ea)](_0x3d43a9[_0x5900d8(0x26a)]),process[_0x5900d8(0x204)][_0x5900d8(0x1eb)]=_0x3d43a9[_0x5900d8(0x267)]),testhubUtils['isAccessibilityEnabled'](_0x3d499d)&&logger[_0x5900d8(0x1ea)](_0x3d43a9['Yhkdj']),[null,null];try{const _0x35b08f=await this['generateBuildUpstreamData'](_0x3d499d,_0xe9ad38),_0x11b20=this['getConfig'](_0x34c3ed,_0x223a2b),_0x1d9bc5=await _0x3d43a9[_0x5900d8(0x200)](nodeRequest,_0x3d43a9['TGvWo'],testHubConstants['TESTHUB_BUILD_API'],_0x35b08f,_0x11b20),_0x15d364=this[_0x5900d8(0x254)](_0x3d499d,_0x1d9bc5,_0x11b20);await this['checkAndSetupPercy'](_0x46e81e,_0xe9ad38);if(_0x3d43a9[_0x5900d8(0x226)](testhubUtils[_0x5900d8(0x242)](_0x46e81e[_0x5900d8(0x219)]),null)){const _0x1440d5=_0x15d364[_0x3d43a9[_0x5900d8(0x203)]];_0x1440d5&&_0x1440d5['authToken']&&_0x1440d5[_0x5900d8(0x22a)]&&(_0x46e81e['config'][_0x5900d8(0x23a)]=!![],process['env'][_0x5900d8(0x1e5)]=_0x3d43a9[_0x5900d8(0x25c)]);}return _0x15d364;}catch(_0x58f8b0){if(_0x3d43a9[_0x5900d8(0x226)](_0x58f8b0['success'],![])){testhubUtils['logBuildError'](_0x58f8b0);return;}}})();}static async['processTraceZips'](){const _0x261cc3=a90_0x59cb44,_0x23b7ad={'EQZXv':function(_0x259b8d,_0x5224fe,_0xd781d){return _0x259b8d(_0x5224fe,_0xd781d);},'SDReA':function(_0x4078cc,_0xa67e41){return _0x4078cc(_0xa67e41);},'lcIYh':function(_0x559b61){return _0x559b61();},'BFhME':_0x261cc3(0x225)};if(processedTraceZips)return;const _0x286556=TestDetails[_0x261cc3(0x23e)]();_0x286556[_0x261cc3(0x207)](({testUId:_0x3dcfe2,filePath:_0x24d2a1})=>{const _0x93e8a8=_0x261cc3;var _0x589eed=_0x23b7ad[_0x93e8a8(0x1e9)](uploadTraceZip,_0x24d2a1,_0x3dcfe2);_0x23b7ad[_0x93e8a8(0x236)](addEvent,_0x589eed);});try{await _0x23b7ad['lcIYh'](awaitAllEvents),logger[_0x261cc3(0x1ea)](_0x23b7ad[_0x261cc3(0x22b)]),processedTraceZips=!![];}catch(_0xd7e950){logger['error'](_0x261cc3(0x239)+util[_0x261cc3(0x1ec)](_0xd7e950));}}static async['checkAndSetupPercy'](_0x19b0ca,_0x3b2134){const _0x155f59=a90_0x59cb44;if(constants[_0x155f59(0x22e)]['includes'](_0x3b2134)){await _0x19b0ca[_0x155f59(0x1e3)]();return;}_0x19b0ca[_0x155f59(0x219)]['percy']&&logger[_0x155f59(0x1ea)](_0x155f59(0x21b)+_0x3b2134+_0x155f59(0x21a));}static[a90_0x59cb44(0x224)](_0x122841){const _0x12d50f=a90_0x59cb44,_0x41cf9b={};_0x41cf9b[_0x12d50f(0x23b)]=_0x122841['accessibilityOptions'];const _0x22839d=_0x41cf9b;return _0x22839d;}static[a90_0x59cb44(0x1fd)](_0x3eeb73,_0x45e76e){const _0x15c81f=a90_0x59cb44,_0x461f0d={'RASMn':function(_0x1a0ce3,_0x8d27ee){return _0x1a0ce3(_0x8d27ee);}},_0x3a4f6b={};return _0x3a4f6b['username']=_0x3eeb73,_0x3a4f6b[_0x15c81f(0x23f)]=_0x45e76e,{'auth':_0x3a4f6b,'headers':_0x461f0d[_0x15c81f(0x250)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x2acc29,_0x106c40){const _0x1c2e55=a90_0x59cb44,_0x296dad={'mLrgS':function(_0x49acfb,_0x13945b){return _0x49acfb(_0x13945b);}},_0x5fc883={'project_name':_0x2acc29['projectName']||'','name':_0x2acc29['buildName']||path[_0x1c2e55(0x24c)](path[_0x1c2e55(0x212)](process[_0x1c2e55(0x1f3)]())),'build_identifier':_0x2acc29[_0x1c2e55(0x1f6)],'description':_0x2acc29[_0x1c2e55(0x249)]||'','started_at':new Date()[_0x1c2e55(0x251)](),'tags':_0x296dad[_0x1c2e55(0x240)](getCustomTags,_0x2acc29),'host_info':bsSetupHelper[_0x1c2e55(0x269)](),'ci_info':bsSetupHelper[_0x1c2e55(0x252)](),'build_run_identifier':process[_0x1c2e55(0x204)][_0x1c2e55(0x24a)],'failed_tests_rerun':process[_0x1c2e55(0x204)][_0x1c2e55(0x24b)]||![],'version_control':await bsSetupHelper[_0x1c2e55(0x25e)](),'accessibility':this[_0x1c2e55(0x224)](_0x2acc29),'framework_details':testhubUtils[_0x1c2e55(0x1f9)](_0x2acc29,_0x106c40),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x2acc29),'browserstackAutomation':bsSetupHelper[_0x1c2e55(0x264)](),'grouping_identifier':process[_0x1c2e55(0x204)]['BROWSERSTACK_BUILD_GROUPING_IDENTIFIER']};if(bsSetupHelper[_0x1c2e55(0x23c)]()[_0x1c2e55(0x223)]||bsSetupHelper[_0x1c2e55(0x23c)]()['lcnc']){const _0x7ca016={};_0x7ca016[_0x1c2e55(0x221)]=process[_0x1c2e55(0x204)]['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0x7ca016[_0x1c2e55(0x245)]=process[_0x1c2e55(0x204)][_0x1c2e55(0x26d)],_0x5fc883[_0x1c2e55(0x223)]=_0x7ca016;}return _0x5fc883;}static[a90_0x59cb44(0x254)](_0x2f2593,_0x255e76,_0x9d4548){const _0x21fa06=a90_0x59cb44,_0x26bf96={'TMHkl':function(_0x210db8){return _0x210db8();},'kmDQq':function(_0x3b523d,_0x39566d){return _0x3b523d&&_0x39566d;},'CYOOD':_0x21fa06(0x230),'xxVZg':_0x21fa06(0x1ef)},_0x522a63={};if(_0x26bf96[_0x21fa06(0x265)](isTestObservabilitySession)){const [_0xc5f7ba,_0x3e1a44,_0x5e54ae]=testhubUtils[_0x21fa06(0x25a)](_0x255e76[_0x21fa06(0x244)],_0x9d4548[_0x21fa06(0x1f7)]);if(_0x26bf96['kmDQq'](_0xc5f7ba,_0x3e1a44)){const _0x277a03={};_0x277a03[_0x21fa06(0x21d)]=_0xc5f7ba,_0x277a03['buildHashedId']=_0x3e1a44,_0x277a03[_0x21fa06(0x24d)]=_0x5e54ae,_0x522a63[testHubConstants[_0x21fa06(0x24e)]]=_0x277a03,process[_0x21fa06(0x204)][_0x21fa06(0x20f)]=_0x26bf96['CYOOD'];}else _0x522a63[testHubConstants[_0x21fa06(0x24e)]]={},process[_0x21fa06(0x204)][_0x21fa06(0x20f)]=_0x26bf96[_0x21fa06(0x21e)];}else process[_0x21fa06(0x204)][_0x21fa06(0x20f)]=_0x26bf96[_0x21fa06(0x21e)];const [_0x4ccddf,_0x1fd461]=testhubUtils[_0x21fa06(0x20e)](_0x255e76[_0x21fa06(0x244)]);if(_0x26bf96[_0x21fa06(0x22f)](_0x4ccddf,_0x1fd461)){const _0x27fdf0={};_0x27fdf0[_0x21fa06(0x205)]=_0x4ccddf,_0x27fdf0[_0x21fa06(0x22a)]=_0x1fd461,_0x522a63[testHubConstants[_0x21fa06(0x25f)]]=_0x27fdf0,process[_0x21fa06(0x204)][_0x21fa06(0x23d)]=_0x26bf96['CYOOD'];}else _0x522a63[testHubConstants[_0x21fa06(0x25f)]]={},process[_0x21fa06(0x204)]['BROWSERSTACK_ACCESSIBILITY']=_0x26bf96[_0x21fa06(0x21e)];return testhubUtils[_0x21fa06(0x268)](_0x255e76[_0x21fa06(0x244)]),logger[_0x21fa06(0x1f1)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x21fa06(0x204)]['BROWSERSTACK_TESTHUB_UUID']),_0x522a63;}static async['stop'](_0x5add6d){const _0x355656=a90_0x59cb44,_0x13e2c5={'krSJe':function(_0x2cdac6,_0x4ed47c){return _0x2cdac6===_0x4ed47c;},'qUycj':'false','fvzvA':_0x355656(0x21f),'TwKIo':function(_0x45555b,_0x4fcbdb){return _0x45555b===_0x4fcbdb;},'GECUR':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','BpUGT':_0x355656(0x234),'rTsIN':_0x355656(0x218),'oRoxc':'finished_metadata','nolXv':_0x355656(0x1f0),'GSmfQ':function(_0x312854){return _0x312854();},'uSOnB':function(_0x49a4f9,_0x24628b,_0x37b1f3,_0x5e10c0,_0x5eb8d3,_0x59e5ea){return _0x49a4f9(_0x24628b,_0x37b1f3,_0x5e10c0,_0x5eb8d3,_0x59e5ea);},'lkywE':_0x355656(0x222),'YWxlt':_0x355656(0x246),'HQVOm':_0x355656(0x243)};await this['processTraceZips'](),await PerformanceTester[_0x355656(0x20b)](PerformanceEvents[_0x355656(0x213)],async()=>{const _0x3c2927=_0x355656;if(_0x13e2c5[_0x3c2927(0x256)](process['env'][_0x3c2927(0x1eb)],_0x13e2c5[_0x3c2927(0x25d)])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x3c2927(0x260)](process['env'][testHubConstants[_0x3c2927(0x201)][_0x3c2927(0x1e6)]]))return;TestHubHandler[_0x3c2927(0x208)]=!![],await RequestQueueHandler[_0x3c2927(0x211)]()[_0x3c2927(0x248)](),await SessionHandler[_0x3c2927(0x210)]();if(_0x13e2c5[_0x3c2927(0x256)](process['env'][testHubConstants[_0x3c2927(0x201)][_0x3c2927(0x1e6)]],_0x13e2c5[_0x3c2927(0x1ee)])||_0x13e2c5['TwKIo'](process['env'][testHubConstants[_0x3c2927(0x201)][_0x3c2927(0x1ed)]],_0x13e2c5[_0x3c2927(0x1ee)])){logger[_0x3c2927(0x1ea)](_0x13e2c5[_0x3c2927(0x215)]);const _0x2883ba={};return _0x2883ba[_0x3c2927(0x1e8)]=_0x13e2c5['BpUGT'],_0x2883ba[_0x3c2927(0x1e4)]=_0x13e2c5[_0x3c2927(0x20c)],_0x2883ba;}const _0x19dfb6={'finished_at':new Date()[_0x3c2927(0x251)](),'finished_metadata':[]};!!_0x5add6d&&_0x19dfb6[_0x13e2c5[_0x3c2927(0x1f8)]][_0x3c2927(0x206)]({'reason':_0x13e2c5[_0x3c2927(0x20d)],'signal':_0x5add6d,'failure_data':''});const _0x53125b={'headers':_0x13e2c5[_0x3c2927(0x241)](getDefaultHeaders)};try{const _0xd33149=await _0x13e2c5[_0x3c2927(0x232)](nodeRequest,_0x13e2c5[_0x3c2927(0x20a)],_0x3c2927(0x1fb)+process[_0x3c2927(0x204)][testHubConstants[_0x3c2927(0x201)][_0x3c2927(0x1ed)]]+_0x3c2927(0x1fa),_0x19dfb6,_0x53125b,![]);if(_0xd33149['data']&&_0xd33149[_0x3c2927(0x244)][_0x3c2927(0x234)]){const _0x492fa7={};_0x492fa7[_0x3c2927(0x1e4)]=_0xd33149['data'][_0x3c2927(0x234)];throw _0x492fa7;}else{logger[_0x3c2927(0x1ea)](_0x13e2c5[_0x3c2927(0x21c)]);const _0x4b50a3={};return _0x4b50a3[_0x3c2927(0x1e8)]=_0x13e2c5[_0x3c2927(0x1f4)],_0x4b50a3['message']='',_0x4b50a3;}}catch(_0x3db34d){_0x3db34d[_0x3c2927(0x247)]?logger['debug'](_0x3c2927(0x238)+_0x3db34d['response'][_0x3c2927(0x1e8)]+'\x20'+_0x3db34d[_0x3c2927(0x247)][_0x3c2927(0x1ff)]+'\x20'+JSON[_0x3c2927(0x26c)](_0x3db34d[_0x3c2927(0x247)]['data'])):logger[_0x3c2927(0x1ea)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x3db34d[_0x3c2927(0x1e4)]||_0x3db34d));const _0x1d6214={};return _0x1d6214[_0x3c2927(0x1e8)]=_0x13e2c5['BpUGT'],_0x1d6214[_0x3c2927(0x1e4)]=_0x3db34d[_0x3c2927(0x1e4)]||_0x3db34d[_0x3c2927(0x247)]?_0x3db34d[_0x3c2927(0x247)][_0x3c2927(0x1e8)]+':'+_0x3db34d[_0x3c2927(0x247)][_0x3c2927(0x1ff)]:_0x3db34d,_0x1d6214;}})();}}module[a90_0x59cb44(0x22c)]=TestHubHandler;function a90_0x233e(){const _0x3de16a=['authToken','push','forEach','buildStopSent','./constants.js','lkywE','measureWrapper','rTsIN','nolXv','setAccessibilityVariables','BROWSERSTACK_TEST_OBSERVABILITY','waitForBuildStatus','getInstance','resolve','STOP','RoFRY','GECUR','add','RyjQw','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','config','\x20framework','Percy\x20is\x20not\x20supported\x20for\x20','YWxlt','jwt','xxVZg','null','LmsRq','job_id','PUT','central_scanner','getAccessibilityOptions','All\x20trace\x20zip\x20send\x20events\x20complete','ZkrTg','351628AWamDA','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','POST','buildHashedId','BFhME','exports','../../bin/playwright/reporter/pwUtils.js','PERCY_SUPPORTED_FRAMEWORKS','kmDQq','true','685CJQxJz','uSOnB','../../bin/playwright/reporter/test-details.js','error','8ZXrHgf','SDReA','2817936DBzlqW','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','Error\x20while\x20waiting\x20for\x20events:\x20','accessibility','settings','getCentralUser','BROWSERSTACK_ACCESSIBILITY','getTraceFilePaths','password','mLrgS','GSmfQ','getAccessibilityValueFromYml','success','data','token','stopBuildUpstream\x20event\x20successful!','response','uploadPending','buildDescription','BROWSERSTACK_BUILD_RUN_IDENTIFIER','BROWSERSTACK_RERUN','basename','allowScreenshot','OBSERVABILITY','8920WjtDTL','RASMn','toISOString','getCiInfo','../test-observability/requestQueueHandler.js','extractDataFromResponse','../performance/performance-tester.js','krSJe','../logger','BROWSERSTACK_PRODUCT_MAP','../performance/constants','setTestObservabilityVariables','./utils.js','sDKid','qUycj','getGitMetaData','ACCESSIBILITY','isUndefined','framework','449424AnzsKK','../test-observability/sessionHandler.js','isBrowserstackInfra','TMHkl','../../bin/utils/constants.js','QhOcP','setTestHubCommonMetaInfo','getHostInfo','XhIgF','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','stringify','BROWSERSTACK_CENTRAL_SCANNER_JWT','../test-observability/utils','setupPercy','message','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','BROWSERSTACK_TESTHUB_JWT','815312Dksawb','status','EQZXv','debug','BS_TESTOPS_BUILD_COMPLETED','format','BROWSERSTACK_TESTHUB_UUID','fvzvA','false','user_killed','info','../helper','cwd','HQVOm','834211mRJSut','buildIdentifier','auth','oRoxc','getFrameworkDetails','/stop','api/v1/builds/','getUserName','getConfig','2498511YKmnqB','statusText','trfqT','ENV_VAR','assign','SVLgZ','env'];a90_0x233e=function(){return _0x3de16a;};return a90_0x233e();}
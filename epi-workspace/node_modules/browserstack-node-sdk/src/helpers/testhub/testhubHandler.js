function a129_0x54e7(){const _0x143a5e=['getTraceFilePaths','error','STOP','ZnSaH','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','3433484YGpDTU','QjIWe','All\x20trace\x20zip\x20send\x20events\x20complete','eKAkM','stop','BROWSERSTACK_ACCESSIBILITY','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','stringify','isRunning','status','setupPercy','../../bin/playwright/reporter/pwUtils.js','framework','getConfig','config','includeEncodedExtension','format','sYEQm','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','null','success','INBhf','central_scanner','../test-observability/requestQueueHandler.js','xLpXd','vofZT','BROWSERSTACK_CENTRAL_SCANNER_JOBID','getCentralUser','stopBuildUpstream\x20event\x20successful!','processTraceZips','message','measureWrapper','BROWSERSTACK_RERUN','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','RfslH','util','FpXlO','../../bin/utils/constants.js','isUndefined','kPSXx','PERCY_SUPPORTED_FRAMEWORKS','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','push','exports','42xTotFS','ZdXOS','lcnc','2cNzzQK','TdJIl','rDKIc','finished_metadata','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','BROWSERSTACK_PRODUCT_MAP','password','buildStopSent','isAccessibilityEnabled','setTestObservabilityVariables','OotfZ','PUT','env','response','allowScreenshot','buildHashedId','username','575910wpFVIM','includes','epebO','../test-observability/sessionHandler.js','allSettled','msNdp','setTestHubCommonMetaInfo','getGitMetaData','5751280MMjIas','getProductMapForBuildStartCall','/stop','ENV_VAR','183798XmIsZI','\x20framework','UKkBx','ACCESSIBILITY','EzpOn','GnELj','wkgMw','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','api/v1/builds/','authToken','getHostInfo','BkSJW','XEpfh','getAccessibilityOptions','toISOString','./constants.js','basename','resolve','mhXQt','piGcQ','accessibilityOptions','buildIdentifier','vMybm','cwd','token','5949480fjmuub','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','launchBuild','percy','getAccessKey','332451OUbxPE','ZsBgf','data','getInstance','jwt','16382538YeYvnQ','BROWSERSTACK_TESTHUB_UUID','debug','job_id','add','assign','LnOLR','START','settings','../../bin/playwright/reporter/test-details.js','logBuildError','info','zFuGn','false','BROWSERSTACK_BUILD_RUN_IDENTIFIER','accessibility','../performance/constants','AxVyR','./utils.js','OBSERVABILITY','projectName','Testhub\x20started\x20with\x20id:\x20','getFrameworkDetails','gluBx','checkAndSetupPercy','setAccessibilityVariables','isBrowserstackInfra','user_killed','true','TESTHUB_BUILD_API','BROWSERSTACK_TEST_OBSERVABILITY','getCiInfo','statusText','getTestOrchestrationBuildStartData','fiqRp','BS_TESTOPS_BUILD_COMPLETED','../../bin/v2/browserstackCLI','Percy\x20is\x20not\x20supported\x20for\x20','getUserName'];a129_0x54e7=function(){return _0x143a5e;};return a129_0x54e7();}const a129_0x3d0cd2=a129_0x592b;(function(_0xb9c298,_0x106107){const _0x15621a=a129_0x592b,_0x483c8b=_0xb9c298();while(!![]){try{const _0x23277e=-parseInt(_0x15621a(0x1d4))/0x1+parseInt(_0x15621a(0x1b7))/0x2*(-parseInt(_0x15621a(0x1c8))/0x3)+-parseInt(_0x15621a(0x223))/0x4+parseInt(_0x15621a(0x1d0))/0x5+parseInt(_0x15621a(0x1b4))/0x6*(-parseInt(_0x15621a(0x1f2))/0x7)+-parseInt(_0x15621a(0x1ed))/0x8+parseInt(_0x15621a(0x1f7))/0x9;if(_0x23277e===_0x106107)break;else _0x483c8b['push'](_0x483c8b['shift']());}catch(_0x352596){_0x483c8b['push'](_0x483c8b['shift']());}}}(a129_0x54e7,0xa1327));const bsSetupHelper=require('../helper'),path=require('path'),util=require(a129_0x3d0cd2(0x1ab)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a129_0x3d0cd2(0x209)),testHubConstants=require(a129_0x3d0cd2(0x1e3)),constants=require(a129_0x3d0cd2(0x1ad)),RequestQueueHandler=require(a129_0x3d0cd2(0x19f)),logger=require('../logger')['winstonLogger'],SessionHandler=require(a129_0x3d0cd2(0x1cb)),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a129_0x3d0cd2(0x207)),TestDetails=require(a129_0x3d0cd2(0x200)),{uploadTraceZip}=require(a129_0x3d0cd2(0x193)),{isTurboScaleSession}=require('../helper.js'),BrowserstackCLI=require(a129_0x3d0cd2(0x21b)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x518e2e=>{const _0x3d0328=a129_0x3d0cd2;OngoingEvents[_0x3d0328(0x1fb)](_0x518e2e);},awaitAllEvents=async()=>{const _0x3d9a29=a129_0x3d0cd2;return Promise[_0x3d9a29(0x1cc)](OngoingEvents);};class TestHubHandler{static [a129_0x3d0cd2(0x1be)]=![];static async[a129_0x3d0cd2(0x1ef)](_0x582750,_0x5085c2){const _0x36ff94=a129_0x3d0cd2,_0x2a0eab={'sYEQm':function(_0x2ce56f,_0xc754d2){return _0x2ce56f||_0xc754d2;},'INBhf':function(_0x4ade37,_0x4c98ea){return _0x4ade37===_0x4c98ea;},'xLpXd':function(_0x2f3a45){return _0x2f3a45();},'nWatV':_0x36ff94(0x18e),'mhXQt':_0x36ff94(0x204),'FpXlO':_0x36ff94(0x1bb),'wkgMw':function(_0x170e18,_0x31dba2,_0x34be39,_0xe6960f,_0x14e71e){return _0x170e18(_0x31dba2,_0x34be39,_0xe6960f,_0x14e71e);},'epebO':'POST','XEpfh':function(_0x1e5c30,_0x1b10a6){return _0x1e5c30===_0x1b10a6;},'eKAkM':'accessibility','vofZT':'true'};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x36ff94(0x1fe)],async()=>{const _0x4e5479=_0x36ff94,_0x450798=Object[_0x4e5479(0x1fc)]({},_0x5085c2[_0x4e5479(0x196)],{'root_dir_path':'','framework':_0x5085c2[_0x4e5479(0x194)]}),_0x31f831=bsSetupHelper[_0x4e5479(0x21d)](_0x450798),_0x366e70=bsSetupHelper[_0x4e5479(0x1f1)](_0x450798),_0xd00355=_0x2a0eab[_0x4e5479(0x199)](_0x31f831,'')+':'+_0x2a0eab[_0x4e5479(0x199)](_0x366e70,''),_0x4dd13a=testhubUtils['getProductMap'](_0x450798);process['env'][_0x4e5479(0x1bc)]=JSON[_0x4e5479(0x18f)](_0x4dd13a);if(_0x2a0eab[_0x4e5479(0x19d)](_0xd00355,':'))return _0x2a0eab[_0x4e5479(0x1a0)](isTestObservabilitySession)&&(logger[_0x4e5479(0x1f9)](_0x2a0eab['nWatV']),process[_0x4e5479(0x1c3)][_0x4e5479(0x21a)]=_0x2a0eab[_0x4e5479(0x1e6)]),testhubUtils['isAccessibilityEnabled'](_0x450798)&&logger['debug'](_0x2a0eab[_0x4e5479(0x1ac)]),[null,null];try{const _0x5d9e5d=await this['generateBuildUpstreamData'](_0x450798,_0x582750),_0x3626f0=this['getConfig'](_0x31f831,_0x366e70),_0x47e6a2=await _0x2a0eab[_0x4e5479(0x1da)](nodeRequest,_0x2a0eab[_0x4e5479(0x1ca)],testHubConstants[_0x4e5479(0x214)],_0x5d9e5d,_0x3626f0),_0x787c49=this['extractDataFromResponse'](_0x450798,_0x47e6a2,_0x3626f0);await this[_0x4e5479(0x20f)](_0x5085c2,_0x582750);if(_0x2a0eab[_0x4e5479(0x1e0)](testhubUtils['getAccessibilityValueFromYml'](_0x5085c2[_0x4e5479(0x196)]),null)){const _0x3c7106=_0x787c49[_0x2a0eab[_0x4e5479(0x226)]];_0x3c7106&&_0x3c7106[_0x4e5479(0x1dd)]&&_0x3c7106[_0x4e5479(0x1c6)]&&(_0x5085c2[_0x4e5479(0x196)][_0x4e5479(0x206)]=!![],process['env'][_0x4e5479(0x1ee)]=_0x2a0eab[_0x4e5479(0x1a1)]);}return _0x787c49;}catch(_0x315231){if(_0x2a0eab[_0x4e5479(0x19d)](_0x315231[_0x4e5479(0x19c)],![])){testhubUtils[_0x4e5479(0x201)](_0x315231);return;}}})();}static async[a129_0x3d0cd2(0x1a5)](){const _0x393a82=a129_0x3d0cd2,_0x36163b={'piGcQ':function(_0x2c29b0,_0x5cf2e8,_0x3a4baf){return _0x2c29b0(_0x5cf2e8,_0x3a4baf);},'gluBx':function(_0x2908d3,_0x570ff8){return _0x2908d3(_0x570ff8);},'zFuGn':function(_0x1deeea){return _0x1deeea();},'EzpOn':_0x393a82(0x225)};if(processedTraceZips)return;const _0x142e7b=TestDetails[_0x393a82(0x21e)]();_0x142e7b['forEach'](({testUId:_0x2485d0,filePath:_0x55e8b4})=>{const _0x194eb0=_0x393a82;var _0x411ca8=_0x36163b[_0x194eb0(0x1e7)](uploadTraceZip,_0x55e8b4,_0x2485d0);_0x36163b[_0x194eb0(0x20e)](addEvent,_0x411ca8);});try{await _0x36163b[_0x393a82(0x203)](awaitAllEvents),logger[_0x393a82(0x1f9)](_0x36163b[_0x393a82(0x1d8)]),processedTraceZips=!![];}catch(_0xacceba){logger[_0x393a82(0x21f)]('Error\x20while\x20waiting\x20for\x20events:\x20'+util[_0x393a82(0x198)](_0xacceba));}}static async[a129_0x3d0cd2(0x20f)](_0x4bda69,_0x44cc2f){const _0x50125b=a129_0x3d0cd2;if(constants[_0x50125b(0x1b0)][_0x50125b(0x1c9)](_0x44cc2f)){await _0x4bda69[_0x50125b(0x192)]();return;}_0x4bda69['config'][_0x50125b(0x1f0)]&&logger[_0x50125b(0x1f9)](_0x50125b(0x21c)+_0x44cc2f+_0x50125b(0x1d5));}static[a129_0x3d0cd2(0x1e1)](_0x46acdc){const _0x49b742=a129_0x3d0cd2,_0x506367={'AxVyR':function(_0xfadd80,_0xa0eab5){return _0xfadd80(_0xa0eab5);},'LnOLR':_0x49b742(0x213)};let _0x109f6a;if(_0x46acdc[_0x49b742(0x1e8)]){const _0x16ecc0={};_0x16ecc0[_0x49b742(0x1ff)]=_0x46acdc['accessibilityOptions'],_0x109f6a=_0x16ecc0;}else{const _0x1448a3={};_0x1448a3[_0x49b742(0x1ff)]={},_0x109f6a=_0x1448a3;}if((!bsSetupHelper[_0x49b742(0x211)]()||_0x506367[_0x49b742(0x208)](isTurboScaleSession,_0x46acdc))&&testhubUtils[_0x49b742(0x1bf)](_0x46acdc)){const _0x4315d4={};_0x4315d4[_0x49b742(0x197)]=_0x506367[_0x49b742(0x1fd)],Object[_0x49b742(0x1fc)](_0x109f6a[_0x49b742(0x1ff)],_0x4315d4);}return _0x109f6a;}static[a129_0x3d0cd2(0x195)](_0x30072b,_0x5a3c05){const _0x2d5591=a129_0x3d0cd2,_0x372e35={'BkSJW':function(_0x335235,_0x2b917e){return _0x335235(_0x2b917e);}},_0x515d23={};return _0x515d23[_0x2d5591(0x1c7)]=_0x30072b,_0x515d23[_0x2d5591(0x1bd)]=_0x5a3c05,{'auth':_0x515d23,'headers':_0x372e35[_0x2d5591(0x1df)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x193233,_0x4a443e){const _0x50055f=a129_0x3d0cd2,_0x30b24b={'VDoba':_0x50055f(0x19a),'vMybm':function(_0x5368a9,_0x1fb8ae){return _0x5368a9(_0x1fb8ae);}};logger[_0x50055f(0x1f9)](_0x30b24b['VDoba']);const _0xb40c5f={'project_name':_0x193233[_0x50055f(0x20b)]||'','name':_0x193233['buildName']||path[_0x50055f(0x1e4)](path[_0x50055f(0x1e5)](process[_0x50055f(0x1eb)]())),'build_identifier':_0x193233[_0x50055f(0x1e9)],'description':_0x193233['buildDescription']||'','started_at':new Date()[_0x50055f(0x1e2)](),'tags':_0x30b24b[_0x50055f(0x1ea)](getCustomTags,_0x193233),'host_info':bsSetupHelper[_0x50055f(0x1de)](),'ci_info':bsSetupHelper[_0x50055f(0x216)](),'build_run_identifier':process['env'][_0x50055f(0x205)],'failed_tests_rerun':process[_0x50055f(0x1c3)][_0x50055f(0x1a8)]||![],'linked_build_uuid':process[_0x50055f(0x1c3)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper[_0x50055f(0x1cf)](),'accessibility':this[_0x50055f(0x1e1)](_0x193233),'framework_details':testhubUtils[_0x50055f(0x20d)](_0x193233,_0x4a443e),'product_map':testhubUtils[_0x50055f(0x1d1)](_0x193233),'browserstackAutomation':bsSetupHelper[_0x50055f(0x211)](),'grouping_identifier':process[_0x50055f(0x1c3)][_0x50055f(0x1db)],'test_orchestration':testhubUtils[_0x50055f(0x218)](_0x193233)};if(bsSetupHelper[_0x50055f(0x1a3)]()['central_scanner']||bsSetupHelper[_0x50055f(0x1a3)]()[_0x50055f(0x1b6)]){const _0x4e7408={};_0x4e7408[_0x50055f(0x1fa)]=process['env'][_0x50055f(0x1a2)],_0x4e7408[_0x50055f(0x1ec)]=process['env']['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0xb40c5f[_0x50055f(0x19e)]=_0x4e7408;}return _0xb40c5f;}static['extractDataFromResponse'](_0x3ee932,_0x3701ae,_0x4d9b08){const _0x570fc4=a129_0x3d0cd2,_0x477a08={'UqHDY':function(_0x594bf1){return _0x594bf1();},'ZnSaH':function(_0x1c540a,_0x4daf78){return _0x1c540a&&_0x4daf78;},'NqlSt':_0x570fc4(0x213),'UKkBx':'false','jajah':function(_0xfd910d,_0x2414d2){return _0xfd910d&&_0x2414d2;}},_0x450d66={};if(_0x477a08['UqHDY'](isTestObservabilitySession)){const [_0x8285ef,_0x5cda2c,_0x3ed245]=testhubUtils[_0x570fc4(0x1c0)](_0x3701ae[_0x570fc4(0x1f4)],_0x4d9b08['auth']);if(_0x477a08[_0x570fc4(0x221)](_0x8285ef,_0x5cda2c)){const _0x14c607={};_0x14c607[_0x570fc4(0x1f6)]=_0x8285ef,_0x14c607[_0x570fc4(0x1c6)]=_0x5cda2c,_0x14c607[_0x570fc4(0x1c5)]=_0x3ed245,_0x450d66[testHubConstants['OBSERVABILITY']]=_0x14c607,process[_0x570fc4(0x1c3)][_0x570fc4(0x215)]=_0x477a08['NqlSt'];}else _0x450d66[testHubConstants[_0x570fc4(0x20a)]]={},process[_0x570fc4(0x1c3)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x477a08[_0x570fc4(0x1d6)];}else process[_0x570fc4(0x1c3)][_0x570fc4(0x215)]=_0x477a08['UKkBx'];const [_0x39fea2,_0x739c1d]=testhubUtils[_0x570fc4(0x210)](_0x3701ae['data']);if(_0x477a08['jajah'](_0x39fea2,_0x739c1d)){const _0x32eab9={};_0x32eab9[_0x570fc4(0x1dd)]=_0x39fea2,_0x32eab9['buildHashedId']=_0x739c1d,_0x450d66[testHubConstants[_0x570fc4(0x1d7)]]=_0x32eab9,process[_0x570fc4(0x1c3)][_0x570fc4(0x228)]=_0x477a08['NqlSt'];}else _0x450d66[testHubConstants['ACCESSIBILITY']]={},process[_0x570fc4(0x1c3)][_0x570fc4(0x228)]=_0x477a08[_0x570fc4(0x1d6)];return testhubUtils[_0x570fc4(0x1ce)](_0x3701ae[_0x570fc4(0x1f4)]),logger[_0x570fc4(0x202)](_0x570fc4(0x20c)+process[_0x570fc4(0x1c3)][_0x570fc4(0x1f8)]),_0x450d66;}static async[a129_0x3d0cd2(0x227)](_0x1bb4ab){const _0x597e14=a129_0x3d0cd2,_0x39c893={'fiqRp':function(_0x1e6f53,_0x3f3369){return _0x1e6f53===_0x3f3369;},'QjIWe':_0x597e14(0x204),'rDKIc':_0x597e14(0x19b),'TdJIl':_0x597e14(0x1a9),'RfslH':_0x597e14(0x21f),'oPMpj':_0x597e14(0x1b1),'kPSXx':_0x597e14(0x1ba),'ZdXOS':_0x597e14(0x212),'UOJAf':function(_0x3d8c87){return _0x3d8c87();},'GnELj':function(_0x1f5e87,_0x37819f,_0x10a308,_0x1ccee2,_0x22ebc4,_0x3ab42a){return _0x1f5e87(_0x37819f,_0x10a308,_0x1ccee2,_0x22ebc4,_0x3ab42a);},'ZsBgf':_0x597e14(0x1c2),'OotfZ':_0x597e14(0x1a4),'msNdp':_0x597e14(0x19c)};await PerformanceTester[_0x597e14(0x1a7)](PerformanceEvents[_0x597e14(0x220)],async()=>{const _0x442997=_0x597e14;if(_0x39c893[_0x442997(0x219)](process[_0x442997(0x1c3)][_0x442997(0x21a)],_0x39c893[_0x442997(0x224)])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x442997(0x1ae)](process['env'][testHubConstants[_0x442997(0x1d3)]['BROWSERSTACK_TESTHUB_JWT']]))return;TestHubHandler[_0x442997(0x1be)]=!![];if(BrowserstackCLI[_0x442997(0x1f5)]()[_0x442997(0x190)]())return;await this[_0x442997(0x1a5)](),await RequestQueueHandler[_0x442997(0x1f5)]()['uploadPending'](),await SessionHandler['waitForBuildStatus']();if(_0x39c893[_0x442997(0x219)](process[_0x442997(0x1c3)][testHubConstants[_0x442997(0x1d3)]['BROWSERSTACK_TESTHUB_JWT']],_0x39c893[_0x442997(0x1b9)])||_0x39c893[_0x442997(0x219)](process['env'][testHubConstants[_0x442997(0x1d3)]['BROWSERSTACK_TESTHUB_UUID']],_0x39c893[_0x442997(0x1b9)])){logger['debug'](_0x39c893[_0x442997(0x1b8)]);const _0x37e7ea={};return _0x37e7ea[_0x442997(0x191)]=_0x39c893[_0x442997(0x1aa)],_0x37e7ea['message']=_0x39c893['oPMpj'],_0x37e7ea;}const _0x2bcee9={'finished_at':new Date()[_0x442997(0x1e2)](),'finished_metadata':[]};!!_0x1bb4ab&&_0x2bcee9[_0x39c893[_0x442997(0x1af)]][_0x442997(0x1b2)]({'reason':_0x39c893[_0x442997(0x1b5)],'signal':_0x1bb4ab,'failure_data':''});const _0x552046={'headers':_0x39c893['UOJAf'](getDefaultHeaders)};try{const _0x2b233f=await _0x39c893[_0x442997(0x1d9)](nodeRequest,_0x39c893[_0x442997(0x1f3)],_0x442997(0x1dc)+process[_0x442997(0x1c3)][testHubConstants[_0x442997(0x1d3)][_0x442997(0x1f8)]]+_0x442997(0x1d2),_0x2bcee9,_0x552046,![]);if(_0x2b233f[_0x442997(0x1f4)]&&_0x2b233f['data']['error']){const _0x326d10={};_0x326d10[_0x442997(0x1a6)]=_0x2b233f[_0x442997(0x1f4)][_0x442997(0x21f)];throw _0x326d10;}else{logger['debug'](_0x39c893[_0x442997(0x1c1)]);const _0x23bda4={};return _0x23bda4['status']=_0x39c893[_0x442997(0x1cd)],_0x23bda4[_0x442997(0x1a6)]='',_0x23bda4;}}catch(_0x281e42){_0x281e42[_0x442997(0x1c4)]?logger[_0x442997(0x1f9)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x281e42['response'][_0x442997(0x191)]+'\x20'+_0x281e42[_0x442997(0x1c4)][_0x442997(0x217)]+'\x20'+JSON[_0x442997(0x18f)](_0x281e42[_0x442997(0x1c4)][_0x442997(0x1f4)])):logger[_0x442997(0x1f9)](_0x442997(0x222)+(_0x281e42[_0x442997(0x1a6)]||_0x281e42));const _0x64e575={};return _0x64e575[_0x442997(0x191)]=_0x39c893[_0x442997(0x1aa)],_0x64e575['message']=_0x281e42['message']||_0x281e42[_0x442997(0x1c4)]?_0x281e42[_0x442997(0x1c4)][_0x442997(0x191)]+':'+_0x281e42[_0x442997(0x1c4)][_0x442997(0x217)]:_0x281e42,_0x64e575;}})();}}function a129_0x592b(_0x3a143c,_0x4a0dad){const _0x54e796=a129_0x54e7();return a129_0x592b=function(_0x592ba1,_0x18f555){_0x592ba1=_0x592ba1-0x18e;let _0x2a2966=_0x54e796[_0x592ba1];return _0x2a2966;},a129_0x592b(_0x3a143c,_0x4a0dad);}module[a129_0x3d0cd2(0x1b3)]=TestHubHandler;
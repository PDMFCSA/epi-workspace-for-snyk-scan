const a129_0x319e27=a129_0x5ab4;(function(_0x2eb356,_0x39b35b){const _0xdf064f=a129_0x5ab4,_0x1ccb3a=_0x2eb356();while(!![]){try{const _0x72fedd=-parseInt(_0xdf064f(0x158))/0x1+-parseInt(_0xdf064f(0x1ad))/0x2+parseInt(_0xdf064f(0x170))/0x3+-parseInt(_0xdf064f(0x177))/0x4*(-parseInt(_0xdf064f(0x192))/0x5)+parseInt(_0xdf064f(0x157))/0x6*(-parseInt(_0xdf064f(0x17f))/0x7)+-parseInt(_0xdf064f(0x199))/0x8+parseInt(_0xdf064f(0x1a2))/0x9;if(_0x72fedd===_0x39b35b)break;else _0x1ccb3a['push'](_0x1ccb3a['shift']());}catch(_0x103e7a){_0x1ccb3a['push'](_0x1ccb3a['shift']());}}}(a129_0x1b79,0xc0fe6));const bsSetupHelper=require(a129_0x319e27(0x184)),path=require(a129_0x319e27(0x182)),util=require(a129_0x319e27(0x169)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a129_0x319e27(0x1a5)),testhubUtils=require(a129_0x319e27(0x175)),testHubConstants=require('./constants.js'),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a129_0x319e27(0x161)),logger=require(a129_0x319e27(0x19a))[a129_0x319e27(0x19b)],SessionHandler=require(a129_0x319e27(0x1cf)),PerformanceTester=require(a129_0x319e27(0x178)),{TESTHUB_EVENTS:PerformanceEvents}=require(a129_0x319e27(0x18e)),TestDetails=require(a129_0x319e27(0x172)),{uploadTraceZip}=require(a129_0x319e27(0x1ac)),{isTurboScaleSession}=require('../helper.js'),BrowserstackCLI=require('../../bin/v2/browserstackCLI'),OngoingEvents=new Set();let processedTraceZips=![];function a129_0x5ab4(_0x4aa5e2,_0x28ec38){const _0x1b7930=a129_0x1b79();return a129_0x5ab4=function(_0x5ab429,_0x177b3b){_0x5ab429=_0x5ab429-0x148;let _0x383bb3=_0x1b7930[_0x5ab429];return _0x383bb3;},a129_0x5ab4(_0x4aa5e2,_0x28ec38);}const addEvent=_0x199301=>{const _0x10d46c=a129_0x319e27;OngoingEvents[_0x10d46c(0x180)](_0x199301);},awaitAllEvents=async()=>{const _0x402d63=a129_0x319e27;return Promise[_0x402d63(0x1db)](OngoingEvents);};function a129_0x1b79(){const _0x2e76bc=['/stop','FRzHQ','POST','getHostInfo','generateBuildUpstreamData','buildStopSent','TJsor','jzOoi','auth','vPRPf','GUJSv','getUserName','central_scanner','PUT','getAccessibilityValueFromYml','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','api/v1/builds/','getAccessibilityOptions','error','getGitMetaData','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','basename','accessibilityOptions','username','getInstance','processTraceZips','BROWSERSTACK_LINKED_BUILD_UUID','setTestHubCommonMetaInfo','../test-observability/sessionHandler.js','buildDescription','sytWj','wwBgw','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','finished_metadata','BROWSERSTACK_CENTRAL_SCANNER_JWT','framework','measureWrapper','BROWSERSTACK_TEST_OBSERVABILITY','LNLbf','BROWSERSTACK_TESTHUB_UUID','allSettled','format','checkAndSetupPercy','jcjnZ','buildIdentifier','stop','getCiInfo','aQneC','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','true','stopBuildUpstream\x20event\x20successful!','debug','env','extractDataFromResponse','FGURU','assign','vjrSW','jwt','2826usvMAZ','951443ziMeHX','BROWSERSTACK_CENTRAL_SCANNER_JOBID','allowScreenshot','buildHashedId','user_killed','tcisj','BROWSERSTACK_ACCESSIBILITY','TjhjT','includes','../test-observability/requestQueueHandler.js','elehN','toISOString','LcrOd','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','setAccessibilityVariables','getProductMap','START','util','getAccessKey','lcnc','buildName','Error\x20while\x20waiting\x20for\x20events:\x20','exports','ViJEz','3105948UXMZBO','includeEncodedExtension','../../bin/playwright/reporter/test-details.js','OBSERVABILITY','info','./utils.js','null','4jroXJD','../performance/performance-tester.js','getTestOrchestrationBuildStartData','message','ACCESSIBILITY','nnPbu','rXiZq','status','12341VEtaLA','add','projectName','path','launchBuild','../helper','job_id','setupPercy','stringify','push','EounZ','GHiMt','isBrowserstackInfra','logBuildError','isUndefined','../performance/constants','xmKlI','settings','success','3451745slNJyQ','BROWSERSTACK_PRODUCT_MAP','response','forEach','stkHf','token','BS_TESTOPS_BUILD_COMPLETED','4745592evrcKo','../logger','winstonLogger','BROWSERSTACK_TESTHUB_JWT','data','ENV_VAR','statusText','TESTHUB_BUILD_API','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','16989444TmBnrM','waitForBuildStatus','accessibility','../test-observability/utils','config','false','Testhub\x20started\x20with\x20id:\x20','resolve','RGJrg','getConfig','../../bin/playwright/reporter/pwUtils.js','895728hIIKnK','CDVAq','getTraceFilePaths','KSDCx','IBqtW','percy'];a129_0x1b79=function(){return _0x2e76bc;};return a129_0x1b79();}class TestHubHandler{static [a129_0x319e27(0x1b8)]=![];static async[a129_0x319e27(0x183)](_0x8dfe5d,_0x17c1be){const _0x2a36ee=a129_0x319e27,_0x3d6128={'TJsor':function(_0x57d294,_0x4e1a2c){return _0x57d294||_0x4e1a2c;},'TjhjT':function(_0x2bc662,_0x57bdf7){return _0x2bc662||_0x57bdf7;},'LcrOd':function(_0x48ffce,_0x2abde4){return _0x48ffce===_0x2abde4;},'ViJEz':function(_0x5d6fc4){return _0x5d6fc4();},'GUJSv':_0x2a36ee(0x1a1),'RGJrg':_0x2a36ee(0x1a7),'sytWj':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','wwBgw':function(_0x174b87,_0x325c9a,_0x457490,_0x310348,_0x392bff){return _0x174b87(_0x325c9a,_0x457490,_0x310348,_0x392bff);},'ogSoZ':_0x2a36ee(0x1b5),'jcjnZ':function(_0x51a7c2,_0x386235){return _0x51a7c2===_0x386235;},'IaDAP':_0x2a36ee(0x1a4),'pvGuu':_0x2a36ee(0x14e)};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x2a36ee(0x168)],async()=>{const _0x46d698=_0x2a36ee,_0x25ee64=Object[_0x46d698(0x154)]({},_0x17c1be[_0x46d698(0x1a6)],{'root_dir_path':'','framework':_0x17c1be[_0x46d698(0x1d6)]}),_0xb70b45=bsSetupHelper[_0x46d698(0x1be)](_0x25ee64),_0x4800a7=bsSetupHelper[_0x46d698(0x16a)](_0x25ee64),_0x5096f0=_0x3d6128[_0x46d698(0x1b9)](_0xb70b45,'')+':'+_0x3d6128[_0x46d698(0x15f)](_0x4800a7,''),_0x167943=testhubUtils[_0x46d698(0x167)](_0x25ee64);process[_0x46d698(0x151)][_0x46d698(0x193)]=JSON[_0x46d698(0x187)](_0x167943);if(_0x3d6128['LcrOd'](_0x5096f0,':'))return _0x3d6128[_0x46d698(0x16f)](isTestObservabilitySession)&&(logger[_0x46d698(0x150)](_0x3d6128[_0x46d698(0x1bd)]),process[_0x46d698(0x151)][_0x46d698(0x198)]=_0x3d6128[_0x46d698(0x1aa)]),testhubUtils['isAccessibilityEnabled'](_0x25ee64)&&logger[_0x46d698(0x150)](_0x3d6128[_0x46d698(0x1d1)]),[null,null];try{const _0x2d25aa=await this[_0x46d698(0x1b7)](_0x25ee64,_0x8dfe5d),_0x230c0d=this[_0x46d698(0x1ab)](_0xb70b45,_0x4800a7),_0x1f32ec=await _0x3d6128[_0x46d698(0x1d2)](nodeRequest,_0x3d6128['ogSoZ'],testHubConstants[_0x46d698(0x1a0)],_0x2d25aa,_0x230c0d),_0x1e1843=this['extractDataFromResponse'](_0x25ee64,_0x1f32ec,_0x230c0d);await this['checkAndSetupPercy'](_0x17c1be,_0x8dfe5d);if(_0x3d6128[_0x46d698(0x148)](testhubUtils[_0x46d698(0x1c1)](_0x17c1be[_0x46d698(0x1a6)]),null)){const _0x45b88d=_0x1e1843[_0x3d6128['IaDAP']];_0x45b88d&&_0x45b88d['authToken']&&_0x45b88d[_0x46d698(0x15b)]&&(_0x17c1be[_0x46d698(0x1a6)][_0x46d698(0x1a4)]=!![],process['env'][_0x46d698(0x1d3)]=_0x3d6128['pvGuu']);}return _0x1e1843;}catch(_0x2d4507){if(_0x3d6128[_0x46d698(0x164)](_0x2d4507[_0x46d698(0x191)],![])){testhubUtils[_0x46d698(0x18c)](_0x2d4507);return;}}})();}static async[a129_0x319e27(0x1cc)](){const _0x3bdfe8=a129_0x319e27,_0xd745de={'rhdCv':function(_0x4b5935,_0x5be8d3,_0x4f3766){return _0x4b5935(_0x5be8d3,_0x4f3766);},'unuNA':function(_0x4cdd2d,_0x1c3fb3){return _0x4cdd2d(_0x1c3fb3);},'CpMaD':function(_0x55cc83){return _0x55cc83();},'NpWqU':'All\x20trace\x20zip\x20send\x20events\x20complete'};if(processedTraceZips)return;const _0x330444=TestDetails[_0x3bdfe8(0x1af)]();_0x330444[_0x3bdfe8(0x195)](({testUId:_0x3fe33b,filePath:_0x117dfe})=>{var _0xd22e94=_0xd745de['rhdCv'](uploadTraceZip,_0x117dfe,_0x3fe33b);_0xd745de['unuNA'](addEvent,_0xd22e94);});try{await _0xd745de['CpMaD'](awaitAllEvents),logger[_0x3bdfe8(0x150)](_0xd745de['NpWqU']),processedTraceZips=!![];}catch(_0x112db1){logger[_0x3bdfe8(0x1c5)](_0x3bdfe8(0x16d)+util[_0x3bdfe8(0x1dc)](_0x112db1));}}static async[a129_0x319e27(0x1dd)](_0x964d85,_0x25d8c7){const _0x3bac05=a129_0x319e27;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x3bac05(0x160)](_0x25d8c7)){await _0x964d85[_0x3bac05(0x186)]();return;}_0x964d85[_0x3bac05(0x1a6)][_0x3bac05(0x1b2)]&&logger['debug']('Percy\x20is\x20not\x20supported\x20for\x20'+_0x25d8c7+'\x20framework');}static[a129_0x319e27(0x1c4)](_0x1814ba){const _0x2aa7bb=a129_0x319e27,_0x5e57b1={'vPRPf':function(_0x2dcbf7,_0x4b7f00){return _0x2dcbf7(_0x4b7f00);},'IBqtW':_0x2aa7bb(0x14e)};let _0x4dd153;if(_0x1814ba[_0x2aa7bb(0x1c9)]){const _0x4807ba={};_0x4807ba['settings']=_0x1814ba['accessibilityOptions'],_0x4dd153=_0x4807ba;}else{const _0xfc6050={};_0xfc6050[_0x2aa7bb(0x190)]={},_0x4dd153=_0xfc6050;}if((!bsSetupHelper[_0x2aa7bb(0x18b)]()||_0x5e57b1[_0x2aa7bb(0x1bc)](isTurboScaleSession,_0x1814ba))&&testhubUtils['isAccessibilityEnabled'](_0x1814ba)){const _0x14a1d2={};_0x14a1d2[_0x2aa7bb(0x171)]=_0x5e57b1[_0x2aa7bb(0x1b1)],Object[_0x2aa7bb(0x154)](_0x4dd153['settings'],_0x14a1d2);}return _0x4dd153;}static[a129_0x319e27(0x1ab)](_0x555830,_0x5a3c35){const _0xda3ae7=a129_0x319e27,_0x7ead4c={'FGURU':function(_0x7664ae,_0xe2e6d9){return _0x7664ae(_0xe2e6d9);}},_0x148397={};return _0x148397[_0xda3ae7(0x1ca)]=_0x555830,_0x148397['password']=_0x5a3c35,{'auth':_0x148397,'headers':_0x7ead4c[_0xda3ae7(0x153)](getDefaultHeaders,![])};}static async['generateBuildUpstreamData'](_0x55a7b6,_0x4ddfc2){const _0x5716d0=a129_0x319e27,_0x4f3add={'FRzHQ':_0x5716d0(0x1c2),'QTKUP':function(_0x869437,_0x327dbc){return _0x869437(_0x327dbc);}};logger['debug'](_0x4f3add[_0x5716d0(0x1b4)]);const _0x5be68d={'project_name':_0x55a7b6[_0x5716d0(0x181)]||'','name':_0x55a7b6[_0x5716d0(0x16c)]||path[_0x5716d0(0x1c8)](path[_0x5716d0(0x1a9)](process['cwd']())),'build_identifier':_0x55a7b6[_0x5716d0(0x149)],'description':_0x55a7b6[_0x5716d0(0x1d0)]||'','started_at':new Date()['toISOString'](),'tags':_0x4f3add['QTKUP'](getCustomTags,_0x55a7b6),'host_info':bsSetupHelper[_0x5716d0(0x1b6)](),'ci_info':bsSetupHelper[_0x5716d0(0x14b)](),'build_run_identifier':process[_0x5716d0(0x151)]['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process[_0x5716d0(0x151)]['BROWSERSTACK_RERUN']||![],'linked_build_uuid':process[_0x5716d0(0x151)][_0x5716d0(0x1cd)]||'','version_control':await bsSetupHelper[_0x5716d0(0x1c6)](),'accessibility':this[_0x5716d0(0x1c4)](_0x55a7b6),'framework_details':testhubUtils['getFrameworkDetails'](_0x55a7b6,_0x4ddfc2),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x55a7b6),'browserstackAutomation':bsSetupHelper[_0x5716d0(0x18b)](),'grouping_identifier':process[_0x5716d0(0x151)]['BROWSERSTACK_BUILD_GROUPING_IDENTIFIER'],'test_orchestration':testhubUtils[_0x5716d0(0x179)](_0x55a7b6)};if(bsSetupHelper['getCentralUser']()[_0x5716d0(0x1bf)]||bsSetupHelper['getCentralUser']()[_0x5716d0(0x16b)]){const _0x1dad78={};_0x1dad78[_0x5716d0(0x185)]=process['env'][_0x5716d0(0x159)],_0x1dad78[_0x5716d0(0x197)]=process[_0x5716d0(0x151)][_0x5716d0(0x1d5)],_0x5be68d[_0x5716d0(0x1bf)]=_0x1dad78;}return _0x5be68d;}static[a129_0x319e27(0x152)](_0x4dabc8,_0xbf26f9,_0x5b94f0){const _0x4d50c3=a129_0x319e27,_0x2d41a3={'elehN':function(_0xd5c385){return _0xd5c385();},'tcisj':function(_0x54122a,_0x49013d){return _0x54122a&&_0x49013d;},'EounZ':_0x4d50c3(0x14e),'aQneC':_0x4d50c3(0x1a7)},_0x4a2952={};if(_0x2d41a3[_0x4d50c3(0x162)](isTestObservabilitySession)){const [_0x47958e,_0x487e83,_0x5f3da7]=testhubUtils['setTestObservabilityVariables'](_0xbf26f9[_0x4d50c3(0x19d)],_0x5b94f0[_0x4d50c3(0x1bb)]);if(_0x2d41a3[_0x4d50c3(0x15d)](_0x47958e,_0x487e83)){const _0x5b83cc={};_0x5b83cc[_0x4d50c3(0x156)]=_0x47958e,_0x5b83cc[_0x4d50c3(0x15b)]=_0x487e83,_0x5b83cc[_0x4d50c3(0x15a)]=_0x5f3da7,_0x4a2952[testHubConstants[_0x4d50c3(0x173)]]=_0x5b83cc,process['env'][_0x4d50c3(0x1d8)]=_0x2d41a3[_0x4d50c3(0x189)];}else _0x4a2952[testHubConstants[_0x4d50c3(0x173)]]={},process[_0x4d50c3(0x151)][_0x4d50c3(0x1d8)]=_0x2d41a3['aQneC'];}else process[_0x4d50c3(0x151)][_0x4d50c3(0x1d8)]=_0x2d41a3[_0x4d50c3(0x14c)];const [_0x2b3225,_0x14ef36]=testhubUtils[_0x4d50c3(0x166)](_0xbf26f9[_0x4d50c3(0x19d)]);if(_0x2d41a3[_0x4d50c3(0x15d)](_0x2b3225,_0x14ef36)){const _0xf69d2e={};_0xf69d2e['authToken']=_0x2b3225,_0xf69d2e[_0x4d50c3(0x15b)]=_0x14ef36,_0x4a2952[testHubConstants[_0x4d50c3(0x17b)]]=_0xf69d2e,process[_0x4d50c3(0x151)][_0x4d50c3(0x15e)]=_0x2d41a3[_0x4d50c3(0x189)];}else _0x4a2952[testHubConstants[_0x4d50c3(0x17b)]]={},process[_0x4d50c3(0x151)][_0x4d50c3(0x15e)]=_0x2d41a3['aQneC'];return testhubUtils[_0x4d50c3(0x1ce)](_0xbf26f9['data']),logger[_0x4d50c3(0x174)](_0x4d50c3(0x1a8)+process['env'][_0x4d50c3(0x1da)]),_0x4a2952;}static async[a129_0x319e27(0x14a)](_0x5c6cd9){const _0x2131e3=a129_0x319e27,_0x49aebe={'KSDCx':function(_0x435dfa,_0x161d83){return _0x435dfa===_0x161d83;},'nnPbu':_0x2131e3(0x1a7),'stkHf':_0x2131e3(0x176),'xmKlI':_0x2131e3(0x1c7),'rXiZq':'error','VsYfY':_0x2131e3(0x165),'CDVAq':_0x2131e3(0x1d4),'GHiMt':_0x2131e3(0x15c),'LNLbf':function(_0x3963ac){return _0x3963ac();},'vjrSW':function(_0x35f7c8,_0xb3b9ca,_0x4a9d33,_0x423d8b,_0x2242ca,_0x57a42e){return _0x35f7c8(_0xb3b9ca,_0x4a9d33,_0x423d8b,_0x2242ca,_0x57a42e);},'jzOoi':_0x2131e3(0x1c0),'mupZS':_0x2131e3(0x14f),'QnBYB':_0x2131e3(0x191)};await PerformanceTester[_0x2131e3(0x1d7)](PerformanceEvents['STOP'],async()=>{const _0x134ff9=_0x2131e3;if(_0x49aebe[_0x134ff9(0x1b0)](process['env'][_0x134ff9(0x198)],_0x49aebe[_0x134ff9(0x17c)])||TestHubHandler[_0x134ff9(0x1b8)]||bsSetupHelper[_0x134ff9(0x18d)](process[_0x134ff9(0x151)][testHubConstants[_0x134ff9(0x19e)][_0x134ff9(0x19c)]]))return;TestHubHandler[_0x134ff9(0x1b8)]=!![];if(BrowserstackCLI[_0x134ff9(0x1cb)]()['isRunning']())return;await this[_0x134ff9(0x1cc)](),await RequestQueueHandler[_0x134ff9(0x1cb)]()['uploadPending'](),await SessionHandler[_0x134ff9(0x1a3)]();if(_0x49aebe[_0x134ff9(0x1b0)](process['env'][testHubConstants[_0x134ff9(0x19e)][_0x134ff9(0x19c)]],_0x49aebe[_0x134ff9(0x196)])||_0x49aebe[_0x134ff9(0x1b0)](process['env'][testHubConstants[_0x134ff9(0x19e)][_0x134ff9(0x1da)]],_0x49aebe[_0x134ff9(0x196)])){logger[_0x134ff9(0x150)](_0x49aebe[_0x134ff9(0x18f)]);const _0x599cd0={};return _0x599cd0[_0x134ff9(0x17e)]=_0x49aebe[_0x134ff9(0x17d)],_0x599cd0[_0x134ff9(0x17a)]=_0x49aebe['VsYfY'],_0x599cd0;}const _0x31ff37={'finished_at':new Date()[_0x134ff9(0x163)](),'finished_metadata':[]};!!_0x5c6cd9&&_0x31ff37[_0x49aebe[_0x134ff9(0x1ae)]][_0x134ff9(0x188)]({'reason':_0x49aebe[_0x134ff9(0x18a)],'signal':_0x5c6cd9,'failure_data':''});const _0x32761a={'headers':_0x49aebe[_0x134ff9(0x1d9)](getDefaultHeaders)};try{const _0x15ede8=await _0x49aebe[_0x134ff9(0x155)](nodeRequest,_0x49aebe[_0x134ff9(0x1ba)],_0x134ff9(0x1c3)+process[_0x134ff9(0x151)][testHubConstants[_0x134ff9(0x19e)][_0x134ff9(0x1da)]]+_0x134ff9(0x1b3),_0x31ff37,_0x32761a,![]);if(_0x15ede8[_0x134ff9(0x19d)]&&_0x15ede8[_0x134ff9(0x19d)][_0x134ff9(0x1c5)]){const _0x19455d={};_0x19455d[_0x134ff9(0x17a)]=_0x15ede8[_0x134ff9(0x19d)]['error'];throw _0x19455d;}else{logger['debug'](_0x49aebe['mupZS']);const _0x28e421={};return _0x28e421[_0x134ff9(0x17e)]=_0x49aebe['QnBYB'],_0x28e421['message']='',_0x28e421;}}catch(_0x120a53){_0x120a53[_0x134ff9(0x194)]?logger[_0x134ff9(0x150)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x120a53['response']['status']+'\x20'+_0x120a53['response'][_0x134ff9(0x19f)]+'\x20'+JSON[_0x134ff9(0x187)](_0x120a53[_0x134ff9(0x194)][_0x134ff9(0x19d)])):logger[_0x134ff9(0x150)](_0x134ff9(0x14d)+(_0x120a53[_0x134ff9(0x17a)]||_0x120a53));const _0x10d426={};return _0x10d426[_0x134ff9(0x17e)]=_0x49aebe['rXiZq'],_0x10d426['message']=_0x120a53['message']||_0x120a53[_0x134ff9(0x194)]?_0x120a53['response']['status']+':'+_0x120a53[_0x134ff9(0x194)][_0x134ff9(0x19f)]:_0x120a53,_0x10d426;}})();}}module[a129_0x319e27(0x16e)]=TestHubHandler;
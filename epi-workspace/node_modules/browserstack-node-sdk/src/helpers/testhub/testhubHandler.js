const a90_0x21d874=a90_0x4914;function a90_0x4914(_0x47924e,_0x3ae368){const _0x1d940a=a90_0x1d94();return a90_0x4914=function(_0x49144b,_0x2d9cac){_0x49144b=_0x49144b-0x18a;let _0x3de66a=_0x1d940a[_0x49144b];return _0x3de66a;},a90_0x4914(_0x47924e,_0x3ae368);}(function(_0x42a91b,_0x1e6625){const _0x5342b3=a90_0x4914,_0x44d025=_0x42a91b();while(!![]){try{const _0x1998b4=-parseInt(_0x5342b3(0x1c0))/0x1*(parseInt(_0x5342b3(0x1c2))/0x2)+-parseInt(_0x5342b3(0x208))/0x3+-parseInt(_0x5342b3(0x20f))/0x4*(-parseInt(_0x5342b3(0x1f3))/0x5)+-parseInt(_0x5342b3(0x1d8))/0x6+-parseInt(_0x5342b3(0x204))/0x7+-parseInt(_0x5342b3(0x209))/0x8*(parseInt(_0x5342b3(0x1d1))/0x9)+parseInt(_0x5342b3(0x207))/0xa;if(_0x1998b4===_0x1e6625)break;else _0x44d025['push'](_0x44d025['shift']());}catch(_0x21654c){_0x44d025['push'](_0x44d025['shift']());}}}(a90_0x1d94,0x36d5c));const bsSetupHelper=require(a90_0x21d874(0x20e)),path=require(a90_0x21d874(0x1d0)),util=require(a90_0x21d874(0x1b1)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require('./utils.js'),testHubConstants=require(a90_0x21d874(0x1fc)),constants=require(a90_0x21d874(0x1b3)),RequestQueueHandler=require(a90_0x21d874(0x1dd)),logger=require(a90_0x21d874(0x1f5))[a90_0x21d874(0x212)],SessionHandler=require(a90_0x21d874(0x1d4)),PerformanceTester=require('../performance/performance-tester.js'),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x21d874(0x195)),TestDetails=require(a90_0x21d874(0x1a1)),{uploadTraceZip}=require(a90_0x21d874(0x198)),OngoingEvents=new Set();let processedTraceZips=![];function a90_0x1d94(){const _0x5c427f=['Opqup','allSettled','ENV_VAR','zXmDb','getConfig','username','jwt','lcnc','getCiInfo','../performance/constants','Percy\x20is\x20not\x20supported\x20for\x20','BROWSERSTACK_TEST_OBSERVABILITY','../../bin/playwright/reporter/pwUtils.js','settings','BROWSERSTACK_TESTHUB_UUID','START','buildStopSent','BROWSERSTACK_PRODUCT_MAP','forEach','job_id','projectName','../../bin/playwright/reporter/test-details.js','zEPAY','Ezxpo','xhjoo','STOP','success','rNloQ','RBmAf','hGChZ','rPskN','qlimO','percy','BROWSERSTACK_CENTRAL_SCANNER_JOBID','error','buildName','token','util','auth','../../bin/utils/constants.js','buildHashedId','ycLWF','YtdBZ','info','extractDataFromResponse','framework','checkAndSetupPercy','BROWSERSTACK_RERUN','Dlfxf','stringify','getCentralUser','processTraceZips','61673QUFspm','OBSERVABILITY','10Zkgvmu','isBrowserstackInfra','getAccessKey','api/v1/builds/','jWvlW','getGitMetaData','user_killed','TESTHUB_BUILD_API','getFrameworkDetails','JRNcm','BROWSERSTACK_BUILD_RUN_IDENTIFIER','uploadPending','allowScreenshot','central_scanner','path','26721jIwwsW','true','All\x20trace\x20zip\x20send\x20events\x20complete','../test-observability/sessionHandler.js','mbAXA','config','resolve','2406444EspKYr','BROWSERSTACK_TESTHUB_JWT','add','PERCY_SUPPORTED_FRAMEWORKS','null','../test-observability/requestQueueHandler.js','cwd','setAccessibilityVariables','Error\x20while\x20waiting\x20for\x20events:\x20','gcAmm','setupPercy','response','FiopM','generateBuildUpstreamData','false','waitForBuildStatus','debug','\x20framework','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','getHostInfo','authToken','accessibility','getProductMap','env','dGIhT','toISOString','stop','5MZpkab','Cclul','../logger','SOSMM','basename','data','isAccessibilityEnabled','qbdLA','getTraceFilePaths','./constants.js','getAccessibilityOptions','vbiwo','message','WpETK','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','BROWSERSTACK_ACCESSIBILITY','launchBuild','2819642enqgFu','setTestHubCommonMetaInfo','stopBuildUpstream\x20event\x20successful!','17336950vGgPJO','838806ZHgXUV','560RrccMB','isUndefined','mCncU','gmMrS','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','../helper','362344rPQGCV','status','measureWrapper','winstonLogger','LxjpP','DZIDT','setTestObservabilityVariables','/stop','Testhub\x20started\x20with\x20id:\x20','getUserName'];a90_0x1d94=function(){return _0x5c427f;};return a90_0x1d94();}const addEvent=_0x2bc810=>{const _0x37da5e=a90_0x21d874;OngoingEvents[_0x37da5e(0x1da)](_0x2bc810);},awaitAllEvents=async()=>{const _0x1fdad7=a90_0x21d874;return Promise[_0x1fdad7(0x18d)](OngoingEvents);};class TestHubHandler{static [a90_0x21d874(0x19c)]=![];static async[a90_0x21d874(0x203)](_0x1994d3,_0x161bd8){const _0x2783c5=a90_0x21d874,_0xcb5db9={'YtdBZ':function(_0x2e9d37,_0x2e65e8){return _0x2e9d37||_0x2e65e8;},'mbAXA':function(_0x469c06,_0x345a12){return _0x469c06===_0x345a12;},'JRNcm':function(_0x3f0236){return _0x3f0236();},'xnPSv':'EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','DZIDT':'false','qbdLA':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','SOSMM':function(_0x50575c,_0xe40efc,_0x48f1cf,_0x4f44d1,_0x3b0f4f){return _0x50575c(_0xe40efc,_0x48f1cf,_0x4f44d1,_0x3b0f4f);},'Opqup':'POST','zEPAY':_0x2783c5(0x1ed),'ZJfZy':_0x2783c5(0x1d2),'Cclul':function(_0x4fa646,_0x3fd623){return _0x4fa646===_0x3fd623;}};await PerformanceTester[_0x2783c5(0x211)](PerformanceEvents[_0x2783c5(0x19b)],async()=>{const _0x204c6e=_0x2783c5,_0x5583f3=Object['assign']({},_0x161bd8[_0x204c6e(0x1d6)],{'root_dir_path':'','framework':_0x161bd8[_0x204c6e(0x1b9)]}),_0x58a7e9=bsSetupHelper[_0x204c6e(0x18b)](_0x5583f3),_0x2a7f99=bsSetupHelper[_0x204c6e(0x1c4)](_0x5583f3),_0xbe47fb=_0xcb5db9[_0x204c6e(0x1b6)](_0x58a7e9,'')+':'+_0xcb5db9[_0x204c6e(0x1b6)](_0x2a7f99,''),_0x412450=testhubUtils[_0x204c6e(0x1ee)](_0x5583f3);process[_0x204c6e(0x1ef)][_0x204c6e(0x19d)]=JSON[_0x204c6e(0x1bd)](_0x412450);if(_0xcb5db9[_0x204c6e(0x1d5)](_0xbe47fb,':'))return _0xcb5db9[_0x204c6e(0x1cb)](isTestObservabilitySession)&&(logger[_0x204c6e(0x1e8)](_0xcb5db9['xnPSv']),process[_0x204c6e(0x1ef)]['BS_TESTOPS_BUILD_COMPLETED']=_0xcb5db9[_0x204c6e(0x214)]),testhubUtils[_0x204c6e(0x1f9)](_0x5583f3)&&logger[_0x204c6e(0x1e8)](_0xcb5db9[_0x204c6e(0x1fa)]),[null,null];try{const _0x28f3ea=await this['generateBuildUpstreamData'](_0x5583f3,_0x1994d3),_0x58df40=this[_0x204c6e(0x190)](_0x58a7e9,_0x2a7f99),_0x5dacad=await _0xcb5db9[_0x204c6e(0x1f6)](nodeRequest,_0xcb5db9[_0x204c6e(0x18c)],testHubConstants[_0x204c6e(0x1c9)],_0x28f3ea,_0x58df40),_0x210352=this[_0x204c6e(0x1b8)](_0x5583f3,_0x5dacad,_0x58df40);await this[_0x204c6e(0x1ba)](_0x161bd8,_0x1994d3);if(_0xcb5db9[_0x204c6e(0x1d5)](testhubUtils['getAccessibilityValueFromYml'](_0x161bd8['config']),null)){const _0x38d993=_0x210352[_0xcb5db9[_0x204c6e(0x1a2)]];_0x38d993&&_0x38d993[_0x204c6e(0x1ec)]&&_0x38d993[_0x204c6e(0x1b4)]&&(_0x161bd8[_0x204c6e(0x1d6)][_0x204c6e(0x1ed)]=!![],process['env']['BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM']=_0xcb5db9['ZJfZy']);}return _0x210352;}catch(_0x35662d){if(_0xcb5db9[_0x204c6e(0x1f4)](_0x35662d[_0x204c6e(0x1a6)],![])){testhubUtils['logBuildError'](_0x35662d);return;}}})();}static async[a90_0x21d874(0x1bf)](){const _0x4d6e4c=a90_0x21d874,_0x599cc7={'qGmIq':function(_0x2895a2,_0x21779b,_0x406906){return _0x2895a2(_0x21779b,_0x406906);},'RBmAf':function(_0x6eb81b,_0x1b13fd){return _0x6eb81b(_0x1b13fd);},'xhjoo':function(_0x17ff4b){return _0x17ff4b();},'gcAmm':_0x4d6e4c(0x1d3)};if(processedTraceZips)return;const _0x302da1=TestDetails[_0x4d6e4c(0x1fb)]();_0x302da1[_0x4d6e4c(0x19e)](({testUId:_0x4248af,filePath:_0x22953c})=>{const _0x4ceea1=_0x4d6e4c;var _0x5927c9=_0x599cc7['qGmIq'](uploadTraceZip,_0x22953c,_0x4248af);_0x599cc7[_0x4ceea1(0x1a8)](addEvent,_0x5927c9);});try{await _0x599cc7[_0x4d6e4c(0x1a4)](awaitAllEvents),logger[_0x4d6e4c(0x1e8)](_0x599cc7[_0x4d6e4c(0x1e1)]),processedTraceZips=!![];}catch(_0xe564b5){logger[_0x4d6e4c(0x1ae)](_0x4d6e4c(0x1e0)+util['format'](_0xe564b5));}}static async[a90_0x21d874(0x1ba)](_0x193d17,_0x4090dc){const _0x39e2b6=a90_0x21d874;if(constants[_0x39e2b6(0x1db)]['includes'](_0x4090dc)){await _0x193d17[_0x39e2b6(0x1e2)]();return;}_0x193d17[_0x39e2b6(0x1d6)][_0x39e2b6(0x1ac)]&&logger[_0x39e2b6(0x1e8)](_0x39e2b6(0x196)+_0x4090dc+_0x39e2b6(0x1e9));}static['getAccessibilityOptions'](_0x437c64){const _0x2f60f6=a90_0x21d874,_0x142899={};_0x142899[_0x2f60f6(0x199)]=_0x437c64['accessibilityOptions'];const _0x35c7a0=_0x142899;return _0x35c7a0;}static[a90_0x21d874(0x190)](_0x1c97c0,_0x2911ee){const _0x21635b=a90_0x21d874,_0x8d9040={'dGIhT':function(_0x4da9db,_0x531221){return _0x4da9db(_0x531221);}},_0x1f4087={};return _0x1f4087[_0x21635b(0x191)]=_0x1c97c0,_0x1f4087['password']=_0x2911ee,{'auth':_0x1f4087,'headers':_0x8d9040[_0x21635b(0x1f0)](getDefaultHeaders,![])};}static async[a90_0x21d874(0x1e5)](_0x26cdd8,_0x1ba062){const _0x41b7f7=a90_0x21d874,_0x4561f4={'mCncU':function(_0x35c74e,_0x45dbb4){return _0x35c74e(_0x45dbb4);}},_0x158a90={'project_name':_0x26cdd8[_0x41b7f7(0x1a0)]||'','name':_0x26cdd8[_0x41b7f7(0x1af)]||path[_0x41b7f7(0x1f7)](path[_0x41b7f7(0x1d7)](process[_0x41b7f7(0x1de)]())),'build_identifier':_0x26cdd8['buildIdentifier'],'description':_0x26cdd8['buildDescription']||'','started_at':new Date()[_0x41b7f7(0x1f1)](),'tags':_0x4561f4[_0x41b7f7(0x20b)](getCustomTags,_0x26cdd8),'host_info':bsSetupHelper[_0x41b7f7(0x1eb)](),'ci_info':bsSetupHelper[_0x41b7f7(0x194)](),'build_run_identifier':process['env'][_0x41b7f7(0x1cc)],'failed_tests_rerun':process[_0x41b7f7(0x1ef)][_0x41b7f7(0x1bb)]||![],'version_control':await bsSetupHelper[_0x41b7f7(0x1c7)](),'accessibility':this[_0x41b7f7(0x1fd)](_0x26cdd8),'framework_details':testhubUtils[_0x41b7f7(0x1ca)](_0x26cdd8,_0x1ba062),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x26cdd8),'browserstackAutomation':bsSetupHelper[_0x41b7f7(0x1c3)](),'grouping_identifier':process[_0x41b7f7(0x1ef)][_0x41b7f7(0x201)]};if(bsSetupHelper[_0x41b7f7(0x1be)]()[_0x41b7f7(0x1cf)]||bsSetupHelper[_0x41b7f7(0x1be)]()[_0x41b7f7(0x193)]){const _0x34001b={};_0x34001b[_0x41b7f7(0x19f)]=process['env'][_0x41b7f7(0x1ad)],_0x34001b[_0x41b7f7(0x1b0)]=process['env']['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0x158a90['central_scanner']=_0x34001b;}return _0x158a90;}static[a90_0x21d874(0x1b8)](_0x266a3f,_0x2b09f5,_0xa6f30f){const _0x141a91=a90_0x21d874,_0x2bf7de={'rNloQ':function(_0x398498){return _0x398498();},'gmMrS':function(_0x3dc49d,_0xacbdff){return _0x3dc49d&&_0xacbdff;},'Oqueh':_0x141a91(0x1d2),'WpETK':_0x141a91(0x1e6)},_0x70e89c={};if(_0x2bf7de[_0x141a91(0x1a7)](isTestObservabilitySession)){const [_0xe15896,_0x30a20f,_0x31bb1c]=testhubUtils[_0x141a91(0x215)](_0x2b09f5[_0x141a91(0x1f8)],_0xa6f30f[_0x141a91(0x1b2)]);if(_0x2bf7de[_0x141a91(0x20c)](_0xe15896,_0x30a20f)){const _0x209622={};_0x209622[_0x141a91(0x192)]=_0xe15896,_0x209622[_0x141a91(0x1b4)]=_0x30a20f,_0x209622[_0x141a91(0x1ce)]=_0x31bb1c,_0x70e89c[testHubConstants[_0x141a91(0x1c1)]]=_0x209622,process['env']['BROWSERSTACK_TEST_OBSERVABILITY']=_0x2bf7de['Oqueh'];}else _0x70e89c[testHubConstants[_0x141a91(0x1c1)]]={},process[_0x141a91(0x1ef)][_0x141a91(0x197)]=_0x2bf7de['WpETK'];}else process[_0x141a91(0x1ef)][_0x141a91(0x197)]=_0x2bf7de[_0x141a91(0x200)];const [_0x1f2f3e,_0x36e7b6]=testhubUtils[_0x141a91(0x1df)](_0x2b09f5[_0x141a91(0x1f8)]);if(_0x2bf7de[_0x141a91(0x20c)](_0x1f2f3e,_0x36e7b6)){const _0x484cb7={};_0x484cb7['authToken']=_0x1f2f3e,_0x484cb7[_0x141a91(0x1b4)]=_0x36e7b6,_0x70e89c[testHubConstants['ACCESSIBILITY']]=_0x484cb7,process[_0x141a91(0x1ef)][_0x141a91(0x202)]=_0x2bf7de['Oqueh'];}else _0x70e89c[testHubConstants['ACCESSIBILITY']]={},process['env'][_0x141a91(0x202)]=_0x2bf7de['WpETK'];return testhubUtils[_0x141a91(0x205)](_0x2b09f5[_0x141a91(0x1f8)]),logger[_0x141a91(0x1b7)](_0x141a91(0x18a)+process[_0x141a91(0x1ef)][_0x141a91(0x19a)]),_0x70e89c;}static async[a90_0x21d874(0x1f2)](_0x3e8193){const _0x3ac583=a90_0x21d874,_0x5eaf5d={'LxjpP':function(_0x22c549,_0x2a7a74){return _0x22c549===_0x2a7a74;},'Dlfxf':_0x3ac583(0x1e6),'vbiwo':function(_0x44a8fe,_0x261549){return _0x44a8fe===_0x261549;},'qlimO':_0x3ac583(0x1dc),'iaiRM':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','jWvlW':'error','FiopM':_0x3ac583(0x20d),'qaOaz':'finished_metadata','GyLKD':_0x3ac583(0x1c8),'ycLWF':function(_0x354e90){return _0x354e90();},'Ezxpo':function(_0xc22610,_0x1879ca,_0x2391ef,_0x4b4580,_0xece040,_0x3e6876){return _0xc22610(_0x1879ca,_0x2391ef,_0x4b4580,_0xece040,_0x3e6876);},'rPskN':'PUT','zXmDb':_0x3ac583(0x206),'hGChZ':_0x3ac583(0x1a6)};await this[_0x3ac583(0x1bf)](),await PerformanceTester[_0x3ac583(0x211)](PerformanceEvents[_0x3ac583(0x1a5)],async()=>{const _0x123960=_0x3ac583;if(_0x5eaf5d[_0x123960(0x213)](process[_0x123960(0x1ef)]['BS_TESTOPS_BUILD_COMPLETED'],_0x5eaf5d[_0x123960(0x1bc)])||TestHubHandler[_0x123960(0x19c)]||bsSetupHelper[_0x123960(0x20a)](process[_0x123960(0x1ef)][testHubConstants['ENV_VAR'][_0x123960(0x1d9)]]))return;TestHubHandler[_0x123960(0x19c)]=!![],await RequestQueueHandler['getInstance']()[_0x123960(0x1cd)](),await SessionHandler[_0x123960(0x1e7)]();if(_0x5eaf5d['vbiwo'](process[_0x123960(0x1ef)][testHubConstants[_0x123960(0x18e)][_0x123960(0x1d9)]],_0x5eaf5d[_0x123960(0x1ab)])||_0x5eaf5d[_0x123960(0x1fe)](process[_0x123960(0x1ef)][testHubConstants[_0x123960(0x18e)][_0x123960(0x19a)]],_0x5eaf5d[_0x123960(0x1ab)])){logger[_0x123960(0x1e8)](_0x5eaf5d['iaiRM']);const _0x4dea71={};return _0x4dea71['status']=_0x5eaf5d['jWvlW'],_0x4dea71[_0x123960(0x1ff)]=_0x5eaf5d[_0x123960(0x1e4)],_0x4dea71;}const _0x2134d4={'finished_at':new Date()[_0x123960(0x1f1)](),'finished_metadata':[]};!!_0x3e8193&&_0x2134d4[_0x5eaf5d['qaOaz']]['push']({'reason':_0x5eaf5d['GyLKD'],'signal':_0x3e8193,'failure_data':''});const _0x47365e={'headers':_0x5eaf5d[_0x123960(0x1b5)](getDefaultHeaders)};try{const _0xa89663=await _0x5eaf5d[_0x123960(0x1a3)](nodeRequest,_0x5eaf5d[_0x123960(0x1aa)],_0x123960(0x1c5)+process[_0x123960(0x1ef)][testHubConstants[_0x123960(0x18e)][_0x123960(0x19a)]]+_0x123960(0x216),_0x2134d4,_0x47365e,![]);if(_0xa89663[_0x123960(0x1f8)]&&_0xa89663['data'][_0x123960(0x1ae)]){const _0x3c4770={};_0x3c4770['message']=_0xa89663['data'][_0x123960(0x1ae)];throw _0x3c4770;}else{logger[_0x123960(0x1e8)](_0x5eaf5d[_0x123960(0x18f)]);const _0x1ab058={};return _0x1ab058['status']=_0x5eaf5d[_0x123960(0x1a9)],_0x1ab058[_0x123960(0x1ff)]='',_0x1ab058;}}catch(_0x574f3f){_0x574f3f[_0x123960(0x1e3)]?logger[_0x123960(0x1e8)](_0x123960(0x1ea)+_0x574f3f[_0x123960(0x1e3)][_0x123960(0x210)]+'\x20'+_0x574f3f[_0x123960(0x1e3)]['statusText']+'\x20'+JSON[_0x123960(0x1bd)](_0x574f3f[_0x123960(0x1e3)][_0x123960(0x1f8)])):logger['debug']('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x574f3f[_0x123960(0x1ff)]||_0x574f3f));const _0xa4552={};return _0xa4552[_0x123960(0x210)]=_0x5eaf5d[_0x123960(0x1c6)],_0xa4552['message']=_0x574f3f[_0x123960(0x1ff)]||_0x574f3f['response']?_0x574f3f[_0x123960(0x1e3)]['status']+':'+_0x574f3f[_0x123960(0x1e3)]['statusText']:_0x574f3f,_0xa4552;}})();}}module['exports']=TestHubHandler;
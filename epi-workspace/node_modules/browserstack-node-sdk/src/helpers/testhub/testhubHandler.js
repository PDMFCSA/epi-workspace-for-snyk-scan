const a90_0x54699b=a90_0x2722;(function(_0x2d1c50,_0x28b09a){const _0x4c9428=a90_0x2722,_0x13e38e=_0x2d1c50();while(!![]){try{const _0x2e41d1=-parseInt(_0x4c9428(0x212))/0x1*(parseInt(_0x4c9428(0x1f3))/0x2)+parseInt(_0x4c9428(0x1e3))/0x3*(-parseInt(_0x4c9428(0x247))/0x4)+-parseInt(_0x4c9428(0x203))/0x5+-parseInt(_0x4c9428(0x20b))/0x6+parseInt(_0x4c9428(0x230))/0x7*(parseInt(_0x4c9428(0x202))/0x8)+parseInt(_0x4c9428(0x233))/0x9*(parseInt(_0x4c9428(0x20e))/0xa)+parseInt(_0x4c9428(0x20d))/0xb*(parseInt(_0x4c9428(0x21e))/0xc);if(_0x2e41d1===_0x28b09a)break;else _0x13e38e['push'](_0x13e38e['shift']());}catch(_0x1545b7){_0x13e38e['push'](_0x13e38e['shift']());}}}(a90_0x10f8,0x3fa5f));const bsSetupHelper=require(a90_0x54699b(0x1e1)),path=require(a90_0x54699b(0x1e2)),util=require(a90_0x54699b(0x251)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require('../test-observability/utils'),testhubUtils=require(a90_0x54699b(0x1ef)),testHubConstants=require('./constants.js'),constants=require(a90_0x54699b(0x217)),RequestQueueHandler=require(a90_0x54699b(0x208)),logger=require(a90_0x54699b(0x25f))[a90_0x54699b(0x228)],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a90_0x54699b(0x210)),{TESTHUB_EVENTS:PerformanceEvents}=require(a90_0x54699b(0x215)),TestDetails=require(a90_0x54699b(0x260)),{uploadTraceZip}=require(a90_0x54699b(0x1f2)),OngoingEvents=new Set();let processedTraceZips=![];const addEvent=_0x24fbd0=>{const _0x5177ee=a90_0x54699b;OngoingEvents[_0x5177ee(0x231)](_0x24fbd0);},awaitAllEvents=async()=>{const _0x332d0d=a90_0x54699b;return Promise[_0x332d0d(0x21d)](OngoingEvents);};class TestHubHandler{static ['buildStopSent']=![];static async[a90_0x54699b(0x1e9)](_0x5e9e3f,_0x59a8e7){const _0x159331=a90_0x54699b,_0x3a02a8={'saocn':function(_0x549547,_0x54080b){return _0x549547||_0x54080b;},'YpYKO':function(_0x5cda4a,_0x2c1c95){return _0x5cda4a===_0x2c1c95;},'NTZvN':function(_0x4fe5a0){return _0x4fe5a0();},'ieSpS':_0x159331(0x258),'CEYmE':'false','DycHE':'Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','kUlGM':function(_0x173809,_0x47685e,_0x2a047d,_0x20e564,_0x20a69f){return _0x173809(_0x47685e,_0x2a047d,_0x20e564,_0x20a69f);},'QPfSW':_0x159331(0x23a)};await PerformanceTester[_0x159331(0x232)](PerformanceEvents[_0x159331(0x1e7)],async()=>{const _0x52651a=_0x159331,_0x17bc4a=Object['assign']({},_0x59a8e7[_0x52651a(0x204)],{'root_dir_path':'','framework':_0x59a8e7['framework']}),_0x2cca02=bsSetupHelper[_0x52651a(0x1db)](_0x17bc4a),_0x4daf4a=bsSetupHelper[_0x52651a(0x221)](_0x17bc4a),_0x1aac21=_0x3a02a8[_0x52651a(0x1ff)](_0x2cca02,'')+':'+_0x3a02a8['saocn'](_0x4daf4a,''),_0x2dd624=testhubUtils[_0x52651a(0x229)](_0x17bc4a);process[_0x52651a(0x24c)]['BROWSERSTACK_PRODUCT_MAP']=JSON[_0x52651a(0x24a)](_0x2dd624);if(_0x3a02a8[_0x52651a(0x1ee)](_0x1aac21,':'))return _0x3a02a8[_0x52651a(0x1ea)](isTestObservabilitySession)&&(logger[_0x52651a(0x223)](_0x3a02a8[_0x52651a(0x1f6)]),process[_0x52651a(0x24c)][_0x52651a(0x206)]=_0x3a02a8[_0x52651a(0x200)]),testhubUtils[_0x52651a(0x23d)](_0x17bc4a)&&logger['debug'](_0x3a02a8[_0x52651a(0x23f)]),[null,null];try{const _0x3b08cb=await this[_0x52651a(0x222)](_0x17bc4a,_0x5e9e3f),_0x260f30=this[_0x52651a(0x218)](_0x2cca02,_0x4daf4a),_0x2722f9=await _0x3a02a8[_0x52651a(0x1e4)](nodeRequest,_0x3a02a8['QPfSW'],testHubConstants['TESTHUB_BUILD_API'],_0x3b08cb,_0x260f30),_0xf2e630=this['extractDataFromResponse'](_0x17bc4a,_0x2722f9,_0x260f30);return await this[_0x52651a(0x249)](_0x59a8e7,_0x5e9e3f),_0xf2e630;}catch(_0x1d36da){if(_0x3a02a8[_0x52651a(0x1ee)](_0x1d36da[_0x52651a(0x24d)],![])){testhubUtils[_0x52651a(0x1df)](_0x1d36da);return;}}})();}static async['processTraceZips'](){const _0x39a8fe=a90_0x54699b,_0x181cc2={'tWpzM':function(_0x2e89f8,_0x3f249a,_0x24c11c){return _0x2e89f8(_0x3f249a,_0x24c11c);},'maPeq':function(_0x9e0a61,_0x3d36dc){return _0x9e0a61(_0x3d36dc);},'aPrit':function(_0x48cba3){return _0x48cba3();},'XZOQR':_0x39a8fe(0x214)};if(processedTraceZips)return;const _0x4072b7=TestDetails['getTraceFilePaths']();_0x4072b7[_0x39a8fe(0x234)](({testUId:_0x5946b9,filePath:_0x220c43})=>{const _0x29d003=_0x39a8fe;var _0x268cb8=_0x181cc2[_0x29d003(0x21a)](uploadTraceZip,_0x220c43,_0x5946b9);_0x181cc2[_0x29d003(0x23e)](addEvent,_0x268cb8);});try{await _0x181cc2[_0x39a8fe(0x24e)](awaitAllEvents),logger['debug'](_0x181cc2[_0x39a8fe(0x1f7)]),processedTraceZips=!![];}catch(_0x9f4c27){logger[_0x39a8fe(0x1fe)](_0x39a8fe(0x25a)+util[_0x39a8fe(0x213)](_0x9f4c27));}}static async[a90_0x54699b(0x249)](_0x1f26de,_0x2d85df){const _0x3ae41c=a90_0x54699b;if(constants[_0x3ae41c(0x1f5)][_0x3ae41c(0x225)](_0x2d85df)){await _0x1f26de['setupPercy']();return;}_0x1f26de['config'][_0x3ae41c(0x252)]&&logger[_0x3ae41c(0x223)](_0x3ae41c(0x1d8)+_0x2d85df+_0x3ae41c(0x241));}static[a90_0x54699b(0x237)](_0x869c1b){const _0x28d8e6=a90_0x54699b,_0x4f1747={};_0x4f1747['settings']=_0x869c1b[_0x28d8e6(0x216)];const _0x367783=_0x4f1747;return _0x367783;}static[a90_0x54699b(0x218)](_0x2ecd04,_0x1436e8){const _0xf16d5d=a90_0x54699b,_0x2e056d={'EfxYg':function(_0xd837d8,_0x5bcad4){return _0xd837d8(_0x5bcad4);}},_0x2e38ac={};return _0x2e38ac[_0xf16d5d(0x211)]=_0x2ecd04,_0x2e38ac[_0xf16d5d(0x248)]=_0x1436e8,{'auth':_0x2e38ac,'headers':_0x2e056d[_0xf16d5d(0x1f8)](getDefaultHeaders,![])};}static async[a90_0x54699b(0x222)](_0x39f86a,_0x12d9f0){const _0x73f936=a90_0x54699b,_0x3a65f3={'eFfzM':function(_0x3830e8,_0x98ddf){return _0x3830e8(_0x98ddf);}},_0x4ccbdf={'project_name':_0x39f86a[_0x73f936(0x220)]||'','name':_0x39f86a['buildName']||path['basename'](path['resolve'](process['cwd']())),'build_identifier':_0x39f86a['buildIdentifier'],'description':_0x39f86a['buildDescription']||'','started_at':new Date()[_0x73f936(0x257)](),'tags':_0x3a65f3[_0x73f936(0x245)](getCustomTags,_0x39f86a),'host_info':bsSetupHelper[_0x73f936(0x1ec)](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process[_0x73f936(0x24c)][_0x73f936(0x236)],'failed_tests_rerun':process['env'][_0x73f936(0x256)]||![],'version_control':await bsSetupHelper[_0x73f936(0x255)](),'accessibility':this['getAccessibilityOptions'](_0x39f86a),'framework_details':testhubUtils[_0x73f936(0x1eb)](_0x39f86a,_0x12d9f0),'product_map':testhubUtils[_0x73f936(0x229)](_0x39f86a),'browserstackAutomation':bsSetupHelper['isBrowserstackInfra'](),'grouping_identifier':process['env'][_0x73f936(0x1e0)]};if(bsSetupHelper[_0x73f936(0x23b)]()[_0x73f936(0x205)]||bsSetupHelper[_0x73f936(0x23b)]()[_0x73f936(0x209)]){const _0x57e319={};_0x57e319['job_id']=process['env'][_0x73f936(0x1fd)],_0x57e319[_0x73f936(0x21b)]=process[_0x73f936(0x24c)][_0x73f936(0x226)],_0x4ccbdf['central_scanner']=_0x57e319;}return _0x4ccbdf;}static[a90_0x54699b(0x24f)](_0x3a3fa4,_0x3e5da7,_0x550c65){const _0x3f31de=a90_0x54699b,_0x531cac={'SjCCY':function(_0x3f70e6){return _0x3f70e6();},'rBFWS':function(_0x1de4f5,_0x25db97){return _0x1de4f5&&_0x25db97;},'FrcVJ':'true','GvNLZ':'false','aYSBf':function(_0x5e3f68,_0x54a226){return _0x5e3f68&&_0x54a226;}},_0x42e190={};if(_0x531cac['SjCCY'](isTestObservabilitySession)){const [_0x2f0456,_0x15e661,_0x4c15ba]=testhubUtils[_0x3f31de(0x224)](_0x3e5da7['data'],_0x550c65[_0x3f31de(0x20a)]);if(_0x531cac['rBFWS'](_0x2f0456,_0x15e661)){const _0x59ea60={};_0x59ea60['jwt']=_0x2f0456,_0x59ea60[_0x3f31de(0x1fc)]=_0x15e661,_0x59ea60[_0x3f31de(0x20f)]=_0x4c15ba,_0x42e190[testHubConstants[_0x3f31de(0x22b)]]=_0x59ea60,process[_0x3f31de(0x24c)][_0x3f31de(0x1fb)]=_0x531cac['FrcVJ'];}else _0x42e190[testHubConstants['OBSERVABILITY']]={},process[_0x3f31de(0x24c)][_0x3f31de(0x1fb)]=_0x531cac['GvNLZ'];}else process[_0x3f31de(0x24c)][_0x3f31de(0x1fb)]=_0x531cac['GvNLZ'];if(testhubUtils[_0x3f31de(0x23d)](_0x3a3fa4)){const [_0x19018c,_0x49dbb5]=testhubUtils[_0x3f31de(0x24b)](_0x3e5da7[_0x3f31de(0x22a)]);if(_0x531cac[_0x3f31de(0x25e)](_0x19018c,_0x49dbb5)){const _0x3bba61={};_0x3bba61[_0x3f31de(0x227)]=_0x19018c,_0x3bba61[_0x3f31de(0x1fc)]=_0x49dbb5,_0x42e190[testHubConstants[_0x3f31de(0x238)]]=_0x3bba61,process[_0x3f31de(0x24c)]['BROWSERSTACK_ACCESSIBILITY']=_0x531cac[_0x3f31de(0x1f4)];}else _0x42e190[testHubConstants[_0x3f31de(0x238)]]={},process[_0x3f31de(0x24c)][_0x3f31de(0x1ed)]=_0x531cac['GvNLZ'];}else process[_0x3f31de(0x24c)][_0x3f31de(0x1ed)]=_0x531cac[_0x3f31de(0x21c)];return testhubUtils['setTestHubCommonMetaInfo'](_0x3e5da7[_0x3f31de(0x22a)]),logger[_0x3f31de(0x250)](_0x3f31de(0x22e)+process['env']['BROWSERSTACK_TESTHUB_UUID']),_0x42e190;}static async[a90_0x54699b(0x25d)](_0x16a1b6){const _0x2001c5=a90_0x54699b,_0x418da5={'rXWAq':function(_0x1602ef,_0x28e9aa){return _0x1602ef===_0x28e9aa;},'gOKKu':_0x2001c5(0x21f),'aLBPo':function(_0x384a1d,_0x536dc6){return _0x384a1d===_0x536dc6;},'YwNav':'null','JDTpg':function(_0x5d3916,_0x3ee040){return _0x5d3916===_0x3ee040;},'dYySW':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','UPdNY':'error','YapoO':_0x2001c5(0x1f0),'PSHaA':_0x2001c5(0x253),'UbAAi':_0x2001c5(0x23c),'nwbXR':function(_0x211fbd){return _0x211fbd();},'mcJzI':function(_0x2948a4,_0x37def5,_0x34ebc3,_0x3645b5,_0x449d5a,_0x4fdc87){return _0x2948a4(_0x37def5,_0x34ebc3,_0x3645b5,_0x449d5a,_0x4fdc87);},'gkBND':_0x2001c5(0x201),'gXIRv':'stopBuildUpstream\x20event\x20successful!','gAitJ':_0x2001c5(0x24d)};await this[_0x2001c5(0x259)](),await PerformanceTester[_0x2001c5(0x232)](PerformanceEvents[_0x2001c5(0x254)],async()=>{const _0x5f16e7=_0x2001c5;if(_0x418da5[_0x5f16e7(0x207)](process[_0x5f16e7(0x24c)][_0x5f16e7(0x206)],_0x418da5[_0x5f16e7(0x1f1)])||TestHubHandler[_0x5f16e7(0x1dd)]||bsSetupHelper[_0x5f16e7(0x1f9)](process['env'][testHubConstants['ENV_VAR'][_0x5f16e7(0x243)]]))return;TestHubHandler['buildStopSent']=!![],await RequestQueueHandler[_0x5f16e7(0x240)]()[_0x5f16e7(0x244)](),await SessionHandler[_0x5f16e7(0x22d)]();if(_0x418da5[_0x5f16e7(0x22f)](process[_0x5f16e7(0x24c)][testHubConstants[_0x5f16e7(0x1da)][_0x5f16e7(0x243)]],_0x418da5['YwNav'])||_0x418da5[_0x5f16e7(0x1dc)](process[_0x5f16e7(0x24c)][testHubConstants[_0x5f16e7(0x1da)]['BROWSERSTACK_TESTHUB_UUID']],_0x418da5[_0x5f16e7(0x235)])){logger[_0x5f16e7(0x223)](_0x418da5[_0x5f16e7(0x1d9)]);const _0x1baa80={};return _0x1baa80[_0x5f16e7(0x25c)]=_0x418da5[_0x5f16e7(0x20c)],_0x1baa80[_0x5f16e7(0x242)]=_0x418da5[_0x5f16e7(0x1e8)],_0x1baa80;}const _0x38988b={'finished_at':new Date()['toISOString'](),'finished_metadata':[]};!!_0x16a1b6&&_0x38988b[_0x418da5['PSHaA']][_0x5f16e7(0x1fa)]({'reason':_0x418da5['UbAAi'],'signal':_0x16a1b6,'failure_data':''});const _0x30aa28={'headers':_0x418da5['nwbXR'](getDefaultHeaders)};try{const _0x46085f=await _0x418da5[_0x5f16e7(0x219)](nodeRequest,_0x418da5[_0x5f16e7(0x22c)],_0x5f16e7(0x25b)+process[_0x5f16e7(0x24c)][testHubConstants[_0x5f16e7(0x1da)][_0x5f16e7(0x246)]]+'/stop',_0x38988b,_0x30aa28,![]);if(_0x46085f[_0x5f16e7(0x22a)]&&_0x46085f[_0x5f16e7(0x22a)]['error']){const _0x1c4812={};_0x1c4812[_0x5f16e7(0x242)]=_0x46085f[_0x5f16e7(0x22a)]['error'];throw _0x1c4812;}else{logger[_0x5f16e7(0x223)](_0x418da5[_0x5f16e7(0x1e5)]);const _0x396d73={};return _0x396d73[_0x5f16e7(0x25c)]=_0x418da5[_0x5f16e7(0x261)],_0x396d73['message']='',_0x396d73;}}catch(_0x4bb5c5){_0x4bb5c5[_0x5f16e7(0x1de)]?logger[_0x5f16e7(0x223)](_0x5f16e7(0x239)+_0x4bb5c5[_0x5f16e7(0x1de)][_0x5f16e7(0x25c)]+'\x20'+_0x4bb5c5['response']['statusText']+'\x20'+JSON[_0x5f16e7(0x24a)](_0x4bb5c5[_0x5f16e7(0x1de)][_0x5f16e7(0x22a)])):logger[_0x5f16e7(0x223)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x4bb5c5[_0x5f16e7(0x242)]||_0x4bb5c5));const _0x9a043d={};return _0x9a043d[_0x5f16e7(0x25c)]=_0x418da5[_0x5f16e7(0x20c)],_0x9a043d[_0x5f16e7(0x242)]=_0x4bb5c5[_0x5f16e7(0x242)]||_0x4bb5c5['response']?_0x4bb5c5['response']['status']+':'+_0x4bb5c5[_0x5f16e7(0x1de)][_0x5f16e7(0x1e6)]:_0x4bb5c5,_0x9a043d;}})();}}function a90_0x10f8(){const _0x5b9050=['PUT','2616EcZsMz','499185mAtiSQ','config','central_scanner','BS_TESTOPS_BUILD_COMPLETED','rXWAq','../test-observability/requestQueueHandler.js','lcnc','auth','1918356XnKBut','UPdNY','167662xgNTOH','10CaUCfl','allowScreenshot','../performance/performance-tester.js','username','63450jYxSmF','format','All\x20trace\x20zip\x20send\x20events\x20complete','../performance/constants','accessibilityOptions','../../bin/utils/constants.js','getConfig','mcJzI','tWpzM','token','GvNLZ','allSettled','576LaVUTZ','false','projectName','getAccessKey','generateBuildUpstreamData','debug','setTestObservabilityVariables','includes','BROWSERSTACK_CENTRAL_SCANNER_JWT','authToken','winstonLogger','getProductMap','data','OBSERVABILITY','gkBND','waitForBuildStatus','Testhub\x20started\x20with\x20id:\x20','aLBPo','6426cHHqpS','add','measureWrapper','1605195mhviVE','forEach','YwNav','BROWSERSTACK_BUILD_RUN_IDENTIFIER','getAccessibilityOptions','ACCESSIBILITY','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','POST','getCentralUser','user_killed','isAccessibilityEnabled','maPeq','DycHE','getInstance','\x20framework','message','BROWSERSTACK_TESTHUB_JWT','uploadPending','eFfzM','BROWSERSTACK_TESTHUB_UUID','342964nlyftR','password','checkAndSetupPercy','stringify','setAccessibilityVariables','env','success','aPrit','extractDataFromResponse','info','util','percy','finished_metadata','STOP','getGitMetaData','BROWSERSTACK_RERUN','toISOString','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','processTraceZips','Error\x20while\x20waiting\x20for\x20events:\x20','api/v1/builds/','status','stop','aYSBf','../logger','../../bin/playwright/reporter/test-details.js','gAitJ','Percy\x20is\x20not\x20supported\x20for\x20','dYySW','ENV_VAR','getUserName','JDTpg','buildStopSent','response','logBuildError','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','../helper','path','3ScPCUe','kUlGM','gXIRv','statusText','START','YapoO','launchBuild','NTZvN','getFrameworkDetails','getHostInfo','BROWSERSTACK_ACCESSIBILITY','YpYKO','./utils.js','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','gOKKu','../../bin/playwright/reporter/pwUtils.js','14OCaykA','FrcVJ','PERCY_SUPPORTED_FRAMEWORKS','ieSpS','XZOQR','EfxYg','isUndefined','push','BROWSERSTACK_TEST_OBSERVABILITY','buildHashedId','BROWSERSTACK_CENTRAL_SCANNER_JOBID','error','saocn','CEYmE'];a90_0x10f8=function(){return _0x5b9050;};return a90_0x10f8();}function a90_0x2722(_0x15fdd3,_0x297a48){const _0x10f81f=a90_0x10f8();return a90_0x2722=function(_0x27229b,_0x396763){_0x27229b=_0x27229b-0x1d8;let _0x1ce8e3=_0x10f81f[_0x27229b];return _0x1ce8e3;},a90_0x2722(_0x15fdd3,_0x297a48);}module['exports']=TestHubHandler;
const a128_0x3ff9b3=a128_0x54a6;(function(_0x5783c2,_0x2cb830){const _0x6a48de=a128_0x54a6,_0x251c3f=_0x5783c2();while(!![]){try{const _0x7d6d51=-parseInt(_0x6a48de(0x165))/0x1*(-parseInt(_0x6a48de(0x11c))/0x2)+parseInt(_0x6a48de(0x124))/0x3+-parseInt(_0x6a48de(0x146))/0x4+parseInt(_0x6a48de(0x13d))/0x5*(-parseInt(_0x6a48de(0x152))/0x6)+-parseInt(_0x6a48de(0x181))/0x7+parseInt(_0x6a48de(0x15f))/0x8+parseInt(_0x6a48de(0x149))/0x9*(-parseInt(_0x6a48de(0x12f))/0xa);if(_0x7d6d51===_0x2cb830)break;else _0x251c3f['push'](_0x251c3f['shift']());}catch(_0x7a6df1){_0x251c3f['push'](_0x251c3f['shift']());}}}(a128_0x26c4,0x975ad));function a128_0x54a6(_0x5b9fc1,_0x44aac2){const _0x26c416=a128_0x26c4();return a128_0x54a6=function(_0x54a66e,_0x1c3cea){_0x54a66e=_0x54a66e-0x10d;let _0x379148=_0x26c416[_0x54a66e];return _0x379148;},a128_0x54a6(_0x5b9fc1,_0x44aac2);}const {BATCH_SIZE,BATCH_INTERVAL,DEFAULT_WAIT_TIMEOUT_FOR_PENDING_UPLOADS,DEFAULT_WAIT_INTERVAL_FOR_PENDING_UPLOADS}=require('./constants'),{nodeRequest,debug,trace,sleep,getDefaultHeaders}=require(a128_0x3ff9b3(0x11d)),{nestedKeyValue}=require(a128_0x3ff9b3(0x10e)),util=require(a128_0x3ff9b3(0x10d)),constants=require(a128_0x3ff9b3(0x16b));function a128_0x26c4(){const _0x49b6ad=['event_type','BATCH_EVENT_TYPES','Zjrgh','hook_run','push','asnuT','splice','KjlMH','NQAJa','6IvVVUR','./utils','add','\x20:\x20','kind','includes','nyGFz','cSAHY','823512hTnwPq','byteLength','startEventBatchPolling','\x20REQUEST\x20TO\x20','uuid','LogCreated','logs','message','proceedWithData','batchAndPostEvents','IpZip','3166430Qqafty','zJIhg','TEST_REPORTING_ANALYTICS','screenshotEventUrl','fhxBR','XdNtf','Shutting\x20down\x20request\x20batcher\x20with\x20pending\x20uploads\x20still\x20in\x20queue.\x20Remaining\x20uploads\x20','fzsWw','status','started','JuvJd','length','olENs','Batch\x20event\x20length\x20has\x20increased\x20maximum\x20batch\x20size.\x20Sending\x20events..','5gzlWio','iNxNt','uDHaq','statusText','\x20event\x20successful\x20for\x20events\x20','dGlKs','RESETTING','uMHHI','TEST_ATTACHMENT','1858504oRscZz','dkBWz','TestRunStarted','9xnhZcF','removeEventBatchPolling','kqnnu','YUzlS','Remaining\x20Queue\x20Length\x20-\x20','nAusz','EkohU','EXCEPTION\x20IN\x20','eventUrl','2966982hGkYrA','tKOjm','error','instance','max','TestRunFinished','slice','pendingUploads','TestRunSkipped','RQNvr','\x20--\x20','dGDSf','SetLI','8239616SNoTvF','shutdown','\x20bytes.\x20Events\x20are\x20','resetEventBatchPolling','response','RHLDI','386189pHSoUr','gLjBI','uploadAttachmentUrl','NSUOm','TEST_SCREENSHOT','pollEventBatchInterval','../../bin/utils/constants','XTPFZ','data','Processing\x20events.\x20Queue\x20Length\x20-\x20','shouldProceed','JsNgV','dRQGm','FNHHv','Bkwnt','sHOcJ','format','start','proceedWithUrl','POST','queue','HookRunStarted','yOAyL','getInstance','HookRunFinished','join','BhmnR','uploadPending','3971156xrxWfq','util','../helper','api/v1/batch','SXjuU','zGXHz','JNIiX'];a128_0x26c4=function(){return _0x49b6ad;};return a128_0x26c4();}class RequestQueueHandler{static ['instance'];[a128_0x3ff9b3(0x159)]=0x0;constructor(){const _0x17f553=a128_0x3ff9b3,_0x3ab194={};_0x3ab194[_0x17f553(0x118)]='2|4|6|0|1|3|5',_0x3ab194[_0x17f553(0x130)]='api/v1/screenshots',_0x3ab194[_0x17f553(0x13e)]='upload-attachments',_0x3ab194[_0x17f553(0x142)]=_0x17f553(0x129),_0x3ab194['uDHaq']='CBTSessionCreated',_0x3ab194[_0x17f553(0x123)]=_0x17f553(0x157),_0x3ab194['NSUOm']=_0x17f553(0x15a),_0x3ab194[_0x17f553(0x11a)]=_0x17f553(0x17d),_0x3ab194[_0x17f553(0x139)]=_0x17f553(0x148),_0x3ab194[_0x17f553(0x14e)]=_0x17f553(0x17a),_0x3ab194[_0x17f553(0x136)]=_0x17f553(0x10f);const _0x480ade=_0x3ab194,_0x5175bb=_0x480ade[_0x17f553(0x118)]['split']('|');let _0x20fb69=0x0;while(!![]){switch(_0x5175bb[_0x20fb69++]){case'0':this['screenshotEventUrl']=_0x480ade[_0x17f553(0x130)];continue;case'1':this['uploadAttachmentUrl']=_0x480ade[_0x17f553(0x13e)];continue;case'2':this[_0x17f553(0x179)]=[];continue;case'3':this[_0x17f553(0x114)]=[_0x480ade[_0x17f553(0x142)],_0x480ade[_0x17f553(0x13f)],_0x480ade[_0x17f553(0x123)],_0x480ade[_0x17f553(0x168)],_0x480ade[_0x17f553(0x11a)],_0x480ade[_0x17f553(0x139)],_0x480ade[_0x17f553(0x14e)]];continue;case'4':this[_0x17f553(0x138)]=![];continue;case'5':this['pollEventBatchInterval']=null;continue;case'6':this[_0x17f553(0x151)]=_0x480ade[_0x17f553(0x136)];continue;}break;}}static[a128_0x3ff9b3(0x17c)](){const _0x4cc643=a128_0x3ff9b3;return!RequestQueueHandler[_0x4cc643(0x155)]&&(RequestQueueHandler[_0x4cc643(0x155)]=new RequestQueueHandler()),RequestQueueHandler[_0x4cc643(0x155)];}[a128_0x3ff9b3(0x176)]=()=>{const _0xaf84d4=a128_0x3ff9b3;!this[_0xaf84d4(0x138)]&&(this['started']=!![],this[_0xaf84d4(0x126)]());};[a128_0x3ff9b3(0x11e)]=_0x52bb8c=>{const _0x52e5ed=a128_0x3ff9b3,_0x226ad3={'Bkwnt':function(_0x36ccd9,_0x461104){return _0x36ccd9===_0x461104;},'yOAyL':_0x52e5ed(0x169),'BhmnR':function(_0x1c23b1,_0x5625b4){return _0x1c23b1>_0x5625b4;},'Baews':_0x52e5ed(0x145),'uMHHI':function(_0x4b0aa7,_0x267775){return _0x4b0aa7!==_0x267775;},'fhxBR':_0x52e5ed(0x157),'Zjrgh':function(_0x1ee6ea,_0x49d17a){return _0x1ee6ea(_0x49d17a);},'JsNgV':_0x52e5ed(0x13c)};if(this[_0x52e5ed(0x114)][_0x52e5ed(0x121)](_0x52bb8c[_0x52e5ed(0x113)])){if(_0x52bb8c['logs']&&_0x52bb8c['logs'][0x0]&&_0x226ad3[_0x52e5ed(0x173)](_0x52bb8c[_0x52e5ed(0x12a)][0x0]['kind'],_0x226ad3[_0x52e5ed(0x17b)])){const _0x43bd17={};return _0x43bd17[_0x52e5ed(0x16f)]=!![],_0x43bd17[_0x52e5ed(0x12c)]=[_0x52bb8c],_0x43bd17[_0x52e5ed(0x177)]=this[_0x52e5ed(0x132)],_0x43bd17;}if(_0x52bb8c[_0x52e5ed(0x12a)]&&_0x226ad3[_0x52e5ed(0x17f)](_0x52bb8c['logs'][_0x52e5ed(0x13a)],0x0)&&_0x226ad3['Bkwnt'](_0x52bb8c[_0x52e5ed(0x12a)][0x0][_0x52e5ed(0x120)],_0x226ad3['Baews'])&&_0x226ad3[_0x52e5ed(0x144)](_0x52bb8c[_0x52e5ed(0x113)],_0x226ad3[_0x52e5ed(0x133)])){const _0x391643={};return _0x391643[_0x52e5ed(0x16f)]=!![],_0x391643['proceedWithData']=[_0x52bb8c],_0x391643['proceedWithUrl']=this[_0x52e5ed(0x167)],_0x391643;}this[_0x52e5ed(0x179)][_0x52e5ed(0x117)](_0x52bb8c);let _0x2e37e9=null;const _0x42b2fd=this[_0x52e5ed(0x16f)]();_0x42b2fd&&(_0x226ad3[_0x52e5ed(0x115)](trace,_0x226ad3[_0x52e5ed(0x170)]),_0x2e37e9=this[_0x52e5ed(0x179)][_0x52e5ed(0x158)](0x0,BATCH_SIZE),this[_0x52e5ed(0x179)][_0x52e5ed(0x119)](0x0,BATCH_SIZE),this[_0x52e5ed(0x162)]());const _0x5580ef={};return _0x5580ef[_0x52e5ed(0x16f)]=_0x42b2fd,_0x5580ef[_0x52e5ed(0x12c)]=_0x2e37e9,_0x5580ef[_0x52e5ed(0x177)]=this[_0x52e5ed(0x151)],_0x5580ef;}const _0x21f107={};return _0x21f107[_0x52e5ed(0x16f)]=!![],_0x21f107;};[a128_0x3ff9b3(0x160)]=async()=>{const _0x46b5c8=a128_0x3ff9b3,_0x7b0913={'dRQGm':'REMOVING','tKOjm':function(_0x3b1ddb,_0x360172){return _0x3b1ddb>_0x360172;},'dGDSf':'Shutdown-Queue','oKvGA':function(_0x4bcb08,_0x5aad4f){return _0x4bcb08(_0x5aad4f);}};await this['uploadPending'](),this[_0x46b5c8(0x14a)](_0x7b0913[_0x46b5c8(0x171)]);while(_0x7b0913[_0x46b5c8(0x153)](this[_0x46b5c8(0x179)]['length'],0x0)){const _0x7f1549=this[_0x46b5c8(0x179)][_0x46b5c8(0x158)](0x0,BATCH_SIZE);this[_0x46b5c8(0x179)][_0x46b5c8(0x119)](0x0,BATCH_SIZE),await this[_0x46b5c8(0x12d)](this['eventUrl'],_0x7b0913[_0x46b5c8(0x15d)],_0x7f1549);}_0x7b0913['tKOjm'](this[_0x46b5c8(0x159)],0x0)&&_0x7b0913['oKvGA'](debug,_0x46b5c8(0x135)+this[_0x46b5c8(0x159)]);};[a128_0x3ff9b3(0x12d)]=async(_0x5c2c7f,_0x1008dc,_0x34c7cd)=>{const _0x2bc765=a128_0x3ff9b3,_0x50c8c2={'kkrOG':function(_0x14d679,_0x3df211){return _0x14d679(_0x3df211);},'XdNtf':'utf8','EkohU':function(_0x3a388e,_0x108791){return _0x3a388e(_0x108791);},'olENs':function(_0x4f8797){return _0x4f8797();},'zGXHz':function(_0x1f31e8,_0x3ada21,_0x1018d7,_0x2f57bc,_0x1f1b8a){return _0x1f31e8(_0x3ada21,_0x1018d7,_0x2f57bc,_0x1f1b8a);},'SXjuU':_0x2bc765(0x178),'nyGFz':function(_0x1dda12,_0x2c2c5b){return _0x1dda12(_0x2c2c5b);},'RQNvr':function(_0x1a41f8,_0x52f63b){return _0x1a41f8-_0x52f63b;},'RHLDI':function(_0x5484b5,_0x191fd3){return _0x5484b5(_0x191fd3);}};let _0x134596='';try{_0x134596=_0x34c7cd['map'](_0x599c86=>'\x27'+_0x599c86[_0x2bc765(0x113)]+'\x27:'+(nestedKeyValue(_0x599c86,['test_run','uuid'])||nestedKeyValue(_0x599c86,[_0x2bc765(0x116),_0x2bc765(0x128)])))[_0x2bc765(0x17e)](','),_0x50c8c2['kkrOG'](debug,'Processing\x20batch\x20events\x20for\x20'+_0x1008dc+'.\x20Request\x20Size\x20-\x20'+Buffer[_0x2bc765(0x125)](util[_0x2bc765(0x175)]('%j',_0x34c7cd),_0x50c8c2[_0x2bc765(0x134)])+_0x2bc765(0x161)+_0x134596);}catch(_0x51ccaf){_0x50c8c2[_0x2bc765(0x14f)](debug,'Exception\x20in\x20logging\x20batch\x20events\x20--\x20'+util[_0x2bc765(0x175)](_0x51ccaf)+'}');}const _0x2c3254={'headers':_0x50c8c2[_0x2bc765(0x13b)](getDefaultHeaders)};try{const _0x29dffb=await _0x50c8c2[_0x2bc765(0x111)](nodeRequest,_0x50c8c2[_0x2bc765(0x110)],_0x5c2c7f,_0x34c7cd,_0x2c3254);if(_0x29dffb[_0x2bc765(0x16d)][_0x2bc765(0x154)]){const _0x2c4baa={};_0x2c4baa[_0x2bc765(0x12b)]=_0x29dffb['data']['error'];throw _0x2c4baa;}else _0x50c8c2['nyGFz'](debug,_0x1008dc+_0x2bc765(0x141)+_0x134596+_0x2bc765(0x15c)+util[_0x2bc765(0x175)]('%j',_0x29dffb[_0x2bc765(0x16d)])),this[_0x2bc765(0x159)]=Math[_0x2bc765(0x156)](0x0,_0x50c8c2[_0x2bc765(0x15b)](this[_0x2bc765(0x159)],_0x34c7cd[_0x2bc765(0x13a)]));}catch(_0x12b584){_0x12b584[_0x2bc765(0x163)]?_0x50c8c2[_0x2bc765(0x164)](debug,_0x2bc765(0x150)+_0x1008dc+_0x2bc765(0x127)+constants[_0x2bc765(0x131)]+_0x2bc765(0x11f)+_0x12b584['response'][_0x2bc765(0x137)]+'\x20'+_0x12b584[_0x2bc765(0x163)][_0x2bc765(0x140)]+'\x20'+util[_0x2bc765(0x175)]('%j',_0x12b584[_0x2bc765(0x163)])):_0x50c8c2[_0x2bc765(0x122)](debug,_0x2bc765(0x150)+_0x1008dc+_0x2bc765(0x127)+constants[_0x2bc765(0x131)]+_0x2bc765(0x11f)+(_0x12b584[_0x2bc765(0x12b)]||_0x12b584)),this[_0x2bc765(0x159)]=Math['max'](0x0,_0x50c8c2[_0x2bc765(0x15b)](this['pendingUploads'],_0x34c7cd[_0x2bc765(0x13a)]));}};[a128_0x3ff9b3(0x126)]=()=>{const _0x5120c1=a128_0x3ff9b3,_0x15bfd9={'gLjBI':function(_0x5c46e6,_0x1ff9d8){return _0x5c46e6>_0x1ff9d8;},'LtsYq':function(_0x14961d,_0x47365e){return _0x14961d(_0x47365e);},'SetLI':'Interval-Queue','FNHHv':function(_0x36a826,_0x1c6907){return _0x36a826(_0x1c6907);},'JNIiX':function(_0x5b3b06,_0x9253b4,_0x5f174e){return _0x5b3b06(_0x9253b4,_0x5f174e);}};this[_0x5120c1(0x16a)]=_0x15bfd9[_0x5120c1(0x112)](setInterval,async()=>{const _0x3cd4f0=_0x5120c1;if(_0x15bfd9[_0x3cd4f0(0x166)](this[_0x3cd4f0(0x179)][_0x3cd4f0(0x13a)],0x0)){_0x15bfd9['LtsYq'](trace,_0x3cd4f0(0x16e)+this['queue'][_0x3cd4f0(0x13a)]);const _0x11b06e=this[_0x3cd4f0(0x179)][_0x3cd4f0(0x158)](0x0,BATCH_SIZE);this[_0x3cd4f0(0x179)]['splice'](0x0,BATCH_SIZE),await this[_0x3cd4f0(0x12d)](this[_0x3cd4f0(0x151)],_0x15bfd9[_0x3cd4f0(0x15e)],_0x11b06e),_0x15bfd9[_0x3cd4f0(0x172)](trace,_0x3cd4f0(0x14d)+this[_0x3cd4f0(0x179)][_0x3cd4f0(0x13a)]);}},BATCH_INTERVAL);};['resetEventBatchPolling']=()=>{const _0x40dd5e=a128_0x3ff9b3,_0x1b7a61={};_0x1b7a61[_0x40dd5e(0x147)]=_0x40dd5e(0x143);const _0x4f020e=_0x1b7a61;this['removeEventBatchPolling'](_0x4f020e['dkBWz']),this[_0x40dd5e(0x126)]();};[a128_0x3ff9b3(0x14a)]=_0x3013af=>{const _0x2a76de=a128_0x3ff9b3,_0x55daee={'NQAJa':function(_0x2a9ab7,_0x228dcd){return _0x2a9ab7(_0x228dcd);},'YUzlS':function(_0x5a2e00,_0x59264c){return _0x5a2e00===_0x59264c;},'KNxDV':'REMOVING'};this[_0x2a76de(0x16a)]&&(_0x55daee[_0x2a76de(0x11b)](clearInterval,this[_0x2a76de(0x16a)]),this['pollEventBatchInterval']=null,_0x55daee[_0x2a76de(0x14c)](_0x3013af,_0x55daee['KNxDV'])&&(this[_0x2a76de(0x138)]=![]));};[a128_0x3ff9b3(0x16f)]=()=>{const _0x1202ed=a128_0x3ff9b3,_0x40f2db={};_0x40f2db[_0x1202ed(0x14b)]=function(_0xf8d369,_0x4da4e9){return _0xf8d369>=_0x4da4e9;};const _0xbcaabe=_0x40f2db;return _0xbcaabe[_0x1202ed(0x14b)](this['queue']['length'],BATCH_SIZE);};async[a128_0x3ff9b3(0x180)](_0x415aae=DEFAULT_WAIT_TIMEOUT_FOR_PENDING_UPLOADS,_0x2b922e=DEFAULT_WAIT_INTERVAL_FOR_PENDING_UPLOADS){const _0x37b7f9=a128_0x3ff9b3,_0x4c9d87={'sHOcJ':function(_0x2079d9,_0x1f5de0){return _0x2079d9<=_0x1f5de0;},'XTPFZ':function(_0x2a9242,_0x2bed91){return _0x2a9242(_0x2bed91);},'IpZip':function(_0x247220,_0x655aba){return _0x247220-_0x655aba;}};if(_0x4c9d87[_0x37b7f9(0x174)](this['pendingUploads'],0x0)||_0x4c9d87[_0x37b7f9(0x174)](_0x415aae,0x0))return;return await _0x4c9d87[_0x37b7f9(0x16c)](sleep,_0x2b922e),this['uploadPending'](_0x4c9d87[_0x37b7f9(0x12e)](_0x415aae,_0x2b922e));}}module['exports']=RequestQueueHandler;
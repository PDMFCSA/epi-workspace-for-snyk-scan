const a128_0x526ebc=a128_0x225f;(function(_0x28eb7f,_0x27baad){const _0x54cbe6=a128_0x225f,_0x49fa9f=_0x28eb7f();while(!![]){try{const _0x3b42ab=-parseInt(_0x54cbe6(0x1f5))/0x1+parseInt(_0x54cbe6(0x1ca))/0x2*(-parseInt(_0x54cbe6(0x1e2))/0x3)+parseInt(_0x54cbe6(0x1d8))/0x4+parseInt(_0x54cbe6(0x21b))/0x5+parseInt(_0x54cbe6(0x1bf))/0x6+parseInt(_0x54cbe6(0x1dd))/0x7+-parseInt(_0x54cbe6(0x1b2))/0x8;if(_0x3b42ab===_0x27baad)break;else _0x49fa9f['push'](_0x49fa9f['shift']());}catch(_0x15b62f){_0x49fa9f['push'](_0x49fa9f['shift']());}}}(a128_0x56f1,0x6f872));function a128_0x225f(_0x3dfbbc,_0x2766f7){const _0x56f173=a128_0x56f1();return a128_0x225f=function(_0x225f48,_0xc3268e){_0x225f48=_0x225f48-0x1ab;let _0x1963e0=_0x56f173[_0x225f48];return _0x1963e0;},a128_0x225f(_0x3dfbbc,_0x2766f7);}function a128_0x56f1(){const _0x2d0a13=['REMOVING','51WLjzFX','QTJSt','OxsMA','api/v1/batch','CBTSessionCreated','TestRunFinished','slice','XiEWQ','ldJqv','pollEventBatchInterval','eQvtF','Ddayc','util','push','message','mkLsf','data','Remaining\x20Queue\x20Length\x20-\x20','started','712042FlJSoP','CvVgR','\x20REQUEST\x20TO\x20','KBZes','rgpLr','logs','fPhZL','response','eventUrl','FtoJF','.\x20Request\x20Size\x20-\x20','TestRunStarted','wjtEO','nyixH','YNdZV','resetEventBatchPolling','MBBtB','proceedWithUrl','Interval-Queue','uploadAttachmentUrl','includes','OUKms','utf8','OTGLF','\x20event\x20successful\x20for\x20events\x20','hHbfk','Processing\x20events.\x20Queue\x20Length\x20-\x20','EXCEPTION\x20IN\x20','\x20bytes.\x20Events\x20are\x20','AMDhv','MlnWw','pendingUploads','sfVLA','format','batchAndPostEvents','getInstance','TEST_ATTACHMENT','upload-attachments','4391265cxrtSV','HookRunStarted','QPoca','4|2|5|3|6|0|1','instance','iSqHs','PdHTl','IiDuc','snmiE','splice','uploadPending','3873072DkaLjr','startEventBatchPolling','JaUaU','RESETTING','screenshotEventUrl','start','byteLength','length','max','EKLlt','uuid','NAfXy','hook_run','570420hdFGkn','YAvsu','queue','shouldProceed','kind','TEST_REPORTING_ANALYTICS','eVLmg','ODaQi','TestRunSkipped','FgCUm','TEST_SCREENSHOT','67372WqQvPQ','status','event_type','shutdown','../../bin/utils/constants','map','api/v1/screenshots','add','join','\x20:\x20','Shutting\x20down\x20request\x20batcher\x20with\x20pending\x20uploads\x20still\x20in\x20queue.\x20Remaining\x20uploads\x20','wXJcd','./utils','aPYYb','2535512gXqaTq','MdKzv','ckNrA','proceedWithData','pHcdt','4329185mCHWam','HookRunFinished','\x20--\x20','Shutdown-Queue'];a128_0x56f1=function(){return _0x2d0a13;};return a128_0x56f1();}const {BATCH_SIZE,BATCH_INTERVAL,DEFAULT_WAIT_TIMEOUT_FOR_PENDING_UPLOADS,DEFAULT_WAIT_INTERVAL_FOR_PENDING_UPLOADS}=require('./constants'),{nodeRequest,debug,trace,sleep,getDefaultHeaders}=require(a128_0x526ebc(0x1d6)),{nestedKeyValue}=require('../helper'),util=require(a128_0x526ebc(0x1ee)),constants=require(a128_0x526ebc(0x1ce));class RequestQueueHandler{static [a128_0x526ebc(0x1ab)];[a128_0x526ebc(0x214)]=0x0;constructor(){const _0x5710e4=a128_0x526ebc,_0x5baf20={};_0x5baf20[_0x5710e4(0x1ed)]=_0x5710e4(0x21e),_0x5baf20['PdHTl']='LogCreated',_0x5baf20['QTJSt']=_0x5710e4(0x1e6),_0x5baf20[_0x5710e4(0x1d9)]=_0x5710e4(0x1e7),_0x5baf20[_0x5710e4(0x1af)]=_0x5710e4(0x1c7),_0x5baf20[_0x5710e4(0x20a)]=_0x5710e4(0x1de),_0x5baf20[_0x5710e4(0x213)]=_0x5710e4(0x200),_0x5baf20[_0x5710e4(0x1c8)]=_0x5710e4(0x21c),_0x5baf20[_0x5710e4(0x1c0)]=_0x5710e4(0x1d0),_0x5baf20[_0x5710e4(0x1ec)]=_0x5710e4(0x1e5),_0x5baf20[_0x5710e4(0x20e)]=_0x5710e4(0x21a);const _0x19206c=_0x5baf20,_0x4db33d=_0x19206c[_0x5710e4(0x1ed)]['split']('|');let _0x549945=0x0;while(!![]){switch(_0x4db33d[_0x549945++]){case'0':this['BATCH_EVENT_TYPES']=[_0x19206c[_0x5710e4(0x1ad)],_0x19206c[_0x5710e4(0x1e3)],_0x19206c[_0x5710e4(0x1d9)],_0x19206c[_0x5710e4(0x1af)],_0x19206c[_0x5710e4(0x20a)],_0x19206c[_0x5710e4(0x213)],_0x19206c[_0x5710e4(0x1c8)]];continue;case'1':this[_0x5710e4(0x1eb)]=null;continue;case'2':this[_0x5710e4(0x1f4)]=![];continue;case'3':this[_0x5710e4(0x1b6)]=_0x19206c[_0x5710e4(0x1c0)];continue;case'4':this[_0x5710e4(0x1c1)]=[];continue;case'5':this['eventUrl']=_0x19206c[_0x5710e4(0x1ec)];continue;case'6':this[_0x5710e4(0x208)]=_0x19206c['hHbfk'];continue;}break;}}static[a128_0x526ebc(0x218)](){const _0x4663f8=a128_0x526ebc;return!RequestQueueHandler[_0x4663f8(0x1ab)]&&(RequestQueueHandler['instance']=new RequestQueueHandler()),RequestQueueHandler[_0x4663f8(0x1ab)];}[a128_0x526ebc(0x1b7)]=()=>{const _0x15e219=a128_0x526ebc;!this[_0x15e219(0x1f4)]&&(this['started']=!![],this['startEventBatchPolling']());};[a128_0x526ebc(0x1d1)]=_0x199afc=>{const _0x364bc=a128_0x526ebc,_0x23c725={'OxsMA':function(_0x5c19dc,_0x14f868){return _0x5c19dc===_0x14f868;},'fPhZL':_0x364bc(0x1c9),'rgpLr':function(_0x339ce3,_0x571d97){return _0x339ce3>_0x571d97;},'MBBtB':function(_0x4a2d1d,_0xbb129a){return _0x4a2d1d===_0xbb129a;},'OTGLF':_0x364bc(0x219),'AMDhv':function(_0x345fd6,_0x5f50b4){return _0x345fd6!==_0x5f50b4;},'sfVLA':_0x364bc(0x1e7),'KBZes':function(_0x4e168c,_0x44cee0){return _0x4e168c(_0x44cee0);},'rzekd':'Batch\x20event\x20length\x20has\x20increased\x20maximum\x20batch\x20size.\x20Sending\x20events..'};if(this['BATCH_EVENT_TYPES'][_0x364bc(0x209)](_0x199afc[_0x364bc(0x1cc)])){if(_0x199afc['logs']&&_0x199afc[_0x364bc(0x1fa)][0x0]&&_0x23c725[_0x364bc(0x1e4)](_0x199afc[_0x364bc(0x1fa)][0x0][_0x364bc(0x1c3)],_0x23c725[_0x364bc(0x1fb)])){const _0x29373a={};return _0x29373a['shouldProceed']=!![],_0x29373a[_0x364bc(0x1db)]=[_0x199afc],_0x29373a[_0x364bc(0x206)]=this[_0x364bc(0x1b6)],_0x29373a;}if(_0x199afc[_0x364bc(0x1fa)]&&_0x23c725[_0x364bc(0x1f9)](_0x199afc['logs']['length'],0x0)&&_0x23c725[_0x364bc(0x205)](_0x199afc['logs'][0x0][_0x364bc(0x1c3)],_0x23c725[_0x364bc(0x20c)])&&_0x23c725[_0x364bc(0x212)](_0x199afc['event_type'],_0x23c725[_0x364bc(0x215)])){const _0x45a68c={};return _0x45a68c['shouldProceed']=!![],_0x45a68c[_0x364bc(0x1db)]=[_0x199afc],_0x45a68c['proceedWithUrl']=this[_0x364bc(0x208)],_0x45a68c;}this[_0x364bc(0x1c1)][_0x364bc(0x1ef)](_0x199afc);let _0x217935=null;const _0xf38a7a=this['shouldProceed']();_0xf38a7a&&(_0x23c725[_0x364bc(0x1f8)](trace,_0x23c725['rzekd']),_0x217935=this[_0x364bc(0x1c1)][_0x364bc(0x1e8)](0x0,BATCH_SIZE),this[_0x364bc(0x1c1)]['splice'](0x0,BATCH_SIZE),this[_0x364bc(0x204)]());const _0x21e482={};return _0x21e482[_0x364bc(0x1c2)]=_0xf38a7a,_0x21e482[_0x364bc(0x1db)]=_0x217935,_0x21e482[_0x364bc(0x206)]=this[_0x364bc(0x1fd)],_0x21e482;}const _0x5b80dd={};return _0x5b80dd[_0x364bc(0x1c2)]=!![],_0x5b80dd;};[a128_0x526ebc(0x1cd)]=async()=>{const _0x4e8701=a128_0x526ebc,_0xeb1ddd={'ckNrA':'REMOVING','iSqHs':function(_0x5282a9,_0x7b6e16){return _0x5282a9>_0x7b6e16;},'eVLmg':_0x4e8701(0x1e0),'IiDuc':function(_0x8411ae,_0x2465b1){return _0x8411ae(_0x2465b1);}};await this[_0x4e8701(0x1b1)](),this['removeEventBatchPolling'](_0xeb1ddd[_0x4e8701(0x1da)]);while(_0xeb1ddd[_0x4e8701(0x1ac)](this['queue']['length'],0x0)){const _0x2c0d2d=this['queue']['slice'](0x0,BATCH_SIZE);this[_0x4e8701(0x1c1)]['splice'](0x0,BATCH_SIZE),await this[_0x4e8701(0x217)](this[_0x4e8701(0x1fd)],_0xeb1ddd[_0x4e8701(0x1c5)],_0x2c0d2d);}_0xeb1ddd['iSqHs'](this[_0x4e8701(0x214)],0x0)&&_0xeb1ddd[_0x4e8701(0x1ae)](debug,_0x4e8701(0x1d4)+this['pendingUploads']);};[a128_0x526ebc(0x217)]=async(_0x5d67f0,_0x344608,_0x73730e)=>{const _0x594a23=a128_0x526ebc,_0x79a301={'nyixH':function(_0x157965,_0xd19a72){return _0x157965(_0xd19a72);},'aPYYb':_0x594a23(0x20b),'XiEWQ':function(_0x24ce34){return _0x24ce34();},'FtoJF':function(_0x2a850d,_0x5aae63,_0x29de5b,_0x5a2803,_0x3b223e){return _0x2a850d(_0x5aae63,_0x29de5b,_0x5a2803,_0x3b223e);},'YNdZV':'POST','ODaQi':function(_0x43c2fd,_0x41f59e){return _0x43c2fd-_0x41f59e;},'CvVgR':function(_0x41afbf,_0x12fc2f){return _0x41afbf(_0x12fc2f);}};let _0x306a03='';try{_0x306a03=_0x73730e[_0x594a23(0x1cf)](_0x8662bf=>'\x27'+_0x8662bf[_0x594a23(0x1cc)]+'\x27:'+(nestedKeyValue(_0x8662bf,['test_run',_0x594a23(0x1bc)])||nestedKeyValue(_0x8662bf,[_0x594a23(0x1be),_0x594a23(0x1bc)])))[_0x594a23(0x1d2)](','),_0x79a301[_0x594a23(0x202)](debug,'Processing\x20batch\x20events\x20for\x20'+_0x344608+_0x594a23(0x1ff)+Buffer[_0x594a23(0x1b8)](util[_0x594a23(0x216)]('%j',_0x73730e),_0x79a301[_0x594a23(0x1d7)])+_0x594a23(0x211)+_0x306a03);}catch(_0x543752){_0x79a301[_0x594a23(0x202)](debug,'Exception\x20in\x20logging\x20batch\x20events\x20--\x20'+util[_0x594a23(0x216)](_0x543752)+'}');}const _0x521718={'headers':_0x79a301[_0x594a23(0x1e9)](getDefaultHeaders)};try{const _0x279d05=await _0x79a301[_0x594a23(0x1fe)](nodeRequest,_0x79a301[_0x594a23(0x203)],_0x5d67f0,_0x73730e,_0x521718);if(_0x279d05[_0x594a23(0x1f2)]['error']){const _0x318d0d={};_0x318d0d[_0x594a23(0x1f0)]=_0x279d05[_0x594a23(0x1f2)]['error'];throw _0x318d0d;}else _0x79a301['nyixH'](debug,_0x344608+_0x594a23(0x20d)+_0x306a03+_0x594a23(0x1df)+util[_0x594a23(0x216)]('%j',_0x279d05['data'])),this[_0x594a23(0x214)]=Math[_0x594a23(0x1ba)](0x0,_0x79a301[_0x594a23(0x1c6)](this[_0x594a23(0x214)],_0x73730e[_0x594a23(0x1b9)]));}catch(_0xba20e9){_0xba20e9[_0x594a23(0x1fc)]?_0x79a301[_0x594a23(0x1f6)](debug,_0x594a23(0x210)+_0x344608+_0x594a23(0x1f7)+constants[_0x594a23(0x1c4)]+_0x594a23(0x1d3)+_0xba20e9[_0x594a23(0x1fc)][_0x594a23(0x1cb)]+'\x20'+_0xba20e9[_0x594a23(0x1fc)]['statusText']+'\x20'+util[_0x594a23(0x216)]('%j',_0xba20e9[_0x594a23(0x1fc)])):_0x79a301[_0x594a23(0x1f6)](debug,_0x594a23(0x210)+_0x344608+_0x594a23(0x1f7)+constants[_0x594a23(0x1c4)]+_0x594a23(0x1d3)+(_0xba20e9['message']||_0xba20e9)),this['pendingUploads']=Math[_0x594a23(0x1ba)](0x0,_0x79a301[_0x594a23(0x1c6)](this['pendingUploads'],_0x73730e['length']));}};['startEventBatchPolling']=()=>{const _0x4d3066=a128_0x526ebc,_0x4a2301={'nSoPG':function(_0x1937d8,_0xd6cb57){return _0x1937d8>_0xd6cb57;},'wjtEO':function(_0x2a5dd6,_0x304edb){return _0x2a5dd6(_0x304edb);},'BwKYe':_0x4d3066(0x207),'JaUaU':function(_0x269f44,_0x12981e){return _0x269f44(_0x12981e);},'QPoca':function(_0x19f936,_0x5716b6,_0x540bc9){return _0x19f936(_0x5716b6,_0x540bc9);}};this[_0x4d3066(0x1eb)]=_0x4a2301[_0x4d3066(0x21d)](setInterval,async()=>{const _0x1458c4=_0x4d3066;if(_0x4a2301['nSoPG'](this[_0x1458c4(0x1c1)]['length'],0x0)){_0x4a2301[_0x1458c4(0x201)](trace,_0x1458c4(0x20f)+this[_0x1458c4(0x1c1)][_0x1458c4(0x1b9)]);const _0x9487da=this['queue'][_0x1458c4(0x1e8)](0x0,BATCH_SIZE);this[_0x1458c4(0x1c1)][_0x1458c4(0x1b0)](0x0,BATCH_SIZE),await this[_0x1458c4(0x217)](this['eventUrl'],_0x4a2301['BwKYe'],_0x9487da),_0x4a2301[_0x1458c4(0x1b4)](trace,_0x1458c4(0x1f3)+this[_0x1458c4(0x1c1)]['length']);}},BATCH_INTERVAL);};[a128_0x526ebc(0x204)]=()=>{const _0x448285=a128_0x526ebc,_0x4d3cd7={};_0x4d3cd7['inhfl']=_0x448285(0x1b5);const _0x11e5e7=_0x4d3cd7;this['removeEventBatchPolling'](_0x11e5e7['inhfl']),this[_0x448285(0x1b3)]();};['removeEventBatchPolling']=_0xf280fb=>{const _0x78102f=a128_0x526ebc,_0xecbfaa={'mkLsf':function(_0x45e182,_0x35ba77){return _0x45e182(_0x35ba77);},'wXJcd':function(_0x12f6fc,_0xc278a8){return _0x12f6fc===_0xc278a8;},'pHcdt':_0x78102f(0x1e1)};this[_0x78102f(0x1eb)]&&(_0xecbfaa[_0x78102f(0x1f1)](clearInterval,this[_0x78102f(0x1eb)]),this['pollEventBatchInterval']=null,_0xecbfaa[_0x78102f(0x1d5)](_0xf280fb,_0xecbfaa[_0x78102f(0x1dc)])&&(this['started']=![]));};[a128_0x526ebc(0x1c2)]=()=>{const _0x290417=a128_0x526ebc,_0x27cf87={};_0x27cf87['lgREL']=function(_0x4641ed,_0x2229ed){return _0x4641ed>=_0x2229ed;};const _0x58bfa9=_0x27cf87;return _0x58bfa9['lgREL'](this[_0x290417(0x1c1)][_0x290417(0x1b9)],BATCH_SIZE);};async[a128_0x526ebc(0x1b1)](_0x57c75d=DEFAULT_WAIT_TIMEOUT_FOR_PENDING_UPLOADS,_0x2d7828=DEFAULT_WAIT_INTERVAL_FOR_PENDING_UPLOADS){const _0x49cfbb=a128_0x526ebc,_0x3856c6={'NAfXy':function(_0x47c436,_0x5a4d1a){return _0x47c436<=_0x5a4d1a;},'ldJqv':function(_0x4f156c,_0x4c2c65){return _0x4f156c(_0x4c2c65);},'EKLlt':function(_0x4b9ddc,_0xc798d8){return _0x4b9ddc-_0xc798d8;}};if(_0x3856c6[_0x49cfbb(0x1bd)](this[_0x49cfbb(0x214)],0x0)||_0x3856c6[_0x49cfbb(0x1bd)](_0x57c75d,0x0))return;return await _0x3856c6[_0x49cfbb(0x1ea)](sleep,_0x2d7828),this[_0x49cfbb(0x1b1)](_0x3856c6[_0x49cfbb(0x1bb)](_0x57c75d,_0x2d7828));}}module['exports']=RequestQueueHandler;
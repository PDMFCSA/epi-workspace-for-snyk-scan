const a86_0x2035f9=a86_0x557e;function a86_0x5ef8(){const _0x35d719=['response','resetEventBatchPolling','PvHEf','uploadPending','YukWv','format','7263300sLoudL','WftvW','JgqeF','SDWjy','dQbSQ','TestRunSkipped','\x20REQUEST\x20TO\x20TEST\x20OBSERVABILITY\x20:\x20','message','\x20bytes.\x20Events\x20are\x20','logs','YEHLF','error','Exception\x20in\x20logging\x20batch\x20events\x20--\x20','2721048EBFrGg','../helper','length','screenshotEventUrl','statusText','NqndU','started','hook_run','LdrmI','BIckF','2672XSIOyc','uUNmV','jBqmV','EHlTZ','ujhAH','queue','Rshyi','TEST_SCREENSHOT','CBTSessionCreated','hBkll','fPKwB','data','eGDKy','IjrFx','proceedWithUrl','yEFpX','PDzhW','POST','TestRunFinished','WMJzf','HookRunFinished','VMZVw','REMOVING','iEluK','5|6|3|2|4|0|1','util','.\x20Request\x20Size\x20-\x20','LogCreated','shouldProceed','JRdJw','TestRunStarted','NymaQ','LTuFe','LZrFf','hCZgp','3196575tbHjya','pollEventBatchInterval','instance','1520211zlxqCn','WJnAL','4ZJONmt','event_type','ACZcy','splice','Processing\x20events.\x20Queue\x20Length\x20-\x20','eventUrl','utf8','removeEventBatchPolling','max','split','EDCKD','gUiBd','lvhNe','Shutting\x20down\x20request\x20batcher\x20with\x20pending\x20uploads\x20still\x20in\x20queue.\x20Remaining\x20uploads\x20','EXCEPTION\x20IN\x20','startEventBatchPolling','uploadAttachmentUrl','TEST_ATTACHMENT','NubGG','pAjiM','includes','AhJAE','pendingUploads','ZNGFc','getInstance','144BvGSUt','\x20event\x20successful\x20for\x20events\x20','api/v1/screenshots','BATCH_EVENT_TYPES','add','2404128hAzhOk','kind','proceedWithData','./utils','639422ozNbkl','slice','MmJho','upload-attachments','batchAndPostEvents','start','Processing\x20batch\x20events\x20for\x20'];a86_0x5ef8=function(){return _0x35d719;};return a86_0x5ef8();}(function(_0x544e4a,_0x42acb1){const _0x44ba77=a86_0x557e,_0xa67f29=_0x544e4a();while(!![]){try{const _0x1f3e93=parseInt(_0x44ba77(0x180))/0x1*(-parseInt(_0x44ba77(0x15e))/0x2)+parseInt(_0x44ba77(0x19a))/0x3+-parseInt(_0x44ba77(0x17c))/0x4+parseInt(_0x44ba77(0x159))/0x5+parseInt(_0x44ba77(0x18d))/0x6+-parseInt(_0x44ba77(0x15c))/0x7+-parseInt(_0x44ba77(0x136))/0x8*(parseInt(_0x44ba77(0x177))/0x9);if(_0x1f3e93===_0x42acb1)break;else _0xa67f29['push'](_0xa67f29['shift']());}catch(_0x2d5926){_0xa67f29['push'](_0xa67f29['shift']());}}}(a86_0x5ef8,0x9fc98));const {BATCH_SIZE,BATCH_INTERVAL,DEFAULT_WAIT_TIMEOUT_FOR_PENDING_UPLOADS,DEFAULT_WAIT_INTERVAL_FOR_PENDING_UPLOADS}=require('./constants'),{nodeRequest,debug,trace,sleep,getDefaultHeaders}=require(a86_0x2035f9(0x17f)),{nestedKeyValue}=require(a86_0x2035f9(0x19b)),util=require(a86_0x2035f9(0x14f));function a86_0x557e(_0x3f8661,_0x157b61){const _0x5ef803=a86_0x5ef8();return a86_0x557e=function(_0x557e6e,_0x4a3c67){_0x557e6e=_0x557e6e-0x12e;let _0x137e24=_0x5ef803[_0x557e6e];return _0x137e24;},a86_0x557e(_0x3f8661,_0x157b61);}class RequestQueueHandler{static [a86_0x2035f9(0x15b)];[a86_0x2035f9(0x174)]=0x0;constructor(){const _0x5f1d1d=a86_0x2035f9,_0xba320f={};_0xba320f[_0x5f1d1d(0x153)]=_0x5f1d1d(0x14e),_0xba320f[_0x5f1d1d(0x139)]=_0x5f1d1d(0x151),_0xba320f['ACZcy']=_0x5f1d1d(0x13e),_0xba320f[_0x5f1d1d(0x156)]='TestRunFinished',_0xba320f[_0x5f1d1d(0x134)]=_0x5f1d1d(0x192),_0xba320f[_0x5f1d1d(0x190)]=_0x5f1d1d(0x14a),_0xba320f[_0x5f1d1d(0x168)]=_0x5f1d1d(0x154),_0xba320f[_0x5f1d1d(0x18e)]='HookRunStarted',_0xba320f[_0x5f1d1d(0x13a)]=_0x5f1d1d(0x179),_0xba320f[_0x5f1d1d(0x158)]='api/v1/batch',_0xba320f[_0x5f1d1d(0x143)]=_0x5f1d1d(0x183);const _0x3fac02=_0xba320f,_0x5ec4b7=_0x3fac02['JRdJw'][_0x5f1d1d(0x167)]('|');let _0x5f15d2=0x0;while(!![]){switch(_0x5ec4b7[_0x5f15d2++]){case'0':this[_0x5f1d1d(0x17a)]=[_0x3fac02[_0x5f1d1d(0x139)],_0x3fac02[_0x5f1d1d(0x160)],_0x3fac02[_0x5f1d1d(0x156)],_0x3fac02[_0x5f1d1d(0x134)],_0x3fac02[_0x5f1d1d(0x190)],_0x3fac02[_0x5f1d1d(0x168)],_0x3fac02['WftvW']];continue;case'1':this['pollEventBatchInterval']=null;continue;case'2':this[_0x5f1d1d(0x12f)]=_0x3fac02[_0x5f1d1d(0x13a)];continue;case'3':this['eventUrl']=_0x3fac02[_0x5f1d1d(0x158)];continue;case'4':this[_0x5f1d1d(0x16e)]=_0x3fac02[_0x5f1d1d(0x143)];continue;case'5':this[_0x5f1d1d(0x13b)]=[];continue;case'6':this[_0x5f1d1d(0x132)]=![];continue;}break;}}static[a86_0x2035f9(0x176)](){const _0xd5cbb9=a86_0x2035f9;return!RequestQueueHandler[_0xd5cbb9(0x15b)]&&(RequestQueueHandler[_0xd5cbb9(0x15b)]=new RequestQueueHandler()),RequestQueueHandler[_0xd5cbb9(0x15b)];}[a86_0x2035f9(0x185)]=()=>{const _0x42296e=a86_0x2035f9;!this[_0x42296e(0x132)]&&(this[_0x42296e(0x132)]=!![],this[_0x42296e(0x16d)]());};[a86_0x2035f9(0x17b)]=_0x3153a9=>{const _0x41db08=a86_0x2035f9,_0x5977d0={'PDzhW':function(_0x302859,_0x229588){return _0x302859===_0x229588;},'RUSaw':_0x41db08(0x13d),'YEHLF':function(_0xc797a9,_0x5d5499){return _0xc797a9>_0x5d5499;},'BsBuh':_0x41db08(0x16f),'dAqtG':function(_0x27d320,_0xe31d67){return _0x27d320!==_0xe31d67;},'MzRJk':_0x41db08(0x148),'iEluK':function(_0x75497c,_0x2bec78){return _0x75497c(_0x2bec78);},'NqndU':'Batch\x20event\x20length\x20has\x20increased\x20maximum\x20batch\x20size.\x20Sending\x20events..'};if(this[_0x41db08(0x17a)][_0x41db08(0x172)](_0x3153a9[_0x41db08(0x15f)])){if(_0x3153a9['logs']&&_0x3153a9[_0x41db08(0x196)][0x0]&&_0x5977d0[_0x41db08(0x146)](_0x3153a9[_0x41db08(0x196)][0x0][_0x41db08(0x17d)],_0x5977d0['RUSaw'])){const _0x5b4244={};return _0x5b4244[_0x41db08(0x152)]=!![],_0x5b4244[_0x41db08(0x17e)]=[_0x3153a9],_0x5b4244[_0x41db08(0x144)]=this['screenshotEventUrl'],_0x5b4244;}if(_0x3153a9['logs']&&_0x5977d0[_0x41db08(0x197)](_0x3153a9[_0x41db08(0x196)]['length'],0x0)&&_0x5977d0[_0x41db08(0x146)](_0x3153a9[_0x41db08(0x196)][0x0]['kind'],_0x5977d0['BsBuh'])&&_0x5977d0['dAqtG'](_0x3153a9[_0x41db08(0x15f)],_0x5977d0['MzRJk'])){const _0x5b0a8d={};return _0x5b0a8d['shouldProceed']=!![],_0x5b0a8d[_0x41db08(0x17e)]=[_0x3153a9],_0x5b0a8d[_0x41db08(0x144)]=this[_0x41db08(0x16e)],_0x5b0a8d;}this['queue']['push'](_0x3153a9);let _0x5e278d=null;const _0x7fe10c=this['shouldProceed']();_0x7fe10c&&(_0x5977d0[_0x41db08(0x14d)](trace,_0x5977d0[_0x41db08(0x131)]),_0x5e278d=this[_0x41db08(0x13b)]['slice'](0x0,BATCH_SIZE),this[_0x41db08(0x13b)][_0x41db08(0x161)](0x0,BATCH_SIZE),this['resetEventBatchPolling']());const _0x5b75cf={};return _0x5b75cf[_0x41db08(0x152)]=_0x7fe10c,_0x5b75cf[_0x41db08(0x17e)]=_0x5e278d,_0x5b75cf['proceedWithUrl']=this[_0x41db08(0x163)],_0x5b75cf;}const _0x355d19={};return _0x355d19[_0x41db08(0x152)]=!![],_0x355d19;};['shutdown']=async()=>{const _0x10df28=a86_0x2035f9,_0x12424e={'NubGG':_0x10df28(0x14c),'ZNGFc':function(_0xdffa8e,_0x414365){return _0xdffa8e>_0x414365;},'pAjiM':'Shutdown-Queue','eGDKy':function(_0x5b5cbc,_0x536082){return _0x5b5cbc(_0x536082);}};await this[_0x10df28(0x18a)](),this['removeEventBatchPolling'](_0x12424e[_0x10df28(0x170)]);while(_0x12424e[_0x10df28(0x175)](this['queue'][_0x10df28(0x12e)],0x0)){const _0x5cdcab=this[_0x10df28(0x13b)][_0x10df28(0x181)](0x0,BATCH_SIZE);this[_0x10df28(0x13b)][_0x10df28(0x161)](0x0,BATCH_SIZE),await this[_0x10df28(0x184)](this[_0x10df28(0x163)],_0x12424e[_0x10df28(0x171)],_0x5cdcab);}_0x12424e[_0x10df28(0x175)](this[_0x10df28(0x174)],0x0)&&_0x12424e[_0x10df28(0x142)](debug,_0x10df28(0x16b)+this[_0x10df28(0x174)]);};[a86_0x2035f9(0x184)]=async(_0x73be38,_0x149cfa,_0x2c1cb9)=>{const _0x5b46a9=a86_0x2035f9,_0x338904={'Rshyi':function(_0x39278c,_0x317176){return _0x39278c(_0x317176);},'dQbSQ':_0x5b46a9(0x164),'AhJAE':function(_0x63b9b4,_0x18c993){return _0x63b9b4(_0x18c993);},'BIckF':function(_0x186468){return _0x186468();},'PvHEf':function(_0x2e7430,_0x3638a1,_0x4dae77,_0x28055d,_0x8e6c0d){return _0x2e7430(_0x3638a1,_0x4dae77,_0x28055d,_0x8e6c0d);},'jBqmV':_0x5b46a9(0x147),'uUNmV':function(_0x2feb6e,_0x399cef){return _0x2feb6e(_0x399cef);},'WJnAL':function(_0xb5846e,_0x54f684){return _0xb5846e-_0x54f684;},'LZrFf':function(_0x43582f,_0x2928ec){return _0x43582f(_0x2928ec);}};let _0x31c886='';try{_0x31c886=_0x2c1cb9['map'](_0x12cf3d=>'\x27'+_0x12cf3d['event_type']+'\x27:'+(nestedKeyValue(_0x12cf3d,['test_run','uuid'])||nestedKeyValue(_0x12cf3d,[_0x5b46a9(0x133),'uuid'])))['join'](','),_0x338904[_0x5b46a9(0x13c)](debug,_0x5b46a9(0x186)+_0x149cfa+_0x5b46a9(0x150)+Buffer['byteLength'](util[_0x5b46a9(0x18c)]('%j',_0x2c1cb9),_0x338904[_0x5b46a9(0x191)])+_0x5b46a9(0x195)+_0x31c886);}catch(_0x4fbbdc){_0x338904[_0x5b46a9(0x173)](debug,_0x5b46a9(0x199)+util[_0x5b46a9(0x18c)](_0x4fbbdc)+'}');}const _0xc11efa={'headers':_0x338904[_0x5b46a9(0x135)](getDefaultHeaders)};try{const _0x500a77=await _0x338904[_0x5b46a9(0x189)](nodeRequest,_0x338904[_0x5b46a9(0x138)],_0x73be38,_0x2c1cb9,_0xc11efa);if(_0x500a77[_0x5b46a9(0x141)][_0x5b46a9(0x198)]){const _0x111b08={};_0x111b08[_0x5b46a9(0x194)]=_0x500a77[_0x5b46a9(0x141)]['error'];throw _0x111b08;}else _0x338904[_0x5b46a9(0x137)](debug,_0x149cfa+_0x5b46a9(0x178)+_0x31c886+'\x20--\x20'+util[_0x5b46a9(0x18c)]('%j',_0x500a77[_0x5b46a9(0x141)])),this[_0x5b46a9(0x174)]=Math[_0x5b46a9(0x166)](0x0,_0x338904['WJnAL'](this[_0x5b46a9(0x174)],_0x2c1cb9[_0x5b46a9(0x12e)]));}catch(_0x4f1066){_0x4f1066[_0x5b46a9(0x187)]?_0x338904[_0x5b46a9(0x173)](debug,'EXCEPTION\x20IN\x20'+_0x149cfa+'\x20REQUEST\x20TO\x20TEST\x20OBSERVABILITY\x20:\x20'+_0x4f1066[_0x5b46a9(0x187)]['status']+'\x20'+_0x4f1066[_0x5b46a9(0x187)][_0x5b46a9(0x130)]+'\x20'+util[_0x5b46a9(0x18c)]('%j',_0x4f1066[_0x5b46a9(0x187)])):_0x338904[_0x5b46a9(0x157)](debug,_0x5b46a9(0x16c)+_0x149cfa+_0x5b46a9(0x193)+(_0x4f1066['message']||_0x4f1066)),this[_0x5b46a9(0x174)]=Math['max'](0x0,_0x338904[_0x5b46a9(0x15d)](this[_0x5b46a9(0x174)],_0x2c1cb9[_0x5b46a9(0x12e)]));}};[a86_0x2035f9(0x16d)]=()=>{const _0x114e58=a86_0x2035f9,_0x19cbe7={'JgqeF':function(_0x56aaf9,_0x1c3901){return _0x56aaf9>_0x1c3901;},'hBkll':function(_0x3aa576,_0x1395e8){return _0x3aa576(_0x1395e8);},'fPKwB':'Interval-Queue','MmJho':function(_0x3d402f,_0x16c02c){return _0x3d402f(_0x16c02c);},'gUiBd':function(_0x511a21,_0x38d34f,_0x21fbbf){return _0x511a21(_0x38d34f,_0x21fbbf);}};this[_0x114e58(0x15a)]=_0x19cbe7[_0x114e58(0x169)](setInterval,async()=>{const _0x349249=_0x114e58;if(_0x19cbe7[_0x349249(0x18f)](this[_0x349249(0x13b)]['length'],0x0)){_0x19cbe7[_0x349249(0x13f)](trace,_0x349249(0x162)+this[_0x349249(0x13b)][_0x349249(0x12e)]);const _0xdb9888=this[_0x349249(0x13b)][_0x349249(0x181)](0x0,BATCH_SIZE);this[_0x349249(0x13b)][_0x349249(0x161)](0x0,BATCH_SIZE),await this['batchAndPostEvents'](this['eventUrl'],_0x19cbe7[_0x349249(0x140)],_0xdb9888),_0x19cbe7[_0x349249(0x182)](trace,'Remaining\x20Queue\x20Length\x20-\x20'+this[_0x349249(0x13b)][_0x349249(0x12e)]);}},BATCH_INTERVAL);};[a86_0x2035f9(0x188)]=()=>{const _0x52cf8d=a86_0x2035f9,_0x681b36={};_0x681b36[_0x52cf8d(0x149)]='RESETTING';const _0x13c74b=_0x681b36;this[_0x52cf8d(0x165)](_0x13c74b[_0x52cf8d(0x149)]),this[_0x52cf8d(0x16d)]();};[a86_0x2035f9(0x165)]=_0x50d723=>{const _0x19039a=a86_0x2035f9,_0x45d0ad={'jKrpW':function(_0xea4b85,_0x464204){return _0xea4b85(_0x464204);},'pbTBB':function(_0x35bd42,_0x978d25){return _0x35bd42===_0x978d25;},'VMZVw':_0x19039a(0x14c)};this[_0x19039a(0x15a)]&&(_0x45d0ad['jKrpW'](clearInterval,this[_0x19039a(0x15a)]),this[_0x19039a(0x15a)]=null,_0x45d0ad['pbTBB'](_0x50d723,_0x45d0ad[_0x19039a(0x14b)])&&(this['started']=![]));};[a86_0x2035f9(0x152)]=()=>{const _0x54d79b=a86_0x2035f9,_0x509ea1={};_0x509ea1['lvhNe']=function(_0x50b777,_0x135c73){return _0x50b777>=_0x135c73;};const _0x4c1379=_0x509ea1;return _0x4c1379[_0x54d79b(0x16a)](this[_0x54d79b(0x13b)][_0x54d79b(0x12e)],BATCH_SIZE);};async[a86_0x2035f9(0x18a)](_0x2465b5=DEFAULT_WAIT_TIMEOUT_FOR_PENDING_UPLOADS,_0x384a8a=DEFAULT_WAIT_INTERVAL_FOR_PENDING_UPLOADS){const _0x7beff6=a86_0x2035f9,_0x1b706c={'yEFpX':function(_0x345056,_0x116ea7){return _0x345056<=_0x116ea7;},'NymaQ':function(_0x24b97a,_0x206e77){return _0x24b97a(_0x206e77);},'YukWv':function(_0x6634ef,_0x1bfbc2){return _0x6634ef-_0x1bfbc2;}};if(_0x1b706c[_0x7beff6(0x145)](this[_0x7beff6(0x174)],0x0)||_0x1b706c[_0x7beff6(0x145)](_0x2465b5,0x0))return;return await _0x1b706c[_0x7beff6(0x155)](sleep,_0x384a8a),this['uploadPending'](_0x1b706c[_0x7beff6(0x18b)](_0x2465b5,_0x384a8a));}}module['exports']=RequestQueueHandler;